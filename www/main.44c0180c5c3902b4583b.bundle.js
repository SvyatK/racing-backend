webpackJsonp([0],{"+4Qc":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=a(r("/MUw")),o=r("FjAT"),s=a(r("NqTp"));function a(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){var e=this;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._head=new s.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/i.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e){return this._addListener(new s.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL))},t.prototype.addOnce=function(t,e){return this._addListener(new s.default(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.UPDATE_PRIORITY.NORMAL,!0))},t.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null},t.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),e=void 0;if(t>this.lastTime){(e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*i.default.TARGET_FPMS*this.speed;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=t},n(t,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,i.default.TARGET_FPMS);this._maxElapsedMS=1/e}}]),t}();e.default=l},"+9Il":function(t,e,r){"use strict";e.__esModule=!0;var n=a(r("5tzz")),i=r("FjAT"),o=r("Q5/2"),s=a(r("NGfj"));function a(t){return t&&t.__esModule?t:{default:t}}var l=new o.Matrix,c=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=t._texture,r=this.renderer,n=e._frame.width,a=e._frame.height,c=t.transform.worldTransform,u=0,h=0;if(!(e.orig.width<=0||e.orig.height<=0)&&e.baseTexture.source&&(r.setBlendMode(t.blendMode),e.valid)){r.context.globalAlpha=t.worldAlpha;var d=e.baseTexture.scaleMode===i.SCALE_MODES.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==d&&(r.context[r.smoothProperty]=d),e.trim?(u=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,h=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(u=(.5-t.anchor.x)*e.orig.width,h=(.5-t.anchor.y)*e.orig.height),e.rotate&&(c.copy(l),o.GroupD8.matrixAppendRotationInv(c=l,e.rotate,u,h),u=0,h=0),u-=n/2,h-=a/2,r.roundPixels?(r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution|0,c.ty*r.resolution|0),u|=0,h|=0):r.context.setTransform(c.a,c.b,c.c,c.d,c.tx*r.resolution,c.ty*r.resolution);var p=e.baseTexture.resolution;16777215!==t.tint?(t.cachedTint===t.tint&&t.tintedTexture.tintId===t._texture._updateID||(t.cachedTint=t.tint,t.tintedTexture=s.default.getTintedTexture(t,t.tint)),r.context.drawImage(t.tintedTexture,0,0,n*p,a*p,u*r.resolution,h*r.resolution,n*r.resolution,a*r.resolution)):r.context.drawImage(e.baseTexture.source,e._frame.x*p,e._frame.y*p,n*p,a*p,u*r.resolution,h*r.resolution,n*r.resolution,a*r.resolution)}},t.prototype.destroy=function(){this.renderer=null},t}();e.default=c,n.default.registerPlugin("sprite",c)},"+DNt":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("Obmw")).default);e.default=n},"+MIv":function(t,e,r){"use strict";e.__esModule=!0;var n=r("27Ej");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return o(n).default}});var i=r("JJ61");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return o(i).default}})},"+QcN":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=t.getParameter(t.MAX_VARYING_VECTORS),r=15;r>e;)r-=2;return r}},"+lzb":function(t,e){function r(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-r:t+r}return 0|Math.min(t,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(t){this.ms=t},r.prototype.setMax=function(t){this.max=t},r.prototype.setJitter=function(t){this.jitter=t}},"+uzX":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=!e;if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(r){var s=document.createElement("canvas");s.width=1,s.height=1,e=n.default.createContext(s)}for(var a=e.createShader(e.FRAGMENT_SHADER);;){var l=i.replace(/%forloop%/gi,o(t));if(e.shaderSource(a,l),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS))break;t=t/2|0}return r&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),t};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("8QNu")),i=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function o(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}},"/9A/":function(t,e){t.exports=function(t,e,r){var n;if(r){var i=r.tempAttribState,o=r.attribState;for(n=0;n<i.length;n++)i[n]=!1;for(n=0;n<e.length;n++)i[e[n].attribute.location]=!0;for(n=0;n<o.length;n++)o[n]!==i[n]&&(o[n]=i[n],r.attribState[n]?t.enableVertexAttribArray(n):t.disableVertexAttribArray(n))}else for(n=0;n<e.length;n++)t.enableVertexAttribArray(e[n].attribute.location)}},"/B0E":function(t,e,r){"use strict";e.__esModule=!0,e.autoDetectRenderer=e.Application=e.Filter=e.SpriteMaskFilter=e.Quad=e.RenderTarget=e.ObjectRenderer=e.WebGLManager=e.Shader=e.CanvasRenderTarget=e.TextureUvs=e.VideoBaseTexture=e.BaseRenderTexture=e.RenderTexture=e.BaseTexture=e.TextureMatrix=e.Texture=e.Spritesheet=e.CanvasGraphicsRenderer=e.GraphicsRenderer=e.GraphicsData=e.Graphics=e.TextMetrics=e.TextStyle=e.Text=e.SpriteRenderer=e.CanvasTinter=e.CanvasSpriteRenderer=e.Sprite=e.TransformBase=e.TransformStatic=e.Transform=e.Container=e.DisplayObject=e.Bounds=e.glCore=e.WebGLRenderer=e.CanvasRenderer=e.ticker=e.utils=e.settings=void 0;var n=r("FjAT");Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var i=r("Q5/2");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=r("8QNu");Object.defineProperty(e,"glCore",{enumerable:!0,get:function(){return q(o).default}});var s=r("F+P4");Object.defineProperty(e,"Bounds",{enumerable:!0,get:function(){return q(s).default}});var a=r("3Wvr");Object.defineProperty(e,"DisplayObject",{enumerable:!0,get:function(){return q(a).default}});var l=r("dtlK");Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return q(l).default}});var c=r("W1MY");Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return q(c).default}});var u=r("qisP");Object.defineProperty(e,"TransformStatic",{enumerable:!0,get:function(){return q(u).default}});var h=r("mAOr");Object.defineProperty(e,"TransformBase",{enumerable:!0,get:function(){return q(h).default}});var d=r("izXE");Object.defineProperty(e,"Sprite",{enumerable:!0,get:function(){return q(d).default}});var p=r("+9Il");Object.defineProperty(e,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return q(p).default}});var f=r("NGfj");Object.defineProperty(e,"CanvasTinter",{enumerable:!0,get:function(){return q(f).default}});var m=r("0yPo");Object.defineProperty(e,"SpriteRenderer",{enumerable:!0,get:function(){return q(m).default}});var v=r("AM6m");Object.defineProperty(e,"Text",{enumerable:!0,get:function(){return q(v).default}});var g=r("UxPA");Object.defineProperty(e,"TextStyle",{enumerable:!0,get:function(){return q(g).default}});var y=r("4LTl");Object.defineProperty(e,"TextMetrics",{enumerable:!0,get:function(){return q(y).default}});var x=r("4Nog");Object.defineProperty(e,"Graphics",{enumerable:!0,get:function(){return q(x).default}});var b=r("Z1wJ");Object.defineProperty(e,"GraphicsData",{enumerable:!0,get:function(){return q(b).default}});var w=r("8ZQA");Object.defineProperty(e,"GraphicsRenderer",{enumerable:!0,get:function(){return q(w).default}});var _=r("thfa");Object.defineProperty(e,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return q(_).default}});var S=r("i45y");Object.defineProperty(e,"Spritesheet",{enumerable:!0,get:function(){return q(S).default}});var T=r("qD+0");Object.defineProperty(e,"Texture",{enumerable:!0,get:function(){return q(T).default}});var M=r("nQP+");Object.defineProperty(e,"TextureMatrix",{enumerable:!0,get:function(){return q(M).default}});var A=r("8USZ");Object.defineProperty(e,"BaseTexture",{enumerable:!0,get:function(){return q(A).default}});var E=r("1g9v");Object.defineProperty(e,"RenderTexture",{enumerable:!0,get:function(){return q(E).default}});var C=r("KFrc");Object.defineProperty(e,"BaseRenderTexture",{enumerable:!0,get:function(){return q(C).default}});var P=r("YdyU");Object.defineProperty(e,"VideoBaseTexture",{enumerable:!0,get:function(){return q(P).default}});var O=r("M75x");Object.defineProperty(e,"TextureUvs",{enumerable:!0,get:function(){return q(O).default}});var N=r("vwuV");Object.defineProperty(e,"CanvasRenderTarget",{enumerable:!0,get:function(){return q(N).default}});var L=r("Obmw");Object.defineProperty(e,"Shader",{enumerable:!0,get:function(){return q(L).default}});var I=r("3psj");Object.defineProperty(e,"WebGLManager",{enumerable:!0,get:function(){return q(I).default}});var R=r("MIKO");Object.defineProperty(e,"ObjectRenderer",{enumerable:!0,get:function(){return q(R).default}});var D=r("EoU7");Object.defineProperty(e,"RenderTarget",{enumerable:!0,get:function(){return q(D).default}});var F=r("tl0p");Object.defineProperty(e,"Quad",{enumerable:!0,get:function(){return q(F).default}});var k=r("hScZ");Object.defineProperty(e,"SpriteMaskFilter",{enumerable:!0,get:function(){return q(k).default}});var U=r("bmpC");Object.defineProperty(e,"Filter",{enumerable:!0,get:function(){return q(U).default}});var B=r("5XUO");Object.defineProperty(e,"Application",{enumerable:!0,get:function(){return q(B).default}});var j=r("oUe4");Object.defineProperty(e,"autoDetectRenderer",{enumerable:!0,get:function(){return j.autoDetectRenderer}});var z=X(r("aH6o")),V=X(r("z1Av")),G=q(r("/MUw")),H=q(r("5tzz")),W=q(r("qo3d"));function X(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function q(t){return t&&t.__esModule?t:{default:t}}e.settings=G.default,e.utils=z,e.ticker=V,e.CanvasRenderer=H.default,e.WebGLRenderer=W.default},"/MUw":function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("0Wwa")),i=o(r("Dyrc"));function o(t){return t&&t.__esModule?t:{default:t}}e.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,n.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,i.default)(),MESH_CANVAS_PADDING:0}},"/SMQ":function(t,e,r){"use strict";function n(t){var e=document.createElement("canvas");e.width=6,e.height=1;var r=e.getContext("2d");return r.fillStyle=t,r.fillRect(0,0,6,1),e}e.__esModule=!0,e.default=function(){if("undefined"==typeof document)return!1;var t=n("#ff00ff"),e=n("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var i=r.getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(t,0,0),i.drawImage(e,2,0);var o=i.getImageData(2,0,1,1);if(!o)return!1;var s=o.data;return 255===s[0]&&0===s[1]&&0===s[2]}},"/Zzt":function(t,e,r){"use strict";e.__esModule=!0,e.calculateScreenSpaceMatrix=function(t,e,r){var n=t.identity();return n.translate(e.x/r.width,e.y/r.height),n.scale(r.width,r.height),n},e.calculateNormalizedScreenSpaceMatrix=function(t,e,r){var n=t.identity();return n.translate(e.x/r.width,e.y/r.height),n.scale(r.width/e.width,r.height/e.height),n},e.calculateSpriteMatrix=function(t,e,r,i){var o=i._texture.orig,s=t.set(r.width,0,0,r.height,e.x,e.y),a=i.worldTransform.copy(n.Matrix.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(i.anchor.x,i.anchor.y),s};var n=r("Q5/2")},"/brp":function(t,e){t.exports=function(t,e){var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!r)throw new Error("This browser does not support webGL. Try using the canvas renderer");return r}},0:function(t,e,r){t.exports=r("x35b")},"0Emr":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("3psj")),i=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.stencilMaskStack=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},e.prototype.pushStencil=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var e=this.renderer.gl,r=this.stencilMaskStack.length;0===r&&e.enable(e.STENCIL_TEST),this.stencilMaskStack.push(t),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.EQUAL,r,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.INCR),this.renderer.plugins.graphics.render(t),this._useCurrent()},e.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var t=this.renderer.gl,e=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(0)):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),this.renderer.plugins.graphics.render(e),this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},e.prototype.destroy=function(){n.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},e}(n.default);e.default=i},"0Wwa":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){return n.default.tablet||n.default.phone?4:t};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("Sst2"))},"0yPo":function(t,e,r){"use strict";e.__esModule=!0;var n=p(r("MIKO")),i=p(r("qo3d")),o=p(r("fq6b")),s=p(r("GyJD")),a=p(r("+uzX")),l=p(r("tv36")),c=p(r("/MUw")),u=r("aH6o"),h=p(r("8QNu")),d=p(r("eWjs"));function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=0,v=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));n.vertSize=5,n.vertByteSize=4*n.vertSize,n.size=c.default.SPRITE_BATCH_SIZE,n.buffers=[];for(var i=1;i<=d.default.nextPow2(n.size);i*=2)n.buffers.push(new l.default(4*i*n.vertByteSize));n.indices=(0,o.default)(n.size),n.shader=null,n.currentIndex=0,n.groups=[];for(var s=0;s<n.size;s++)n.groups[s]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return n.sprites=[],n.vertexBuffers=[],n.vaos=[],n.vaoMax=2,n.vertexCount=0,n.renderer.on("prerender",n.onPrerender,n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,a.default)(this.MAX_TEXTURES,t)),this.shader=(0,s.default)(t,this.MAX_TEXTURES),this.indexBuffer=h.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.renderer.bindVao(null);for(var e=this.shader.attributes,r=0;r<this.vaoMax;r++){var n=this.vertexBuffers[r]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),i=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(n,e.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(n,e.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(n,e.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);e.aTextureId&&i.addAttribute(n,e.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[r]=i}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},e.prototype.onPrerender=function(){this.vertexCount=0},e.prototype.render=function(t){this.currentIndex>=this.size&&this.flush(),t._texture._uvs&&(this.sprites[this.currentIndex++]=t)},e.prototype.flush=function(){if(0!==this.currentIndex){var t=this.renderer.gl,e=this.MAX_TEXTURES,r=d.default.nextPow2(this.currentIndex),n=d.default.log2(r),i=this.buffers[n],o=this.sprites,s=this.groups,a=i.float32View,l=i.uint32View,p=this.boundTextures,v=this.renderer.boundTextures,g=this.renderer.textureGC.count,y=0,x=void 0,b=void 0,w=1,_=0,S=s[0],T=void 0,M=void 0,A=u.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha?1:0][o[0].blendMode];S.textureCount=0,S.start=0,S.blend=A,f++;var E=void 0;for(E=0;E<e;++E){var C=v[E];C._enabled!==f?(p[E]=C,C._virtalBoundId=E,C._enabled=f):p[E]=this.renderer.emptyTextures[E]}for(f++,E=0;E<this.currentIndex;++E){var P=o[E];x=P._texture.baseTexture;var O=u.premultiplyBlendMode[Number(x.premultipliedAlpha)][P.blendMode];if(A!==O&&(A=O,b=null,_=e,f++),b!==x&&(b=x,x._enabled!==f)){if(_===e&&(f++,S.size=E-S.start,_=0,(S=s[w++]).blend=A,S.textureCount=0,S.start=E),x.touched=g,-1===x._virtalBoundId)for(var N=0;N<e;++N){var L=(N+m)%e,I=p[L];if(I._enabled!==f){m++,I._virtalBoundId=-1,x._virtalBoundId=L,p[L]=x;break}}x._enabled=f,S.textureCount++,S.ids[_]=x._virtalBoundId,S.textures[_++]=x}if(T=P.vertexData,M=P._texture._uvs.uvsUint32,this.renderer.roundPixels){var R=this.renderer.resolution;a[y]=(T[0]*R|0)/R,a[y+1]=(T[1]*R|0)/R,a[y+5]=(T[2]*R|0)/R,a[y+6]=(T[3]*R|0)/R,a[y+10]=(T[4]*R|0)/R,a[y+11]=(T[5]*R|0)/R,a[y+15]=(T[6]*R|0)/R,a[y+16]=(T[7]*R|0)/R}else a[y]=T[0],a[y+1]=T[1],a[y+5]=T[2],a[y+6]=T[3],a[y+10]=T[4],a[y+11]=T[5],a[y+15]=T[6],a[y+16]=T[7];l[y+2]=M[0],l[y+7]=M[1],l[y+12]=M[2],l[y+17]=M[3];var D=Math.min(P.worldAlpha,1),F=D<1&&x.premultipliedAlpha?(0,u.premultiplyTint)(P._tintRGB,D):P._tintRGB+(255*D<<24);l[y+3]=l[y+8]=l[y+13]=l[y+18]=F,a[y+4]=a[y+9]=a[y+14]=a[y+19]=x._virtalBoundId,y+=20}if(S.size=E-S.start,c.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var k=this.shader.attributes,U=this.vertexBuffers[this.vertexCount]=h.default.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),B=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(U,k.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(U,k.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(U,k.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12);k.aTextureId&&B.addAttribute(U,k.aTextureId,t.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=B}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(i.vertices,0,!1),this.vertexCount++}for(E=0;E<e;++E)v[E]._virtalBoundId=-1;for(E=0;E<w;++E){for(var j=s[E],z=j.textureCount,V=0;V<z;V++)v[j.ids[V]]!==(b=j.textures[V])&&this.renderer.bindTexture(b,j.ids[V],!0),b._virtalBoundId=-1;this.renderer.state.setBlendMode(j.blend),t.drawElements(t.TRIANGLES,6*j.size,t.UNSIGNED_SHORT,6*j.start*2)}this.currentIndex=0}},e.prototype.start=function(){this.renderer.bindShader(this.shader),c.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this.vaoMax;e++)this.vertexBuffers[e]&&this.vertexBuffers[e].destroy(),this.vaos[e]&&this.vaos[e].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var r=0;r<this.buffers.length;++r)this.buffers[r].destroy()},e}(n.default);e.default=v,i.default.registerPlugin("sprite",v)},1:function(t,e){},"13Cv":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){var r=t.name+"_image";if(t.data&&t.type===n.Resource.TYPE.JSON&&t.data.frames&&!this.resources[r]){var i={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},a=s(t,this.baseUrl);this.add(r,a,i,function(r){if(r.error)e(r.error);else{var n=new o.Spritesheet(r.texture.baseTexture,t.data,t.url);n.parse(function(){t.spritesheet=n,t.textures=n.textures,e()})}})}else e()}},e.getResourcePath=s;var n=r("SMx8"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("UZ5h")),o=r("/B0E");function s(t,e){return t.isDataUrl?t.data.meta.image:i.default.resolve(t.url.replace(e,""),t.data.meta.image)}},"1g9v":function(t,e,r){"use strict";e.__esModule=!0;var n=i(r("KFrc"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(t){function e(r,i){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=null;if(!(r instanceof n.default)){var s=arguments[1],a=arguments[2],l=arguments[3],c=arguments[4];console.warn("Please use RenderTexture.create("+s+", "+a+") instead of the ctor directly."),o=arguments[0],i=null,r=new n.default(s,a,l,c)}var u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,i));return u.legacyRenderer=o,u.valid=!0,u._updateUvs(),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e,r){t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,r||this.baseTexture.resize(t,e),this._updateUvs()},e.create=function(t,r,i,o){return new e(new n.default(t,r,i,o))},e}(i(r("qD+0")).default);e.default=o},"1nuA":function(t,e,r){"use strict";e.decode=e.parse=r("kMPS"),e.encode=e.stringify=r("xaZU")},"27Ej":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=new n.Rectangle,o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,r=void 0,o=void 0,s=void 0,a=!1,l=void 0,c=!1;t&&(t instanceof n.RenderTexture?l=t:(l=this.renderer.generateTexture(t),c=!0)),l?(o=(r=l.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=l.frame,a=!1):(o=(r=this.renderer.rootRenderTarget).resolution,a=!0,(s=i).width=r.size.width,s.height=r.size.height);var u=s.width*o,h=s.height*o,d=new n.CanvasRenderTarget(u,h);if(r){e.bindRenderTarget(r);var p=new Uint8Array(4*u*h),f=e.gl;f.readPixels(s.x*o,s.y*o,u,h,f.RGBA,f.UNSIGNED_BYTE,p);var m=d.context.getImageData(0,0,u,h);m.data.set(p),d.context.putImageData(m,0,0),a&&(d.context.scale(1,-1),d.context.drawImage(d.canvas,0,-h))}return c&&l.destroy(!0),d.canvas},t.prototype.pixels=function(t){var e=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0,l=!1;t&&(t instanceof n.RenderTexture?a=t:(a=this.renderer.generateTexture(t),l=!0)),a?(o=(r=a.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=a.frame):(o=(r=this.renderer.rootRenderTarget).resolution,(s=i).width=r.size.width,s.height=r.size.height);var c=s.width*o,u=s.height*o,h=new Uint8Array(4*c*u);if(r){e.bindRenderTarget(r);var d=e.gl;d.readPixels(s.x*o,s.y*o,c,u,d.RGBA,d.UNSIGNED_BYTE,h)}return l&&a.destroy(!0),h},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,n.WebGLRenderer.registerPlugin("extract",o)},"2fqX":function(t,e,r){"use strict";Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1})},"2gBs":function(t,e){t.exports=Object.keys||function(t){var e=[],r=Object.prototype.hasOwnProperty;for(var n in t)r.call(t,n)&&e.push(n);return e}},"2zkT":function(t,e,r){"use strict";var n=r("WFWZ"),i=r("s+UU"),o=r("dMus"),s=r("73T8");class a extends i.a{constructor(t,e,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=o.a;break;case 1:if(!t){this.destination=o.a;break}if("object"==typeof t){if(t instanceof a||"syncErrorThrowable"in t&&t[s.a]){const e=t[s.a]();this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)}else this.syncErrorThrowable=!0,this.destination=new l(this,t);break}default:this.syncErrorThrowable=!0,this.destination=new l(this,t,e,r)}}[s.a](){return this}static create(t,e,r){const n=new a(t,e,r);return n.syncErrorThrowable=!1,n}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parent:t,_parents:e}=this;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this}}e.a=a;class l extends a{constructor(t,e,r,i){let s;super(),this._parentSubscriber=t;let a=this;Object(n.a)(e)?s=e:e&&(s=e.next,r=e.error,i=e.complete,e!==o.a&&(a=Object.create(e),Object(n.a)(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=s,this._error=r,this._complete=i}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(t){throw this.unsubscribe(),t}}__tryOrSetError(t,e,r){try{e.call(this._context,r)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0,!0}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}},"38rC":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=l(r("kFAI")),s=r("aH6o"),a=l(r("/MUw"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return i._textWidth=0,i._textHeight=0,i._glyphs=[],i._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},i.font=n.font,i._text=r,i._maxWidth=0,i._maxLineHeight=0,i._anchor=new o.default(function(){i.dirty=!0},i,0,0),i.dirty=!1,i.updateText(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],r=this._font.size/t.size,n=new i.Point,o=[],s=[],a=null,l=0,c=0,u=0,h=-1,d=0,p=0,f=0,m=0;m<this.text.length;m++){var v=this.text.charCodeAt(m);if(/(\s)/.test(this.text.charAt(m))&&(h=m,d=l),/(?:\r\n|\r|\n)/.test(this.text.charAt(m)))s.push(l),c=Math.max(c,l),u++,n.x=0,n.y+=t.lineHeight,a=null;else if(-1!==h&&this._maxWidth>0&&n.x*r>this._maxWidth)i.utils.removeItems(o,h-p,m-h),m=h,h=-1,++p,s.push(d),c=Math.max(c,d),u++,n.x=0,n.y+=t.lineHeight,a=null;else{var g=t.chars[v];g&&(a&&g.kerning[a]&&(n.x+=g.kerning[a]),o.push({texture:g.texture,line:u,charCode:v,position:new i.Point(n.x+g.xOffset,n.y+g.yOffset)}),l=n.x+(g.texture.width+g.xOffset),n.x+=g.xAdvance,f=Math.max(f,g.yOffset+g.texture.height),a=v)}}s.push(l),c=Math.max(c,l);for(var y=[],x=0;x<=u;x++){var b=0;"right"===this._font.align?b=c-s[x]:"center"===this._font.align&&(b=(c-s[x])/2),y.push(b)}for(var w=o.length,_=this.tint,S=0;S<w;S++){var T=this._glyphs[S];T?T.texture=o[S].texture:(T=new i.Sprite(o[S].texture),this._glyphs.push(T)),T.position.x=(o[S].position.x+y[o[S].line])*r,T.position.y=o[S].position.y*r,T.scale.x=T.scale.y=r,T.tint=_,T.parent||this.addChild(T)}for(var M=w;M<this._glyphs.length;++M)this.removeChild(this._glyphs[M]);if(this._textWidth=c*r,this._textHeight=(n.y+t.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var A=0;A<w;A++)this._glyphs[A].x-=this._textWidth*this.anchor.x,this._glyphs[A].y-=this._textHeight*this.anchor.y;this._maxLineHeight=f*r},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},e.registerFont=function(t,r){var n={},o=t.getElementsByTagName("info")[0],l=t.getElementsByTagName("common")[0],c=t.getElementsByTagName("page")[0].getAttribute("file"),u=(0,s.getResolutionOfUrl)(c,a.default.RESOLUTION);n.font=o.getAttribute("face"),n.size=parseInt(o.getAttribute("size"),10),n.lineHeight=parseInt(l.getAttribute("lineHeight"),10)/u,n.chars={};for(var h=t.getElementsByTagName("char"),d=0;d<h.length;d++){var p=h[d],f=parseInt(p.getAttribute("id"),10),m=new i.Rectangle(parseInt(p.getAttribute("x"),10)/u+r.frame.x/u,parseInt(p.getAttribute("y"),10)/u+r.frame.y/u,parseInt(p.getAttribute("width"),10)/u,parseInt(p.getAttribute("height"),10)/u);n.chars[f]={xOffset:parseInt(p.getAttribute("xoffset"),10)/u,yOffset:parseInt(p.getAttribute("yoffset"),10)/u,xAdvance:parseInt(p.getAttribute("xadvance"),10)/u,kerning:{},texture:new i.Texture(r.baseTexture,m)}}for(var v=t.getElementsByTagName("kerning"),g=0;g<v.length;g++){var y=v[g],x=parseInt(y.getAttribute("first"),10)/u,b=parseInt(y.getAttribute("second"),10)/u,w=parseInt(y.getAttribute("amount"),10)/u;n.chars[b]&&(n.chars[b].kerning[x]=w)}return e.fonts[n.font]=n,n},n(e,[{key:"tint",get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copy(t)}},{key:"font",get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),e}(i.Container);e.default=c,c.fonts={}},"3AVc":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=r("FjAT");r("o/zv");var o=new n.Matrix,s=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.shader=null,n.simpleShader=null,n.quad=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=new n.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new n.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new n.Quad(t,this.renderer.state.attribState),this.quad.initVao(this.shader)},e.prototype.render=function(t){var e=this.renderer,r=this.quad;e.bindVao(r.vao);var s=r.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((s=r.uvs)[0]=s[6]=-t.anchor.x,s[1]=s[3]=-t.anchor.y,s[2]=s[4]=1-t.anchor.x,s[5]=s[7]=1-t.anchor.y),r.upload();var a=t._texture,l=a.baseTexture,c=t.tileTransform.localTransform,u=t.uvTransform,h=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;h&&(l._glTextures[e.CONTEXT_UID]?h=l.wrapMode!==i.WRAP_MODES.CLAMP:l.wrapMode===i.WRAP_MODES.CLAMP&&(l.wrapMode=i.WRAP_MODES.REPEAT));var d=h?this.simpleShader:this.shader;e.bindShader(d);var p=a.width,f=a.height,m=t._width,v=t._height;o.set(c.a*p/m,c.b*p/v,c.c*f/m,c.d*f/v,c.tx/m,c.ty/v),o.invert(),h?o.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=o.toArray(!0),d.uniforms.uColor=n.utils.premultiplyTintToRgba(t.tint,t.worldAlpha,d.uniforms.uColor,l.premultipliedAlpha),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=e.bindTexture(a),e.setBlendMode(n.utils.correctBlendMode(t.blendMode,l.premultipliedAlpha)),r.vao.draw(this.renderer.gl.TRIANGLES,6,0)},e}(n.ObjectRenderer);e.default=s,n.WebGLRenderer.registerPlugin("tilingSprite",s)},"3IRH":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"3JLa":function(t,e){var r={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};t.exports=function(t){return r[t]}},"3Wvr":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=h(r("BzvE")),o=r("FjAT"),s=h(r("/MUw")),a=h(r("qisP")),l=h(r("W1MY")),c=h(r("F+P4")),u=r("Q5/2");function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this)),n=s.default.TRANSFORM_MODE===o.TRANSFORM_MODE.STATIC?a.default:l.default;return r.tempDisplayObjectParent=null,r.transform=new n,r.alpha=1,r.visible=!0,r.renderable=!0,r.parent=null,r.worldAlpha=1,r.filterArea=null,r._filters=null,r._enabledFilters=null,r._bounds=new c.default,r._boundsID=0,r._lastBoundsID=-1,r._boundsRect=null,r._localBoundsRect=null,r._mask=null,r._destroyed=!1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new u.Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new u.Rectangle),t=this._localBoundsRect);var n=this.getBounds(!1,t);return this.parent=r,this.transform=e,n},e.prototype.toGlobal=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.renderWebGL=function(t){},e.prototype.renderCanvas=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.position.y=t,this.scale.x=e||1,this.scale.y=r||1,this.rotation=n,this.skew.x=i,this.skew.y=o,this.pivot.x=s,this.pivot.y=a,this},e.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n(e,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(t){this.transform.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.transform.position.y=t}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(t){this.transform.position.copy(t)}},{key:"scale",get:function(){return this.transform.scale},set:function(t){this.transform.scale.copy(t)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copy(t)}},{key:"skew",get:function(){return this.transform.skew},set:function(t){this.transform.skew.copy(t)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t}},{key:"worldVisible",get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}]),e}(i.default);e.default=d,d.prototype.displayObjectUpdateTransform=d.prototype.updateTransform},"3psj":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.renderer.on("context",this.onContextChange,this)}return t.prototype.onContextChange=function(){},t.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},t}();e.default=n},"48oy":function(t,e,r){"use strict";(function(t){r.d(e,"g",function(){return Le}),r.d(e,"Q",function(){return Me}),r.d(e,"T",function(){return Ae}),r.d(e,"P",function(){return Ce}),r.d(e,"w",function(){return Ee}),r.d(e,"c",function(){return Bt}),r.d(e,"A",function(){return Vt}),r.d(e,"z",function(){return Gt}),r.d(e,"b",function(){return Ht}),r.d(e,"d",function(){return kt}),r.d(e,"e",function(){return Ut}),r.d(e,"S",function(){return $e}),r.d(e,"K",function(){return ge}),r.d(e,"V",function(){return xe}),r.d(e,"s",function(){return gr}),r.d(e,"f",function(){return wr}),r.d(e,"m",function(){return ce}),r.d(e,"l",function(){return lt}),r.d(e,"E",function(){return Sr}),r.d(e,"F",function(){return _r}),r.d(e,"a",function(){return v}),r.d(e,"N",function(){return x}),r.d(e,"L",function(){return b}),r.d(e,"R",function(){return D}),r.d(e,"p",function(){return j}),r.d(e,"o",function(){return l}),r.d(e,"n",function(){return _}),r.d(e,"y",function(){return S}),r.d(e,"G",function(){return M}),r.d(e,"x",function(){return ue}),r.d(e,"B",function(){return Fe}),r.d(e,"C",function(){return Re}),r.d(e,"D",function(){return De}),r.d(e,"i",function(){return qt}),r.d(e,"j",function(){return $t}),r.d(e,"k",function(){return ke}),r.d(e,"t",function(){return ne}),r.d(e,"v",function(){return re}),r.d(e,"u",function(){return Ue}),r.d(e,"H",function(){return He}),r.d(e,"I",function(){return Ve}),r.d(e,"J",function(){return Xe}),r.d(e,"M",function(){return qe}),r.d(e,"h",function(){return Ye}),r.d(e,"q",function(){return ur}),r.d(e,"r",function(){return hr}),r.d(e,"O",function(){return rr}),r.d(e,"U",function(){return vr}),r.d(e,"_7",function(){return ir}),r.d(e,"X",function(){return Wt}),r.d(e,"W",function(){return te}),r.d(e,"_4",function(){return C}),r.d(e,"_10",function(){return I}),r.d(e,"_19",function(){return R}),r.d(e,"_8",function(){return Ft}),r.d(e,"_9",function(){return Dt}),r.d(e,"Y",function(){return gn}),r.d(e,"Z",function(){return Fn}),r.d(e,"_0",function(){return ko}),r.d(e,"_1",function(){return jr}),r.d(e,"_2",function(){return oi}),r.d(e,"_3",function(){return yn}),r.d(e,"_6",function(){return mn}),r.d(e,"_11",function(){return En}),r.d(e,"_12",function(){return An}),r.d(e,"_14",function(){return qn}),r.d(e,"_16",function(){return Mi}),r.d(e,"_18",function(){return xi}),r.d(e,"_20",function(){return Ai}),r.d(e,"_21",function(){return Pi}),r.d(e,"_13",function(){return yr}),r.d(e,"_15",function(){return xr}),r.d(e,"_17",function(){return br}),r.d(e,"_5",function(){return jt});var n=r("ves3"),i=r("Qi5R"),o=r("LiEr"),s=r("W/Sc"),a=r("s+UU");class l{constructor(t){this._desc=t,this.ngMetadataName="InjectionToken"}toString(){return`InjectionToken ${this._desc}`}}const c="__annotations__",u="__paramaters__",h="__prop__metadata__";function d(t,e,r,n){const i=p(e);function o(t){if(this instanceof o)return i.call(this,t),this;const e=new o(t),r=function(t){return(t.hasOwnProperty(c)?t[c]:Object.defineProperty(t,c,{value:[]})[c]).push(e),t};return n&&n(r),r}return r&&(o.prototype=Object.create(r.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o}function p(t){return function(...e){if(t){const r=t(...e);for(const t in r)this[t]=r[t]}}}function f(t,e,r){const n=p(e);function i(...t){if(this instanceof i)return n.apply(this,t),this;const e=new i(...t);return r.annotation=e,r;function r(t,r,n){const i=t.hasOwnProperty(u)?t[u]:Object.defineProperty(t,u,{value:[]})[u];for(;i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(e),t}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}function m(t,e,r){const n=p(e);function i(...t){if(this instanceof i)return n.apply(this,t),this;const e=new i(...t);return function(t,r){const n=t.constructor,i=n.hasOwnProperty(h)?n[h]:Object.defineProperty(n,h,{value:{}})[h];i[r]=i.hasOwnProperty(r)&&i[r]||[],i[r].unshift(e)}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}const v=new l("AnalyzeForEntryComponents");f("Attribute",t=>({attributeName:t}));class g{}m("ContentChildren",(t,e={})=>Object.assign({selector:t,first:!1,isViewQuery:!1,descendants:!1},e),g),m("ContentChild",(t,e={})=>Object.assign({selector:t,first:!0,isViewQuery:!1,descendants:!0},e),g),m("ViewChildren",(t,e={})=>Object.assign({selector:t,first:!1,isViewQuery:!0,descendants:!0},e),g),m("ViewChild",(t,e)=>Object.assign({selector:t,first:!0,isViewQuery:!0,descendants:!0},e),g);const y=function(){var t={OnPush:0,Default:1};return t[t.OnPush]="OnPush",t[t.Default]="Default",t}();d("Component",(t={})=>Object.assign({changeDetection:y.Default},t),d("Directive",(t={})=>t)),d("Pipe",t=>Object.assign({pure:!0},t)),m("Input",t=>({bindingPropertyName:t})),m("Output",t=>({bindingPropertyName:t})),m("HostBinding",t=>({hostPropertyName:t})),m("HostListener",(t,e)=>({eventName:t,args:e})),d("NgModule",t=>t);const x=function(){var t={Emulated:0,Native:1,None:2};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t}();class b{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const w=new b("5.2.9"),_=f("Inject",t=>({token:t})),S=f("Optional"),T=(d("Injectable"),f("Self")),M=f("SkipSelf"),A=(f("Host"),"undefined"!=typeof window&&window),E="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,C=A||"undefined"!=typeof t&&t||E,P=Promise.resolve(0);let O=null;function N(){if(!O){const t=C.Symbol;if(t&&t.iterator)O=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const r=t[e];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(O=r)}}}return O}function L(t){"undefined"==typeof Zone?P.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function I(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function R(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(R).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const r=e.indexOf("\n");return-1===r?e:e.substring(0,r)}function D(t){return t.__forward_ref__=D,t.toString=function(){return R(this())},t}function F(t){return"function"==typeof t&&t.hasOwnProperty("__forward_ref__")&&t.__forward_ref__===D?t():t}const k="__source",U=new Object,B=U;class j{static create(t,e){return Array.isArray(t)?new K(t,e):new K(t.providers,t.parent,t.name||null)}}j.THROW_IF_NOT_FOUND=U,j.NULL=new class{get(t,e=U){if(e===U)throw new Error(`NullInjectorError: No provider for ${R(t)}!`);return e}};const z=function(t){return t},V=[],G=z,H=function(){return Array.prototype.slice.call(arguments)},W={},X=function(t){for(let e in t)if(t[e]===W)return e;throw Error("!prop")}({provide:String,useValue:W}),q="ngTokenPath",Y="ngTempTokenPath",Z=j.NULL,J=/\n/gm,Q="\u0275";class K{constructor(t,e=Z,r=null){this.parent=e,this.source=r;const n=this._records=new Map;n.set(j,{token:j,fn:z,deps:V,value:this,useNew:!1}),function t(e,r){if(r)if((r=F(r))instanceof Array)for(let n=0;n<r.length;n++)t(e,r[n]);else{if("function"==typeof r)throw et("Function/Class not supported",r);if(!r||"object"!=typeof r||!r.provide)throw et("Unexpected provider",r);{let t=F(r.provide);const n=function(t){const e=function(t){let e=V;const r=t.deps;if(r&&r.length){e=[];for(let t=0;t<r.length;t++){let n=6,i=F(r[t]);if(i instanceof Array)for(let t=0,e=i;t<e.length;t++){const r=e[t];r instanceof S||r==S?n|=1:r instanceof M||r==M?n&=-3:r instanceof T||r==T?n&=-5:i=r instanceof _?r.token:F(r)}e.push({token:i,options:n})}}else if(t.useExisting)e=[{token:F(t.useExisting),options:6}];else if(!(r||X in t))throw et("'deps' required",t);return e}(t);let r=z,n=V,i=!1,o=F(t.provide);if(X in t)n=t.useValue;else if(t.useFactory)r=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,r=F(t.useClass);else{if("function"!=typeof o)throw et("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,r=o}return{deps:e,fn:r,useNew:i,value:n}}(r);if(!0===r.multi){let n=e.get(t);if(n){if(n.fn!==H)throw $(t)}else e.set(t,n={token:r.provide,deps:[],useNew:!1,fn:H,value:V});n.deps.push({token:t=r,options:6})}const i=e.get(t);if(i&&i.fn==H)throw $(t);e.set(t,n)}}}(n,t)}get(t,e){const r=this._records.get(t);try{return function t(e,r,n,i,o){try{return function(e,r,n,i,o){let s;if(r){if((s=r.value)==G)throw Error(Q+"Circular dependency");if(s===V){r.value=G;let e=void 0,o=r.useNew,a=r.fn,l=r.deps,c=V;if(l.length){c=[];for(let e=0;e<l.length;e++){const r=l[e],o=r.options,s=2&o?n.get(r.token):void 0;c.push(t(r.token,s,n,s||4&o?i:Z,1&o?null:j.THROW_IF_NOT_FOUND))}}r.value=s=o?new a(...c):a.apply(e,c)}}else s=i.get(e,o);return s}(e,r,n,i,o)}catch(t){throw t instanceof Error||(t=new Error(t)),(t[Y]=t[Y]||[]).unshift(e),r&&r.value==G&&(r.value=V),t}}(t,r,this._records,this.parent,e)}catch(e){const r=e[Y];throw t[k]&&r.unshift(t[k]),e.message=tt("\n"+e.message,r,this.source),e[q]=r,e[Y]=null,e}}toString(){const t=[];return this._records.forEach((e,r)=>t.push(R(r))),`StaticInjector[${t.join(", ")}]`}}function $(t){return et("Cannot mix multi providers and regular providers",t)}function tt(t,e,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==Q?t.substr(2):t;let n=R(e);if(e instanceof Array)n=e.map(R).join(" -> ");else if("object"==typeof e){let t=[];for(let r in e)if(e.hasOwnProperty(r)){let n=e[r];t.push(r+":"+("string"==typeof n?JSON.stringify(n):R(n)))}n=`{${t.join(", ")}}`}return`StaticInjectorError${r?"("+r+")":""}[${n}]: ${t.replace(J,"\n  ")}`}function et(t,e){return new Error(tt(t,e))}const rt="ngDebugContext",nt="ngOriginalError",it="ngErrorLogger";function ot(t){return t[rt]}function st(t){return t[nt]}function at(t,...e){t.error(...e)}class lt{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),r=this._findContext(t),n=function(t){return t[it]||at}(t);n(this._console,"ERROR",t),e&&n(this._console,"ORIGINAL ERROR",e),r&&n(this._console,"ERROR CONTEXT",r)}_findContext(t){return t?ot(t)?ot(t):this._findContext(st(t)):null}_findOriginalError(t){let e=st(t);for(;e&&st(e);)e=st(e);return e}}function ct(t){return t.length>1?" ("+function(t){const e=[];for(let r=0;r<t.length;++r){if(e.indexOf(t[r])>-1)return e.push(t[r]),e;e.push(t[r])}return e}(t.slice().reverse()).map(t=>R(t.token)).join(" -> ")+")":""}function ut(t,e,r,n){const i=[e],o=r(i),s=n?function(t,e){const r=`${o} caused by: ${e instanceof Error?e.message:e}`,n=Error(r);return n[nt]=e,n}(0,n):Error(o);return s.addKey=ht,s.keys=i,s.injectors=[t],s.constructResolvingMessage=r,s[nt]=n,s}function ht(t,e){this.injectors.push(t),this.keys.push(e),this.message=this.constructResolvingMessage(this.keys)}function dt(t,e){const r=[];for(let n=0,i=e.length;n<i;n++){const t=e[n];r.push(t&&0!=t.length?t.map(R).join(" "):"?")}return Error("Cannot resolve all parameters for '"+R(t)+"'("+r.join(", ")+"). Make sure that all the parameters are decorated with Inject or have valid type annotations and that '"+R(t)+"' is decorated with Injectable.")}function pt(t,e){return Error(`Cannot mix multi providers and regular providers, got: ${t} ${e}`)}class ft{constructor(t,e){if(this.token=t,this.id=e,!t)throw new Error("Token must be defined!");this.displayName=R(this.token)}static get(t){return mt.get(F(t))}static get numberOfKeys(){return mt.numberOfKeys}}const mt=new class{constructor(){this._allKeys=new Map}get(t){if(t instanceof ft)return t;if(this._allKeys.has(t))return this._allKeys.get(t);const e=new ft(t,ft.numberOfKeys);return this._allKeys.set(t,e),e}get numberOfKeys(){return this._allKeys.size}},vt=Function;function gt(t){return"function"==typeof t}const yt=/^function\s+\S+\(\)\s*{[\s\S]+\.apply\(this,\s*arguments\)/,xt=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{/,bt=/^class\s+[A-Za-z\d$_]*\s*extends\s+[A-Za-z\d$_]+\s*{[\s\S]*constructor\s*\(/;function wt(t){return t?t.map(t=>new(0,t.type.annotationCls)(...t.args?t.args:[])):[]}function _t(t){const e=t.prototype?Object.getPrototypeOf(t.prototype):null;return(e?e.constructor:null)||Object}const St=new class{constructor(t){this.reflectionCapabilities=t}updateCapabilities(t){this.reflectionCapabilities=t}factory(t){return this.reflectionCapabilities.factory(t)}parameters(t){return this.reflectionCapabilities.parameters(t)}annotations(t){return this.reflectionCapabilities.annotations(t)}propMetadata(t){return this.reflectionCapabilities.propMetadata(t)}hasLifecycleHook(t,e){return this.reflectionCapabilities.hasLifecycleHook(t,e)}getter(t){return this.reflectionCapabilities.getter(t)}setter(t){return this.reflectionCapabilities.setter(t)}method(t){return this.reflectionCapabilities.method(t)}importUri(t){return this.reflectionCapabilities.importUri(t)}resourceUri(t){return this.reflectionCapabilities.resourceUri(t)}resolveIdentifier(t,e,r,n){return this.reflectionCapabilities.resolveIdentifier(t,e,r,n)}resolveEnum(t,e){return this.reflectionCapabilities.resolveEnum(t,e)}}(new class{constructor(t){this._reflect=t||C.Reflect}isReflectionEnabled(){return!0}factory(t){return(...e)=>new t(...e)}_zipTypesAndAnnotations(t,e){let r;r="undefined"==typeof t?new Array(e.length):new Array(t.length);for(let n=0;n<r.length;n++)r[n]="undefined"==typeof t?[]:t[n]!=Object?[t[n]]:[],e&&null!=e[n]&&(r[n]=r[n].concat(e[n]));return r}_ownParameters(t,e){const r=t.toString();if(yt.exec(r)||xt.exec(r)&&!bt.exec(r))return null;if(t.parameters&&t.parameters!==e.parameters)return t.parameters;const n=t.ctorParameters;if(n&&n!==e.ctorParameters){const t="function"==typeof n?n():n,e=t.map(t=>t&&t.type),r=t.map(t=>t&&wt(t.decorators));return this._zipTypesAndAnnotations(e,r)}const i=t.hasOwnProperty(u)&&t[u],o=this._reflect&&this._reflect.getOwnMetadata&&this._reflect.getOwnMetadata("design:paramtypes",t);return o||i?this._zipTypesAndAnnotations(o,i):new Array(t.length).fill(void 0)}parameters(t){if(!gt(t))return[];const e=_t(t);let r=this._ownParameters(t,e);return r||e===Object||(r=this.parameters(e)),r||[]}_ownAnnotations(t,e){if(t.annotations&&t.annotations!==e.annotations){let e=t.annotations;return"function"==typeof e&&e.annotations&&(e=e.annotations),e}return t.decorators&&t.decorators!==e.decorators?wt(t.decorators):t.hasOwnProperty(c)?t[c]:null}annotations(t){if(!gt(t))return[];const e=_t(t),r=this._ownAnnotations(t,e)||[];return(e!==Object?this.annotations(e):[]).concat(r)}_ownPropMetadata(t,e){if(t.propMetadata&&t.propMetadata!==e.propMetadata){let e=t.propMetadata;return"function"==typeof e&&e.propMetadata&&(e=e.propMetadata),e}if(t.propDecorators&&t.propDecorators!==e.propDecorators){const e=t.propDecorators,r={};return Object.keys(e).forEach(t=>{r[t]=wt(e[t])}),r}return t.hasOwnProperty(h)?t[h]:null}propMetadata(t){if(!gt(t))return{};const e=_t(t),r={};if(e!==Object){const t=this.propMetadata(e);Object.keys(t).forEach(e=>{r[e]=t[e]})}const n=this._ownPropMetadata(t,e);return n&&Object.keys(n).forEach(t=>{const e=[];r.hasOwnProperty(t)&&e.push(...r[t]),e.push(...n[t]),r[t]=e}),r}hasLifecycleHook(t,e){return t instanceof vt&&e in t.prototype}guards(t){return{}}getter(t){return new Function("o","return o."+t+";")}setter(t){return new Function("o","v","return o."+t+" = v;")}method(t){const e=`if (!o.${t}) throw new Error('"${t}" is undefined');\n        return o.${t}.apply(o, args);`;return new Function("o","args",e)}importUri(t){return"object"==typeof t&&t.filePath?t.filePath:`./${R(t)}`}resourceUri(t){return`./${R(t)}`}resolveIdentifier(t,e,r,n){return n}resolveEnum(t,e){return t[e]}});class Tt{constructor(t,e,r){this.key=t,this.optional=e,this.visibility=r}static fromKey(t){return new Tt(t,!1,null)}}const Mt=[];class At{constructor(t,e,r){this.key=t,this.resolvedFactories=e,this.multiProvider=r,this.resolvedFactory=this.resolvedFactories[0]}}class Et{constructor(t,e){this.factory=t,this.dependencies=e}}function Ct(t){return new At(ft.get(t.provide),[function(t){let e,r;if(t.useClass){const n=F(t.useClass);e=St.factory(n),r=Pt(n)}else t.useExisting?(e=(t=>t),r=[Tt.fromKey(ft.get(t.useExisting))]):t.useFactory?(e=t.useFactory,r=function(t,e){if(e){const r=e.map(t=>[t]);return e.map(e=>Ot(t,e,r))}return Pt(t)}(t.useFactory,t.deps)):(e=(()=>t.useValue),r=Mt);return new Et(e,r)}(t)],t.multi||!1)}function Pt(t){const e=St.parameters(t);if(!e)return[];if(e.some(t=>null==t))throw dt(t,e);return e.map(r=>Ot(t,r,e))}function Ot(t,e,r){let n=null,i=!1;if(!Array.isArray(e))return Nt(e instanceof _?e.token:e,i,null);let o=null;for(let s=0;s<e.length;++s){const t=e[s];t instanceof vt?n=t:t instanceof _?n=t.token:t instanceof S?i=!0:t instanceof T||t instanceof M?o=t:t instanceof l&&(n=t)}if(null!=(n=F(n)))return Nt(n,i,o);throw dt(t,r)}function Nt(t,e,r){return new Tt(ft.get(t),e,r)}const Lt=new Object;class It{static resolve(t){return function(t){const e=function(t,e){for(let r=0;r<t.length;r++){const n=t[r],i=e.get(n.key.id);if(i){if(n.multiProvider!==i.multiProvider)throw pt(i,n);if(n.multiProvider)for(let t=0;t<n.resolvedFactories.length;t++)i.resolvedFactories.push(n.resolvedFactories[t]);else e.set(n.key.id,n)}else{let t;t=n.multiProvider?new At(n.key,n.resolvedFactories.slice(),n.multiProvider):n,e.set(n.key.id,t)}}return e}(function t(e,r){return e.forEach(e=>{if(e instanceof vt)r.push({provide:e,useClass:e});else if(e&&"object"==typeof e&&void 0!==e.provide)r.push(e);else{if(!(e instanceof Array))throw Error(`Invalid provider - only instances of Provider and Type are allowed, got: ${e}`);t(e,r)}}),r}(t,[]).map(Ct),new Map);return Array.from(e.values())}(t)}static resolveAndCreate(t,e){const r=It.resolve(t);return It.fromResolvedProviders(r,e)}static fromResolvedProviders(t,e){return new Rt(t,e)}}class Rt{constructor(t,e){this._constructionCounter=0,this._providers=t,this.parent=e||null;const r=t.length;this.keyIds=new Array(r),this.objs=new Array(r);for(let n=0;n<r;n++)this.keyIds[n]=t[n].key.id,this.objs[n]=Lt}get(t,e=B){return this._getByKey(ft.get(t),null,e)}resolveAndCreateChild(t){const e=It.resolve(t);return this.createChildFromResolved(e)}createChildFromResolved(t){const e=new Rt(t);return e.parent=this,e}resolveAndInstantiate(t){return this.instantiateResolved(It.resolve([t])[0])}instantiateResolved(t){return this._instantiateProvider(t)}getProviderAtIndex(t){if(t<0||t>=this._providers.length)throw function(t){return Error(`Index ${t} is out-of-bounds.`)}(t);return this._providers[t]}_new(t){if(this._constructionCounter++>this._getMaxNumberOfObjects())throw function(e,r){return ut(e,t.key,function(t){return`Cannot instantiate cyclic dependency!${ct(t)}`})}(this);return this._instantiateProvider(t)}_getMaxNumberOfObjects(){return this.objs.length}_instantiateProvider(t){if(t.multiProvider){const e=new Array(t.resolvedFactories.length);for(let r=0;r<t.resolvedFactories.length;++r)e[r]=this._instantiate(t,t.resolvedFactories[r]);return e}return this._instantiate(t,t.resolvedFactories[0])}_instantiate(t,e){const r=e.factory;let n,i;try{n=e.dependencies.map(t=>this._getByReflectiveDependency(t))}catch(e){throw e.addKey&&e.addKey(this,t.key),e}try{i=r(...n)}catch(e){throw function(e,r,n,i){return ut(e,t.key,function(t){const e=R(t[0].token);return`${r.message}: Error during instantiation of ${e}!${ct(t)}.`},r)}(this,e)}return i}_getByReflectiveDependency(t){return this._getByKey(t.key,t.visibility,t.optional?null:B)}_getByKey(t,e,r){return t===Rt.INJECTOR_KEY?this:e instanceof T?this._getByKeySelf(t,r):this._getByKeyDefault(t,r,e)}_getObjByKeyId(t){for(let e=0;e<this.keyIds.length;e++)if(this.keyIds[e]===t)return this.objs[e]===Lt&&(this.objs[e]=this._new(this._providers[e])),this.objs[e];return Lt}_throwOrNull(t,e){if(e!==B)return e;throw function(t,e){return ut(t,e,function(t){return`No provider for ${R(t[0].token)}!${ct(t)}`})}(this,t)}_getByKeySelf(t,e){const r=this._getObjByKeyId(t.id);return r!==Lt?r:this._throwOrNull(t,e)}_getByKeyDefault(t,e,r){let n;for(n=r instanceof M?this.parent:this;n instanceof Rt;){const e=n,r=e._getObjByKeyId(t.id);if(r!==Lt)return r;n=e.parent}return null!==n?n.get(t.token,e):this._throwOrNull(t,e)}get displayName(){return`ReflectiveInjector(providers: [${function(t,e){const r=new Array(t._providers.length);for(let n=0;n<t._providers.length;++n)r[n]=e(t.getProviderAtIndex(n));return r}(this,t=>' "'+t.key.displayName+'" ').join(", ")}])`}toString(){return this.displayName}}function Dt(t){return!!t&&"function"==typeof t.then}function Ft(t){return!!t&&"function"==typeof t.subscribe}Rt.INJECTOR_KEY=ft.get(j);const kt=new l("Application Initializer");class Ut{constructor(t){this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const e=this.appInits[r]();Dt(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}const Bt=new l("AppId");function jt(){return`${zt()}${zt()}${zt()}`}function zt(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Vt=new l("Platform Initializer"),Gt=new l("Platform ID"),Ht=new l("appBootstrapListener");new l("Application Packages Root URL");class Wt{log(t){console.log(t)}warn(t){console.warn(t)}}function Xt(){throw new Error("Runtime compiler is not loaded")}Wt.ctorParameters=(()=>[]);class qt{compileModuleSync(t){throw Xt()}compileModuleAsync(t){throw Xt()}compileModuleAndAllComponentsSync(t){throw Xt()}compileModuleAndAllComponentsAsync(t){throw Xt()}clearCache(){}clearCacheFor(t){}}new l("compilerOptions");class Yt{}class Zt{}class Jt{}function Qt(t){const e=Error(`No component factory found for ${R(t)}. Did you add it to @NgModule.entryComponents?`);return e[Kt]=t,e}const Kt="ngComponent";class $t{}$t.NULL=new class{resolveComponentFactory(t){throw Qt(t)}};class te{constructor(t,e,r){this._parent=e,this._ngModule=r,this._factories=new Map;for(let n=0;n<t.length;n++){const e=t[n];this._factories.set(e.componentType,e)}}resolveComponentFactory(t){let e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Qt(t);return new ee(e,this._ngModule)}}class ee extends Jt{constructor(t,e){super(),this.factory=t,this.ngModule=e,this.selector=t.selector,this.componentType=t.componentType,this.ngContentSelectors=t.ngContentSelectors,this.inputs=t.inputs,this.outputs=t.outputs}create(t,e,r,n){return this.factory.create(t,e,r,n||this.ngModule)}}class re{}class ne{}let ie,oe;const se=function(){const t=C.wtf;return!(!t||!(ie=t.trace)||(oe=ie.events,0))}(),ae=se?function(t,e=null){return oe.createScope(t,e)}:(t,e)=>(function(t,e){return null}),le=se?function(t,e){return ie.leaveScope(t,e),e}:(t,e)=>e;class ce extends s.b{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,r){let n,i=t=>null,o=()=>null;t&&"object"==typeof t?(n=this.__isAsync?e=>{setTimeout(()=>t.next(e))}:e=>{t.next(e)},t.error&&(i=this.__isAsync?e=>{setTimeout(()=>t.error(e))}:e=>{t.error(e)}),t.complete&&(o=this.__isAsync?()=>{setTimeout(()=>t.complete())}:()=>{t.complete()})):(n=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)},e&&(i=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)}),r&&(o=this.__isAsync?()=>{setTimeout(()=>r())}:()=>{r()}));const s=super.subscribe(n,i,o);return t instanceof a.a&&t.add(s),s}}class ue{constructor({enableLongStackTrace:t=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ce(!1),this.onMicrotaskEmpty=new ce(!1),this.onStable=new ce(!1),this.onError=new ce(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),function(t){t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,n,i,o,s)=>{try{return fe(t),e.invokeTask(n,i,o,s)}finally{me(t)}},onInvoke:(e,r,n,i,o,s,a)=>{try{return fe(t),e.invoke(n,i,o,s,a)}finally{me(t)}},onHasTask:(e,r,n,i)=>{e.hasTask(n,i),r===n&&("microTask"==i.change?(t.hasPendingMicrotasks=i.microTask,pe(t)):"macroTask"==i.change&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,n,i)=>(e.handleError(n,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}(this)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ue.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ue.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,n){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+n,t,de,he,he);try{return i.runTask(o,e,r)}finally{i.cancelTask(o)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}}function he(){}const de={};function pe(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function fe(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function me(t){t._nesting--,pe(t)}class ve{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ce,this.onMicrotaskEmpty=new ce,this.onStable=new ce,this.onError=new ce}run(t){return t()}runGuarded(t){return t()}runOutsideAngular(t){return t()}runTask(t){return t()}}class ge{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this._watchAngularEvents()}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ue.assertNotInAngularZone(),L(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0==this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){this.isStable()?L(()=>{for(;0!==this._callbacks.length;)this._callbacks.pop()(this._didWork);this._didWork=!1}):this._didWork=!0}whenStable(t){this._callbacks.push(t),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,r){return[]}}class ye{constructor(){this._applications=new Map,we.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return we.findTestabilityInTree(this,t,e)}}function xe(t){we=t}ye.ctorParameters=(()=>[]);let be,we=new class{addToWindow(t){}findTestabilityInTree(t,e,r){return null}},_e=!0,Se=!1;const Te=new l("AllowMultipleToken");function Me(){if(Se)throw new Error("Cannot enable prod mode after platform setup.");_e=!1}function Ae(){return Se=!0,_e}class Ee{constructor(t,e){this.name=t,this.token=e}}function Ce(t,e,r=[]){const n=`Platform: ${e}`,i=new l(n);return(e=[])=>{let o=Pe();if(!o||o.injector.get(Te,!1))if(t)t(r.concat(e).concat({provide:i,useValue:!0}));else{const t=r.concat(e).concat({provide:i,useValue:!0});!function(t){if(be&&!be.destroyed&&!be.injector.get(Te,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");be=t.get(Oe);const e=t.get(Vt,null);e&&e.forEach(t=>t())}(j.create({providers:t,name:n}))}return function(t){const e=Pe();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function Pe(){return be&&!be.destroyed?be:null}class Oe{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const r=function(t){return"noop"===t?new ve:("zone.js"===t?void 0:t)||new ue({enableLongStackTrace:Ae()})}(e?e.ngZone:void 0),n=[{provide:ue,useValue:r}];return r.run(()=>{const e=j.create({providers:n,parent:this.injector,name:t.moduleType.name}),i=t.create(e),o=i.injector.get(lt,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>Ie(this._modules,i)),r.runOutsideAngular(()=>r.onError.subscribe({next:t=>{o.handleError(t)}})),function(t,e,r){try{const n=r();return Dt(n)?n.catch(r=>{throw e.runOutsideAngular(()=>t.handleError(r)),r}):n}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(o,r,()=>{const t=i.injector.get(Ut);return t.runInitializers(),t.donePromise.then(()=>(this._moduleDoBootstrap(i),i))})})}bootstrapModule(t,e=[]){const r=this.injector.get(Yt),n=Ne({},e);return r.createCompiler([n]).compileModuleAsync(t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){const e=t.injector.get(Le);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${R(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. `+"Please define one of these.");t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}function Ne(t,e){return Array.isArray(e)?e.reduce(Ne,t):Object.assign({},t,e)}class Le{constructor(t,e,r,s,a,l){this._zone=t,this._console=e,this._injector=r,this._exceptionHandler=s,this._componentFactoryResolver=a,this._initStatus=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Ae(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const c=new n.a(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),u=new n.a(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{ue.assertNotInAngularZone(),L(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const r=this._zone.onUnstable.subscribe(()=>{ue.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),r.unsubscribe()}});this.isStable=Object(i.a)(c,o.a.call(u))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let r;r=t instanceof Jt?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(r.componentType);const n=r instanceof ee?null:this._injector.get(re),i=r.create(j.NULL,[],e||r.selector,n);i.onDestroy(()=>{this._unloadComponent(i)});const o=i.injector.get(ge,null);return o&&i.injector.get(ye).registerApplication(i.location.nativeElement,o),this._loadComponent(i),Ae()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");const t=Le._tickScope();try{this._runningTick=!0,this._views.forEach(t=>t.detectChanges()),this._enforceNoNewChanges&&this._views.forEach(t=>t.checkNoChanges())}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1,le(t)}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;Ie(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Ht,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}_unloadComponent(t){this.detachView(t.hostView),Ie(this.components,t)}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy())}get viewCount(){return this._views.length}}function Ie(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}Le._tickScope=ae("ApplicationRef#tick()"),new l("Renderer2Interceptor");class Re{}const De=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}();class Fe{}class ke{constructor(t){this.nativeElement=t}}class Ue{}new Map;class Be{constructor(){this.dirty=!0,this._results=[],this.changes=new ce,this.length=0}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}[N()](){return this._results[N()]()}toString(){return this._results.toString()}reset(t){this._results=function t(e){return e.reduce((e,r)=>{const n=Array.isArray(r)?t(r):r;return e.concat(n)},[])}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}const je="#",ze="NgFactory";class Ve{}const Ge={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};class He{constructor(t,e){this._compiler=t,this._config=e||Ge}load(t){return this._compiler instanceof qt?this.loadFactory(t):this.loadAndCompile(t)}loadAndCompile(t){let[e,n]=t.split(je);return void 0===n&&(n="default"),r("Jnfr")(e).then(t=>t[n]).then(t=>We(t,e,n)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,n]=t.split(je),i=ze;return void 0===n&&(n="default",i=""),r("Jnfr")(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[n+i]).then(t=>We(t,e,n))}}function We(t,e,r){if(!t)throw new Error(`Cannot find '${r}' in '${e}'`);return t}class Xe{}class qe{}class Ye{}class Ze{constructor(t,e){this.name=t,this.callback=e}}class Je{constructor(t,e,r){this._debugContext=r,this.nativeNode=t,e&&e instanceof Qe?e.addChild(this):this.parent=null,this.listeners=[]}get injector(){return this._debugContext.injector}get componentInstance(){return this._debugContext.component}get context(){return this._debugContext.context}get references(){return this._debugContext.references}get providerTokens(){return this._debugContext.providerTokens}}class Qe extends Je{constructor(t,e,r){super(t,e,r),this.properties={},this.attributes={},this.classes={},this.styles={},this.childNodes=[],this.nativeElement=t}addChild(t){t&&(this.childNodes.push(t),t.parent=this)}removeChild(t){const e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))}insertChildrenAfter(t,e){const r=this.childNodes.indexOf(t);-1!==r&&(this.childNodes.splice(r+1,0,...e),e.forEach(t=>{t.parent&&t.parent.removeChild(t),t.parent=this}))}insertBefore(t,e){const r=this.childNodes.indexOf(t);-1===r?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(r,0,e))}query(t){return this.queryAll(t)[0]||null}queryAll(t){const e=[];return function t(e,r,n){e.childNodes.forEach(e=>{e instanceof Qe&&(r(e)&&n.push(e),t(e,r,n))})}(this,t,e),e}queryAllNodes(t){const e=[];return function t(e,r,n){e instanceof Qe&&e.childNodes.forEach(e=>{r(e)&&n.push(e),e instanceof Qe&&t(e,r,n)})}(this,t,e),e}get children(){return this.childNodes.filter(t=>t instanceof Qe)}triggerEventHandler(t,e){this.listeners.forEach(r=>{r.name==t&&r.callback(e)})}}const Ke=new Map;function $e(t){return Ke.get(t)||null}function tr(t){Ke.set(t.nativeNode,t)}function er(t,e){const r=ir(t),n=ir(e);return r&&n?function(t,e,r){const n=t[N()](),i=e[N()]();for(;;){const t=n.next(),e=i.next();if(t.done&&e.done)return!0;if(t.done||e.done)return!1;if(!r(t.value,e.value))return!1}}(t,e,er):!(r||!t||"object"!=typeof t&&"function"!=typeof t||n||!e||"object"!=typeof e&&"function"!=typeof e)||I(t,e)}class rr{constructor(t){this.wrapped=t}static wrap(t){return new rr(t)}static unwrap(t){return rr.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof rr}}class nr{constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function ir(t){return!!or(t)&&(Array.isArray(t)||!(t instanceof Map)&&N()in t)}function or(t){return null!==t&&("function"==typeof t||"object"==typeof t)}const sr=(t,e)=>e;class ar{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&I(r.trackById,t))return r;return null}remove(t){const e=t._prevDup,r=t._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class lr{constructor(){this.map=new Map}put(t){const e=t.trackById;let r=this.map.get(e);r||(r=new ar,this.map.set(e,r)),r.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function cr(t,e,r){const n=t.previousIndex;if(null===n)return n;let i=0;return r&&n<r.length&&(i=r[n]),n+e+i}class ur{constructor(t){this.factories=t}static create(t,e){if(null!=e){const r=e.factories.slice();return t=t.concat(r),new ur(t)}return new ur(t)}static extend(t){return{provide:ur,useFactory:e=>{if(!e)throw new Error("Cannot extend IterableDiffers without a parent injector");return ur.create(t,e)},deps:[[ur,new M,new S]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${t.name||typeof t}'`)}}class hr{constructor(t){this.factories=t}static create(t,e){if(e){const r=e.factories.slice();t=t.concat(r)}return new hr(t)}static extend(t){return{provide:hr,useFactory:e=>{if(!e)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return hr.create(t,e)},deps:[[hr,new M,new S]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}const dr=[new class{constructor(){}supports(t){return t instanceof Map||or(t)}create(){return new class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||or(t)))throw new Error(`Error trying to diff '${R(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const n=this._getOrCreateRecordForKey(r,t);e=this._insertBeforeOrAppend(e,n)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const r=t._prev;return e._next=t,e._prev=r,t._prev=e,r&&(r._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const n=r._prev,i=r._next;return n&&(n._next=i),i&&(i._prev=n),r._next=null,r._prev=null,r}const r=new class{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(t);return this._records.set(t,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){I(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(r=>e(t[r],r))}}}}],pr=[new class{constructor(){}supports(t){return ir(t)}create(t){return new class{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||sr}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,r=this._removalsHead,n=0,i=null;for(;e||r;){const o=!r||e&&e.currentIndex<cr(r,n,i)?e:r,s=cr(o,n,i),a=o.currentIndex;if(o===r)n--,r=r._nextRemoved;else if(e=e._next,null==o.previousIndex)n++;else{i||(i=[]);const t=s-n,e=a-n;if(t!=e){for(let r=0;r<t;r++){const n=r<i.length?i[r]:i[r]=0,o=n+r;e<=o&&o<t&&(i[r]=n+1)}i[o.previousIndex]=e-t}}s!==a&&t(o,s,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!ir(t))throw new Error(`Error trying to diff '${R(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,r,n,i=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=this._trackByFn(e,r=t[e]),null!==i&&I(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,r,n,e)),I(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,n,e),o=!0),i=i._next}else e=0,function(t,e){if(Array.isArray(t))for(let r=0;r<t.length;r++)e(t[r]);else{const r=t[N()]();let n;for(;!(n=r.next()).done;)e(n.value)}}(t,t=>{n=this._trackByFn(e,t),null!==i&&I(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,t,n,e)),I(i.item,t)||this._addIdentityChange(i,t)):(i=this._mismatch(i,t,n,e),o=!0),i=i._next,e++}),this.length=e;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,r,n){let i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,n))?(I(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,n)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(I(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,n)):t=this._addAfter(new class{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}(e,r),i,n),t}_verifyReinsertion(t,e,r,n){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?t=this._reinsertAfter(i,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n,this._addToMoves(t,n)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const n=t._prevRemoved,i=t._nextRemoved;return null===n?this._removalsHead=i:n._nextRemoved=i,null===i?this._removalsTail=n:i._prevRemoved=n,this._insertAfter(t,e,r),this._addToMoves(t,r),t}_moveAfter(t,e,r){return this._unlink(t),this._insertAfter(t,e,r),this._addToMoves(t,r),t}_addAfter(t,e,r){return this._insertAfter(t,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,r){const n=null===e?this._itHead:e._next;return t._next=n,t._prev=e,null===n?this._itTail=t:n._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new lr),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,r=t._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,t}_addToMoves(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new lr),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}(t)}}],fr=new ur(pr),mr=new hr(dr),vr=Ce(null,"core",[{provide:Gt,useValue:"unknown"},{provide:Oe,deps:[j]},{provide:ye,deps:[]},{provide:Wt,deps:[]}]),gr=new l("LocaleId");function yr(){return fr}function xr(){return mr}function br(t){return t||"en-US"}new l("Translations"),new l("TranslationsFormat");class wr{constructor(t){}}const _r=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}();class Sr{}function Tr(t,e,r){const n=t.state,i=1792&n;return i===e?(t.state=-1793&n|r,t.initIndex=-1,!0):i===r}function Mr(t,e,r){return(1792&t.state)===e&&t.initIndex<=r&&(t.initIndex=r+1,!0)}function Ar(t,e){return t.nodes[e]}function Er(t,e){return t.nodes[e]}function Cr(t,e){return t.nodes[e]}function Pr(t,e){return t.nodes[e]}function Or(t,e){return t.nodes[e]}const Nr={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function Lr(t,e,r,n){let i=`ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '${e}'. Current value: '${r}'.`;return n&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){const r=new Error(t);return Ir(r,e),r}(i,t)}function Ir(t,e){t[rt]=e,t[it]=e.logError.bind(e)}function Rr(t){return new Error(`ViewDestroyedError: Attempt to use a destroyed view: ${t}`)}const Dr=()=>{},Fr=new Map;function kr(t){let e=Fr.get(t);return e||(e=R(t)+"_"+Fr.size,Fr.set(t,e)),e}const Ur="$$undefined",Br="$$empty";function jr(t){return{id:Ur,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}let zr=0;function Vr(t,e,r,n){return!(!(2&t.state)&&I(t.oldValues[e.bindingIndex+r],n))}function Gr(t,e,r,n){return!!Vr(t,e,r,n)&&(t.oldValues[e.bindingIndex+r]=n,!0)}function Hr(t,e,r,n){const i=t.oldValues[e.bindingIndex+r];if(1&t.state||!er(i,n)){const o=e.bindings[r].name;throw Lr(Nr.createDebugContext(t,e.nodeIndex),`${o}: ${i}`,`${o}: ${n}`,0!=(1&t.state))}}function Wr(t){let e=t;for(;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function Xr(t,e){let r=t;for(;r&&r!==e;)r.state|=64,r=r.viewContainerParent||r.parent}function qr(t,e,r,n){try{return Wr(33554432&t.def.nodes[e].flags?Er(t,e).componentView:t),Nr.handleEvent(t,e,r,n)}catch(e){t.root.errorHandler.handleError(e)}}function Yr(t){return t.parent?Er(t.parent,t.parentNodeDef.nodeIndex):null}function Zr(t){return t.parent?t.parentNodeDef.parent:null}function Jr(t,e){switch(201347067&e.flags){case 1:return Er(t,e.nodeIndex).renderElement;case 2:return Ar(t,e.nodeIndex).renderText}}function Qr(t,e){return t?`${t}:${e}`:e}function Kr(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function $r(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function tn(t){return 1<<t%32}function en(t){const e={};let r=0;const n={};return t&&t.forEach(([t,i])=>{"number"==typeof t?(e[t]=i,r|=tn(t)):n[t]=i}),{matchedQueries:e,references:n,matchedQueryIds:r}}function rn(t,e){return t.map(t=>{let r,n;return Array.isArray(t)?[n,r]=t:(n=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,k,{value:e,configurable:!0}),{flags:n,token:r,tokenKey:kr(r)}})}function nn(t,e,r){let n=r.renderParent;return n?0==(1&n.flags)||0==(33554432&n.flags)||n.element.componentRendererType&&n.element.componentRendererType.encapsulation===x.Native?Er(t,r.renderParent.nodeIndex).renderElement:void 0:e}const on=new WeakMap;function sn(t){let e=on.get(t);return e||((e=t(()=>Dr)).factory=t,on.set(t,e)),e}function an(t,e,r,n,i){3===e&&(r=t.renderer.parentNode(Jr(t,t.def.lastRenderRootNode))),ln(t,e,0,t.def.nodes.length-1,r,n,i)}function ln(t,e,r,n,i,o,s){for(let a=r;a<=n;a++){const r=t.def.nodes[a];11&r.flags&&un(t,r,e,i,o,s),a+=r.childCount}}function cn(t,e,r,n,i,o){let s=t;for(;s&&!Kr(s);)s=s.parent;const a=s.parent,l=Zr(s),c=l.nodeIndex+l.childCount;for(let u=l.nodeIndex+1;u<=c;u++){const t=a.def.nodes[u];t.ngContentIndex===e&&un(a,t,r,n,i,o),u+=t.childCount}if(!a.parent){const s=t.root.projectableNodes[e];if(s)for(let e=0;e<s.length;e++)hn(t,s[e],r,n,i,o)}}function un(t,e,r,n,i,o){if(8&e.flags)cn(t,e.ngContent.index,r,n,i,o);else{const s=Jr(t,e);if(3===r&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&hn(t,s,r,n,i,o),32&e.bindingFlags&&hn(Er(t,e.nodeIndex).componentView,s,r,n,i,o)):hn(t,s,r,n,i,o),16777216&e.flags){const s=Er(t,e.nodeIndex).viewContainer._embeddedViews;for(let t=0;t<s.length;t++)an(s[t],r,n,i,o)}1&e.flags&&!e.element.name&&ln(t,r,e.nodeIndex+1,e.nodeIndex+e.childCount,n,i,o)}}function hn(t,e,r,n,i,o){const s=t.renderer;switch(r){case 1:s.appendChild(n,e);break;case 2:s.insertBefore(n,e,i);break;case 3:s.removeChild(n,e);break;case 0:o.push(e)}}const dn=/^:([^:]+):(.+)$/;function pn(t){if(":"===t[0]){const e=t.match(dn);return[e[1],e[2]]}return["",t]}function fn(t){let e=0;for(let r=0;r<t.length;r++)e|=t[r].flags;return e}function mn(t,e,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x){switch(t){case 1:return e+vn(r)+n;case 2:return e+vn(r)+n+vn(i)+o;case 3:return e+vn(r)+n+vn(i)+o+vn(s)+a;case 4:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c;case 5:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c+vn(u)+h;case 6:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c+vn(u)+h+vn(d)+p;case 7:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c+vn(u)+h+vn(d)+p+vn(f)+m;case 8:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c+vn(u)+h+vn(d)+p+vn(f)+m+vn(v)+g;case 9:return e+vn(r)+n+vn(i)+o+vn(s)+a+vn(l)+c+vn(u)+h+vn(d)+p+vn(f)+m+vn(v)+g+vn(y)+x;default:throw new Error("Does not support more than 9 expressions")}}function vn(t){return null!=t?t.toString():""}function gn(t,e,r,n,i,o){t|=1;const{matchedQueries:s,references:a,matchedQueryIds:l}=en(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:l,references:a,ngContentIndex:r,childCount:n,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?sn(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||Dr},provider:null,text:null,query:null,ngContent:null}}function yn(t,e,r,n,i,o,s=[],a,l,c,u,h){c||(c=Dr);const{matchedQueries:d,references:p,matchedQueryIds:f}=en(r);let m=null,v=null;o&&([m,v]=pn(o)),a=a||[];const g=new Array(a.length);for(let x=0;x<a.length;x++){const[t,e,r]=a[x],[n,i]=pn(e);let o=void 0,s=void 0;switch(15&t){case 4:s=r;break;case 1:case 8:o=r}g[x]={flags:t,ns:n,name:i,nonMinifiedName:i,securityContext:o,suffix:s}}l=l||[];const y=new Array(l.length);for(let x=0;x<l.length;x++){const[t,e]=l[x];y[x]={type:0,target:t,eventName:e,propName:null}}const b=(s=s||[]).map(([t,e])=>{const[r,n]=pn(t);return[r,n,e]});return h=function(t){if(t&&t.id===Ur){const e=null!=t.encapsulation&&t.encapsulation!==x.None||t.styles.length||Object.keys(t.data).length;t.id=e?`c${zr++}`:Br}return t&&t.id===Br&&(t=null),t||null}(h),u&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:f,references:p,ngContentIndex:n,childCount:i,bindings:g,bindingFlags:fn(g),outputs:y,element:{ns:m,name:v,attrs:b,template:null,componentProvider:null,componentView:u||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:c||Dr},provider:null,text:null,query:null,ngContent:null}}function xn(t,e,r){const n=r.element,i=t.root.selectorOrNode,o=t.renderer;let s;if(t.parent||!i){s=n.name?o.createElement(n.name,n.ns):o.createComment("");const i=nn(t,e,r);i&&o.appendChild(i,s)}else s=o.selectRootElement(i);if(n.attrs)for(let a=0;a<n.attrs.length;a++){const[t,e,r]=n.attrs[a];o.setAttribute(s,e,r,t)}return s}function bn(t,e,r,n){for(let i=0;i<r.outputs.length;i++){const o=r.outputs[i],s=wn(t,r.nodeIndex,Qr(o.target,o.eventName));let a=o.target,l=t;"component"===o.target&&(a=null,l=e);const c=l.renderer.listen(a||n,o.eventName,s);t.disposables[r.outputIndex+i]=c}}function wn(t,e,r){return n=>qr(t,e,r,n)}function _n(t,e,r,n){if(!Gr(t,e,r,n))return!1;const i=e.bindings[r],o=Er(t,e.nodeIndex),s=o.renderElement,a=i.name;switch(15&i.flags){case 1:!function(t,e,r,n,i,o){const s=e.securityContext;let a=s?t.root.sanitizer.sanitize(s,o):o;a=null!=a?a.toString():null;const l=t.renderer;null!=o?l.setAttribute(r,i,a,n):l.removeAttribute(r,i,n)}(t,i,s,i.ns,a,n);break;case 2:!function(t,e,r,n){const i=t.renderer;n?i.addClass(e,r):i.removeClass(e,r)}(t,s,a,n);break;case 4:!function(t,e,r,n,i){let o=t.root.sanitizer.sanitize(_r.STYLE,i);if(null!=o){o=o.toString();const t=e.suffix;null!=t&&(o+=t)}else o=null;const s=t.renderer;null!=o?s.setStyle(r,n,o):s.removeStyle(r,n)}(t,i,s,a,n);break;case 8:!function(t,e,r,n,i){const o=e.securityContext;let s=o?t.root.sanitizer.sanitize(o,i):i;t.renderer.setProperty(r,n,s)}(33554432&e.flags&&32&i.flags?o.componentView:t,i,s,a,n)}return!0}const Sn=new Object,Tn=kr(j),Mn=kr(re);function An(t,e,r,n){return r=F(r),{index:-1,deps:rn(n,R(e)),flags:t,token:e,value:r}}function En(t){const e={};for(let r=0;r<t.length;r++){const n=t[r];n.index=r,e[kr(n.token)]=n}return{factory:null,providersByKey:e,providers:t}}function Cn(t,e,r=j.THROW_IF_NOT_FOUND){if(8&e.flags)return e.token;if(2&e.flags&&(r=null),1&e.flags)return t._parent.get(e.token,r);const n=e.tokenKey;switch(n){case Tn:case Mn:return t}const i=t._def.providersByKey[n];if(i){let e=t._providers[i.index];return void 0===e&&(e=t._providers[i.index]=Pn(t,i)),e===Sn?void 0:e}return t._parent.get(e.token,r)}function Pn(t,e){let r;switch(201347067&e.flags){case 512:r=function(t,e,r){const n=r.length;switch(n){case 0:return new e;case 1:return new e(Cn(t,r[0]));case 2:return new e(Cn(t,r[0]),Cn(t,r[1]));case 3:return new e(Cn(t,r[0]),Cn(t,r[1]),Cn(t,r[2]));default:const i=new Array(n);for(let e=0;e<n;e++)i[e]=Cn(t,r[e]);return new e(...i)}}(t,e.value,e.deps);break;case 1024:r=function(t,e,r){const n=r.length;switch(n){case 0:return e();case 1:return e(Cn(t,r[0]));case 2:return e(Cn(t,r[0]),Cn(t,r[1]));case 3:return e(Cn(t,r[0]),Cn(t,r[1]),Cn(t,r[2]));default:const i=Array(n);for(let e=0;e<n;e++)i[e]=Cn(t,r[e]);return e(...i)}}(t,e.value,e.deps);break;case 2048:r=Cn(t,e.deps[0]);break;case 256:r=e.value}return void 0===r?Sn:r}function On(t,e){const r=t.viewContainer._embeddedViews;if((null==e||e>=r.length)&&(e=r.length-1),e<0)return null;const n=r[e];return n.viewContainerParent=null,Rn(r,e),Nr.dirtyParentQueries(n),Ln(n),n}function Nn(t,e,r){const n=e?Jr(e,e.def.lastRenderRootNode):t.renderElement;an(r,2,r.renderer.parentNode(n),r.renderer.nextSibling(n),void 0)}function Ln(t){an(t,3,null,null,void 0)}function In(t,e,r){e>=t.length?t.push(r):t.splice(e,0,r)}function Rn(t,e){e>=t.length-1?t.pop():t.splice(e,1)}const Dn=new Object;function Fn(t,e,r,n,i,o){return new kn(t,e,r,n,i,o)}class kn extends Jt{constructor(t,e,r,n,i,o){super(),this.selector=t,this.componentType=e,this._inputs=n,this._outputs=i,this.ngContentSelectors=o,this.viewDefFactory=r}get inputs(){const t=[],e=this._inputs;for(let r in e)t.push({propName:r,templateName:e[r]});return t}get outputs(){const t=[];for(let e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t}create(t,e,r,n){if(!n)throw new Error("ngModule should be provided");const i=sn(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,s=Nr.createRootView(t,e||[],r,i,n,Dn),a=Cr(s,o).instance;return r&&s.renderer.setAttribute(Er(s,0).renderElement,"ng-version",w.full),new Un(s,new Vn(s),a)}}class Un extends Zt{constructor(t,e,r){super(),this._view=t,this._viewRef=e,this._component=r,this._elDef=this._view.def.nodes[0],this.hostView=e,this.changeDetectorRef=e,this.instance=r}get location(){return new ke(Er(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new Xn(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){this._viewRef.destroy()}onDestroy(t){this._viewRef.onDestroy(t)}}function Bn(t,e,r){return new jn(t,e,r)}class jn{constructor(t,e,r){this._view=t,this._elDef=e,this._data=r,this._embeddedViews=[]}get element(){return new ke(this._data.renderElement)}get injector(){return new Xn(this._view,this._elDef)}get parentInjector(){let t=this._view,e=this._elDef.parent;for(;!e&&t;)e=Zr(t),t=t.parent;return t?new Xn(t,e):new Xn(this._view,null)}clear(){for(let t=this._embeddedViews.length-1;t>=0;t--){const e=On(this._data,t);Nr.destroyView(e)}}get(t){const e=this._embeddedViews[t];if(e){const t=new Vn(e);return t.attachToViewContainerRef(this),t}return null}get length(){return this._embeddedViews.length}createEmbeddedView(t,e,r){const n=t.createEmbeddedView(e||{});return this.insert(n,r),n}createComponent(t,e,r,n,i){const o=r||this.parentInjector;i||t instanceof ee||(i=o.get(re));const s=t.create(o,n,void 0,i);return this.insert(s.hostView,e),s}insert(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");const r=t;return function(t,e,r,n){let i=e.viewContainer._embeddedViews;null!==r&&void 0!==r||(r=i.length),n.viewContainerParent=t,In(i,r,n),function(t,e){const r=Yr(e);if(!r||r===t||16&e.state)return;e.state|=16;let n=r.template._projectedViews;n||(n=r.template._projectedViews=[]),n.push(e),function(t,e){if(4&e.flags)return;t.nodeFlags|=4,e.flags|=4;let r=e.parent;for(;r;)r.childFlags|=4,r=r.parent}(e.parent.def,e.parentNodeDef)}(e,n),Nr.dirtyParentQueries(n),Nn(e,r>0?i[r-1]:null,n)}(this._view,this._data,e,r._view),r.attachToViewContainerRef(this),t}move(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");const r=this._embeddedViews.indexOf(t._view);return function(t,e,n){const i=t.viewContainer._embeddedViews,o=i[r];Rn(i,r),null==n&&(n=i.length),In(i,n,o),Nr.dirtyParentQueries(o),Ln(o),Nn(t,n>0?i[n-1]:null,o)}(this._data,0,e),t}indexOf(t){return this._embeddedViews.indexOf(t._view)}remove(t){const e=On(this._data,t);e&&Nr.destroyView(e)}detach(t){const e=On(this._data,t);return e?new Vn(e):null}}function zn(t){return new Vn(t)}class Vn{constructor(t){this._view=t,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(t){const e=[];return an(t,0,void 0,void 0,e),e}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){Wr(this._view)}detach(){this._view.state&=-5}detectChanges(){const t=this._view.root.rendererFactory;t.begin&&t.begin();try{Nr.checkAndUpdateView(this._view)}finally{t.end&&t.end()}}checkNoChanges(){Nr.checkNoChangesView(this._view)}reattach(){this._view.state|=4}onDestroy(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)}destroy(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Nr.destroyView(this._view)}detachFromAppRef(){this._appRef=null,Ln(this._view),Nr.dirtyParentQueries(this._view)}attachToAppRef(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}attachToViewContainerRef(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}}function Gn(t,e){return new Hn(t,e)}class Hn extends Xe{constructor(t,e){super(),this._parentView=t,this._def=e}createEmbeddedView(t){return new Vn(Nr.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))}get elementRef(){return new ke(Er(this._parentView,this._def.nodeIndex).renderElement)}}function Wn(t,e){return new Xn(t,e)}class Xn{constructor(t,e){this.view=t,this.elDef=e}get(t,e=j.THROW_IF_NOT_FOUND){return Nr.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:kr(t)},e)}}function qn(t,e){const r=t.def.nodes[e];if(1&r.flags){const e=Er(t,r.nodeIndex);return r.element.template?e.template:e.renderElement}if(2&r.flags)return Ar(t,r.nodeIndex).renderText;if(20240&r.flags)return Cr(t,r.nodeIndex).instance;throw new Error(`Illegal state: read nodeValue for node index ${e}`)}function Yn(t){return new Zn(t.renderer)}class Zn{constructor(t){this.delegate=t}selectRootElement(t){return this.delegate.selectRootElement(t)}createElement(t,e){const[r,n]=pn(e),i=this.delegate.createElement(n,r);return t&&this.delegate.appendChild(t,i),i}createViewRoot(t){return t}createTemplateAnchor(t){const e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e}createText(t,e){const r=this.delegate.createText(e);return t&&this.delegate.appendChild(t,r),r}projectNodes(t,e){for(let r=0;r<e.length;r++)this.delegate.appendChild(t,e[r])}attachViewAfter(t,e){const r=this.delegate.parentNode(t),n=this.delegate.nextSibling(t);for(let i=0;i<e.length;i++)this.delegate.insertBefore(r,e[i],n)}detachView(t){for(let e=0;e<t.length;e++){const r=t[e],n=this.delegate.parentNode(r);this.delegate.removeChild(n,r)}}destroyView(t,e){for(let r=0;r<e.length;r++)this.delegate.destroyNode(e[r])}listen(t,e,r){return this.delegate.listen(t,e,r)}listenGlobal(t,e,r){return this.delegate.listen(t,e,r)}setElementProperty(t,e,r){this.delegate.setProperty(t,e,r)}setElementAttribute(t,e,r){const[n,i]=pn(e);null!=r?this.delegate.setAttribute(t,i,r,n):this.delegate.removeAttribute(t,i,n)}setBindingDebugInfo(t,e,r){}setElementClass(t,e,r){r?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)}setElementStyle(t,e,r){null!=r?this.delegate.setStyle(t,e,r):this.delegate.removeStyle(t,e)}invokeElementMethod(t,e,r){t[e].apply(t,r)}setText(t,e){this.delegate.setValue(t,e)}animate(){throw new Error("Renderer.animate is no longer supported!")}}function Jn(t,e,r,n){return new Qn(t,e,r,n)}class Qn{constructor(t,e,r,n){this._moduleType=t,this._parent=e,this._bootstrapComponents=r,this._def=n,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){const e=t._def,r=t._providers=new Array(e.providers.length);for(let n=0;n<e.providers.length;n++){const i=e.providers[n];4096&i.flags||(r[n]=Pn(t,i))}}(this)}get(t,e=j.THROW_IF_NOT_FOUND){return Cn(this,{token:t,tokenKey:kr(t),flags:0},e)}get instance(){return this.get(this._moduleType)}get componentFactoryResolver(){return this.get($t)}destroy(){if(this._destroyed)throw new Error(`The ng module ${R(this.instance.constructor)} has already been destroyed.`);this._destroyed=!0,function(t,e){const r=t._def;for(let n=0;n<r.providers.length;n++)if(131072&r.providers[n].flags){const e=t._providers[n];e&&e!==Sn&&e.ngOnDestroy()}}(this),this._destroyListeners.forEach(t=>t())}onDestroy(t){this._destroyListeners.push(t)}}const Kn=kr(class{}),$n=kr(Fe),ti=kr(ke),ei=kr(qe),ri=kr(Xe),ni=kr(Ye),ii=kr(j);function oi(t,e,r,n,i,o,s,a){const l=[];if(s)for(let u in s){const[t,e]=s[u];l[t]={flags:8,name:u,nonMinifiedName:e,ns:null,securityContext:null,suffix:null}}const c=[];if(a)for(let u in a)c.push({type:1,propName:u,target:null,eventName:a[u]});return function(t,e,r,n,i,o,s,a,l){const{matchedQueries:c,references:u,matchedQueryIds:h}=en(r);l||(l=[]),a||(a=[]),o=F(o);const d=rn(s,R(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:h,references:u,ngContentIndex:-1,childCount:n,bindings:a,bindingFlags:fn(a),outputs:l,element:null,provider:{token:i,value:o,deps:d},text:null,query:null,ngContent:null}}(t,e|=16384,r,n,i,i,o,l,c)}function si(t,e){return ui(t,e)}function ai(t,e){let r=t;for(;r.parent&&!Kr(r);)r=r.parent;return hi(r.parent,Zr(r),!0,e.provider.value,e.provider.deps)}function li(t,e){const r=hi(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(let n=0;n<e.outputs.length;n++){const i=e.outputs[n],o=r[i.propName].subscribe(ci(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+n]=o.unsubscribe.bind(o)}return r}function ci(t,e,r){return n=>qr(t,e,r,n)}function ui(t,e){const r=(8192&e.flags)>0,n=e.provider;switch(201347067&e.flags){case 512:return hi(t,e.parent,r,n.value,n.deps);case 1024:return function(t,e,r,n,i){const o=i.length;switch(o){case 0:return n();case 1:return n(pi(t,e,r,i[0]));case 2:return n(pi(t,e,r,i[0]),pi(t,e,r,i[1]));case 3:return n(pi(t,e,r,i[0]),pi(t,e,r,i[1]),pi(t,e,r,i[2]));default:const s=Array(o);for(let n=0;n<o;n++)s[n]=pi(t,e,r,i[n]);return n(...s)}}(t,e.parent,r,n.value,n.deps);case 2048:return pi(t,e.parent,r,n.deps[0]);case 256:return n.value}}function hi(t,e,r,n,i){const o=i.length;switch(o){case 0:return new n;case 1:return new n(pi(t,e,r,i[0]));case 2:return new n(pi(t,e,r,i[0]),pi(t,e,r,i[1]));case 3:return new n(pi(t,e,r,i[0]),pi(t,e,r,i[1]),pi(t,e,r,i[2]));default:const s=new Array(o);for(let n=0;n<o;n++)s[n]=pi(t,e,r,i[n]);return new n(...s)}}const di={};function pi(t,e,r,n,i=j.THROW_IF_NOT_FOUND){if(8&n.flags)return n.token;const o=t;2&n.flags&&(i=null);const s=n.tokenKey;for(s===ni&&(r=!(!e||!e.element.componentView)),e&&1&n.flags&&(r=!1,e=e.parent);t;){if(e)switch(s){case Kn:return Yn(fi(t,e,r));case $n:return fi(t,e,r).renderer;case ti:return new ke(Er(t,e.nodeIndex).renderElement);case ei:return Er(t,e.nodeIndex).viewContainer;case ri:if(e.element.template)return Er(t,e.nodeIndex).template;break;case ni:return zn(fi(t,e,r));case ii:return Wn(t,e);default:const n=(r?e.element.allProviders:e.element.publicProviders)[s];if(n){let e=Cr(t,n.nodeIndex);return e||(e={instance:ui(t,n)},t.nodes[n.nodeIndex]=e),e.instance}}r=Kr(t),e=Zr(t),t=t.parent}const a=o.root.injector.get(n.token,di);return a!==di||i===di?a:o.root.ngModule.injector.get(n.token,i)}function fi(t,e,r){let n;if(r)n=Er(t,e.nodeIndex).componentView;else for(n=t;n.parent&&!Kr(n);)n=n.parent;return n}function mi(t,e,r,n,i,o){if(32768&r.flags){const e=Er(t,r.parent.nodeIndex).componentView;2&e.def.flags&&(e.state|=8)}if(e.instance[r.bindings[n].name]=i,524288&r.flags){o=o||{};const e=rr.unwrap(t.oldValues[r.bindingIndex+n]);o[r.bindings[n].nonMinifiedName]=new nr(e,i,0!=(2&t.state))}return t.oldValues[r.bindingIndex+n]=i,o}function vi(t,e){if(!(t.def.nodeFlags&e))return;const r=t.def.nodes;let n=0;for(let i=0;i<r.length;i++){const o=r[i];let s=o.parent;for(!s&&o.flags&e&&yi(t,i,o.flags&e,n++),0==(o.childFlags&e)&&(i+=o.childCount);s&&1&s.flags&&i===s.nodeIndex+s.childCount;)s.directChildFlags&e&&(n=gi(t,s,e,n)),s=s.parent}}function gi(t,e,r,n){for(let i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){const e=t.def.nodes[i];e.flags&r&&yi(t,i,e.flags&r,n++),i+=e.childCount}return n}function yi(t,e,r,n){const i=Cr(t,e);if(!i)return;const o=i.instance;o&&(Nr.setCurrentNode(t,e),1048576&r&&Mr(t,512,n)&&o.ngAfterContentInit(),2097152&r&&o.ngAfterContentChecked(),4194304&r&&Mr(t,768,n)&&o.ngAfterViewInit(),8388608&r&&o.ngAfterViewChecked(),131072&r&&o.ngOnDestroy())}function xi(t,e,r){let n=[];for(let i in r)n.push({propName:i,bindingType:r[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:tn(e),bindings:n},ngContent:null}}function bi(t){const e=t.def.nodeMatchedQueries;for(;t.parent&&$r(t);){let r=t.parentNodeDef;t=t.parent;const n=r.nodeIndex+r.childCount;for(let i=0;i<=n;i++){const n=t.def.nodes[i];67108864&n.flags&&536870912&n.flags&&(n.query.filterId&e)===n.query.filterId&&Or(t,i).setDirty(),!(1&n.flags&&i+n.childCount<r.nodeIndex)&&67108864&n.childFlags&&536870912&n.childFlags||(i+=n.childCount)}}if(134217728&t.def.nodeFlags)for(let r=0;r<t.def.nodes.length;r++){const e=t.def.nodes[r];134217728&e.flags&&536870912&e.flags&&Or(t,r).setDirty(),r+=e.childCount}}function wi(t,e){const r=Or(t,e.nodeIndex);if(!r.dirty)return;let n,i=void 0;if(67108864&e.flags){const r=e.parent.parent;i=_i(t,r.nodeIndex,r.nodeIndex+r.childCount,e.query,[]),n=Cr(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=_i(t,0,t.def.nodes.length-1,e.query,[]),n=t.component);r.reset(i);const o=e.query.bindings;let s=!1;for(let a=0;a<o.length;a++){const t=o[a];let e;switch(t.bindingType){case 0:e=r.first;break;case 1:e=r,s=!0}n[t.propName]=e}s&&r.notifyOnChanges()}function _i(t,e,r,n,i){for(let o=e;o<=r;o++){const e=t.def.nodes[o],r=e.matchedQueries[n.id];if(null!=r&&i.push(Si(t,e,r)),1&e.flags&&e.element.template&&(e.element.template.nodeMatchedQueries&n.filterId)===n.filterId){const r=Er(t,o);if((e.childMatchedQueries&n.filterId)===n.filterId&&(_i(t,o+1,o+e.childCount,n,i),o+=e.childCount),16777216&e.flags){const t=r.viewContainer._embeddedViews;for(let e=0;e<t.length;e++){const o=t[e],s=Yr(o);s&&s===r&&_i(o,0,o.def.nodes.length-1,n,i)}}const s=r.template._projectedViews;if(s)for(let t=0;t<s.length;t++){const e=s[t];_i(e,0,e.def.nodes.length-1,n,i)}}(e.childMatchedQueries&n.filterId)!==n.filterId&&(o+=e.childCount)}return i}function Si(t,e,r){if(null!=r)switch(r){case 1:return Er(t,e.nodeIndex).renderElement;case 0:return new ke(Er(t,e.nodeIndex).renderElement);case 2:return Er(t,e.nodeIndex).template;case 3:return Er(t,e.nodeIndex).viewContainer;case 4:return Cr(t,e.nodeIndex).instance}}function Ti(t,e,r){const n=nn(t,e,r);n&&cn(t,r.ngContent.index,1,n,null,void 0)}function Mi(t,e){return function(t,e,r){const n=new Array(r.length);for(let i=0;i<r.length;i++){const t=r[i];n[i]={flags:8,name:t,ns:null,nonMinifiedName:t,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:32,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:n,bindingFlags:fn(n),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,t,new Array(e))}function Ai(t,e,r){const n=new Array(r.length-1);for(let i=1;i<r.length;i++)n[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:r[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:n,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:r[0]},query:null,ngContent:null}}function Ei(t,e,r){let n;const i=t.renderer;n=i.createText(r.text.prefix);const o=nn(t,e,r);return o&&i.appendChild(o,n),{renderText:n}}function Ci(t,e){return(null!=t?t.toString():"")+e.suffix}function Pi(t,e,r,n){let i=0,o=0,s=0,a=0,l=0,c=null,u=null,h=!1,d=!1,p=null;for(let f=0;f<e.length;f++){const t=e[f];if(t.nodeIndex=f,t.parent=c,t.bindingIndex=i,t.outputIndex=o,t.renderParent=u,s|=t.flags,l|=t.matchedQueryIds,t.element){const e=t.element;e.publicProviders=c?c.element.publicProviders:Object.create(null),e.allProviders=e.publicProviders,h=!1,d=!1,t.element.template&&(l|=t.element.template.nodeMatchedQueries)}if(Ni(c,t,e.length),i+=t.bindings.length,o+=t.outputs.length,!u&&3&t.flags&&(p=t),20224&t.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);const e=0!=(32768&t.flags);0==(8192&t.flags)||e?c.element.publicProviders[kr(t.provider.token)]=t:(d||(d=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[kr(t.provider.token)]=t),e&&(c.element.componentProvider=t)}if(c?(c.childFlags|=t.flags,c.directChildFlags|=t.flags,c.childMatchedQueries|=t.matchedQueryIds,t.element&&t.element.template&&(c.childMatchedQueries|=t.element.template.nodeMatchedQueries)):a|=t.flags,t.childCount>0)c=t,Oi(t)||(u=t);else for(;c&&f===c.nodeIndex+c.childCount;){const t=c.parent;t&&(t.childFlags|=c.childFlags,t.childMatchedQueries|=c.childMatchedQueries),u=(c=t)&&Oi(c)?c.renderParent:c}}return{factory:null,nodeFlags:s,rootNodeFlags:a,nodeMatchedQueries:l,flags:t,nodes:e,updateDirectives:r||Dr,updateRenderer:n||Dr,handleEvent:(t,r,n,i)=>e[r].element.handleEvent(t,n,i),bindingCount:i,outputCount:o,lastRenderRootNode:p}}function Oi(t){return 0!=(1&t.flags)&&null===t.element.name}function Ni(t,e,r){const n=e.element&&e.element.template;if(n){if(!n.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(n.lastRenderRootNode&&16777216&n.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${e.nodeIndex}!`)}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${e.nodeIndex}!`);if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${e.nodeIndex}!`);if(134217728&e.flags&&t)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${e.nodeIndex}!`)}if(e.childCount){const n=t?t.nodeIndex+t.childCount:r-1;if(e.nodeIndex<=n&&e.nodeIndex+e.childCount>n)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${e.nodeIndex}!`)}}function Li(t,e,r,n){const i=Di(t.root,t.renderer,t,e,r);return Fi(i,t.component,n),ki(i),i}function Ii(t,e,r){const n=Di(t,t.renderer,null,null,e);return Fi(n,r,r),ki(n),n}function Ri(t,e,r,n){const i=e.element.componentRendererType;let o;return o=i?t.root.rendererFactory.createRenderer(n,i):t.root.renderer,Di(t.root,o,t,e.element.componentProvider,r)}function Di(t,e,r,n,i){const o=new Array(i.nodes.length),s=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:r,viewContainerParent:null,parentNodeDef:n,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:s,initIndex:-1}}function Fi(t,e,r){t.component=e,t.context=r}function ki(t){let e;Kr(t)&&(e=Er(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);const r=t.def,n=t.nodes;for(let i=0;i<r.nodes.length;i++){const o=r.nodes[i];let s;switch(Nr.setCurrentNode(t,i),201347067&o.flags){case 1:const r=xn(t,e,o);let a=void 0;if(33554432&o.flags){const e=sn(o.element.componentView);a=Nr.createComponentView(t,o,e,r)}bn(t,a,o,r),s={renderElement:r,componentView:a,viewContainer:null,template:o.element.template?Gn(t,o):void 0},16777216&o.flags&&(s.viewContainer=Bn(t,o,s));break;case 2:s=Ei(t,e,o);break;case 512:case 1024:case 2048:case 256:(s=n[i])||4096&o.flags||(s={instance:si(t,o)});break;case 16:s={instance:ai(t,o)};break;case 16384:(s=n[i])||(s={instance:li(t,o)}),32768&o.flags&&Fi(Er(t,o.parent.nodeIndex).componentView,s.instance,s.instance);break;case 32:case 64:case 128:s={value:void 0};break;case 67108864:case 134217728:s=new Be;break;case 8:Ti(t,e,o),s=void 0}n[i]=s}Xi(t,Wi.CreateViewNodes),Ji(t,201326592,268435456,0)}function Ui(t){zi(t),Nr.updateDirectives(t,1),qi(t,Wi.CheckNoChanges),Nr.updateRenderer(t,1),Xi(t,Wi.CheckNoChanges),t.state&=-97}function Bi(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Tr(t,0,256),zi(t),Nr.updateDirectives(t,0),qi(t,Wi.CheckAndUpdate),Ji(t,67108864,536870912,0);let e=Tr(t,256,512);vi(t,2097152|(e?1048576:0)),Nr.updateRenderer(t,0),Xi(t,Wi.CheckAndUpdate),Ji(t,134217728,536870912,0),vi(t,8388608|((e=Tr(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Tr(t,768,1024)}function ji(t,e,r,n,i,o,s,a,l,c,u,h,d){return 0===r?function(t,e,r,n,i,o,s,a,l,c,u,h){switch(201347067&e.flags){case 1:return function(t,e,r,n,i,o,s,a,l,c,u,h){const d=e.bindings.length;let p=!1;return d>0&&_n(t,e,0,r)&&(p=!0),d>1&&_n(t,e,1,n)&&(p=!0),d>2&&_n(t,e,2,i)&&(p=!0),d>3&&_n(t,e,3,o)&&(p=!0),d>4&&_n(t,e,4,s)&&(p=!0),d>5&&_n(t,e,5,a)&&(p=!0),d>6&&_n(t,e,6,l)&&(p=!0),d>7&&_n(t,e,7,c)&&(p=!0),d>8&&_n(t,e,8,u)&&(p=!0),d>9&&_n(t,e,9,h)&&(p=!0),p}(t,e,r,n,i,o,s,a,l,c,u,h);case 2:return function(t,e,r,n,i,o,s,a,l,c,u,h){let d=!1;const p=e.bindings,f=p.length;if(f>0&&Gr(t,e,0,r)&&(d=!0),f>1&&Gr(t,e,1,n)&&(d=!0),f>2&&Gr(t,e,2,i)&&(d=!0),f>3&&Gr(t,e,3,o)&&(d=!0),f>4&&Gr(t,e,4,s)&&(d=!0),f>5&&Gr(t,e,5,a)&&(d=!0),f>6&&Gr(t,e,6,l)&&(d=!0),f>7&&Gr(t,e,7,c)&&(d=!0),f>8&&Gr(t,e,8,u)&&(d=!0),f>9&&Gr(t,e,9,h)&&(d=!0),d){let d=e.text.prefix;f>0&&(d+=Ci(r,p[0])),f>1&&(d+=Ci(n,p[1])),f>2&&(d+=Ci(i,p[2])),f>3&&(d+=Ci(o,p[3])),f>4&&(d+=Ci(s,p[4])),f>5&&(d+=Ci(a,p[5])),f>6&&(d+=Ci(l,p[6])),f>7&&(d+=Ci(c,p[7])),f>8&&(d+=Ci(u,p[8])),f>9&&(d+=Ci(h,p[9]));const m=Ar(t,e.nodeIndex).renderText;t.renderer.setValue(m,d)}return d}(t,e,r,n,i,o,s,a,l,c,u,h);case 16384:return function(t,e,r,n,i,o,s,a,l,c,u,h){const d=Cr(t,e.nodeIndex),p=d.instance;let f=!1,m=void 0;const v=e.bindings.length;return v>0&&Vr(t,e,0,r)&&(f=!0,m=mi(t,d,e,0,r,m)),v>1&&Vr(t,e,1,n)&&(f=!0,m=mi(t,d,e,1,n,m)),v>2&&Vr(t,e,2,i)&&(f=!0,m=mi(t,d,e,2,i,m)),v>3&&Vr(t,e,3,o)&&(f=!0,m=mi(t,d,e,3,o,m)),v>4&&Vr(t,e,4,s)&&(f=!0,m=mi(t,d,e,4,s,m)),v>5&&Vr(t,e,5,a)&&(f=!0,m=mi(t,d,e,5,a,m)),v>6&&Vr(t,e,6,l)&&(f=!0,m=mi(t,d,e,6,l,m)),v>7&&Vr(t,e,7,c)&&(f=!0,m=mi(t,d,e,7,c,m)),v>8&&Vr(t,e,8,u)&&(f=!0,m=mi(t,d,e,8,u,m)),v>9&&Vr(t,e,9,h)&&(f=!0,m=mi(t,d,e,9,h,m)),m&&p.ngOnChanges(m),65536&e.flags&&Mr(t,256,e.nodeIndex)&&p.ngOnInit(),262144&e.flags&&p.ngDoCheck(),f}(t,e,r,n,i,o,s,a,l,c,u,h);case 32:case 64:case 128:return function(t,e,r,n,i,o,s,a,l,c,u,h){const d=e.bindings;let p=!1;const f=d.length;if(f>0&&Gr(t,e,0,r)&&(p=!0),f>1&&Gr(t,e,1,n)&&(p=!0),f>2&&Gr(t,e,2,i)&&(p=!0),f>3&&Gr(t,e,3,o)&&(p=!0),f>4&&Gr(t,e,4,s)&&(p=!0),f>5&&Gr(t,e,5,a)&&(p=!0),f>6&&Gr(t,e,6,l)&&(p=!0),f>7&&Gr(t,e,7,c)&&(p=!0),f>8&&Gr(t,e,8,u)&&(p=!0),f>9&&Gr(t,e,9,h)&&(p=!0),p){const p=Pr(t,e.nodeIndex);let m;switch(201347067&e.flags){case 32:m=new Array(d.length),f>0&&(m[0]=r),f>1&&(m[1]=n),f>2&&(m[2]=i),f>3&&(m[3]=o),f>4&&(m[4]=s),f>5&&(m[5]=a),f>6&&(m[6]=l),f>7&&(m[7]=c),f>8&&(m[8]=u),f>9&&(m[9]=h);break;case 64:m={},f>0&&(m[d[0].name]=r),f>1&&(m[d[1].name]=n),f>2&&(m[d[2].name]=i),f>3&&(m[d[3].name]=o),f>4&&(m[d[4].name]=s),f>5&&(m[d[5].name]=a),f>6&&(m[d[6].name]=l),f>7&&(m[d[7].name]=c),f>8&&(m[d[8].name]=u),f>9&&(m[d[9].name]=h);break;case 128:const t=r;switch(f){case 1:m=t.transform(r);break;case 2:m=t.transform(n);break;case 3:m=t.transform(n,i);break;case 4:m=t.transform(n,i,o);break;case 5:m=t.transform(n,i,o,s);break;case 6:m=t.transform(n,i,o,s,a);break;case 7:m=t.transform(n,i,o,s,a,l);break;case 8:m=t.transform(n,i,o,s,a,l,c);break;case 9:m=t.transform(n,i,o,s,a,l,c,u);break;case 10:m=t.transform(n,i,o,s,a,l,c,u,h)}}p.value=m}return p}(t,e,r,n,i,o,s,a,l,c,u,h);default:throw"unreachable"}}(t,e,n,i,o,s,a,l,c,u,h,d):function(t,e,r){switch(201347067&e.flags){case 1:return function(t,e,r){let n=!1;for(let i=0;i<r.length;i++)_n(t,e,i,r[i])&&(n=!0);return n}(t,e,r);case 2:return function(t,e,r){const n=e.bindings;let i=!1;for(let o=0;o<r.length;o++)Gr(t,e,o,r[o])&&(i=!0);if(i){let i="";for(let t=0;t<r.length;t++)i+=Ci(r[t],n[t]);i=e.text.prefix+i;const o=Ar(t,e.nodeIndex).renderText;t.renderer.setValue(o,i)}return i}(t,e,r);case 16384:return function(t,e,r){const n=Cr(t,e.nodeIndex),i=n.instance;let o=!1,s=void 0;for(let a=0;a<r.length;a++)Vr(t,e,a,r[a])&&(o=!0,s=mi(t,n,e,a,r[a],s));return s&&i.ngOnChanges(s),65536&e.flags&&Mr(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),o}(t,e,r);case 32:case 64:case 128:return function(t,e,r){const n=e.bindings;let i=!1;for(let o=0;o<r.length;o++)Gr(t,e,o,r[o])&&(i=!0);if(i){const i=Pr(t,e.nodeIndex);let o;switch(201347067&e.flags){case 32:o=r;break;case 64:o={};for(let e=0;e<r.length;e++)o[n[e].name]=r[e];break;case 128:const t=r[0],i=r.slice(1);o=t.transform(...i)}i.value=o}return i}(t,e,r);default:throw"unreachable"}}(t,e,n)}function zi(t){const e=t.def;if(4&e.nodeFlags)for(let r=0;r<e.nodes.length;r++){const n=e.nodes[r];if(4&n.flags){const e=Er(t,r).template._projectedViews;if(e)for(let r=0;r<e.length;r++){const n=e[r];n.state|=32,Xr(n,t)}}else 0==(4&n.childFlags)&&(r+=n.childCount)}}function Vi(t,e,r,n,i,o,s,a,l,c,u,h,d){return 0===r?function(t,e,r,n,i,o,s,a,l,c,u,h){const d=e.bindings.length;d>0&&Hr(t,e,0,r),d>1&&Hr(t,e,1,n),d>2&&Hr(t,e,2,i),d>3&&Hr(t,e,3,o),d>4&&Hr(t,e,4,s),d>5&&Hr(t,e,5,a),d>6&&Hr(t,e,6,l),d>7&&Hr(t,e,7,c),d>8&&Hr(t,e,8,u),d>9&&Hr(t,e,9,h)}(t,e,n,i,o,s,a,l,c,u,h,d):function(t,e,r){for(let n=0;n<r.length;n++)Hr(t,e,n,r[n])}(t,e,n),!1}function Gi(t,e){if(Or(t,e.nodeIndex).dirty)throw Lr(Nr.createDebugContext(t,e.nodeIndex),`Query ${e.query.id} not dirty`,`Query ${e.query.id} dirty`,0!=(1&t.state))}function Hi(t){if(!(128&t.state)){if(qi(t,Wi.Destroy),Xi(t,Wi.Destroy),vi(t,131072),t.disposables)for(let e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(!(16&t.state))return;const e=Yr(t);if(e){const r=e.template._projectedViews;r&&(Rn(r,r.indexOf(t)),Nr.dirtyParentQueries(t))}}(t),t.renderer.destroyNode&&function(t){const e=t.def.nodes.length;for(let r=0;r<e;r++){const e=t.def.nodes[r];1&e.flags?t.renderer.destroyNode(Er(t,r).renderElement):2&e.flags?t.renderer.destroyNode(Ar(t,r).renderText):(67108864&e.flags||134217728&e.flags)&&Or(t,r).destroy()}}(t),Kr(t)&&t.renderer.destroy(),t.state|=128}}const Wi=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function Xi(t,e){const r=t.def;if(33554432&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];33554432&i.flags?Yi(Er(t,n).componentView,e):0==(33554432&i.childFlags)&&(n+=i.childCount)}}function qi(t,e){const r=t.def;if(16777216&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];if(16777216&i.flags){const r=Er(t,n).viewContainer._embeddedViews;for(let t=0;t<r.length;t++)Yi(r[t],e)}else 0==(16777216&i.childFlags)&&(n+=i.childCount)}}function Yi(t,e){const r=t.state;switch(e){case Wi.CheckNoChanges:0==(128&r)&&(12==(12&r)?Ui(t):64&r&&Zi(t,Wi.CheckNoChangesProjectedViews));break;case Wi.CheckNoChangesProjectedViews:0==(128&r)&&(32&r?Ui(t):64&r&&Zi(t,e));break;case Wi.CheckAndUpdate:0==(128&r)&&(12==(12&r)?Bi(t):64&r&&Zi(t,Wi.CheckAndUpdateProjectedViews));break;case Wi.CheckAndUpdateProjectedViews:0==(128&r)&&(32&r?Bi(t):64&r&&Zi(t,e));break;case Wi.Destroy:Hi(t);break;case Wi.CreateViewNodes:ki(t)}}function Zi(t,e){qi(t,e),Xi(t,e)}function Ji(t,e,r,n){if(!(t.def.nodeFlags&e&&t.def.nodeFlags&r))return;const i=t.def.nodes.length;for(let o=0;o<i;o++){const i=t.def.nodes[o];if(i.flags&e&&i.flags&r)switch(Nr.setCurrentNode(t,i.nodeIndex),n){case 0:wi(t,i);break;case 1:Gi(t,i)}i.childFlags&e&&i.childFlags&r||(o+=i.childCount)}}let Qi=!1;function Ki(t,e,r,n,i,o){return Ii(to(t,i,i.injector.get(Re),e,r),n,o)}function $i(t,e,r,n,i,o){const s=i.injector.get(Re),a=to(t,i,new Do(s),e,r),l=co(n);return Io(vo.create,Ii,null,[a,l,o])}function to(t,e,r,n,i){const o=e.injector.get(Sr),s=e.injector.get(lt);return{ngModule:e,injector:t,projectableNodes:n,selectorOrNode:i,sanitizer:o,rendererFactory:r,renderer:r.createRenderer(null,null),errorHandler:s}}function eo(t,e,r,n){const i=co(r);return Io(vo.create,Li,null,[t,e,i,n])}function ro(t,e,r,n){return r=oo.get(e.element.componentProvider.provider.token)||co(r),Io(vo.create,Ri,null,[t,e,r,n])}function no(t,e,r,n){return Jn(t,e,r,function(t){const{hasOverrides:e,hasDeprecatedOverrides:r}=function(t){let e=!1,r=!1;return 0===io.size?{hasOverrides:e,hasDeprecatedOverrides:r}:(t.providers.forEach(t=>{const n=io.get(t.token);3840&t.flags&&n&&(e=!0,r=r||n.deprecatedBehavior)}),{hasOverrides:e,hasDeprecatedOverrides:r})}(t);return e?(function(t){for(let e=0;e<t.providers.length;e++){const n=t.providers[e];r&&(n.flags|=4096);const i=io.get(n.token);i&&(n.flags=-3841&n.flags|i.flags,n.deps=rn(i.deps),n.value=i.value)}}(t=t.factory(()=>Dr)),t):t}(n))}const io=new Map,oo=new Map;function so(t){io.set(t.token,t)}function ao(t,e){const r=sn(sn(e.viewDefFactory).nodes[0].element.componentView);oo.set(t,r)}function lo(){io.clear(),oo.clear()}function co(t){if(0===io.size)return t;const e=function(t){const e=[];let r=null;for(let n=0;n<t.nodes.length;n++){const i=t.nodes[n];1&i.flags&&(r=i),r&&3840&i.flags&&io.has(i.provider.token)&&(e.push(r.nodeIndex),r=null)}return e}(t);if(0===e.length)return t;t=t.factory(()=>Dr);for(let n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(let r=e+1;r<t.nodes.length;r++){const e=t.nodes[r];if(1&e.flags)return;if(3840&e.flags){const t=e.provider,r=io.get(t.token);r&&(e.flags=-3841&e.flags|r.flags,t.deps=rn(r.deps),t.value=r.value)}}}}function uo(t,e,r,n,i,o,s,a,l,c,u,h,d){const p=t.def.nodes[e];return ji(t,p,r,n,i,o,s,a,l,c,u,h,d),224&p.flags?Pr(t,e).value:void 0}function ho(t,e,r,n,i,o,s,a,l,c,u,h,d){const p=t.def.nodes[e];return Vi(t,p,r,n,i,o,s,a,l,c,u,h,d),224&p.flags?Pr(t,e).value:void 0}function po(t){return Io(vo.detectChanges,Bi,null,[t])}function fo(t){return Io(vo.checkNoChanges,Ui,null,[t])}function mo(t){return Io(vo.destroy,Hi,null,[t])}const vo=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();let go,yo,xo;function bo(t,e){yo=t,xo=e}function wo(t,e,r,n){return bo(t,e),Io(vo.handleEvent,t.def.handleEvent,null,[t,e,r,n])}function _o(t,e){if(128&t.state)throw Rr(vo[go]);return bo(t,Po(t,0)),t.def.updateDirectives(function(t,r,n,...i){const o=t.def.nodes[r];return 0===e?To(t,o,n,i):Mo(t,o,n,i),16384&o.flags&&bo(t,Po(t,r)),224&o.flags?Pr(t,o.nodeIndex).value:void 0},t)}function So(t,e){if(128&t.state)throw Rr(vo[go]);return bo(t,Oo(t,0)),t.def.updateRenderer(function(t,r,n,...i){const o=t.def.nodes[r];return 0===e?To(t,o,n,i):Mo(t,o,n,i),3&o.flags&&bo(t,Oo(t,r)),224&o.flags?Pr(t,o.nodeIndex).value:void 0},t)}function To(t,e,r,n){if(ji(t,e,r,...n)){const i=1===r?n[0]:n;if(16384&e.flags){const r={};for(let t=0;t<e.bindings.length;t++){const n=e.bindings[t],o=i[t];8&n.flags&&(r[Ao(n.nonMinifiedName)]=Co(o))}const n=e.parent,o=Er(t,n.nodeIndex).renderElement;if(n.element.name)for(let e in r){const n=r[e];null!=n?t.renderer.setAttribute(o,e,n):t.renderer.removeAttribute(o,e)}else t.renderer.setValue(o,`bindings=${JSON.stringify(r,null,2)}`)}}}function Mo(t,e,r,n){Vi(t,e,r,...n)}function Ao(t){return`ng-reflect-${t=t.replace(/[$@]/g,"_").replace(Eo,(...t)=>"-"+t[1].toLowerCase())}`}const Eo=/([A-Z])/g;function Co(t){try{return null!=t?t.toString().slice(0,30):t}catch(t){return"[ERROR] Exception while trying to serialize the value"}}function Po(t,e){for(let r=e;r<t.def.nodes.length;r++){const e=t.def.nodes[r];if(16384&e.flags&&e.bindings&&e.bindings.length)return r}return null}function Oo(t,e){for(let r=e;r<t.def.nodes.length;r++){const e=t.def.nodes[r];if(3&e.flags&&e.bindings&&e.bindings.length)return r}return null}class No{constructor(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];let r=this.nodeDef,n=t;for(;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&n;)r=Zr(n),n=n.parent;this.elDef=r,this.elView=n}get elOrCompView(){return Er(this.elView,this.elDef.nodeIndex).componentView||this.view}get injector(){return Wn(this.elView,this.elDef)}get component(){return this.elOrCompView.component}get context(){return this.elOrCompView.context}get providerTokens(){const t=[];if(this.elDef)for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const r=this.elView.def.nodes[e];20224&r.flags&&t.push(r.provider.token),e+=r.childCount}return t}get references(){const t={};if(this.elDef){Lo(this.elView,this.elDef,t);for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const r=this.elView.def.nodes[e];20224&r.flags&&Lo(this.elView,r,t),e+=r.childCount}}return t}get componentRenderElement(){const t=function(t){for(;t&&!Kr(t);)t=t.parent;return t.parent?Er(t.parent,Zr(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0}get renderNode(){return 2&this.nodeDef.flags?Jr(this.view,this.nodeDef):Jr(this.elView,this.elDef)}logError(t,...e){let r,n;2&this.nodeDef.flags?(r=this.view.def,n=this.nodeDef.nodeIndex):(r=this.elView.def,n=this.elDef.nodeIndex);const i=function(t,e){let r=-1;for(let n=0;n<=e;n++)3&t.nodes[n].flags&&r++;return r}(r,n);let o=-1;r.factory(()=>++o===i?t.error.bind(t,...e):Dr),o<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error(...e))}}function Lo(t,e,r){for(let n in e.references)r[n]=Si(t,e,e.references[n])}function Io(t,e,r,n){const i=go,o=yo,s=xo;try{go=t;const a=e.apply(r,n);return yo=o,xo=s,go=i,a}catch(t){if(ot(t)||!yo)throw t;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),Ir(t,e),t}(t,Ro())}}function Ro(){return yo?new No(yo,xo):null}class Do{constructor(t){this.delegate=t}createRenderer(t,e){return new Fo(this.delegate.createRenderer(t,e))}begin(){this.delegate.begin&&this.delegate.begin()}end(){this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}class Fo{constructor(t){this.delegate=t,this.data=this.delegate.data}destroyNode(t){!function(t){Ke.delete(t.nativeNode)}($e(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)}destroy(){this.delegate.destroy()}createElement(t,e){const r=this.delegate.createElement(t,e),n=Ro();if(n){const e=new Qe(r,null,n);e.name=t,tr(e)}return r}createComment(t){const e=this.delegate.createComment(t),r=Ro();return r&&tr(new Je(e,null,r)),e}createText(t){const e=this.delegate.createText(t),r=Ro();return r&&tr(new Je(e,null,r)),e}appendChild(t,e){const r=$e(t),n=$e(e);r&&n&&r instanceof Qe&&r.addChild(n),this.delegate.appendChild(t,e)}insertBefore(t,e,r){const n=$e(t),i=$e(e),o=$e(r);n&&i&&n instanceof Qe&&n.insertBefore(o,i),this.delegate.insertBefore(t,e,r)}removeChild(t,e){const r=$e(t),n=$e(e);r&&n&&r instanceof Qe&&r.removeChild(n),this.delegate.removeChild(t,e)}selectRootElement(t){const e=this.delegate.selectRootElement(t),r=Ro();return r&&tr(new Qe(e,null,r)),e}setAttribute(t,e,r,n){const i=$e(t);i&&i instanceof Qe&&(i.attributes[n?n+":"+e:e]=r),this.delegate.setAttribute(t,e,r,n)}removeAttribute(t,e,r){const n=$e(t);n&&n instanceof Qe&&(n.attributes[r?r+":"+e:e]=null),this.delegate.removeAttribute(t,e,r)}addClass(t,e){const r=$e(t);r&&r instanceof Qe&&(r.classes[e]=!0),this.delegate.addClass(t,e)}removeClass(t,e){const r=$e(t);r&&r instanceof Qe&&(r.classes[e]=!1),this.delegate.removeClass(t,e)}setStyle(t,e,r,n){const i=$e(t);i&&i instanceof Qe&&(i.styles[e]=r),this.delegate.setStyle(t,e,r,n)}removeStyle(t,e,r){const n=$e(t);n&&n instanceof Qe&&(n.styles[e]=null),this.delegate.removeStyle(t,e,r)}setProperty(t,e,r){const n=$e(t);n&&n instanceof Qe&&(n.properties[e]=r),this.delegate.setProperty(t,e,r)}listen(t,e,r){if("string"!=typeof t){const n=$e(t);n&&n.listeners.push(new Ze(e,r))}return this.delegate.listen(t,e,r)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setValue(t,e){return this.delegate.setValue(t,e)}}function ko(t,e,r){return new Uo(t,e,r)}class Uo extends ne{constructor(t,e,r){super(),this.moduleType=t,this._bootstrapComponents=e,this._ngModuleDefFactory=r}create(t){!function(){if(Qi)return;Qi=!0;const t=Ae()?{setCurrentNode:bo,createRootView:$i,createEmbeddedView:eo,createComponentView:ro,createNgModuleRef:no,overrideProvider:so,overrideComponentView:ao,clearOverrides:lo,checkAndUpdateView:po,checkNoChangesView:fo,destroyView:mo,createDebugContext:(t,e)=>new No(t,e),handleEvent:wo,updateDirectives:_o,updateRenderer:So}:{setCurrentNode:()=>{},createRootView:Ki,createEmbeddedView:Li,createComponentView:Ri,createNgModuleRef:Jn,overrideProvider:Dr,overrideComponentView:Dr,clearOverrides:Dr,checkAndUpdateView:Bi,checkNoChangesView:Ui,destroyView:Hi,createDebugContext:(t,e)=>new No(t,e),handleEvent:(t,e,r,n)=>t.def.handleEvent(t,e,r,n),updateDirectives:(t,e)=>t.def.updateDirectives(0===e?uo:ho,t),updateRenderer:(t,e)=>t.def.updateRenderer(0===e?uo:ho,t)};Nr.setCurrentNode=t.setCurrentNode,Nr.createRootView=t.createRootView,Nr.createEmbeddedView=t.createEmbeddedView,Nr.createComponentView=t.createComponentView,Nr.createNgModuleRef=t.createNgModuleRef,Nr.overrideProvider=t.overrideProvider,Nr.overrideComponentView=t.overrideComponentView,Nr.clearOverrides=t.clearOverrides,Nr.checkAndUpdateView=t.checkAndUpdateView,Nr.checkNoChangesView=t.checkNoChangesView,Nr.destroyView=t.destroyView,Nr.resolveDep=pi,Nr.createDebugContext=t.createDebugContext,Nr.handleEvent=t.handleEvent,Nr.updateDirectives=t.updateDirectives,Nr.updateRenderer=t.updateRenderer,Nr.dirtyParentQueries=bi}();const e=sn(this._ngModuleDefFactory);return Nr.createNgModuleRef(this.moduleType,t||j.NULL,this._bootstrapComponents,e)}}let Bo;"undefined"==typeof ngDevMode&&("undefined"!=typeof window&&(window.ngDevMode=!0),"undefined"!=typeof self&&(self.ngDevMode=!0),"undefined"!=typeof t&&(t.ngDevMode=!0)),Bo={parent:Bo,id:null,node:null,data:[],ngStaticData:[],cleanup:null,renderer:null,child:null,tail:null,next:null,bindingStartIndex:null,creationMode:!0,viewHookStartIndex:null}}).call(e,r("DuR2"))},"4LTl":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e,r,n,i,o,s,a,l,c){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.text=e,this.style=r,this.width=n,this.height=i,this.lines=o,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}return t.measureText=function(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t._canvas;n=n||r.wordWrap;var o=r.toFontString(),s=t.measureFont(o),a=i.getContext("2d");a.font=o;for(var l=(n?t.wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),u=0,h=0;h<l.length;h++){var d=a.measureText(l[h]).width+(l[h].length-1)*r.letterSpacing;c[h]=d,u=Math.max(u,d)}var p=u+r.strokeThickness;r.dropShadow&&(p+=r.dropShadowDistance);var f=r.lineHeight||s.fontSize+r.strokeThickness,m=Math.max(f,s.fontSize+r.strokeThickness)+(l.length-1)*(f+r.leading);return r.dropShadow&&(m+=r.dropShadowDistance),new t(e,r,p,m,l,c,f+r.leading,u,s)},t.wordWrap=function(e,r){for(var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas).getContext("2d"),i="",o=0,s="",a={},l=r.letterSpacing,c=r.wordWrapWidth+r.letterSpacing,u=t.getFromCache(" ",l,a,n),h=e.split(" "),d=0;d<h.length;d++){var p=h[d],f=t.getFromCache(p,l,a,n);if(f>c)if(r.breakWords)for(var m=(i.length>0?" "+p:p).split(""),v=0;v<m.length;v++){var g=m[v],y=t.getFromCache(g,l,a,n);y+o>c&&(s+=t.addLine(i),i="",o=0),i+=g,o+=y}else i.length>0&&(s+=t.addLine(i),i="",o=0),s+=t.addLine(p),i="",o=0;else f+o>c&&(s+=t.addLine(i),i="",o=0),i+=i.length>0?" "+p:p,o+=f+u}return s+t.addLine(i,!1)},t.addLine=function(t){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:t+"\n"},t.getFromCache=function(t,e,r,n){var i=r[t];if(void 0===i){var o=t.length*e;i=n.measureText(t).width+o,r[t]=i}return i},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var r={},n=t._canvas,i=t._context;i.font=e;var o=Math.ceil(i.measureText("|M\xc9q").width),s=Math.ceil(i.measureText("M").width),a=2*s;s=1.4*s|0,n.width=o,n.height=a,i.fillStyle="#f00",i.fillRect(0,0,o,a),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|M\xc9q",0,s);var l=i.getImageData(0,0,o,a).data,c=l.length,u=4*o,h=0,d=0,p=!1;for(h=0;h<s;++h){for(var f=0;f<u;f+=4)if(255!==l[d+f]){p=!0;break}if(p)break;d+=u}for(r.ascent=s-h,d=c-u,p=!1,h=a;h>s;--h){for(var m=0;m<u;m+=4)if(255!==l[d+m]){p=!0;break}if(p)break;d-=u}return r.descent=h-s,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r},t}();e.default=n;var i=document.createElement("canvas");i.width=i.height=10,n._canvas=i,n._context=i.getContext("2d"),n._fonts={}},"4Nog":function(t,e,r){"use strict";e.__esModule=!0;var n=f(r("dtlK")),i=f(r("1g9v")),o=f(r("qD+0")),s=f(r("Z1wJ")),a=f(r("izXE")),l=r("Q5/2"),c=r("aH6o"),u=r("FjAT"),h=f(r("F+P4")),d=f(r("icz7")),p=f(r("5tzz"));function f(t){return t&&t.__esModule?t:{default:t}}var m=void 0,v=new l.Matrix,g=new l.Point,y=new Float32Array(4),x=new Float32Array(4),b=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n.fillAlpha=1,n.lineWidth=0,n.nativeLines=r,n.lineColor=0,n.graphicsData=[],n.tint=16777215,n._prevTint=16777215,n.blendMode=u.BLEND_MODES.NORMAL,n.currentPath=null,n._webGL={},n.isMask=!1,n.boundsPadding=0,n._localBounds=new h.default,n.dirty=0,n.fastRectDirty=-1,n.clearDirty=0,n.boundsDirty=-1,n.cachedSpriteDirty=!1,n._spriteRect=null,n._fastRect=!1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.clone=function(){var t=new e;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var r=0;r<this.graphicsData.length;++r)t.graphicsData.push(this.graphicsData[r].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},e.prototype.lineStyle=function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.lineWidth=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this.lineColor=t,this.lineAlpha=e,this.currentPath)if(this.currentPath.shape.points.length){var r=new l.Polygon(this.currentPath.shape.points.slice(-2));r.closed=!1,this.drawShape(r)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},e.prototype.moveTo=function(t,e){var r=new l.Polygon([t,e]);return r.closed=!1,this.drawShape(r),this},e.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty++,this},e.prototype.quadraticCurveTo=function(t,e,r,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i=this.currentPath.shape.points,o=0,s=0;0===i.length&&this.moveTo(0,0);for(var a=i[i.length-2],l=i[i.length-1],c=1;c<=20;++c){var u=c/20;i.push((o=a+(t-a)*u)+(t+(r-t)*u-o)*u,(s=l+(e-l)*u)+(e+(n-e)*u-s)*u)}return this.dirty++,this},e.prototype.bezierCurveTo=function(t,e,r,n,i,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s=this.currentPath.shape.points,a=s[s.length-2],l=s[s.length-1];return s.length-=2,(0,d.default)(a,l,t,e,r,n,i,o,s),this.dirty++,this},e.prototype.arcTo=function(t,e,r,n,i){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,s=o[o.length-1]-e,a=o[o.length-2]-t,l=n-e,c=r-t,u=Math.abs(s*c-a*l);if(u<1e-8||0===i)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var h=s*s+a*a,d=l*l+c*c,p=s*l+a*c,f=i*Math.sqrt(h)/u,m=i*Math.sqrt(d)/u,v=f*p/h,g=m*p/d,y=f*c+m*a,x=f*l+m*s,b=c*(f+g),w=l*(f+g),_=Math.atan2(s*(m+v)-x,a*(m+v)-y),S=Math.atan2(w-x,b-y);this.arc(y+t,x+e,i,_,S,a*l>c*s)}return this.dirty++,this},e.prototype.arc=function(t,e,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(n===i)return this;!o&&i<=n?i+=u.PI_2:o&&n<=i&&(n+=u.PI_2);var s=i-n,a=40*Math.ceil(Math.abs(s)/u.PI_2);if(0===s)return this;var l=t+Math.cos(n)*r,c=e+Math.sin(n)*r,h=this.currentPath?this.currentPath.shape.points:null;h?h[h.length-2]===l&&h[h.length-1]===c||h.push(l,c):(this.moveTo(l,c),h=this.currentPath.shape.points);for(var d=s/(2*a),p=2*d,f=Math.cos(d),m=Math.sin(d),v=a-1,g=v%1/v,y=0;y<=v;++y){var x=d+n+p*(y+g*y),b=Math.cos(x),w=-Math.sin(x);h.push((f*b+m*w)*r+t,(f*-w+m*b)*r+e)}return this.dirty++,this},e.prototype.beginFill=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=t,this.fillAlpha=e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.prototype.drawRect=function(t,e,r,n){return this.drawShape(new l.Rectangle(t,e,r,n)),this},e.prototype.drawRoundedRect=function(t,e,r,n,i){return this.drawShape(new l.RoundedRectangle(t,e,r,n,i)),this},e.prototype.drawCircle=function(t,e,r){return this.drawShape(new l.Circle(t,e,r)),this},e.prototype.drawEllipse=function(t,e,r,n){return this.drawShape(new l.Ellipse(t,e,r,n)),this},e.prototype.drawPolygon=function(t){var e=t,r=!0;if(e instanceof l.Polygon&&(r=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var n=0;n<e.length;++n)e[n]=arguments[n]}var i=new l.Polygon(e);return i.closed=r,this.drawShape(i),this},e.prototype.drawStar=function(t,e,r,n,i){i=i||n/2;for(var o=-1*Math.PI/2+(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0),s=2*r,a=u.PI_2/s,l=[],c=0;c<s;c++){var h=c%2?i:n,d=c*a+o;l.push(t+h*Math.cos(d),e+h*Math.sin(d))}return this.drawPolygon(l)},e.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.filling=!1,this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},e.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===u.SHAPES.RECT&&!this.graphicsData[0].lineWidth},e.prototype._renderWebGL=function(t){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(t):(t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this))},e.prototype._renderSpriteRect=function(t){var e=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new a.default(new o.default(o.default.WHITE)));var r=this._spriteRect;if(16777215===this.tint)r.tint=this.graphicsData[0].fillColor;else{var n=y,i=x;(0,c.hex2rgb)(this.graphicsData[0].fillColor,n),(0,c.hex2rgb)(this.tint,i),n[0]*=i[0],n[1]*=i[1],n[2]*=i[2],r.tint=(0,c.rgb2hex)(n)}r.alpha=this.graphicsData[0].fillAlpha,r.worldAlpha=this.worldAlpha*r.alpha,r.blendMode=this.blendMode,r._texture._frame.width=e.width,r._texture._frame.height=e.height,r.transform.worldTransform=this.transform.worldTransform,r.anchor.set(-e.x/e.width,-e.y/e.height),r._onAnchorUpdate(),r._renderWebGL(t)},e.prototype._renderCanvas=function(t){!0!==this.isMask&&t.plugins.graphics.render(this)},e.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var t=this._localBounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,g);for(var e=this.graphicsData,r=0;r<e.length;++r){var n=e[r];if(n.fill&&n.shape&&n.shape.contains(g.x,g.y)){if(n.holes)for(var i=0;i<n.holes.length;i++)if(n.holes[i].contains(g.x,g.y))return!1;return!0}}return!1},e.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,r=1/0,n=-1/0;if(this.graphicsData.length)for(var i=0,o=0,s=0,a=0,l=0,c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],d=h.type,p=h.lineWidth;if(i=h.shape,d===u.SHAPES.RECT||d===u.SHAPES.RREC)s=i.y-p/2,a=i.width+p,l=i.height+p,t=(o=i.x-p/2)<t?o:t,e=o+a>e?o+a:e,r=s<r?s:r,n=s+l>n?s+l:n;else if(d===u.SHAPES.CIRC)s=i.y,l=i.radius+p/2,t=(o=i.x)-(a=i.radius+p/2)<t?o-a:t,e=o+a>e?o+a:e,r=s-l<r?s-l:r,n=s+l>n?s+l:n;else if(d===u.SHAPES.ELIP)s=i.y,l=i.height+p/2,t=(o=i.x)-(a=i.width+p/2)<t?o-a:t,e=o+a>e?o+a:e,r=s-l<r?s-l:r,n=s+l>n?s+l:n;else for(var f=i.points,m=0,v=0,g=0,y=0,x=0,b=0,w=0,_=0,S=0;S+2<f.length;S+=2)o=f[S],s=f[S+1],m=f[S+2],v=f[S+3],g=Math.abs(m-o),y=Math.abs(v-s),l=p,(a=Math.sqrt(g*g+y*y))<1e-9||(b=(l/a*g+y)/2,_=(v+s)/2,t=(w=(m+o)/2)-(x=(l/a*y+g)/2)<t?w-x:t,e=w+x>e?w+x:e,r=_-b<r?_-b:r,n=_+b>n?_+b:n)}else t=0,e=0,r=0,n=0;var T=this.boundsPadding;this._localBounds.minX=t-T,this._localBounds.maxX=e+T,this._localBounds.minY=r-T,this._localBounds.maxY=n+T},e.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new s.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,t);return this.graphicsData.push(e),e.type===u.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty++,e},e.prototype.generateCanvasTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.getLocalBounds(),n=i.default.create(r.width,r.height,t,e);m||(m=new p.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(v),v.invert(),v.tx-=r.x,v.ty-=r.y,m.render(this,n,!0,v);var s=o.default.fromCanvas(n.baseTexture._canvasRenderTarget.canvas,t,"graphics");return s.baseTexture.resolution=e,s.baseTexture.update(),s},e.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},e.prototype.addHole=function(){var t=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(t.shape),this.currentPath=null,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();for(var n in this._webgl)for(var i=0;i<this._webgl[n].data.length;++i)this._webgl[n].data[i].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null},e}(n.default);e.default=b,b._SPRITE_TEXTURE=null},"4iP9":function(t,e,r){"use strict";e.a=function(){return t=>Object(i.a)()(Object(n.a)(s)(t))};var n=r("V2zk"),i=r("AnYr"),o=r("W/Sc");function s(){return new o.b}},"5+9/":function(t,e,r){var n=r("ZOjo"),i=r("gVZZ"),o=r("ElvI"),s=r("QamB"),a=r("9rXv"),l=r("Fy0/")("engine.io-client:polling");t.exports=u;var c=null!=new(r("P2cu"))({xdomain:!1}).responseType;function u(t){c&&!(t&&t.forceBase64)||(this.supportsBinary=!1),n.call(this,t)}s(u,n),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(t){var e=this;function r(){l("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(l("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){l("pre-pause polling complete"),--n||r()})),this.writable||(l("we are currently writing - waiting to pause"),n++,this.once("drain",function(){l("pre-pause writing complete"),--n||r()}))}else r()},u.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(t){var e=this;l("polling got data %s",t),o.decodePayload(t,this.socket.binaryType,function(t,r,n){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var t=this;function e(){l("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))},u.prototype.write=function(t){var e=this;this.writable=!1;var r=function(){e.writable=!0,e.emit("drain")};o.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,r)})},u.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(t[this.timestampParam]=a()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(r=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t}},"5+KW":function(t,e,r){(function(e){var n=r("sOR5"),i=Object.prototype.toString,o="function"==typeof e.Blob||"[object BlobConstructor]"===i.call(e.Blob),s="function"==typeof e.File||"[object FileConstructor]"===i.call(e.File);t.exports=function t(r){if(!r||"object"!=typeof r)return!1;if(n(r)){for(var i=0,a=r.length;i<a;i++)if(t(r[i]))return!0;return!1}if("function"==typeof e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(r)||"function"==typeof e.ArrayBuffer&&r instanceof ArrayBuffer||o&&r instanceof Blob||s&&r instanceof File)return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return t(r.toJSON(),!0);for(var l in r)if(Object.prototype.hasOwnProperty.call(r,l)&&t(r[l]))return!0;return!1}}).call(e,r("DuR2"))},"50uv":function(t,e,r){"use strict";(function(t){e.__esModule=!0,e.loader=e.prepare=e.particles=e.mesh=e.loaders=e.interaction=e.filters=e.extras=e.extract=e.accessibility=void 0;var n=r("cv0E");Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var i=r("/B0E");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=function(t){return t&&t.__esModule?t:{default:t}}(r("slDu")),s=m(r("kEDM")),a=m(r("+MIv")),l=m(r("PMti")),c=m(r("d8XH")),u=m(r("LGVh")),h=m(r("gVev")),d=m(r("B13k")),p=m(r("9bEX")),f=m(r("QyjV"));function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}i.utils.mixins.performMixins();var v=h.shared||null;e.accessibility=s,e.extract=a,e.extras=l,e.filters=c,e.interaction=u,e.loaders=h,e.mesh=d,e.particles=p,e.prepare=f,e.loader=v,"function"==typeof o.default&&(0,o.default)(e),t.PIXI=e}).call(e,r("DuR2"))},"5Ljx":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=n[t],r=e.length,o=i,s="",a=void 0,l=0;l<t;l++){var c="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",l);a=l,l>=r&&(a=t-l-1),s+=c=c.replace("%value%",e[a]),s+="\n"}return(o=o.replace("%blur%",s)).replace("%size%",t)};var n={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},i=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n")},"5XUO":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("oUe4"),o=c(r("dtlK")),s=r("z1Av"),a=c(r("/MUw")),l=r("FjAT");function c(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,r,n,l,c){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"number"==typeof e&&(e=Object.assign({width:e,height:r||a.default.RENDER_OPTIONS.height,forceCanvas:!!l,sharedTicker:!!c},n)),this._options=e=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},e),this.renderer=(0,i.autoDetectRenderer)(e),this.stage=new o.default,this._ticker=null,this.ticker=e.sharedTicker?s.shared:new s.Ticker,e.autoStart&&this.start()}return t.prototype.render=function(){this.renderer.render(this.stage)},t.prototype.stop=function(){this._ticker.stop()},t.prototype.start=function(){this._ticker.start()},t.prototype.destroy=function(t){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}this.stage.destroy(),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},n(t,[{key:"ticker",set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,l.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),t}();e.default=u},"5tzz":function(t,e,r){"use strict";e.__esModule=!0;var n=u(r("PjB0")),i=u(r("UsJC")),o=u(r("vwuV")),s=u(r("Q/rl")),a=r("aH6o"),l=r("FjAT"),c=u(r("/MUw"));function u(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(r,n,o){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"Canvas",r,n,o));return a.type=l.RENDERER_TYPE.CANVAS,a.rootContext=a.view.getContext("2d",{alpha:a.transparent}),a.context=a.rootContext,a.refresh=!0,a.maskManager=new i.default(a),a.smoothProperty="imageSmoothingEnabled",a.rootContext.imageSmoothingEnabled||(a.rootContext.webkitImageSmoothingEnabled?a.smoothProperty="webkitImageSmoothingEnabled":a.rootContext.mozImageSmoothingEnabled?a.smoothProperty="mozImageSmoothingEnabled":a.rootContext.oImageSmoothingEnabled?a.smoothProperty="oImageSmoothingEnabled":a.rootContext.msImageSmoothingEnabled&&(a.smoothProperty="msImageSmoothingEnabled")),a.initPlugins(),a.blendModes=(0,s.default)(),a._activeBlendMode=null,a.renderingToScreen=!1,a.resize(a.options.width,a.options.height),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(t,e,r,n,i){if(this.view){this.renderingToScreen=!e,this.emit("prerender");var s=this.resolution;e?((e=e.baseTexture||e)._canvasRenderTarget||(e._canvasRenderTarget=new o.default(e.width,e.height,e.resolution),e.source=e._canvasRenderTarget.canvas,e.valid=!0),this.context=e._canvasRenderTarget.context,this.resolution=e._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(e||(this._lastObjectRendered=t),!i){var c=t.parent,u=this._tempDisplayObjectParent.transform.worldTransform;n?(n.copy(u),this._tempDisplayObjectParent.transform._worldID=-1):u.identity(),t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=c}a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=l.BLEND_MODES.NORMAL,a.globalCompositeOperation=this.blendModes[l.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(a.fillStyle="black",a.clear()),(void 0!==r?r:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?a.clearRect(0,0,this.width,this.height):(a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height)));var h=this.context;this.context=a,t.renderCanvas(this),this.context=h,a.restore(),this.resolution=s,this.emit("postrender")}},e.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},e.prototype.setBlendMode=function(t){this._activeBlendMode!==t&&(this._activeBlendMode=t,this.context.globalCompositeOperation=this.blendModes[t])},e.prototype.destroy=function(e){this.destroyPlugins(),t.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},e.prototype.resize=function(e,r){t.prototype.resize.call(this,e,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=c.default.SCALE_MODE===l.SCALE_MODES.LINEAR)},e.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},e}(n.default);e.default=h,a.pluginTarget.mixin(h)},"66C6":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=s(r("tOxb")),o=s(r("bva0"));function s(t){return t&&t.__esModule?t:{default:t}}var a=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;function c(){}var u=function(){function t(e,r,n){if(function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),"string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=c,this._onLoadBinding=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this),this.onStart=new o.default,this.onProgress=new o.default,this.onComplete=new o.default,this.onAfterMiddleware=new o.default}return t.setExtensionLoadType=function(e,r){h(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){h(t._xhrTypeMap,e,r)},t.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},t.prototype.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(r)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:a&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return!!(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._loadElement=function(t){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===t&&"undefined"!=typeof window.Image?new Image:document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},t.prototype._loadSourceElement=function(t){if(this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===t&&"undefined"!=typeof window.Audio?new Audio:document.createElement(t),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else{var n=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(n)?n[0]:n))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.responseType=this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?t.XHR_RESPONSE_TYPE.TEXT:this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},t.prototype._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var n=document.createElement("source");return n.src=e,n.type=r,n},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(d(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnAbort=function(){this.abort(d(this.xhr)+" Request was aborted by the user.")},t.prototype._xdrOnTimeout=function(){this.abort(d(this.xhr)+" Request timed out.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,r="",n="undefined"==typeof e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&"undefined"!=typeof e.responseType||(r=e.responseText),0===n&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2==(n/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){return 0===t.indexOf("data:")?"":(e=e||window.location,l||(l=document.createElement("a")),l.href=t,(t=(0,i.default)(l.href,{strictMode:!0})).host!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||(t.protocol?t.protocol+":":"")!==e.protocol?"anonymous":"")},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var n=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(n>-1?n:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function h(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function d(t){return t.toString().replace("object ","")}e.default=u,u.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},u.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},u.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},u.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},u._loadTypeMap={gif:u.LOAD_TYPE.IMAGE,png:u.LOAD_TYPE.IMAGE,bmp:u.LOAD_TYPE.IMAGE,jpg:u.LOAD_TYPE.IMAGE,jpeg:u.LOAD_TYPE.IMAGE,tif:u.LOAD_TYPE.IMAGE,tiff:u.LOAD_TYPE.IMAGE,webp:u.LOAD_TYPE.IMAGE,tga:u.LOAD_TYPE.IMAGE,svg:u.LOAD_TYPE.IMAGE,"svg+xml":u.LOAD_TYPE.IMAGE,mp3:u.LOAD_TYPE.AUDIO,ogg:u.LOAD_TYPE.AUDIO,wav:u.LOAD_TYPE.AUDIO,mp4:u.LOAD_TYPE.VIDEO,webm:u.LOAD_TYPE.VIDEO},u._xhrTypeMap={xhtml:u.XHR_RESPONSE_TYPE.DOCUMENT,html:u.XHR_RESPONSE_TYPE.DOCUMENT,htm:u.XHR_RESPONSE_TYPE.DOCUMENT,xml:u.XHR_RESPONSE_TYPE.DOCUMENT,tmx:u.XHR_RESPONSE_TYPE.DOCUMENT,svg:u.XHR_RESPONSE_TYPE.DOCUMENT,tsx:u.XHR_RESPONSE_TYPE.DOCUMENT,gif:u.XHR_RESPONSE_TYPE.BLOB,png:u.XHR_RESPONSE_TYPE.BLOB,bmp:u.XHR_RESPONSE_TYPE.BLOB,jpg:u.XHR_RESPONSE_TYPE.BLOB,jpeg:u.XHR_RESPONSE_TYPE.BLOB,tif:u.XHR_RESPONSE_TYPE.BLOB,tiff:u.XHR_RESPONSE_TYPE.BLOB,webp:u.XHR_RESPONSE_TYPE.BLOB,tga:u.XHR_RESPONSE_TYPE.BLOB,json:u.XHR_RESPONSE_TYPE.JSON,text:u.XHR_RESPONSE_TYPE.TEXT,txt:u.XHR_RESPONSE_TYPE.TEXT,ttf:u.XHR_RESPONSE_TYPE.BUFFER,otf:u.XHR_RESPONSE_TYPE.BUFFER},u.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},"6Lyv":function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));n.DisplayObject.prototype.name=null,n.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},"6MRC":function(t,e,r){"use strict";const n=Array.isArray||(t=>t&&"number"==typeof t.length);e.a=n},"6Pue":function(t,e,r){"use strict";e.__esModule=!0;var n=c(r("SMx8")),i=r("gxtk"),o=c(r("BzvE")),s=c(r("nfXk")),a=c(r("13Cv")),l=c(r("j9EU"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,n));o.default.call(i);for(var s=0;s<e._pixiMiddleware.length;++s)i.use(e._pixiMiddleware[s]());return i.onStart.add(function(t){return i.emit("start",t)}),i.onProgress.add(function(t,e){return i.emit("progress",t,e)}),i.onError.add(function(t,e,r){return i.emit("error",t,e,r)}),i.onLoad.add(function(t,e){return i.emit("load",t,e)}),i.onComplete.add(function(t,e){return i.emit("complete",t,e)}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.addPixiMiddleware=function(t){e._pixiMiddleware.push(t)},e.prototype.destroy=function(){this.removeAllListeners(),this.reset()},e}(n.default);for(var h in e.default=u,o.default.prototype)u.prototype[h]=o.default.prototype[h];u._pixiMiddleware=[i.blobMiddlewareFactory,s.default,a.default,l.default];var d=n.default.Resource;d.setExtensionXhrType("fnt",d.XHR_RESPONSE_TYPE.DOCUMENT)},"6mly":function(t,e,r){(function(e){var r=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}();function o(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}t[e]=n}}}t.exports=n?i?e.Blob:function(t,e){return o(t),new Blob(t,e||{})}:r&&r.prototype.append&&r.prototype.getBlob?function(t,e){e=e||{};var n=new r;o(t);for(var i=0;i<t.length;i++)n.append(t[i]);return e.type?n.getBlob(e.type):n.getBlob()}:void 0}).call(e,r("DuR2"))},"6nzH":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("kpDK")),i=function(t){function e(r,i,o){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return s._ready=!0,s.verticesX=i||10,s.verticesY=o||10,s.drawMode=n.default.DRAW_MODES.TRIANGLES,s.refresh(),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){for(var t=this._texture,e=this.verticesX*this.verticesY,r=[],n=[],i=[],o=this.verticesX-1,s=this.verticesY-1,a=t.width/o,l=t.height/s,c=0;c<e;c++){var u=c%this.verticesX,h=c/this.verticesX|0;r.push(u*a,h*l),n.push(u/o,h/s)}for(var d=o*s,p=0;p<d;p++){var f=p%o,m=p/o|0,v=m*this.verticesX+f+1,g=(m+1)*this.verticesX+f,y=(m+1)*this.verticesX+f+1;i.push(m*this.verticesX+f,v,g),i.push(v,y,g)}this.vertices=new Float32Array(r),this.uvs=new Float32Array(n),this.colors=new Float32Array([]),this.indices=new Uint16Array(i),this.dirty++,this.indexDirty++,this.multiplyUvs()},e.prototype._onTextureUpdate=function(){n.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},e}(n.default);e.default=i},"73El":function(t,e,r){"use strict";var n=r("bbL7"),i=r("crq8"),o=r("jzaW"),s=r("FvzS"),a=r("ves3"),l=r("dzdQ"),c=r("2zkT");class u extends c.a{constructor(t,e,r){super(),this.parent=t,this.outerValue=e,this.outerIndex=r,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var h=r("zOxy");e.a=function(t,e,r,c){let d=new u(t,r,c);if(d.closed)return null;if(e instanceof a.a)return e._isScalar?(d.next(e.value),d.complete(),null):(d.syncErrorThrowable=!0,e.subscribe(d));if(Object(i.a)(e)){for(let t=0,r=e.length;t<r&&!d.closed;t++)d.next(e[t]);d.closed||d.complete()}else{if(Object(o.a)(e))return e.then(t=>{d.closed||(d.next(t),d.complete())},t=>d.error(t)).then(null,t=>{n.a.setTimeout(()=>{throw t})}),d;if(e&&"function"==typeof e[l.a]){const t=e[l.a]();for(;;){let e=t.next();if(e.done){d.complete();break}if(d.next(e.value),d.closed)break}}else if(e&&"function"==typeof e[h.a]){const n=e[h.a]();if("function"==typeof n.subscribe)return n.subscribe(new u(t,r,c));d.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{const t=`You provided ${Object(s.a)(e)?"an invalid object":`'${e}'`} where a stream was expected.`+" You can provide an Observable, Promise, Array, or Iterable.";d.error(new TypeError(t))}}return null}},"73T8":function(t,e,r){"use strict";const n=r("bbL7").a.Symbol,i="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber";e.a=i},"7F6j":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("zFUS")),i=r("FjAT"),o=function(){function t(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),Array.isArray(r[0])&&(r=r[0]),r[0]instanceof n.default){for(var s=[],a=0,l=r.length;a<l;a++)s.push(r[a].x,r[a].y);r=s}this.closed=!0,this.points=r,this.type=i.SHAPES.POLY}return t.prototype.clone=function(){return new t(this.points.slice())},t.prototype.close=function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1])},t.prototype.contains=function(t,e){for(var r=!1,n=this.points.length/2,i=0,o=n-1;i<n;o=i++){var s=this.points[2*i],a=this.points[2*i+1],l=this.points[2*o+1];a>e!=l>e&&t<(e-a)/(l-a)*(this.points[2*o]-s)+s&&(r=!r)}return r},t}();e.default=o},"7IZn":function(t,e,r){var n=r("NZvU"),i=r("3JLa"),o=function(t,e,r,n){gl.vertexAttribPointer(this.location,this.size,t||gl.FLOAT,e||!1,r||0,n||0)};t.exports=function(t,e){for(var r={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),a=0;a<s;a++){var l=t.getActiveAttrib(e,a),c=n(t,l.type);r[l.name]={type:c,size:i(c),location:t.getAttribLocation(e,l.name),pointer:o}}return r}},"7VTH":function(t,e,r){"use strict";e.__esModule=!0,e.encodeBinary=function(t){for(var e="",r=0;r<t.length;){for(var i=[0,0,0],o=[0,0,0,0],s=0;s<i.length;++s)i[s]=r<t.length?255&t.charCodeAt(r++):0;switch(o[0]=i[0]>>2,o[1]=(3&i[0])<<4|i[1]>>4,o[2]=(15&i[1])<<2|i[2]>>6,o[3]=63&i[2],r-(t.length-1)){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64}for(var a=0;a<o.length;++a)e+=n.charAt(o[a])}return e};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},"7VlU":function(t,e,r){"use strict";e.a=function(...t){return i(t)},e.b=i;var n=r("Niek");function i(t){return t?1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}:n.a}},"7nan":function(t,e,r){"use strict";e.a=class extends Error{constructor(){const t=super("object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}}},"8QNu":function(t,e,r){var n={createContext:r("/brp"),setVertexAttribArrays:r("/9A/"),GLBuffer:r("bBNR"),GLFramebuffer:r("U7Sr"),GLShader:r("Q5o8"),GLTexture:r("Q+pJ"),VertexArrayObject:r("Cvg1"),shader:r("rW72")};"undefined"!=typeof t&&t.exports&&(t.exports=n),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=n)},"8USZ":function(t,e,r){"use strict";e.__esModule=!0;var n=r("aH6o"),i=l(r("/MUw")),o=l(r("BzvE")),s=l(r("h9yw")),a=l(r("eWjs"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,o,s){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return a.uid=(0,n.uid)(),a.touched=0,a.resolution=s||i.default.RESOLUTION,a.width=100,a.height=100,a.realWidth=100,a.realHeight=100,a.scaleMode=void 0!==o?o:i.default.SCALE_MODE,a.hasLoaded=!1,a.isLoading=!1,a.source=null,a.origSource=null,a.imageType=null,a.sourceScale=1,a.premultipliedAlpha=!0,a.imageUrl=null,a.isPowerOfTwo=!1,a.mipmap=i.default.MIPMAP_TEXTURES,a.wrapMode=i.default.WRAP_MODE,a._glTextures={},a._enabled=0,a._virtalBoundId=-1,a._destroyed=!1,a.textureCacheIds=[],r&&a.loadSource(r),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},e.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=a.default.isPow2(this.realWidth)&&a.default.isPow2(this.realHeight)},e.prototype.loadSource=function(t){var e=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null);var r=!this.source;if(this.source=t,(t.src&&t.complete||t.getContext)&&t.width&&t.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),r&&this.emit("loaded",this);else if(!t.getContext){this.isLoading=!0;var n=this;if(t.onload=function(){n._updateImageType(),t.onload=null,t.onerror=null,n.isLoading&&(n.isLoading=!1,n._sourceLoaded(),"svg"!==n.imageType?n.emit("loaded",n):n._loadSvgSource())},t.onerror=function(){t.onload=null,t.onerror=null,n.isLoading&&(n.isLoading=!1,n.emit("error",n))},t.complete&&t.src){if(t.onload=null,t.onerror=null,"svg"===n.imageType)return void n._loadSvgSource();this.isLoading=!1,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this)}}},e.prototype._updateImageType=function(){if(this.imageUrl){var t=(0,n.decomposeDataUri)(this.imageUrl),e=void 0;if(t&&"image"===t.mediaType){var r=t.subType.split("+")[0];if(!(e=(0,n.getUrlFileExtension)("."+r)))throw new Error("Invalid image type in data URI.")}else(e=(0,n.getUrlFileExtension)(this.imageUrl))||(e="png");this.imageType=e}},e.prototype._loadSvgSource=function(){if("svg"===this.imageType){var t=(0,n.decomposeDataUri)(this.imageUrl);t?this._loadSvgSourceUsingDataUri(t):this._loadSvgSourceUsingXhr()}},e.prototype._loadSvgSourceUsingDataUri=function(t){var e=void 0;if("base64"===t.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");e=atob(t.data)}else e=t.data;this._loadSvgSourceUsingString(e)},e.prototype._loadSvgSourceUsingXhr=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){if(e.readyState!==e.DONE||200!==e.status)throw new Error("Failed to load SVG using XHR.");t._loadSvgSourceUsingString(e.response)},e.onerror=function(){return t.emit("error",t)},e.open("GET",this.imageUrl,!0),e.send()},e.prototype._loadSvgSourceUsingString=function(t){var r=(0,n.getSvgSize)(t),i=r.width,o=r.height;if(!i||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(i*this.sourceScale),this.realHeight=Math.round(o*this.sourceScale),this._updateDimensions();var s=document.createElement("canvas");s.width=this.realWidth,s.height=this.realHeight,s._pixiId="canvas_"+(0,n.uid)(),s.getContext("2d").drawImage(this.source,0,0,i,o,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=s,e.addToCache(this,s._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},e.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},e.prototype.destroy=function(){this.imageUrl&&(delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},e.fromImage=function(t,r,i,o){var a=n.BaseTextureCache[t];if(!a){var l=new Image;void 0===r&&0!==t.indexOf("data:")?l.crossOrigin=(0,s.default)(t):r&&(l.crossOrigin="string"==typeof r?r:"anonymous"),(a=new e(l,i)).imageUrl=t,o&&(a.sourceScale=o),a.resolution=(0,n.getResolutionOfUrl)(t),l.src=t,e.addToCache(a,t)}return a},e.fromCanvas=function(t,r){t._pixiId||(t._pixiId=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas")+"_"+(0,n.uid)());var i=n.BaseTextureCache[t._pixiId];return i||(i=new e(t,r),e.addToCache(i,t._pixiId)),i},e.from=function(t,r,i){if("string"==typeof t)return e.fromImage(t,void 0,r,i);if(t instanceof HTMLImageElement){var o=t.src,s=n.BaseTextureCache[o];return s||((s=new e(t,r)).imageUrl=o,i&&(s.sourceScale=i),s.resolution=(0,n.getResolutionOfUrl)(o),e.addToCache(s,o)),s}return t instanceof HTMLCanvasElement?e.fromCanvas(t,r):t},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),n.BaseTextureCache[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),n.BaseTextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=n.BaseTextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete n.BaseTextureCache[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete n.BaseTextureCache[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},e}(o.default);e.default=c},"8ZQA":function(t,e,r){"use strict";e.__esModule=!0;var n=r("aH6o"),i=r("FjAT"),o=p(r("MIKO")),s=p(r("qo3d")),a=p(r("Twrw")),l=p(r("d5OP")),c=p(r("RZRe")),u=p(r("giQI")),h=p(r("SBy4")),d=p(r("ngSy"));function p(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.graphicsDataPool=[],n.primitiveShader=null,n.gl=r.gl,n.CONTEXT_UID=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new l.default(this.gl)},e.prototype.destroy=function(){o.default.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},e.prototype.render=function(t){var e=this.renderer,r=e.gl,i=void 0,o=t._webGL[this.CONTEXT_UID];o&&t.dirty===o.dirty||(this.updateGraphics(t),o=t._webGL[this.CONTEXT_UID]),e.bindShader(this.primitiveShader),e.state.setBlendMode(t.blendMode);for(var s=0,a=o.data.length;s<a;s++){var l=(i=o.data[s]).shader;e.bindShader(l),l.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),l.uniforms.tint=(0,n.hex2rgb)(t.tint),l.uniforms.alpha=t.worldAlpha,e.bindVao(i.vao),i.nativeLines?r.drawArrays(r.LINES,0,i.points.length/6):i.vao.draw(r.TRIANGLE_STRIP,i.indices.length)}},e.prototype.updateGraphics=function(t){var e=t._webGL[this.CONTEXT_UID];if(e||(e=t._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:this.renderer.gl,clearDirty:-1,dirty:-1}),e.dirty=t.dirty,t.clearDirty!==e.clearDirty){e.clearDirty=t.clearDirty;for(var r=0;r<e.data.length;r++)this.graphicsDataPool.push(e.data[r]);e.data.length=0,e.lastIndex=0}for(var n=void 0,o=void 0,s=e.lastIndex;s<t.graphicsData.length;s++){var a=t.graphicsData[s];n=this.getWebGLData(e,0),a.nativeLines&&a.lineWidth&&(o=this.getWebGLData(e,0,!0),e.lastIndex++),a.type===i.SHAPES.POLY&&(0,c.default)(a,n,o),a.type===i.SHAPES.RECT?(0,u.default)(a,n,o):a.type===i.SHAPES.CIRC||a.type===i.SHAPES.ELIP?(0,d.default)(a,n,o):a.type===i.SHAPES.RREC&&(0,h.default)(a,n,o),e.lastIndex++}this.renderer.bindVao(null);for(var l=0;l<e.data.length;l++)(n=e.data[l]).dirty&&n.upload()},e.prototype.getWebGLData=function(t,e,r){var n=t.data[t.data.length-1];return(!n||n.nativeLines!==r||n.points.length>32e4)&&((n=this.graphicsDataPool.pop()||new a.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=r,n.reset(e),t.data.push(n)),n.dirty=!0,n},e}(o.default);e.default=f,s.default.registerPlugin("graphics",f)},"8o49":function(t,e,r){"use strict";e.__esModule=!0;var n=r("FjAT"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("/MUw")),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=i.default.GC_MAX_IDLE,this.checkCountMax=i.default.GC_MAX_CHECK_COUNT,this.mode=i.default.GC_MODE}return t.prototype.update=function(){this.count++,this.mode!==n.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},t.prototype.run=function(){for(var t=this.renderer.textureManager,e=t._managedTextures,r=!1,n=0;n<e.length;n++){var i=e[n];!i._glRenderTargets&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,r=!0)}if(r){for(var o=0,s=0;s<e.length;s++)null!==e[s]&&(e[o++]=e[s]);e.length=o}},t.prototype.unload=function(t){t._texture&&t._texture._glRenderTargets&&this.renderer.textureManager.destroyTexture(t._texture,!0);for(var e=t.children.length-1;e>=0;e--)this.unload(t.children[e])},t}();e.default=o},"9GXS":function(t,e,r){"use strict";(function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var r=Date.now(),n=["ms","moz","webkit","o"],i=0;i<n.length&&!t.requestAnimationFrame;++i){var o=n[i];t.requestAnimationFrame=t[o+"RequestAnimationFrame"],t.cancelAnimationFrame=t[o+"CancelAnimationFrame"]||t[o+"CancelRequestAnimationFrame"]}t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+r-e;return n<0&&(n=0),r=e,setTimeout(function(){r=Date.now(),t(performance.now())},n)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){return clearTimeout(t)})}).call(e,r("DuR2"))},"9bEX":function(t,e,r){"use strict";e.__esModule=!0;var n=r("RjLg");Object.defineProperty(e,"ParticleContainer",{enumerable:!0,get:function(){return o(n).default}});var i=r("TlGl");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"ParticleRenderer",{enumerable:!0,get:function(){return o(i).default}})},"9rXv":function(t,e,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,l=0;function c(t){var e="";do{e=i[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function u(){var t=c(+new Date);return t!==n?(a=0,n=t):t+"."+c(a++)}for(;l<o;l++)s[i[l]]=l;u.encode=c,u.decode=function(t){var e=0;for(l=0;l<t.length;l++)e=e*o+s[t.charAt(l)];return e},t.exports=u},"9y/k":function(t,e,r){"use strict";var n=r("W/Sc"),i=r("ves3"),o=(r("2zkT"),r("s+UU")),s=r("AnYr");const a=class extends i.a{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new o.a).add(this.source.subscribe(new class extends n.c{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}(this.getSubject(),this))),t.closed?(this._connection=null,t=o.a.EMPTY):this._connection=t),t}refCount(){return Object(s.a)()(this)}}.prototype;e.a={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:a._subscribe},_isComplete:{value:a._isComplete,writable:!0},getSubject:{value:a.getSubject},connect:{value:a.connect},refCount:{value:a.refCount}}},AM6m:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=p(r("izXE")),o=p(r("qD+0")),s=r("Q5/2"),a=r("aH6o"),l=r("FjAT"),c=p(r("/MUw")),u=p(r("UxPA")),h=p(r("4LTl")),d=p(r("jwA5"));function p(t){return t&&t.__esModule?t:{default:t}}var f={texture:!0,children:!1,baseTexture:!0},m=function(t){function e(r,n,i){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=i||document.createElement("canvas")).width=3,i.height=3;var a=o.default.fromCanvas(i,c.default.SCALE_MODE,"text");a.orig=new s.Rectangle,a.trim=new s.Rectangle;var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a));return o.default.addToCache(l._texture,l._texture.baseTexture.textureCacheIds[0]),l.canvas=i,l.context=l.canvas.getContext("2d"),l.resolution=c.default.RESOLUTION,l._text=null,l._style=null,l._styleListener=null,l._font="",l.text=r,l.style=n,l.localStyleID=-1,l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var r=this.context,n=h.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),i=n.height,o=n.lines,s=n.lineHeight,a=n.lineWidths,l=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil((Math.max(1,n.width)+2*e.padding)*this.resolution),this.canvas.height=Math.ceil((Math.max(1,i)+2*e.padding)*this.resolution),r.scale(this.resolution,this.resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.strokeStyle=e.stroke,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;var u=void 0,d=void 0;if(e.dropShadow){r.fillStyle=e.dropShadowColor,r.globalAlpha=e.dropShadowAlpha,r.shadowBlur=e.dropShadowBlur,e.dropShadowBlur>0&&(r.shadowColor=e.dropShadowColor);for(var p=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,f=Math.sin(e.dropShadowAngle)*e.dropShadowDistance,m=0;m<o.length;m++)u=e.strokeThickness/2,d=e.strokeThickness/2+m*s+c.ascent,"right"===e.align?u+=l-a[m]:"center"===e.align&&(u+=(l-a[m])/2),e.fill&&(this.drawLetterSpacing(o[m],u+p+e.padding,d+f+e.padding),e.stroke&&e.strokeThickness&&(r.strokeStyle=e.dropShadowColor,this.drawLetterSpacing(o[m],u+p+e.padding,d+f+e.padding,!0),r.strokeStyle=e.stroke))}r.shadowBlur=0,r.globalAlpha=1,r.fillStyle=this._generateFillStyle(e,o);for(var v=0;v<o.length;v++)u=e.strokeThickness/2,d=e.strokeThickness/2+v*s+c.ascent,"right"===e.align?u+=l-a[v]:"center"===e.align&&(u+=(l-a[v])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[v],u+e.padding,d+e.padding,!0),e.fill&&this.drawLetterSpacing(o[v],u+e.padding,d+e.padding);this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._style.letterSpacing;if(0!==i)for(var o=String.prototype.split.call(t,""),s=e,a=0,l="";a<t.length;)l=o[a++],n?this.context.strokeText(l,s,r):this.context.fillText(l,s,r),s+=this.context.measureText(l).width+i;else n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=(0,d.default)(t);t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0)}var r=this._texture,n=this._style,i=n.trim?0:n.padding,o=r.baseTexture;o.hasLoaded=!0,o.resolution=this.resolution,o.realWidth=t.width,o.realHeight=t.height,o.width=t.width/this.resolution,o.height=t.height/this.resolution,r.trim.width=r._frame.width=t.width/this.resolution,r.trim.height=r._frame.height=t.height/this.resolution,r.trim.x=-i,r.trim.y=-i,r.orig.width=r._frame.width-2*i,r.orig.height=r._frame.height-2*i,this._onTextureUpdate(),o.emit("update",o),this.dirty=!1},e.prototype.renderWebGL=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype.renderWebGL.call(this,e)},e.prototype._renderCanvas=function(e){this.resolution!==e.resolution&&(this.resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._renderCanvas.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(navigator.isCocoonJS)return t.fill[0];var r=void 0,n=void 0,i=void 0,o=this.canvas.width/this.resolution,s=this.canvas.height/this.resolution,a=t.fill.slice(),c=t.fillGradientStops.slice();if(!c.length)for(var u=a.length+1,h=1;h<u;++h)c.push(h/u);if(a.unshift(t.fill[0]),c.unshift(0),a.push(t.fill[t.fill.length-1]),c.push(1),t.fillGradientType===l.TEXT_GRADIENT.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,0,o/2,s),n=(a.length+1)*e.length,i=0;for(var d=0;d<e.length;d++){i+=1;for(var p=0;p<a.length;p++)r.addColorStop("number"==typeof c[p]?c[p]/e.length+d/e.length:i/n,a[p]),i++}}else{r=this.context.createLinearGradient(0,s/2,o,s/2),n=a.length+1,i=1;for(var f=0;f<a.length;f++)r.addColorStop("number"==typeof c[f]?c[f]:i/n,a[f]),i++}return r},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},f,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},n(e,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=(0,a.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=(0,a.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"style",get:function(){return this._style},set:function(t){this._style=(t=t||{})instanceof u.default?t:new u.default(t),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(t){t=String(""===t||null===t||void 0===t?" ":t),this._text!==t&&(this._text=t,this.dirty=!0)}}]),e}(i.default);e.default=m},AWov:function(t,e,r){"use strict";t.exports=function(t,e,r){var n,i=t.length;if(!(e>=i||0===r)){var o=i-(r=e+r>i?i-e:r);for(n=e;n<o;++n)t[n]=t[n+r];t.length=o}}},AYMf:function(t,e,r){var n=r("Xz3Q"),i=r("pnVU"),o=r("bqFq"),s=r("SJFm"),a=r("zqJT"),l=r("Fy0/")("socket.io-client:socket"),c=r("gVZZ"),u=r("5+KW");t.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function p(t,e,r){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[s(t,"open",a(this,"onopen")),s(t,"packet",a(this,"onpacket")),s(t,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var t=o(arguments);return t.unshift("message"),this.emit.apply(this,t),this},p.prototype.emit=function(t){if(h.hasOwnProperty(t))return d.apply(this,arguments),this;var e=o(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:u(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},p.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},p.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?c.encode(this.query):this.query;l("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},p.prototype.onclose=function(t){l("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},p.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},p.prototype.onevent=function(t){var e=t.data||[];l("emitting event %j",e),null!=t.id&&(l("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},p.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);l("sending ack %j",i),e.packet({type:u(i)?n.BINARY_ACK:n.ACK,id:t,data:i})}}},p.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(l("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):l("bad ack %s",t.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(t){return this.flags.compress=t,this},p.prototype.binary=function(t){return this.flags.binary=t,this}},AnYr:function(t,e,r){"use strict";e.a=function(){return function(t){return t.lift(new class{constructor(t){this.connectable=t}call(t,e){const{connectable:r}=this;r._refCount++;const i=new class extends n.a{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:r}=this,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}(t,r),o=e.subscribe(i);return i.closed||(i.connection=r.connect()),o}}(t))}};var n=r("2zkT")},B13k:function(t,e,r){"use strict";e.__esModule=!0;var n=r("kpDK");Object.defineProperty(e,"Mesh",{enumerable:!0,get:function(){return c(n).default}});var i=r("XkNl");Object.defineProperty(e,"MeshRenderer",{enumerable:!0,get:function(){return c(i).default}});var o=r("mImb");Object.defineProperty(e,"CanvasMeshRenderer",{enumerable:!0,get:function(){return c(o).default}});var s=r("6nzH");Object.defineProperty(e,"Plane",{enumerable:!0,get:function(){return c(s).default}});var a=r("qC7s");Object.defineProperty(e,"NineSlicePlane",{enumerable:!0,get:function(){return c(a).default}});var l=r("aRcS");function c(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Rope",{enumerable:!0,get:function(){return c(l).default}})},BEQ0:function(t,e,r){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,s,a=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var c in r=Object(arguments[l]))i.call(r,c)&&(a[c]=r[c]);if(n){s=n(r);for(var u=0;u<s.length;u++)o.call(r,s[u])&&(a[s[u]]=r[s[u]])}}return a}},BmFd:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));r("o/zv");var o=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return n.alpha=r,n.glShaderKey="alpha",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o},BzvE:function(t,e,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)n.call(t,e)&&r.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t,e){var r=this._events[i?i+t:t];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},a.prototype.emit=function(t,e,r,n,o,s){var a=i?i+t:t;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,n),!0;case 5:return u.fn.call(u.context,e,r,n,o),!0;case 6:return u.fn.call(u.context,e,r,n,o,s),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,r);break;case 4:u[c].fn.call(u[c].context,e,r,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(t,e,r){var n=new s(e,r||this),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.once=function(t,e,r){var n=new s(e,r||this,!0),o=i?i+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.removeListener=function(t,e,r,n){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return 0==--this._eventsCount?this._events=new o:delete this._events[s],this;var a=this._events[s];if(a.fn)a.fn!==e||n&&!a.once||r&&a.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[s]);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==e||n&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new o:delete this._events[s]}return this},a.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&(0==--this._eventsCount?this._events=new o:delete this._events[e]):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=i,a.EventEmitter=a,t.exports=a},Csua:function(t,e){var r=[].indexOf;t.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}},Ctjl:function(t,e,r){var n=r("psuf"),i=r("AYMf"),o=r("pnVU"),s=r("Xz3Q"),a=r("SJFm"),l=r("zqJT"),c=r("Fy0/")("socket.io-client:manager"),u=r("Csua"),h=r("+lzb"),d=Object.prototype.hasOwnProperty;function p(t,e){if(!(this instanceof p))return new p(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=e.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=p,p.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},p.prototype.updateSocketIds=function(){for(var t in this.nsps)d.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},p.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},o(p.prototype),p.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},p.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},p.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(t,e){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(r,"open",function(){i.onopen(),t&&t()}),s=a(r,"error",function(e){if(c("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var r=new Error("Connection error");r.data=e,t(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;c("connect attempt will timeout after %d",l);var u=setTimeout(function(){c("connect attempt timed out after %d",l),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(o),this.subs.push(s),this},p.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(a(t,"data",l(this,"ondata"))),this.subs.push(a(t,"ping",l(this,"onping"))),this.subs.push(a(t,"pong",l(this,"onpong"))),this.subs.push(a(t,"error",l(this,"onerror"))),this.subs.push(a(t,"close",l(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",l(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(t){this.decoder.add(t)},p.prototype.ondecoded=function(t){this.emit("packet",t)},p.prototype.onerror=function(t){c("error",t),this.emitAll("error",t)},p.prototype.socket=function(t,e){var r=this.nsps[t];if(!r){r=new i(this,t,e),this.nsps[t]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.generateId(t)}),this.autoConnect&&o()}function o(){~u(n.connecting,r)||n.connecting.push(r)}return r},p.prototype.destroy=function(t){var e=u(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},p.prototype.packet=function(t){c("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(r){for(var n=0;n<r.length;n++)e.engine.write(r[n],t.options);e.encoding=!1,e.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},p.prototype.cleanup=function(){c("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(t){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout(function(){t.skipReconnect||(c("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(c("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(c("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(r)}})}},p.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},Cvg1:function(t,e,r){var n=r("/9A/");function i(t,e){if(this.nativeVaoExtension=null,i.FORCE_NATIVE||(this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=e,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var r=t.getParameter(t.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(r),attribState:new Array(r)}}this.gl=t,this.attributes=[],this.indexBuffer=null,this.dirty=!1}i.prototype.constructor=i,t.exports=i,i.FORCE_NATIVE=!1,i.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},i.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},i.prototype.activate=function(){for(var t=this.gl,e=null,r=0;r<this.attributes.length;r++){var i=this.attributes[r];e!==i.buffer&&(i.buffer.bind(),e=i.buffer),t.vertexAttribPointer(i.attribute.location,i.attribute.size,i.type||t.FLOAT,i.normalized||!1,i.stride||0,i.start||0)}return n(t,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},i.prototype.addAttribute=function(t,e,r,n,i,o){return this.attributes.push({buffer:t,attribute:e,location:e.location,type:r||this.gl.FLOAT,normalized:n||!1,stride:i||0,start:o||0}),this.dirty=!0,this},i.prototype.addIndex=function(t){return this.indexBuffer=t,this.dirty=!0,this},i.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},i.prototype.draw=function(t,e,r){var n=this.gl;return this.indexBuffer?n.drawElements(t,e||this.indexBuffer.data.length,n.UNSIGNED_SHORT,2*(r||0)):n.drawArrays(t,r,e||this.getSize()),this},i.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},i.prototype.getSize=function(){var t=this.attributes[0];return t.buffer.data.length/(t.stride/4||t.attribute.size)}},DVpw:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=function(t){return t&&t.__esModule?t:{default:t}}(r("NGfj")),s=new i.Point,a=function(t){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return s.tileTransform=new i.TransformStatic,s._width=n,s._height=o,s._canvasPattern=null,s.uvTransform=r.transform||new i.TextureMatrix(r),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},e.prototype._renderWebGL=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var r=t.context,n=this.worldTransform,s=t.resolution,a=e.baseTexture,l=a.resolution,c=this.tilePosition.x/this.tileScale.x%e._frame.width*l,u=this.tilePosition.y/this.tileScale.y%e._frame.height*l;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new i.CanvasRenderTarget(e._frame.width,e._frame.height,l);16777215!==this.tint?(this.tintedTexture=o.default.getTintedTexture(this,this.tint),h.context.drawImage(this.tintedTexture,0,0)):h.context.drawImage(a.source,-e._frame.x*l,-e._frame.y*l),this.cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),t.setBlendMode(this.blendMode),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/l,this.tileScale.y/l);var d=this.anchor.x*-this._width,p=this.anchor.y*-this._height;this.uvRespectAnchor?(r.translate(c,u),r.fillRect(-c+d,-u+p,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l)):(r.translate(c+d,u+p),r.fillRect(-c,-u,this._width/this.tileScale.x*l,this._height/this.tileScale.y*l))}},e.prototype._calculateBounds=function(){this._bounds.addFrame(this.transform,this._width*-this._anchor._x,this._height*-this._anchor._y,this._width*(1-this._anchor._x),this._height*(1-this._anchor._y))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._x),e||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,s);var e=this._width,r=this._height,n=-e*this.anchor._x;if(s.x>=n&&s.x<n+e){var i=-r*this.anchor._y;if(s.y>=i&&s.y<i+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvTransform=null},e.from=function(t,r,n){return new e(i.Texture.from(t),r,n)},e.fromFrame=function(t,r,n){var o=i.utils.TextureCache[t];if(!o)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new e(o,r,n)},e.fromImage=function(t,r,n,o,s){return new e(i.Texture.fromImage(t,o,s),r,n)},n(e,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(t){this.uvTransform.clampMargin=t,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copy(t)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copy(t)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),e}(i.Sprite);e.default=a},DmT9:function(t,e,r){var n=r("V1mL"),i=r("Xz3Q"),o=r("Ctjl"),s=r("Fy0/")("socket.io-client");t.exports=e=l;var a=e.managers={};function l(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,i=n(t),l=i.source,c=i.id;return e.forceNew||e["force new connection"]||!1===e.multiplex||a[c]&&i.path in a[c].nsps?(s("ignoring socket cache for %s",l),r=o(l,e)):(a[c]||(s("new io instance for %s",l),a[c]=o(l,e)),r=a[c]),i.query&&!e.query&&(e.query=i.query),r.socket(i.path,e)}e.protocol=i.protocol,e.connect=l,e.Manager=r("Ctjl"),e.Socket=r("AYMf")},DuR2:function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},Dyrc:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return!(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}},EarI:function(t,e){var r=1e3,n=6e4,i=36e5,o=24*i;function s(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(t);if("number"===a&&!1===isNaN(t))return e.long?function(t){return s(t,o,"day")||s(t,i,"hour")||s(t,n,"minute")||s(t,r,"second")||t+" ms"}(t):function(t){return t>=o?Math.round(t/o)+"d":t>=i?Math.round(t/i)+"h":t>=n?Math.round(t/n)+"m":t>=r?Math.round(t/r)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},ElvI:function(t,e,r){(function(t){var n,i=r("2gBs"),o=r("5+KW"),s=r("Tff0"),a=r("YUmt"),l=r("eAwk");t&&t.ArrayBuffer&&(n=r("kVGU"));var c="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=c||u;e.protocol=3;var d=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(d),f={type:"error",data:"parser error"},m=r("6mly");function v(t,e,r){for(var n=new Array(t.length),i=a(t.length,r),o=function(t,r,i){e(r,function(e,r){n[t]=r,i(e,n)})},s=0;s<t.length;s++)o(s,t[s],i)}e.encodePacket=function(r,n,i,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof i&&(o=i,i=null);var s=void 0===r.data?void 0:r.data.buffer||r.data;if(t.ArrayBuffer&&s instanceof ArrayBuffer)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=t.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=d[t.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}(r,n,o);if(m&&s instanceof t.Blob)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);if(h)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=new FileReader;return i.onload=function(){t.data=i.result,e.encodePacket(t,r,!0,n)},i.readAsArrayBuffer(t.data)}(t,r,n);var i=new Uint8Array(1);return i[0]=d[t.type],n(new m([i.buffer,t.data]))}(r,n,o);if(s&&s.base64)return function(t,r){return r("b"+e.packets[t.type]+t.data.data)}(r,o);var a=d[r.type];return void 0!==r.data&&(a+=i?l.encode(String(r.data),{strict:!1}):String(r.data)),o(""+a)},e.encodeBase64Packet=function(r,n){var i,o="b"+e.packets[r.type];if(m&&r.data instanceof t.Blob){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];n(o+t)},s.readAsDataURL(r.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(r.data))}catch(t){for(var a=new Uint8Array(r.data),l=new Array(a.length),c=0;c<a.length;c++)l[c]=a[c];i=String.fromCharCode.apply(null,l)}return o+=t.btoa(i),n(o)},e.decodePacket=function(t,r,n){if(void 0===t)return f;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),r);if(n&&!1===(t=function(t){try{t=l.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return f;var i=t.charAt(0);return Number(i)==i&&p[i]?t.length>1?{type:p[i],data:t.substring(1)}:{type:p[i]}:f}i=new Uint8Array(t)[0];var o=s(t,1);return m&&"blob"===r&&(o=new m([o])),{type:p[i],data:o}},e.decodeBase64Packet=function(t,e){var r=p[t.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=n.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:r,data:i}},e.encodePayload=function(t,r,n){"function"==typeof r&&(n=r,r=null);var i=o(t);return r&&i?m&&!h?e.encodePayloadAsBlob(t,n):e.encodePayloadAsArrayBuffer(t,n):t.length?void v(t,function(t,n){e.encodePacket(t,!!i&&r,!1,function(t){n(null,function(t){return t.length+":"+t}(t))})},function(t,e){return n(e.join(""))}):n("0:")},e.decodePayload=function(t,r,n){if("string"!=typeof t)return e.decodePayloadAsBinary(t,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===t)return n(f,0,1);for(var o,s,a="",l=0,c=t.length;l<c;l++){var u=t.charAt(l);if(":"===u){if(""===a||a!=(o=Number(a)))return n(f,0,1);if(a!=(s=t.substr(l+1,o)).length)return n(f,0,1);if(s.length){if(i=e.decodePacket(s,r,!1),f.type===i.type&&f.data===i.data)return n(f,0,1);if(!1===n(i,l+o,c))return}l+=o,a=""}else a+=u}return""!==a?n(f,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,r){if(!t.length)return r(new ArrayBuffer(0));v(t,function(t,r){e.encodePacket(t,!0,!0,function(t){return r(null,t)})},function(t,e){var n=e.reduce(function(t,e){var r;return t+(r="string"==typeof e?e.length:e.byteLength).toString().length+r+2},0),i=new Uint8Array(n),o=0;return e.forEach(function(t){var e="string"==typeof t,r=t;if(e){for(var n=new Uint8Array(t.length),s=0;s<t.length;s++)n[s]=t.charCodeAt(s);r=n.buffer}i[o++]=e?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);for(i[o++]=255,n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]}),r(i.buffer)})},e.encodePayloadAsBlob=function(t,r){v(t,function(t,r){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);t=n.buffer,e[0]=0}var o=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,m){var a=new m([e.buffer,s.buffer,t]);r(null,a)}})},function(t,e){return r(new m(e))})},e.decodePayloadAsBinary=function(t,r,n){"function"==typeof r&&(n=r,r=null);for(var i=t,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),l=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return n(f,0,1);c+=a[u]}i=s(i,2+c.length),c=parseInt(c);var h=s(i,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);for(h="",u=0;u<d.length;u++)h+=String.fromCharCode(d[u])}o.push(h),i=s(i,c)}var p=o.length;o.forEach(function(t,i){n(e.decodePacket(t,r,!0),i,p)})}}).call(e,r("DuR2"))},EmDc:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxItemsPerFrame=e,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();e.default=n},EoU7:function(t,e,r){"use strict";e.__esModule=!0;var n=r("Q5/2"),i=r("FjAT"),o=function(t){return t&&t.__esModule?t:{default:t}}(r("/MUw")),s=r("8QNu"),a=function(){function t(e,r,a,l,c,u){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new n.Rectangle(0,0,1,1),this.resolution=c||o.default.RESOLUTION,this.projectionMatrix=new n.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new n.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=void 0!==l?l:o.default.SCALE_MODE,this.root=u,this.root?(this.frameBuffer=new s.GLFramebuffer(e,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=s.GLFramebuffer.createRGBA(e,100,100),this.scaleMode===i.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(r,a)}return t.prototype.clear=function(t){var e=t||this.clearColor;this.frameBuffer.clear(e[0],e[1],e[2],e[3])},t.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},t.prototype.setFrame=function(t,e){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||this.destinationFrame},t.prototype.activate=function(){var t=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(t.enable(t.SCISSOR_TEST),t.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):t.disable(t.SCISSOR_TEST),t.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},t.prototype.calculateProjection=function(t,e){var r=this.projectionMatrix;e=e||t,r.identity(),this.root?(r.a=1/t.width*2,r.d=-1/t.height*2,r.tx=-1-e.x*r.a,r.ty=1-e.y*r.d):(r.a=1/t.width*2,r.d=1/t.height*2,r.tx=-1-e.x*r.a,r.ty=-1-e.y*r.d)},t.prototype.resize=function(t,e){e|=0,(this.size.width!==(t|=0)||this.size.height!==e)&&(this.size.width=t,this.size.height=e,this.defaultFrame.width=t,this.defaultFrame.height=e,this.frameBuffer.resize(t*this.resolution,e*this.resolution),this.calculateProjection(this.frame||this.size))},t.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},t}();e.default=a},Exya:function(t,e,r){"use strict";var n=r("s+UU");e.a=class extends n.a{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},"F+P4":function(t,e,r){"use strict";e.__esModule=!0;var n=r("Q5/2"),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?n.Rectangle.EMPTY:((t=t||new n.Rectangle(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY,o=t[0],s=t[1];e=o<e?o:e,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,s=t[3],e=(o=t[2])<e?o:e,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,s=t[5],e=(o=t[4])<e?o:e,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,s=t[7],e=(o=t[6])<e?o:e,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i},t.prototype.addFrame=function(t,e,r,n,i){var o=t.worldTransform,s=o.a,a=o.b,l=o.c,c=o.d,u=o.tx,h=o.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,v=s*e+l*r+u,g=a*e+c*r+h;d=v<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*n+c*r+h,d=(v=s*n+l*r+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*e+c*i+h,d=(v=s*e+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,g=a*n+c*i+h,d=(v=s*n+l*i+u)<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addVertices=function(t,e,r,n){for(var i=t.worldTransform,o=i.a,s=i.b,a=i.c,l=i.d,c=i.tx,u=i.ty,h=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=r;m<n;m+=2){var v=e[m],g=e[m+1],y=o*v+a*g+c,x=l*g+s*v+u;h=y<h?y:h,d=x<d?x:d,p=y>p?y:p,f=x>f?x:f}this.minX=h,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addBounds=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i},t.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=i&&n<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},t.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=i&&n<=o){var s=this.minX,a=this.minY,l=this.maxX,c=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>l?i:l,this.maxY=o>c?o:c}},t}();e.default=i},FH9r:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){t.nativeLines?function(t,e){var n=0,o=t.points;if(0!==o.length){var s=r.points,a=o.length/2,l=(0,i.hex2rgb)(t.lineColor),c=t.lineAlpha,u=l[0]*c,h=l[1]*c,d=l[2]*c;for(n=1;n<a;n++){var p=o[2*n],f=o[2*n+1];s.push(o[2*(n-1)],o[2*(n-1)+1]),s.push(u,h,d,c),s.push(p,f),s.push(u,h,d,c)}}}(t):function(t,e){var r=t.points;if(0!==r.length){var o=new n.Point(r[0],r[1]),s=new n.Point(r[r.length-2],r[r.length-1]);if(o.x===s.x&&o.y===s.y){(r=r.slice()).pop(),r.pop();var a=(s=new n.Point(r[r.length-2],r[r.length-1])).x+.5*(o.x-s.x),l=s.y+.5*(o.y-s.y);r.unshift(a,l),r.push(a,l)}var c=e.points,u=e.indices,h=r.length/2,d=r.length,p=c.length/6,f=t.lineWidth/2,m=(0,i.hex2rgb)(t.lineColor),v=t.lineAlpha,g=m[0]*v,y=m[1]*v,x=m[2]*v,b=r[0],w=r[1],_=r[2],S=r[3],T=0,M=0,A=-(w-S),E=b-_,C=0,P=0,O=0,N=0,L=Math.sqrt(A*A+E*E);A/=L,E/=L,c.push(b-(A*=f),w-(E*=f),g,y,x,v),c.push(b+A,w+E,g,y,x,v);for(var I=1;I<h-1;++I){T=r[2*(I+1)],M=r[2*(I+1)+1],A=-((w=r[2*(I-1)+1])-(S=r[2*I+1])),E=(b=r[2*(I-1)])-(_=r[2*I]),A/=L=Math.sqrt(A*A+E*E),E/=L,A*=f,E*=f,C=-(S-M),P=_-T,C/=L=Math.sqrt(C*C+P*P),P/=L;var R=-E+w-(-E+S),D=-A+_-(-A+b),F=(-A+b)*(-E+S)-(-A+_)*(-E+w),k=-(P*=f)+M-(-P+S),U=-(C*=f)+_-(-C+T),B=(-C+T)*(-P+S)-(-C+_)*(-P+M),j=R*U-k*D;if(Math.abs(j)<.1)j+=10.1,c.push(_-A,S-E,g,y,x,v),c.push(_+A,S+E,g,y,x,v);else{var z=(D*B-U*F)/j,V=(k*F-R*B)/j;(z-_)*(z-_)+(V-S)*(V-S)>196*f*f?(O=A-C,N=E-P,O/=L=Math.sqrt(O*O+N*N),N/=L,c.push(_-(O*=f),S-(N*=f)),c.push(g,y,x,v),c.push(_+O,S+N),c.push(g,y,x,v),c.push(_-O,S-N),c.push(g,y,x,v),d++):(c.push(z,V),c.push(g,y,x,v),c.push(_-(z-_),S-(V-S)),c.push(g,y,x,v))}}A=-((w=r[2*(h-2)+1])-(S=r[2*(h-1)+1])),E=(b=r[2*(h-2)])-(_=r[2*(h-1)]),A/=L=Math.sqrt(A*A+E*E),E/=L,c.push(_-(A*=f),S-(E*=f)),c.push(g,y,x,v),c.push(_+A,S+E),c.push(g,y,x,v),u.push(p);for(var G=0;G<d;++G)u.push(p++);u.push(p-1)}}(t,e)};var n=r("Q5/2"),i=r("aH6o")},FjAT:function(t,e,r){"use strict";e.__esModule=!0,e.VERSION="4.7.3",e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},e.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},e.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},e.SCALE_MODES={LINEAR:0,NEAREST:1},e.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},e.GC_MODES={AUTO:0,MANUAL:1},e.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,e.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},e.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},e.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},e.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},e.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},FvzS:function(t,e,r){"use strict";e.a=function(t){return null!=t&&"object"==typeof t}},"Fy0/":function(t,e,r){(function(n){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof n&&"env"in n&&(t=n.env.DEBUG),t}(e=t.exports=r("vmzn")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.diff),r){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(o=++i)}),t.splice(o,0,n)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(e,r("W2nU"))},"Gc6/":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.maxMilliseconds=e,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}();e.default=n},GyJD:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=i;r=(r=r.replace(/%count%/gi,e)).replace(/%forloop%/gi,function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(textureId == "+r+".0)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"}(e));for(var o=new n.default(t,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",r),s=[],a=0;a<e;a++)s[a]=a;return o.bind(),o.uniforms.uSamplers=s,o};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("Obmw"));r("o/zv");var i=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n")},HVUN:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("zFUS")),o=r("FjAT"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.a=e,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=s,this.array=null}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,n,i,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new i.default;var r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new i.default;var r=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return e.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.a,i=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=i*e-this.d*r,this.d=i*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,r,n,i,o,s,a,l){return this.a=Math.cos(s+l)*i,this.b=Math.sin(s+l)*i,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,n=this.c,i=this.d,s=-Math.atan2(-n,i),a=Math.atan2(r,e),l=Math.abs(s+a);return l<1e-5||Math.abs(o.PI_2-l)<1e-5?(t.rotation=a,e<0&&i>=0&&(t.rotation+=t.rotation<=0?Math.PI:-Math.PI),t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=s,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},n(t,null,[{key:"IDENTITY",get:function(){return new t}},{key:"TEMP_MATRIX",get:function(){return new t}}]),t}();e.default=s},"I/rR":function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=u(r("SdIY")),s=u(r("rdl+")),a=u(r("tIUM")),l=u(r("BzvE")),c=u(r("qsr7"));function u(t){return t&&t.__esModule?t:{default:t}}i.utils.mixins.delayMixin(i.DisplayObject.prototype,c.default);var h=1,d={target:null,data:{global:null}},p=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n=n||{},a.renderer=r,a.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,a.interactionFrequency=n.interactionFrequency||10,a.mouse=new o.default,a.mouse.identifier=h,a.mouse.global.set(-999999),a.activeInteractionData={},a.activeInteractionData[h]=a.mouse,a.interactionDataPool=[],a.eventData=new s.default,a.interactionDOMElement=null,a.moveWhenInside=!1,a.eventsAdded=!1,a.mouseOverRenderer=!1,a.supportsTouchEvents="ontouchstart"in window,a.supportsPointerEvents=!!window.PointerEvent,a.onPointerUp=a.onPointerUp.bind(a),a.processPointerUp=a.processPointerUp.bind(a),a.onPointerCancel=a.onPointerCancel.bind(a),a.processPointerCancel=a.processPointerCancel.bind(a),a.onPointerDown=a.onPointerDown.bind(a),a.processPointerDown=a.processPointerDown.bind(a),a.onPointerMove=a.onPointerMove.bind(a),a.processPointerMove=a.processPointerMove.bind(a),a.onPointerOut=a.onPointerOut.bind(a),a.processPointerOverOut=a.processPointerOverOut.bind(a),a.onPointerOver=a.onPointerOver.bind(a),a.cursorStyles={default:"inherit",pointer:"pointer"},a.currentCursorMode=null,a.cursor=null,a._tempPoint=new i.Point,a.resolution=1,a.setTargetElement(a.renderer.view,a.renderer.resolution),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.hitTest=function(t,e){return d.target=null,d.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(d,e,null,!0),d.target},e.prototype.setTargetElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},e.prototype.addEvents=function(){this.interactionDOMElement&&(i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.interactionDOMElement&&(i.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var r=this.activeInteractionData[e];if(r.originalEvent&&"touch"!==r.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(this.currentCursorMode!==(t=t||"default")){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch("undefined"==typeof e?"undefined":n(e)){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,r){r.stopped||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},e.prototype.mapPositionToPoint=function(t,e,r){var n;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=navigator.isCocoonJS?this.resolution:1/this.resolution;t.x=this.interactionDOMElement.width/n.width*(e-n.left)*i,t.y=this.interactionDOMElement.height/n.height*(r-n.top)*i},e.prototype.processInteractive=function(t,e,r,n,i){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=i=e.interactive||i,l=!0;if(e.hitArea?(n&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(n=!1,l=!1)),a=!1):e._mask&&n&&(e._mask.containsPoint(o)||(n=!1,l=!1)),l&&e.interactiveChildren&&e.children)for(var c=e.children,u=c.length-1;u>=0;u--){var h=c[u],d=this.processInteractive(t,h,r,n,a);if(d){if(!h.parent)continue;a=!1,d&&(t.target&&(n=!1),s=!0)}}return i&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),r&&r(t,e,!!s))),s},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===i.pointerType?this.emit("touchstart",s):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit(2===i.button?"rightdown":"mousedown",this.eventData)}}},e.prototype.processPointerDown=function(t,e,r){var n=t.data,i=t.data.identifier;if(r)if(e.trackedPointers[i]||(e.trackedPointers[i]=new a.default(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===n.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,r){for(var n=this.normalizeToPointerData(t),i=n.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<i;s++){var a=n[s],l=this.getInteractionDataForPointerId(a),c=this.configureInteractionEventForDOMEvent(this.eventData,a,l);c.data.originalEvent=t,this.processInteractive(c,this.renderer._lastObjectRendered,r,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===a.pointerType||"pen"===a.pointerType?this.emit(2===a.button?"rightup"+o:"mouseup"+o,c):"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(a.pointerId,l))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var r=t.data,n=t.data.identifier;void 0!==e.trackedPointers[n]&&(delete e.trackedPointers[n],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,r){var n=t.data,i=t.data.identifier,o=e.trackedPointers[i],s="touch"===n.pointerType;if("mouse"===n.pointerType||"pen"===n.pointerType){var l=2===n.button,c=a.default.FLAGS,u=void 0!==o&&o.flags&(l?c.RIGHT_DOWN:c.LEFT_DOWN);r?(this.dispatchEvent(e,l?"rightup":"mouseup",t),u&&this.dispatchEvent(e,l?"rightclick":"click",t)):u&&this.dispatchEvent(e,l?"rightupoutside":"mouseupoutside",t),o&&(l?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,"touch"!==i.pointerType||this.moveWhenInside),this.emit("pointermove",s),"touch"===i.pointerType&&this.emit("touchmove",s),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,r){var n=t.data,i="touch"===n.pointerType,o="mouse"===n.pointerType||"pen"===n.pointerType;o&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(r.identifier)}},e.prototype.processPointerOverOut=function(t,e,r){var n=t.data,i=t.data.identifier,o="mouse"===n.pointerType||"pen"===n.pointerType,s=e.trackedPointers[i];r&&!s&&(s=e.trackedPointers[i]=new a.default(i)),void 0!==s&&(r&&this.mouseOverRenderer?(s.over||(s.over=!0,this.dispatchEvent(e,"pointerover",t),o&&this.dispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",n)},e.prototype.getInteractionDataForPointerId=function(t){var e=t.pointerId,r=void 0;return e===h||"mouse"===t.pointerType?r=this.mouse:this.activeInteractionData[e]?r=this.activeInteractionData[e]:((r=this.interactionDataPool.pop()||new o.default).identifier=e,this.activeInteractionData[e]=r),r.copyEvent(t),r},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),navigator.isCocoonJS&&"touch"===e.pointerType&&(r.global.x=r.global.x/this.resolution,r.global.y=r.global.y/this.resolution),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,n=t.changedTouches.length;r<n;r++){var i=t.changedTouches[r];"undefined"==typeof i.button&&(i.button=t.touches.length?1:0),"undefined"==typeof i.buttons&&(i.buttons=t.touches.length?1:0),"undefined"==typeof i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),"undefined"==typeof i.width&&(i.width=i.radiusX||1),"undefined"==typeof i.height&&(i.height=i.radiusY||1),"undefined"==typeof i.tiltX&&(i.tiltX=0),"undefined"==typeof i.tiltY&&(i.tiltY=0),"undefined"==typeof i.pointerType&&(i.pointerType="touch"),"undefined"==typeof i.pointerId&&(i.pointerId=i.identifier||0),"undefined"==typeof i.pressure&&(i.pressure=i.force||.5),i.twist=0,i.tangentialPressure=0,"undefined"==typeof i.layerX&&(i.layerX=i.offsetX=i.clientX),"undefined"==typeof i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):("undefined"==typeof t.isPrimary&&(t.isPrimary=!0),"undefined"==typeof t.width&&(t.width=1),"undefined"==typeof t.height&&(t.height=1),"undefined"==typeof t.tiltX&&(t.tiltX=0),"undefined"==typeof t.tiltY&&(t.tiltY=0),"undefined"==typeof t.pointerType&&(t.pointerType="mouse"),"undefined"==typeof t.pointerId&&(t.pointerId=h),"undefined"==typeof t.pressure&&(t.pressure=.5),t.twist=0,t.tangentialPressure=0,t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},e}(l.default);e.default=p,i.WebGLRenderer.registerPlugin("interaction",p),i.CanvasRenderer.registerPlugin("interaction",p)},Ibme:function(t,e,r){"use strict";e.__esModule=!0;var n=r("FjAT"),i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.width=i,this.height=o,this.radius=s,this.type=n.SHAPES.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),n=e-(this.y+this.radius),i=this.radius*this.radius;if(r*r+n*n<=i)return!0;if((r=t-(this.x+this.width-this.radius))*r+n*n<=i)return!0;if(r*r+(n=e-(this.y+this.height-this.radius))*n<=i)return!0;if((r=t-(this.x+this.radius))*r+n*n<=i)return!0}return!1},t}();e.default=i},It3W:function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,a,l,c,u,p,m,v=e&&e.length,g=v?e[0]*r:t.length,y=i(t,0,g,r,!0),x=[];if(!y)return x;if(v&&(y=function(t,e,r,n){var s,a,l,c=[];for(s=0,a=e.length;s<a;s++)(l=i(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),c.push(f(l));for(c.sort(h),s=0;s<c.length;s++)d(c[s],r),r=o(r,r.next);return r}(t,e,y,r)),t.length>80*r){n=l=t[0],a=c=t[1];for(var b=r;b<g;b+=r)p=t[b+1],(u=t[b])<n&&(n=u),p<a&&(a=p),u>l&&(l=u),p>c&&(c=p);m=0!==(m=Math.max(l-n,c-a))?1/m:0}return s(y,x,r,n,a,m),x}function i(t,e,r,n,i){var o,s;if(i===M(t,e,r,n)>0)for(o=e;o<r;o+=n)s=_(o,t[o],t[o+1],s);else for(o=r-n;o>=e;o-=n)s=_(o,t[o],t[o+1],s);return s&&y(s,s.next)&&(S(s),s=s.next),s}function o(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(S(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function s(t,e,r,n,i,h,d){if(t){!d&&h&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,s,a,l,c=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,n=r,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(t,n,i,h);for(var f,m,v=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?l(t,n,i,h):a(t))e.push(f.i/r),e.push(t.i/r),e.push(m.i/r),S(t),t=m.next,v=m.next;else if((t=m)===v){d?1===d?s(t=c(t,e,r),e,r,n,i,h,2):2===d&&u(t,e,r,n,i,h):s(o(t),e,r,n,i,h,1);break}}}function a(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(t,e,r,n){var i=t.prev,o=t,s=t.next;if(g(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,l=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,c=p(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,r,n),u=p(a,l,e,r,n),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function c(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!y(i,o)&&x(i,n,n.next,o)&&b(i,o)&&b(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),S(n),S(n.next),n=t=o),n=n.next}while(n!==t);return n}function u(t,e,r,n,i,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=w(l,c);return l=o(l,l.next),u=o(u,u.next),s(l,e,r,n,i,a),void s(u,e,r,n,i,a)}c=c.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&m(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&b(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=w(e,t);o(r,r.next)}}function p(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function m(t,e,r,n,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&x(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,r,n){return!!(y(t,e)&&y(r,n)||y(t,n)&&y(r,e))||g(t,e,r)>0!=g(t,e,n)>0&&g(r,n,t)>0!=g(r,n,e)>0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var r=new T(t.i,t.x,t.y),n=new T(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function _(t,e,r,n){var i=new T(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,r,n){for(var i=0,o=e,s=r-n;o<r;o+=n)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}t.exports=n,t.exports.default=n,n.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(M(t,0,i?e[0]*r:t.length,r));if(i)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(M(t,e[s]*r,s<a-1?e[s+1]*r:t.length,r));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,u=n[s+1]*r,h=n[s+2]*r;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[i][o][s]);i>0&&r.holes.push(n+=t[i-1].length)}return r}},JD0k:function(t,e){var r=function(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(t.getShaderInfoLog(n)),null)};t.exports=function(t,e,n,i){var o=r(t,t.VERTEX_SHADER,e),s=r(t,t.FRAGMENT_SHADER,n),a=t.createProgram();if(t.attachShader(a,o),t.attachShader(a,s),i)for(var l in i)t.bindAttribLocation(a,i[l],l);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(o),t.deleteShader(s),a}},JEOp:function(t,e,r){"use strict";var n=r("2zkT");e.a=class extends n.a{notifyNext(t,e,r,n,i){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}},JJ61:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=new n.Rectangle,o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,e.extract=this}return t.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},t.prototype.base64=function(t){return this.canvas(t).toDataURL()},t.prototype.canvas=function(t){var e=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0;t&&(a=t instanceof n.RenderTexture?t:e.generateTexture(t)),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,s=a.frame):(r=e.rootContext,(s=i).width=this.renderer.width,s.height=this.renderer.height);var l=s.width*o,c=s.height*o,u=new n.CanvasRenderTarget(l,c),h=r.getImageData(s.x*o,s.y*o,l,c);return u.context.putImageData(h,0,0),u.canvas},t.prototype.pixels=function(t){var e=this.renderer,r=void 0,o=void 0,s=void 0,a=void 0;return t&&(a=t instanceof n.RenderTexture?t:e.generateTexture(t)),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,s=a.frame):(r=e.rootContext,(s=i).width=e.width,s.height=e.height),r.getImageData(0,0,s.width*o,s.height*o).data},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t}();e.default=o,n.CanvasRenderer.registerPlugin("extract",o)},JdRN:function(t,e,r){"use strict";e.__esModule=!0,e.default={mixin:function(t){!function(t){t.__plugins={},t.registerPlugin=function(e,r){t.__plugins[e]=r},t.prototype.initPlugins=function(){for(var e in this.plugins=this.plugins||{},t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}(t)}}},Jh97:function(t,e,r){"use strict";e.a=function(t){return t}},Jnfr:function(t,e){function r(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="Jnfr"},KFrc:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("8USZ")),i=o(r("/MUw"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments[2],s=arguments[3];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,null,o));return a.resolution=s||i.default.RESOLUTION,a.width=Math.ceil(r),a.height=Math.ceil(n),a.realWidth=a.width*a.resolution,a.realHeight=a.height*a.resolution,a.scaleMode=void 0!==o?o:i.default.SCALE_MODE,a.hasLoaded=!0,a._glRenderTargets={},a._canvasRenderTarget=null,a.valid=!1,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.renderer=null},e}(n.default);e.default=s},KWAD:function(t,e,r){"use strict";Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t})},LGVh:function(t,e,r){"use strict";e.__esModule=!0;var n=r("SdIY");Object.defineProperty(e,"InteractionData",{enumerable:!0,get:function(){return l(n).default}});var i=r("I/rR");Object.defineProperty(e,"InteractionManager",{enumerable:!0,get:function(){return l(i).default}});var o=r("qsr7");Object.defineProperty(e,"interactiveTarget",{enumerable:!0,get:function(){return l(o).default}});var s=r("tIUM");Object.defineProperty(e,"InteractionTrackingData",{enumerable:!0,get:function(){return l(s).default}});var a=r("rdl+");function l(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"InteractionEvent",{enumerable:!0,get:function(){return l(a).default}})},LiEr:function(t,e,r){"use strict";e.a=function(){return Object(n.a)()(this)};var n=r("4iP9")},M75x:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("VWTR")),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return t.prototype.set=function(t,e,r){var i=e.width,o=e.height;if(r){var s=t.width/2/i,a=t.height/2/o,l=t.x/i+s,c=t.y/o+a;r=n.default.add(r,n.default.NW),this.x0=l+s*n.default.uX(r),this.y0=c+a*n.default.uY(r),r=n.default.add(r,2),this.x1=l+s*n.default.uX(r),this.y1=c+a*n.default.uY(r),r=n.default.add(r,2),this.x2=l+s*n.default.uX(r),this.y2=c+a*n.default.uY(r),r=n.default.add(r,2),this.x3=l+s*n.default.uX(r),this.y3=c+a*n.default.uY(r)}else this.x0=t.x/i,this.y0=t.y/o,this.x1=(t.x+t.width)/i,this.y1=t.y/o,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/o,this.x3=t.x/i,this.y3=(t.y+t.height)/o;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535},t}();e.default=i},M81j:function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=a(r("qD+0")),o=a(r("8USZ")),s=r("aH6o");function a(t){return t&&t.__esModule?t:{default:t}}var l=n.DisplayObject,c=new n.Matrix;l.prototype._cacheAsBitmap=!1,l.prototype._cacheData=!1,Object.defineProperties(l.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var e=void 0;t?(this._cacheData||(this._cacheData=new function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null}),(e=this._cacheData).originalRenderWebGL=this.renderWebGL,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this._calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=e.originalRenderWebGL,this.renderCanvas=e.originalRenderCanvas,this._calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}}),l.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(t))},l.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.currentRenderer.flush();var r=this.getLocalBounds().clone();this._filters&&r.pad(this._filters[0].padding);var a=t._activeRenderTarget,l=t.filterManager.filterStack,u=n.RenderTexture.create(0|r.width,0|r.height),h="cacheAsBitmap_"+(0,s.uid)();this._cacheData.textureCacheId=h,o.default.addToCache(u.baseTexture,h),i.default.addToCache(u,h);var d=c;d.tx=-r.x,d.ty=-r.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,t.render(this,u,!0,d,!0),t.bindRenderTarget(a),t.filterManager.filterStack=l,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var p=new n.Sprite(u);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-r.x/r.width,p.anchor.y=-r.y/r.height,p.alpha=e,p._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=p.containsPoint.bind(p)}},l.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(t))},l.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),r=this.alpha;this.alpha=1;var a=t.context,l=n.RenderTexture.create(0|e.width,0|e.height),u="cacheAsBitmap_"+(0,s.uid)();this._cacheData.textureCacheId=u,o.default.addToCache(l.baseTexture,u),i.default.addToCache(l,u);var h=c;this.transform.localTransform.copy(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,l,!0,h,!1),t.context=a,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var d=new n.Sprite(l);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-e.x/e.width,d.anchor.y=-e.y/e.height,d._bounds=this._bounds,d.alpha=r,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=d,this.containsPoint=d.containsPoint.bind(d)}},l.prototype._calculateCachedBounds=function(){this._cacheData.sprite._calculateBounds()},l.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},l.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,o.default.removeFromCache(this._cacheData.textureCacheId),i.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},l.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)}},MIKO:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.start=function(){},e.prototype.stop=function(){this.flush()},e.prototype.flush=function(){},e.prototype.render=function(t){},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("3psj")).default);e.default=n},"Ml+6":function(t,e,r){"use strict";function n(){}Object.defineProperty(e,"__esModule",{value:!0}),r.d(e,"WebGLRenderTargetCube",function(){return We}),r.d(e,"WebGLRenderTarget",function(){return He}),r.d(e,"WebGLRenderer",function(){return Xn}),r.d(e,"ShaderLib",function(){return rr}),r.d(e,"UniformsLib",function(){return er}),r.d(e,"UniformsUtils",function(){return Ke}),r.d(e,"ShaderChunk",function(){return Qe}),r.d(e,"FogExp2",function(){return qn}),r.d(e,"Fog",function(){return Yn}),r.d(e,"Scene",function(){return Zn}),r.d(e,"Sprite",function(){return Qn}),r.d(e,"LOD",function(){return Kn}),r.d(e,"SkinnedMesh",function(){return ei}),r.d(e,"Skeleton",function(){return $n}),r.d(e,"Bone",function(){return ti}),r.d(e,"Mesh",function(){return kr}),r.d(e,"LineSegments",function(){return ii}),r.d(e,"LineLoop",function(){return oi}),r.d(e,"Line",function(){return ni}),r.d(e,"Points",function(){return ai}),r.d(e,"Group",function(){return li}),r.d(e,"VideoTexture",function(){return ci}),r.d(e,"DataTexture",function(){return Xe}),r.d(e,"CompressedTexture",function(){return ui}),r.d(e,"CubeTexture",function(){return Br}),r.d(e,"CanvasTexture",function(){return zn}),r.d(e,"DepthTexture",function(){return hi}),r.d(e,"Texture",function(){return Ve}),r.d(e,"CompressedTextureLoader",function(){return Uo}),r.d(e,"DataTextureLoader",function(){return Bo}),r.d(e,"CubeTextureLoader",function(){return zo}),r.d(e,"TextureLoader",function(){return Vo}),r.d(e,"ObjectLoader",function(){return Vs}),r.d(e,"MaterialLoader",function(){return Fs}),r.d(e,"BufferGeometryLoader",function(){return ks}),r.d(e,"DefaultLoadingManager",function(){return Do}),r.d(e,"LoadingManager",function(){return Ro}),r.d(e,"JSONLoader",function(){return zs}),r.d(e,"ImageLoader",function(){return jo}),r.d(e,"ImageBitmapLoader",function(){return qs}),r.d(e,"FontLoader",function(){return Qs}),r.d(e,"FileLoader",function(){return ko}),r.d(e,"Loader",function(){return Bs}),r.d(e,"LoaderUtils",function(){return js}),r.d(e,"Cache",function(){return Io}),r.d(e,"AudioLoader",function(){return ea}),r.d(e,"SpotLightShadow",function(){return ms}),r.d(e,"SpotLight",function(){return vs}),r.d(e,"PointLight",function(){return gs}),r.d(e,"RectAreaLight",function(){return ws}),r.d(e,"HemisphereLight",function(){return ps}),r.d(e,"DirectionalLightShadow",function(){return ys}),r.d(e,"DirectionalLight",function(){return xs}),r.d(e,"AmbientLight",function(){return bs}),r.d(e,"LightShadow",function(){return fs}),r.d(e,"Light",function(){return ds}),r.d(e,"StereoCamera",function(){return ra}),r.d(e,"PerspectiveCamera",function(){return Gn}),r.d(e,"OrthographicCamera",function(){return lr}),r.d(e,"CubeCamera",function(){return na}),r.d(e,"ArrayCamera",function(){return Hn}),r.d(e,"Camera",function(){return ar}),r.d(e,"AudioListener",function(){return ia}),r.d(e,"PositionalAudio",function(){return sa}),r.d(e,"AudioContext",function(){return ta}),r.d(e,"AudioAnalyser",function(){return aa}),r.d(e,"Audio",function(){return oa}),r.d(e,"VectorKeyframeTrack",function(){return Rs}),r.d(e,"StringKeyframeTrack",function(){return _s}),r.d(e,"QuaternionKeyframeTrack",function(){return As}),r.d(e,"NumberKeyframeTrack",function(){return Cs}),r.d(e,"ColorKeyframeTrack",function(){return Es}),r.d(e,"BooleanKeyframeTrack",function(){return Ss}),r.d(e,"PropertyMixer",function(){return la}),r.d(e,"PropertyBinding",function(){return ua}),r.d(e,"KeyframeTrack",function(){return Is}),r.d(e,"AnimationUtils",function(){return Ls}),r.d(e,"AnimationObjectGroup",function(){return ha}),r.d(e,"AnimationMixer",function(){return pa}),r.d(e,"AnimationClip",function(){return Ds}),r.d(e,"Uniform",function(){return fa}),r.d(e,"InstancedBufferGeometry",function(){return ma}),r.d(e,"BufferGeometry",function(){return Mr}),r.d(e,"Geometry",function(){return hr}),r.d(e,"InterleavedBufferAttribute",function(){return va}),r.d(e,"InstancedInterleavedBuffer",function(){return ya}),r.d(e,"InterleavedBuffer",function(){return ga}),r.d(e,"InstancedBufferAttribute",function(){return xa}),r.d(e,"Face3",function(){return cr}),r.d(e,"Object3D",function(){return sr}),r.d(e,"Raycaster",function(){return ba}),r.d(e,"Layers",function(){return ir}),r.d(e,"EventDispatcher",function(){return n}),r.d(e,"Clock",function(){return Sa}),r.d(e,"QuaternionLinearInterpolant",function(){return Ms}),r.d(e,"LinearInterpolant",function(){return Os}),r.d(e,"DiscreteInterpolant",function(){return Ns}),r.d(e,"CubicInterpolant",function(){return Ps}),r.d(e,"Interpolant",function(){return Ts}),r.d(e,"Triangle",function(){return Fr}),r.d(e,"Math",function(){return De}),r.d(e,"Spherical",function(){return Ta}),r.d(e,"Cylindrical",function(){return Ma}),r.d(e,"Plane",function(){return Ze}),r.d(e,"Frustum",function(){return Je}),r.d(e,"Sphere",function(){return Ye}),r.d(e,"Ray",function(){return Rr}),r.d(e,"Matrix4",function(){return ke}),r.d(e,"Matrix3",function(){return je}),r.d(e,"Box3",function(){return qe}),r.d(e,"Box2",function(){return Aa}),r.d(e,"Line3",function(){return Dr}),r.d(e,"Euler",function(){return nr}),r.d(e,"Vector4",function(){return Ge}),r.d(e,"Vector3",function(){return Be}),r.d(e,"Vector2",function(){return Fe}),r.d(e,"Quaternion",function(){return Ue}),r.d(e,"Color",function(){return tr}),r.d(e,"ImmediateRenderObject",function(){return Ea}),r.d(e,"VertexNormalsHelper",function(){return Ca}),r.d(e,"SpotLightHelper",function(){return Pa}),r.d(e,"SkeletonHelper",function(){return Oa}),r.d(e,"PointLightHelper",function(){return Na}),r.d(e,"RectAreaLightHelper",function(){return La}),r.d(e,"HemisphereLightHelper",function(){return Ia}),r.d(e,"GridHelper",function(){return Ra}),r.d(e,"PolarGridHelper",function(){return Da}),r.d(e,"FaceNormalsHelper",function(){return Fa}),r.d(e,"DirectionalLightHelper",function(){return ka}),r.d(e,"CameraHelper",function(){return Ua}),r.d(e,"BoxHelper",function(){return Ba}),r.d(e,"Box3Helper",function(){return ja}),r.d(e,"PlaneHelper",function(){return za}),r.d(e,"ArrowHelper",function(){return Va}),r.d(e,"AxesHelper",function(){return Ga}),r.d(e,"Shape",function(){return hs}),r.d(e,"Path",function(){return us}),r.d(e,"ShapePath",function(){return Ys}),r.d(e,"Font",function(){return Zs}),r.d(e,"CurvePath",function(){return cs}),r.d(e,"Curve",function(){return Go}),r.d(e,"ShapeUtils",function(){return Ki}),r.d(e,"WebGLUtils",function(){return Vn}),r.d(e,"WireframeGeometry",function(){return di}),r.d(e,"ParametricGeometry",function(){return pi}),r.d(e,"ParametricBufferGeometry",function(){return fi}),r.d(e,"TetrahedronGeometry",function(){return gi}),r.d(e,"TetrahedronBufferGeometry",function(){return yi}),r.d(e,"OctahedronGeometry",function(){return xi}),r.d(e,"OctahedronBufferGeometry",function(){return bi}),r.d(e,"IcosahedronGeometry",function(){return wi}),r.d(e,"IcosahedronBufferGeometry",function(){return _i}),r.d(e,"DodecahedronGeometry",function(){return Si}),r.d(e,"DodecahedronBufferGeometry",function(){return Ti}),r.d(e,"PolyhedronGeometry",function(){return mi}),r.d(e,"PolyhedronBufferGeometry",function(){return vi}),r.d(e,"TubeGeometry",function(){return Mi}),r.d(e,"TubeBufferGeometry",function(){return Ai}),r.d(e,"TorusKnotGeometry",function(){return Ei}),r.d(e,"TorusKnotBufferGeometry",function(){return Ci}),r.d(e,"TorusGeometry",function(){return Pi}),r.d(e,"TorusBufferGeometry",function(){return Oi}),r.d(e,"TextGeometry",function(){return no}),r.d(e,"TextBufferGeometry",function(){return io}),r.d(e,"SphereGeometry",function(){return oo}),r.d(e,"SphereBufferGeometry",function(){return so}),r.d(e,"RingGeometry",function(){return ao}),r.d(e,"RingBufferGeometry",function(){return lo}),r.d(e,"PlaneGeometry",function(){return Cr}),r.d(e,"PlaneBufferGeometry",function(){return Pr}),r.d(e,"LatheGeometry",function(){return co}),r.d(e,"LatheBufferGeometry",function(){return uo}),r.d(e,"ShapeGeometry",function(){return ho}),r.d(e,"ShapeBufferGeometry",function(){return po}),r.d(e,"ExtrudeGeometry",function(){return eo}),r.d(e,"ExtrudeBufferGeometry",function(){return ro}),r.d(e,"EdgesGeometry",function(){return mo}),r.d(e,"ConeGeometry",function(){return yo}),r.d(e,"ConeBufferGeometry",function(){return xo}),r.d(e,"CylinderGeometry",function(){return vo}),r.d(e,"CylinderBufferGeometry",function(){return go}),r.d(e,"CircleGeometry",function(){return bo}),r.d(e,"CircleBufferGeometry",function(){return wo}),r.d(e,"BoxGeometry",function(){return Ar}),r.d(e,"BoxBufferGeometry",function(){return Er}),r.d(e,"ShadowMaterial",function(){return So}),r.d(e,"SpriteMaterial",function(){return Jn}),r.d(e,"RawShaderMaterial",function(){return To}),r.d(e,"ShaderMaterial",function(){return Ir}),r.d(e,"PointsMaterial",function(){return si}),r.d(e,"MeshPhysicalMaterial",function(){return Ao}),r.d(e,"MeshStandardMaterial",function(){return Mo}),r.d(e,"MeshPhongMaterial",function(){return Eo}),r.d(e,"MeshToonMaterial",function(){return Co}),r.d(e,"MeshNormalMaterial",function(){return Po}),r.d(e,"MeshLambertMaterial",function(){return Oo}),r.d(e,"MeshDepthMaterial",function(){return Un}),r.d(e,"MeshDistanceMaterial",function(){return Bn}),r.d(e,"MeshBasicMaterial",function(){return Lr}),r.d(e,"LineDashedMaterial",function(){return No}),r.d(e,"LineBasicMaterial",function(){return ri}),r.d(e,"Material",function(){return Nr}),r.d(e,"Float64BufferAttribute",function(){return wr}),r.d(e,"Float32BufferAttribute",function(){return br}),r.d(e,"Uint32BufferAttribute",function(){return xr}),r.d(e,"Int32BufferAttribute",function(){return yr}),r.d(e,"Uint16BufferAttribute",function(){return gr}),r.d(e,"Int16BufferAttribute",function(){return vr}),r.d(e,"Uint8ClampedBufferAttribute",function(){return mr}),r.d(e,"Uint8BufferAttribute",function(){return fr}),r.d(e,"Int8BufferAttribute",function(){return pr}),r.d(e,"BufferAttribute",function(){return dr}),r.d(e,"ArcCurve",function(){return Wo}),r.d(e,"CatmullRomCurve3",function(){return Qo}),r.d(e,"CubicBezierCurve",function(){return es}),r.d(e,"CubicBezierCurve3",function(){return rs}),r.d(e,"EllipseCurve",function(){return Ho}),r.d(e,"LineCurve",function(){return ns}),r.d(e,"LineCurve3",function(){return is}),r.d(e,"QuadraticBezierCurve",function(){return os}),r.d(e,"QuadraticBezierCurve3",function(){return ss}),r.d(e,"SplineCurve",function(){return as}),r.d(e,"REVISION",function(){return i}),r.d(e,"MOUSE",function(){return o}),r.d(e,"CullFaceNone",function(){return s}),r.d(e,"CullFaceBack",function(){return a}),r.d(e,"CullFaceFront",function(){return l}),r.d(e,"CullFaceFrontBack",function(){return c}),r.d(e,"FrontFaceDirectionCW",function(){return u}),r.d(e,"FrontFaceDirectionCCW",function(){return h}),r.d(e,"BasicShadowMap",function(){return d}),r.d(e,"PCFShadowMap",function(){return p}),r.d(e,"PCFSoftShadowMap",function(){return f}),r.d(e,"FrontSide",function(){return m}),r.d(e,"BackSide",function(){return v}),r.d(e,"DoubleSide",function(){return g}),r.d(e,"FlatShading",function(){return y}),r.d(e,"SmoothShading",function(){return x}),r.d(e,"NoColors",function(){return b}),r.d(e,"FaceColors",function(){return w}),r.d(e,"VertexColors",function(){return _}),r.d(e,"NoBlending",function(){return S}),r.d(e,"NormalBlending",function(){return T}),r.d(e,"AdditiveBlending",function(){return M}),r.d(e,"SubtractiveBlending",function(){return A}),r.d(e,"MultiplyBlending",function(){return E}),r.d(e,"CustomBlending",function(){return C}),r.d(e,"AddEquation",function(){return P}),r.d(e,"SubtractEquation",function(){return O}),r.d(e,"ReverseSubtractEquation",function(){return N}),r.d(e,"MinEquation",function(){return L}),r.d(e,"MaxEquation",function(){return I}),r.d(e,"ZeroFactor",function(){return R}),r.d(e,"OneFactor",function(){return D}),r.d(e,"SrcColorFactor",function(){return F}),r.d(e,"OneMinusSrcColorFactor",function(){return k}),r.d(e,"SrcAlphaFactor",function(){return U}),r.d(e,"OneMinusSrcAlphaFactor",function(){return B}),r.d(e,"DstAlphaFactor",function(){return j}),r.d(e,"OneMinusDstAlphaFactor",function(){return z}),r.d(e,"DstColorFactor",function(){return V}),r.d(e,"OneMinusDstColorFactor",function(){return G}),r.d(e,"SrcAlphaSaturateFactor",function(){return H}),r.d(e,"NeverDepth",function(){return W}),r.d(e,"AlwaysDepth",function(){return X}),r.d(e,"LessDepth",function(){return q}),r.d(e,"LessEqualDepth",function(){return Y}),r.d(e,"EqualDepth",function(){return Z}),r.d(e,"GreaterEqualDepth",function(){return J}),r.d(e,"GreaterDepth",function(){return Q}),r.d(e,"NotEqualDepth",function(){return K}),r.d(e,"MultiplyOperation",function(){return $}),r.d(e,"MixOperation",function(){return tt}),r.d(e,"AddOperation",function(){return et}),r.d(e,"NoToneMapping",function(){return rt}),r.d(e,"LinearToneMapping",function(){return nt}),r.d(e,"ReinhardToneMapping",function(){return it}),r.d(e,"Uncharted2ToneMapping",function(){return ot}),r.d(e,"CineonToneMapping",function(){return st}),r.d(e,"UVMapping",function(){return at}),r.d(e,"CubeReflectionMapping",function(){return lt}),r.d(e,"CubeRefractionMapping",function(){return ct}),r.d(e,"EquirectangularReflectionMapping",function(){return ut}),r.d(e,"EquirectangularRefractionMapping",function(){return ht}),r.d(e,"SphericalReflectionMapping",function(){return dt}),r.d(e,"CubeUVReflectionMapping",function(){return pt}),r.d(e,"CubeUVRefractionMapping",function(){return ft}),r.d(e,"RepeatWrapping",function(){return mt}),r.d(e,"ClampToEdgeWrapping",function(){return vt}),r.d(e,"MirroredRepeatWrapping",function(){return gt}),r.d(e,"NearestFilter",function(){return yt}),r.d(e,"NearestMipMapNearestFilter",function(){return xt}),r.d(e,"NearestMipMapLinearFilter",function(){return bt}),r.d(e,"LinearFilter",function(){return wt}),r.d(e,"LinearMipMapNearestFilter",function(){return _t}),r.d(e,"LinearMipMapLinearFilter",function(){return St}),r.d(e,"UnsignedByteType",function(){return Tt}),r.d(e,"ByteType",function(){return Mt}),r.d(e,"ShortType",function(){return At}),r.d(e,"UnsignedShortType",function(){return Et}),r.d(e,"IntType",function(){return Ct}),r.d(e,"UnsignedIntType",function(){return Pt}),r.d(e,"FloatType",function(){return Ot}),r.d(e,"HalfFloatType",function(){return Nt}),r.d(e,"UnsignedShort4444Type",function(){return Lt}),r.d(e,"UnsignedShort5551Type",function(){return It}),r.d(e,"UnsignedShort565Type",function(){return Rt}),r.d(e,"UnsignedInt248Type",function(){return Dt}),r.d(e,"AlphaFormat",function(){return Ft}),r.d(e,"RGBFormat",function(){return kt}),r.d(e,"RGBAFormat",function(){return Ut}),r.d(e,"LuminanceFormat",function(){return Bt}),r.d(e,"LuminanceAlphaFormat",function(){return jt}),r.d(e,"RGBEFormat",function(){return zt}),r.d(e,"DepthFormat",function(){return Vt}),r.d(e,"DepthStencilFormat",function(){return Gt}),r.d(e,"RGB_S3TC_DXT1_Format",function(){return Ht}),r.d(e,"RGBA_S3TC_DXT1_Format",function(){return Wt}),r.d(e,"RGBA_S3TC_DXT3_Format",function(){return Xt}),r.d(e,"RGBA_S3TC_DXT5_Format",function(){return qt}),r.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return Yt}),r.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return Zt}),r.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return Jt}),r.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return Qt}),r.d(e,"RGB_ETC1_Format",function(){return Kt}),r.d(e,"RGBA_ASTC_4x4_Format",function(){return $t}),r.d(e,"RGBA_ASTC_5x4_Format",function(){return te}),r.d(e,"RGBA_ASTC_5x5_Format",function(){return ee}),r.d(e,"RGBA_ASTC_6x5_Format",function(){return re}),r.d(e,"RGBA_ASTC_6x6_Format",function(){return ne}),r.d(e,"RGBA_ASTC_8x5_Format",function(){return ie}),r.d(e,"RGBA_ASTC_8x6_Format",function(){return oe}),r.d(e,"RGBA_ASTC_8x8_Format",function(){return se}),r.d(e,"RGBA_ASTC_10x5_Format",function(){return ae}),r.d(e,"RGBA_ASTC_10x6_Format",function(){return le}),r.d(e,"RGBA_ASTC_10x8_Format",function(){return ce}),r.d(e,"RGBA_ASTC_10x10_Format",function(){return ue}),r.d(e,"RGBA_ASTC_12x10_Format",function(){return he}),r.d(e,"RGBA_ASTC_12x12_Format",function(){return de}),r.d(e,"LoopOnce",function(){return pe}),r.d(e,"LoopRepeat",function(){return fe}),r.d(e,"LoopPingPong",function(){return me}),r.d(e,"InterpolateDiscrete",function(){return ve}),r.d(e,"InterpolateLinear",function(){return ge}),r.d(e,"InterpolateSmooth",function(){return ye}),r.d(e,"ZeroCurvatureEnding",function(){return xe}),r.d(e,"ZeroSlopeEnding",function(){return be}),r.d(e,"WrapAroundEnding",function(){return we}),r.d(e,"TrianglesDrawMode",function(){return _e}),r.d(e,"TriangleStripDrawMode",function(){return Se}),r.d(e,"TriangleFanDrawMode",function(){return Te}),r.d(e,"LinearEncoding",function(){return Me}),r.d(e,"sRGBEncoding",function(){return Ae}),r.d(e,"GammaEncoding",function(){return Ee}),r.d(e,"RGBEEncoding",function(){return Ce}),r.d(e,"LogLuvEncoding",function(){return Pe}),r.d(e,"RGBM7Encoding",function(){return Oe}),r.d(e,"RGBM16Encoding",function(){return Ne}),r.d(e,"RGBDEncoding",function(){return Le}),r.d(e,"BasicDepthPacking",function(){return Ie}),r.d(e,"RGBADepthPacking",function(){return Re}),r.d(e,"CubeGeometry",function(){return Ar}),r.d(e,"Face4",function(){return Ha}),r.d(e,"LineStrip",function(){return Wa}),r.d(e,"LinePieces",function(){return Xa}),r.d(e,"MeshFaceMaterial",function(){return qa}),r.d(e,"MultiMaterial",function(){return Ya}),r.d(e,"PointCloud",function(){return Za}),r.d(e,"Particle",function(){return Ja}),r.d(e,"ParticleSystem",function(){return Qa}),r.d(e,"PointCloudMaterial",function(){return Ka}),r.d(e,"ParticleBasicMaterial",function(){return $a}),r.d(e,"ParticleSystemMaterial",function(){return tl}),r.d(e,"Vertex",function(){return el}),r.d(e,"DynamicBufferAttribute",function(){return rl}),r.d(e,"Int8Attribute",function(){return nl}),r.d(e,"Uint8Attribute",function(){return il}),r.d(e,"Uint8ClampedAttribute",function(){return ol}),r.d(e,"Int16Attribute",function(){return sl}),r.d(e,"Uint16Attribute",function(){return al}),r.d(e,"Int32Attribute",function(){return ll}),r.d(e,"Uint32Attribute",function(){return cl}),r.d(e,"Float32Attribute",function(){return ul}),r.d(e,"Float64Attribute",function(){return hl}),r.d(e,"ClosedSplineCurve3",function(){return dl}),r.d(e,"SplineCurve3",function(){return pl}),r.d(e,"Spline",function(){return fl}),r.d(e,"AxisHelper",function(){return ml}),r.d(e,"BoundingBoxHelper",function(){return vl}),r.d(e,"EdgesHelper",function(){return gl}),r.d(e,"WireframeHelper",function(){return yl}),r.d(e,"XHRLoader",function(){return xl}),r.d(e,"BinaryTextureLoader",function(){return bl}),r.d(e,"GeometryUtils",function(){return wl}),r.d(e,"ImageUtils",function(){return _l}),r.d(e,"Projector",function(){return Sl}),r.d(e,"CanvasRenderer",function(){return Tl}),r.d(e,"SceneUtils",function(){return Ml}),r.d(e,"LensFlare",function(){return Al}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}),Object.assign(n.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});var i="91",o={LEFT:0,MIDDLE:1,RIGHT:2},s=0,a=1,l=2,c=3,u=0,h=1,d=0,p=1,f=2,m=0,v=1,g=2,y=1,x=2,b=0,w=1,_=2,S=0,T=1,M=2,A=3,E=4,C=5,P=100,O=101,N=102,L=103,I=104,R=200,D=201,F=202,k=203,U=204,B=205,j=206,z=207,V=208,G=209,H=210,W=0,X=1,q=2,Y=3,Z=4,J=5,Q=6,K=7,$=0,tt=1,et=2,rt=0,nt=1,it=2,ot=3,st=4,at=300,lt=301,ct=302,ut=303,ht=304,dt=305,pt=306,ft=307,mt=1e3,vt=1001,gt=1002,yt=1003,xt=1004,bt=1005,wt=1006,_t=1007,St=1008,Tt=1009,Mt=1010,At=1011,Et=1012,Ct=1013,Pt=1014,Ot=1015,Nt=1016,Lt=1017,It=1018,Rt=1019,Dt=1020,Ft=1021,kt=1022,Ut=1023,Bt=1024,jt=1025,zt=Ut,Vt=1026,Gt=1027,Ht=33776,Wt=33777,Xt=33778,qt=33779,Yt=35840,Zt=35841,Jt=35842,Qt=35843,Kt=36196,$t=37808,te=37809,ee=37810,re=37811,ne=37812,ie=37813,oe=37814,se=37815,ae=37816,le=37817,ce=37818,ue=37819,he=37820,de=37821,pe=2200,fe=2201,me=2202,ve=2300,ge=2301,ye=2302,xe=2400,be=2401,we=2402,_e=0,Se=1,Te=2,Me=3e3,Ae=3001,Ee=3007,Ce=3002,Pe=3003,Oe=3004,Ne=3005,Le=3006,Ie=3200,Re=3201,De={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*De.DEG2RAD},radToDeg:function(t){return t*De.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Fe(t,e){this.x=t||0,this.y=e||0}function ke(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Ue(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}function Be(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function je(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Fe.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Fe.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new Fe,e=new Fe;return function(r,n){return t.set(r,r),e.set(n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this}}),Object.assign(ke.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,s,a,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=s,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ke).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new Be;return function(e){var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),s=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*s,r[9]=n[9]*s,r[10]=n[10]*s,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,d=o*u,p=s*c,f=s*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-s*a,e[2]=f-h*l,e[6]=p+d*l,e[10]=o*a}else if("YXZ"===t.order){var m=a*u,v=l*c;e[0]=(g=a*c)+(y=l*u)*s,e[4]=v*s-m,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-s,e[2]=m*s-v,e[6]=y+g*s,e[10]=o*a}else if("ZXY"===t.order){var g,y;m=a*u,v=l*c,e[0]=(g=a*c)-(y=l*u)*s,e[4]=-o*u,e[8]=v+m*s,e[1]=m+v*s,e[5]=o*c,e[9]=y-g*s,e[2]=-o*l,e[6]=s,e[10]=o*a}else if("ZYX"===t.order)h=o*c,d=o*u,p=s*c,f=s*u,e[0]=a*c,e[4]=p*l-d,e[8]=h*l+f,e[1]=a*u,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=s*a,e[10]=o*a;else if("YZX"===t.order){var x=o*a,b=o*l,w=s*a,_=s*l;e[0]=a*c,e[4]=_-x*u,e[8]=w*u+b,e[1]=u,e[5]=o*c,e[9]=-s*c,e[2]=-l*c,e[6]=b*u+w,e[10]=x-_*u}else"XZY"===t.order&&(x=o*a,b=o*l,w=s*a,_=s*l,e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=x*u+_,e[5]=o*c,e[9]=b*u-w,e[2]=w*u-b,e[6]=s*c,e[10]=_*u+x);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t._x,n=t._y,i=t._z,o=t._w,s=r+r,a=n+n,l=i+i,c=r*s,u=r*a,h=r*l,d=n*a,p=n*l,f=i*l,m=o*s,v=o*a,g=o*l;return e[0]=1-(d+f),e[4]=u-g,e[8]=h+v,e[1]=u+g,e[5]=1-(c+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o){var s=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),t.crossVectors(o,r),0===t.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),t.crossVectors(o,r)),t.normalize(),e.crossVectors(r,t),s[0]=t.x,s[4]=e.x,s[8]=r.x,s[1]=t.y,s[5]=e.y,s[9]=r.y,s[2]=t.z,s[6]=e.z,s[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],s=r[4],a=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],N=n[10],L=n[14],I=n[3],R=n[7],D=n[11],F=n[15];return i[0]=o*w+s*M+a*P+l*I,i[4]=o*_+s*A+a*O+l*R,i[8]=o*S+s*E+a*N+l*D,i[12]=o*T+s*C+a*L+l*F,i[1]=c*w+u*M+h*P+d*I,i[5]=c*_+u*A+h*O+d*R,i[9]=c*S+u*E+h*N+d*D,i[13]=c*T+u*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+x*P+b*I,i[7]=g*_+y*A+x*O+b*R,i[11]=g*S+y*E+x*N+b*D,i[15]=g*T+y*C+x*L+b*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Be;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],s=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-n*l*u-i*s*h+r*l*h+n*s*d-r*a*d)+t[7]*(+e*a*d-e*l*h+i*o*h-n*o*d+n*l*c-i*a*c)+t[11]*(+e*l*u-e*s*d-i*o*u+r*o*d+i*s*c-r*l*c)+t[15]*(-n*s*c-e*a*u+e*s*h+n*o*u-r*o*h+r*a*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+s*_+a*S;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*a-p*y*a-g*s*m+o*y*m+p*s*x-o*f*x)*A,r[2]=(c*y*a-g*u*a+g*s*h-o*y*h-c*s*x+o*u*x)*A,r[3]=(p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*a-v*f*a+v*s*m-i*y*m-d*s*x+i*f*x)*A,r[6]=(v*u*a-l*y*a-v*s*h+i*y*h+l*s*x-i*u*x)*A,r[7]=(l*f*a-d*u*a+d*s*h-i*f*h-l*s*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*a-d*g*a-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*a-v*c*a+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*a-l*p*a-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*s-v*p*s+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*s-l*g*s-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*s-d*c*s+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,s=t.y,a=t.z,l=i*o,c=i*s;return this.set(l*o+r,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+r,c*a-n*o,0,l*a-n*s,c*a+n*o,i*a*a+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t=new Be,e=new ke;return function(r,n,i){var o=this.elements,s=t.set(o[0],o[1],o[2]).length(),a=t.set(o[4],o[5],o[6]).length(),l=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),r.x=o[12],r.y=o[13],r.z=o[14],e.copy(this);var c=1/s,u=1/a,h=1/l;return e.elements[0]*=c,e.elements[1]*=c,e.elements[2]*=c,e.elements[4]*=u,e.elements[5]*=u,e.elements[6]*=u,e.elements[8]*=h,e.elements[9]*=h,e.elements[10]*=h,n.setFromRotationMatrix(e),i.x=s,i.y=a,i.z=l,this}}(),makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),u=-(o+i)/(o-i),h=-2*o*i/(o-i);return s[0]=2*i/(e-t),s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=a,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var s=this.elements,a=1/(e-t),l=1/(r-n),c=1/(o-i),u=(e+t)*a,h=(r+n)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}),Object.assign(Ue,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,s){var a=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||l!==d||c!==p){var m=1-s,v=a*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,s=Math.sin(s*b)/x}var w=s*g;if(a=a*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=_,l*=_,c*=_,u*=_}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}}),Object.defineProperties(Ue.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(Ue.prototype,{set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,s=Math.cos,a=Math.sin,l=s(r/2),c=s(n/2),u=s(i/2),h=a(r/2),d=a(n/2),p=a(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],s=r[1],a=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+a+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-l)*e,this._y=(o-c)*e,this._z=(s-i)*e):n>a&&n>h?(e=2*Math.sqrt(1+n-a-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(o+c)/e):a>h?(e=2*Math.sqrt(1+a-n-h),this._w=(o-c)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-n-a),this._w=(s-i)/e,this._x=(o+c)/e,this._y=(l+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new Be;return function(r,n){return void 0===e&&(e=new Be),(t=r.dot(n)+1)<1e-6?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,s=e._x,a=e._y,l=e._z,c=e._w;return this._x=r*c+o*s+n*l-i*a,this._y=n*c+o*a+i*s-r*l,this._z=i*c+o*l+r*a-n*s,this._w=o*c-r*s-n*a-i*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,s=o*t._w+r*t._x+n*t._y+i*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(a,s),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Be.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new Ue;return function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new Ue;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,s=t.z,a=t.w,l=a*e+o*n-s*r,c=a*r+s*e-i*n,u=a*n+i*r-o*e,h=-i*e-o*r-s*n;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this},project:function(){var t=new ke;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new ke;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new Be,e=new Be;return function(r,n){return t.set(r,r,r),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,s=e.y,a=e.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new Be;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new Be;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(De.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(je.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,s,a,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=s,c[3]=e,c[4]=i,c[5]=a,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Be;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],s=r[3],a=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+s*g+a*b,i[3]=o*m+s*y+a*w,i[6]=o*v+s*x+a*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return e*o*c-e*s*l-r*i*c+r*s*a+n*i*l-n*o*a},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*a,m=h*a-l*u,v=i*p+o*f+s*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(s*h-d*o)*y,n[2]=(c*o-s*l)*y,n[3]=f*y,n[4]=(d*i-s*u)*y,n[5]=(s*a-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*a)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,s){var a=Math.cos(i),l=Math.sin(i);this.set(r*a,r*l,-r*(a*o+l*s)+o+t,-n*l,n*a,-n*(-l*o+a*s)+s+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],s=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*i+r*a,n[3]=e*o+r*l,n[6]=e*s+r*c,n[1]=-r*i+e*a,n[4]=-r*o+e*l,n[7]=-r*s+e*c,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var ze=0;function Ve(t,e,r,n,i,o,s,a,l,c){Object.defineProperty(this,"id",{value:ze++}),this.uuid=De.generateUUID(),this.name="",this.image=void 0!==t?t:Ve.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Ve.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:vt,this.wrapT=void 0!==n?n:vt,this.magFilter=void 0!==i?i:wt,this.minFilter=void 0!==o?o:St,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Ut,this.type=void 0!==a?a:Tt,this.offset=new Fe(0,0),this.repeat=new Fe(1,1),this.center=new Fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new je,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Me,this.version=0,this.onUpdate=null}function Ge(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function He(t,e,r){this.width=t,this.height=e,this.scissor=new Ge(0,0,t,e),this.scissorTest=!1,this.viewport=new Ge(0,0,t,e),void 0===(r=r||{}).minFilter&&(r.minFilter=wt),this.texture=new Ve(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function We(t,e,r){He.call(this,t,e,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function Xe(t,e,r,n,i,o,s,a,l,c,u,h){Ve.call(this,null,o,s,a,l,c,n,i,u,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:yt,this.minFilter=void 0!==c?c:yt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function qe(t,e){this.min=void 0!==t?t:new Be(1/0,1/0,1/0),this.max=void 0!==e?e:new Be(-1/0,-1/0,-1/0)}function Ye(t,e){this.center=void 0!==t?t:new Be,this.radius=void 0!==e?e:0}function Ze(t,e){this.normal=void 0!==t?t:new Be(1,0,0),this.constant=void 0!==e?e:0}function Je(t,e,r,n,i,o){this.planes=[void 0!==t?t:new Ze,void 0!==e?e:new Ze,void 0!==r?r:new Ze,void 0!==n?n:new Ze,void 0!==i?i:new Ze,void 0!==o?o:new Ze]}Ve.DEFAULT_IMAGE=void 0,Ve.DEFAULT_MAPPING=at,Ve.prototype=Object.assign(Object.create(n.prototype),{constructor:Ve,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=De.generateUUID()),e||void 0!==t.images[n.uuid]||(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var r=e.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===at){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case mt:t.x=t.x-Math.floor(t.x);break;case vt:t.x=t.x<0?0:1;break;case gt:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case mt:t.y=t.y-Math.floor(t.y);break;case vt:t.y=t.y<0?0:1;break;case gt:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(Ve.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ge.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=t.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(s+1)/2,v=(u+1)/2,g=(f+1)/2,y=(a+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-a)/w,this.w=Math.acos((s+u+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(r,n){return void 0===t&&(t=new Ge,e=new Ge),t.set(r,r,r,r),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),He.prototype=Object.assign(Object.create(n.prototype),{constructor:He,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(We.prototype=Object.create(He.prototype)).constructor=We,We.prototype.isWebGLRenderTargetCube=!0,(Xe.prototype=Object.create(Ve.prototype)).constructor=Xe,Xe.prototype.isDataTexture=!0,Object.assign(qe.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=t.length;a<l;a+=3){var c=t[a],u=t[a+1],h=t[a+2];c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(e,r,n),this.max.set(i,o,s),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=t.count;a<l;a++){var c=t.getX(a),u=t.getY(a),h=t.getZ(a);c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(e,r,n),this.max.set(i,o,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Be;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Be),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Be),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,n=new Be;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(e=0,r=s.length;e<r;e++)n.copy(s[e]),n.applyMatrix4(i.matrixWorld),t.expandByPoint(n)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(e=0,r=a.count;e<r;e++)n.fromBufferAttribute(a,e).applyMatrix4(i.matrixWorld),t.expandByPoint(n)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Be),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new Be;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=t.constant&&r>=t.constant},intersectsTriangle:function(){var t=new Be,e=new Be,r=new Be,n=new Be,i=new Be,o=new Be,s=new Be,a=new Be,l=new Be,c=new Be;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){s.fromArray(n,i);var a=l.x*Math.abs(s.x)+l.y*Math.abs(s.y)+l.z*Math.abs(s.z),c=t.dot(s),u=e.dot(s),h=r.dot(s);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>a)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(a),l.subVectors(this.max,a),t.subVectors(s.a,a),e.subVectors(s.b,a),r.subVectors(s.c,a),n.subVectors(e,t),i.subVectors(r,e),o.subVectors(t,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Be),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Be;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Be;return function(e){return void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new Ye),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new Be,new Be,new Be,new Be,new Be,new Be,new Be,new Be];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Ye.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new qe;return function(e,r){var n=this.center;void 0!==r?n.copy(r):t.setFromPoints(e).getCenter(n);for(var i=0,o=0,s=e.length;o<s;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Be),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new qe),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Ze.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Be,e=new Be;return function(r,n,i){var o=t.subVectors(i,n).cross(e.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Be),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Be;return function(e,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Be);var n=e.delta(t),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Be),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Be,e=new je;return function(r,n){var i=n||e.getNormalMatrix(r),o=this.coplanarPoint(t).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Je.prototype,{set:function(t,e,r,n,i,o){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return e[0].setComponents(s-n,u-a,f-h,y-m).normalize(),e[1].setComponents(s+n,u+a,f+h,y+m).normalize(),e[2].setComponents(s+i,u+l,f+d,y+v).normalize(),e[3].setComponents(s-i,u-l,f-d,y-v).normalize(),e[4].setComponents(s-o,u-c,f-p,y-g).normalize(),e[5].setComponents(s+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var t=new Ye;return function(e){var r=e.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),t.copy(r.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Ye;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(){var t=new Be,e=new Be;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];t.x=o.normal.x>0?r.min.x:r.max.x,e.x=o.normal.x>0?r.max.x:r.min.x,t.y=o.normal.y>0?r.min.y:r.max.y,e.y=o.normal.y>0?r.max.y:r.min.y,t.z=o.normal.z>0?r.min.z:r.max.z,e.z=o.normal.z>0?r.max.z:r.min.z;var s=o.distanceToPoint(t),a=o.distanceToPoint(e);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Qe={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Ke={merge:function(t){for(var e={},r=0;r<t.length;r++){var n=this.clone(t[r]);for(var i in n)e[i]=n[i]}return e},clone:function(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];e[r][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}},$e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tr(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}Object.assign(tr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,n){if(e=De.euclideanModulo(e,1),r=De.clamp(r,0,1),n=De.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[2];switch(r[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,a=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(o,s,a)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(l=$e[t])?this.setHex(l):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;return this.r=t*t,this.g=e*e,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,s=Math.max(n,i,o),a=Math.min(n,i,o),l=(a+s)/2;if(a===s)e=0,r=0;else{var c=s-a;switch(r=l<=.5?c/(s+a):c/(2-s-a),s){case n:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var t={};return function(e,r,n){return this.getHSL(t),t.h+=e,t.s+=r,t.l+=n,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var er={common:{diffuse:{value:new tr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new je},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tr(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new tr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new je}}},rr={basic:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.fog]),vertexShader:Qe.meshbasic_vert,fragmentShader:Qe.meshbasic_frag},lambert:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.fog,er.lights,{emissive:{value:new tr(0)}}]),vertexShader:Qe.meshlambert_vert,fragmentShader:Qe.meshlambert_frag},phong:{uniforms:Ke.merge([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.gradientmap,er.fog,er.lights,{emissive:{value:new tr(0)},specular:{value:new tr(1118481)},shininess:{value:30}}]),vertexShader:Qe.meshphong_vert,fragmentShader:Qe.meshphong_frag},standard:{uniforms:Ke.merge([er.common,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.roughnessmap,er.metalnessmap,er.fog,er.lights,{emissive:{value:new tr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},points:{uniforms:Ke.merge([er.points,er.fog]),vertexShader:Qe.points_vert,fragmentShader:Qe.points_frag},dashed:{uniforms:Ke.merge([er.common,er.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qe.linedashed_vert,fragmentShader:Qe.linedashed_frag},depth:{uniforms:Ke.merge([er.common,er.displacementmap]),vertexShader:Qe.depth_vert,fragmentShader:Qe.depth_frag},normal:{uniforms:Ke.merge([er.common,er.bumpmap,er.normalmap,er.displacementmap,{opacity:{value:1}}]),vertexShader:Qe.normal_vert,fragmentShader:Qe.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qe.cube_vert,fragmentShader:Qe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qe.equirect_vert,fragmentShader:Qe.equirect_frag},distanceRGBA:{uniforms:Ke.merge([er.common,er.displacementmap,{referencePosition:{value:new Be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qe.distanceRGBA_vert,fragmentShader:Qe.distanceRGBA_frag},shadow:{uniforms:Ke.merge([er.lights,er.fog,{color:{value:new tr(0)},opacity:{value:1}}]),vertexShader:Qe.shadow_vert,fragmentShader:Qe.shadow_frag}};function nr(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||nr.DefaultOrder}function ir(){this.mask=1}rr.physical={uniforms:Ke.merge([rr.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},nr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],nr.DefaultOrder="XYZ",Object.defineProperties(nr.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(nr.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=De.clamp,i=t.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===e?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new ke;return function(e,r,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new Ue;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Be(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(ir.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var or=0;function sr(){Object.defineProperty(this,"id",{value:or++}),this.uuid=De.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=sr.DefaultUp.clone();var t=new Be,e=new nr,r=new Ue,n=new Be(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new ke},normalMatrix:{value:new je}}),this.matrix=new ke,this.matrixWorld=new ke,this.matrixAutoUpdate=sr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ir,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ar(){sr.call(this),this.type="Camera",this.matrixWorldInverse=new ke,this.projectionMatrix=new ke}function lr(t,e,r,n,i,o){ar.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function cr(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new Be,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new tr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}sr.DefaultUp=new Be(0,1,0),sr.DefaultMatrixAutoUpdate=!0,sr.prototype=Object.assign(Object.create(n.prototype),{constructor:sr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new Ue;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new Ue;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Be(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Be(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Be(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Be;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new Be(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Be(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Be(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new ke;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new ke,e=new Be;return function(r,n,i){r.isVector3?e.copy(r):e.set(r,n,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Be),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new Be,e=new Be;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),r=new Ue),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldScale:function(){var t=new Be,e=new Ue;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Be),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new Ue;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Be),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++)i(t.shapes,s[a]);else i(t.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(a=0,l=this.material.length;a<l;a++)c.push(i(t.materials,this.material[a]));n.material=c}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(t).object);if(e){var u=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);s=f(t.shapes),u.length>0&&(r.geometries=u),h.length>0&&(r.materials=h),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),s.length>0&&(r.shapes=s)}return r.object=n,r;function f(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}),ar.prototype=Object.assign(Object.create(sr.prototype),{constructor:ar,isCamera:!0,copy:function(t,e){return sr.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new Ue;return function(e){return void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Be),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){sr.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),lr.prototype=Object.assign(Object.create(ar.prototype),{constructor:lr,isOrthographicCamera:!0,copy:function(t,e){return ar.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,s=n+e,a=n-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),a=(s-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far)},toJSON:function(t){var e=sr.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(cr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var ur=0;function hr(){Object.defineProperty(this,"id",{value:ur+=2}),this.uuid=De.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function dr(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function pr(t,e,r){dr.call(this,new Int8Array(t),e,r)}function fr(t,e,r){dr.call(this,new Uint8Array(t),e,r)}function mr(t,e,r){dr.call(this,new Uint8ClampedArray(t),e,r)}function vr(t,e,r){dr.call(this,new Int16Array(t),e,r)}function gr(t,e,r){dr.call(this,new Uint16Array(t),e,r)}function yr(t,e,r){dr.call(this,new Int32Array(t),e,r)}function xr(t,e,r){dr.call(this,new Uint32Array(t),e,r)}function br(t,e,r){dr.call(this,new Float32Array(t),e,r)}function wr(t,e,r){dr.call(this,new Float64Array(t),e,r)}function _r(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Sr(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}hr.prototype=Object.assign(Object.create(n.prototype),{constructor:hr,isGeometry:!0,applyMatrix:function(t){for(var e=(new je).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,s=i.vertexNormals.length;o<s;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new ke;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new ke;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new ke;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new ke;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new ke;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new sr;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new Be(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new Be(o[d],o[d+1],o[d+2])),void 0!==s&&e.colors.push(new tr(s[d],s[d+1],s[d+2])),void 0!==a&&u.push(new Fe(a[p],a[p+1])),void 0!==l&&h.push(new Fe(l[p],l[p+1]));function f(t,r,n,i){var d=new cr(t,r,n,void 0!==o?[c[t].clone(),c[r].clone(),c[n].clone()]:[],void 0!==s?[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()]:[],i);e.faces.push(d),void 0!==a&&e.faceVertexUvs[0].push([u[t].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([h[t].clone(),h[r].clone(),h[n].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new Be;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new ke;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Be,e=new Be,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b];t.subVectors(this.vertices[i.c],s),e.subVectors(o,s),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,s;for(void 0===t&&(t=!0),s=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)s[e]=new Be;if(t){var a,l,c=new Be,u=new Be;for(n=0,i=this.faces.length;n<i;n++)a=this.vertices[(o=this.faces[n]).a],c.subVectors(this.vertices[o.c],l=this.vertices[o.b]),u.subVectors(a,l),c.cross(u),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)s[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var h=(o=this.faces[n]).vertexNormals;3===h.length?(h[0].copy(s[o.a]),h[1].copy(s[o.b]),h[2].copy(s[o.c])):(h[0]=s[o.a].clone(),h[1]=s[o.b].clone(),h[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new hr;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Be,c={a:new Be,b:new Be,c:new Be},s.push(l),a.push(c)}var l,c,u=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)c=u.vertexNormals[r],(l=u.faceNormals[r]).copy((i=this.faces[r]).normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qe),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ye),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,l=t.faces,c=this.faceVertexUvs[0],u=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new je).getNormalMatrix(e));for(var p=0,f=s.length;p<f;p++){var m=s[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y=l[p],x=y.vertexNormals,b=y.vertexColors;(v=new cr(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var w=0,_=x.length;w<_;w++)g=x[w].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=b.length;w<_;w++)v.vertexColors.push(b[w].clone());v.materialIndex=y.materialIndex+r,a.push(v)}for(p=0,f=u.length;p<f;p++){var S=u[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());c.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,s,a,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[e]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new Be(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,i,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];for(o&&o.length===e&&(n=[]),s&&s.length===e&&(i=[]),r=0;r<e;r++){var a=t[r]._id;n&&n.push(o[a]),i&&i.push(s[a])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),s.push(x),s.push(p.a,p.b,p.c),s.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];s.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&s.push(T(p.normal)),v){var w=p.vertexNormals;s.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&s.push(M(p.color)),y){var _=p.vertexColors;s.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=a.length/3,a.push(t.x,t.y,t.z),l[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]?u[e]:(u[e]=c.length,c.push(t.getHex()),u[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=n,t.data.normals=a,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=s,t},clone:function(){return(new hr).copy(this)},copy:function(t){var e,r,n,i,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,r=a.length;e<r;e++)this.vertices.push(a[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,r=c.length;e<r;e++)this.faces.push(c[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,s=h.length;o<s;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,r=p.length;e<r;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],n=0,i=p[e].vertices.length;n<i;n++)f.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(f.normals=[],n=0,i=p[e].normals.length;n<i;n++)f.normals.push(p[e].normals[n].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,r=m.length;e<r;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,i=m[e].vertexNormals.length;n<i;n++){var g=m[e].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,i=m[e].faceNormals.length;n<i;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var x=t.skinWeights;for(e=0,r=x.length;e<r;e++)this.skinWeights.push(x[e].clone());var b=t.skinIndices;for(e=0,r=b.length;e<r;e++)this.skinIndices.push(b[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(dr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(dr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new tr),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Fe),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Be),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Ge),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(pr.prototype=Object.create(dr.prototype)).constructor=pr,(fr.prototype=Object.create(dr.prototype)).constructor=fr,(mr.prototype=Object.create(dr.prototype)).constructor=mr,(vr.prototype=Object.create(dr.prototype)).constructor=vr,(gr.prototype=Object.create(dr.prototype)).constructor=gr,(yr.prototype=Object.create(dr.prototype)).constructor=yr,(xr.prototype=Object.create(dr.prototype)).constructor=xr,(br.prototype=Object.create(dr.prototype)).constructor=br,(wr.prototype=Object.create(dr.prototype)).constructor=wr,Object.assign(_r.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var s=i[o];s.materialIndex!==n&&(n=s.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=t.morphTargets,l=a.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]=[];this.morphTargets.position=e}var u,h=t.morphNormals,d=h.length;if(d>0){for(u=[],c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=t.skinIndices,f=t.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Fe,new Fe,new Fe))),!0===s&&(void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Fe,new Fe,new Fe)));for(var S=0;S<l;S++){var T=a[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Tr=1;function Mr(){Object.defineProperty(this,"id",{value:Tr+=2}),this.uuid=De.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ar(t,e,r,n,i,o){hr.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Er(t,e,r,n,i,o)),this.mergeVertices()}function Er(t,e,r,n,i,o){Mr.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var s=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var a=[],l=[],c=[],u=[],h=0,d=0;function p(t,e,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Be;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++)P[t]=(y*b-_)*n,P[e]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*(x+1),L=h+(y+1)+M*(x+1),I=h+(y+1)+M*x;a.push(h+y+M*x,N,I),a.push(N,L,I),C+=6}s.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,e,-t,o,i,1),p("x","z","y",1,1,t,r,e,n,o,2),p("x","z","y",1,-1,t,r,-e,n,o,3),p("x","y","z",1,-1,t,e,r,n,i,4),p("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(a),this.addAttribute("position",new br(l,3)),this.addAttribute("normal",new br(c,3)),this.addAttribute("uv",new br(u,2))}function Cr(t,e,r,n){hr.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Pr(t,e,r,n)),this.mergeVertices()}function Pr(t,e,r,n){Mr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,s=(t=t||1)/2,a=(e=e||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=t/l,p=e/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-a;for(i=0;i<u;i++)m.push(i*d-s,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}for(o=0;o<c;o++)for(i=0;i<l;i++){var x=i+u*(o+1),b=i+1+u*(o+1),w=i+1+u*o;f.push(i+u*o,x,w),f.push(x,b,w)}this.setIndex(f),this.addAttribute("position",new br(m,3)),this.addAttribute("normal",new br(v,3)),this.addAttribute("uv",new br(g,2))}Mr.prototype=Object.assign(Object.create(n.prototype),{constructor:Mr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(Sr(t)>65535?xr:gr)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new dr(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;return void 0!==r&&((new je).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new ke;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new ke;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new ke;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new ke;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new ke;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new sr;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Be;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new br(3*e.vertices.length,3),n=new br(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new br(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new br(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new _r).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new dr(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new dr(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new dr(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new dr(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new dr(o,2).copyVector2sArray(t.uvs2))}for(var s in this.groups=t.groups,t.morphTargets){for(var a=[],l=t.morphTargets[s],c=0,u=l.length;c<u;c++){var h=l[c],d=new br(3*h.length,3);a.push(d.copyVector3sArray(h))}this.morphAttributes[s]=a}if(t.skinIndices.length>0){var p=new br(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new br(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qe);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new qe,e=new Be;return function(){null===this.boundingSphere&&(this.boundingSphere=new Ye);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;t.setFromBufferAttribute(r),t.getCenter(n);for(var i=0,o=0,s=r.count;o<s;o++)e.x=r.getX(o),e.y=r.getY(o),e.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new dr(new Float32Array(n.length),3));else for(var i=e.normal.array,o=0,s=i.length;o<s;o++)i[o]=0;var a,l,c,u=e.normal.array,h=new Be,d=new Be,p=new Be,f=new Be,m=new Be;if(t){var v=t.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,s=b+x.count;o<s;o+=3)l=3*v[o+1],c=3*v[o+2],h.fromArray(n,a=3*v[o+0]),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[a]+=f.x,u[a+1]+=f.y,u[a+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,s=n.length;o<s;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],s=o.array,a=0,l=o.itemSize*e;a<s.length;a++,l++)i[l]=s[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new Be;return function(){for(var e=this.attributes.normal,r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Mr,e=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,s=i.itemSize,a=new o.constructor(e.length*s),l=0,c=0,u=0,h=e.length;u<h;u++){l=e[u]*s;for(var d=0;d<s;d++)a[c++]=o[l++]}t.addAttribute(n,new dr(a,s))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var s=o[r];i=Array.prototype.slice.call(s.array),t.data.attributes[r]={itemSize:s.itemSize,type:s.array.constructor.name,array:i,normalized:s.normalized}}var a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new Mr).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var s=t.morphAttributes;for(e in s){var a=[],l=s[e];for(r=0,n=l.length;r<n;r++)a.push(l[r].clone());this.morphAttributes[e]=a}var c=t.groups;for(r=0,n=c.length;r<n;r++){var u=c[r];this.addGroup(u.start,u.count,u.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Ar.prototype=Object.create(hr.prototype)).constructor=Ar,(Er.prototype=Object.create(Mr.prototype)).constructor=Er,(Cr.prototype=Object.create(hr.prototype)).constructor=Cr,(Pr.prototype=Object.create(Mr.prototype)).constructor=Pr;var Or=0;function Nr(){Object.defineProperty(this,"id",{value:Or++}),this.uuid=De.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=T,this.side=m,this.flatShading=!1,this.vertexColors=b,this.opacity=1,this.transparent=!1,this.blendSrc=U,this.blendDst=B,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Y,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Lr(t){Nr.call(this),this.type="MeshBasicMaterial",this.color=new tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Ir(t){Nr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Rr(t,e){this.origin=void 0!==t?t:new Be,this.direction=void 0!==e?e:new Be}function Dr(t,e){this.start=void 0!==t?t:new Be,this.end=void 0!==e?e:new Be}function Fr(t,e,r){this.a=void 0!==t?t:new Be,this.b=void 0!==e?e:new Be,this.c=void 0!==r?r:new Be}function kr(t,e){sr.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new Lr({color:16777215*Math.random()}),this.drawMode=_e,this.updateMorphTargets()}function Ur(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Br(t,e,r,n,i,o,s,a,l,c){Ve.call(this,t=void 0!==t?t:[],e=void 0!==e?e:lt,r,n,i,o,s,a,l,c),this.flipY=!1}Nr.prototype=Object.assign(Object.create(n.prototype),{constructor:Nr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]="overdraw"===e?Number(r):r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===y;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==m&&(r.side=this.side),this.vertexColors!==b&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Lr.prototype=Object.create(Nr.prototype)).constructor=Lr,Lr.prototype.isMeshBasicMaterial=!0,Lr.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(Ir.prototype=Object.create(Nr.prototype)).constructor=Ir,Ir.prototype.isShaderMaterial=!0,Ir.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ke.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Ir.prototype.toJSON=function(t){var e=Nr.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(Rr.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Be),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Be;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Be),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Be;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o,s){t.copy(n).add(i).multiplyScalar(.5),e.copy(i).sub(n).normalize(),r.copy(this.origin).sub(t);var a,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(e),p=r.dot(this.direction),f=-r.dot(e),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(a=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(a*=g)*(a+d*(l*=g)+2*p)+l*(d*a+l+2*f)+m}else l=h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l=-h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l<=-u?c=-(a=Math.max(0,-(-d*h+p)))*a+(l=a>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(a=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(a=Math.max(0,-(d*h+p)))*a+(l=a>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(e).multiplyScalar(l).add(t),c}}(),intersectSphere:function(){var t=new Be;return function(e,r){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),i=t.dot(t)-n*n,o=e.radius*e.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=n-s,l=n+s;return a<0&&l<0?null:this.at(a<0?l:a,r)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(s=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(s=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),r>a||s>n?null:((s>r||r!=r)&&(r=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(){var t=new Be;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new Be,e=new Be,r=new Be,n=new Be;return function(i,o,s,a,l){e.subVectors(o,i),r.subVectors(s,i),n.crossVectors(e,r);var c,u=this.direction.dot(n);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}t.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=c*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>u)return null;var p=-c*t.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Dr.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Be),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Be),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Be),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new Be,e=new Be;return function(r,n){t.subVectors(r,this.start),e.subVectors(this.end,this.start);var i=e.dot(e),o=e.dot(t)/i;return n&&(o=De.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Be),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Fr,{getNormal:function(){var t=new Be;return function(e,r,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Be),i.subVectors(n,r),t.subVectors(e,r),i.cross(t);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var t=new Be,e=new Be,r=new Be;return function(n,i,o,s,a){t.subVectors(s,i),e.subVectors(o,i),r.subVectors(n,i);var l=t.dot(t),c=t.dot(e),u=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-c*c;if(void 0===a&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),a=new Be),0===p)return a.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return a.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new Be;return function(e,r,n,i){return Fr.getBarycoord(e,r,n,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(Fr.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Be,e=new Be;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Be),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Fr.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Be),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Fr.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Fr.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Ze,e=[new Dr,new Dr,new Dr],r=new Be,n=new Be;return function(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new Be);var s=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var a=0;a<e.length;a++){e[a].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<s&&(s=l,o.copy(n))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),kr.prototype=Object.assign(Object.create(sr.prototype),{constructor:kr,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return sr.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var s=i[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)r=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var a=n.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}},raycast:function(){var t=new ke,e=new Rr,r=new Ye,n=new Be,i=new Be,o=new Be,s=new Be,a=new Be,l=new Be,c=new Fe,u=new Fe,h=new Fe,d=new Be,p=new Be,f=new Be;function m(t,e,r,n,i,o,s){return Fr.getBarycoord(t,e,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),s.multiplyScalar(d.z),i.add(o).add(s),i.clone()}function y(t,e,r,n,i,o,s,a){if(null===(e.side===v?n.intersectTriangle(s,o,i,!0,a):n.intersectTriangle(i,o,s,e.side!==g,a)))return null;f.copy(a),f.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:t}}function x(t,e,r,s,a,l,d,f){n.fromBufferAttribute(s,l),i.fromBufferAttribute(s,d),o.fromBufferAttribute(s,f);var v=y(t,t.material,e,r,n,i,o,p);if(v){a&&(c.fromBufferAttribute(a,l),u.fromBufferAttribute(a,d),h.fromBufferAttribute(a,f),v.uv=m(p,n,i,o,c,u,h));var g=new cr(l,d,f);Fr.getNormal(n,i,o,g.normal),v.face=g,v.faceIndex=l}return v}return function(d,f){var v,g=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===g.boundingSphere&&g.computeBoundingSphere(),r.copy(g.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===g.boundingBox||!1!==e.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var _,S,T,M,A,E=g.index,C=g.attributes.position,P=g.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(v=x(this,d,e,C,P,_,S,T))&&(v.faceIndex=Math.floor(M/3),f.push(v));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(v=x(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(v.index=_,f.push(v))}else if(g.isGeometry){var O,N,L,I,R=Array.isArray(b),D=g.vertices,F=g.faces,k=g.faceVertexUvs[0];k.length>0&&(I=k);for(var U=0,B=F.length;U<B;U++){var j=F[U],z=R?b[j.materialIndex]:b;if(void 0!==z){if(O=D[j.a],N=D[j.b],L=D[j.c],!0===z.morphTargets){var V=g.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;n.addScaledVector(s.subVectors(q[j.a],O),X),i.addScaledVector(a.subVectors(q[j.b],N),X),o.addScaledVector(l.subVectors(q[j.c],L),X)}}n.add(O),i.add(N),o.add(L),O=n,N=i,L=o}if(v=y(this,z,d,e,O,N,L,p)){if(I&&I[U]){var Y=I[U];c.copy(Y[0]),u.copy(Y[1]),h.copy(Y[2]),v.uv=m(p,O,N,L,c,u,h)}v.face=j,v.faceIndex=U,f.push(v)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(Br.prototype=Object.create(Ve.prototype)).constructor=Br,Br.prototype.isCubeTexture=!0,Object.defineProperty(Br.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var jr=new Ve,zr=new Br;function Vr(){this.seq=[],this.map={}}var Gr=[],Hr=[],Wr=new Float32Array(16),Xr=new Float32Array(9);function qr(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=Gr[i];if(void 0===o&&(o=new Float32Array(i),Gr[i]=o),0!==e){n.toArray(o,0);for(var s=1,a=0;s!==e;++s)t[s].toArray(o,a+=r)}return o}function Yr(t,e){var r=Hr[e];void 0===r&&(r=new Int32Array(e),Hr[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocTextureUnit();return r}function Zr(t,e){t.uniform1f(this.addr,e)}function Jr(t,e){t.uniform1i(this.addr,e)}function Qr(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function Kr(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function $r(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function tn(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function en(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Xr.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Xr))}function rn(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(Wr.set(e.elements),t.uniformMatrix4fv(this.addr,!1,Wr))}function nn(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTexture2D(e||jr,n)}function on(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTextureCube(e||zr,n)}function sn(t,e){t.uniform2iv(this.addr,e)}function an(t,e){t.uniform3iv(this.addr,e)}function ln(t,e){t.uniform4iv(this.addr,e)}function cn(t,e){t.uniform1fv(this.addr,e)}function un(t,e){t.uniform1iv(this.addr,e)}function hn(t,e){t.uniform2fv(this.addr,qr(e,this.size,2))}function dn(t,e){t.uniform3fv(this.addr,qr(e,this.size,3))}function pn(t,e){t.uniform4fv(this.addr,qr(e,this.size,4))}function fn(t,e){t.uniformMatrix2fv(this.addr,!1,qr(e,this.size,4))}function mn(t,e){t.uniformMatrix3fv(this.addr,!1,qr(e,this.size,9))}function vn(t,e){t.uniformMatrix4fv(this.addr,!1,qr(e,this.size,16))}function gn(t,e,r){var n=e.length,i=Yr(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(e[o]||jr,i[o])}function yn(t,e,r){var n=e.length,i=Yr(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(e[o]||zr,i[o])}function xn(t,e,r){this.id=t,this.addr=r,this.setValue=function(t){switch(e.type){case 5126:return Zr;case 35664:return Qr;case 35665:return Kr;case 35666:return $r;case 35674:return tn;case 35675:return en;case 35676:return rn;case 35678:case 36198:return nn;case 35680:return on;case 5124:case 35670:return Jr;case 35667:case 35671:return sn;case 35668:case 35672:return an;case 35669:case 35673:return ln}}()}function bn(t,e,r){this.id=t,this.addr=r,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return cn;case 35664:return hn;case 35665:return dn;case 35666:return pn;case 35674:return fn;case 35675:return mn;case 35676:return vn;case 35678:return gn;case 35680:return yn;case 5124:case 35670:return un;case 35667:case 35671:return sn;case 35668:case 35672:return an;case 35669:case 35673:return ln}}()}function wn(t){this.id=t,Vr.call(this)}wn.prototype.setValue=function(t,e){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(t,e[o.id])}};var _n=/([\w\d_]+)(\])?(\[|\.)?/g;function Sn(t,e){t.seq.push(e),t.map[e.id]=e}function Tn(t,e,r){var n=t.name,i=n.length;for(_n.lastIndex=0;;){var o=_n.exec(n),s=o[1],a=o[3];if("]"===o[2]&&(s|=0),void 0===a||"["===a&&_n.lastIndex+2===i){Sn(r,void 0===a?new xn(s,t,e):new bn(s,t,e));break}var l=r.map[s];void 0===l&&Sn(r,l=new wn(s)),r=l}}function Mn(t,e,r){Vr.call(this),this.renderer=r;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=t.getActiveUniform(e,i);Tn(o,t.getUniformLocation(e,o.name),this)}}function An(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(r)),n}Mn.prototype.setValue=function(t,e,r){var n=this.map[e];void 0!==n&&n.setValue(t,r,this.renderer)},Mn.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},Mn.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var s=e[i],a=r[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},Mn.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r};var En=0;function Cn(t){switch(t){case Me:return["Linear","( value )"];case Ae:return["sRGB","( value )"];case Ce:return["RGBE","( value )"];case Oe:return["RGBM","( value, 7.0 )"];case Ne:return["RGBM","( value, 16.0 )"];case Le:return["RGBD","( value, 256.0 )"];case Ee:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Pn(t,e){var r=Cn(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function On(t){return""!==t}function Nn(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Ln(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function In(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var r=Qe[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return In(r)})}function Rn(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,r,n){for(var i="",o=parseInt(e);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]");return i})}function Dn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Fn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}var kn=0;function Un(t){Nr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ie,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Bn(t){Nr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Be,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function jn(t,e,r){for(var n=new Je,i=new ke,o=new Fe,s=new Fe(r,r),a=new Be,l=new Be,c=1,u=2,h=1+(c|u),d=new Array(h),f=new Array(h),y={},x={0:v,1:m,2:g},b=[new Be(1,0,0),new Be(-1,0,0),new Be(0,0,1),new Be(0,0,-1),new Be(0,1,0),new Be(0,-1,0)],w=[new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,0,1),new Be(0,0,-1)],_=[new Ge,new Ge,new Ge,new Ge,new Ge,new Ge],S=0;S!==h;++S){var T=0!=(S&c),M=0!=(S&u),A=new Un({depthPacking:Re,morphTargets:T,skinning:M});d[S]=A;var E=new Bn({morphTargets:T,skinning:M});f[S]=E}var C=this;function P(e,r,n,i,o,s){var a=e.geometry,l=null,h=d,p=e.customDepthMaterial;if(n&&(h=f,p=e.customDistanceMaterial),p)l=p;else{var m=!1;r.morphTargets&&(a&&a.isBufferGeometry?m=a.morphAttributes&&a.morphAttributes.position&&a.morphAttributes.position.length>0:a&&a.isGeometry&&(m=a.morphTargets&&a.morphTargets.length>0)),e.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var v=0;m&&(v|=c),e.isSkinnedMesh&&r.skinning&&(v|=u),l=h[v]}if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=l.uuid,b=r.uuid,w=y[g];void 0===w&&(y[g]=w={});var _=w[b];void 0===_&&(_=l.clone(),w[b]=_),l=_}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:x[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=o,l.farDistance=s),l}function O(r,i,o,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var a=e.update(r),c=r.material;if(Array.isArray(c))for(var u=a.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=P(r,f,s,l,o.near,o.far);t.renderBufferDirect(o,null,a,m,r,p)}}else c.visible&&(m=P(r,c,s,l,o.near,o.far),t.renderBufferDirect(o,null,a,m,r,null))}for(var v=r.children,g=0,y=v.length;g<y;g++)O(v[g],i,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p,this.render=function(e,r,c){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==e.length){var u,h=t.state;h.disable(t.context.BLEND),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var d=0,p=e.length;d<p;d++){var f=e[d],m=f.shadow,v=f&&f.isPointLight;if(void 0!==m){var g=m.camera;if(o.copy(m.mapSize),o.min(s),v){var y=o.x,x=o.y;_[0].set(2*y,x,y,x),_[1].set(0,x,y,x),_[2].set(3*y,x,y,x),_[3].set(y,x,y,x),_[4].set(3*y,0,y,x),_[5].set(y,0,y,x),o.x*=4,o.y*=2}null===m.map&&(m.map=new He(o.x,o.y,{minFilter:yt,magFilter:yt,format:Ut}),m.map.texture.name=f.name+".shadowMap",g.updateProjectionMatrix()),m.isSpotLightShadow&&m.update(f);var S=m.map,T=m.matrix;l.setFromMatrixPosition(f.matrixWorld),g.position.copy(l),v?(u=6,T.makeTranslation(-l.x,-l.y,-l.z)):(u=1,a.setFromMatrixPosition(f.target.matrixWorld),g.lookAt(a),g.updateMatrixWorld(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(g.projectionMatrix),T.multiply(g.matrixWorldInverse)),t.setRenderTarget(S),t.clear();for(var M=0;M<u;M++)v&&(a.copy(g.position),a.add(b[M]),g.up.copy(w[M]),g.lookAt(a),g.updateMatrixWorld(),h.viewport(_[M])),i.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),n.setFromMatrix(i),O(r,c,g,v)}else console.warn("THREE.WebGLShadowMap:",f,"has no shadow.")}C.needsUpdate=!1}}}function zn(t,e,r,n,i,o,s,a,l){Ve.call(this,t,e,r,n,i,o,s,a,l),this.needsUpdate=!0}function Vn(t,e){return{convert:function(r){var n;if(r===mt)return t.REPEAT;if(r===vt)return t.CLAMP_TO_EDGE;if(r===gt)return t.MIRRORED_REPEAT;if(r===yt)return t.NEAREST;if(r===xt)return t.NEAREST_MIPMAP_NEAREST;if(r===bt)return t.NEAREST_MIPMAP_LINEAR;if(r===wt)return t.LINEAR;if(r===_t)return t.LINEAR_MIPMAP_NEAREST;if(r===St)return t.LINEAR_MIPMAP_LINEAR;if(r===Tt)return t.UNSIGNED_BYTE;if(r===Lt)return t.UNSIGNED_SHORT_4_4_4_4;if(r===It)return t.UNSIGNED_SHORT_5_5_5_1;if(r===Rt)return t.UNSIGNED_SHORT_5_6_5;if(r===Mt)return t.BYTE;if(r===At)return t.SHORT;if(r===Et)return t.UNSIGNED_SHORT;if(r===Ct)return t.INT;if(r===Pt)return t.UNSIGNED_INT;if(r===Ot)return t.FLOAT;if(r===Nt&&null!==(n=e.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(r===Ft)return t.ALPHA;if(r===kt)return t.RGB;if(r===Ut)return t.RGBA;if(r===Bt)return t.LUMINANCE;if(r===jt)return t.LUMINANCE_ALPHA;if(r===Vt)return t.DEPTH_COMPONENT;if(r===Gt)return t.DEPTH_STENCIL;if(r===P)return t.FUNC_ADD;if(r===O)return t.FUNC_SUBTRACT;if(r===N)return t.FUNC_REVERSE_SUBTRACT;if(r===R)return t.ZERO;if(r===D)return t.ONE;if(r===F)return t.SRC_COLOR;if(r===k)return t.ONE_MINUS_SRC_COLOR;if(r===U)return t.SRC_ALPHA;if(r===B)return t.ONE_MINUS_SRC_ALPHA;if(r===j)return t.DST_ALPHA;if(r===z)return t.ONE_MINUS_DST_ALPHA;if(r===V)return t.DST_COLOR;if(r===G)return t.ONE_MINUS_DST_COLOR;if(r===H)return t.SRC_ALPHA_SATURATE;if((r===Ht||r===Wt||r===Xt||r===qt)&&null!==(n=e.get("WEBGL_compressed_texture_s3tc"))){if(r===Ht)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Wt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Xt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===qt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===Yt||r===Zt||r===Jt||r===Qt)&&null!==(n=e.get("WEBGL_compressed_texture_pvrtc"))){if(r===Yt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Zt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Jt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Qt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Kt&&null!==(n=e.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((r===$t||r===te||r===ee||r===re||r===ne||r===ie||r===oe||r===se||r===ae||r===le||r===ce||r===ue||r===he||r===de)&&null!==(n=e.get("WEBGL_compressed_texture_astc")))return r;if((r===L||r===I)&&null!==(n=e.get("EXT_blend_minmax"))){if(r===L)return n.MIN_EXT;if(r===I)return n.MAX_EXT}return r===Dt&&null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}function Gn(t,e,r,n){ar.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Hn(t){Gn.call(this),this.cameras=t||[]}function Wn(t){var e=this,r=null,n=null,i=null,o=new ke,s=new ke;"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData);var a=new ke,l=new Ue,c=new Be,u=new Gn;u.bounds=new Ge(0,0,.5,1),u.layers.enable(1);var h=new Gn;h.bounds=new Ge(.5,0,.5,1),h.layers.enable(2);var d,p,f=new Hn([u,h]);function m(){if(null!==r&&r.isPresenting){var n=r.getEyeParameters("left"),i=n.renderWidth,o=n.renderHeight;p=t.getPixelRatio(),d=t.getSize(),t.setDrawingBufferSize(2*i,o,1)}else e.enabled&&t.setDrawingBufferSize(d.width,d.height,p)}f.layers.enable(1),f.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",m,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t)},this.setPoseTarget=function(t){void 0!==t&&(i=t)},this.getCamera=function(t){if(null===r)return t;r.depthNear=t.near,r.depthFar=t.far,r.getFrameData(n);var d=r.stageParameters;d?o.fromArray(d.sittingToStandingTransform):o.makeTranslation(0,e.userHeight,0);var p=n.pose,m=null!==i?i:t;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==p.orientation&&(l.fromArray(p.orientation),m.quaternion.multiply(l)),null!==p.position&&(l.setFromRotationMatrix(o),c.fromArray(p.position),c.applyQuaternion(l),m.position.add(c)),m.updateMatrixWorld(),!1===r.isPresenting)return t;u.near=t.near,h.near=t.near,u.far=t.far,h.far=t.far,f.matrixWorld.copy(t.matrixWorld),f.matrixWorldInverse.copy(t.matrixWorldInverse),u.matrixWorldInverse.fromArray(n.leftViewMatrix),h.matrixWorldInverse.fromArray(n.rightViewMatrix),s.getInverse(o),u.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s);var v=m.parent;null!==v&&(a.getInverse(v.matrixWorld),u.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a)),u.matrixWorld.getInverse(u.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),u.projectionMatrix.fromArray(n.leftProjectionMatrix),h.projectionMatrix.fromArray(n.rightProjectionMatrix),f.projectionMatrix.copy(u.projectionMatrix);var g=r.getLayers();if(g.length){var y=g[0];null!==y.leftBounds&&4===y.leftBounds.length&&u.bounds.fromArray(y.leftBounds),null!==y.rightBounds&&4===y.rightBounds.length&&h.bounds.fromArray(y.rightBounds)}return f},this.getStandingMatrix=function(){return o},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",m)}}function Xn(t){console.log("THREE.WebGLRenderer",i);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,c=void 0===t.stencil||t.stencil,u=void 0!==t.antialias&&t.antialias,h=void 0===t.premultipliedAlpha||t.premultipliedAlpha,d=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,m=void 0!==t.powerPreference?t.powerPreference:"default",y=null,x=null;this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=nt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var w,_,P,O,N,L,I,R,D,F,k,U,B,j,z,V,G,H,at,mt=this,gt=!1,_t=null,St=null,Mt=-1,At="",Ct=null,Lt=null,It=new Ge,Rt=new Ge,Ft=null,Bt=0,jt=e.width,zt=e.height,Ht=1,Wt=new Ge(0,0,jt,zt),Xt=new Ge(0,0,jt,zt),qt=!1,Yt=new Je,Zt=new function(){var t=this,e=null,r=0,n=!1,i=!1,o=new Ze,s=new je,a={value:null,needsUpdate:!1};function l(){a.value!==e&&(a.value=e,a.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,r,n,i){var l=null!==e?e.length:0,c=null;if(0!==l){if(c=a.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=n;d!==l;++d,p+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(c,p),c[p+3]=o.constant}a.value=c,a.needsUpdate=!0}return t.numPlanes=l,c}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,o){var s=0!==t.length||i||0!==r||n;return n=i,e=c(t,o,0),r=t.length,s},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(t,o,s,u,h,d){if(!n||null===t||0===t.length||i&&!s)i?c(null):l();else{var p=i?0:r,f=4*p,m=h.clippingState||null;a.value=m,m=c(t,u,f,d);for(var v=0;v!==f;++v)m[v]=e[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}},Jt=!1,Qt=!1,Kt=new ke,$t=new Be;function te(){return null===_t?Ht:1}try{var ee={alpha:n,depth:o,stencil:c,antialias:u,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:m};if(e.addEventListener("webglcontextlost",oe,!1),e.addEventListener("webglcontextrestored",se,!1),null===(w=r||e.getContext("webgl",ee)||e.getContext("experimental-webgl",ee)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===w.getShaderPrecisionFormat&&(w.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){console.error("THREE.WebGLRenderer: "+t.message)}function re(){(_=new function(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}(w)).get("WEBGL_depth_texture"),_.get("OES_texture_float"),_.get("OES_texture_float_linear"),_.get("OES_texture_half_float"),_.get("OES_texture_half_float_linear"),_.get("OES_standard_derivatives"),_.get("OES_element_index_uint"),_.get("ANGLE_instanced_arrays"),at=new Vn(w,_),P=new function(t,e,r){var n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var a=!0===r.logarithmicDepthBuffer,l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_TEXTURE_SIZE),h=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=c>0,g=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var r=e.get("EXT_texture_filter_anisotropic");return n=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:a,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:h,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}(w,_,t),(O=new function(t,e,r){var n=new function(){var e=!1,r=new Ge,n=null,i=new Ge(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,o,s,a){!0===a&&(e*=s,n*=s,o*=s),r.set(e,n,o,s),!1===i.equals(r)&&(t.clearColor(e,n,o,s),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},i=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(e){e?et(t.DEPTH_TEST):rt(t.DEPTH_TEST)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case W:t.depthFunc(t.NEVER);break;case X:t.depthFunc(t.ALWAYS);break;case q:t.depthFunc(t.LESS);break;case Y:t.depthFunc(t.LEQUAL);break;case Z:t.depthFunc(t.EQUAL);break;case J:t.depthFunc(t.GEQUAL);break;case Q:t.depthFunc(t.GREATER);break;case K:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},o=new function(){var e=!1,r=null,n=null,i=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(e){e?et(t.STENCIL_TEST):rt(t.STENCIL_TEST)},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,s){n===e&&i===r&&o===s||(t.stencilFunc(e,r,s),n=e,i=r,o=s)},setOp:function(e,r,n){s===e&&a===r&&l===n||(t.stencilOp(e,r,n),s=e,a=r,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,r=null,n=null,i=null,o=null,s=null,a=null,l=null,c=null}}},c=t.getParameter(t.MAX_VERTEX_ATTRIBS),u=new Uint8Array(c),h=new Uint8Array(c),d=new Uint8Array(c),p={},f=null,m=null,y=null,x=null,b=null,w=null,_=null,P=null,O=null,N=!1,L=null,I=null,R=null,D=null,F=null,k=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),U=!1,B=0,j=t.getParameter(t.VERSION);-1!==j.indexOf("WebGL")?(B=parseFloat(/^WebGL\ ([0-9])/.exec(j)[1]),U=B>=1):-1!==j.indexOf("OpenGL ES")&&(B=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(j)[1]),U=B>=2);var z=null,V={},G=new Ge,H=new Ge;function $(e,r,n){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<n;s++)t.texImage2D(r+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);return o}var tt={};function et(e){!0!==p[e]&&(t.enable(e),p[e]=!0)}function rt(e){!1!==p[e]&&(t.disable(e),p[e]=!1)}function nt(e,n,i,o,s,a,l,c){if(e!==S?et(t.BLEND):rt(t.BLEND),e!==C){if(e!==y||c!==N)switch(e){case M:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case A:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case E:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:c?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}x=null,b=null,w=null,_=null,P=null,O=null}else s=s||n,a=a||i,l=l||o,n===x&&s===_||(t.blendEquationSeparate(r.convert(n),r.convert(s)),x=n,_=s),i===b&&o===w&&a===P&&l===O||(t.blendFuncSeparate(r.convert(i),r.convert(o),r.convert(a),r.convert(l)),b=i,w=o,P=a,O=l);y=e,N=c}function it(e){L!==e&&(t.frontFace(e?t.CW:t.CCW),L=e)}function ot(e){e!==s?(et(t.CULL_FACE),e!==I&&t.cullFace(e===a?t.BACK:e===l?t.FRONT:t.FRONT_AND_BACK)):rt(t.CULL_FACE),I=e}function st(e,r,n){e?(et(t.POLYGON_OFFSET_FILL),D===r&&F===n||(t.polygonOffset(r,n),D=r,F=n)):rt(t.POLYGON_OFFSET_FILL)}function at(e){void 0===e&&(e=t.TEXTURE0+k-1),z!==e&&(t.activeTexture(e),z=e)}return tt[t.TEXTURE_2D]=$(t.TEXTURE_2D,t.TEXTURE_2D,1),tt[t.TEXTURE_CUBE_MAP]=$(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),i.setClear(1),o.setClear(0),et(t.DEPTH_TEST),i.setFunc(Y),it(!1),ot(a),et(t.CULL_FACE),et(t.BLEND),nt(T),{buffers:{color:n,depth:i,stencil:o},initAttributes:function(){for(var t=0,e=u.length;t<e;t++)u[t]=0},enableAttribute:function(r){u[r]=1,0===h[r]&&(t.enableVertexAttribArray(r),h[r]=1),0!==d[r]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,0),d[r]=0)},enableAttributeAndDivisor:function(r,n){u[r]=1,0===h[r]&&(t.enableVertexAttribArray(r),h[r]=1),d[r]!==n&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,n),d[r]=n)},disableUnusedAttributes:function(){for(var e=0,r=h.length;e!==r;++e)h[e]!==u[e]&&(t.disableVertexAttribArray(e),h[e]=0)},enable:et,disable:rt,getCompressedTextureFormats:function(){if(null===f&&(f=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var r=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)f.push(r[n]);return f},useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:nt,setMaterial:function(e,r){e.side===g?rt(t.CULL_FACE):et(t.CULL_FACE);var o=e.side===v;r&&(o=!o),it(o),!0===e.transparent?nt(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):nt(S),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),n.setMask(e.colorWrite),st(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:it,setCullFace:ot,setLineWidth:function(e){e!==R&&(U&&t.lineWidth(e),R=e)},setPolygonOffset:st,setScissorTest:function(e){e?et(t.SCISSOR_TEST):rt(t.SCISSOR_TEST)},activeTexture:at,bindTexture:function(e,r){null===z&&at();var n=V[z];void 0===n&&(V[z]=n={type:void 0,texture:void 0}),n.type===e&&n.texture===r||(t.bindTexture(e,r||tt[e]),n.type=e,n.texture=r)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===G.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===H.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),H.copy(e))},reset:function(){for(var e=0;e<h.length;e++)1===h[e]&&(t.disableVertexAttribArray(e),h[e]=0);p={},f=null,z=null,V={},m=null,y=null,L=null,I=null,n.reset(),i.reset(),o.reset()}}}(w,_,at)).scissor(Rt.copy(Xt).multiplyScalar(Ht)),O.viewport(It.copy(Wt).multiplyScalar(Ht)),N=new function(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(r,n,i){switch(i=i||1,e.calls++,n){case t.TRIANGLES:e.triangles+=i*(r/3);break;case t.TRIANGLE_STRIP:case t.TRIANGLE_FAN:e.triangles+=i*(r-2);break;case t.LINES:e.lines+=i*(r/2);break;case t.LINE_STRIP:e.lines+=i*(r-1);break;case t.LINE_LOOP:e.lines+=i*r;break;case t.POINTS:e.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}(w),L=new function(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&t.set(e,r={}),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}},I=new function(t,e,r,n,i,o,s){var a,l="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,c={};function u(t,e){if(t.width>e||t.height>e){if("data"in t)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+t.width+"x"+t.height+").");var r=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*r),n.height=Math.floor(t.height*r),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function h(t){return De.isPowerOfTwo(t.width)&&De.isPowerOfTwo(t.height)}function d(t,e){return t.generateMipmaps&&e&&t.minFilter!==yt&&t.minFilter!==wt}function p(e,r,i,o){t.generateMipmap(e),n.get(r).__maxMipLevel=Math.log2(Math.max(i,o))}function f(e){return e===yt||e===xt||e===bt?t.NEAREST:t.LINEAR}function m(e){var r=e.target;r.removeEventListener("dispose",m),function(e){var r=n.get(e);if(e.image&&r.__image__webglTextureCube)t.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture)}n.remove(e)}(r),r.isVideoTexture&&delete c[r.id],s.memory.textures--}function v(e){var r=e.target;r.removeEventListener("dispose",v),function(e){var r=n.get(e),i=n.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[o]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(e.texture),n.remove(e)}}(r),s.memory.textures--}function g(e,f){var v=n.get(e);if(e.isVideoTexture&&function(t){var e=t.id,r=s.render.frame;c[e]!==r&&(c[e]=r,t.update())}(e),e.version>0&&v.__version!==e.version){var g=e.image;if(void 0===g)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(!1!==g.complete)return void function(e,n,c){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",m),e.__webglTexture=t.createTexture(),s.memory.textures++),r.activeTexture(t.TEXTURE0+c),r.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var f=u(n.image,i.maxTextureSize);(function(t){return t.wrapS!==vt||t.wrapT!==vt||t.minFilter!==yt&&t.minFilter!==wt})(n)&&!1===h(f)&&(f=function(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap?(void 0===a&&(a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),a.width=De.floorPowerOfTwo(t.width),a.height=De.floorPowerOfTwo(t.height),a.getContext("2d").drawImage(t,0,0,a.width,a.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+a.width+"x"+a.height,t),a):t}(f));var v=h(f),g=o.convert(n.format),x=o.convert(n.type);y(t.TEXTURE_2D,n,v);var b,w=n.mipmaps;if(n.isDepthTexture){var _=t.DEPTH_COMPONENT;if(n.type===Ot){if(!l)throw new Error("Float Depth Texture only supported in WebGL2.0");_=t.DEPTH_COMPONENT32F}else l&&(_=t.DEPTH_COMPONENT16);n.format===Vt&&_===t.DEPTH_COMPONENT&&n.type!==Et&&n.type!==Pt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Et,x=o.convert(n.type)),n.format===Gt&&(_=t.DEPTH_STENCIL,n.type!==Dt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Dt,x=o.convert(n.type))),r.texImage2D(t.TEXTURE_2D,0,_,f.width,f.height,0,g,x,null)}else if(n.isDataTexture)if(w.length>0&&v){for(var S=0,T=w.length;S<T;S++)r.texImage2D(t.TEXTURE_2D,S,g,(b=w[S]).width,b.height,0,g,x,b.data);n.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else r.texImage2D(t.TEXTURE_2D,0,g,f.width,f.height,0,g,x,f.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(S=0,T=w.length;S<T;S++)b=w[S],n.format!==Ut&&n.format!==kt?r.getCompressedTextureFormats().indexOf(g)>-1?r.compressedTexImage2D(t.TEXTURE_2D,S,g,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(t.TEXTURE_2D,S,g,b.width,b.height,0,g,x,b.data);e.__maxMipLevel=w.length-1}else if(w.length>0&&v){for(S=0,T=w.length;S<T;S++)r.texImage2D(t.TEXTURE_2D,S,g,g,x,b=w[S]);n.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else r.texImage2D(t.TEXTURE_2D,0,g,g,x,f),e.__maxMipLevel=0;d(n,v)&&p(t.TEXTURE_2D,n,f.width,f.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(v,e,f);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}r.activeTexture(t.TEXTURE0+f),r.bindTexture(t.TEXTURE_2D,v.__webglTexture)}function y(r,s,a){var l;if(a?(t.texParameteri(r,t.TEXTURE_WRAP_S,o.convert(s.wrapS)),t.texParameteri(r,t.TEXTURE_WRAP_T,o.convert(s.wrapT)),t.texParameteri(r,t.TEXTURE_MAG_FILTER,o.convert(s.magFilter)),t.texParameteri(r,t.TEXTURE_MIN_FILTER,o.convert(s.minFilter))):(t.texParameteri(r,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(r,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s.wrapS===vt&&s.wrapT===vt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),t.texParameteri(r,t.TEXTURE_MAG_FILTER,f(s.magFilter)),t.texParameteri(r,t.TEXTURE_MIN_FILTER,f(s.minFilter)),s.minFilter!==yt&&s.minFilter!==wt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=e.get("EXT_texture_filter_anisotropic")){if(s.type===Ot&&null===e.get("OES_texture_float_linear"))return;if(s.type===Nt&&null===e.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function x(e,i,s,a){var l=o.convert(i.texture.format),c=o.convert(i.texture.type);r.texImage2D(a,0,l,i.width,i.height,0,l,c,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,a,n.get(i.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function b(e,r){t.bindRenderbuffer(t.RENDERBUFFER,e),r.depthBuffer&&!r.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r.width,r.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):r.depthBuffer&&r.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,r.width,r.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,r.width,r.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}this.setTexture2D=g,this.setTextureCube=function(e,a){var l=n.get(e);if(6===e.image.length)if(e.version>0&&l.__version!==e.version){l.__image__webglTextureCube||(e.addEventListener("dispose",m),l.__image__webglTextureCube=t.createTexture(),s.memory.textures++),r.activeTexture(t.TEXTURE0+a),r.bindTexture(t.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var c=e&&e.isCompressedTexture,f=e.image[0]&&e.image[0].isDataTexture,v=[],g=0;g<6;g++)v[g]=c||f?f?e.image[g].image:e.image[g]:u(e.image[g],i.maxCubemapSize);var x=v[0],b=h(x),w=o.convert(e.format),_=o.convert(e.type);for(y(t.TEXTURE_CUBE_MAP,e,b),g=0;g<6;g++)if(c)for(var S,T=v[g].mipmaps,M=0,A=T.length;M<A;M++)S=T[M],e.format!==Ut&&e.format!==kt?r.getCompressedTextureFormats().indexOf(w)>-1?r.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,w,S.width,S.height,0,w,_,S.data);else f?r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,v[g].width,v[g].height,0,w,_,v[g].data):r.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,w,w,_,v[g]);l.__maxMipLevel=c?T.length-1:0,d(e,b)&&p(t.TEXTURE_CUBE_MAP,e,x.width,x.height),l.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(t.TEXTURE0+a),r.bindTexture(t.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,i){r.activeTexture(t.TEXTURE0+i),r.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)},this.setupRenderTarget=function(e){var i=n.get(e),o=n.get(e.texture);e.addEventListener("dispose",v),o.__webglTexture=t.createTexture(),s.memory.textures++;var a=!0===e.isWebGLRenderTargetCube,l=h(e);if(a){i.__webglFramebuffer=[];for(var c=0;c<6;c++)i.__webglFramebuffer[c]=t.createFramebuffer()}else i.__webglFramebuffer=t.createFramebuffer();if(a){for(r.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),y(t.TEXTURE_CUBE_MAP,e.texture,l),c=0;c<6;c++)x(i.__webglFramebuffer[c],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+c);d(e.texture,l)&&p(t.TEXTURE_CUBE_MAP,e.texture,e.width,e.height),r.bindTexture(t.TEXTURE_CUBE_MAP,null)}else r.bindTexture(t.TEXTURE_2D,o.__webglTexture),y(t.TEXTURE_2D,e.texture,l),x(i.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),d(e.texture,l)&&p(t.TEXTURE_2D,e.texture,e.width,e.height),r.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&function(e){var r=n.get(e),i=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),g(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Vt)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==Gt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,i,0)}}(r.__webglFramebuffer,e)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=t.createRenderbuffer(),b(r.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),b(r.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}(e)},this.updateRenderTargetMipmap=function(e){var i=e.texture;if(d(i,h(e))){var o=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(i).__webglTexture;r.bindTexture(o,s),p(o,i,e.width,e.height),r.bindTexture(o,null)}}}(w,_,O,L,P,at,N),R=new function(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);n&&(t.deleteBuffer(n.buffer),e.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);void 0===i?e.set(r,function(e,r){var n=e.array,i=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,n,i),e.onUploadCallback();var s=t.FLOAT;return n instanceof Float32Array?s=t.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?s=t.UNSIGNED_SHORT:n instanceof Int16Array?s=t.SHORT:n instanceof Uint32Array?s=t.UNSIGNED_INT:n instanceof Int32Array?s=t.INT:n instanceof Int8Array?s=t.BYTE:n instanceof Uint8Array&&(s=t.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(r,n)):i.version<r.version&&(function(e,r,n){var o=r.array,s=r.updateRange;t.bindBuffer(n,i.buffer),!1===r.dynamic?t.bufferData(n,o,t.STATIC_DRAW):-1===s.count?t.bufferSubData(n,0,o):0===s.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(0,r,n),i.version=r.version)}}}(w),D=new function(t,e,r){var n={},i={};function o(t){var s=t.target,a=n[s.id];for(var l in null!==a.index&&e.remove(a.index),a.attributes)e.remove(a.attributes[l]);s.removeEventListener("dispose",o),delete n[s.id];var c=i[s.id];c&&(e.remove(c),delete i[s.id]),(c=i[a.id])&&(e.remove(c),delete i[a.id]),r.memory.geometries--}return{get:function(t,e){var i=n[e.id];return i||(e.addEventListener("dispose",o),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Mr).setFromObject(t)),i=e._bufferGeometry),n[e.id]=i,r.memory.geometries++,i)},update:function(r){var n=r.index,i=r.attributes;for(var o in null!==n&&e.update(n,t.ELEMENT_ARRAY_BUFFER),i)e.update(i[o],t.ARRAY_BUFFER);var s=r.morphAttributes;for(var o in s)for(var a=s[o],l=0,c=a.length;l<c;l++)e.update(a[l],t.ARRAY_BUFFER)},getWireframeAttribute:function(r){var n=i[r.id];if(n)return n;var o,s=[],a=r.index,l=r.attributes;if(null!==a)for(var c=0,u=(o=a.array).length;c<u;c+=3)s.push(h=o[c+0],d=o[c+1],d,p=o[c+2],p,h);else for(c=0,u=(o=l.position.array).length/3-1;c<u;c+=3){var h,d,p;s.push(h=c+0,d=c+1,d,p=c+2,p,h)}return n=new(Sr(s)>65535?xr:gr)(s,1),e.update(n,t.ELEMENT_ARRAY_BUFFER),i[r.id]=n,n}}}(w,R,N),F=new function(t,e){var r={};return{update:function(n){var i=e.render.frame,o=n.geometry,s=t.get(n,o);return r[s.id]!==i&&(o.isGeometry&&s.updateFromObject(n),t.update(s),r[s.id]=i),s},dispose:function(){r={}}}}(D,N),z=new function(t){var e={},r=new Float32Array(8);return{update:function(n,i,o,s){var a=n.morphTargetInfluences,l=a.length,c=e[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];e[i.id]=c}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(u=0;u<l;u++)0!==(p=c[u])[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u));for(u=0;u<l;u++)(p=c[u])[0]=u,p[1]=a[u];for(c.sort(Ur),u=0;u<8;u++){var p;if(p=c[u]){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),r[u]=m;continue}}r[u]=0}s.getUniforms().setValue(t,"morphTargetInfluences",r)}}}(w),k=new function(t,e,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=Me,r===Me&&e&&(r=Ee),r}this.getParameters=function(e,n,o,a,l,c,u){var h=i[e.type],d=u.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=Math.floor((r.maxVertexUniforms-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(u):0,p=r.precision;null!==e.precision&&(p=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead.");var f=t.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:s(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===pt||e.envMap.mapping===ft),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!a,useFog:e.fog,fogExp:a&&a.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.receiveShadow&&o.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===g,flipSided:e.side===v,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);for(var s=0;s<o.length;s++)n.push(r[o[s]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.join()},this.acquireProgram=function(r,i,o,s){for(var a,l=0,c=n.length;l<c;l++){var u=n[l];if(u.code===s){++(a=u).usedTimes;break}}return void 0===a&&(a=new function(t,e,r,n,i,o){var s=t.context,a=n.defines,l=i.vertexShader,c=i.fragmentShader,u="SHADOWMAP_TYPE_BASIC";o.shadowMapType===p?u="SHADOWMAP_TYPE_PCF":o.shadowMapType===f&&(u="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case lt:case ct:h="ENVMAP_TYPE_CUBE";break;case pt:case ft:h="ENVMAP_TYPE_CUBE_UV";break;case ut:case ht:h="ENVMAP_TYPE_EQUIREC";break;case dt:h="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ct:case ht:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case $:m="ENVMAP_BLENDING_MULTIPLY";break;case tt:m="ENVMAP_BLENDING_MIX";break;case et:m="ENVMAP_BLENDING_ADD"}}var v,g,y=t.gammaFactor>0?t.gammaFactor:1,x=function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(On).join("\n")}(n.extensions,o,e),b=function(t){var e=[];for(var r in t){var n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}(a),w=s.createProgram();n.isRawShaderMaterial?((v=[b].filter(On).join("\n")).length>0&&(v+="\n"),(g=[x,b].filter(On).join("\n")).length>0&&(g+="\n")):(v=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(On).join("\n"),g=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+d:"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+u:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==rt?"#define TONE_MAPPING":"",o.toneMapping!==rt?Qe.tonemapping_pars_fragment:"",o.toneMapping!==rt?function(t,e){var r;switch(e){case nt:r="Linear";break;case it:r="Reinhard";break;case ot:r="Uncharted2";break;case st:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 toneMapping( vec3 color ) { return "+r+"ToneMapping( color ); }"}(0,o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Qe.encodings_pars_fragment:"",o.mapEncoding?Pn("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?Pn("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Pn("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(t,e){var r=Cn(o.outputEncoding);return"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}():"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(On).join("\n")),l=Ln(l=Nn(l=In(l),o),o),c=Ln(c=Nn(c=In(c),o),o),l=Rn(l);var _=g+(c=Rn(c)),S=An(s,s.VERTEX_SHADER,v+l),T=An(s,s.FRAGMENT_SHADER,_);s.attachShader(w,S),s.attachShader(w,T),void 0!==n.index0AttributeName?s.bindAttribLocation(w,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(w,0,"position"),s.linkProgram(w);var M,A,E=s.getProgramInfoLog(w).trim(),C=s.getShaderInfoLog(S).trim(),P=s.getShaderInfoLog(T).trim(),O=!0,N=!0;return!1===s.getProgramParameter(w,s.LINK_STATUS)?(O=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(w,s.VALIDATE_STATUS),"gl.getProgramInfoLog",E,C,P)):""!==E?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):""!==C&&""!==P||(N=!1),N&&(this.diagnostics={runnable:O,material:n,programLog:E,vertexShader:{log:C,prefix:v},fragmentShader:{log:P,prefix:g}}),s.deleteShader(S),s.deleteShader(T),this.getUniforms=function(){return void 0===M&&(M=new Mn(s,w,t)),M},this.getAttributes=function(){return void 0===A&&(A=function(t,e){for(var r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=t.getActiveAttrib(e,i).name;r[o]=t.getAttribLocation(e,o)}return r}(s,w)),A},this.destroy=function(){s.deleteProgram(w),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=En++,this.code=r,this.usedTimes=1,this.program=w,this.vertexShader=S,this.fragmentShader=T,this}(t,e,s,r,i,o),n.push(a)),a},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}(mt,_,P),U=new function(){var t={};return{get:function(e,r){var n=e.id+","+r.id,i=t[n];return void 0===i&&(i=new function(){var t=[],e=0,r=[],n=[];return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(i,o,s,a,l){var c=t[e];void 0===c?t[e]=c={id:i.id,object:i,geometry:o,material:s,program:s.program,renderOrder:i.renderOrder,z:a,group:l}:(c.id=i.id,c.object=i,c.geometry=o,c.material=s,c.program=s.program,c.renderOrder=i.renderOrder,c.z=a,c.group=l),(!0===s.transparent?n:r).push(c),e++},sort:function(){r.length>1&&r.sort(Dn),n.length>1&&n.sort(Fn)}}},t[n]=i),i},dispose:function(){t={}}}},B=new function(){var t={};return{get:function(e,r){var n=e.id+","+r.id,i=t[n];return void 0===i&&(i=new function(){var t=new function(){var t=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Be,color:new tr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"SpotLight":r={position:new Be,direction:new Be,color:new tr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"PointLight":r={position:new Be,color:new tr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Fe,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Be,skyColor:new tr,groundColor:new tr};break;case"RectAreaLight":r={color:new tr,position:new Be,halfWidth:new Be,halfHeight:new Be}}return t[e.id]=r,r}}},e={id:kn++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new Be,n=new ke,i=new ke;return{setup:function(o,s,a){for(var l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,v=a.matrixWorldInverse,g=0,y=o.length;g<y;g++){var x=o[g],b=x.color,w=x.intensity,_=x.distance,S=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=b.r*w,c+=b.g*w,u+=b.b*w;else if(x.isDirectionalLight)(M=t.get(x)).color.copy(x.color).multiplyScalar(x.intensity),M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.directionalShadowMap[h]=S,e.directionalShadowMatrix[h]=x.shadow.matrix,e.directional[h]=M,h++;else if(x.isSpotLight)(M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(b).multiplyScalar(w),M.distance=_,M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(v),M.coneCos=Math.cos(x.angle),M.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),e.spotShadowMap[p]=S,e.spotShadowMatrix[p]=x.shadow.matrix,e.spot[p]=M,p++;else if(x.isRectAreaLight)(M=t.get(x)).color.copy(b).multiplyScalar(w),M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),i.identity(),n.copy(x.matrixWorld),n.premultiply(v),i.extractRotation(n),M.halfWidth.set(.5*x.width,0,0),M.halfHeight.set(0,.5*x.height,0),M.halfWidth.applyMatrix4(i),M.halfHeight.applyMatrix4(i),e.rectArea[f]=M,f++;else if(x.isPointLight){var T;(M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(v),M.color.copy(x.color).multiplyScalar(x.intensity),M.distance=x.distance,M.decay=0===x.distance?0:x.decay,M.shadow=x.castShadow,x.castShadow&&(M.shadowBias=(T=x.shadow).bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far),e.pointShadowMap[d]=S,e.pointShadowMatrix[d]=x.shadow.matrix,e.point[d]=M,d++}else if(x.isHemisphereLight){var M;(M=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(v),M.direction.normalize(),M.skyColor.copy(x.color).multiplyScalar(w),M.groundColor.copy(x.groundColor).multiplyScalar(w),e.hemi[m]=M,m++}}e.ambient[0]=l,e.ambient[1]=c,e.ambient[2]=u,e.directional.length=h,e.spot.length=p,e.rectArea.length=f,e.point.length=d,e.hemi.length=m,e.hash=e.id+","+h+","+d+","+p+","+f+","+m+","+s.length},state:e}},e=[],r=[],n=[];return{init:function(){e.length=0,r.length=0,n.length=0},state:{lightsArray:e,shadowsArray:r,spritesArray:n,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)},pushSprite:function(t){n.push(t)}}},t[n]=i),i},dispose:function(){t={}}}},j=new function(t,e,r,n){var i,o,s,a=new tr(0),l=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,n)}return{getClearColor:function(){return a},setClearColor:function(t,e){a.set(t),c(a,l=void 0!==e?e:1)},getClearAlpha:function(){return l},setClearAlpha:function(t){c(a,l=t)},render:function(e,n,u,h){var d=n.background;null===d?c(a,l):d&&d.isColor&&(c(d,1),h=!0),(t.autoClear||h)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&d.isCubeTexture?(void 0===s&&((s=new kr(new Er(1,1,1),new Ir({uniforms:rr.cube.uniforms,vertexShader:rr.cube.vertexShader,fragmentShader:rr.cube.fragmentShader,side:v,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(s.geometry)),s.material.uniforms.tCube.value=d,e.push(s,s.geometry,s.material,0,null)):d&&d.isTexture&&(void 0===i&&(i=new lr(-1,1,1,-1,0,1),o=new kr(new Pr(2,2),new Lr({depthTest:!1,depthWrite:!1,fog:!1})),r.update(o.geometry)),o.material.map=d,t.renderBufferDirect(i,null,o.geometry,o.material,o,null))}}}(mt,O,D,h),V=new function(t,e,r){var n;this.setMode=function(t){n=t},this.render=function(e,i){t.drawArrays(n,e,i),r.update(i,n)},this.renderInstances=function(t,i,o){var s=e.get("ANGLE_instanced_arrays");if(null!==s){var a=t.attributes.position;a.isInterleavedBufferAttribute?s.drawArraysInstancedANGLE(n,0,o=a.data.count,t.maxInstancedCount):s.drawArraysInstancedANGLE(n,i,o,t.maxInstancedCount),r.update(o,n,t.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(w,_,N),G=new function(t,e,r){var n,i,o;this.setMode=function(t){n=t},this.setIndex=function(t){i=t.type,o=t.bytesPerElement},this.render=function(e,s){t.drawElements(n,s,i,e*o),r.update(s,n)},this.renderInstances=function(t,s,a){var l=e.get("ANGLE_instanced_arrays");null!==l?(l.drawElementsInstancedANGLE(n,a,i,s*o,t.maxInstancedCount),r.update(a,n,t.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(w,_,N),H=new function(t,e,r,n,i){var o,s,a,l,c,u,h=new Be,d=new Ue,p=new Be;function f(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(m,v,g){if(0!==m.length){void 0===a&&function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new Uint16Array([0,1,2,0,2,3]);o=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW),a=function(){var t=e.createProgram(),r=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),e.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),e.compileShader(r),e.compileShader(n),e.attachShader(t,r),e.attachShader(t,n),e.linkProgram(t),t}(),l={position:e.getAttribLocation(a,"position"),uv:e.getAttribLocation(a,"uv")},c={uvOffset:e.getUniformLocation(a,"uvOffset"),uvScale:e.getUniformLocation(a,"uvScale"),rotation:e.getUniformLocation(a,"rotation"),center:e.getUniformLocation(a,"center"),scale:e.getUniformLocation(a,"scale"),color:e.getUniformLocation(a,"color"),map:e.getUniformLocation(a,"map"),opacity:e.getUniformLocation(a,"opacity"),modelViewMatrix:e.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(a,"projectionMatrix"),fogType:e.getUniformLocation(a,"fogType"),fogDensity:e.getUniformLocation(a,"fogDensity"),fogNear:e.getUniformLocation(a,"fogNear"),fogFar:e.getUniformLocation(a,"fogFar"),fogColor:e.getUniformLocation(a,"fogColor"),fogDepth:e.getUniformLocation(a,"fogDepth"),alphaTest:e.getUniformLocation(a,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var h=n.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),u=new zn(n)}(),r.useProgram(a),r.initAttributes(),r.enableAttribute(l.position),r.enableAttribute(l.uv),r.disableUnusedAttributes(),r.disable(e.CULL_FACE),r.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.uniformMatrix4fv(c.projectionMatrix,!1,g.projectionMatrix.elements),r.activeTexture(e.TEXTURE0),e.uniform1i(c.map,0);var y=0,x=0,b=v.fog;b?(e.uniform3f(c.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(e.uniform1f(c.fogNear,b.near),e.uniform1f(c.fogFar,b.far),e.uniform1i(c.fogType,1),y=1,x=1):b.isFogExp2&&(e.uniform1f(c.fogDensity,b.density),e.uniform1i(c.fogType,2),y=2,x=2)):(e.uniform1i(c.fogType,0),y=0,x=0);for(var w=0,_=m.length;w<_;w++)(M=m[w]).modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14];m.sort(f);var S=[],T=[];for(w=0,_=m.length;w<_;w++){var M,A=(M=m[w]).material;if(!1!==A.visible){M.onBeforeRender(t,v,g,void 0,A,void 0),e.uniform1f(c.alphaTest,A.alphaTest),e.uniformMatrix4fv(c.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(h,d,p),S[0]=p.x,S[1]=p.y,T[0]=M.center.x-.5,T[1]=M.center.y-.5;var E=0;v.fog&&A.fog&&(E=x),y!==E&&(e.uniform1i(c.fogType,E),y=E),null!==A.map?(e.uniform2f(c.uvOffset,A.map.offset.x,A.map.offset.y),e.uniform2f(c.uvScale,A.map.repeat.x,A.map.repeat.y)):(e.uniform2f(c.uvOffset,0,0),e.uniform2f(c.uvScale,1,1)),e.uniform1f(c.opacity,A.opacity),e.uniform3f(c.color,A.color.r,A.color.g,A.color.b),e.uniform1f(c.rotation,A.rotation),e.uniform2fv(c.center,T),e.uniform2fv(c.scale,S),r.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.premultipliedAlpha),r.buffers.depth.setTest(A.depthTest),r.buffers.depth.setMask(A.depthWrite),r.buffers.color.setMask(A.colorWrite),n.setTexture2D(A.map||u,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),M.onAfterRender(t,v,g,void 0,A,void 0)}}r.enable(e.CULL_FACE),r.reset()}}}(mt,w,O,I,P),N.programs=k.programs,mt.context=w,mt.capabilities=P,mt.extensions=_,mt.properties=L,mt.renderLists=U,mt.state=O,mt.info=N}re();var ne=new Wn(mt);this.vr=ne;var ie=new jn(mt,F,P.maxTextureSize);function oe(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),gt=!0}function se(){console.log("THREE.WebGLRenderer: Context Restored."),gt=!1,re()}function ae(t){var e=t.target;e.removeEventListener("dispose",ae),function(t){le(t),L.remove(t)}(e)}function le(t){var e=L.get(t).program;t.program=void 0,void 0!==e&&k.releaseProgram(e)}this.shadowMap=ie,this.getContext=function(){return w},this.getContextAttributes=function(){return w.getContextAttributes()},this.forceContextLoss=function(){var t=_.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=_.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Ht},this.setPixelRatio=function(t){void 0!==t&&(Ht=t,this.setSize(jt,zt,!1))},this.getSize=function(){return{width:jt,height:zt}},this.setSize=function(t,r,n){var i=ne.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(jt=t,zt=r,e.width=t*Ht,e.height=r*Ht,!1!==n&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(){return{width:jt*Ht,height:zt*Ht}},this.setDrawingBufferSize=function(t,r,n){jt=t,zt=r,Ht=n,e.width=t*n,e.height=r*n,this.setViewport(0,0,t,r)},this.getCurrentViewport=function(){return It},this.setViewport=function(t,e,r,n){Wt.set(t,zt-e-n,r,n),O.viewport(It.copy(Wt).multiplyScalar(Ht))},this.setScissor=function(t,e,r,n){Xt.set(t,zt-e-n,r,n),O.scissor(Rt.copy(Xt).multiplyScalar(Ht))},this.setScissorTest=function(t){O.setScissorTest(qt=t)},this.getClearColor=function(){return j.getClearColor()},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=w.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=w.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=w.STENCIL_BUFFER_BIT),w.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,r,n){this.setRenderTarget(t),this.clear(e,r,n)},this.dispose=function(){e.removeEventListener("webglcontextlost",oe,!1),e.removeEventListener("webglcontextrestored",se,!1),U.dispose(),B.dispose(),L.dispose(),F.dispose(),ne.dispose(),he()},this.renderBufferImmediate=function(t,e,r){O.initAttributes();var n=L.get(t);t.hasPositions&&!n.position&&(n.position=w.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=w.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=w.createBuffer()),t.hasColors&&!n.color&&(n.color=w.createBuffer());var i=e.getAttributes();if(t.hasPositions&&(w.bindBuffer(w.ARRAY_BUFFER,n.position),w.bufferData(w.ARRAY_BUFFER,t.positionArray,w.DYNAMIC_DRAW),O.enableAttribute(i.position),w.vertexAttribPointer(i.position,3,w.FLOAT,!1,0,0)),t.hasNormals){if(w.bindBuffer(w.ARRAY_BUFFER,n.normal),!r.isMeshPhongMaterial&&!r.isMeshStandardMaterial&&!r.isMeshNormalMaterial&&!0===r.flatShading)for(var o=0,s=3*t.count;o<s;o+=9){var a=t.normalArray,l=(a[o+0]+a[o+3]+a[o+6])/3,c=(a[o+1]+a[o+4]+a[o+7])/3,u=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=l,a[o+1]=c,a[o+2]=u,a[o+3]=l,a[o+4]=c,a[o+5]=u,a[o+6]=l,a[o+7]=c,a[o+8]=u}w.bufferData(w.ARRAY_BUFFER,t.normalArray,w.DYNAMIC_DRAW),O.enableAttribute(i.normal),w.vertexAttribPointer(i.normal,3,w.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(w.bindBuffer(w.ARRAY_BUFFER,n.uv),w.bufferData(w.ARRAY_BUFFER,t.uvArray,w.DYNAMIC_DRAW),O.enableAttribute(i.uv),w.vertexAttribPointer(i.uv,2,w.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==b&&(w.bindBuffer(w.ARRAY_BUFFER,n.color),w.bufferData(w.ARRAY_BUFFER,t.colorArray,w.DYNAMIC_DRAW),O.enableAttribute(i.color),w.vertexAttribPointer(i.color,3,w.FLOAT,!1,0,0)),O.disableUnusedAttributes(),w.drawArrays(w.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,n,i,o){var s=i.isMesh&&i.matrixWorld.determinant()<0;O.setMaterial(n,s);var a=ge(t,e,n,i),l=r.id+"_"+a.id+"_"+(!0===n.wireframe),c=!1;l!==At&&(At=l,c=!0),i.morphTargetInfluences&&(z.update(i,r,n,a),c=!0);var u,h=r.index,d=r.attributes.position,p=1;!0===n.wireframe&&(h=D.getWireframeAttribute(r),p=2);var f=V;null!==h&&(u=R.get(h),(f=G).setIndex(u)),c&&(function(t,e,r,n){if(r&&r.isInstancedBufferGeometry&&null===_.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===n&&(n=0),O.initAttributes();var i=r.attributes,o=e.getAttributes(),s=t.defaultAttributeValues;for(var a in o){var l=o[a];if(l>=0){var c=i[a];if(void 0!==c){var u=c.normalized,h=c.itemSize,d=R.get(c);if(void 0===d)continue;var p=d.buffer,f=d.type,m=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var v=c.data,g=v.stride,y=c.offset;v&&v.isInstancedInterleavedBuffer?(O.enableAttributeAndDivisor(l,v.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=v.meshPerAttribute*v.count)):O.enableAttribute(l),w.bindBuffer(w.ARRAY_BUFFER,p),w.vertexAttribPointer(l,h,f,u,g*m,(n*g+y)*m)}else c.isInstancedBufferAttribute?(O.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=c.meshPerAttribute*c.count)):O.enableAttribute(l),w.bindBuffer(w.ARRAY_BUFFER,p),w.vertexAttribPointer(l,h,f,u,0,n*h*m)}else if(void 0!==s){var x=s[a];if(void 0!==x)switch(x.length){case 2:w.vertexAttrib2fv(l,x);break;case 3:w.vertexAttrib3fv(l,x);break;case 4:w.vertexAttrib4fv(l,x);break;default:w.vertexAttrib1fv(l,x)}}}}O.disableUnusedAttributes()}}(n,a,r),null!==h&&w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,u.buffer));var m=1/0;null!==h?m=h.count:void 0!==d&&(m=d.count);var v=r.drawRange.start*p,g=r.drawRange.count*p,y=null!==o?o.start*p:0,x=null!==o?o.count*p:1/0,b=Math.max(v,y),S=Math.min(m,v+g,y+x)-1,T=Math.max(0,S-b+1);if(0!==T){if(i.isMesh)if(!0===n.wireframe)O.setLineWidth(n.wireframeLinewidth*te()),f.setMode(w.LINES);else switch(i.drawMode){case _e:f.setMode(w.TRIANGLES);break;case Se:f.setMode(w.TRIANGLE_STRIP);break;case Te:f.setMode(w.TRIANGLE_FAN)}else if(i.isLine){var M=n.linewidth;void 0===M&&(M=1),O.setLineWidth(M*te()),f.setMode(i.isLineSegments?w.LINES:i.isLineLoop?w.LINE_LOOP:w.LINE_STRIP)}else i.isPoints&&f.setMode(w.POINTS);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&f.renderInstances(r,b,T):f.render(b,T)}},this.compile=function(t,e){(x=B.get(t,e)).init(),t.traverse(function(t){t.isLight&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))}),x.setupLights(e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)ve(e.material[r],t.fog,e);else ve(e.material,t.fog,e)})};var ce=!1,ue=null;function he(){ce=!1}function de(){var t=ne.getDevice();t&&t.isPresenting?t.requestAnimationFrame(pe):window.requestAnimationFrame(pe)}function pe(t){!1!==ce&&(ue(t),de())}function fe(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var s=t[i],a=s.object,l=s.geometry,c=void 0===n?s.material:n,u=s.group;if(r.isArrayCamera){Lt=r;for(var h=r.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(a.layers.test(f.layers)){var m=f.bounds;O.viewport(It.set(m.x*jt,m.y*zt,m.z*jt,m.w*zt).multiplyScalar(Ht)),me(a,e,f,l,c,u)}}}else Lt=null,me(a,e,r,l,c,u)}}function me(t,e,r,n,i,o){if(t.onBeforeRender(mt,e,r,n,i,o),x=B.get(e,Lt||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var s=t.isMesh&&t.matrixWorld.determinant()<0;O.setMaterial(i,s);var a=ge(r,e.fog,i,t);At="",function(t,e,r){t.render(function(t){mt.renderBufferImmediate(t,e,r)})}(t,a,i)}else mt.renderBufferDirect(r,e.fog,n,i,t,o);t.onAfterRender(mt,e,r,n,i,o),x=B.get(e,Lt||r)}function ve(t,e,r){var n=L.get(t),i=x.state.lights,o=k.getParameters(t,i.state,x.state.shadowsArray,e,Zt.numPlanes,Zt.numIntersection,r),s=k.getProgramCode(t,o),a=n.program,l=!0;if(void 0===a)t.addEventListener("dispose",ae);else if(a.code!==s)le(t);else if(n.lightsHash!==i.state.hash)L.update(t,"lightsHash",i.state.hash),l=!1;else{if(void 0!==o.shaderID)return;l=!1}if(l){if(o.shaderID){var c=rr[o.shaderID];n.shader={name:t.type,uniforms:Ke.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader,mt),a=k.acquireProgram(t,n.shader,o,s),n.program=a,t.program=a}var u=a.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var h=0;h<mt.maxMorphTargets;h++)u["morphTarget"+h]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,h=0;h<mt.maxMorphNormals;h++)u["morphNormal"+h]>=0&&t.numSupportedMorphNormals++;var d=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=Zt.numPlanes,n.numIntersection=Zt.numIntersection,d.clippingPlanes=Zt.uniform),n.fog=e,n.lightsHash=i.state.hash,t.lights&&(d.ambientLightColor.value=i.state.ambient,d.directionalLights.value=i.state.directional,d.spotLights.value=i.state.spot,d.rectAreaLights.value=i.state.rectArea,d.pointLights.value=i.state.point,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var p=n.program.getUniforms(),f=Mn.seqWithValue(p.seq,d);n.uniformsList=f}function ge(t,e,r,n){Bt=0;var i=L.get(r),o=x.state.lights;Jt&&(Qt||t!==Ct)&&Zt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,i,t===Ct&&r.id===Mt),!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==e?r.needsUpdate=!0:r.lights&&i.lightsHash!==o.state.hash?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Zt.numPlanes&&i.numIntersection===Zt.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(ve(r,e,n),r.needsUpdate=!1);var s=!1,a=!1,l=!1,c=i.program,u=c.getUniforms(),h=i.shader.uniforms;if(O.useProgram(c.program)&&(s=!0,a=!0,l=!0),r.id!==Mt&&(Mt=r.id,a=!0),s||t!==Ct){if(u.setValue(w,"projectionMatrix",t.projectionMatrix),P.logarithmicDepthBuffer&&u.setValue(w,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),Ct!==(Lt||t)&&(Ct=Lt||t,a=!0,l=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var d=u.map.cameraPosition;void 0!==d&&d.setValue(w,$t.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&u.setValue(w,"viewMatrix",t.matrixWorldInverse)}if(r.skinning){u.setOptional(w,n,"bindMatrix"),u.setOptional(w,n,"bindMatrixInverse");var p=n.skeleton;if(p)if(P.floatVertexTextures){if(void 0===p.boneTexture){var f=Math.sqrt(4*p.bones.length);f=De.ceilPowerOfTwo(f),f=Math.max(f,4);var m=new Float32Array(f*f*4);m.set(p.boneMatrices);var v=new Xe(m,f,f,Ut,Ot);v.needsUpdate=!0,p.boneMatrices=m,p.boneTexture=v,p.boneTextureSize=f}u.setValue(w,"boneTexture",p.boneTexture),u.setValue(w,"boneTextureSize",p.boneTextureSize)}else u.setOptional(w,p,"boneMatrices")}return a&&(u.setValue(w,"toneMappingExposure",mt.toneMappingExposure),u.setValue(w,"toneMappingWhitePoint",mt.toneMappingWhitePoint),r.lights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(h,l),e&&r.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(h,e),r.isMeshBasicMaterial?ye(h,r):r.isMeshLambertMaterial?(ye(h,r),function(t,e){e.emissiveMap&&(h.emissiveMap.value=e.emissiveMap)}(0,r)):r.isMeshPhongMaterial?(ye(h,r),r.isMeshToonMaterial?function(t,e){xe(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(h,r):xe(h,r)):r.isMeshStandardMaterial?(ye(h,r),r.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,be(t,e)}(h,r):be(h,r)):r.isMeshDepthMaterial?(ye(h,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(h,r)):r.isMeshDistanceMaterial?(ye(h,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(h,r)):r.isMeshNormalMaterial?(ye(h,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(h,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}(h,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(h,r)):r.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Ht,t.scale.value=.5*zt,t.map.value=e.map,null!==e.map){if(!0===e.map.matrixAutoUpdate){var r=e.map.offset,n=e.map.repeat,i=e.map.center;e.map.matrix.setUvTransform(r.x,r.y,n.x,n.y,e.map.rotation,i.x,i.y)}t.uvTransform.value.copy(e.map.matrix)}}(h,r):r.isShadowMaterial&&(h.color.value=r.color,h.opacity.value=r.opacity),void 0!==h.ltc_1&&(h.ltc_1.value=er.LTC_1),void 0!==h.ltc_2&&(h.ltc_2.value=er.LTC_2),Mn.upload(w,i.uniformsList,h,mt)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Mn.upload(w,i.uniformsList,h,mt),r.uniformsNeedUpdate=!1),u.setValue(w,"modelViewMatrix",n.modelViewMatrix),u.setValue(w,"normalMatrix",n.normalMatrix),u.setValue(w,"modelMatrix",n.matrixWorld),c}function ye(t,e){var r;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=L.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r){if(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate){var n=r.offset,i=r.repeat,o=r.center;r.matrix.setUvTransform(n.x,n.y,i.x,i.y,r.rotation,o.x,o.y)}t.uvTransform.value.copy(r.matrix)}}function xe(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function be(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){null!==(ue=t)?ce||(de(),ce=!0):he()},this.render=function(t,e,r,n){if(e&&e.isCamera){if(!gt){At="",Mt=-1,Ct=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),ne.enabled&&(e=ne.getCamera(e)),(x=B.get(t,e)).init(),t.onBeforeRender(mt,t,e,r),Kt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Yt.setFromMatrix(Kt),Jt=Zt.init(this.clippingPlanes,Qt=this.localClippingEnabled,e),(y=U.get(t,e)).init(),function t(e,r,n){if(!1!==e.visible){if(e.layers.test(r.layers))if(e.isLight)x.pushLight(e),e.castShadow&&x.pushShadow(e);else if(e.isSprite)e.frustumCulled&&!Yt.intersectsSprite(e)||x.pushSprite(e);else if(e.isImmediateRenderObject)n&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kt),y.push(e,null,e.material,$t.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Yt.intersectsObject(e))){n&&$t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kt);var i=F.update(e),o=e.material;if(Array.isArray(o))for(var s=i.groups,a=0,l=s.length;a<l;a++){var c=s[a],u=o[c.materialIndex];u&&u.visible&&y.push(e,i,u,$t.z,c)}else o.visible&&y.push(e,i,o,$t.z,null)}var h=e.children;for(a=0,l=h.length;a<l;a++)t(h[a],r,n)}}(t,e,mt.sortObjects),!0===mt.sortObjects&&y.sort(),Jt&&Zt.beginShadows(),ie.render(x.state.shadowsArray,t,e),x.setupLights(e),Jt&&Zt.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),j.render(y,t,e,n);var i=y.opaque,o=y.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;i.length&&fe(i,t,e,s),o.length&&fe(o,t,e,s)}else i.length&&fe(i,t,e),o.length&&fe(o,t,e);H.render(x.state.spritesArray,t,e),r&&I.updateRenderTargetMipmap(r),O.buffers.depth.setTest(!0),O.buffers.depth.setMask(!0),O.buffers.color.setMask(!0),O.setPolygonOffset(!1),t.onAfterRender(mt,t,e),ne.enabled&&ne.submitFrame(),y=null,x=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var t=Bt;return t>=P.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+P.maxTextures),Bt+=1,t},this.setTexture2D=function(){var t=!1;return function(e,r){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),I.setTexture2D(e,r)}}(),this.setTexture=function(){var t=!1;return function(e,r){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),I.setTexture2D(e,r)}}(),this.setTextureCube=function(){var t=!1;return function(e,r){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?I.setTextureCube(e,r):I.setTextureCubeDynamic(e,r)}}(),this.getRenderTarget=function(){return _t},this.setRenderTarget=function(t){_t=t,t&&void 0===L.get(t).__webglFramebuffer&&I.setupRenderTarget(t);var e=null,r=!1;if(t){var n=L.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=n[t.activeCubeFace],r=!0):e=n,It.copy(t.viewport),Rt.copy(t.scissor),Ft=t.scissorTest}else It.copy(Wt).multiplyScalar(Ht),Rt.copy(Xt).multiplyScalar(Ht),Ft=qt;if(St!==e&&(w.bindFramebuffer(w.FRAMEBUFFER,e),St=e),O.viewport(It),O.scissor(Rt),O.setScissorTest(Ft),r){var i=L.get(t.texture);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,i.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,r,n,i,o){if(t&&t.isWebGLRenderTarget){var s=L.get(t).__webglFramebuffer;if(s){var a=!1;s!==St&&(w.bindFramebuffer(w.FRAMEBUFFER,s),a=!0);try{var l=t.texture,c=l.format,u=l.type;if(c!==Ut&&at.convert(c)!==w.getParameter(w.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Tt||at.convert(u)===w.getParameter(w.IMPLEMENTATION_COLOR_READ_TYPE)||u===Ot&&(_.get("OES_texture_float")||_.get("WEBGL_color_buffer_float"))||u===Nt&&_.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");w.checkFramebufferStatus(w.FRAMEBUFFER)===w.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&w.readPixels(e,r,n,i,at.convert(c),at.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&w.bindFramebuffer(w.FRAMEBUFFER,St)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){var n=e.image.width,i=e.image.height,o=at.convert(e.format);this.setTexture2D(e,0),w.copyTexImage2D(w.TEXTURE_2D,r||0,o,t.x,t.y,n,i,0)},this.copyTextureToTexture=function(t,e,r,n){var i=e.image.width,o=e.image.height,s=at.convert(r.format),a=at.convert(r.type),l=e.isDataTexture?e.image.data:e.image;this.setTexture2D(r,0),w.texSubImage2D(w.TEXTURE_2D,n||0,t.x,t.y,i,o,s,a,l)}}function qn(t,e){this.name="",this.color=new tr(t),this.density=void 0!==e?e:25e-5}function Yn(t,e,r){this.name="",this.color=new tr(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function Zn(){sr.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Jn(t){Nr.call(this),this.type="SpriteMaterial",this.color=new tr(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Qn(t){sr.call(this),this.type="Sprite",this.material=void 0!==t?t:new Jn,this.center=new Fe(.5,.5)}function Kn(){sr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function $n(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ke)}}function ti(){sr.call(this),this.type="Bone"}function ei(t,e){kr.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ke,this.bindMatrixInverse=new ke;var r=new $n(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function ri(t){Nr.call(this),this.type="LineBasicMaterial",this.color=new tr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function ni(t,e,r){if(1===r)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new ii(t,e);sr.call(this),this.type="Line",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new ri({color:16777215*Math.random()})}function ii(t,e){ni.call(this,t,e),this.type="LineSegments"}function oi(t,e){ni.call(this,t,e),this.type="LineLoop"}function si(t){Nr.call(this),this.type="PointsMaterial",this.color=new tr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function ai(t,e){sr.call(this),this.type="Points",this.geometry=void 0!==t?t:new Mr,this.material=void 0!==e?e:new si({color:16777215*Math.random()})}function li(){sr.call(this),this.type="Group"}function ci(t,e,r,n,i,o,s,a,l){Ve.call(this,t,e,r,n,i,o,s,a,l),this.generateMipmaps=!1}function ui(t,e,r,n,i,o,s,a,l,c,u,h){Ve.call(this,null,o,s,a,l,c,n,i,u,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function hi(t,e,r,n,i,o,s,a,l,c){if((c=void 0!==c?c:Vt)!==Vt&&c!==Gt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Vt&&(r=Et),void 0===r&&c===Gt&&(r=Dt),Ve.call(this,null,n,i,o,s,a,c,r,l),this.image={width:t,height:e},this.magFilter=void 0!==s?s:yt,this.minFilter=void 0!==a?a:yt,this.flipY=!1,this.generateMipmaps=!1}function di(t){Mr.call(this),this.type="WireframeGeometry";var e,r,n,i,o,s,a,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var v=m[e];for(r=0;r<3;r++)a=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)h.push((u=t.vertices[(s=p[c]).index1]).x,u.y,u.z),h.push((u=t.vertices[s.index2]).x,u.y,u.z)}else if(t&&t.isBufferGeometry){var g,y,x,b,w;if(u=new Be,null!==t.index){for(g=t.attributes.position,y=t.index,0===(x=t.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(e=w=(b=x[i]).start,n=w+b.count;e<n;e+=3)for(r=0;r<3;r++)a=y.getX(e+r),l=y.getX(e+(r+1)%3),d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)u.fromBufferAttribute(g,(s=p[c]).index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,s.index2),h.push(u.x,u.y,u.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)u.fromBufferAttribute(g,3*e+r),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,3*e+(r+1)%3),h.push(u.x,u.y,u.z)}this.addAttribute("position",new br(h,3))}function pi(t,e,r){hr.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new fi(t,e,r)),this.mergeVertices()}function fi(t,e,r){Mr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],s=[],a=[],l=[],c=new Be,u=new Be,h=new Be,d=new Be,p=new Be,f=e+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,m,u),s.push(u.x,u.y,u.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(u,h)):(t(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(u,h)):(t(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),a.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var g=n*f+i+1,y=(n+1)*f+i+1,x=(n+1)*f+i;o.push(n*f+i,g,x),o.push(g,y,x)}this.setIndex(o),this.addAttribute("position",new br(s,3)),this.addAttribute("normal",new br(a,3)),this.addAttribute("uv",new br(l,2))}function mi(t,e,r,n){hr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new vi(t,e,r,n)),this.mergeVertices()}function vi(t,e,r,n){Mr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function s(t,e,r,n){var i,o,s=Math.pow(2,n),l=[];for(i=0;i<=s;i++){l[i]=[];var c=t.clone().lerp(r,i/s),u=e.clone().lerp(r,i/s),h=s-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===s?c:c.clone().lerp(u,o/h)}for(i=0;i<s;i++)for(o=0;o<2*(s-i)-1;o++){var d=Math.floor(o/2);o%2==0?(a(l[i][d+1]),a(l[i+1][d]),a(l[i][d])):(a(l[i][d+1]),a(l[i+1][d+1]),a(l[i+1][d]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function c(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var r=new Be,n=new Be,i=new Be,o=0;o<e.length;o+=3)l(e[o+0],r),l(e[o+1],n),l(e[o+2],i),s(r,n,i,t)}(n=n||0),function(t){for(var e=new Be,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new Be,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=u(t)/2/Math.PI+.5,n=h(t)/Math.PI+.5;o.push(r,1-n)}(function(){for(var t=new Be,e=new Be,r=new Be,n=new Be,s=new Fe,a=new Fe,l=new Fe,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(t).add(e).add(r).divideScalar(3);var p=u(n);c(s,d+0,t,p),c(a,d+2,e,p),c(l,d+4,r,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),s=Math.min(e,r,n);i>.9&&s<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new br(i,3)),this.addAttribute("normal",new br(i.slice(),3)),this.addAttribute("uv",new br(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function gi(t,e){hr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new yi(t,e)),this.mergeVertices()}function yi(t,e){vi.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function xi(t,e){hr.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new bi(t,e)),this.mergeVertices()}function bi(t,e){vi.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function wi(t,e){hr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new _i(t,e)),this.mergeVertices()}function _i(t,e){var r=(1+Math.sqrt(5))/2;vi.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Si(t,e){hr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ti(t,e)),this.mergeVertices()}function Ti(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;vi.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Mi(t,e,r,n,i,o){hr.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Ai(t,e,r,n,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Ai(t,e,r,n,i){Mr.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,l=new Be,c=new Be,u=new Fe,h=new Be,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var s=o.normals[i],u=o.binormals[i];for(a=0;a<=n;a++){var f=a/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*s.x+m*u.x,c.y=v*s.y+m*u.y,c.z=v*s.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(s=0;s<e;s++)v(s);v(!1===i?e:0),function(){for(s=0;s<=e;s++)for(a=0;a<=n;a++)u.x=s/e,u.y=a/n,f.push(u.x,u.y)}(),function(){for(a=1;a<=e;a++)for(s=1;s<=n;s++){var t=(n+1)*a+(s-1),r=(n+1)*a+s,i=(n+1)*(a-1)+s;m.push((n+1)*(a-1)+(s-1),t,i),m.push(t,r,i)}}()}(),this.setIndex(m),this.addAttribute("position",new br(d,3)),this.addAttribute("normal",new br(p,3)),this.addAttribute("uv",new br(f,2))}function Ei(t,e,r,n,i,o,s){hr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ci(t,e,r,n,i,o)),this.mergeVertices()}function Ci(t,e,r,n,i,o){Mr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var s,a,l=[],c=[],u=[],h=[],d=new Be,p=new Be,f=new Be,m=new Be,v=new Be,g=new Be,y=new Be;for(s=0;s<=r;++s){var x=s/r*i*Math.PI*2;for(A(x,i,o,t,f),A(x+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),a=0;a<=n;++a){var b=a/n*Math.PI*2,w=-e*Math.cos(b),_=e*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(s/r),h.push(a/n)}}for(a=1;a<=r;a++)for(s=1;s<=n;s++){var S=(n+1)*a+(s-1),T=(n+1)*a+s,M=(n+1)*(a-1)+s;l.push((n+1)*(a-1)+(s-1),S,M),l.push(S,T,M)}function A(t,e,r,n,i){var o=Math.cos(t),s=Math.sin(t),a=r/e*t,l=Math.cos(a);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*s*.5,i.z=n*Math.sin(a)*.5}this.setIndex(l),this.addAttribute("position",new br(c,3)),this.addAttribute("normal",new br(u,3)),this.addAttribute("uv",new br(h,2))}function Pi(t,e,r,n,i){hr.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Oi(t,e,r,n,i)),this.mergeVertices()}function Oi(t,e,r,n,i){Mr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,s,a=[],l=[],c=[],u=[],h=new Be,d=new Be,p=new Be;for(o=0;o<=r;o++)for(s=0;s<=n;s++){var f=s/n*i,m=o/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(s/n),u.push(o/r)}for(o=1;o<=r;o++)for(s=1;s<=n;s++){var v=(n+1)*(o-1)+s-1,g=(n+1)*(o-1)+s,y=(n+1)*o+s;a.push((n+1)*o+s-1,v,y),a.push(v,g,y)}this.setIndex(a),this.addAttribute("position",new br(l,3)),this.addAttribute("normal",new br(c,3)),this.addAttribute("uv",new br(u,2))}function Ni(t,e,r,n,i){var o,s;if(i===function(t,e,r,n){for(var i=0,o=e,s=r-n;o<r;o+=n)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)s=Zi(o,t[o],t[o+1],s);else for(o=r-n;o>=e;o-=n)s=Zi(o,t[o],t[o+1],s);return s&&Wi(s,s.next)&&(Ji(s),s=s.next),s}function Li(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Wi(n,n.next)&&0!==Hi(n.prev,n,n.next))n=n.next;else{if(Ji(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Ii(t,e,r,n,i,o,s){if(t){!s&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=ji(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,s,a,l,c=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,n=r,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(t,n,i,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Di(t,n,i,o):Ri(t))e.push(a.i/r),e.push(t.i/r),e.push(l.i/r),Ji(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Ii(t=Fi(t,e,r),e,r,n,i,o,2):2===s&&ki(t,e,r,n,i,o):Ii(Li(t),e,r,n,i,o,1);break}}}function Ri(t){var e=t.prev,r=t,n=t.next;if(Hi(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Vi(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Hi(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Di(t,e,r,n){var i=t.prev,o=t,s=t.next;if(Hi(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,l=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,c=ji(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,r,n),u=ji(a,l,e,r,n),h=t.nextZ;h&&h.z<=u;){if(h!==t.prev&&h!==t.next&&Vi(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Hi(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Vi(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Hi(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function Fi(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Wi(i,o)&&Xi(i,n,n.next,o)&&qi(i,o)&&qi(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Ji(n),Ji(n.next),n=t=o),n=n.next}while(n!==t);return n}function ki(t,e,r,n,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Gi(s,a)){var l=Yi(s,a);return s=Li(s,s.next),l=Li(l,l.next),Ii(s,e,r,n,i,o),void Ii(l,e,r,n,i,o)}a=a.next}s=s.next}while(s!==t)}function Ui(t,e){return t.x-e.x}function Bi(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&Vi(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&qi(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=Yi(e,t);Li(r,r.next)}}function ji(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zi(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Vi(t,e,r,n,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function Gi(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Xi(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&qi(t,e)&&qi(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function Hi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Wi(t,e){return t.x===e.x&&t.y===e.y}function Xi(t,e,r,n){return!!(Wi(t,e)&&Wi(r,n)||Wi(t,n)&&Wi(r,e))||Hi(t,e,r)>0!=Hi(t,e,n)>0&&Hi(r,n,t)>0!=Hi(r,n,e)>0}function qi(t,e){return Hi(t.prev,t,t.next)<0?Hi(t,e,t.next)>=0&&Hi(t,t.prev,e)>=0:Hi(t,e,t.prev)<0||Hi(t,t.next,e)<0}function Yi(t,e){var r=new Qi(t.i,t.x,t.y),n=new Qi(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Zi(t,e,r,n){var i=new Qi(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ji(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qi(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}(Un.prototype=Object.create(Nr.prototype)).constructor=Un,Un.prototype.isMeshDepthMaterial=!0,Un.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},(Bn.prototype=Object.create(Nr.prototype)).constructor=Bn,Bn.prototype.isMeshDistanceMaterial=!0,Bn.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(zn.prototype=Object.create(Ve.prototype)).constructor=zn,Gn.prototype=Object.assign(Object.create(ar.prototype),{constructor:Gn,isPerspectiveCamera:!0,copy:function(t,e){return ar.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*De.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*De.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*De.RAD2DEG*Math.atan(Math.tan(.5*De.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*De.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;i+=o.offsetX*n/s,e-=o.offsetY*r/a,n*=o.width/s,r*=o.height/a}var l=this.filmOffset;0!==l&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far)},toJSON:function(t){var e=sr.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Hn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Hn,isArrayCamera:!0}),qn.prototype.isFogExp2=!0,qn.prototype.clone=function(){return new qn(this.color.getHex(),this.density)},qn.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Yn.prototype.isFog=!0,Yn.prototype.clone=function(){return new Yn(this.color.getHex(),this.near,this.far)},Yn.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Zn.prototype=Object.assign(Object.create(sr.prototype),{constructor:Zn,copy:function(t,e){return sr.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=sr.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),(Jn.prototype=Object.create(Nr.prototype)).constructor=Jn,Jn.prototype.isSpriteMaterial=!0,Jn.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Qn.prototype=Object.assign(Object.create(sr.prototype),{constructor:Qn,isSprite:!0,raycast:function(){var t=new Be,e=new Be,r=new Be;return function(n,i){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(e.distanceToSquared(t)>o)){var s=n.ray.origin.distanceTo(t);s<n.near||s>n.far||i.push({distance:s,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return sr.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),Kn.prototype=Object.assign(Object.create(sr.prototype),{constructor:Kn,copy:function(t){sr.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object},raycast:function(){var t=new Be;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,r)}}(),update:function(){var t=new Be,e=new Be;return function(r){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=sr.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign($n.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new ke;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new ke,e=new ke;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,s=0,a=r.length;s<a;s++)t.multiplyMatrices(r[s]?r[s].matrixWorld:e,n[s]),t.toArray(i,16*s);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new $n(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),ti.prototype=Object.assign(Object.create(sr.prototype),{constructor:ti,isBone:!0}),ei.prototype=Object.assign(Object.create(kr.prototype),{constructor:ei,isSkinnedMesh:!0,initBones:function(){var t,e,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)e=this.geometry.bones[r],t=new ti,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(e=this.geometry.bones[r]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var r=this.geometry.skinWeights[e];(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Ge,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)n.x=i.getX(e),n.y=i.getY(e),n.z=i.getZ(e),n.w=i.getW(e),(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0),i.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){kr.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(ri.prototype=Object.create(Nr.prototype)).constructor=ri,ri.prototype.isLineBasicMaterial=!0,ri.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},ni.prototype=Object.assign(Object.create(sr.prototype),{constructor:ni,isLine:!0,computeLineDistances:function(){var t=new Be,e=new Be;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,s=n.count;o<s;o++)t.fromBufferAttribute(n,o-1),e.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=t.distanceTo(e);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for((i=r.lineDistances)[0]=0,o=1,s=a.length;o<s;o++)i[o]=i[o-1],i[o]+=a[o-1].distanceTo(a[o])}return this}}(),raycast:function(){var t=new ke,e=new Rr,r=new Ye;return function(n,i){var o=n.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var c=new Be,u=new Be,h=new Be,d=new Be,p=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g+1];c.fromArray(m,3*v[g]),u.fromArray(m,3*x),e.distanceSqToSegment(c,u,d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,y=m.length/3-1;g<y;g+=p)c.fromArray(m,3*g),u.fromArray(m,3*g+3),e.distanceSqToSegment(c,u,d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(a.isGeometry){var b=a.vertices,w=b.length;for(g=0;g<w-1;g+=p){var _;e.distanceSqToSegment(b[g],b[g+1],d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ii.prototype=Object.assign(Object.create(ni.prototype),{constructor:ii,isLineSegments:!0,computeLineDistances:function(){var t=new Be,e=new Be;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,s=n.count;o<s;o+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for(i=r.lineDistances,o=0,s=a.length;o<s;o+=2)t.copy(a[o]),e.copy(a[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()}),oi.prototype=Object.assign(Object.create(ni.prototype),{constructor:oi,isLineLoop:!0}),(si.prototype=Object.create(Nr.prototype)).constructor=si,si.prototype.isPointsMaterial=!0,si.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},ai.prototype=Object.assign(Object.create(sr.prototype),{constructor:ai,isPoints:!0,raycast:function(){var t=new ke,e=new Rr,r=new Ye;return function(n,i){var o=this,s=this.geometry,a=this.matrixWorld,l=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(a),r.radius+=l,!1!==n.ray.intersectsSphere(r)){t.getInverse(a),e.copy(n.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Be,d=new Be;if(s.isBufferGeometry){var p=s.index,f=s.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=s.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(t,r){var s=e.distanceSqToPoint(t);if(s<u){e.closestPointToPoint(t,d),d.applyMatrix4(a);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),li.prototype=Object.assign(Object.create(sr.prototype),{constructor:li,isGroup:!0}),ci.prototype=Object.assign(Object.create(Ve.prototype),{constructor:ci,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(ui.prototype=Object.create(Ve.prototype)).constructor=ui,ui.prototype.isCompressedTexture=!0,(hi.prototype=Object.create(Ve.prototype)).constructor=hi,hi.prototype.isDepthTexture=!0,(di.prototype=Object.create(Mr.prototype)).constructor=di,(pi.prototype=Object.create(hr.prototype)).constructor=pi,(fi.prototype=Object.create(Mr.prototype)).constructor=fi,(mi.prototype=Object.create(hr.prototype)).constructor=mi,(vi.prototype=Object.create(Mr.prototype)).constructor=vi,(gi.prototype=Object.create(hr.prototype)).constructor=gi,(yi.prototype=Object.create(vi.prototype)).constructor=yi,(xi.prototype=Object.create(hr.prototype)).constructor=xi,(bi.prototype=Object.create(vi.prototype)).constructor=bi,(wi.prototype=Object.create(hr.prototype)).constructor=wi,(_i.prototype=Object.create(vi.prototype)).constructor=_i,(Si.prototype=Object.create(hr.prototype)).constructor=Si,(Ti.prototype=Object.create(vi.prototype)).constructor=Ti,(Mi.prototype=Object.create(hr.prototype)).constructor=Mi,(Ai.prototype=Object.create(Mr.prototype)).constructor=Ai,(Ei.prototype=Object.create(hr.prototype)).constructor=Ei,(Ci.prototype=Object.create(Mr.prototype)).constructor=Ci,(Pi.prototype=Object.create(hr.prototype)).constructor=Pi,(Oi.prototype=Object.create(Mr.prototype)).constructor=Oi;var Ki={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return Ki.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];$i(t),to(r,t);var o=t.length;e.forEach($i);for(var s=0;s<e.length;s++)n.push(o),o+=e[s].length,to(r,e[s]);var a=function(t,e,r){r=r||2;var n,i,o,s,a,l,c,u=e&&e.length,h=u?e[0]*r:t.length,d=Ni(t,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(t,e,r,n){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=Ni(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(zi(s));for(a.sort(Ui),i=0;i<a.length;i++)Bi(a[i],r),r=Li(r,r.next);return r}(t,e,d,r)),t.length>80*r){n=o=t[0],i=s=t[1];for(var f=r;f<h;f+=r)l=t[f+1],(a=t[f])<n&&(n=a),l<i&&(i=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-i))?1/c:0}return Ii(d,p,r,n,i,c),p}(r,n);for(s=0;s<a.length;s+=3)i.push(a.slice(s,s+3));return i}};function $i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function to(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function eo(t,e){hr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ro(t,e)),this.mergeVertices()}function ro(t,e){"undefined"!=typeof t&&(Mr.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function no(t,e){hr.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new io(t,e)),this.mergeVertices()}function io(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new hr;var n=r.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),ro.call(this,n,e),this.type="TextBufferGeometry"}function oo(t,e,r,n,i,o,s){hr.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new so(t,e,r,n,i,o,s)),this.mergeVertices()}function so(t,e,r,n,i,o,s){Mr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var a,l,c=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),u=0,h=[],d=new Be,p=new Be,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(a=0;a<=e;a++){var b=a/e;d.x=-t*Math.cos(n+b*i)*Math.sin(o+x*s),d.y=t*Math.cos(o+x*s),d.z=t*Math.sin(n+b*i)*Math.sin(o+x*s),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(a=0;a<e;a++){var w=h[l][a],_=h[l+1][a],S=h[l+1][a+1];(0!==l||o>0)&&f.push(h[l][a+1],w,S),(l!==r-1||c<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new br(m,3)),this.addAttribute("normal",new br(v,3)),this.addAttribute("uv",new br(g,2))}function ao(t,e,r,n,i,o){hr.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new lo(t,e,r,n,i,o)),this.mergeVertices()}function lo(t,e,r,n,i,o){Mr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,a,l,c=[],u=[],h=[],d=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Be,v=new Fe;for(a=0;a<=n;a++){for(l=0;l<=r;l++)s=i+l/r*o,m.x=p*Math.cos(s),m.y=p*Math.sin(s),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(a=0;a<n;a++){var g=a*(r+1);for(l=0;l<r;l++){var y=(s=l+g)+r+1,x=s+r+2,b=s+1;c.push(s,y,b),c.push(y,x,b)}}this.setIndex(c),this.addAttribute("position",new br(u,3)),this.addAttribute("normal",new br(h,3)),this.addAttribute("uv",new br(d,2))}function co(t,e,r,n){hr.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new uo(t,e,r,n)),this.mergeVertices()}function uo(t,e,r,n){Mr.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=De.clamp(n,0,2*Math.PI);var i,o,s,a=[],l=[],c=[],u=1/e,h=new Be,d=new Fe;for(o=0;o<=e;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(s=0;s<=t.length-1;s++)h.x=t[s].x*f,h.y=t[s].y,h.z=t[s].x*m,l.push(h.x,h.y,h.z),d.x=o/e,d.y=s/(t.length-1),c.push(d.x,d.y)}for(o=0;o<e;o++)for(s=0;s<t.length-1;s++){var v=(i=s+o*t.length)+t.length,g=i+t.length+1,y=i+1;a.push(i,v,y),a.push(v,g,y)}if(this.setIndex(a),this.addAttribute("position",new br(l,3)),this.addAttribute("uv",new br(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,b=new Be,w=new Be,_=new Be;for(i=e*t.length*3,o=0,s=0;o<t.length;o++,s+=3)b.x=x[s+0],b.y=x[s+1],b.z=x[s+2],w.x=x[i+s+0],w.y=x[i+s+1],w.z=x[i+s+2],_.addVectors(b,w).normalize(),x[s+0]=x[i+s+0]=_.x,x[s+1]=x[i+s+1]=_.y,x[s+2]=x[i+s+2]=_.z}}function ho(t,e){hr.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new po(t,e)),this.mergeVertices()}function po(t,e){Mr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],s=0,a=0;if(!1===Array.isArray(t))c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(s,a,l),s+=a,a=0;function c(t){var s,l,c,u=n.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Ki.isClockWise(d))for(d=d.reverse(),s=0,l=p.length;s<l;s++)!0===Ki.isClockWise(c=p[s])&&(p[s]=c.reverse());var f=Ki.triangulateShape(d,p);for(s=0,l=p.length;s<l;s++)d=d.concat(c=p[s]);for(s=0,l=d.length;s<l;s++){var m=d[s];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(s=0,l=f.length;s<l;s++){var v=f[s];r.push(v[0]+u,v[1]+u,v[2]+u),a+=3}}this.setIndex(r),this.addAttribute("position",new br(n,3)),this.addAttribute("normal",new br(i,3)),this.addAttribute("uv",new br(o,2))}function fo(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}function mo(t,e){Mr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,s=[],a=Math.cos(De.DEG2RAD*e),l=[0,0],c={},u=["a","b","c"];t.isBufferGeometry?(o=new hr).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=a){var y=h[g.index1];s.push(y.x,y.y,y.z),s.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new br(s,3))}function vo(t,e,r,n,i,o,s,a){hr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new go(t,e,r,n,i,o,s,a)),this.mergeVertices()}function go(t,e,r,n,i,o,s,a){Mr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new Fe,y=new Be,x=0,b=!0===r?t:e,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*a+s,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new Be,x=new Be,b=0,w=(e-t)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=n;o++){var M=o/n,A=M*a+s,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];c.push(f[g][o],P,N),c.push(P,O,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new br(u,3)),this.addAttribute("normal",new br(h,3)),this.addAttribute("uv",new br(d,2))}function yo(t,e,r,n,i,o,s){vo.call(this,0,t,e,r,n,i,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function xo(t,e,r,n,i,o,s){go.call(this,0,t,e,r,n,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function bo(t,e,r,n){hr.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new wo(t,e,r,n)),this.mergeVertices()}function wo(t,e,r,n){Mr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,s=[],a=[],l=[],c=[],u=new Be,h=new Fe;for(a.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=r+o/e*n;u.x=t*Math.cos(d),u.y=t*Math.sin(d),a.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(a[i]/t+1)/2,h.y=(a[i+1]/t+1)/2,c.push(h.x,h.y)}for(i=1;i<=e;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new br(a,3)),this.addAttribute("normal",new br(l,3)),this.addAttribute("uv",new br(c,2))}(eo.prototype=Object.create(hr.prototype)).constructor=eo,(ro.prototype=Object.create(Mr.prototype)).constructor=ro,ro.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:e,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},ro.prototype.addShapeList=function(t,e){var r=t.length;e.arrays=this.getArrays();for(var n=0;n<r;n++)this.addShape(t[n],e);this.setIndex(e.arrays.index),this.addAttribute("position",new br(e.arrays.position,3)),this.addAttribute("uv",new br(e.arrays.uv,2))},ro.prototype.addShape=function(t,e){var r,n,i,o,s,a,l,c,u=e.arrays?e.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,x=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:eo.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new Be,o=new Be,s=new Be),x||(y=0,v=0,g=0);var M=this,A=t.extractPoints(b),E=A.shape,C=A.holes;if(!Ki.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)Ki.isClockWise(a=C[l])&&(C[l]=a.reverse());var P=Ki.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)E=E.concat(a=C[l]);function N(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var L,I,R,D,F,k,U=E.length,B=P.length;function j(t,e,r){var n,i,o,s=t.x-e.x,a=t.y-e.y,l=r.x-t.x,c=r.y-t.y,u=s*s+a*a;if(Math.abs(s*c-a*l)>Number.EPSILON){var h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+s/h,m=((r.x-c/d-p)*c-(r.y+l/d-f)*l)/(s*c-a*l),v=(n=p+s*m-t.x)*n+(i=f+a*m-t.y)*i;if(v<=2)return new Fe(n,i);o=Math.sqrt(v/2)}else{var g=!1;s>Number.EPSILON?l>Number.EPSILON&&(g=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(g=!0):Math.sign(a)===Math.sign(c)&&(g=!0),g?(n=-a,i=s,o=Math.sqrt(u)):(n=s,i=a,o=Math.sqrt(u/2))}return new Fe(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,q,Y=[],Z=z.concat();for(l=0,c=C.length;l<c;l++){for(X=[],H=(G=(a=C[l]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(a[V],a[H],a[W]);Y.push(X),Z=Z.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(l=0,c=C.length;l<c;l++)for(X=Y[l],V=0,G=(a=C[l]).length;V<G;V++)Q((F=N(a[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<U;V++)F=x?N(E[V],Z[V],I):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),s.copy(r[0]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<U;V++)F=x?N(E[V],Z[V],I):E[V],S?(o.copy(n.normals[q]).multiplyScalar(F.x),i.copy(n.binormals[q]).multiplyScalar(F.y),s.copy(r[q]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,m/w*q);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(l=0,c=C.length;l<c;l++)for(X=Y[l],V=0,G=(a=C[l]).length;V<G;V++)F=N(a[V],X[V],I),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+D):Q(F.x,F.y,m+D)}function J(t,e){var r,n;for(V=t.length;--V>=0;){r=V,(n=V-1)<0&&(n=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var s=U*i,a=U*(i+1);$(e+r+s,e+n+s,e+n+a,e+r+a)}}}function Q(t,e,r){f.push(t),f.push(e),f.push(r)}function K(t,e,r){tt(t),tt(e),tt(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,r,n){tt(t),tt(e),tt(n),tt(e),tt(r),tt(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(x){var e=0,r=U*e;for(V=0;V<B;V++)K((k=P[V])[2]+r,k[1]+r,k[0]+r);for(r=U*(e=w+2*y),V=0;V<B;V++)K((k=P[V])[0]+r,k[1]+r,k[2]+r)}else{for(V=0;V<B;V++)K((k=P[V])[2],k[1],k[0]);for(V=0;V<B;V++)K((k=P[V])[0]+U*w,k[1]+U*w,k[2]+U*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(J(O,e),e+=O.length,l=0,c=C.length;l<c;l++)J(a=C[l],e),e+=a.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new br(h,3)),this.addAttribute("uv",new br(p,2)))},eo.WorldUVGenerator={generateTopUV:function(t,e,r,n,i){var o=e[3*n],s=e[3*n+1],a=e[3*i],l=e[3*i+1];return[new Fe(e[3*r],e[3*r+1]),new Fe(o,s),new Fe(a,l)]},generateSideWallUV:function(t,e,r,n,i,o){var s=e[3*r],a=e[3*r+1],l=e[3*r+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(a-u)<.01?[new Fe(s,1-l),new Fe(c,1-h),new Fe(d,1-f),new Fe(m,1-g)]:[new Fe(a,1-l),new Fe(u,1-h),new Fe(p,1-f),new Fe(v,1-g)]}},(no.prototype=Object.create(hr.prototype)).constructor=no,(io.prototype=Object.create(ro.prototype)).constructor=io,(oo.prototype=Object.create(hr.prototype)).constructor=oo,(so.prototype=Object.create(Mr.prototype)).constructor=so,(ao.prototype=Object.create(hr.prototype)).constructor=ao,(lo.prototype=Object.create(Mr.prototype)).constructor=lo,(co.prototype=Object.create(hr.prototype)).constructor=co,(uo.prototype=Object.create(Mr.prototype)).constructor=uo,(ho.prototype=Object.create(hr.prototype)).constructor=ho,ho.prototype.toJSON=function(){var t=hr.prototype.toJSON.call(this);return fo(this.parameters.shapes,t)},(po.prototype=Object.create(Mr.prototype)).constructor=po,po.prototype.toJSON=function(){var t=Mr.prototype.toJSON.call(this);return fo(this.parameters.shapes,t)},(mo.prototype=Object.create(Mr.prototype)).constructor=mo,(vo.prototype=Object.create(hr.prototype)).constructor=vo,(go.prototype=Object.create(Mr.prototype)).constructor=go,(yo.prototype=Object.create(vo.prototype)).constructor=yo,(xo.prototype=Object.create(go.prototype)).constructor=xo,(bo.prototype=Object.create(hr.prototype)).constructor=bo,(wo.prototype=Object.create(Mr.prototype)).constructor=wo;var _o=Object.freeze({WireframeGeometry:di,ParametricGeometry:pi,ParametricBufferGeometry:fi,TetrahedronGeometry:gi,TetrahedronBufferGeometry:yi,OctahedronGeometry:xi,OctahedronBufferGeometry:bi,IcosahedronGeometry:wi,IcosahedronBufferGeometry:_i,DodecahedronGeometry:Si,DodecahedronBufferGeometry:Ti,PolyhedronGeometry:mi,PolyhedronBufferGeometry:vi,TubeGeometry:Mi,TubeBufferGeometry:Ai,TorusKnotGeometry:Ei,TorusKnotBufferGeometry:Ci,TorusGeometry:Pi,TorusBufferGeometry:Oi,TextGeometry:no,TextBufferGeometry:io,SphereGeometry:oo,SphereBufferGeometry:so,RingGeometry:ao,RingBufferGeometry:lo,PlaneGeometry:Cr,PlaneBufferGeometry:Pr,LatheGeometry:co,LatheBufferGeometry:uo,ShapeGeometry:ho,ShapeBufferGeometry:po,ExtrudeGeometry:eo,ExtrudeBufferGeometry:ro,EdgesGeometry:mo,ConeGeometry:yo,ConeBufferGeometry:xo,CylinderGeometry:vo,CylinderBufferGeometry:go,CircleGeometry:bo,CircleBufferGeometry:wo,BoxGeometry:Ar,BoxBufferGeometry:Er});function So(t){Nr.call(this),this.type="ShadowMaterial",this.color=new tr(0),this.transparent=!0,this.setValues(t)}function To(t){Ir.call(this,t),this.type="RawShaderMaterial"}function Mo(t){Nr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ao(t){Mo.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function Eo(t){Nr.call(this),this.type="MeshPhongMaterial",this.color=new tr(16777215),this.specular=new tr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Co(t){Eo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Po(t){Nr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Oo(t){Nr.call(this),this.type="MeshLambertMaterial",this.color=new tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function No(t){ri.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}(So.prototype=Object.create(Nr.prototype)).constructor=So,So.prototype.isShadowMaterial=!0,So.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this},(To.prototype=Object.create(Ir.prototype)).constructor=To,To.prototype.isRawShaderMaterial=!0,(Mo.prototype=Object.create(Nr.prototype)).constructor=Mo,Mo.prototype.isMeshStandardMaterial=!0,Mo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Ao.prototype=Object.create(Mo.prototype)).constructor=Ao,Ao.prototype.isMeshPhysicalMaterial=!0,Ao.prototype.copy=function(t){return Mo.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(Eo.prototype=Object.create(Nr.prototype)).constructor=Eo,Eo.prototype.isMeshPhongMaterial=!0,Eo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Co.prototype=Object.create(Eo.prototype)).constructor=Co,Co.prototype.isMeshToonMaterial=!0,Co.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(Po.prototype=Object.create(Nr.prototype)).constructor=Po,Po.prototype.isMeshNormalMaterial=!0,Po.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Oo.prototype=Object.create(Nr.prototype)).constructor=Oo,Oo.prototype.isMeshLambertMaterial=!0,Oo.prototype.copy=function(t){return Nr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(No.prototype=Object.create(ri.prototype)).constructor=No,No.prototype.isLineDashedMaterial=!0,No.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Lo=Object.freeze({ShadowMaterial:So,SpriteMaterial:Jn,RawShaderMaterial:To,ShaderMaterial:Ir,PointsMaterial:si,MeshPhysicalMaterial:Ao,MeshStandardMaterial:Mo,MeshPhongMaterial:Eo,MeshToonMaterial:Co,MeshNormalMaterial:Po,MeshLambertMaterial:Oo,MeshDepthMaterial:Un,MeshDistanceMaterial:Bn,MeshBasicMaterial:Lr,LineDashedMaterial:No,LineBasicMaterial:ri,Material:Nr}),Io={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ro(t,e,r){var n=this,i=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){s++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,s),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,s),o===s&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this}}var Do=new Ro,Fo={};function ko(t){this.manager=void 0!==t?t:Do}function Uo(t){this.manager=void 0!==t?t:Do,this._parser=null}function Bo(t){this.manager=void 0!==t?t:Do,this._parser=null}function jo(t){this.manager=void 0!==t?t:Do}function zo(t){this.manager=void 0!==t?t:Do}function Vo(t){this.manager=void 0!==t?t:Do}function Go(){this.type="Curve",this.arcLengthDivisions=200}function Ho(t,e,r,n,i,o,s,a){Go.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Wo(t,e,r,n,i,o){Ho.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function Xo(){var t=0,e=0,r=0,n=0;function i(i,o,s,a){t=i,e=s,r=-3*i+3*o-2*s-a,n=2*i-2*o+s+a}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,s,a){var l=(e-t)/o-(r-t)/(o+s)+(r-e)/s,c=(r-e)/s-(n-e)/(s+a)+(n-r)/a;i(e,r,l*=s,c*=s)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}Object.assign(ko.prototype,{load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===Fo[t]){var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:a}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,a);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){e&&e(u),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{Fo[t]=[],Fo[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;Io.add(t,r);var n=Fo[t];if(delete Fo[t],200===this.status){for(var o=0,s=n.length;o<s;o++)(a=n[o]).onLoad&&a.onLoad(r);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("THREE.FileLoader: HTTP Status 0 received."),o=0,s=n.length;o<s;o++)(a=n[o]).onLoad&&a.onLoad(r);i.manager.itemEnd(t)}else{for(o=0,s=n.length;o<s;o++){var a;(a=n[o]).onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var r=Fo[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Fo[t];delete Fo[t];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}Fo[t].push({onLoad:e,onProgress:r,onError:n})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(Uo.prototype,{load:function(t,e,r,n){var i=this,o=[],s=new ui;s.image=o;var a=new ko(this.manager);function l(l){a.load(t[l],function(t){var r=i._parser(t,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(s.minFilter=wt),s.format=r.format,s.needsUpdate=!0,e&&e(s))},r,n)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else a.load(t,function(t){var r=i._parser(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,a=0;a<n;a++){o[a]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[a].mipmaps.push(r.mipmaps[a*r.mipmapCount+l]),o[a].format=r.format,o[a].width=r.width,o[a].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=wt),s.format=r.format,s.needsUpdate=!0,e&&e(s)},r,n);return s},setPath:function(t){return this.path=t,this}}),Object.assign(Bo.prototype,{load:function(t,e,r,n){var i=this,o=new Xe,s=new ko(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){var r=i._parser(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:vt,o.wrapT=void 0!==r.wrapT?r.wrapT:vt,o.magFilter=void 0!==r.magFilter?r.magFilter:wt,o.minFilter=void 0!==r.minFilter?r.minFilter:St,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=wt),o.needsUpdate=!0,e&&e(o,r))},r,n),o}}),Object.assign(jo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){Io.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),s.addEventListener("error",function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(zo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Br,o=new jo(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(r){o.load(t[r],function(t){i.images[r]=t,6==++s&&(i.needsUpdate=!0,e&&e(i))},void 0,n)}for(var l=0;l<t.length;++l)a(l);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Vo.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Ve,o=new jo(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){i.image=r;var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?kt:Ut,i.needsUpdate=!0,void 0!==e&&e(i)},r,n),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Go.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=n[i=Math.floor(a+(l-a)/2)]-r)<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var n=this.getPoint(e);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i=new Be,o=[],s=[],a=[],l=new Be,c=new ke;for(r=0;r<=t;r++)o[r]=this.getTangentAt(r/t),o[r].normalize();s[0]=new Be,a[0]=new Be;var u=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=u&&(u=h,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),p<=u&&i.set(0,0,1),l.crossVectors(o[0],i).normalize(),s[0].crossVectors(o[0],l),a[0].crossVectors(o[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),a[r]=a[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),n=Math.acos(De.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(l,n))),a[r].crossVectors(o[r],s[r]);if(!0===e)for(n=Math.acos(De.clamp(s[0].dot(s[t]),-1,1)),n/=t,o[0].dot(l.crossVectors(s[0],s[t]))>0&&(n=-n),r=1;r<=t;r++)s[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),a[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Ho.prototype=Object.create(Go.prototype)).constructor=Ho,Ho.prototype.isEllipseCurve=!0,Ho.prototype.getPoint=function(t,e){for(var r=e||new Fe,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var s=this.aStartAngle+t*i,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(a,l)},Ho.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ho.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Ho.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(Wo.prototype=Object.create(Ho.prototype)).constructor=Wo,Wo.prototype.isArcCurve=!0;var qo=new Be,Yo=new Xo,Zo=new Xo,Jo=new Xo;function Qo(t,e,r,n){Go.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Ko(t,e,r,n,i){var o=.5*(n-e),s=.5*(i-r),a=t*t;return(2*r-2*n+o+s)*(t*a)+(-3*r+3*n-2*o-s)*a+o*t+r}function $o(t,e,r,n){return function(t,r){var n=1-t;return n*n*e}(t)+function(t,e){return 2*(1-t)*t*r}(t)+function(t,e){return t*t*n}(t)}function ts(t,e,r,n,i){return function(t,r){var n=1-t;return n*n*n*e}(t)+function(t,e){var n=1-t;return 3*n*n*t*r}(t)+function(t,e){return 3*(1-t)*t*t*n}(t)+function(t,e){return t*t*t*i}(t)}function es(t,e,r,n){Go.call(this),this.type="CubicBezierCurve",this.v0=t||new Fe,this.v1=e||new Fe,this.v2=r||new Fe,this.v3=n||new Fe}function rs(t,e,r,n){Go.call(this),this.type="CubicBezierCurve3",this.v0=t||new Be,this.v1=e||new Be,this.v2=r||new Be,this.v3=n||new Be}function ns(t,e){Go.call(this),this.type="LineCurve",this.v1=t||new Fe,this.v2=e||new Fe}function is(t,e){Go.call(this),this.type="LineCurve3",this.v1=t||new Be,this.v2=e||new Be}function os(t,e,r){Go.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Fe,this.v1=e||new Fe,this.v2=r||new Fe}function ss(t,e,r){Go.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Be,this.v1=e||new Be,this.v2=r||new Be}function as(t){Go.call(this),this.type="SplineCurve",this.points=t||[]}(Qo.prototype=Object.create(Go.prototype)).constructor=Qo,Qo.prototype.isCatmullRomCurve3=!0,Qo.prototype.getPoint=function(t,e){var r,n,i,o,s=e||new Be,a=this.points,l=a.length,c=(l-(this.closed?0:1))*t,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a.length)+1)*a.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=a[(u-1)%l]:(qo.subVectors(a[0],a[1]).add(a[0]),r=qo),n=a[u%l],i=a[(u+1)%l],this.closed||u+2<l?o=a[(u+2)%l]:(qo.subVectors(a[l-1],a[l-2]).add(a[l-1]),o=qo),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Yo.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),Zo.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),Jo.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(Yo.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Zo.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Jo.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return s.set(Yo.calc(h),Zo.calc(h),Jo.calc(h)),s},Qo.prototype.copy=function(t){Go.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Qo.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Qo.prototype.fromJSON=function(t){Go.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Be).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(es.prototype=Object.create(Go.prototype)).constructor=es,es.prototype.isCubicBezierCurve=!0,es.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(ts(t,n.x,i.x,o.x,s.x),ts(t,n.y,i.y,o.y,s.y)),r},es.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},es.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},es.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(rs.prototype=Object.create(Go.prototype)).constructor=rs,rs.prototype.isCubicBezierCurve3=!0,rs.prototype.getPoint=function(t,e){var r=e||new Be,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(ts(t,n.x,i.x,o.x,s.x),ts(t,n.y,i.y,o.y,s.y),ts(t,n.z,i.z,o.z,s.z)),r},rs.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},rs.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},rs.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(ns.prototype=Object.create(Go.prototype)).constructor=ns,ns.prototype.isLineCurve=!0,ns.prototype.getPoint=function(t,e){var r=e||new Fe;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},ns.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ns.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},ns.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ns.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ns.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(is.prototype=Object.create(Go.prototype)).constructor=is,is.prototype.isLineCurve3=!0,is.prototype.getPoint=function(t,e){var r=e||new Be;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},is.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},is.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},is.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},is.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(os.prototype=Object.create(Go.prototype)).constructor=os,os.prototype.isQuadraticBezierCurve=!0,os.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.v0,i=this.v1,o=this.v2;return r.set($o(t,n.x,i.x,o.x),$o(t,n.y,i.y,o.y)),r},os.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},os.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},os.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(ss.prototype=Object.create(Go.prototype)).constructor=ss,ss.prototype.isQuadraticBezierCurve3=!0,ss.prototype.getPoint=function(t,e){var r=e||new Be,n=this.v0,i=this.v1,o=this.v2;return r.set($o(t,n.x,i.x,o.x),$o(t,n.y,i.y,o.y),$o(t,n.z,i.z,o.z)),r},ss.prototype.copy=function(t){return Go.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ss.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ss.prototype.fromJSON=function(t){return Go.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(as.prototype=Object.create(Go.prototype)).constructor=as,as.prototype.isSplineCurve=!0,as.prototype.getPoint=function(t,e){var r=e||new Fe,n=this.points,i=(n.length-1)*t,o=Math.floor(i),s=i-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(Ko(s,a.x,l.x,c.x,u.x),Ko(s,a.y,l.y,c.y,u.y)),r},as.prototype.copy=function(t){Go.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},as.prototype.toJSON=function(){var t=Go.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},as.prototype.fromJSON=function(t){Go.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Fe).fromArray(n))}return this};var ls=Object.freeze({ArcCurve:Wo,CatmullRomCurve3:Qo,CubicBezierCurve:es,CubicBezierCurve3:rs,EllipseCurve:Ho,LineCurve:ns,LineCurve3:is,QuadraticBezierCurve:os,QuadraticBezierCurve3:ss,SplineCurve:as});function cs(){Go.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function us(t){cs.call(this),this.type="Path",this.currentPoint=new Fe,t&&this.setFromPoints(t)}function hs(t){us.call(this,t),this.uuid=De.generateUUID(),this.type="Shape",this.holes=[]}function ds(t,e){sr.call(this),this.type="Light",this.color=new tr(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function ps(t,e,r){ds.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(sr.DefaultUp),this.updateMatrix(),this.groundColor=new tr(e)}function fs(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Fe(512,512),this.map=null,this.matrix=new ke}function ms(){fs.call(this,new Gn(50,1,.5,500))}function vs(t,e,r,n,i,o){ds.call(this,t,e),this.type="SpotLight",this.position.copy(sr.DefaultUp),this.updateMatrix(),this.target=new sr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new ms}function gs(t,e,r,n){ds.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new fs(new Gn(90,1,.5,500))}function ys(){fs.call(this,new lr(-5,5,5,-5,.5,500))}function xs(t,e){ds.call(this,t,e),this.type="DirectionalLight",this.position.copy(sr.DefaultUp),this.updateMatrix(),this.target=new sr,this.shadow=new ys}function bs(t,e){ds.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function ws(t,e,r,n){ds.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function _s(t,e,r,n){Is.call(this,t,e,r,n)}function Ss(t,e,r){Is.call(this,t,e,r)}function Ts(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function Ms(t,e,r,n){Ts.call(this,t,e,r,n)}function As(t,e,r,n){Is.call(this,t,e,r,n)}function Es(t,e,r,n){Is.call(this,t,e,r,n)}function Cs(t,e,r,n){Is.call(this,t,e,r,n)}function Ps(t,e,r,n){Ts.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Os(t,e,r,n){Ts.call(this,t,e,r,n)}function Ns(t,e,r,n){Ts.call(this,t,e,r,n)}cs.prototype=Object.assign(Object.create(Go.prototype),{constructor:cs,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ns(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],s=o.getLength();return o.getPointAt(0===s?0:1-i/s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],s=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),a=0;a<s.length;a++){var l=s[a];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Go.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=Go.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){Go.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new ls[n.type]).fromJSON(n))}return this}}),us.prototype=Object.assign(Object.create(cs.prototype),{constructor:us,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new ns(this.currentPoint.clone(),new Fe(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,n){var i=new os(this.currentPoint.clone(),new Fe(t,e),new Fe(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(t,e,r,n,i,o){var s=new es(this.currentPoint.clone(),new Fe(t,e),new Fe(r,n),new Fe(i,o));this.curves.push(s),this.currentPoint.set(i,o)},splineThru:function(t){var e=new as([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,n,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o)},absarc:function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},ellipse:function(t,e,r,n,i,o,s,a){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o,s,a)},absellipse:function(t,e,r,n,i,o,s,a){var l=new Ho(t,e,r,n,i,o,s,a);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(t){return cs.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=cs.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return cs.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),hs.prototype=Object.assign(Object.create(us.prototype),{constructor:hs,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){us.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=us.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){us.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new us).fromJSON(n))}return this}}),ds.prototype=Object.assign(Object.create(sr.prototype),{constructor:ds,isLight:!0,copy:function(t){return sr.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=sr.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),ps.prototype=Object.assign(Object.create(ds.prototype),{constructor:ps,isHemisphereLight:!0,copy:function(t){return ds.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(fs.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),ms.prototype=Object.assign(Object.create(fs.prototype),{constructor:ms,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*De.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix())}}),vs.prototype=Object.assign(Object.create(ds.prototype),{constructor:vs,isSpotLight:!0,copy:function(t){return ds.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),gs.prototype=Object.assign(Object.create(ds.prototype),{constructor:gs,isPointLight:!0,copy:function(t){return ds.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ys.prototype=Object.assign(Object.create(fs.prototype),{constructor:ys}),xs.prototype=Object.assign(Object.create(ds.prototype),{constructor:xs,isDirectionalLight:!0,copy:function(t){return ds.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),bs.prototype=Object.assign(Object.create(ds.prototype),{constructor:bs,isAmbientLight:!0}),ws.prototype=Object.assign(Object.create(ds.prototype),{constructor:ws,isRectAreaLight:!0,copy:function(t){return ds.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=ds.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),_s.prototype=Object.assign(Object.create(Is.prototype),{constructor:_s,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ve,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ss.prototype=Object.assign(Object.create(Is.prototype),{constructor:Ss,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ve,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Ts.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var s=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===s)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var a=e[1];for(t<a&&(r=2,i=a),s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===s)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var l=r+o>>>1;t<e[l]?o=l:r=l+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ts.prototype,{beforeStart_:Ts.prototype.copySampleValue_,afterEnd_:Ts.prototype.copySampleValue_}),Ms.prototype=Object.assign(Object.create(Ts.prototype),{constructor:Ms,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=(r-e)/(n-e),c=a+s;a!==c;a+=4)Ue.slerpFlat(i,0,o,a-s,o,a,l);return i}}),As.prototype=Object.assign(Object.create(Is.prototype),{constructor:As,ValueTypeName:"quaternion",DefaultInterpolation:ge,InterpolantFactoryMethodLinear:function(t){return new Ms(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Es.prototype=Object.assign(Object.create(Is.prototype),{constructor:Es,ValueTypeName:"color"}),Cs.prototype=Object.assign(Object.create(Is.prototype),{constructor:Cs,ValueTypeName:"number"}),Ps.prototype=Object.assign(Object.create(Ts.prototype),{constructor:Ps,DefaultSettings_:{endingStart:xe,endingEnd:xe},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,s=n[i],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case be:i=t,s=2*e-r;break;case we:s=e+n[i=n.length-2]-n[i+1];break;default:i=t,s=r}if(void 0===a)switch(this.getSettings_().endingEnd){case be:o=t,a=2*r-e;break;case we:o=1,a=r+n[1]-n[0];break;default:o=t-1,a=e}var l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(a-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(n-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==s;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[a+b]+x*o[u+b];return i}}),Os.prototype=Object.assign(Object.create(Ts.prototype),{constructor:Os,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=(r-e)/(n-e),u=1-c,h=0;h!==s;++h)i[h]=o[l+h]*u+o[a+h]*c;return i}}),Ns.prototype=Object.assign(Object.create(Ts.prototype),{constructor:Ns,interpolate_:function(t){return this.copySampleValue_(t-1)}});var Ls={arraySlice:function(t,e,r){return Ls.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,s=0;s!==n;++o)for(var a=r[o]*e,l=0;l!==e;++l)i[s++]=t[a+l];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(e.push(o.time),r.push.apply(r,s)),o=t[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(e.push(o.time),s.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(e.push(o.time),r.push(s)),o=t[i++]}while(void 0!==o)}}};function Is(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ls.convertArray(e,this.TimeBufferType),this.values=Ls.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Rs(t,e,r,n){Is.call(this,t,e,r,n)}function Ds(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=De.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Fs(t){this.manager=void 0!==t?t:Do,this.textures={}}function ks(t){this.manager=void 0!==t?t:Do}Object.assign(Is,{parse:function(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=Is._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var r=[],n=[];Ls.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:Ls.convertArray(t.times,Array),values:Ls.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cs;case"vector":case"vector2":case"vector3":case"vector4":return Rs;case"color":return Es;case"quaternion":return As;case"bool":case"boolean":return Ss;case"string":return _s}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(Is.prototype,{constructor:Is,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ge,InterpolantFactoryMethodDiscrete:function(t){return new Ns(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Os(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Ps(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case ve:e=this.InterpolantFactoryMethodDiscrete;break;case ge:e=this.InterpolantFactoryMethodLinear;break;case ye:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ve;case this.InterpolantFactoryMethodLinear:return ge;case this.InterpolantFactoryMethodSmooth:return ye}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=Ls.arraySlice(r,i,o),this.values=Ls.arraySlice(this.values,i*s,o*s)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,s=0;s!==i;s++){var a=r[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),t=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),t=!1;break}o=a}if(void 0!==n&&Ls.isTypedArray(n)){s=0;for(var l=n.length;s!==l;++s){var c=n[s];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,c),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=this.getInterpolation()===ye,i=1,o=t.length-1,s=1;s<o;++s){var a=!1,l=t[s];if(l!==t[s+1]&&(1!==s||l!==l[0]))if(n)a=!0;else for(var c=s*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=e[c+d];if(p!==e[u+d]||p!==e[h+d]){a=!0;break}}if(a){if(s!==i){t[i]=t[s];var f=s*r,m=i*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*r,m=i*r,d=0;d!==r;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=Ls.arraySlice(t,0,i),this.values=Ls.arraySlice(e,0,i*r)),this}}),Rs.prototype=Object.assign(Object.create(Is.prototype),{constructor:Rs,ValueTypeName:"vector"}),Object.assign(Ds,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(Is.parse(r[i]).scale(n));return new Ds(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e},i=0,o=r.length;i!==o;++i)e.push(Is.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],s=0;s<i;s++){var a=[],l=[];a.push((s+i-1)%i,s,(s+1)%i),l.push(0,1,0);var c=Ls.getKeyframeOrder(a);a=Ls.sortedArray(a,1,c),l=Ls.sortedArray(l,1,c),n||0!==a[0]||(a.push(i),l.push(l[0])),o.push(new Cs(".morphTargetInfluences["+e[s].name+"]",a,l).scale(1/r))}return new Ds(t,-1,o)},findByName:function(t,e){var r=t;Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,s=t.length;o<s;o++){var a=t[o],l=a.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(a)}}var u=[];for(var h in n)u.push(Ds.CreateFromMorphTargetSequence(h,n[h],e,r));return u},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],s=[];Ls.flattenJSON(r,o,s,n),0!==o.length&&i.push(new t(e,o,s))}},n=[],i=t.name||"default",o=t.length||-1,s=t.fps||30,a=t.hierarchy||[],l=0;l<a.length;l++){var c=a[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new Cs(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(s||1)}else{var g=".bones["+e[l].name+"]";r(Rs,g+".position",c,"pos",n),r(As,g+".quaternion",c,"rot",n),r(Rs,g+".scale",c,"scl",n)}}return 0===n.length?null:new Ds(i,o,n)}}),Object.assign(Ds.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(Fs.prototype,{load:function(t,e,r,n){var i=this;new ko(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new Lo[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new Fe).fromArray(i)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),n}}),Object.assign(ks.prototype,{load:function(t,e,r,n){var i=this;new ko(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){var e=new Mr,r=t.data.index;if(void 0!==r){var n=new Us[r.type](r.array);e.setIndex(new dr(n,1))}var i=t.data.attributes;for(var o in i){var s=i[o];n=new Us[s.type](s.array),e.addAttribute(o,new dr(n,s.itemSize,s.normalized))}var a=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==a)for(var l=0,c=a.length;l!==c;++l){var u=a[l];e.addGroup(u.start,u.count,u.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new Be;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new Ye(d,h.radius)}return e}});var Us={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Bs(){}Bs.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,n=e.length;r<n;r+=2){var i=e[r+1];if(e[r].test(t))return i}return null}},Object.assign(Bs.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:function(){var t={NoBlending:S,NormalBlending:T,AdditiveBlending:M,SubtractiveBlending:A,MultiplyBlending:E,CustomBlending:C},e=new tr,r=new Vo,n=new Fs;return function(i,o,s){var a={};function l(t,e,n,i,l){var c,u=o+t,h=Bs.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(s),c=r.load(u)),void 0!==e&&(c.repeat.fromArray(e),1!==e[0]&&(c.wrapS=mt),1!==e[1]&&(c.wrapT=mt)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=mt),"mirror"===i[0]&&(c.wrapS=gt),"repeat"===i[1]&&(c.wrapT=mt),"mirror"===i[1]&&(c.wrapT=gt)),void 0!==l&&(c.anisotropy=l);var d=De.generateUUID();return a[d]=c,d}var c={uuid:De.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=t[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(h).getHex();break;case"colorSpecular":c.specular=e.fromArray(h).getHex();break;case"colorEmissive":c.emissive=e.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=v;break;case"doubleSided":c.side=g;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=_),"face"===h&&(c.vertexColors=w);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(a),n.parse(c)}}()});var js={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function zs(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Do,this.withCredentials=!1}function Vs(t){this.manager=void 0!==t?t:Do,this.texturePath=""}Object.assign(zs.prototype,{load:function(t,e,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:js.extractUrlBase(t),s=new ko(this.manager);s.setWithCredentials(this.withCredentials),s.load(t,function(r){var n=JSON.parse(r),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,o);e(l.geometry,l.materials)},r,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var r=new hr;return function(t,e){function r(t,e){return t&1<<e}var n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&I++;for(n=0;n<I;n++)e.faceVertexUvs[n]=[]}for(s=0,a=P.length;s<a;)(b=new Be).x=P[s++]*L,b.y=P[s++]*L,b.z=P[s++]*L,e.vertices.push(b);for(s=0,a=C.length;s<a;)if(p=r(d=C[s++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new cr).a=C[s],_.b=C[s+1],_.c=C[s+3],(S=new cr).a=C[s+1],S.b=C[s+2],S.c=C[s+3],s+=4,f&&(h=C[s++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],e.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new Fe(A[2*(u=C[s++])],A[2*u+1]),2!==i&&e.faceVertexUvs[n][o].push(E),0!==i&&e.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[s++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[s++],M=new Be(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(l=C[s++],_.color.setHex(T=N[l]),S.color.setHex(T)),x)for(n=0;n<4;n++)T=N[l=C[s++]],2!==n&&_.vertexColors.push(new tr(T)),0!==n&&S.vertexColors.push(new tr(T));e.faces.push(_),e.faces.push(S)}else{if((w=new cr).a=C[s++],w.b=C[s++],w.c=C[s++],f&&(h=C[s++],w.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new Fe(A[2*(u=C[s++])],A[2*u+1]),e.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[s++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[s++],M=new Be(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[s++],w.color.setHex(N[l])),x)for(n=0;n<3;n++)l=C[s++],w.vertexColors.push(new tr(N[l]));e.faces.push(w)}}(t,r),function(t,e){var r=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,i=t.skinWeights.length;n<i;n+=r)e.skinWeights.push(new Ge(t.skinWeights[n],r>1?t.skinWeights[n+1]:0,r>2?t.skinWeights[n+2]:0,r>3?t.skinWeights[n+3]:0));if(t.skinIndices)for(n=0,i=t.skinIndices.length;n<i;n+=r)e.skinIndices.push(new Ge(t.skinIndices[n],r>1?t.skinIndices[n+1]:0,r>2?t.skinIndices[n+2]:0,r>3?t.skinIndices[n+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,r),function(t,e){var r=t.scale;if(void 0!==t.morphTargets)for(var n=0,i=t.morphTargets.length;n<i;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var o=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,a=0,l=s.length;a<l;a+=3){var c=new Be;c.x=s[a]*r,c.y=s[a+1]*r,c.z=s[a+2]*r,o.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=e.faces,h=t.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(t,r),function(t,e){var r=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var i=0;i<n.length;i++){var o=Ds.parseAnimation(n[i],e.bones);o&&r.push(o)}if(e.morphTargets){var s=Ds.CreateClipsFromMorphTargetSequences(e.morphTargets,10);r=r.concat(s)}r.length>0&&(e.animations=r)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:Bs.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}),Object.assign(Vs.prototype,{load:function(t,e,r,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new ko(i.manager).load(t,function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.")},r,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,function(){void 0!==e&&e(a)}),o=this.parseTextures(t.textures,i),s=this.parseMaterials(t.materials,o),a=this.parseObject(t.object,n,s);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new hs).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new zs,i=new ks,o=0,s=t.length;o<s;o++){var a,l=t[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new _o[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new _o[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new _o[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new _o[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new _o[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new _o[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new _o[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new _o[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new _o[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new _o[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new _o[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new _o[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,s=l.shapes.length;o<s;o++)c.push(e[l.shapes[o]]);a=new _o[l.type](c,l.curveSegments);break;case"BufferGeometry":a=i.parse(l);break;case"Geometry":a=n.parse(l,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),r[l.uuid]=a}return r},parseMaterials:function(t,e){var r={};if(void 0!==t){var n=new Fs;n.setTextures(e);for(var i=0,o=t.length;i<o;i++){var s=t[i];if("MultiMaterial"===s.type){for(var a=[],l=0;l<s.materials.length;l++)a.push(n.parse(s.materials[l]));r[s.uuid]=a}else r[s.uuid]=n.parse(s)}}return r},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=Ds.parse(t[r]);e.push(n)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemEnd(t),r.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new jo(new Ro(e));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=t.length;s<a;s++){var l=t[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var s=t[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=new Ve(e[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,Hs)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],Ws),a.wrapT=r(s.wrap[1],Ws)),void 0!==s.format&&(a.format=s.format),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,Xs)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,Xs)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),n[s.uuid]=a}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new Zn,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new tr(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Yn(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new qn(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Gn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new lr(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new bs(t.color,t.intensity);break;case"DirectionalLight":n=new xs(t.color,t.intensity);break;case"PointLight":n=new gs(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new ws(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new vs(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new ps(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=i(t.geometry),a=o(t.material);n=s.bones&&s.bones.length>0?new ei(s,a):new kr(s,a);break;case"LOD":n=new Kn;break;case"Line":n=new ni(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new oi(i(t.geometry),o(t.material));break;case"LineSegments":n=new ii(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new ai(i(t.geometry),o(t.material));break;case"Sprite":n=new Qn(o(t.material));break;case"Group":n=new li;break;default:n=new sr}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,r));if("LOD"===t.type)for(var u=t.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var Gs,Hs={UVMapping:at,CubeReflectionMapping:lt,CubeRefractionMapping:ct,EquirectangularReflectionMapping:ut,EquirectangularRefractionMapping:ht,SphericalReflectionMapping:dt,CubeUVReflectionMapping:pt,CubeUVRefractionMapping:ft},Ws={RepeatWrapping:mt,ClampToEdgeWrapping:vt,MirroredRepeatWrapping:gt},Xs={NearestFilter:yt,NearestMipMapNearestFilter:xt,NearestMipMapLinearFilter:bt,LinearFilter:wt,LinearMipMapNearestFilter:_t,LinearMipMapLinearFilter:St};function qs(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Do,this.options=void 0}function Ys(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Zs(t){this.type="Font",this.data=t}function Js(t,e,r,n,i,o){var s=o.glyphs[t]||o.glyphs["?"];if(s){var a,l,c,u,h,d,p,f,m=new Ys;if(s.o)for(var v=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":a=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(a,l);break;case"l":a=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(a,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}return{offsetX:s.ha*r,path:m}}}function Qs(t){this.manager=void 0!==t?t:Do}qs.prototype={constructor:qs,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=Io.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(r){Io.add(t,r),e&&e(r),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Ys.prototype,{moveTo:function(t,e){this.currentPath=new us,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,n){this.currentPath.quadraticCurveTo(t,e,r,n)},bezierCurveTo:function(t,e,r,n,i,o){this.currentPath.bezierCurveTo(t,e,r,n,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new hs;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var s=e[i],a=e[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(s=e[o],l=-l,a=e[i],c=-c),t.y<s.y||t.y>a.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var u=c*(t.x-s.x)-l*(t.y-s.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(t.y!==s.y)continue;if(a.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=a.x)return!0}}return n}var i=Ki.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var s,a,l,c=[];if(1===o.length)return a=o[0],(l=new hs).curves=a.curves,c.push(l),c;var u=!i(o[0].getPoints());u=t?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)s=i(h=(a=o[g]).getPoints()),(s=t?!s:s)?(!u&&f[v]&&v++,f[v]={s:new hs,p:h},f[v].s.curves=a.curves,u&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){c.push(l=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(Zs.prototype,{isFont:!0,generateShapes:function(t,e,r){void 0===e&&(e=100),void 0===r&&(r=4);for(var n=[],i=function(t,e,r,n){for(var i=String(t).split(""),o=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=s;else{var d=Js(h,0,o,l,c,n);l+=d.offsetX,a.push(d.path)}}return a}(t,e,0,this.data),o=0,s=i.length;o<s;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),Object.assign(Qs.prototype,{load:function(t,e,r,n){var i=this,o=new ko(this.manager);o.setPath(this.path),o.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)},r,n)},parse:function(t){return new Zs(t)},setPath:function(t){return this.path=t,this}});var Ks,$s,ta={getContext:function(){return void 0===Gs&&(Gs=new(window.AudioContext||window.webkitAudioContext)),Gs},setContext:function(t){Gs=t}};function ea(t){this.manager=void 0!==t?t:Do}function ra(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Gn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Gn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function na(t,e,r){sr.call(this),this.type="CubeCamera";var n=new Gn(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new Be(1,0,0)),this.add(n);var i=new Gn(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new Be(-1,0,0)),this.add(i);var o=new Gn(90,1,t,e);o.up.set(0,0,1),o.lookAt(new Be(0,1,0)),this.add(o);var s=new Gn(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new Be(0,-1,0)),this.add(s);var a=new Gn(90,1,t,e);a.up.set(0,-1,0),a.lookAt(new Be(0,0,1)),this.add(a);var l=new Gn(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new Be(0,0,-1)),this.add(l),this.renderTarget=new We(r,r,{format:kt,magFilter:wt,minFilter:wt}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,n,r),r.activeCubeFace=1,t.render(e,i,r),r.activeCubeFace=2,t.render(e,o,r),r.activeCubeFace=3,t.render(e,s,r),r.activeCubeFace=4,t.render(e,a,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,t.render(e,l,r),t.setRenderTarget(null)},this.clear=function(t,e,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,r,n);t.setRenderTarget(null)}}function ia(){sr.call(this),this.type="AudioListener",this.context=ta.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function oa(t){sr.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function sa(t){oa.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function aa(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function la(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function ca(t,e,r){var n=r||ua.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function ua(t,e,r){this.path=e,this.parsedPath=r||ua.parseTrackName(e),this.node=ua.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function ha(){this.uuid=De.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function da(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,o=new Array(i),s={endingStart:xe,endingEnd:xe},a=0;a!==i;++a){var l=n[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function pa(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function fa(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function ma(){Mr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function va(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function ga(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ya(t,e,r){ga.call(this,t,e),this.meshPerAttribute=r||1}function xa(t,e,r){dr.call(this,t,e),this.meshPerAttribute=r||1}function ba(t,e,r,n){this.ray=new Rr(t,e),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function wa(t,e){return t.distance-e.distance}function _a(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,o=0,s=i.length;o<s;o++)_a(i[o],e,r,!0)}function Sa(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ta(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function Ma(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}function Aa(t,e){this.min=void 0!==t?t:new Fe(1/0,1/0),this.max=void 0!==e?e:new Fe(-1/0,-1/0)}function Ea(t){sr.call(this),this.material=t,this.render=function(){}}function Ca(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var l=new Mr,c=new br(2*s*3,3);l.addAttribute("position",c),ii.call(this,l,new ri({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Pa(t,e){sr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new Mr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var s=i/32*Math.PI*2,a=o/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}r.addAttribute("position",new br(n,3));var l=new ri({fog:!1});this.cone=new ii(r,l),this.add(this.cone),this.update()}function Oa(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,t(e.children[n]));return r}(t),r=new Mr,n=[],i=[],o=new tr(0,0,1),s=new tr(0,1,0),a=0;a<e.length;a++){var l=e[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}r.addAttribute("position",new br(n,3)),r.addAttribute("color",new br(i,3));var c=new ri({vertexColors:_,depthTest:!1,depthWrite:!1,transparent:!0});ii.call(this,r,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Na(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new so(e,4,2),i=new Lr({wireframe:!0,fog:!1});kr.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function La(t,e){sr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var r=new ri({fog:!1}),n=new Mr;n.addAttribute("position",new dr(new Float32Array(15),3)),this.line=new ni(n,r),this.add(this.line),this.update()}function Ia(t,e,r){sr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new bi(e);n.rotateY(.5*Math.PI),this.material=new Lr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=_);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new dr(o,3)),this.add(new kr(n,this.material)),this.update()}function Ra(t,e,r,n){t=t||10,e=e||10,r=new tr(void 0!==r?r:4473924),n=new tr(void 0!==n?n:8947848);for(var i=e/2,o=t/e,s=t/2,a=[],l=[],c=0,u=0,h=-s;c<=e;c++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);var d=c===i?r:n;d.toArray(l,u),d.toArray(l,u+=3),d.toArray(l,u+=3),d.toArray(l,u+=3),u+=3}var p=new Mr;p.addAttribute("position",new br(a,3)),p.addAttribute("color",new br(l,3));var f=new ri({vertexColors:_});ii.call(this,p,f)}function Da(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new tr(void 0!==i?i:4473924),o=new tr(void 0!==o?o:8947848);var s,a,l,c,u,h,d,p=[],f=[];for(c=0;c<=e;c++)l=c/e*(2*Math.PI),s=Math.sin(l)*t,a=Math.cos(l)*t,p.push(0,0,0),p.push(s,0,a),f.push((d=1&c?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=t-t/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new Mr;m.addAttribute("position",new br(p,3)),m.addAttribute("color",new br(f,3));var v=new ri({vertexColors:_});ii.call(this,m,v)}function Fa(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Mr,c=new br(2*s*3,3);l.addAttribute("position",c),ii.call(this,l,new ri({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function ka(t,e,r){sr.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new Mr;n.addAttribute("position",new br([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new ri({fog:!1});this.lightPlane=new ni(n,i),this.add(this.lightPlane),(n=new Mr).addAttribute("position",new br([0,0,0,0,0,1],3)),this.targetLine=new ni(n,i),this.add(this.targetLine),this.update()}function Ua(t){var e=new Mr,r=new ri({color:16777215,vertexColors:w}),n=[],i=[],o={},s=new tr(16755200),a=new tr(16711680),l=new tr(43775),c=new tr(16777215),u=new tr(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.addAttribute("position",new br(n,3)),e.addAttribute("color",new br(i,3)),ii.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Ba(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Mr;i.setIndex(new dr(r,1)),i.addAttribute("position",new dr(n,3)),ii.call(this,i,new ri({color:e})),this.matrixAutoUpdate=!1,this.update()}function ja(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Mr;i.setIndex(new dr(n,1)),i.addAttribute("position",new br([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),ii.call(this,i,new ri({color:r})),this.geometry.computeBoundingSphere()}function za(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new Mr;i.addAttribute("position",new br([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),ni.call(this,i,new ri({color:n}));var o=new Mr;o.addAttribute("position",new br([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new kr(o,new Lr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Va(t,e,r,n,i,o){sr.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===Ks&&((Ks=new Mr).addAttribute("position",new br([0,0,0,0,1,0],3)),($s=new go(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new ni(Ks,new ri({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new kr($s,new Lr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function Ga(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new Mr;r.addAttribute("position",new br(e,3)),r.addAttribute("color",new br([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new ri({vertexColors:_});ii.call(this,r,n)}function Ha(t,e,r,n,i,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new cr(t,e,r,i,o,s)}Object.assign(ea.prototype,{load:function(t,e,r,n){var i=new ko(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){ta.getContext().decodeAudioData(t,function(t){e(t)})},r,n)}}),Object.assign(ra.prototype,{update:function(){var t,e,r,n,i,o,s,a,l=new ke,c=new ke;return function(u){if(t!==this||e!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||s!==u.zoom||a!==this.eyeSep){t=this,e=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,s=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(a=this.eyeSep/2)*i/e,m=i*Math.tan(De.DEG2RAD*r*.5)/s;c.elements[12]=-a,l.elements[12]=a,p.elements[0]=2*i/((d=m*n+f)-(h=-m*n+f)),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),p.elements[0]=2*i/((d=m*n-f)-(h=-m*n-f)),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),(na.prototype=Object.create(sr.prototype)).constructor=na,ia.prototype=Object.assign(Object.create(sr.prototype),{constructor:ia,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new Be,e=new Ue,r=new Be,n=new Be;return function(i){sr.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(t,e,r),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),oa.prototype=Object.assign(Object.create(sr.prototype),{constructor:oa,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),sa.prototype=Object.assign(Object.create(oa.prototype),{constructor:sa,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new Be;return function(e){sr.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(aa.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(la.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)r[i+s]=r[s];o=e}else this._mixBufferRegion(r,i,0,e/(o+=e),n);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(r,n,3*e,1-i,e);for(var s=e,a=e+e;s!==a;++s)if(r[s]!==r[s+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e,i=r;n!==i;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){Ue.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,s=0;s!==i;++s){var a=e+s;t[a]=t[a]*o+t[r+s]*n}}}),Object.assign(ca.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(ua,{Composite:ca,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new ua.Composite(t,e,r):new ua(t,e,r)},sanitizeNodeName:function(){var t=new RegExp("[\\[\\]\\.:\\/]","g");return function(e){return e.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var t="[^\\[\\]\\.:\\/]",e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",t),n=/(WCOD+)?/.source.replace("WCOD",e),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t),s=new RegExp("^"+r+n+i+o+"$"),a=["material","materials","bones"];return function(t){var e=s.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==a.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(ua.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=ua.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var a=t[n];if(void 0!==a){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===i){i=s;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===i){i=s;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ua.prototype,{_getValue_unbound:ua.prototype.getValue,_setValue_unbound:ua.prototype.setValue}),Object.assign(ha.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=n[d];if(void 0===p){p=e++,n[d]=p,t.push(h);for(var f=0,m=a;f!==m;++f)s[f].push(new ua(h,i[f],o[f]))}else if(p<r){l=t[p];var v=--r,g=t[v];for(n[g.uuid]=p,t[p]=g,n[d]=v,t[v]=h,f=0,m=a;f!==m;++f){var y=s[f],x=y[p];y[p]=y[v],void 0===x&&(x=new ua(h,i[f],o[f])),y[v]=x}}else t[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],l=a.uuid,c=r[l];if(void 0!==c&&c>=e){var u=e++,h=t[u];r[h.uuid]=c,t[c]=h,r[l]=u,t[u]=a;for(var d=0,p=i;d!==p;++d){var f=n[d],m=f[c];f[c]=f[u],f[u]=m}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,s=0,a=arguments.length;s!==a;++s){var l=arguments[s].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<r){var u=--r,h=t[u],d=t[v=--e];n[h.uuid]=c,t[c]=h,n[d.uuid]=u,t[u]=d,t.pop();for(var p=0,f=o;p!==f;++p){var m=(g=i[p])[v];g[c]=g[u],g[u]=m,g.pop()}}else{var v;for(n[(d=t[v=--e]).uuid]=c,t[c]=d,t.pop(),p=0,f=o;p!==f;++p){var g;(g=i[p])[c]=g[v],g.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,s=this._parsedPaths,a=this._objects,l=this.nCachedObjects_,c=new Array(a.length);r[t]=n=i.length,o.push(t),s.push(e),i.push(c);for(var u=l,h=a.length;u!==h;++u)c[u]=new ua(a[u],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=r,o[r]=a,o.pop(),i[r]=i[s],i.pop(),n[r]=n[s],n.pop()}}}),Object.assign(da.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=n/i;t.warp(1,i/n,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+r,l[0]=t/s,l[1]=e/s,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var s=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(s),c[u].accumulate(n,a)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(n===pe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=n===me;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var s=Math.floor(e/r);e-=r*s,i+=Math.abs(s);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&i))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=be,n.endingEnd=be):(n.endingStart=t?this.zeroSlopeAtStart?be:xe:we,n.endingEnd=e?this.zeroSlopeAtEnd?be:xe:we)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=e,s[1]=i+t,a[1]=r,this}}),pa.prototype=Object.assign(Object.create(n.prototype),{constructor:pa,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,s=t._interpolants,a=r.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(l[a]=c={});for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}++(p=new la(ua.create(r,d,e&&e._propertyBindings[u].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,a,d),o[u]=p}s[u].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,s=i.length;o!==s;++o){var a=i[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var s=o.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(n[e]=i={}),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,s=o[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete s[i];t:{for(var c in s)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new Os(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Ds.findByName(r,t):t,o=null!==i?i.uuid:t,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;a=s.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var c=new da(this,i,e);return this._bindAction(c,a),this._addInactiveAction(c,o,n),c},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Ds.findByName(r,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){for(var e=this._actions,r=this._nActiveActions,n=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,s=0;s!==r;++s)e[s]._update(n,t,i,o);var a=this._bindings,l=this._nActiveBindings;for(s=0;s!==l;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),fa.prototype.clone=function(){return new fa(void 0===this.value.clone?this.value:this.value.clone())},ma.prototype=Object.assign(Object.create(Mr.prototype),{constructor:ma,isInstancedBufferGeometry:!0,copy:function(t){return Mr.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(va.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(va.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),Object.defineProperty(ga.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ga.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),ya.prototype=Object.assign(Object.create(ga.prototype),{constructor:ya,isInstancedInterleavedBuffer:!0,copy:function(t){return ga.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),xa.prototype=Object.assign(Object.create(dr.prototype),{constructor:xa,isInstancedBufferAttribute:!0,copy:function(t){return dr.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(ba.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return _a(t,this,n,e),n.sort(wa),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)_a(t[i],this,n,e);return n.sort(wa),n}}),Object.assign(Sa.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(Ta.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(De.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(Ma.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),Object.assign(Aa.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Fe;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Fe),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Fe),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Fe),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Fe),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Fe;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),(Ea.prototype=Object.create(sr.prototype)).constructor=Ea,Ea.prototype.isImmediateRenderObject=!0,(Ca.prototype=Object.create(ii.prototype)).constructor=Ca,Ca.prototype.update=function(){var t=new Be,e=new Be,r=new je;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,l=s.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(a[d[n[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}else if(s&&s.isBufferGeometry){var v=s.attributes.position,g=s.attributes.normal;for(c=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}o.needsUpdate=!0}}(),(Pa.prototype=Object.create(sr.prototype)).constructor=Pa,Pa.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Pa.prototype.update=function(){var t=new Be,e=new Be;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Oa.prototype=Object.create(ii.prototype)).constructor=Oa,Oa.prototype.updateMatrixWorld=function(){var t=new Be,e=new ke,r=new ke;return function(n){var i=this.bones,o=this.geometry,s=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var a=0,l=0;a<i.length;a++){var c=i[a];c.parent&&c.parent.isBone&&(e.multiplyMatrices(r,c.matrixWorld),t.setFromMatrixPosition(e),s.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,c.parent.matrixWorld),t.setFromMatrixPosition(e),s.setXYZ(l+1,t.x,t.y,t.z),l+=2)}o.getAttribute("position").needsUpdate=!0,sr.prototype.updateMatrixWorld.call(this,n)}}(),(Na.prototype=Object.create(kr.prototype)).constructor=Na,Na.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Na.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(La.prototype=Object.create(sr.prototype)).constructor=La,La.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},La.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Ia.prototype=Object.create(sr.prototype)).constructor=Ia,Ia.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ia.prototype.update=function(){var t=new Be,e=new tr,r=new tr;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,s=i.count;o<s;o++){var a=o<s/2?e:r;i.setXYZ(o,a.r,a.g,a.b)}i.needsUpdate=!0}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Ra.prototype=Object.create(ii.prototype)).constructor=Ra,(Da.prototype=Object.create(ii.prototype)).constructor=Da,(Fa.prototype=Object.create(ii.prototype)).constructor=Fa,Fa.prototype.update=function(){var t=new Be,e=new Be,r=new je;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,c=0,u=a.length;c<u;c++){var h=a[c],d=h.normal;t.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),i.setXYZ(l,t.x,t.y,t.z),i.setXYZ(l+=1,e.x,e.y,e.z),l+=1}i.needsUpdate=!0}}(),(ka.prototype=Object.create(sr.prototype)).constructor=ka,ka.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},ka.prototype.update=function(){var t=new Be,e=new Be,r=new Be;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),(Ua.prototype=Object.create(ii.prototype)).constructor=Ua,Ua.prototype.update=function(){var t,e,r=new Be,n=new ar;function i(i,o,s,a){r.set(o,s,a).unproject(n);var l=e[i];if(void 0!==l)for(var c=t.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap,n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(Ba.prototype=Object.create(ii.prototype)).constructor=Ba,Ba.prototype.update=function(){var t=new qe;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,n=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ba.prototype.setFromObject=function(t){return this.object=t,this.update(),this},(ja.prototype=Object.create(ii.prototype)).constructor=ja,ja.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),sr.prototype.updateMatrixWorld.call(this,t))},(za.prototype=Object.create(ni.prototype)).constructor=za,za.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),sr.prototype.updateMatrixWorld.call(this,t)},(Va.prototype=Object.create(sr.prototype)).constructor=Va,Va.prototype.setDirection=function(){var t,e=new Be;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),Va.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},Va.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(Ga.prototype=Object.create(ii.prototype)).constructor=Ga;var Wa=0,Xa=1;function qa(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Ya(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Za(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ai(t,e)}function Ja(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Qn(t)}function Qa(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ai(t,e)}function Ka(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new si(t)}function $a(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new si(t)}function tl(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new si(t)}function el(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Be(t,e,r)}function rl(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new dr(t,e).setDynamic(!0)}function nl(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new pr(t,e)}function il(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new fr(t,e)}function ol(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new mr(t,e)}function sl(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new vr(t,e)}function al(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new gr(t,e)}function ll(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new yr(t,e)}function cl(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new xr(t,e)}function ul(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new br(t,e)}function hl(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new wr(t,e)}function dl(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom",this.closed=!0}function pl(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom"}function fl(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Qo.call(this,t),this.type="catmullrom"}function ml(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Ga(t)}function vl(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ba(t,e)}function gl(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ii(new mo(t.geometry),new ri({color:void 0!==e?e:16777215}))}function yl(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ii(new di(t.geometry),new ri({color:void 0!==e?e:16777215}))}function xl(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ko(t)}function bl(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Bo(t)}Go.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Go.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(cs.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new hr,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new Be(i.x,i.y,i.z||0))}return e}}),Object.assign(us.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),dl.prototype=Object.create(Qo.prototype),pl.prototype=Object.create(Qo.prototype),fl.prototype=Object.create(Qo.prototype),Object.assign(fl.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ra.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Oa.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Bs.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),js.extractUrlBase(t)}}),Object.assign(Aa.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(qe.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Dr.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(De,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),De.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),De.ceilPowerOfTwo(t)}}),Object.assign(je.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ke.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Be),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,o)}}),Ze.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Ue.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Rr.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Fr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Fr,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Fr.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Fr.getNormal(t,e,r,n)}}),Object.assign(hs.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new eo(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ho(this,t)}}),Object.assign(Fe.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Be.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ge.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(hr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(sr.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(sr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Kn.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty($n.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Go.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Gn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(ds.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(dr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Mr.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Mr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(fa.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Nr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new tr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===y}}}),Object.defineProperties(Eo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ir.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Xn.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Xn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(jn.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(He.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Wn.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),oa.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new ea).load(t,function(t){e.setBuffer(t)}),this},aa.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},na.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var wl={merge:function(t,e,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},_l={crossOrigin:void 0,loadTexture:function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Vo;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new zo;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Sl(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Tl(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}var Ml={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function Al(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}},MsCo:function(t,e,r){(function(t,n){var i;!function(n){var o,s=2147483647,a=36,l=1,c=26,u=38,h=700,d=72,p=128,f="-",m=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=a-l,b=Math.floor,w=String.fromCharCode;function _(t){throw new RangeError(y[t])}function S(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function T(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+S((t=t.replace(g,".")).split("."),e).join(".")}function M(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function A(t){return S(t,function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)}).join("")}function E(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:a}function C(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,r){var n=0;for(t=r?b(t/h):t>>1,t+=b(t/e);t>x*c>>1;n+=a)t=b(t/x);return b(n+(x+1)*t/(t+u))}function O(t){var e,r,n,i,o,u,h,m,v,g,y=[],x=t.length,w=0,S=p,T=d;for((r=t.lastIndexOf(f))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&_("not-basic"),y.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<x;){for(o=w,u=1,h=a;i>=x&&_("invalid-input"),((m=E(t.charCodeAt(i++)))>=a||m>b((s-w)/u))&&_("overflow"),w+=m*u,!(m<(v=h<=T?l:h>=T+c?c:h-T));h+=a)u>b(s/(g=a-v))&&_("overflow"),u*=g;T=P(w-o,e=y.length+1,0==o),b(w/e)>s-S&&_("overflow"),S+=b(w/e),w%=e,y.splice(w++,0,S)}return A(y)}function N(t){var e,r,n,i,o,u,h,m,v,g,y,x,S,T,A,E=[];for(x=(t=M(t)).length,e=p,r=0,o=d,u=0;u<x;++u)(y=t[u])<128&&E.push(w(y));for(n=i=E.length,i&&E.push(f);n<x;){for(h=s,u=0;u<x;++u)(y=t[u])>=e&&y<h&&(h=y);for(h-e>b((s-r)/(S=n+1))&&_("overflow"),r+=(h-e)*S,e=h,u=0;u<x;++u)if((y=t[u])<e&&++r>s&&_("overflow"),y==e){for(m=r,v=a;!(m<(g=v<=o?l:v>=o+c?c:v-o));v+=a)E.push(w(C(g+(A=m-g)%(T=a-g),0))),m=b(A/T);E.push(w(C(m,0))),o=P(r,S,n==i),r=0,++n}++r,++e}return E.join("")}o={version:"1.4.1",ucs2:{decode:M,encode:A},decode:O,encode:N,toASCII:function(t){return T(t,function(t){return v.test(t)?"xn--"+N(t):t})},toUnicode:function(t){return T(t,function(t){return m.test(t)?O(t.slice(4).toLowerCase()):t})}},void 0===(i=(function(){return o}).call(e,r,e,t))||(t.exports=i)}()}).call(e,r("3IRH")(t),r("DuR2"))},NGfj:function(t,e,r){"use strict";e.__esModule=!0;var n=r("aH6o"),i={getTintedTexture:function(t,e){var r=t._texture,n="#"+("00000"+(0|(e=i.roundColor(e))).toString(16)).substr(-6);r.tintCache=r.tintCache||{};var o=r.tintCache[n],s=void 0;if(o){if(o.tintId===r._updateID)return r.tintCache[n];s=r.tintCache[n]}else s=i.canvas||document.createElement("canvas");if(i.tintMethod(r,e,s),s.tintId=r._updateID,i.convertTintToImage){var a=new Image;a.src=s.toDataURL(),r.tintCache[n]=a}else r.tintCache[n]=s,i.canvas=null;return s},tintWithMultiply:function(t,e,r){var n=r.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithOverlay:function(t,e,r){var n=r.getContext("2d"),i=t._frame.clone(),o=t.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithPerPixel:function(t,e,r){var i=r.getContext("2d"),o=t._frame.clone(),s=t.baseTexture.resolution;o.x*=s,o.y*=s,o.width*=s,o.height*=s,r.width=Math.ceil(o.width),r.height=Math.ceil(o.height),i.save(),i.globalCompositeOperation="copy",i.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),i.restore();for(var a=(0,n.hex2rgb)(e),l=a[0],c=a[1],u=a[2],h=i.getImageData(0,0,o.width,o.height),d=h.data,p=0;p<d.length;p+=4)d[p+0]*=l,d[p+1]*=c,d[p+2]*=u;i.putImageData(h,0,0)},roundColor:function(t){var e=i.cacheStepsPerColorChannel,r=(0,n.hex2rgb)(t);return r[0]=Math.min(255,r[0]/e*e),r[1]=Math.min(255,r[1]/e*e),r[2]=Math.min(255,r[2]/e*e),(0,n.rgb2hex)(r)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,function(t){return t&&t.__esModule?t:{default:t}}(r("/SMQ")).default)(),tintMethod:0};i.tintMethod=i.canUseMultiply?i.tintWithMultiply:i.tintWithPerPixel,e.default=i},NZvU:function(t,e){var r=null,n={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};t.exports=function(t,e){if(!r){var i=Object.keys(n);r={};for(var o=0;o<i.length;++o){var s=i[o];r[t[s]]=n[s]}}return r[e]}},"Nf+U":function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=s(r("Sst2")),o=s(r("fiP3"));function s(t){return t&&t.__esModule?t:{default:t}}n.utils.mixins.delayMixin(n.DisplayObject.prototype,o.default);var a=100,l=0,c=0,u=2,h=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),!i.default.tablet&&!i.default.phone||navigator.isCocoonJS||this.createTouchHook();var r=document.createElement("div");r.style.width=a+"px",r.style.height=a+"px",r.style.position="absolute",r.style.top=l+"px",r.style.left=c+"px",r.style.zIndex=u,this.div=r,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",function(){t.isMobileAccessabillity=!0,t.activate(),document.body.removeChild(e)}),document.body.appendChild(e)},t.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=e.length-1;r>=0;r--)this.updateAccessibleObjects(e[r])}},t.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,r=t.height/this.renderer.height,i=this.div;i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.width=this.renderer.width+"px",i.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var s=this.children[o];if(s.renderId!==this.renderId)s._accessibleActive=!1,n.utils.removeItems(this.children,o,1),this.div.removeChild(s._accessibleDiv),this.pool.push(s._accessibleDiv),s._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{i=s._accessibleDiv;var a=s.hitArea,l=s.worldTransform;s.hitArea?(i.style.left=(l.tx+a.x*l.a)*e+"px",i.style.top=(l.ty+a.y*l.d)*r+"px",i.style.width=a.width*l.a*e+"px",i.style.height=a.height*l.d*r+"px"):(a=s.getBounds(),this.capHitArea(a),i.style.left=a.x*e+"px",i.style.top=a.y*r+"px",i.style.width=a.width*e+"px",i.style.height=a.height*r+"px")}}this.renderId++}},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=a+"px",e.style.height=a+"px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=u,e.style.borderStyle="none",e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleTitle||t.accessibleHint||(e.title="displayObject "+this.tabIndex),t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData)},t.prototype._onFocus=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(){this.deactivate()},t.prototype.destroy=function(){this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();e.default=h,n.WebGLRenderer.registerPlugin("accessibility",h),n.CanvasRenderer.registerPlugin("accessibility",h)},Nfkn:function(t,e){},Niek:function(t,e,r){"use strict";e.a=function(){}},NqTp:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.fn=e,this.context=r,this.priority=n,this.once=i,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return e=e||null,this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.previous;return this.next=t?null:e,this.previous=null,e},t}();e.default=n},Obmw:function(t,e,r){"use strict";e.__esModule=!0;var n=r("8QNu"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("/MUw"));function o(t,e){if(t instanceof Array){if("precision"!==t[0].substring(0,9)){var r=t.slice(0);return r.unshift("precision "+e+" float;"),r}}else if("precision"!==t.trim().substring(0,9))return"precision "+e+" float;\n"+t;return t}var s=function(t){function e(r,n,s,a,l){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,o(n,l||i.default.PRECISION_VERTEX),o(s,l||i.default.PRECISION_FRAGMENT),void 0,a))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(n.GLShader);e.default=s},P2cu:function(t,e,r){(function(e){var n=r("bKul");t.exports=function(t){var r=t.xdomain,i=t.xscheme,o=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!r||n))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(t){}if(!r)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}).call(e,r("DuR2"))},PMti:function(t,e,r){"use strict";e.__esModule=!0,e.BitmapText=e.TilingSpriteRenderer=e.TilingSprite=e.AnimatedSprite=void 0;var n=r("hYez");Object.defineProperty(e,"AnimatedSprite",{enumerable:!0,get:function(){return a(n).default}});var i=r("DVpw");Object.defineProperty(e,"TilingSprite",{enumerable:!0,get:function(){return a(i).default}});var o=r("3AVc");Object.defineProperty(e,"TilingSpriteRenderer",{enumerable:!0,get:function(){return a(o).default}});var s=r("38rC");function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"BitmapText",{enumerable:!0,get:function(){return a(s).default}}),r("M81j"),r("6Lyv"),r("aWrq")},PjB0:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("aH6o"),o=r("Q5/2"),s=r("FjAT"),a=h(r("/MUw")),l=h(r("dtlK")),c=h(r("1g9v")),u=h(r("BzvE"));function h(t){return t&&t.__esModule?t:{default:t}}var d=new o.Matrix,p=function(t){function e(r,n,c,u){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return(0,i.sayHello)(r),"number"==typeof n&&(n=Object.assign({width:n,height:c||a.default.RENDER_OPTIONS.height},u)),n=Object.assign({},a.default.RENDER_OPTIONS,n),h.options=n,h.type=s.RENDERER_TYPE.UNKNOWN,h.screen=new o.Rectangle(0,0,n.width,n.height),h.view=n.view||document.createElement("canvas"),h.resolution=n.resolution||a.default.RESOLUTION,h.transparent=n.transparent,h.autoResize=n.autoResize||!1,h.blendModes=null,h.preserveDrawingBuffer=n.preserveDrawingBuffer,h.clearBeforeRender=n.clearBeforeRender,h.roundPixels=n.roundPixels,h._backgroundColor=0,h._backgroundColorRgba=[0,0,0,0],h._backgroundColorString="#000000",h.backgroundColor=n.backgroundColor||h._backgroundColor,h._tempDisplayObjectParent=new l.default,h._lastObjectRendered=h._tempDisplayObjectParent,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoResize&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,r,n){n=n||t.getLocalBounds();var i=c.default.create(0|n.width,0|n.height,e,r);return d.tx=-n.x,d.ty=-n.y,this.render(t,i,!1,d,!0),i},e.prototype.destroy=function(t){t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=s.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n(e,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=(0,i.hex2string)(t),(0,i.hex2rgb)(t,this._backgroundColorRgba)}}]),e}(u.default);e.default=p},"Q+pJ":function(t,e){var r=function(t,e,r,n,i){this.gl=t,this.texture=t.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=e||-1,this.height=r||-1,this.format=n||t.RGBA,this.type=i||t.UNSIGNED_BYTE};r.prototype.upload=function(t){this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var r=t.videoWidth||t.width,n=t.videoHeight||t.height;n!==this.height||r!==this.width?e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.format,this.type,t),this.width=r,this.height=n};var n=!1;r.prototype.uploadData=function(t,e,r){this.bind();var i=this.gl;if(t instanceof Float32Array){if(!n){if(!i.getExtension("OES_texture_float"))throw new Error("floating point textures not available");n=!0}this.type=i.FLOAT}else this.type=this.type||i.UNSIGNED_BYTE;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e!==this.width||r!==this.height?i.texImage2D(i.TEXTURE_2D,0,this.format,e,r,0,this.format,this.type,t||null):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e,r,this.format,this.type,t||null),this.width=e,this.height=r},r.prototype.bind=function(t){var e=this.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},r.prototype.unbind=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},r.prototype.minFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.mipmap?t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST:t?e.LINEAR:e.NEAREST)},r.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST)},r.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)},r.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},r.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},r.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},r.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)},r.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)},r.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},r.fromSource=function(t,e,n){var i=new r(t);return i.premultiplyAlpha=n||!1,i.upload(e),i},r.fromData=function(t,e,n,i){var o=new r(t);return o.uploadData(e,n,i),o},t.exports=r},"Q/rl":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,i.default)()?(t[n.BLEND_MODES.NORMAL]="source-over",t[n.BLEND_MODES.ADD]="lighter",t[n.BLEND_MODES.MULTIPLY]="multiply",t[n.BLEND_MODES.SCREEN]="screen",t[n.BLEND_MODES.OVERLAY]="overlay",t[n.BLEND_MODES.DARKEN]="darken",t[n.BLEND_MODES.LIGHTEN]="lighten",t[n.BLEND_MODES.COLOR_DODGE]="color-dodge",t[n.BLEND_MODES.COLOR_BURN]="color-burn",t[n.BLEND_MODES.HARD_LIGHT]="hard-light",t[n.BLEND_MODES.SOFT_LIGHT]="soft-light",t[n.BLEND_MODES.DIFFERENCE]="difference",t[n.BLEND_MODES.EXCLUSION]="exclusion",t[n.BLEND_MODES.HUE]="hue",t[n.BLEND_MODES.SATURATION]="saturate",t[n.BLEND_MODES.COLOR]="color",t[n.BLEND_MODES.LUMINOSITY]="luminosity"):(t[n.BLEND_MODES.NORMAL]="source-over",t[n.BLEND_MODES.ADD]="lighter",t[n.BLEND_MODES.MULTIPLY]="source-over",t[n.BLEND_MODES.SCREEN]="source-over",t[n.BLEND_MODES.OVERLAY]="source-over",t[n.BLEND_MODES.DARKEN]="source-over",t[n.BLEND_MODES.LIGHTEN]="source-over",t[n.BLEND_MODES.COLOR_DODGE]="source-over",t[n.BLEND_MODES.COLOR_BURN]="source-over",t[n.BLEND_MODES.HARD_LIGHT]="source-over",t[n.BLEND_MODES.SOFT_LIGHT]="source-over",t[n.BLEND_MODES.DIFFERENCE]="source-over",t[n.BLEND_MODES.EXCLUSION]="source-over",t[n.BLEND_MODES.HUE]="source-over",t[n.BLEND_MODES.SATURATION]="source-over",t[n.BLEND_MODES.COLOR]="source-over",t[n.BLEND_MODES.LUMINOSITY]="source-over"),t[n.BLEND_MODES.NORMAL_NPM]=t[n.BLEND_MODES.NORMAL],t[n.BLEND_MODES.ADD_NPM]=t[n.BLEND_MODES.ADD],t[n.BLEND_MODES.SCREEN_NPM]=t[n.BLEND_MODES.SCREEN],t};var n=r("FjAT"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("/SMQ"))},"Q5/2":function(t,e,r){"use strict";e.__esModule=!0;var n=r("zFUS");Object.defineProperty(e,"Point",{enumerable:!0,get:function(){return d(n).default}});var i=r("kFAI");Object.defineProperty(e,"ObservablePoint",{enumerable:!0,get:function(){return d(i).default}});var o=r("HVUN");Object.defineProperty(e,"Matrix",{enumerable:!0,get:function(){return d(o).default}});var s=r("VWTR");Object.defineProperty(e,"GroupD8",{enumerable:!0,get:function(){return d(s).default}});var a=r("h4XE");Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return d(a).default}});var l=r("V0yo");Object.defineProperty(e,"Ellipse",{enumerable:!0,get:function(){return d(l).default}});var c=r("7F6j");Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return d(c).default}});var u=r("gQZj");Object.defineProperty(e,"Rectangle",{enumerable:!0,get:function(){return d(u).default}});var h=r("Ibme");function d(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"RoundedRectangle",{enumerable:!0,get:function(){return d(h).default}})},Q5o8:function(t,e,r){var n=r("JD0k"),i=r("7IZn"),o=r("rN5J"),s=r("Qn7E"),a=r("sMVv"),l=function(t,e,r,l,c){this.gl=t,l&&(e=s(e,l),r=s(r,l)),this.program=n(t,e,r,c),this.attributes=i(t,this.program),this.uniformData=o(t,this.program),this.uniforms=a(t,this.uniformData)};l.prototype.bind=function(){return this.gl.useProgram(this.program),this},l.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},t.exports=l},"QAU/":function(t,e,r){"use strict";e.__esModule=!0;var n=u(r("3psj")),i=u(r("EoU7")),o=u(r("tl0p")),s=r("Q5/2"),a=u(r("Obmw")),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/Zzt")),c=u(r("eWjs"));function u(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function t(){h(this,t),this.renderTarget=null,this.sourceFrame=new s.Rectangle,this.destinationFrame=new s.Rectangle,this.filters=[],this.target=null,this.resolution=1},p=function(t){function e(r){h(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.gl=n.renderer.gl,n.quad=new o.default(n.gl,r.state.attribState),n.shaderCache={},n.pool={},n.filterData=null,n.managedFilters=[],n.renderer.on("prerender",n.onPrerender,n),n._screenWidth=r.view.width,n._screenHeight=r.view.height,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushFilter=function(t,e){var r=this.renderer,n=this.filterData;if(!n){n=this.renderer._activeRenderTarget.filterStack;var i=new d;i.sourceFrame=i.destinationFrame=this.renderer._activeRenderTarget.size,i.renderTarget=r._activeRenderTarget,this.renderer._activeRenderTarget.filterData=n={index:0,stack:[i]},this.filterData=n}var o=n.stack[++n.index],s=n.stack[0].destinationFrame;o||(o=n.stack[n.index]=new d);var a=t.filterArea&&0===t.filterArea.x&&0===t.filterArea.y&&t.filterArea.width===r.screen.width&&t.filterArea.height===r.screen.height,l=e[0].resolution,c=0|e[0].padding,u=a?r.screen:t.filterArea||t.getBounds(!0),h=o.sourceFrame,p=o.destinationFrame;h.x=(u.x*l|0)/l,h.y=(u.y*l|0)/l,h.width=(u.width*l|0)/l,h.height=(u.height*l|0)/l,a||(n.stack[0].renderTarget.transform||e[0].autoFit&&h.fit(s),h.pad(c)),p.width=h.width,p.height=h.height;var f=this.getPotRenderTarget(r.gl,h.width,h.height,l);o.target=t,o.filters=e,o.resolution=l,o.renderTarget=f,f.setFrame(p,h),r.bindRenderTarget(f),f.clear()},e.prototype.popFilter=function(){var t=this.filterData,e=t.stack[t.index-1],r=t.stack[t.index];this.quad.map(r.renderTarget.size,r.sourceFrame).upload();var n=r.filters;if(1===n.length)n[0].apply(this,r.renderTarget,e.renderTarget,!1,r),this.freePotRenderTarget(r.renderTarget);else{var i=r.renderTarget,o=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,r.resolution);o.setFrame(r.destinationFrame,r.sourceFrame),o.clear();var s=0;for(s=0;s<n.length-1;++s){n[s].apply(this,i,o,!0,r);var a=i;i=o,o=a}n[s].apply(this,i,e.renderTarget,!1,r),this.freePotRenderTarget(i),this.freePotRenderTarget(o)}t.index--,0===t.index&&(this.filterData=null)},e.prototype.applyFilter=function(t,e,r,n){var i=this.renderer,o=i.gl,s=t.glShaders[i.CONTEXT_UID];s||(t.glShaderKey?(s=this.shaderCache[t.glShaderKey])||(s=new a.default(this.gl,t.vertexSrc,t.fragmentSrc),t.glShaders[i.CONTEXT_UID]=this.shaderCache[t.glShaderKey]=s,this.managedFilters.push(t)):(s=t.glShaders[i.CONTEXT_UID]=new a.default(this.gl,t.vertexSrc,t.fragmentSrc),this.managedFilters.push(t)),i.bindVao(null),this.quad.initVao(s)),i.bindVao(this.quad.vao),i.bindRenderTarget(r),n&&(o.disable(o.SCISSOR_TEST),i.clear(),o.enable(o.SCISSOR_TEST)),r===i.maskManager.scissorRenderTarget&&i.maskManager.pushScissorMask(null,i.maskManager.scissorData),i.bindShader(s);var l=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=l,this.syncUniforms(s,t),i.state.setBlendMode(t.blendMode),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),o.bindTexture(o.TEXTURE_2D,l._glTextures[this.renderer.CONTEXT_UID].texture)},e.prototype.syncUniforms=function(t,e){var r=e.uniformData,n=e.uniforms,i=1,o=void 0;if(t.uniforms.filterArea){var s=t.uniforms.filterArea;s[0]=(o=this.filterData.stack[this.filterData.index]).renderTarget.size.width,s[1]=o.renderTarget.size.height,s[2]=o.sourceFrame.x,s[3]=o.sourceFrame.y,t.uniforms.filterArea=s}if(t.uniforms.filterClamp){o=o||this.filterData.stack[this.filterData.index];var a=t.uniforms.filterClamp;a[0]=0,a[1]=0,a[2]=(o.sourceFrame.width-1)/o.renderTarget.size.width,a[3]=(o.sourceFrame.height-1)/o.renderTarget.size.height,t.uniforms.filterClamp=a}for(var l in r){var c=r[l].type;if("sampler2d"===c&&0!==n[l]){if(n[l].baseTexture)t.uniforms[l]=this.renderer.bindTexture(n[l].baseTexture,i);else{t.uniforms[l]=i;var u=this.renderer.gl;this.renderer.boundTextures[i]=this.renderer.emptyTextures[i],u.activeTexture(u.TEXTURE0+i),n[l].texture.bind()}i++}else if("mat3"===c)t.uniforms[l]=void 0!==n[l].a?n[l].toArray(!0):n[l];else if("vec2"===c)if(void 0!==n[l].x){var h=t.uniforms[l]||new Float32Array(2);h[0]=n[l].x,h[1]=n[l].y,t.uniforms[l]=h}else t.uniforms[l]=n[l];else"float"===c?t.uniforms.data[l].value!==r[l]&&(t.uniforms[l]=n[l]):t.uniforms[l]=n[l]}},e.prototype.getRenderTarget=function(t,e){var r=this.filterData.stack[this.filterData.index],n=this.getPotRenderTarget(this.renderer.gl,r.sourceFrame.width,r.sourceFrame.height,e||r.resolution);return n.setFrame(r.destinationFrame,r.sourceFrame),n},e.prototype.returnRenderTarget=function(t){this.freePotRenderTarget(t)},e.prototype.calculateScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size)},e.prototype.calculateNormalizedScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateNormalizedScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size,e.destinationFrame)},e.prototype.calculateSpriteMatrix=function(t,e){var r=this.filterData.stack[this.filterData.index];return l.calculateSpriteMatrix(t,r.sourceFrame,r.renderTarget.size,e)},e.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.renderer,r=this.managedFilters;e.off("prerender",this.onPrerender,this);for(var n=0;n<r.length;n++)t||r[n].glShaders[e.CONTEXT_UID].destroy(),delete r[n].glShaders[e.CONTEXT_UID];this.shaderCache={},t?this.pool={}:this.emptyPool()},e.prototype.getPotRenderTarget=function(t,e,r,n){var o="screen";r*=n,(e*=n)===this._screenWidth&&r===this._screenHeight||(o=(65535&(e=c.default.nextPow2(e)))<<16|65535&(r=c.default.nextPow2(r))),this.pool[o]||(this.pool[o]=[]);var s=this.pool[o].pop();if(!s){var a=this.renderer.boundTextures[0];t.activeTexture(t.TEXTURE0),s=new i.default(t,e,r,null,1),t.bindTexture(t.TEXTURE_2D,a._glTextures[this.renderer.CONTEXT_UID].texture)}return s.resolution=n,s.defaultFrame.width=s.size.width=e/n,s.defaultFrame.height=s.size.height=r/n,s},e.prototype.emptyPool=function(){for(var t in this.pool){var e=this.pool[t];if(e)for(var r=0;r<e.length;r++)e[r].destroy(!0)}this.pool={}},e.prototype.freePotRenderTarget=function(t){var e=t.size.width*t.resolution,r=t.size.height*t.resolution,n="screen";e===this._screenWidth&&r===this._screenHeight||(n=(65535&e)<<16|65535&r),this.pool[n].push(t)},e.prototype.onPrerender=function(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width,this._screenHeight=this.renderer.view.height;var t=this.pool.screen;if(t)for(var e=0;e<t.length;e++)t[e].destroy(!0);this.pool.screen=[]}},e}(n.default);e.default=p},QHw4:function(t,e,r){(function(t){var n=r("sOR5"),i=r("UZ14"),o=Object.prototype.toString,s="function"==typeof t.Blob||"[object BlobConstructor]"===o.call(t.Blob),a="function"==typeof t.File||"[object FileConstructor]"===o.call(t.File);e.deconstructPacket=function(t){var e=[],r=t;return r.data=function t(e,r){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:r.length};return r.push(e),o}if(n(e)){for(var s=new Array(e.length),a=0;a<e.length;a++)s[a]=t(e[a],r);return s}if("object"==typeof e&&!(e instanceof Date)){for(var l in s={},e)s[l]=t(e[l],r);return s}return e}(t.data,e),r.attachments=e.length,{packet:r,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,r){if(!e)return e;if(e&&e._placeholder)return r[e.num];if(n(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],r);else if("object"==typeof e)for(var o in e)e[o]=t(e[o],r);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var r=0,o=t;!function t(l,c,u){if(!l)return l;if(s&&l instanceof Blob||a&&l instanceof File){r++;var h=new FileReader;h.onload=function(){u?u[c]=this.result:o=this.result,--r||e(o)},h.readAsArrayBuffer(l)}else if(n(l))for(var d=0;d<l.length;d++)t(l[d],d,l);else if("object"==typeof l&&!i(l))for(var p in l)t(l[p],p,l)}(o),r||e(o)}}).call(e,r("DuR2"))},QamB:function(t,e){t.exports=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},Qi5R:function(t,e,r){"use strict";e.a=function(...t){let e=Number.POSITIVE_INFINITY,r=null,a=t[t.length-1];return Object(o.a)(a)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof a&&(e=t.pop()),null===r&&1===t.length&&t[0]instanceof n.a?t[0]:Object(s.a)(e)(new i.a(t,r))};var n=r("ves3"),i=r("y3s0"),o=r("f2Ls"),s=r("Ynfn")},Qn7E:function(t,e){t.exports=function(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;\n"+t:t}},QyjV:function(t,e,r){"use strict";e.__esModule=!0;var n=r("RgHu");Object.defineProperty(e,"webgl",{enumerable:!0,get:function(){return l(n).default}});var i=r("jMVn");Object.defineProperty(e,"canvas",{enumerable:!0,get:function(){return l(i).default}});var o=r("k6PJ");Object.defineProperty(e,"BasePrepare",{enumerable:!0,get:function(){return l(o).default}});var s=r("EmDc");Object.defineProperty(e,"CountLimiter",{enumerable:!0,get:function(){return l(s).default}});var a=r("Gc6/");function l(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"TimeLimiter",{enumerable:!0,get:function(){return l(a).default}})},R3ym:function(t,e,r){"use strict";var n=r("ves3");class i extends n.a{constructor(t,e){super(),this.value=t,this.scheduler=e,this._isScalar=!0,e&&(this._isScalar=!1)}static create(t,e){return new i(t,e)}static dispatch(t){const{done:e,value:r,subscriber:n}=t;e?n.complete():(n.next(r),n.closed||(t.done=!0,this.schedule(t)))}_subscribe(t){const e=this.value,r=this.scheduler;if(r)return r.schedule(i.dispatch,0,{done:!1,value:e,subscriber:t});t.next(e),t.closed||t.complete()}}e.a=i},RZRe:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){t.points=t.shape.points.slice();var s=t.points;if(t.fill&&s.length>=6){for(var a=[],l=t.holes,c=0;c<l.length;c++){var u=l[c];a.push(s.length/2),s=s.concat(u.points)}var h=e.points,d=e.indices,p=s.length/2,f=(0,i.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=(0,o.default)(s,a,2);if(!x)return;for(var b=h.length/6,w=0;w<x.length;w+=3)d.push(x[w]+b),d.push(x[w]+b),d.push(x[w+1]+b),d.push(x[w+2]+b),d.push(x[w+2]+b);for(var _=0;_<p;_++)h.push(s[2*_],s[2*_+1],v,g,y,m)}t.lineWidth>0&&(0,n.default)(t,e,r)};var n=s(r("FH9r")),i=r("aH6o"),o=s(r("It3W"));function s(t){return t&&t.__esModule?t:{default:t}}},RgHu:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.uploadHookHelper=n.renderer,n.registerFindHook(a),n.registerUploadHook(o),n.registerUploadHook(s),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("k6PJ")).default);function o(t,e){return e instanceof n.BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.textureManager.updateTexture(e),!0)}function s(t,e){return e instanceof n.Graphics&&((e.dirty||e.clearDirty||!e._webGL[t.plugins.graphics.CONTEXT_UID])&&t.plugins.graphics.updateGraphics(e),!0)}function a(t,e){return t instanceof n.Graphics&&(e.push(t),!0)}e.default=i,n.WebGLRenderer.registerPlugin("prepare",i)},RjLg:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=r("aH6o"),s=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,n=arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return o>16384&&(o=16384),o>r&&(o=r),a._properties=[!1,!0,!1,!1,!1],a._maxSize=r,a._batchSize=o,a._glBuffers={},a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=i.BLEND_MODES.NORMAL,a.autoResize=s,a.roundPixels=!0,a.baseTexture=null,a.setProperties(n),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.prototype.renderWebGL=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,r=this.worldTransform,n=!0,i=0,o=0,s=0,a=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var c=this.children[l];if(c.visible){var u=c._texture.frame;if(e.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)==0)n&&(e.setTransform(r.a,r.b,r.c,r.d,r.tx*t.resolution,r.ty*t.resolution),n=!1),i=c.anchor.x*(-u.width*c.scale.x)+c.position.x+.5,o=c.anchor.y*(-u.height*c.scale.y)+c.position.y+.5,s=u.width*c.scale.x,a=u.height*c.scale.y;else{n||(n=!0),c.displayObjectUpdateTransform();var h=c.worldTransform;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution|0,h.ty*t.resolution|0):e.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution,h.ty*t.resolution),i=c.anchor.x*-u.width+.5,o=c.anchor.y*-u.height+.5,s=u.width,a=u.height}var d=c._texture.baseTexture.resolution;e.drawImage(c._texture.baseTexture.source,u.x*d,u.y*d,u.width*d,u.height*d,i*t.resolution,o*t.resolution,s*t.resolution,a*t.resolution)}}}},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._buffers)for(var r=0;r<this._buffers.length;++r)this._buffers[r].destroy();this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},n(e,[{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,(0,o.hex2rgb)(t,this.tintRgb)}}]),e}(i.Container);e.default=s},SBy4:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var s=t.shape,a=s.x,c=s.y,u=s.width,h=s.height,d=s.radius,p=[];if(p.push(a,c+d),l(a,c+h-d,a,c+h,a+d,c+h,p),l(a+u-d,c+h,a+u,c+h,a+u,c+h-d,p),l(a+u,c+d,a+u,c,a+u-d,c,p),l(a+d,c,a,c,a,c+d+1e-10,p),t.fill){for(var f=(0,o.hex2rgb)(t.fillColor),m=t.fillAlpha,v=f[0]*m,g=f[1]*m,y=f[2]*m,x=e.points,b=e.indices,w=x.length/6,_=(0,n.default)(p,null,2),S=0,T=_.length;S<T;S+=3)b.push(_[S]+w),b.push(_[S]+w),b.push(_[S+1]+w),b.push(_[S+2]+w),b.push(_[S+2]+w);for(var M=0,A=p.length;M<A;M++)x.push(p[M],p[++M],v,g,y,m)}if(t.lineWidth){var E=t.points;t.points=p,(0,i.default)(t,e,r),t.points=E}};var n=s(r("It3W")),i=s(r("FH9r")),o=r("aH6o");function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e,r){return t+(e-t)*r}function l(t,e,r,n,i,o){for(var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0;f<=20;++f)l=a(t,r,m=f/20),c=a(e,n,m),u=a(r,i,m),h=a(n,o,m),d=a(l,u,m),p=a(c,h,m),s.push(d,p);return s}},SJFm:function(t,e){t.exports=function(t,e,r){return t.on(e,r),{destroy:function(){t.removeListener(e,r)}}}},SMx8:function(t,e,r){"use strict";var n=r("j0z+").default,i=r("66C6").default,o=r("umD3"),s=r("7VTH");n.Resource=i,n.async=o,n.base64=s,t.exports=n,t.exports.default=n},SdIY:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.global=new i.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return t.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},t.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},n(t,[{key:"pointerId",get:function(){return this.identifier}}]),t}();e.default=o},"Si/7":function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){for(var t=[],e=[],r=0;r<32;r++)t[r]=r,e[r]=r;t[n.BLEND_MODES.NORMAL_NPM]=n.BLEND_MODES.NORMAL,t[n.BLEND_MODES.ADD_NPM]=n.BLEND_MODES.ADD,t[n.BLEND_MODES.SCREEN_NPM]=n.BLEND_MODES.SCREEN,e[n.BLEND_MODES.NORMAL]=n.BLEND_MODES.NORMAL_NPM,e[n.BLEND_MODES.ADD]=n.BLEND_MODES.ADD_NPM,e[n.BLEND_MODES.SCREEN]=n.BLEND_MODES.SCREEN_NPM;var i=[];return i.push(e),i.push(t),i};var n=r("FjAT")},Sst2:function(t,e,r){var n,i,o;!function(r){var s=/iPhone/i,a=/iPod/i,l=/iPad/i,c=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,u=/Android/i,h=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,m=/BlackBerry/i,v=/BB10/i,g=/Opera Mini/i,y=/(CriOS|Chrome)(?=.*\bMobile\b)/i,x=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),w=function(t,e){return t.test(e)},_=function(t){var e=t||navigator.userAgent,r=e.split("[FBAN");if("undefined"!=typeof r[1]&&(e=r[0]),"undefined"!=typeof(r=e.split("Twitter"))[1]&&(e=r[0]),this.apple={phone:w(s,e),ipod:w(a,e),tablet:!w(s,e)&&w(l,e),device:w(s,e)||w(a,e)||w(l,e)},this.amazon={phone:w(h,e),tablet:!w(h,e)&&w(d,e),device:w(h,e)||w(d,e)},this.android={phone:w(h,e)||w(c,e),tablet:!w(h,e)&&!w(c,e)&&(w(d,e)||w(u,e)),device:w(h,e)||w(d,e)||w(c,e)||w(u,e)},this.windows={phone:w(p,e),tablet:w(f,e),device:w(p,e)||w(f,e)},this.other={blackberry:w(m,e),blackberry10:w(v,e),opera:w(g,e),firefox:w(x,e),chrome:w(y,e),device:w(m,e)||w(v,e)||w(g,e)||w(x,e)||w(y,e)},this.seven_inch=w(b,e),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var t=new _;return t.Class=_,t};"undefined"!=typeof t&&t.exports&&"undefined"==typeof window?t.exports=_:"undefined"!=typeof t&&t.exports&&"undefined"!=typeof window?t.exports=S():(i=[],n=r.isMobile=S(),void 0===(o="function"==typeof n?n.apply(e,i):n)||(t.exports=o))}(this)},Tff0:function(t,e){t.exports=function(t,e,r){var n=t.byteLength;if(e=e||0,r=r||n,t.slice)return t.slice(e,r);if(e<0&&(e+=n),r<0&&(r+=n),r>n&&(r=n),e>=n||e>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(t),o=new Uint8Array(r-e),s=e,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},TlGl:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=a(r("+DNt")),o=a(r("s4oU")),s=r("aH6o");function a(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return i.shader=null,i.indexBuffer=null,i.properties=null,i.tempMatrix=new n.Matrix,i.CONTEXT_UID=0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){var t=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new i.default(t),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},e.prototype.start=function(){this.renderer.bindShader(this.shader)},e.prototype.render=function(t){var e=t.children,r=t._maxSize,i=t._batchSize,o=this.renderer,s=e.length;if(0!==s){s>r&&(s=r);var a=t._glBuffers[o.CONTEXT_UID];a||(a=t._glBuffers[o.CONTEXT_UID]=this.generateBuffers(t));var l=e[0]._texture.baseTexture;this.renderer.setBlendMode(n.utils.correctBlendMode(t.blendMode,l.premultipliedAlpha));var c=o.gl,u=t.worldTransform.copy(this.tempMatrix);u.prepend(o._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=u.toArray(!0),this.shader.uniforms.uColor=n.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,l.premultipliedAlpha),this.shader.uniforms.uSampler=o.bindTexture(l);for(var h=!1,d=0,p=0;d<s;d+=i,p+=1){var f=s-d;if(f>i&&(f=i),p>=a.length){if(!t.autoResize)break;a.push(this._generateOneMoreBuffer(t))}var m=a[p];m.uploadDynamic(e,d,f),(h=h||m._updateID<(t._bufferUpdateIDs[d]||0))&&(m._updateID=t._updateID,m.uploadStatic(e,d,f)),o.bindVao(m.vao),m.vao.draw(c.TRIANGLES,6*f)}}},e.prototype.generateBuffers=function(t){for(var e=this.renderer.gl,r=[],n=t._maxSize,i=t._batchSize,s=t._properties,a=0;a<n;a+=i)r.push(new o.default(e,this.properties,s,i));return r},e.prototype._generateOneMoreBuffer=function(t){return new o.default(this.renderer.gl,this.properties,t._properties,t._batchSize)},e.prototype.uploadVertices=function(t,e,r,n,i,o){for(var s=0,a=0,l=0,c=0,u=0;u<r;++u){var h=t[e+u],d=h._texture,p=h.scale.x,f=h.scale.y,m=d.trim,v=d.orig;m?(s=(a=m.x-h.anchor.x*v.width)+m.width,l=(c=m.y-h.anchor.y*v.height)+m.height):(s=v.width*(1-h.anchor.x),a=v.width*-h.anchor.x,l=v.height*(1-h.anchor.y),c=v.height*-h.anchor.y),n[o]=a*p,n[o+1]=c*f,n[o+i]=s*p,n[o+i+1]=c*f,n[o+2*i]=s*p,n[o+2*i+1]=l*f,n[o+3*i]=a*p,n[o+3*i+1]=l*f,o+=4*i}},e.prototype.uploadPosition=function(t,e,r,n,i,o){for(var s=0;s<r;s++){var a=t[e+s].position;n[o]=a.x,n[o+1]=a.y,n[o+i]=a.x,n[o+i+1]=a.y,n[o+2*i]=a.x,n[o+2*i+1]=a.y,n[o+3*i]=a.x,n[o+3*i+1]=a.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,r,n,i,o){for(var s=0;s<r;s++){var a=t[e+s].rotation;n[o]=a,n[o+i]=a,n[o+2*i]=a,n[o+3*i]=a,o+=4*i}},e.prototype.uploadUvs=function(t,e,r,n,i,o){for(var s=0;s<r;++s){var a=t[e+s]._texture._uvs;a?(n[o]=a.x0,n[o+1]=a.y0,n[o+i]=a.x1,n[o+i+1]=a.y1,n[o+2*i]=a.x2,n[o+2*i+1]=a.y2,n[o+3*i]=a.x3,n[o+3*i+1]=a.y3,o+=4*i):(n[o]=0,n[o+1]=0,n[o+i]=0,n[o+i+1]=0,n[o+2*i]=0,n[o+2*i+1]=0,n[o+3*i]=0,n[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,r,n,i,o){for(var a=0;a<r;++a){var l=t[e+a],c=l.alpha,u=c<1&&l._texture.baseTexture.premultipliedAlpha?(0,s.premultiplyTint)(l._tintRGB,c):l._tintRGB+(255*c<<24);n[o]=u,n[o+i]=u,n[o+2*i]=u,n[o+3*i]=u,o+=4*i}},e.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),t.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},e}(n.ObjectRenderer);e.default=l,n.WebGLRenderer.registerPlugin("particle",l)},Twrw:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("8QNu")),i=function(){function t(e,r,i){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=n.default.GLBuffer.createVertexBuffer(e),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(e),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=r,this.vao=new n.default.VertexArrayObject(e,i).addIndex(this.indexBuffer).addAttribute(this.buffer,r.attributes.aVertexPosition,e.FLOAT,!1,24,0).addAttribute(this.buffer,r.attributes.aColor,e.FLOAT,!1,24,8)}return t.prototype.reset=function(){this.points.length=0,this.indices.length=0},t.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},t.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},t}();e.default=i},U7Sr:function(t,e,r){var n=r("Q+pJ"),i=function(t,e,r){this.gl=t,this.framebuffer=t.createFramebuffer(),this.stencil=null,this.texture=null,this.width=e||100,this.height=r||100};i.prototype.enableTexture=function(t){var e=this.gl;this.texture=t||new n(e),this.texture.bind(),this.bind(),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0)},i.prototype.enableStencil=function(){if(!this.stencil){var t=this.gl;this.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencil),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height)}},i.prototype.clear=function(t,e,r,n){this.bind();var i=this.gl;i.clearColor(t,e,r,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},i.prototype.bind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},i.prototype.resize=function(t,e){var r=this.gl;this.width=t,this.height=e,this.texture&&this.texture.uploadData(null,t,e),this.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,this.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,e))},i.prototype.destroy=function(){var t=this.gl;this.texture&&this.texture.destroy(),t.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},i.createRGBA=function(t,e,r,o){var s=n.fromData(t,null,e,r);s.enableNearestScaling(),s.enableWrapClamp();var a=new i(t,e,r);return a.enableTexture(s),a.unbind(),a},i.createFloat32=function(t,e,r,o){var s=new n.fromData(t,o,e,r);s.enableNearestScaling(),s.enableWrapClamp();var a=new i(t,e,r);return a.enableTexture(s),a.unbind(),a},t.exports=i},UEsV:function(t,e,r){"use strict";e.a=function(t){return i=t,o};var n=r("hfO1");let i;function o(){try{return i.apply(this,arguments)}catch(t){return n.a.e=t,n.a}}},UZ14:function(t,e,r){(function(e){t.exports=function(t){return r&&e.Buffer.isBuffer(t)||n&&(t instanceof e.ArrayBuffer||i(t))};var r="function"==typeof e.Buffer&&"function"==typeof e.Buffer.isBuffer,n="function"==typeof e.ArrayBuffer,i=n&&"function"==typeof e.ArrayBuffer.isView?e.ArrayBuffer.isView:function(t){return t.buffer instanceof e.ArrayBuffer}}).call(e,r("DuR2"))},UZ5h:function(t,e,r){"use strict";var n=r("MsCo"),i=r("qOJP");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=x,e.resolve=function(t,e){return x(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?x(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=x(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r("1nuA");function x(t,e,r){if(t&&i.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,r),n}o.prototype.parse=function(t,e,r){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var x=t=c.join(a);if(x=x.trim(),!r&&1===t.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=s.exec(x);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,x=x.substr(w.length)}if(r||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===x.substr(0,2);!S||w&&v[w]||(x=x.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!g[w])){for(var T,M,A=-1,E=0;E<d.length;E++)-1!==(C=x.indexOf(d[E]))&&(-1===A||C<A)&&(A=C);for(-1!==(M=-1===A?x.lastIndexOf("@"):x.lastIndexOf("@",A))&&(T=x.slice(0,M),x=x.slice(M+1),this.auth=decodeURIComponent(T)),A=-1,E=0;E<h.length;E++){var C;-1!==(C=x.indexOf(h[E]))&&(-1===A||C<A)&&(A=C)}-1===A&&(A=x.length),this.host=x.slice(0,A),x=x.slice(A),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var O=this.hostname.split(/\./),N=(E=0,O.length);E<N;E++){var L=O[E];if(L&&!L.match(p)){for(var I="",R=0,D=L.length;R<D;R++)L.charCodeAt(R)>127?I+="x":I+=L[R];if(!I.match(p)){var F=O.slice(0,E),k=O.slice(E+1),U=L.match(f);U&&(F.push(U[1]),k.unshift(U[2])),k.length&&(x="/"+k.join(".")+x),this.hostname=F.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"";this.host=(this.hostname||"")+B,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[_])for(E=0,N=u.length;E<N;E++){var j=u[E];if(-1!==x.indexOf(j)){var z=encodeURIComponent(j);z===j&&(z=escape(j)),x=x.split(j).join(z)}}var V=x.indexOf("#");-1!==V&&(this.hash=x.substr(V),x=x.slice(0,V));var G=x.indexOf("?");return-1!==G?(this.search=x.substr(G),this.query=x.substr(G+1),e&&(this.query=y.parse(this.query)),x=x.slice(0,G)):e&&(this.search="",this.query={}),x&&(this.pathname=x),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(B=this.pathname||"")+(this.search||"")),this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=y.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(x(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(r[u]=t[u])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!g[t.protocol]){for(var h=Object.keys(t),d=0;d<h.length;d++){var p=h[d];r[p]=t[p]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||v[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}return r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,(r.pathname||r.search)&&(r.path=(r.pathname||"")+(r.search||"")),r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=y||m||r.host&&t.pathname,b=x,w=r.pathname&&r.pathname.split("/")||[],_=(f=t.pathname&&t.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(_&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),x=x&&(""===f[0]||""===w[0])),y)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),r.search=t.search,r.query=t.query;else if(!i.isNullOrUndefined(t.search))return _&&(r.hostname=r.host=w.shift(),(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.host=r.hostname=E.shift())),r.search=t.search,r.query=t.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!w.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var S=w.slice(-1)[0],T=(r.host||t.host||w.length>1)&&("."===S||".."===S)||""===S,M=0,A=w.length;A>=0;A--)"."===(S=w[A])?w.splice(A,1):".."===S?(w.splice(A,1),M++):M&&(w.splice(A,1),M--);if(!x&&!b)for(;M--;M)w.unshift("..");!x||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var E,C=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(r.hostname=r.host=C?"":w.length?w.shift():"",(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.host=r.hostname=E.shift())),(x=x||r.host&&w.length)&&!C&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},UsJC:function(t,e,r){"use strict";e.__esModule=!0;var n=r("FjAT"),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.pushMask=function(t){var e=this.renderer;e.context.save();var r=t.alpha,n=t.transform.worldTransform,i=e.resolution;e.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),t._texture||(this.renderGraphicsShape(t),e.context.clip()),t.worldAlpha=r},t.prototype.renderGraphicsShape=function(t){var e=this.renderer.context,r=t.graphicsData.length;if(0!==r){e.beginPath();for(var i=0;i<r;i++){var o=t.graphicsData[i],s=o.shape;if(o.type===n.SHAPES.POLY){var a=s.points;e.moveTo(a[0],a[1]);for(var l=1;l<a.length/2;l++)e.lineTo(a[2*l],a[2*l+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(o.type===n.SHAPES.RECT)e.rect(s.x,s.y,s.width,s.height),e.closePath();else if(o.type===n.SHAPES.CIRC)e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath();else if(o.type===n.SHAPES.ELIP){var c=2*s.width,u=2*s.height,h=s.x-c/2,d=s.y-u/2,p=c/2*.5522848,f=u/2*.5522848,m=h+c,v=d+u,g=h+c/2,y=d+u/2;e.moveTo(h,y),e.bezierCurveTo(h,y-f,g-p,d,g,d),e.bezierCurveTo(g+p,d,m,y-f,m,y),e.bezierCurveTo(m,y+f,g+p,v,g,v),e.bezierCurveTo(g-p,v,h,y+f,h,y),e.closePath()}else if(o.type===n.SHAPES.RREC){var x=s.x,b=s.y,w=s.width,_=s.height,S=s.radius,T=Math.min(w,_)/2|0;e.moveTo(x,b+(S=S>T?T:S)),e.lineTo(x,b+_-S),e.quadraticCurveTo(x,b+_,x+S,b+_),e.lineTo(x+w-S,b+_),e.quadraticCurveTo(x+w,b+_,x+w,b+_-S),e.lineTo(x+w,b+S),e.quadraticCurveTo(x+w,b,x+w-S,b),e.lineTo(x+S,b),e.quadraticCurveTo(x,b,x,b+S),e.closePath()}}}},t.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},t.prototype.destroy=function(){},t}();e.default=i},UxPA:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("FjAT"),o=r("aH6o"),s={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:i.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,wordWrap:!1,wordWrapWidth:100,leading:0},a=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.styleID=0,this.reset(),u(this,e,e)}return t.prototype.clone=function(){var e={};return u(e,this,s),new t(e)},t.prototype.reset=function(){u(this,s,s)},t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var n=e[r].trim();/([\"\'])[^\'\"]+\1/.test(n)||(n='"'+n+'"'),e[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},n(t,[{key:"align",get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(t){var e=c(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(t){var e=c(t);this._fill!==e&&(this._fill=e,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(t){var e=c(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}}]),t}();function l(t){return"number"==typeof t?(0,o.hex2string)(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function c(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=l(t[e]);return t}return l(t)}function u(t,e,r){for(var n in r)t[n]=Array.isArray(e[n])?e[n].slice():e[n]}e.default=a},V0yo:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("gQZj")),i=r("FjAT"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.width=n,this.height=o,this.type=i.SHAPES.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,n=(e-this.y)/this.height;return(r*=r)+(n*=n)<=1},t.prototype.getBounds=function(){return new n.default(this.x-this.width,this.y-this.height,this.width,this.height)},t}();e.default=o},V1mL:function(t,e,r){(function(e){var n=r("fOB9"),i=r("Fy0/")("socket.io-client:url");t.exports=function(t,r){var o=t;r=r||e.location,null==t&&(t=r.protocol+"//"+r.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?r.protocol+t:r.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof r?r.protocol+"//"+t:"https://"+t),i("parse %s",t),o=n(t)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var s=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+s+":"+o.port,o.href=o.protocol+"://"+s+(r&&r.port===o.port?"":":"+o.port),o}}).call(e,r("DuR2"))},V2zk:function(t,e,r){"use strict";e.a=function(t,e){return function(r){let i;if(i="function"==typeof t?t:function(){return t},"function"==typeof e)return r.lift(new class{constructor(t,e){this.subjectFactory=t,this.selector=e}call(t,e){const{selector:r}=this,n=this.subjectFactory(),i=r(n).subscribe(t);return i.add(e.subscribe(n)),i}}(i,e));const o=Object.create(r,n.a);return o.source=r,o.subjectFactory=i,o}};var n=r("9y/k")},VWTR:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("HVUN")),i=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],o=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],s=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],a=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],l=[],c=[];function u(t){return t<0?-1:t>0?1:0}!function(){for(var t=0;t<16;t++){var e=[];c.push(e);for(var r=0;r<16;r++)for(var h=u(i[t]*i[r]+s[t]*o[r]),d=u(o[t]*i[r]+a[t]*o[r]),p=u(i[t]*s[r]+s[t]*a[r]),f=u(o[t]*s[r]+a[t]*a[r]),m=0;m<16;m++)if(i[m]===h&&o[m]===d&&s[m]===p&&a[m]===f){e.push(m);break}}for(var v=0;v<16;v++){var g=new n.default;g.set(i[v],o[v],s[v],a[v],0,0),l.push(g)}}();var h={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(t){return i[t]},uY:function(t){return o[t]},vX:function(t){return s[t]},vY:function(t){return a[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return c[t][e]},sub:function(t,e){return c[t][h.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?h.S:h.N:2*Math.abs(e)<=Math.abs(t)?t>0?h.E:h.W:e>0?t>0?h.SE:h.SW:t>0?h.NE:h.NW},matrixAppendRotationInv:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=l[h.inv(e)];i.tx=r,i.ty=n,t.append(i)}};e.default=h},"W/Sc":function(t,e,r){"use strict";var n=r("ves3"),i=r("2zkT"),o=r("s+UU"),s=r("7nan"),a=r("Exya"),l=r("73T8");class c extends i.a{constructor(t){super(t),this.destination=t}}e.c=c;class u extends n.a{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[l.a](){return new c(this)}lift(t){const e=new h(this,this);return e.operator=t,e}next(t){if(this.closed)throw new s.a;if(!this.isStopped){const{observers:e}=this,r=e.length,n=e.slice();for(let i=0;i<r;i++)n[i].next(t)}}error(t){if(this.closed)throw new s.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,r=e.length,n=e.slice();for(let i=0;i<r;i++)n[i].error(t);this.observers.length=0}complete(){if(this.closed)throw new s.a;this.isStopped=!0;const{observers:t}=this,e=t.length,r=t.slice();for(let n=0;n<e;n++)r[n].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new s.a;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new s.a;return this.hasError?(t.error(this.thrownError),o.a.EMPTY):this.isStopped?(t.complete(),o.a.EMPTY):(this.observers.push(t),new a.a(this,t))}asObservable(){const t=new n.a;return t.source=this,t}}e.b=u,u.create=((t,e)=>new h(t,e));class h extends u{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):o.a.EMPTY}}e.a=h},W1MY:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("Q5/2"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.position=new i.Point(0,0),r.scale=new i.Point(1,1),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r.pivot=new i.Point(0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},e.prototype.updateLocalTransform=function(){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d)},e.prototype.updateTransform=function(t){var e=this.localTransform;e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d);var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._worldID++},e.prototype.setFromMatrix=function(t){t.decompose(this)},n(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("mAOr")).default);e.default=o},W2nU:function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var t=a(d);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},WFWZ:function(t,e,r){"use strict";e.a=function(t){return"function"==typeof t}},Wi38:function(t,e,r){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(r("BEQ0"));Object.assign||(Object.assign=n.default)},Wj7o:function(t,e){t.exports=function(t,e){for(var r=t[0],n=t[1],i=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o][0],l=e[o][1],c=e[s][1];l>n!=c>n&&r<(e[s][0]-a)*(n-l)/(c-l)+a&&(i=!i)}return i}},XLJA:function(t,e,r){"use strict";e.a=function(t,e,r=Number.POSITIVE_INFINITY){return function(o){return"number"==typeof e&&(r=e,e=null),o.lift(new class{constructor(t,e,r=Number.POSITIVE_INFINITY){this.project=t,this.resultSelector=e,this.concurrent=r}call(t,e){return e.subscribe(new class extends i.a{constructor(t,e,r,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.resultSelector=r,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,r)}_innerSub(t,e,r){this.add(Object(n.a)(this,t,e,r))}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()}notifyNext(t,e,r,n,i){this.resultSelector?this._notifyResultSelector(t,e,r,n):this.destination.next(e)}_notifyResultSelector(t,e,r,n){let i;try{i=this.resultSelector(t,e,r,n)}catch(t){return void this.destination.error(t)}this.destination.next(i)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}(t,this.project,this.resultSelector,this.concurrent))}}(t,e,r))}};var n=r("73El"),i=r("JEOp")},XVqe:function(t,e,r){"use strict";var n=r("ves3");class i extends n.a{constructor(t){super(),this.scheduler=t}static create(t){return new i(t)}static dispatch(t){const{subscriber:e}=t;e.complete()}_subscribe(t){const e=this.scheduler;if(e)return e.schedule(i.dispatch,0,{subscriber:t});t.complete()}}e.a=i},XjEo:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=a(r("e3qs")),s=a(r("qLff"));function a(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(r,n,a,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return c.blurXFilter=new o.default(r,n,a,l),c.blurYFilter=new s.default(r,n,a,l),c.padding=0,c.resolution=a||i.settings.RESOLUTION,c.quality=n||4,c.blur=r||8,c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){var n=t.getRenderTarget(!0);this.blurXFilter.apply(t,e,n,!0),this.blurYFilter.apply(t,n,r,!1),t.returnRenderTarget(n)},n(e,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(t){this.blurYFilter._blendMode=t}}]),e}(i.Filter);e.default=l},XkNl:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=s(r("8QNu")),o=s(r("kpDK"));function s(t){return t&&t.__esModule?t:{default:t}}r("o/zv");var a=n.Matrix.IDENTITY,l=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.shader=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onContextChange=function(){this.shader=new n.Shader(this.renderer.gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},e.prototype.render=function(t){var e=this.renderer,r=e.gl,s=t._texture;if(s.valid){var l=t._glDatas[e.CONTEXT_UID];l||(e.bindVao(null),(l={shader:this.shader,vertexBuffer:i.default.GLBuffer.createVertexBuffer(r,t.vertices,r.STREAM_DRAW),uvBuffer:i.default.GLBuffer.createVertexBuffer(r,t.uvs,r.STREAM_DRAW),indexBuffer:i.default.GLBuffer.createIndexBuffer(r,t.indices,r.STATIC_DRAW),vao:null,dirty:t.dirty,indexDirty:t.indexDirty}).vao=new i.default.VertexArrayObject(r).addIndex(l.indexBuffer).addAttribute(l.vertexBuffer,l.shader.attributes.aVertexPosition,r.FLOAT,!1,8,0).addAttribute(l.uvBuffer,l.shader.attributes.aTextureCoord,r.FLOAT,!1,8,0),t._glDatas[e.CONTEXT_UID]=l),e.bindVao(l.vao),t.dirty!==l.dirty&&(l.dirty=t.dirty,l.uvBuffer.upload(t.uvs)),t.indexDirty!==l.indexDirty&&(l.indexDirty=t.indexDirty,l.indexBuffer.upload(t.indices)),l.vertexBuffer.upload(t.vertices),e.bindShader(l.shader),l.shader.uniforms.uSampler=e.bindTexture(s),e.state.setBlendMode(n.utils.correctBlendMode(t.blendMode,s.baseTexture.premultipliedAlpha)),l.shader.uniforms.uTransform&&(l.shader.uniforms.uTransform=t.uploadUvTransform?t._uvTransform.mapCoord.toArray(!0):a.toArray(!0)),l.shader.uniforms.translationMatrix=t.worldTransform.toArray(!0),l.shader.uniforms.uColor=n.utils.premultiplyRgba(t.tintRgb,t.worldAlpha,l.shader.uniforms.uColor,s.baseTexture.premultipliedAlpha),l.vao.draw(t.drawMode===o.default.DRAW_MODES.TRIANGLE_MESH?r.TRIANGLE_STRIP:r.TRIANGLES,t.indices.length,0)}},e}(n.ObjectRenderer);e.default=l,n.WebGLRenderer.registerPlugin("mesh",l)},Xqxu:function(t,e,r){(function(e){var n=r("Y+et"),i=r("pnVU"),o=r("Fy0/")("engine.io-client:socket"),s=r("Csua"),a=r("ElvI"),l=r("fOB9"),c=r("gVZZ");function u(t,r){if(!(this instanceof u))return new u(t,r);r=r||{},t&&"object"==typeof t&&(r=t,t=null),t?(t=l(t),r.hostname=t.host,r.secure="https"===t.protocol||"wss"===t.protocol,r.port=t.port,t.query&&(r.query=t.query)):r.host&&(r.hostname=l(r.host).host),this.secure=null!=r.secure?r.secure:e.location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.agent=r.agent||!1,this.hostname=r.hostname||(e.location?location.hostname:"localhost"),this.port=r.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=r.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==r.upgrade,this.path=(r.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!r.forceJSONP,this.jsonp=!1!==r.jsonp,this.forceBase64=!!r.forceBase64,this.enablesXDR=!!r.enablesXDR,this.timestampParam=r.timestampParam||"t",this.timestampRequests=r.timestampRequests,this.transports=r.transports||["polling","websocket"],this.transportOptions=r.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=r.policyPort||843,this.rememberUpgrade=r.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=r.onlyBinaryUpgrades,this.perMessageDeflate=!1!==r.perMessageDeflate&&(r.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=r.pfx||null,this.key=r.key||null,this.passphrase=r.passphrase||null,this.cert=r.cert||null,this.ca=r.ca||null,this.ciphers=r.ciphers||null,this.rejectUnauthorized=void 0===r.rejectUnauthorized||r.rejectUnauthorized,this.forceNode=!!r.forceNode;var n="object"==typeof e&&e;n.global===n&&(r.extraHeaders&&Object.keys(r.extraHeaders).length>0&&(this.extraHeaders=r.extraHeaders),r.localAddress&&(this.localAddress=r.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=u,u.priorWebsocketSuccess=!1,i(u.prototype),u.protocol=a.protocol,u.Socket=u,u.Transport=r("ZOjo"),u.transports=r("Y+et"),u.parser=r("ElvI"),u.prototype.createTransport=function(t){o('creating transport "%s"',t);var e=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}(this.query);e.EIO=a.protocol,e.transport=t;var r=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new n[t]({query:e,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},u.prototype.open=function(){var t;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},u.prototype.setTransport=function(t){o("setting transport %s",t.name);var e=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},u.prototype.probe=function(t){o('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),r=!1,n=this;function i(){n.onlyBinaryUpgrades&&(r=r||!this.supportsBinary&&n.transport.supportsBinary),r||(o('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;u.priorWebsocketSuccess="websocket"===e.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),d(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=e.name,n.emit("upgradeError",s)}}))}function s(){r||(r=!0,d(),e.close(),e=null)}function a(r){var i=new Error("probe error: "+r);i.transport=e.name,s(),o('probe transport "%s" failed because of error: %s',t,r),n.emit("upgradeError",i)}function l(){a("transport closed")}function c(){a("socket closed")}function h(t){e&&t.name!==e.name&&(o('"%s" works - aborting "%s"',t.name,e.name),s())}function d(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",l),n.removeListener("close",c),n.removeListener("upgrading",h)}u.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",a),e.once("close",l),this.once("close",c),this.once("upgrading",h),e.open()},u.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},u.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else o('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},u.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},u.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(t,e,r){return this.sendPacket("message",t,e,r),this},u.prototype.sendPacket=function(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}function e(){t.onClose("forced close"),o("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this},u.prototype.onError=function(t){o("socket error %j",t),u.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},u.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(o('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},u.prototype.filterUpgrades=function(t){for(var e=[],r=0,n=t.length;r<n;r++)~s(this.transports,t[r])&&e.push(t[r]);return e}}).call(e,r("DuR2"))},Xz3Q:function(t,e,r){var n=r("Fy0/")("socket.io-parser"),i=r("pnVU"),o=r("QHw4"),s=r("sOR5"),a=r("UZ14");function l(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=l,e.Decoder=h;var c=e.ERROR+'"encode error"';function u(t){var r=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return c;r+=i}return n("encoded %j as %s",t,r),r}function h(){this.reconstructor=null}function d(t){this.reconPack=t,this.buffers=[]}function p(t){return{type:e.ERROR,data:"parser error: "+t}}l.prototype.encode=function(t,r){n("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){o.removeBlobs(t,function(t){var r=o.deconstructPacket(t),n=u(r.packet),i=r.buffers;i.unshift(n),e(i)})}(t,r):r([u(t)])},i(h.prototype),h.prototype.add=function(t){var r;if("string"==typeof t)r=function(t){var r=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return p("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var o="";"-"!==t.charAt(++r)&&(o+=t.charAt(r),r!=t.length););if(o!=Number(o)||"-"!==t.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===t.charAt(r+1))for(i.nsp="";++r&&","!==(l=t.charAt(r))&&(i.nsp+=l,r!==t.length););else i.nsp="/";var a=t.charAt(r+1);if(""!==a&&Number(a)==a){for(i.id="";++r;){var l;if(null==(l=t.charAt(r))||Number(l)!=l){--r;break}if(i.id+=t.charAt(r),r===t.length)break}i.id=Number(i.id)}if(t.charAt(++r)){var c=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(r));if(!1===c||i.type!==e.ERROR&&!s(c))return p("invalid payload");i.data=c}return n("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?(this.reconstructor=new d(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!a(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},"Y+et":function(t,e,r){(function(t){var n=r("P2cu"),i=r("nXuP"),o=r("ZEn9"),s=r("cwTZ");e.polling=function(e){var r=!1,s=!1,a=!1!==e.jsonp;if(t.location){var l="https:"===location.protocol,c=location.port;c||(c=l?443:80),r=e.hostname!==location.hostname||c!==e.port,s=e.secure!==l}if(e.xdomain=r,e.xscheme=s,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!a)throw new Error("JSONP disabled");return new o(e)},e.websocket=s}).call(e,r("DuR2"))},YTpx:function(t,e,r){"use strict";function n(t,e){if(t&&e)for(var r=Object.keys(e),n=0;n<r.length;++n){var i=r[n];Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}}e.__esModule=!0,e.mixin=n,e.delayMixin=function(t,e){i.push(t,e)},e.performMixins=function(){for(var t=0;t<i.length;t+=2)n(i[t],i[t+1]);i.length=0};var i=[]},YUmt:function(t,e){function r(){}t.exports=function(t,e,n){var i=!1;return n=n||r,o.count=t,0===t?e():o;function o(t,r){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=n):0!==o.count||i||e(null,r)}}},Ydo6:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));r("o/zv");var o=function(t){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return i.noise=r,i.seed=n,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t}}]),e}(i.Filter);e.default=o},YdyU:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=c(r("8USZ")),o=r("aH6o"),s=r("z1Av"),a=r("FjAT"),l=c(r("h9yw"));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(r,n){if(function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),!r)throw new Error("No video source element specified.");(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,n));return i.width=r.videoWidth,i.height=r.videoHeight,i._autoUpdate=!0,i._isAutoUpdating=!1,i.autoPlay=!0,i.update=i.update.bind(i),i._onCanPlay=i._onCanPlay.bind(i),r.addEventListener("play",i._onPlayStart.bind(i)),r.addEventListener("pause",i._onPlayStop.bind(i)),i.hasLoaded=!1,i.__loaded=!1,i._isSourceReady()?i._onCanPlay():(r.addEventListener("canplay",i._onCanPlay),r.addEventListener("canplaythrough",i._onCanPlay)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(s.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(s.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},e.prototype.destroy=function(){this._isAutoUpdating&&s.shared.remove(this.update,this),this.source&&this.source._pixiId&&(i.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),t.prototype.destroy.call(this)},e.fromVideo=function(t,r){t._pixiId||(t._pixiId="video_"+(0,o.uid)());var n=o.BaseTextureCache[t._pixiId];return n||(n=new e(t,r),i.default.addToCache(n,t._pixiId)),n},e.fromUrl=function(t,r,n){var i=document.createElement("video");i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","");var o=Array.isArray(t)?t[0].src||t[0]:t.src||t;if(void 0===n&&0!==o.indexOf("data:")?i.crossOrigin=(0,l.default)(o):n&&(i.crossOrigin="string"==typeof n?n:"anonymous"),Array.isArray(t))for(var s=0;s<t.length;++s)i.appendChild(h(t[s].src||t[s],t[s].mime));else i.appendChild(h(o,t.mime));return i.load(),e.fromVideo(i,r)},n(e,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(s.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(s.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),e}(i.default);function h(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=t,r.type=e,r}e.default=u,u.fromUrls=u.fromUrl},Ynfn:function(t,e,r){"use strict";e.a=function(t=Number.POSITIVE_INFINITY){return Object(n.a)(i.a,null,t)};var n=r("XLJA"),i=r("Jh97")},Z1wJ:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e,r,n,i,o,s,a,l){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.lineWidth=e,this.nativeLines=a,this.lineColor=r,this.lineAlpha=n,this._lineTint=r,this.fillColor=i,this.fillAlpha=o,this._fillTint=i,this.fill=s,this.holes=[],this.shape=l,this.type=l.type}return t.prototype.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)},t.prototype.addHole=function(t){this.holes.push(t)},t.prototype.destroy=function(){this.shape=null,this.holes=null},t}();e.default=n},Z7et:function(t,e,r){var n=r("Ml+6");Sky=function(){var t=Sky.SkyShader,e=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:n.UniformsUtils.clone(t.uniforms),side:n.BackSide});n.Mesh.call(this,new n.SphereBufferGeometry(1,32,15),e)},Sky.prototype=Object.create(n.Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},t.exports=Sky},ZEn9:function(t,e,r){(function(e){var n=r("5+9/"),i=r("QamB");t.exports=c;var o,s=/\n/g,a=/\\n/g;function l(){}function c(t){n.call(this,t),this.query=this.query||{},o||(e.___eio||(e.___eio=[]),o=e.___eio),this.index=o.length;var r=this;o.push(function(t){r.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){r.script&&(r.script.onerror=l)},!1)}i(c,n),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},c.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},c.prototype.doWrite=function(t,e){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=l,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function c(){u(),e()}function u(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{n=document.createElement('<iframe src="javascript:0" name="'+r.iframeId+'">')}catch(t){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),u(),t=t.replace(a,"\\\n"),this.area.value=t.replace(s,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&c()}:this.iframe.onload=c}}).call(e,r("DuR2"))},ZOjo:function(t,e,r){var n=r("ElvI"),i=r("pnVU");function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=o,i(o.prototype),o.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit("packet",t)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},ZSfh:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},aH6o:function(t,e,r){"use strict";e.__esModule=!0,e.premultiplyBlendMode=e.BaseTextureCache=e.TextureCache=e.earcut=e.mixins=e.pluginTarget=e.EventEmitter=e.removeItems=e.isMobile=void 0,e.uid=function(){return++f},e.hex2rgb=function(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},e.hex2string=function(t){return t=t.toString(16),"#"+("000000".substr(0,6-t.length)+t)},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)},e.getResolutionOfUrl=function(t,e){var r=i.default.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1},e.decomposeDataUri=function(t){var e=n.DATA_URI.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,encoding:e[3]?e[3].toLowerCase():void 0,data:e[4]}},e.getUrlFileExtension=function(t){var e=n.URL_FILE_EXTENSION.exec(t);if(e)return e[1].toLowerCase()},e.getSvgSize=function(t){var e=n.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r},e.skipHello=function(){m=!0},e.sayHello=function(t){m||(navigator.userAgent.toLowerCase().indexOf("chrome")>-1?window.console.log.apply(console,["\n %c %c %c PixiJS "+n.VERSION+" - \u2730 "+t+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS "+n.VERSION+" - "+t+" - http://www.pixijs.com/"),m=!0)},e.isWebGLSupported=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!(!r||!r.getContextAttributes().stencil);if(r){var i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,n}catch(t){return!1}},e.sign=function(t){return 0===t?0:t<0?-1:1},e.destroyTextureCache=function(){var t=void 0;for(t in v)v[t].destroy();for(t in g)g[t].destroy()},e.clearTextureCache=function(){var t=void 0;for(t in v)delete v[t];for(t in g)delete g[t]},e.correctBlendMode=function(t,e){return y[e?1:0][t]},e.premultiplyTint=function(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,n=t>>8&255;return(255*e<<24)+((r=r*e+.5|0)<<16)+((n=n*e+.5|0)<<8)+((255&t)*e+.5|0)},e.premultiplyRgba=function(t,e,r,n){return r=r||new Float32Array(4),n||void 0===n?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r},e.premultiplyTintToRgba=function(t,e,r,n){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(n||void 0===n)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r};var n=r("FjAT"),i=p(r("/MUw")),o=p(r("BzvE")),s=p(r("JdRN")),a=d(r("YTpx")),l=d(r("Sst2")),c=p(r("AWov")),u=p(r("Si/7")),h=p(r("It3W"));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function p(t){return t&&t.__esModule?t:{default:t}}var f=0,m=!1;e.isMobile=l,e.removeItems=c.default,e.EventEmitter=o.default,e.pluginTarget=s.default,e.mixins=a,e.earcut=h.default;var v=e.TextureCache=Object.create(null),g=e.BaseTextureCache=Object.create(null),y=e.premultiplyBlendMode=(0,u.default)()},aRcS:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return i.points=n,i.vertices=new Float32Array(4*n.length),i.uvs=new Float32Array(4*n.length),i.colors=new Float32Array(2*n.length),i.indices=new Uint16Array(2*n.length),i.autoUpdate=!0,i.refresh(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){this.vertices.length/4!==t.length&&(this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length));var e=this.uvs,r=this.indices,n=this.colors;e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var i=t.length,o=1;o<i;o++){var s=4*o,a=o/(i-1);e[s]=a,e[s+1]=0,e[s+2]=a,e[s+3]=1,n[s=2*o]=1,n[s+1]=1,r[s=2*o]=s,r[s+1]=s+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},e.prototype.refreshVertices=function(){var t=this.points;if(!(t.length<1))for(var e=t[0],r=void 0,n=0,i=0,o=this.vertices,s=t.length,a=0;a<s;a++){var l=t[a],c=4*a;i=-((r=a<t.length-1?t[a+1]:l).x-e.x),n=r.y-e.y;var u=10*(1-a/(s-1));u>1&&(u=1);var h=Math.sqrt(n*n+i*i),d=this._texture.height/2;n/=h,i/=h,i*=d,o[c]=l.x+(n*=d),o[c+1]=l.y+i,o[c+2]=l.x-n,o[c+3]=l.y-i,e=l}},e.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("kpDK")).default);e.default=n},aWrq:function(t,e,r){"use strict";var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));n.DisplayObject.prototype.getGlobalPosition=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n.Point;return this.parent?this.parent.toGlobal(this.position,t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]):(t.x=this.position.x,t.y=this.position.y),t}},aoKs:function(t,e){var r=function(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e};t.exports=function(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return r(2*e);case"bvec3":return r(3*e);case"bvec4":return r(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},bBNR:function(t,e){var r=new ArrayBuffer(0),n=function(t,e,n,i){this.gl=t,this.buffer=t.createBuffer(),this.type=e||t.ARRAY_BUFFER,this.drawType=i||t.STATIC_DRAW,this.data=r,n&&this.upload(n),this._updateID=0};n.prototype.upload=function(t,e,r){r||this.bind();var n=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?n.bufferSubData(this.type,e,t):n.bufferData(this.type,t,this.drawType),this.data=t},n.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},n.createVertexBuffer=function(t,e,r){return new n(t,t.ARRAY_BUFFER,e,r)},n.createIndexBuffer=function(t,e,r){return new n(t,t.ELEMENT_ARRAY_BUFFER,e,r)},n.create=function(t,e,r,i){return new n(t,e,r,i)},n.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.exports=n},bKul:function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},bbL7:function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return o});const n="undefined"!=typeof window&&window,i="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,o=n||"undefined"!=typeof t&&t||i;!function(){if(!o)throw new Error("RxJS could not find any global context (window, self, global)")}()}).call(e,r("DuR2"))},bmpC:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=l(r("n9CN")),o=r("aH6o"),s=r("FjAT"),a=l(r("/MUw"));function l(t){return t&&t.__esModule?t:{default:t}}var c={},u=function(){function t(e,r,n){for(var l in function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this._blendMode=s.BLEND_MODES.NORMAL,this.uniformData=n||(0,i.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[l]=this.uniformData[l].value,this.uniformData[l].type&&(this.uniformData[l].type=this.uniformData[l].type.toLowerCase());this.glShaders={},c[this.vertexSrc+this.fragmentSrc]||(c[this.vertexSrc+this.fragmentSrc]=(0,o.uid)()),this.glShaderKey=c[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=a.default.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0}return t.prototype.apply=function(t,e,r,n,i){t.applyFilter(this,e,r,n)},n(t,[{key:"blendMode",get:function(){return this._blendMode},set:function(t){this._blendMode=t}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),t}();e.default=u},bqFq:function(t,e){t.exports=function(t,e){for(var r=[],n=(e=e||0)||0;n<t.length;n++)r[n-e]=t[n];return r}},bva0:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,r,n){void 0===r&&(r=!1),i(this,t),this._fn=e,this._once=r,this._thisArg=n,this._next=this._prev=this._owner=null}return n(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function s(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var a=function(){function t(){i(this,t),this._head=this._tail=void 0}return n(t,[{key:"handlers",value:function(){var t=this._head;if(!(arguments.length<=0||void 0===arguments[0])&&arguments[0])return!!t;for(var e=[];t;)e.push(t),t=t._next;return e}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return s(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return s(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();a.MiniSignalBinding=o,e.default=a,t.exports=e.default},crq8:function(t,e,r){"use strict";e.a=(t=>t&&"number"==typeof t.length)},cv0E:function(t,e,r){"use strict";r("Wi38"),r("9GXS"),r("2fqX"),r("KWAD"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},cwTZ:function(t,e,r){(function(e){var n,i=r("ZOjo"),o=r("ElvI"),s=r("gVZZ"),a=r("QamB"),l=r("9rXv"),c=r("Fy0/")("engine.io-client:websocket"),u=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{n=r(1)}catch(t){}var h=u;function d(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=u&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(h=n),i.call(this,t)}h||"undefined"!=typeof window||(h=n),t.exports=d,a(d,i),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new h(t,e):new h(t):new h(t,e,r)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},d.prototype.write=function(t){var r=this;this.writable=!1;for(var n=t.length,i=0,s=n;i<s;i++)!function(t){o.encodePacket(t,r.supportsBinary,function(i){if(!r.usingBrowserWebSocket){var o={};t.options&&(o.compress=t.options.compress),r.perMessageDeflate&&("string"==typeof i?e.Buffer.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(o.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,o)}catch(t){c("websocket closed before onclose event")}--n||(r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0))})}(t[i])},d.prototype.onClose=function(){i.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",r="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=l()),this.supportsBinary||(t.b64=1),(t=s.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t},d.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===d.prototype.name)}}).call(e,r("DuR2"))},d5OP:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){function e(r){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("Obmw")).default);e.default=n},d8XH:function(t,e,r){"use strict";e.__esModule=!0;var n=r("leFA");Object.defineProperty(e,"FXAAFilter",{enumerable:!0,get:function(){return h(n).default}});var i=r("Ydo6");Object.defineProperty(e,"NoiseFilter",{enumerable:!0,get:function(){return h(i).default}});var o=r("o3GV");Object.defineProperty(e,"DisplacementFilter",{enumerable:!0,get:function(){return h(o).default}});var s=r("XjEo");Object.defineProperty(e,"BlurFilter",{enumerable:!0,get:function(){return h(s).default}});var a=r("e3qs");Object.defineProperty(e,"BlurXFilter",{enumerable:!0,get:function(){return h(a).default}});var l=r("qLff");Object.defineProperty(e,"BlurYFilter",{enumerable:!0,get:function(){return h(l).default}});var c=r("mlJa");Object.defineProperty(e,"ColorMatrixFilter",{enumerable:!0,get:function(){return h(c).default}});var u=r("BmFd");function h(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AlphaFilter",{enumerable:!0,get:function(){return h(u).default}})},dMus:function(t,e,r){"use strict";e.a={closed:!0,next(t){},error(t){throw t},complete(){}}},dtlK:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("aH6o"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.children=[],r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments.length;if(e>1)for(var r=0;r<e;r++)this.addChild(arguments[r]);else t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);(0,i.removeItems)(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments.length;if(e>1)for(var r=0;r<e;r++)this.removeChild(arguments[r]);else{var n=this.children.indexOf(t);if(-1===n)return null;t.parent=null,t.transform._parentID=-1,(0,i.removeItems)(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,(0,i.removeItems)(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),e},e.prototype.removeChildren=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1],r="number"==typeof e?e:this.children.length,n=r-t,i=void 0;if(n>0&&n<=r){i=this.children.splice(t,n);for(var o=0;o<i.length;++o)i[o].parent=null,i[o].transform&&(i[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var s=0;s<i.length;++s)i[s].emit("removed",this);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.visible&&e.renderable&&(e.calculateBounds(),e._mask?(e._mask.calculateBounds(),this._bounds.addBoundsMask(e._bounds,e._mask._bounds)):e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds))}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(t);else{this._renderWebGL(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].renderWebGL(t)}},e.prototype.renderAdvancedWebGL=function(t){t.flush();var e=this._filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n]);this._enabledFilters.length&&t.filterManager.pushFilter(this,this._enabledFilters)}r&&t.maskManager.pushMask(this,this._mask),this._renderWebGL(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].renderWebGL(t);t.flush(),r&&t.maskManager.popMask(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filterManager.popFilter()},e.prototype._renderWebGL=function(t){},e.prototype._renderCanvas=function(t){},e.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.prototype.destroy=function(e){t.prototype.destroy.call(this);var r="boolean"==typeof e?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(r)for(var i=0;i<n.length;++i)n[i].destroy(e)},n(e,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("3Wvr")).default);e.default=o,o.prototype.containerUpdateTransform=o.prototype.updateTransform},dzdQ:function(t,e,r){"use strict";const n=function(t){const e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;{const{Set:e}=t;if(e&&"function"==typeof(new e)["@@iterator"])return"@@iterator";const{Map:r}=t;if(r){let t=Object.getOwnPropertyNames(r.prototype);for(let e=0;e<t.length;++e){let n=t[e];if("entries"!==n&&"size"!==n&&r.prototype[n]===r.prototype.entries)return n}}return"@@iterator"}}(r("bbL7").a);e.a=n},e3qs:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=l(r("vpgX")),s=l(r("5Ljx")),a=l(r("+QcN"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,n,a,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=(0,o.default)(l=l||5,!0),u=(0,s.default)(l),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,c,u));return h.resolution=a||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r,n){if(this.firstRun){var i=(0,a.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!0),this.fragmentSrc=(0,s.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/r.size.width*(r.size.width/e.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{for(var l=t.getRenderTarget(!0),c=e,u=l,h=0;h<this.passes-1;h++){t.applyFilter(this,c,u,!0);var d=u;u=c,c=d}t.applyFilter(this,c,r,n),t.returnRenderTarget(l)}},n(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=c},eAwk:function(t,e,r){(function(t,n){var i;!function(n){var o,s,a,l=String.fromCharCode;function c(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function u(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function h(t,e){return l(t>>e&63|128)}function d(t,e){if(0==(4294967168&t))return l(t);var r="";return 0==(4294965248&t)?r=l(t>>6&31|192):0==(4294901760&t)?(u(t,e)||(t=65533),r=l(t>>12&15|224),r+=h(t,6)):0==(4292870144&t)&&(r=l(t>>18&7|240),r+=h(t,12),r+=h(t,6)),r+l(63&t|128)}function p(){if(a>=s)throw Error("Invalid byte index");var t=255&o[a];if(a++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function f(t){var e,r;if(a>s)throw Error("Invalid byte index");if(a==s)return!1;if(e=255&o[a],a++,0==(128&e))return e;if(192==(224&e)){if((r=(31&e)<<6|p())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&e)){if((r=(15&e)<<12|p()<<6|p())>=2048)return u(r,t)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(r=(7&e)<<18|p()<<12|p()<<6|p())>=65536&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}var m={version:"2.1.2",encode:function(t,e){for(var r=!1!==(e=e||{}).strict,n=c(t),i=n.length,o=-1,s="";++o<i;)s+=d(n[o],r);return s},decode:function(t,e){var r=!1!==(e=e||{}).strict;o=c(t),s=o.length,a=0;for(var n,i=[];!1!==(n=f(r));)i.push(n);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=l(e);return i}(i)}};void 0===(i=(function(){return m}).call(e,r,e,t))||(t.exports=i)}()}).call(e,r("3IRH")(t),r("DuR2"))},eWjs:function(t,e,r){"use strict";"use restrict";function n(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,r;return e=(t>65535)<<4,e|=r=((t>>>=e)>255)<<3,e|=r=((t>>>=r)>15)<<2,(e|=r=((t>>>=r)>3)<<1)|(t>>>=r)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=n,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var i=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,n=e,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;t[e]=n<<i&255}}(i),e.reverse=function(t){return i[255&t]<<24|i[t>>>8&255]<<16|i[t>>>16&255]<<8|i[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,r){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>n(t)+1}},f2Ls:function(t,e,r){"use strict";e.a=function(t){return t&&"function"==typeof t.schedule}},fOB9:function(t,e){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),o=t.indexOf("]");-1!=i&&-1!=o&&(t=t.substring(0,i)+t.substring(i,o).replace(/:/g,";")+t.substring(o,t.length));for(var s=r.exec(t||""),a={},l=14;l--;)a[n[l]]=s[l]||"";return-1!=i&&-1!=o&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},fiP3:function(t,e,r){"use strict";e.__esModule=!0,e.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},fq6b:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){for(var e=6*t,r=new Uint16Array(e),n=0,i=0;n<e;n+=6,i+=4)r[n+0]=i+0,r[n+1]=i+1,r[n+2]=i+2,r[n+3]=i+0,r[n+4]=i+2,r[n+5]=i+3;return r}},gQZj:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("FjAT"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=Number(e),this.y=Number(r),this.width=Number(n),this.height=Number(o),this.type=i.SHAPES.RECT}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},t.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},t.prototype.fit=function(t){this.x<t.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=t.x),this.y<t.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=t.y),this.x+this.width>t.x+t.width&&(this.width=t.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>t.y+t.height&&(this.height=t.height-this.y,this.height<0&&(this.height=0))},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.width=r-e,this.y=n,this.height=i-n},n(t,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new t(0,0,0,0)}}]),t}();e.default=o},gVZZ:function(t,e){e.encode=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},e.decode=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},gVev:function(t,e,r){"use strict";e.__esModule=!0,e.shared=e.Resource=e.textureParser=e.getResourcePath=e.spritesheetParser=e.parseBitmapFontData=e.bitmapFontParser=e.Loader=void 0;var n=r("j9EU");Object.defineProperty(e,"bitmapFontParser",{enumerable:!0,get:function(){return c(n).default}}),Object.defineProperty(e,"parseBitmapFontData",{enumerable:!0,get:function(){return n.parse}});var i=r("13Cv");Object.defineProperty(e,"spritesheetParser",{enumerable:!0,get:function(){return c(i).default}}),Object.defineProperty(e,"getResourcePath",{enumerable:!0,get:function(){return i.getResourcePath}});var o=r("nfXk");Object.defineProperty(e,"textureParser",{enumerable:!0,get:function(){return c(o).default}});var s=r("SMx8");Object.defineProperty(e,"Resource",{enumerable:!0,get:function(){return s.Resource}});var a=c(r("5XUO")),l=c(r("6Pue"));function c(t){return t&&t.__esModule?t:{default:t}}e.Loader=l.default;var u=new l.default;u.destroy=function(){},e.shared=u;var h=a.default.prototype;h._loader=null,Object.defineProperty(h,"loader",{get:function(){return this._loader||(this._loader=this._options.sharedLoader?u:new l.default),this._loader}}),h._parentDestroy=h.destroy,h.destroy=function(t){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(t)}},giQI:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var o=t.shape,s=o.x,a=o.y,l=o.width,c=o.height;if(t.fill){var u=(0,i.hex2rgb)(t.fillColor),h=t.fillAlpha,d=u[0]*h,p=u[1]*h,f=u[2]*h,m=e.points,v=e.indices,g=m.length/6;m.push(s,a),m.push(d,p,f,h),m.push(s+l,a),m.push(d,p,f,h),m.push(s,a+c),m.push(d,p,f,h),m.push(s+l,a+c),m.push(d,p,f,h),v.push(g,g,g+1,g+2,g+3,g+3)}if(t.lineWidth){var y=t.points;t.points=[s,a,s+l,a,s+l,a+c,s,a+c,s,a],(0,n.default)(t,e,r),t.points=y}};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("FH9r")),i=r("aH6o")},gxtk:function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.blobMiddlewareFactory=function(){return function(t,e){if(t.data){if(t.xhr&&t.xhrType===i.default.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=function(){var r=a.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=r,t.type=i.default.TYPE.IMAGE,t.data.onload=function(){a.revokeObjectURL(r),t.data.onload=null,e()},{v:void 0}}();if("object"===("undefined"==typeof r?"undefined":n(r)))return r.v}}else{var s=t.xhr.getResponseHeader("content-type");if(s&&0===s.indexOf("image"))return t.data=new Image,t.data.src="data:"+s+";base64,"+o.default.encodeBinary(t.xhr.responseText),t.type=i.default.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}};var i=s(r("66C6")),o=s(r("7VTH"));function s(t){return t&&t.__esModule?t:{default:t}}var a=window.URL||window.webkitURL},h4XE:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("gQZj")),i=r("FjAT"),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r,this.radius=n,this.type=i.SHAPES.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.x-t,n=this.y-e;return(r*=r)+(n*=n)<=this.radius*this.radius},t.prototype.getBounds=function(){return new n.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}();e.default=o},h9yw:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;return 0===t.indexOf("data:")?"":(e=e||window.location,i||(i=document.createElement("a")),i.href=t,(t=n.default.parse(i.href)).hostname!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||t.protocol!==e.protocol?"anonymous":"")};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("UZ5h")),i=void 0},hScZ:function(t,e,r){"use strict";e.__esModule=!0;var n=s(r("bmpC")),i=r("Q5/2"),o=(r("o/zv"),s(r("nQP+")));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=new i.Matrix,o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return r.renderable=!1,o.maskSprite=r,o.maskMatrix=n,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){var n=this.maskSprite,i=this.maskSprite.texture;i.valid&&(i.transform||(i.transform=new o.default(i,0)),i.transform.update(),this.uniforms.mask=i,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(i.transform.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=i.transform.uClampFrame,t.applyFilter(this,e,r))},e}(n.default);e.default=a},hYez:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r[0]instanceof i.Texture?r[0]:r[0].texture));return o._textures=null,o._durations=null,o.textures=r,o._autoUpdate=!1!==n,o.animationSpeed=1,o.loop=!0,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o.playing=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&i.ticker.shared.remove(this.update,this))},e.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&i.ticker.shared.add(this.update,this,i.UPDATE_PRIORITY.HIGH))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())},e.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.onFrameChange&&this.onFrameChange(this.currentFrame)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e)},e.fromFrames=function(t){for(var r=[],n=0;n<t.length;++n)r.push(i.Texture.fromFrame(t[n]));return new e(r)},e.fromImages=function(t){for(var r=[],n=0;n<t.length;++n)r.push(i.Texture.fromImage(t[n]));return new e(r)},n(e,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(t){if(t[0]instanceof i.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}}]),e}(i.Sprite);e.default=o},hfO1:function(t,e,r){"use strict";e.a={e:{}}},i45y:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("/B0E"),o=r("aH6o"),s=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseTexture=e,this.textures={},this.data=r,this.resolution=this._updateResolution(n||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return n(t,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),t.prototype._updateResolution=function(t){var e=this.data.meta.scale,r=(0,o.getResolutionOfUrl)(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&(this.baseTexture.resolution=r,this.baseTexture.update()),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var r=e,n=t.BATCH_SIZE,o=this.baseTexture.sourceScale;r-e<n&&r<this._frameKeys.length;){var s=this._frameKeys[r],a=this._frames[s],l=a.frame;if(l){var c,u=null,h=!1!==a.trimmed&&a.sourceSize?a.sourceSize:a.frame,d=new i.Rectangle(0,0,Math.floor(h.w*o)/this.resolution,Math.floor(h.h*o)/this.resolution);c=a.rotated?new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.h*o)/this.resolution,Math.floor(l.w*o)/this.resolution):new i.Rectangle(Math.floor(l.x*o)/this.resolution,Math.floor(l.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution),!1!==a.trimmed&&a.spriteSourceSize&&(u=new i.Rectangle(Math.floor(a.spriteSourceSize.x*o)/this.resolution,Math.floor(a.spriteSourceSize.y*o)/this.resolution,Math.floor(l.w*o)/this.resolution,Math.floor(l.h*o)/this.resolution)),this.textures[s]=new i.Texture(this.baseTexture,c,d,u,a.rotated?2:0),i.Texture.addToCache(this.textures[s],s)}r++}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():e._parseComplete()},0)},t.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},t}();e.default=s},icz7:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r,n,i,o,s,a){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=0,u=0,h=0,d=0,p=0;l.push(t,e);for(var f=1,m=0;f<=20;++f)l.push((h=(u=(c=1-(m=f/20))*c)*c)*t+3*u*m*r+3*c*(d=m*m)*i+(p=d*m)*s,h*e+3*u*m*n+3*c*d*o+p*a);return l}},izXE:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("Q5/2"),o=r("aH6o"),s=r("FjAT"),a=c(r("qD+0")),l=c(r("dtlK"));function c(t){return t&&t.__esModule?t:{default:t}}var u=new i.Point,h=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return n._anchor=new i.ObservablePoint(n._onAnchorUpdate,n),n._texture=null,n._width=0,n._height=0,n._tint=null,n._tintRGB=null,n.tint=16777215,n.blendMode=s.BLEND_MODES.NORMAL,n.shader=null,n.cachedTint=16777215,n.texture=r||a.default.EMPTY,n.vertexData=new Float32Array(8),n.vertexTrimmedData=null,n._transformID=-1,n._textureID=-1,n._transformTrimmedID=-1,n._textureTrimmedID=-1,n.pluginName="sprite",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,o.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,o.sign)(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var t=this._texture,e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,o=e.d,s=e.tx,a=e.ty,l=this.vertexData,c=t.trim,u=t.orig,h=this._anchor,d=0,p=0,f=0,m=0;c?(d=(p=c.x-h._x*u.width)+c.width,f=(m=c.y-h._y*u.height)+c.height):(d=(p=-h._x*u.width)+u.width,f=(m=-h._y*u.height)+u.height),l[0]=r*p+i*m+s,l[1]=o*m+n*p+a,l[2]=r*d+i*m+s,l[3]=o*m+n*d+a,l[4]=r*d+i*f+s,l[5]=o*f+n*d+a,l[6]=r*p+i*f+s,l[7]=o*f+n*p+a}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this.vertexTrimmedData,e=this._texture.orig,r=this._anchor,n=this.transform.worldTransform,i=n.a,o=n.b,s=n.c,a=n.d,l=n.tx,c=n.ty,u=-r._x*e.width,h=u+e.width,d=-r._y*e.height,p=d+e.height;t[0]=i*u+s*d+l,t[1]=a*d+o*u+c,t[2]=i*h+s*d+l,t[3]=a*d+o*h+c,t[4]=i*h+s*p+l,t[5]=a*p+o*h+c,t[6]=i*u+s*p+l,t[7]=a*p+o*u+c},e.prototype._renderWebGL=function(t){this.calculateVertices(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,u);var e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x,i=0;return u.x>=n&&u.x<n+e&&u.y>=(i=-r*this.anchor.y)&&u.y<i+r},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e&&e.baseTexture)),this._texture=null,this.shader=null},e.from=function(t){return new e(a.default.from(t))},e.fromFrame=function(t){var r=o.TextureCache[t];if(!r)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new e(r)},e.fromImage=function(t,r,n){return new e(a.default.fromImage(t,r,n))},n(e,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=(0,o.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=(0,o.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"anchor",get:function(){return this._anchor},set:function(t){this._anchor.copy(t)}},{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}]),e}(l.default);e.default=h},"j0z+":function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=c(r("bva0")),s=c(r("tOxb")),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("umD3")),l=c(r("66C6"));function c(t){return t&&t.__esModule?t:{default:t}}var u=/(#[\w-]+)?$/,h=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.baseUrl=r,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,r){return e._loadResource(t,r)},this._queue=a.queue(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new o.default,this.onError=new o.default,this.onLoad=new o.default,this.onStart=new o.default,this.onComplete=new o.default}return t.prototype.add=function(t,e,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;++o)this.add(t[o]);return this}if("object"===("undefined"==typeof t?"undefined":n(t))&&(i=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new l.default(t,e,r),"function"==typeof i&&this.resources[t].onAfterMiddleware.once(i),this.loading){for(var s=r.parentResource,a=[],c=0;c<s.children.length;++c)s.children[c].isComplete||a.push(s.children[c]);var u=s.progressChunk*(a.length+1)/(a.length+2);s.children.push(this.resources[t]),s.progressChunk=u;for(var h=0;h<a.length;++h)a[h].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},t.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},t.prototype.use=function(t){return this._afterMiddleware.push(t),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},t.prototype._prepareUrl=function(t){var e=(0,s.default)(t,{strictMode:!0}),r=void 0;if(r=e.protocol||!e.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var n=u.exec(r)[0];-1!==(r=r.substr(0,r.length-n.length)).indexOf("?")?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=n}return r},t.prototype._loadResource=function(t,e){var r=this;t._dequeue=e,a.eachSeries(this._beforeMiddleware,function(e,n){e.call(r,t,function(){n(t.isComplete?{}:null)})},function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),a.eachSeries(this._afterMiddleware,function(r,n){r.call(e,t,n)},function(){t.onAfterMiddleware.dispatch(t),e.progress+=t.progressChunk,e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},i(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();e.default=h},j9EU:function(t,e,r){"use strict";e.__esModule=!0,e.parse=a,e.default=function(){return function(t,e){if(t.data&&t.type===o.Resource.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var r=t.isDataUrl?"":n.dirname(t.url);t.isDataUrl&&("."===r&&(r=""),this.baseUrl&&r&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/")),(r=r.replace(this.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/");var s=r+t.data.getElementsByTagName("page")[0].getAttribute("file");i.utils.TextureCache[s]?(a(t,i.utils.TextureCache[s]),e()):this.add(t.name+"_image",s,{crossOrigin:t.crossOrigin,loadType:o.Resource.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata,parentResource:t},function(r){a(t,r.texture),e()})}else e();else e()}};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("o/zv")),i=r("/B0E"),o=r("SMx8"),s=r("PMti");function a(t,e){t.bitmapFont=s.BitmapText.registerFont(t.data,e)}},jMVn:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=16,o=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.uploadHookHelper=n,n.canvas=document.createElement("canvas"),n.canvas.width=i,n.canvas.height=i,n.ctx=n.canvas.getContext("2d"),n.registerUploadHook(s),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ctx=null,this.canvas=null},e}(function(t){return t&&t.__esModule?t:{default:t}}(r("k6PJ")).default);function s(t,e){if(e instanceof n.BaseTexture){var r=e.source,i=0===r.width?t.canvas.width:Math.min(t.canvas.width,r.width),o=0===r.height?t.canvas.height:Math.min(t.canvas.height,r.height);return t.ctx.drawImage(r,0,0,i,o,0,0,t.canvas.width,t.canvas.height),!0}return!1}e.default=o,n.CanvasRenderer.registerPlugin("prepare",o)},jwA5:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=t.width,r=t.height,n=t.getContext("2d"),i=n.getImageData(0,0,e,r).data,o=i.length,s={top:null,left:null,right:null,bottom:null},a=void 0,l=void 0,c=void 0;for(a=0;a<o;a+=4)0!==i[a+3]&&(l=a/4%e,c=~~(a/4/e),null===s.top&&(s.top=c),null===s.left?s.left=l:l<s.left&&(s.left=l),null===s.right?s.right=l+1:s.right<l&&(s.right=l+1),null===s.bottom?s.bottom=c:s.bottom<c&&(s.bottom=c));var u=n.getImageData(s.left,s.top,e=s.right-s.left,r=s.bottom-s.top+1);return{height:r,width:e,data:u}}},jzaW:function(t,e,r){"use strict";e.a=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},k6PJ:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=function(t){return t&&t.__esModule?t:{default:t}}(r("EmDc")),o=n.ticker.shared;n.settings.UPLOADS_PER_FRAME=4;var s=function(){function t(e){var r=this;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.limiter=new i.default(n.settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){r.queue&&r.prepareItems()},this.registerFindHook(d),this.registerFindHook(p),this.registerFindHook(a),this.registerFindHook(l),this.registerFindHook(c),this.registerUploadHook(u),this.registerUploadHook(h)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)o.addOnce(this.tick,this,n.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(var a=0,l=s.length;a<l;a++)s[a]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof n.Container)for(var i=t.children.length-1;i>=0;i--)this.add(t.children[i]);return this},t.prototype.destroy=function(){this.ticking&&o.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function a(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var i=0;i<t._textures.length;i++)if(t._textures[i]instanceof n.Texture){var o=t._textures[i].baseTexture;-1===e.indexOf(o)&&(e.push(o),r=!0)}return r}function l(t,e){return t instanceof n.BaseTexture&&(-1===e.indexOf(t)&&e.push(t),!0)}function c(t,e){if(t._texture&&t._texture instanceof n.Texture){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function u(t,e){return e instanceof n.Text&&(e.updateText(!0),!0)}function h(t,e){if(e instanceof n.TextStyle){var r=e.toFontString();return n.TextMetrics.measureFont(r),!0}return!1}function d(t,e){if(t instanceof n.Text){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function p(t,e){return t instanceof n.TextStyle&&(-1===e.indexOf(t)&&e.push(t),!0)}e.default=s},kEDM:function(t,e,r){"use strict";e.__esModule=!0;var n=r("fiP3");Object.defineProperty(e,"accessibleTarget",{enumerable:!0,get:function(){return o(n).default}});var i=r("Nf+U");function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"AccessibilityManager",{enumerable:!0,get:function(){return o(i).default}})},kFAI:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._x=n,this._y=i,this.cb=e,this.scope=r}return t.prototype.set=function(t,e){var r=t||0,n=e||(0!==e?r:0);this._x===r&&this._y===n||(this._x=r,this._y=n,this.cb.call(this.scope))},t.prototype.copy=function(t){this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope))},n(t,[{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}]),t}();e.default=i},kMPS:function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,r,o){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=t.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,p,f,m=t[u].replace(a,"%20"),v=m.indexOf(r);v>=0?(h=m.substr(0,v),d=m.substr(v+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),n(s,p)?i(s[p])?s[p].push(f):s[p]=[s[p],f]:s[p]=f}return s};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},kVGU:function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),i=n.length,o="";for(r=0;r<i;r+=3)o+=t[n[r]>>2],o+=t[(3&n[r])<<4|n[r+1]>>4],o+=t[(15&n[r+1])<<2|n[r+2]>>6],o+=t[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=function(t){var e,n,i,o,s,a=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(e=0;e<l;e+=4)n=r[t.charCodeAt(e)],i=r[t.charCodeAt(e+1)],o=r[t.charCodeAt(e+2)],s=r[t.charCodeAt(e+3)],h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|o>>2,h[c++]=(3&o)<<6|63&s;return u}}()},kpDK:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=function(t){return t&&t.__esModule?t:{default:t}}(r("qD+0")),s=new i.Point,a=new i.Polygon,l=function(t){function e(r,n,s,a,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return c._texture=r||o.default.EMPTY,c.uvs=s||new Float32Array([0,0,1,0,1,1,0,1]),c.vertices=n||new Float32Array([0,0,100,0,100,100,0,100]),c.indices=a||new Uint16Array([0,1,3,2]),c.dirty=0,c.indexDirty=0,c.blendMode=i.BLEND_MODES.NORMAL,c.canvasPadding=i.settings.MESH_CANVAS_PADDING,c.drawMode=l||e.DRAW_MODES.TRIANGLE_MESH,c.shader=null,c.tintRgb=new Float32Array([1,1,1]),c._glDatas={},c._uvTransform=new i.TextureMatrix(c._texture),c.uploadUvTransform=!1,c.pluginName="mesh",c}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._renderWebGL=function(t){this.refresh(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._renderCanvas=function(t){this.refresh(),t.plugins[this.pluginName].render(this)},e.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},e.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},e.prototype.refresh=function(t){this._uvTransform.update(t)&&this._refresh()},e.prototype._refresh=function(){},e.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,s);for(var r=this.vertices,n=a.points,i=this.indices,o=this.indices.length,l=this.drawMode===e.DRAW_MODES.TRIANGLES?3:1,c=0;c+2<o;c+=l){var u=2*i[c],h=2*i[c+1],d=2*i[c+2];if(n[0]=r[u],n[1]=r[u+1],n[2]=r[h],n[3]=r[h+1],n[4]=r[d],n[5]=r[d+1],a.contains(s.x,s.y))return!0}return!1},n(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return i.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=i.utils.hex2rgb(t,this.tintRgb)}}]),e}(i.Container);e.default=l,l.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},la7E:function(t,e,r){"use strict";e.a=class extends Error{constructor(t){super(),this.errors=t;const e=Error.call(this,t?`${t.length} errors occurred during unsubscription:\n  ${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"");this.name=e.name="UnsubscriptionError",this.stack=e.stack,this.message=e.message}}},leFA:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));r("o/zv");var i=function(t){function e(){return function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(n.Filter);e.default=i},m0PG:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("mDHO")),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=e,this.maxAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,n.default)(e),this.nativeVaoExtension=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object")}return t.prototype.push=function(){var t=this.stack[this.stackIndex];t||(t=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var e=0;e<this.activeState.length;e++)t[e]=this.activeState[e]},t.prototype.pop=function(){var t=this.stack[--this.stackIndex];this.setState(t)},t.prototype.setState=function(t){this.setBlend(t[0]),this.setDepthTest(t[1]),this.setFrontFace(t[2]),this.setCullFace(t[3]),this.setBlendMode(t[4])},t.prototype.setBlend=function(t){this.activeState[0]!==(t=t?1:0)&&(this.activeState[0]=t,this.gl[t?"enable":"disable"](this.gl.BLEND))},t.prototype.setBlendMode=function(t){if(t!==this.activeState[4]){this.activeState[4]=t;var e=this.blendModes[t];2===e.length?this.gl.blendFunc(e[0],e[1]):this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3])}},t.prototype.setDepthTest=function(t){this.activeState[1]!==(t=t?1:0)&&(this.activeState[1]=t,this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST))},t.prototype.setCullFace=function(t){this.activeState[3]!==(t=t?1:0)&&(this.activeState[3]=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE))},t.prototype.setFrontFace=function(t){this.activeState[2]!==(t=t?1:0)&&(this.activeState[2]=t,this.gl.frontFace(this.gl[t?"CW":"CCW"]))},t.prototype.resetAttributes=function(){for(var t=0;t<this.attribState.tempAttribState.length;t++)this.attribState.tempAttribState[t]=0;for(var e=0;e<this.attribState.attribState.length;e++)this.attribState.attribState[e]=0;for(var r=1;r<this.maxAttribs;r++)this.gl.disableVertexAttribArray(r)},t.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var t=0;t<this.activeState.length;++t)this.activeState[t]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},t}();e.default=i},mAOr:function(t,e,r){"use strict";e.__esModule=!0;var n=r("Q5/2"),i=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.worldTransform=new n.Matrix,this.localTransform=new n.Matrix,this._worldID=0,this._parentID=0}return t.prototype.updateLocalTransform=function(){},t.prototype.updateTransform=function(t){var e=t.worldTransform,r=this.worldTransform,n=this.localTransform;r.a=n.a*e.a+n.b*e.c,r.b=n.a*e.b+n.b*e.d,r.c=n.c*e.a+n.d*e.c,r.d=n.c*e.b+n.d*e.d,r.tx=n.tx*e.a+n.ty*e.c+e.tx,r.ty=n.tx*e.b+n.ty*e.d+e.ty,this._worldID++},t}();e.default=i,i.prototype.updateWorldTransform=i.prototype.updateTransform,i.IDENTITY=new i},mDHO:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[n.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.ADD]=[t.ONE,t.DST_ALPHA],e[n.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],e[n.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.BLEND_MODES.ADD_NPM]=[t.SRC_ALPHA,t.DST_ALPHA,t.ONE,t.DST_ALPHA],e[n.BLEND_MODES.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_COLOR],e};var n=r("FjAT")},mHjp:function(t,e,r){var n=r("Ml+6");t.exports=function(){var t,e,r,i,o,s,a,l,c,u=null,h=null,d=null,p={},f={},m={},v={},g={},y={},x={},b={},w={},_=n.SmoothShading,S={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},T=1,M="Y",A=null;function E(p,_,E){if(u=(new DOMParser).parseFromString(p,"text/xml"),_=_||d,void 0!==E){var P=E.split("/");P.pop(),a=(P.length<1?".":P.join("/"))+"/"}!function(){var t=u.querySelectorAll("asset")[0];if(t&&t.childNodes)for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"unit":var n=r.getAttribute("meter");n&&(T=parseFloat(n));break;case"up_axis":M=r.textContent.charAt(0)}}}(),function(){if(!0!==S.convertUpAxis||M===S.upAxis)A=null;else switch(M){case"X":A="Y"===S.upAxis?"XtoY":"XtoZ";break;case"Y":A="X"===S.upAxis?"YtoX":"YtoZ";break;case"Z":A="X"===S.upAxis?"ZtoX":"ZtoY"}}(),f=C("library_images image",U,"image"),y=C("library_materials material",it,"material"),x=C("library_effects effect",ct,"effect"),g=C("library_geometries geometry",Y,"geometry"),b=C("library_cameras camera",mt,"camera"),w=C("library_lights light",gt,"light"),v=C("library_controllers controller",B,"controller"),m=C("library_animations animation",ht,"animation"),o=C("library_visual_scenes visual_scene",V,"visual_scene"),s=C("library_kinematics_models kinematics_model",xt,"kinematics_model"),l=[],c=[],t=function(){var t=u.querySelectorAll("scene instance_visual_scene")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return o[e.length>0?e:"visual_scene0"]}return null}(),h=new n.Group;for(var O=0;O<t.nodes.length;O++)h.add(I(t.nodes[O]));h.scale.multiplyScalar(T),r=[],function e(n){var i=t.getChildById(n.colladaId,!0),o=null;if(i&&i.keys){r.push(o={fps:60,hierarchy:[{node:i,keys:i.keys,sids:i.sids}],node:n,name:"animation_"+n.name,length:0});for(var s=0,a=i.keys.length;s<a;s++)o.length=Math.max(o.length,i.keys[s].time)}else o={hierarchy:[{keys:[],sids:[]}]};for(s=0,a=n.children.length;s<a;s++)for(var l=0,c=e(n.children[s]).hierarchy.length;l<c;l++)o.hierarchy.push({keys:[],sids:[]});return o}(h),e=function(){var t=u.querySelectorAll("instance_kinematics_model")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return s[e.length>0?e:"kinematics_model0"]}return null}(),function(){if(e&&0===e.joints.length)i=void 0;else{var r={},o=function(n,i){var o=i.getAttribute("id"),s=t.getChildById(o,!0),a=e.joints[n];h.traverse(function(t){t.colladaId==o&&(r[n]={node:t,transforms:s.transforms,joint:a,position:a.zeroPosition})})};i={joints:e&&e.joints,getJointValue:function(t){var e=r[t];if(e)return e.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,e){var i=r[t];if(i){var o=i.joint;if(e>o.limits.max||e<o.limits.min)console.log("setJointValue: joint "+t+" value "+e+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+")");else if(o.static)console.log("setJointValue: joint "+t+" is static");else{var s=i.node,l=o.axis,c=i.transforms,u=new n.Matrix4;for(a=0;a<c.length;a++){var h=c[a];if(h.sid&&-1!==h.sid.indexOf("joint"+t))switch(o.type){case"revolute":u.multiply(d.makeRotationAxis(l,n.Math.degToRad(e)));break;case"prismatic":u.multiply(d.makeTranslation(l.x*e,l.y*e,l.z*e));break;default:console.warn("setJointValue: unknown joint type: "+o.type)}else{var d=new n.Matrix4;switch(h.type){case"matrix":u.multiply(h.obj);break;case"translate":u.multiply(d.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":u.multiply(d.makeRotationAxis(h.obj,h.angle))}}}var p=Array.prototype.slice.call(u.elements);s.matrix.set.apply(s.matrix,[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]),s.matrix.decompose(s.position,s.quaternion,s.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var s=u.querySelector("scene instance_kinematics_scene");if(s)for(var a=0;a<s.childNodes.length;a++){var l=s.childNodes[a];if(1==l.nodeType)switch(l.nodeName){case"bind_joint_axis":var c=l.getAttribute("target").split("/").pop(),d=l.querySelector("axis param").textContent,p=parseInt(d.split("joint").pop().split(".")[0]),f=u.querySelector('[sid="'+c+'"]');f&&o(p,f.parentElement)}}}}();var N={scene:h,morphs:l,skins:c,animations:r,kinematics:i,dae:{images:f,materials:y,cameras:b,lights:w,effects:x,geometries:g,controllers:v,animations:m,visualScenes:o,visualScene:t,scene:t,kinematicsModels:s,kinematicsModel:e}};return _&&_(N),N}function C(t,e,r){for(var n=u.querySelectorAll(t),i={},o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=(new e).parse(l);c.id&&0!==c.id.length||(c.id=r+o++),i[c.id]=c}return i}function P(t,e){var r=e instanceof W?v[e.url]:e;if(r&&r.morph){for(var n=r.morph,i=0;i<n.targets.length;i++){var o=g[n.targets[i]];if(o.mesh&&o.mesh.primitives&&o.mesh.primitives.length){var s=o.mesh.primitives[0].geometry;s.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:s.vertices})}}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}else console.log("could not find morph controller!")}function O(t,e,r,i){if(t.world=t.world||new n.Matrix4,t.localworld=t.localworld||new n.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){var o=t.channels[0].sampler.output[r];o instanceof n.Matrix4&&(t.world.copy(o),t.localworld.copy(o),0===r&&t.matrix.copy(o))}i&&t.world.multiplyMatrices(i,t.world),e.push(t);for(var s=0;s<t.nodes.length;s++)O(t.nodes[s],e,r,t.world)}function N(t,e){for(var r=0;r<t.length;r++){var i=t[r],o=-1;if("JOINT"==i.type){for(var s=0;s<e.joints.length;s++)if(i.sid===e.joints[s]){o=s;break}if(o>=0){var a=e.invBindMatrices[o];for(i.invBindMatrix=a,i.skinningMatrix=new n.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,a),i.animatrix=new n.Matrix4,i.animatrix.copy(i.localworld),i.weights=[],s=0;s<e.weights.length;s++)for(var l=0;l<e.weights[s].length;l++){var c=e.weights[s][l];c.joint===o&&i.weights.push(c)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new n.Matrix4,i.weights=[]}}}function L(e,r,i){var o=v[r.url];if(i=void 0!==i?i:40,o&&o.skin)if(r.skeleton&&r.skeleton.length){for(var s=function(){var t,e=1e6,r=-e,n=0;for(var i in m){var o=m[i];t=t||o.id;for(var s=0;s<o.sampler.length;s++){var a=o.sampler[s];a.create(),e=Math.min(e,a.startTime),r=Math.max(r,a.endTime),n=Math.max(n,a.input.length)}}return{start:e,end:r,frames:n,ID:t}}(),a=t.getChildById(r.skeleton[0],!0)||t.getChildBySid(r.skeleton[0],!0),l=function(t){var e=[],r=function(t,e,i){var o={};o.name=e.sid,o.parent=t,o.matrix=e.matrix;var s=[new n.Vector3,new n.Quaternion,new n.Vector3];for(var a in o.matrix.decompose(s[0],s[1],s[2]),o.pos=[s[0].x,s[0].y,s[0].z],o.scl=[s[2].x,s[2].y,s[2].z],o.rotq=[s[1].x,s[1].y,s[1].z,s[1].w],i.push(o),e.nodes)r(e.sid,e.nodes[a],i)};return r(-1,t,e),e}(a),c=o.skin.joints,u=[],h=0;h<c.length;h++)for(var d=0;d<l.length;d++)l[d].name===c[h]&&(u[h]=l[d]);for(h=0;h<u.length;h++)for(d=0;d<u.length;d++)u[h].parent===u[d].name&&(u[h].parent=d);for(new n.Vector3,h=0;h<e.vertices.length;h++)e.vertices[h].applyMatrix4(o.skin.bindShapeMatrix);var p=[],f=[],g=o.skin.weights;for(h=0;h<g.length;h++){var y=new n.Vector4(g[h][0]?g[h][0].joint:0,g[h][1]?g[h][1].joint:0,g[h][2]?g[h][2].joint:0,g[h][3]?g[h][3].joint:0),x=new n.Vector4(g[h][0]?g[h][0].weight:0,g[h][1]?g[h][1].weight:0,g[h][2]?g[h][2].weight:0,g[h][3]?g[h][3].weight:0);p.push(y),f.push(x)}e.skinIndices=p,e.skinWeights=f,e.bones=u;var b={name:s.ID,fps:30,length:s.frames/30,hierarchy:[]};for(d=0;d<u.length;d++)b.hierarchy.push({parent:u[d].parent,name:u[d].name,keys:[]});for(console.log("ColladaLoader:",s.ID+" has "+u.length+" bones."),function(t,e,r){var i=[];O(e,i,-1),N(i,r.skin);for(var o=new n.Vector3,s=[],a=0;a<t.vertices.length;a++)s.push(new n.Vector3);for(a=0;a<i.length;a++)if("JOINT"==i[a].type)for(var l=0;l<i[a].weights.length;l++){var c=i[a].weights[l],u=c.index,h=c.weight,d=t.vertices[u],p=s[u];o.x=d.x,o.y=d.y,o.z=d.z,o.applyMatrix4(i[a].skinningMatrix),p.x+=o.x*h,p.y+=o.y*h,p.z+=o.z*h}for(a=0;a<t.vertices.length;a++)t.vertices[a]=s[a]}(e,a,o),i=0;i<s.frames;i++){var w=[];for(O(a,w,i),N(w,o.skin),h=0;h<w.length;h++)for(d=0;d<b.hierarchy.length;d++)if(b.hierarchy[d].name===w[h].sid){var _={};_.time=i/30,_.matrix=w[h].animatrix,0===i&&(w[h].matrix=_.matrix);var S=[new n.Vector3,new n.Quaternion,new n.Vector3];_.matrix.decompose(S[0],S[1],S[2]),_.pos=[S[0].x,S[0].y,S[0].z],_.scl=[S[2].x,S[2].y,S[2].z],_.rot=S[1],b.hierarchy[d].keys.push(_)}e.animation=b}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function I(t,e){var r,i,o,s,a=new n.Object3D;for(o=0;o<t.controllers.length;o++){var u=v[t.controllers[o].url];switch(u.type){case"skin":if(g[u.skin.source])(d=new q).url=u.skin.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),r=t.controllers[o];else if(v[u.skin.source]){var h=v[u.skin.source];i=h,h.morph&&g[h.morph.source]&&((d=new q).url=h.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d))}break;case"morph":var d;g[u.morph.source]&&((d=new q).url=u.morph.source,d.instance_material=t.controllers[o].instance_material,t.geometries.push(d),i=t.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(o=0;o<t.geometries.length;o++){var f,m=t.geometries[o],_=m.instance_material,T=g[m.url],M={},A=[],E=0;if(T){if(!T.mesh||!T.mesh.primitives)continue;if(0===a.name.length&&(a.name=T.id),_)for(s=0;s<_.length;s++){var C=_[s],O=y[C.target],N=x[O.instance_effect.url].shader.material;if(T.doubleSided){if(!(C.symbol in p)){var R=N.clone();R.side=n.DoubleSide,p[C.symbol]=R}N=p[C.symbol]}N.opacity=N.opacity?N.opacity:1,M[C.symbol]=E,A.push(N),(f=N).name=null===O.name||""===O.name?O.id:O.name,E++}var D,F=f||new n.MeshLambertMaterial({color:14540253,side:T.doubleSided?n.DoubleSide:n.FrontSide}),k=T.mesh.geometry3js;E>1&&(F=new n.MultiMaterial(A)),void 0!==r?(L(k,r),k.morphTargets.length>0?(F.morphTargets=!0,F.skinning=!1):(F.morphTargets=!1,F.skinning=!0),(D=new n.SkinnedMesh(k,F,!1)).name="skin_"+c.length,c.push(D)):void 0!==i?(P(k,i),F.morphTargets=!0,(D=new n.Mesh(k,F)).name="morph_"+l.length,l.push(D)):D=!0===k.isLineStrip?new n.Line(k):new n.Mesh(k,F),a.add(D)}}for(o=0;o<t.cameras.length;o++){var U=b[t.cameras[o].url],B=new n.PerspectiveCamera(U.yfov,parseFloat(U.aspect_ratio),parseFloat(U.znear),parseFloat(U.zfar));a.add(B)}for(o=0;o<t.lights.length;o++){var j=null,z=w[t.lights[o].url];if(z&&z.technique){var V=z.color.getHex(),G=z.intensity,H=z.distance,W=z.falloff_angle;switch(z.technique){case"directional":(j=new n.DirectionalLight(V,G,H)).position.set(0,0,1);break;case"point":j=new n.PointLight(V,G,H);break;case"spot":(j=new n.SpotLight(V,G,H,W)).position.set(0,0,1);break;case"ambient":j=new n.AmbientLight(V)}}j&&a.add(j)}if(a.name=t.name||t.id||"",a.colladaId=t.id||"",a.layer=t.layer||"",a.matrix=t.matrix,a.matrix.decompose(a.position,a.quaternion,a.scale),S.centerGeometry&&a.geometry){var X=a.geometry.center();X.multiply(a.scale),X.applyQuaternion(a.quaternion),a.position.sub(X)}for(o=0;o<t.nodes.length;o++)a.add(I(t.nodes[o]));return a}function R(t){for(var e=u.querySelectorAll("library_nodes node"),r=0;r<e.length;r++){var n=e[r].attributes.getNamedItem("id");if(n&&n.value===t)return e[r]}}function D(t,e){for(var r=null,n=0,i=t.length;n<i&&null===r;n++){var o=t[n];if(o.time===e)r=o;else if(o.time>e)break}return r}function F(t,e){for(var r=-1,n=0,i=t.length;n<i&&-1===r;n++)t[n].time>=e&&(r=n);return r}function k(t,e,r,n){var i=function(t,e,r){for(r=r>=0?r:r+t.length;r>=0;r--){var n=t[r];if(n.hasTarget(e))return n}return null}(t,n,r?r-1:0),o=function(t,e,r){for(;r<t.length;r++){var n=t[r];if(n.hasTarget(e))return n}return null}(t,n,r+1);if(i&&o){var s,a=(e.time-i.time)/(o.time-i.time),l=i.getTarget(n),c=o.getTarget(n).data,u=l.data;if("matrix"===l.type)s=u;else if(u.length){s=[];for(var h=0;h<u.length;++h)s[h]=u[h]+(c[h]-u[h])*a}else s=u+(c-u)*a;e.addTarget(n,l.transform,l.member,s)}}function U(){this.id="",this.init_from=""}function B(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function j(){this.method=null,this.source=null,this.targets=null,this.weights=null}function z(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function V(){this.id="",this.name="",this.nodes=[],this.scene=new n.Group}function G(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new n.Matrix4}function H(){this.sid="",this.type="",this.data=[],this.obj=null}function W(){this.url="",this.skeleton=[],this.instance_material=[]}function X(){this.symbol="",this.target=""}function q(){this.url="",this.instance_material=[]}function Y(){this.id="",this.mesh=null}function Z(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function J(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new n.Geometry}function Q(){J.call(this),this.vcount=[]}function K(){J.call(this),this.vcount=1}function $(){J.call(this),this.vcount=3}function tt(){this.source="",this.count=0,this.stride=0,this.params=[]}function et(){this.input={}}function rt(){this.semantic="",this.offset=0,this.source="",this.set=0}function nt(t){this.id=t,this.type=null}function it(){this.id="",this.name="",this.instance_effect=null}function ot(){this.color=new n.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function st(t,e){this.type=t,this.effect=e,this.material=null}function at(t){this.effect=t,this.init_from=null,this.format=null}function lt(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function ct(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function ut(){this.url=""}function ht(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function dt(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function pt(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ft(t){this.targets=[],this.time=t}function mt(){this.id="",this.name="",this.technique=""}function vt(){this.url=""}function gt(){this.id="",this.name="",this.technique=""}function yt(){this.url=""}function xt(){this.id="",this.name="",this.joints=[],this.links=[]}function bt(){this.sid="",this.name="",this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function wt(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function _t(){this.joint="",this.transforms=[],this.links=[]}function St(t){var e=t.getAttribute("id");return void 0!=p[e]?p[e]:(p[e]=new nt(e).parse(t),p[e])}function Tt(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push("true"===e[n]||"1"===e[n]);return r}function Mt(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push(parseFloat(e[n]));return r}function At(t){for(var e=Et(t),r=[],n=0,i=e.length;n<i;n++)r.push(parseInt(e[n],10));return r}function Et(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function Ct(t,e,r){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):r}function Pt(t,e){(new n.ImageLoader).load(e,function(e){t.image=e,t.needsUpdate=!0})}function Ot(t,e){t.doubleSided=!1;var r=e.querySelectorAll("extra double_sided")[0];r&&r&&1===parseInt(r.textContent,10)&&(t.doubleSided=!0)}function Nt(t,e){if(!0===S.convertUpAxis&&M!==S.upAxis)switch(A){case"XtoY":var r=t[0];t[0]=e*t[1],t[1]=r;break;case"XtoZ":r=t[2],t[2]=t[1],t[1]=t[0],t[0]=r;break;case"YtoX":r=t[0],t[0]=t[1],t[1]=e*r;break;case"YtoZ":r=t[1],t[1]=e*t[2],t[2]=r;break;case"ZtoX":r=t[0],t[0]=t[1],t[1]=t[2],t[2]=r;break;case"ZtoY":r=t[1],t[1]=t[2],t[2]=e*r}}function Lt(t,e){var r=[t[e],t[e+1],t[e+2]];return Nt(r,-1),new n.Vector3(r[0],r[1],r[2])}function It(t){if(S.convertUpAxis){var e=[t[0],t[4],t[8]];Nt(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],Nt(e=[t[1],t[5],t[9]],-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],Nt(e=[t[2],t[6],t[10]],-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],Nt(e=[t[0],t[1],t[2]],-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],Nt(e=[t[4],t[5],t[6]],-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],Nt(e=[t[8],t[9],t[10]],-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],Nt(e=[t[3],t[7],t[11]],-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return(new n.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Rt(t){return t>-1&&t<3&&(t={X:0,Y:1,Z:2}[t=Dt(["X","Y","Z"][t])]),t}function Dt(t){if(S.convertUpAxis)switch(t){case"X":switch(A){case"XtoY":case"XtoZ":case"YtoX":t="Y";break;case"ZtoX":t="Z"}break;case"Y":switch(A){case"XtoY":case"YtoX":case"ZtoX":t="X";break;case"XtoZ":case"YtoZ":case"ZtoY":t="Z"}break;case"Z":switch(A){case"XtoZ":t="X";break;case"YtoZ":case"ZtoX":case"ZtoY":t="Y"}}return t}return U.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];"init_from"===r.nodeName&&(this.init_from=r.textContent)}return this},B.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"skin":this.skin=(new z).parse(r),this.type=r.nodeName;break;case"morph":this.morph=(new j).parse(r),this.type=r.nodeName}}return this},j.prototype.parse=function(t){var e,r={},n=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":r[(s=(new nt).parse(i)).id]=s;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(e=0;e<n.length;e++){var o=n[e],s=r[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=s.read();break;case"MORPH_WEIGHT":this.weights=s.read()}}return this},j.prototype.parseInputs=function(t){for(var e=[],r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":e.push((new rt).parse(n))}}return e},z.prototype.parse=function(t){var e,r,n={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var s=Mt(o.textContent);this.bindShapeMatrix=It(s);break;case"source":var a=(new nt).parse(o);n[a.id]=a;break;case"joints":e=o;break;case"vertex_weights":r=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,n),this.parseWeights(r,n),this},z.prototype.parseJoints=function(t,e){for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":var i=(new rt).parse(n),o=e[i.source];"JOINT"===i.semantic?this.joints=o.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=o.read())}}},z.prototype.parseWeights=function(t,e){for(var r,n,i=[],o=0;o<t.childNodes.length;o++){var s=t.childNodes[o];if(1==s.nodeType)switch(s.nodeName){case"input":i.push((new rt).parse(s));break;case"v":r=At(s.textContent);break;case"vcount":n=At(s.textContent)}}var a=0;for(o=0;o<n.length;o++){for(var l=n[o],c=[],u=0;u<l;u++){for(var h={},d=0;d<i.length;d++){var p=i[d],f=r[a+p.offset];switch(p.semantic){case"JOINT":h.joint=f;break;case"WEIGHT":h.weight=e[p.source].data[f]}}c.push(h),a+=i.length}for(u=0;u<c.length;u++)c[u].index=o;this.weights.push(c)}},V.prototype.getChildById=function(t,e){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(t,e);if(n)return n}return null},V.prototype.getChildBySid=function(t,e){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(t,e);if(n)return n}return null},V.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r))}}return this},G.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var r,n=this.channels[e],i=n.target.split("/"),o=(i.shift(),i.shift()),s=o.indexOf(".")>=0,a=o.indexOf("(")>=0;if(s)o=(i=o.split(".")).shift(),i.shift();else if(a){o=(r=o.split("(")).shift();for(var l=0;l<r.length;l++)r[l]=parseInt(r[l].replace(/\)/,""))}if(o===t)return n.info={sid:o,dotSyntax:s,arrSyntax:a,arrIndices:r},n}return null},G.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(t,e);if(n)return n}return null},G.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(t,e);if(n)return n}return null},G.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid===t)return this.transforms[e];return null},G.prototype.parse=function(t){this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new n.Matrix4;for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new G).parse(r));break;case"instance_camera":this.cameras.push((new vt).parse(r));break;case"instance_controller":this.controllers.push((new W).parse(r));break;case"instance_geometry":this.geometries.push((new q).parse(r));break;case"instance_light":this.lights.push((new yt).parse(r));break;case"instance_node":var i=R(r.getAttribute("url").replace(/^#/,""));i&&this.nodes.push((new G).parse(i));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new H).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=function(t){var e=[],r=1e6,n=-1e6;for(var i in m)for(var o=m[i],s=0;s<o.channel.length;s++){var a=o.channel[s],l=o.sampler[s];(i=a.target.split("/")[0])==t.id&&(l.create(),a.sampler=l,r=Math.min(r,l.startTime),n=Math.max(n,l.endTime),e.push(a))}return e.length&&(t.startTime=r,t.endTime=n),e}(this),function(t){if(t.channels&&t.channels.length){for(var e=[],r=[],n=0,i=t.channels.length;n<i;n++){var o,s=t.channels[n],a=s.fullSid,l=s.sampler,c=l.input,u=t.getTransformBySid(s.sid);if(s.arrIndices){o=[];for(var h=0,d=s.arrIndices.length;h<d;h++)o[h]=Rt(s.arrIndices[h])}else o=Dt(s.member);if(u)for(-1===r.indexOf(a)&&r.push(a),h=0,d=c.length;h<d;h++){var p=c[h],f=l.getData(u.type,h,o);if(!(g=D(e,p))){g=new ft(p);var m=F(e,p);e.splice(-1===m?e.length:m,0,g)}g.addTarget(a,u,o,f)}else console.log('Could not find transform "'+s.sid+'" in node '+t.id)}for(n=0;n<r.length;n++){var v=r[n];for(h=0;h<e.length;h++){var g;(g=e[h]).hasTarget(v)||k(e,g,h,v)}}t.keys=e,t.sids=r}}(this),this.updateMatrix(),this},G.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},H.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=Mt(t.textContent),this.convert(),this},H.prototype.convert=function(){switch(this.type){case"matrix":this.obj=It(this.data);break;case"rotate":this.angle=n.Math.degToRad(this.data[3]);case"translate":Nt(this.data,-1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Nt(this.data,1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},H.prototype.apply=function(){var t=new n.Matrix4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),H.prototype.update=function(t,e){var r=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else 2===e.length?this.obj["n"+(e[0]+1)+(e[1]+1)]=t:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=r[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=r[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=n.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=n.Math.degToRad(t[3])}}},W.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1===r.nodeType)switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}}}return this},X.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},q.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType&&"bind_material"===r.nodeName){for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new X).parse(o))}break}}return this},Y.prototype.parse=function(t){this.id=t.getAttribute("id"),Ot(this,t);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"mesh":this.mesh=new Z(this).parse(r)}}return this},Z.prototype.parse=function(t){this.primitives=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"source":St(r);break;case"vertices":this.vertices=(new et).parse(r);break;case"linestrips":this.primitives.push((new K).parse(r));break;case"triangles":this.primitives.push((new $).parse(r));break;case"polygons":this.primitives.push((new J).parse(r));break;case"polylist":this.primitives.push((new Q).parse(r))}}if(this.geometry3js=new n.Geometry,null===this.vertices)return this;var i=p[this.vertices.input.POSITION.source].data;for(e=0;e<i.length;e+=3)this.geometry3js.vertices.push(Lt(i,e).clone());for(e=0;e<this.primitives.length;e++){var o=this.primitives[e];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},Z.prototype.handlePrimitive=function(t,e){if(t instanceof K)e.isLineStrip=!0;else{var r,i,o,s,a,l,c,u=t.p,h=t.inputs,d=0,f=3,m=0,v=[];for(r=0;r<h.length;r++){var g=(o=h[r]).offset+1;switch(m=m<g?g:m,o.semantic){case"TEXCOORD":v.push(o.set)}}for(var y=0;y<u.length;++y)for(var x=u[y],b=0;b<x.length;){var w=[],_=[],T=null,M=[];for(f=t.vcount?t.vcount.length?t.vcount[d++]:t.vcount:x.length/m,r=0;r<f;r++)for(i=0;i<h.length;i++)switch(a=(s=x[b+r*m+(o=h[i]).offset])*(c=(l=p[o.source]).accessor.params.length),o.semantic){case"VERTEX":w.push(s);break;case"NORMAL":_.push(Lt(l.data,a));break;case"TEXCOORD":void 0===(T=T||{})[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[a],l.data[a+1]));break;case"COLOR":M.push((new n.Color).setRGB(l.data[a],l.data[a+1],l.data[a+2]))}if(0===_.length)if(o=this.vertices.input.NORMAL){c=(l=p[o.source]).accessor.params.length;for(var A=0,E=w.length;A<E;A++)_.push(Lt(l.data,w[A]*c))}else e.calcNormals=!0;if(!T&&(T={},o=this.vertices.input.TEXCOORD))for(v.push(o.set),c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)a=w[A]*c,void 0===T[o.set]&&(T[o.set]=[]),T[o.set].push(new n.Vector2(l.data[a],1-l.data[a+1]));if(0===M.length&&(o=this.vertices.input.COLOR))for(c=(l=p[o.source]).accessor.params.length,A=0,E=w.length;A<E;A++)a=w[A]*c,M.push((new n.Color).setRGB(l.data[a],l.data[a+1],l.data[a+2]));var C,P,O=null,N=[];if(3===f)N.push(new n.Face3(w[0],w[1],w[2],_,M.length?M:new n.Color));else if(4===f)N.push(new n.Face3(w[0],w[1],w[3],_.length?[_[0].clone(),_[1].clone(),_[3].clone()]:[],M.length?[M[0],M[1],M[3]]:new n.Color)),N.push(new n.Face3(w[1],w[2],w[3],_.length?[_[1].clone(),_[2].clone(),_[3].clone()]:[],M.length?[M[1],M[2],M[3]]:new n.Color));else if(f>4&&S.subdivideFaces){var L=M.length?M:new n.Color;for(i=1;i<f-1;)N.push(new n.Face3(w[0],w[i],w[i+1],_.length?[_[0].clone(),_[i++].clone(),_[i].clone()]:[],L))}if(N.length)for(A=0,E=N.length;A<E;A++)for((O=N[A]).daeMaterial=t.material,e.faces.push(O),i=0;i<v.length;i++)C=T[v[i]],P=f>4?[C[0],C[A+1],C[A+2]]:4===f?0===A?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]),e.faceVertexUvs[i].push(P);else console.log("dropped face with vcount "+f+" for geometry with id: "+e.id);b+=m*f}}},J.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source===t.id&&(this.inputs[e].source=t.input.POSITION.source)},J.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=Ct(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"input":this.inputs.push((new rt).parse(t.childNodes[e]));break;case"vcount":this.vcount=At(r.textContent);break;case"p":this.p.push(At(r.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},(Q.prototype=Object.create(J.prototype)).constructor=Q,(K.prototype=Object.create(J.prototype)).constructor=K,($.prototype=Object.create(J.prototype)).constructor=$,tt.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=Ct(t,"count",0),this.stride=Ct(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if("param"===r.nodeName){var n={};n.name=r.getAttribute("name"),n.type=r.getAttribute("type"),this.params.push(n)}}return this},et.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"===t.childNodes[e].nodeName){var r=(new rt).parse(t.childNodes[e]);this.input[r.semantic]=r}return this},rt.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=Ct(t,"set",-1),this.offset=Ct(t,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},nt.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"bool_array":this.data=Tt(r.textContent),this.type=r.nodeName;break;case"float_array":this.data=Mt(r.textContent),this.type=r.nodeName;break;case"int_array":this.data=At(r.textContent),this.type=r.nodeName;break;case"IDREF_array":case"Name_array":this.data=Et(r.textContent),this.type=r.nodeName;break;case"technique_common":for(var n=0;n<r.childNodes.length;n++)if("accessor"===r.childNodes[n].nodeName){this.accessor=(new tt).parse(r.childNodes[n]);break}}}return this},nt.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var r=0;r<this.data.length;r+=16){var n=It(this.data.slice(r,r+16));t.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},it.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"===t.childNodes[e].nodeName){this.instance_effect=(new ut).parse(t.childNodes[e]);break}return this},ot.prototype.isColor=function(){return null===this.texture},ot.prototype.isTexture=function(){return null!=this.texture},ot.prototype.parse=function(t){"transparent"===t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"color":var i=Mt(r.textContent);this.color=new n.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=r.getAttribute("texture"),this.texcoord=r.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(r)}}return this},ot.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1]).childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]);for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":this.texOpts[r.nodeName]="TRUE"===r.textContent.toUpperCase()?1:parseInt(r.textContent);break;default:this.texOpts[r.nodeName]=r.textContent}}return this},st.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[r.nodeName]=(new ot).parse(r);break;case"bump":var n=r.getAttribute("bumptype");n?"heightfield"===n.toLowerCase()?this.bump=(new ot).parse(r):"normalmap"===n.toLowerCase()?this.normal=(new ot).parse(r):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+n+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new ot).parse(r)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new ot).parse(r));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=r.querySelectorAll("float");i.length>0&&(this[r.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},st.prototype.create=function(){var t={},e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(e=!0,t.transparent=!0,t.opacity=1-r)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var o in this)switch(o){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var s=this[o];if(s instanceof ot)if(s.isTexture()){var l=this.effect.sampler[s.texture];if(void 0!==l&&void 0!==l.source){var c=this.effect.surface[l.source];if(void 0!==c){var u=f[c.init_from];if(u){var h,d=a+u.init_from,p=n.Loader.Handlers.get(d);null!==p?h=p.load(d):Pt(h=new n.Texture,d),h.wrapS=s.texOpts.wrapU?n.RepeatWrapping:n.ClampToEdgeWrapping,h.wrapT=s.texOpts.wrapV?n.RepeatWrapping:n.ClampToEdgeWrapping,h.offset.x=s.texOpts.offsetU,h.offset.y=s.texOpts.offsetV,h.repeat.x=s.texOpts.repeatU,h.repeat.y=s.texOpts.repeatV,t[i[o]]=h,"emission"===o&&(t.emissive=16777215)}}}}else"diffuse"!==o&&e||("emission"===o?t.emissive=s.color.getHex():t[o]=s.color.getHex());break;case"shininess":t[o]=this[o];break;case"reflectivity":t[o]=this[o],t[o]>0&&(t.envMap=S.defaultEnvMap),t.combine=n.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[o],1!==this[o]&&(t.envMap=S.defaultEnvMap)}switch(t.shading=_,t.side=this.effect.doubleSided?n.DoubleSide:n.FrontSide,void 0!==t.diffuse&&(t.color=t.diffuse,delete t.diffuse),this.type){case"constant":void 0!=t.emissive&&(t.color=t.emissive),this.material=new n.MeshBasicMaterial(t);break;case"phong":case"blinn":this.material=new n.MeshPhongMaterial(t);break;case"lambert":default:this.material=new n.MeshLambertMaterial(t)}return this.material},at.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"init_from":this.init_from=r.textContent;break;case"format":this.format=r.textContent;break;default:console.log("unhandled Surface prop: "+r.nodeName)}}return this},lt.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"source":this.source=r.textContent;break;case"minfilter":this.minfilter=r.textContent;break;case"magfilter":this.magfilter=r.textContent;break;case"mipfilter":this.mipfilter=r.textContent;break;case"wrap_s":this.wrap_s=r.textContent;break;case"wrap_t":this.wrap_t=r.textContent;break;default:console.log("unhandled Sampler2D prop: "+r.nodeName)}}return this},ct.prototype.create=function(){if(null===this.shader)return null},ct.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),Ot(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(r))}}return this},ct.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[e]=new at(this).parse(n);break;case"sampler2D":this.sampler[e]=new lt(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},ct.prototype.parseProfileCOMMON=function(t){for(var e,r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":e=n;break;case"newparam":this.parseNewparam(n);break;case"image":var i=(new U).parse(n);f[i.id]=i;break;case"extra":break;default:console.log(n.nodeName)}}return e},ct.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new st(r.nodeName,this).parse(r);break;case"extra":this.parseExtra(r)}}},ct.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique":this.parseExtraTechnique(r)}}},ct.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"bump":this.shader.parse(t)}}},ut.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},ht.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"animation":var n=(new ht).parse(r);for(var i in n.source)this.source[i]=n.source[i];for(var o=0;o<n.channel.length;o++)this.channel.push(n.channel[o]),this.sampler.push(n.sampler[o]);break;case"source":i=(new nt).parse(r),this.source[i.id]=i;break;case"sampler":this.sampler.push(new pt(this).parse(r));break;case"channel":this.channel.push(new dt(this).parse(r))}}return this},dt.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/"),r=(e.shift(),e.shift()),n=r.indexOf(".")>=0,i=r.indexOf("(")>=0;if(n)e=r.split("."),this.sid=e.shift(),this.member=e.shift();else if(i){var o=r.split("(");this.sid=o.shift();for(var s=0;s<o.length;s++)o[s]=parseInt(o[s].replace(/\)/,""));this.arrIndices=o}else this.sid=r;return this.fullSid=r,this.dotSyntax=n,this.arrSyntax=i,this},pt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"input":this.inputs.push((new rt).parse(r))}}return this},pt.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],r=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=r.read();break;case"OUTPUT":this.output=r.read(),this.strideOut=r.accessor.stride;break;case"INTERPOLATION":this.interpolation=r.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},pt.prototype.getData=function(t,e,r){var n;if("matrix"===t&&16===this.strideOut)n=this.output[e];else if(this.strideOut>1){n=[],e*=this.strideOut;for(var i=0;i<this.strideOut;++i)n[i]=this.output[e+i];if(3===this.strideOut)switch(t){case"rotate":case"translate":Nt(n,-1);break;case"scale":Nt(n,1)}else 4===this.strideOut&&"matrix"===t&&Nt(n,-1)}else n=this.output[e],r&&"translate"===t&&(n=function(t,e){if(!0!==S.convertUpAxis||M===S.upAxis)return e;switch(t){case"X":e="XtoY"===A?-1*e:e;break;case"Y":e="YtoZ"===A||"YtoX"===A?-1*e:e;break;case"Z":e="ZtoY"===A?-1*e:e}return e}(r,n));return n},ft.prototype.addTarget=function(t,e,r,n){this.targets.push({sid:t,member:r,transform:e,data:n})},ft.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var r=this.targets[e];t&&r.sid!==t||r.transform.update(r.data,r.member)}},ft.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},ft.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},ft.prototype.interpolate=function(t,e){for(var r=0,n=this.targets.length;r<n;r++){var i,o=this.targets[r],s=t.getTarget(o.sid);if("matrix"!==o.transform.type&&s){var a=(e-this.time)/(t.time-this.time),l=s.data,c=o.data;if(a<0&&(a=0),a>1&&(a=1),c.length){i=[];for(var u=0;u<c.length;++u)i[u]=c[u]+(l[u]-c[u])*a}else i=c+(l-c)*a}else i=o.data;o.transform.update(i,o.member)}},mt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"optics":this.parseOptics(r)}}return this},mt.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"===t.childNodes[e].nodeName)for(var r=t.childNodes[e],n=0;n<r.childNodes.length;n++)if(this.technique=r.childNodes[n].nodeName,"perspective"===this.technique)for(var i=r.childNodes[n],o=0;o<i.childNodes.length;o++)switch((a=i.childNodes[o]).nodeName){case"yfov":this.yfov=a.textContent;break;case"xfov":this.xfov=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}else if("orthographic"===this.technique){var s=r.childNodes[n];for(o=0;o<s.childNodes.length;o++){var a;switch((a=s.childNodes[o]).nodeName){case"xmag":this.xmag=a.textContent;break;case"ymag":this.ymag=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}}return this},vt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},gt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r);break;case"technique":this.parseTechnique(r)}}return this},gt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var r=t.childNodes[e],i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];switch(o.nodeName){case"color":var s=Mt(o.textContent);this.color=new n.Color(0),this.color.setRGB(s[0],s[1],s[2]),this.color.a=s[3];break;case"falloff_angle":this.falloff_angle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);this.distance=a?Math.sqrt(1/a):0}}}return this},gt.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"intensity":this.intensity=parseFloat(r.textContent)}}return this},yt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},xt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.joints=[],this.links=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r)}}return this},xt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(t.childNodes[e].nodeName){case"joint":this.joints.push((new bt).parse(r));break;case"link":this.links.push((new wt).parse(r))}}return this},bt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.axis=new n.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var e=Mt(t.querySelector("axis").textContent);this.axis=Lt(e,0);var r=t.querySelector("limits min")?parseFloat(t.querySelector("limits min").textContent):-360,i=t.querySelector("limits max")?parseFloat(t.querySelector("limits max").textContent):360;this.limits={min:r,max:i};for(var o=["prismatic","revolute"],s=0;s<o.length;s++){var a=o[s];t.querySelector(a)&&(this.type=a)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},wt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.transforms=[],this.attachments=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"attachment_full":this.attachments.push((new _t).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},_t.prototype.parse=function(t){this.joint=t.getAttribute("joint").split("/").pop(),this.links=[];for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"link":this.links.push((new wt).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new H).parse(r))}}return this},{load:function(t,e,r,n){var i=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0!==o.status&&200!==o.status||(o.response?(d=e,E(o.response,void 0,t)):n?n():console.error("ColladaLoader: Empty or non-existing file ("+t+")")):3===o.readyState&&r&&(0===i&&(i=o.getResponseHeader("Content-Length")),r({total:i,loaded:o.responseText.length}))},o.open("GET",t,!0),o.send(null)}else alert("Don't know how to parse XML!")},parse:E,setPreferredShading:function(t){_=t},applySkin:L,geometries:g,options:S}}},mImb:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),i=function(t){return t&&t.__esModule?t:{default:t}}(r("kpDK")),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,r=e.context,n=t.worldTransform,o=e.resolution;e.roundPixels?r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o|0,n.ty*o|0):r.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o),e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),t.drawMode===i.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(t):this._renderTriangles(t)},t.prototype._renderTriangleMesh=function(t){for(var e=t.vertices.length/2,r=0;r<e-2;r++){var n=2*r;this._renderDrawTriangle(t,n,n+2,n+4)}},t.prototype._renderTriangles=function(t){for(var e=t.indices,r=e.length,n=0;n<r;n+=3)this._renderDrawTriangle(t,2*e[n],2*e[n+1],2*e[n+2])},t.prototype._renderDrawTriangle=function(t,e,r,n){var i=this.renderer.context,o=t.uvs,s=t.vertices,a=t._texture;if(a.valid){var l=a.baseTexture,c=l.source,u=l.width,h=l.height,d=void 0,p=void 0,f=void 0,m=void 0,v=void 0,g=void 0;if(t.uploadUvTransform){var y=t._uvTransform.mapCoord;d=(o[e]*y.a+o[e+1]*y.c+y.tx)*l.width,p=(o[r]*y.a+o[r+1]*y.c+y.tx)*l.width,f=(o[n]*y.a+o[n+1]*y.c+y.tx)*l.width,m=(o[e]*y.b+o[e+1]*y.d+y.ty)*l.height,v=(o[r]*y.b+o[r+1]*y.d+y.ty)*l.height,g=(o[n]*y.b+o[n+1]*y.d+y.ty)*l.height}else d=o[e]*l.width,p=o[r]*l.width,f=o[n]*l.width,m=o[e+1]*l.height,v=o[r+1]*l.height,g=o[n+1]*l.height;var x=s[e],b=s[r],w=s[n],_=s[e+1],S=s[r+1],T=s[n+1],M=t.canvasPadding/this.renderer.resolution;if(M>0){var A=M/Math.abs(t.worldTransform.a),E=M/Math.abs(t.worldTransform.d),C=(x+b+w)/3,P=(_+S+T)/3,O=x-C,N=_-P,L=Math.sqrt(O*O+N*N);x=C+O/L*(L+A),_=P+N/L*(L+E),N=S-P,b=C+(O=b-C)/(L=Math.sqrt(O*O+N*N))*(L+A),S=P+N/L*(L+E),N=T-P,w=C+(O=w-C)/(L=Math.sqrt(O*O+N*N))*(L+A),T=P+N/L*(L+E)}i.save(),i.beginPath(),i.moveTo(x,_),i.lineTo(b,S),i.lineTo(w,T),i.closePath(),i.clip();var I=d*v+m*f+p*g-v*f-m*p-d*g;i.transform((x*v+m*w+b*g-v*w-m*b-x*g)/I,(_*v+m*T+S*g-v*T-m*S-_*g)/I,(d*b+x*f+p*w-b*f-x*p-d*w)/I,(d*S+_*f+p*T-S*f-_*p-d*T)/I,(d*v*w+m*b*f+x*p*g-x*v*f-m*p*w-d*b*g)/I,(d*v*T+m*S*f+_*p*g-_*v*f-m*p*T-d*S*g)/I),i.drawImage(c,0,0,u*l.resolution,h*l.resolution,0,0,u,h),i.restore(),this.renderer.invalidateBlendMode()}},t.prototype.renderMeshFlat=function(t){var e=this.renderer.context,r=t.vertices,n=r.length/2;e.beginPath();for(var i=1;i<n-2;++i){var o=2*i,s=r[o+2],a=r[o+3],l=r[o+4],c=r[o+5];e.moveTo(r[o],r[o+1]),e.lineTo(s,a),e.lineTo(l,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=o,n.CanvasRenderer.registerPlugin("mesh",o)},mlJa:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));r("o/zv");var o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return r.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],r.alpha=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._loadMatrix=function(t){var e=t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(e,this.uniforms.m,t),e=this._colorMatrix(e)),this.uniforms.m=e},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)},e.prototype.greyscale=function(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),n=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i);this._loadMatrix([r+(1-r)*i,i*(1-r)-o*n,i*(1-r)+o*n,0,0,i*(1-r)+o*n,r+i*(1-r),i*(1-r)-o*n,0,0,i*(1-r)-o*n,i*(1-r)+o*n,r+i*(1-r),0,0,0,0,0,1,0],e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,n=-.5*(r-1);this._loadMatrix([r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0],e)},e.prototype.saturate=function(){var t=2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/3+1,e=-.5*(t-1);this._loadMatrix([t,e,e,0,0,e,t,e,0,0,e,e,t,0,0,0,0,0,1,0],arguments[1])},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,n,i){t=t||.2,e=e||.15;var o=((r=r||16770432)>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,l=((n=n||3375104)>>16&255)/255,c=(n>>8&255)/255,u=(255&n)/255;this._loadMatrix([.3,.59,.11,0,0,o,s,a,t,0,l,c,u,e,0,o-l,s-c,a-u,0,0],i)},e.prototype.night=function(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)},e.prototype.predator=function(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n(e,[{key:"matrix",get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),e}(i.Filter);e.default=o,o.prototype.grayscale=o.prototype.greyscale},n5XU:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e[n.DRAW_MODES.POINTS]=t.POINTS,e[n.DRAW_MODES.LINES]=t.LINES,e[n.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,e[n.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,e[n.DRAW_MODES.TRIANGLES]=t.TRIANGLES,e[n.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,e[n.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN,e};var n=r("FjAT")},n9CN:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var n=i(t),o=i(e);return Object.assign(n,o)};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("8QNu")).default.shader.defaultValue;function i(t){for(var e=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),r={},i=void 0,o=t.replace(/\s+/g," ").split(/\s*;\s*/),s=0;s<o.length;s++){var a=o[s].trim();if(a.indexOf("uniform")>-1){var l=a.split(" "),c=l[1],u=l[2],h=1;u.indexOf("[")>-1&&(u=(i=u.split(/\[|]/))[0],h*=Number(i[1])),u.match(e)||(r[u]={value:n(c,h),name:u,type:c})}}return r}},"nQP+":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("HVUN")),o=new i.default,s=function(){function t(e,r){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._texture=e,this.mapCoord=new i.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin="undefined"==typeof r?.5:r}return t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,n=0;n<t.length;n+=2){var i=t[n],o=t[n+1];e[n]=i*r.a+o*r.c+r.tx,e[n+1]=i*r.b+o*r.d+r.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._lastTextureID===e._updateID)return!1;this._lastTextureID=e._updateID;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=e.orig,i=e.trim;i&&(o.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(o));var s=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/s.resolution,c=this.clampOffset;return a[0]=(e._frame.x+l+c)/s.width,a[1]=(e._frame.y+l+c)/s.height,a[2]=(e._frame.x+e._frame.width-l+c)/s.width,a[3]=(e._frame.y+e._frame.height-l+c)/s.height,this.uClampOffset[0]=c/s.realWidth,this.uClampOffset[1]=c/s.realHeight,!0},n(t,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._lastTextureID=-1}}]),t}();e.default=s},nXuP:function(t,e,r){(function(e){var n=r("P2cu"),i=r("5+9/"),o=r("pnVU"),s=r("QamB"),a=r("Fy0/")("engine.io-client:polling-xhr");function l(){}function c(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,e.location){var r="https:"===location.protocol,n=location.port;n||(n=r?443:80),this.xd=t.hostname!==e.location.hostname||n!==t.port,this.xs=t.secure!==r}}function u(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function h(){for(var t in u.requests)u.requests.hasOwnProperty(t)&&u.requests[t].abort()}t.exports=c,t.exports.Request=u,s(c,i),c.prototype.supportsBinary=!0,c.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new u(t)},c.prototype.doWrite=function(t,e){var r=this.request({method:"POST",data:t,isBinary:"string"!=typeof t&&void 0!==t}),n=this;r.on("success",e),r.on("error",function(t){n.onError("xhr post error",t)}),this.sendXhr=r},c.prototype.doPoll=function(){a("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},o(u.prototype),u.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var r=this.xhr=new n(t),i=this;try{a("xhr open %s: %s",this.method,this.uri),r.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this.extraHeaders[o])}catch(t){}if("POST"===this.method)try{r.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(t){}try{r.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in r&&(r.withCredentials=!0),this.requestTimeout&&(r.timeout=this.requestTimeout),this.hasXDR()?(r.onload=function(){i.onLoad()},r.onerror=function(){i.onError(r.responseText)}):r.onreadystatechange=function(){if(2===r.readyState)try{var t=r.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===t&&(r.responseType="arraybuffer")}catch(t){}4===r.readyState&&(200===r.status||1223===r.status?i.onLoad():setTimeout(function(){i.onError(r.status)},0))},a("xhr data %s",this.data),r.send(this.data)}catch(t){return void setTimeout(function(){i.onError(t)},0)}e.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},u.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},u.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,t)try{this.xhr.abort()}catch(t){}e.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},u.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",h):e.addEventListener&&e.addEventListener("beforeunload",h,!1))}).call(e,r("DuR2"))},nfXk:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){return function(t,e){t.data&&t.type===n.Resource.TYPE.IMAGE&&(t.texture=i.default.fromLoader(t.data,t.url,t.name)),e()}};var n=r("SMx8"),i=function(t){return t&&t.__esModule?t:{default:t}}(r("qD+0"))},ngSy:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e,r){var s=t.shape,a=s.x,l=s.y,c=void 0,u=void 0;if(t.type===i.SHAPES.CIRC?(c=s.radius,u=s.radius):(c=s.width,u=s.height),0!==c&&0!==u){var h=Math.floor(30*Math.sqrt(s.radius))||Math.floor(15*Math.sqrt(s.width+s.height)),d=2*Math.PI/h;if(t.fill){var p=(0,o.hex2rgb)(t.fillColor),f=t.fillAlpha,m=p[0]*f,v=p[1]*f,g=p[2]*f,y=e.points,x=e.indices,b=y.length/6;x.push(b);for(var w=0;w<h+1;w++)y.push(a,l,m,v,g,f),y.push(a+Math.sin(d*w)*c,l+Math.cos(d*w)*u,m,v,g,f),x.push(b++,b++);x.push(b-1)}if(t.lineWidth){var _=t.points;t.points=[];for(var S=0;S<h+1;S++)t.points.push(a+Math.sin(d*S)*c,l+Math.cos(d*S)*u);(0,n.default)(t,e,r),t.points=_}}};var n=function(t){return t&&t.__esModule?t:{default:t}}(r("FH9r")),i=r("FjAT"),o=r("aH6o")},"o/zv":function(t,e,r){(function(t){function r(t,e){for(var r=0,n=t.length-1;n>=0;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return n.exec(t).slice(1)};function o(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}e.resolve=function(){for(var e="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var s=i>=0?arguments[i]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(e=s+"/"+e,n="/"===s.charAt(0))}return e=r(o(e.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+e||"."},e.normalize=function(t){var n=e.isAbsolute(t),i="/"===s(t,-1);return(t=r(o(t.split("/"),function(t){return!!t}),!n).join("/"))||n||(t="."),t&&i&&(t+="/"),(n?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(o(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,r){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=e.resolve(t).substr(1),r=e.resolve(r).substr(1);for(var i=n(t.split("/")),o=n(r.split("/")),s=Math.min(i.length,o.length),a=s,l=0;l<s;l++)if(i[l]!==o[l]){a=l;break}var c=[];for(l=a;l<i.length;l++)c.push("..");return(c=c.concat(o.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=i(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},e.basename=function(t,e){var r=i(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},e.extname=function(t){return i(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)}}).call(e,r("W2nU"))},o3GV:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E"));r("o/zv");var o=function(t){function e(r,n){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=new i.Matrix;r.renderable=!1;var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return s.maskSprite=r,s.maskMatrix=o,s.uniforms.mapSampler=r._texture,s.uniforms.filterMatrix=o,s.uniforms.scale={x:1,y:1},null!==n&&void 0!==n||(n=20),s.scale=new i.Point(n,n),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,t.applyFilter(this,e,r)},n(e,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t}}]),e}(i.Filter);e.default=o},oUe4:function(t,e,r){"use strict";e.__esModule=!0,e.autoDetectRenderer=function(t,e,r,s){var a=t&&t.forceCanvas;return void 0!==s&&(a=s),!a&&n.isWebGLSupported()?new o.default(t,e,r):new i.default(t,e,r)};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("aH6o")),i=s(r("5tzz")),o=s(r("qo3d"));function s(t){return t&&t.__esModule?t:{default:t}}},pnVU:function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},psuf:function(t,e,r){t.exports=r("Xqxu"),t.exports.parser=r("ElvI")},qC7s:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=10,o=function(t){function e(r,n,o,s,a){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r,4,4));return l._origWidth=r.orig.width,l._origHeight=r.orig.height,l._width=l._origWidth,l._height=l._origHeight,l.leftWidth="undefined"!=typeof n?n:i,l.rightWidth="undefined"!=typeof s?s:i,l.topHeight="undefined"!=typeof o?o:i,l.bottomHeight="undefined"!=typeof a?a:i,l.refresh(!0),l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.updateHorizontalVertices=function(){var t=this.vertices;t[9]=t[11]=t[13]=t[15]=this._topHeight,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices;t[2]=t[10]=t[18]=t[26]=this._leftWidth,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._renderCanvas=function(t){var e=t.context;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode);var r=this.worldTransform,n=t.resolution;t.roundPixels?e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n|0,r.ty*n|0):e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n);var i=this._texture.baseTexture,o=i.source,s=i.width*i.resolution,a=i.height*i.resolution;this.drawSegment(e,o,s,a,0,1,10,11),this.drawSegment(e,o,s,a,2,3,12,13),this.drawSegment(e,o,s,a,4,5,14,15),this.drawSegment(e,o,s,a,8,9,18,19),this.drawSegment(e,o,s,a,10,11,20,21),this.drawSegment(e,o,s,a,12,13,22,23),this.drawSegment(e,o,s,a,16,17,26,27),this.drawSegment(e,o,s,a,18,19,28,29),this.drawSegment(e,o,s,a,20,21,30,31)},e.prototype.drawSegment=function(t,e,r,n,i,o,s,a){var l=this.uvs,c=this.vertices,u=(l[s]-l[i])*r,h=(l[a]-l[o])*n,d=c[s]-c[i],p=c[a]-c[o];u<1&&(u=1),h<1&&(h=1),d<1&&(d=1),p<1&&(p=1),t.drawImage(e,l[i]*r,l[o]*n,u,h,c[i],c[o],d,p)},e.prototype._refresh=function(){t.prototype._refresh.call(this);var e=this.uvs,r=this._texture;this._origWidth=r.orig.width,this._origHeight=r.orig.height;var n=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=n*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-n*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},n(e,[{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._refresh()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("6nzH")).default);e.default=o},"qD+0":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=h(r("8USZ")),o=h(r("YdyU")),s=h(r("M75x")),a=h(r("BzvE")),l=r("Q5/2"),c=r("aH6o"),u=h(r("/MUw"));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(r,n,i,o,s){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));if(a.noFrame=!1,n||(a.noFrame=!0,n=new l.Rectangle(0,0,1,1)),r instanceof e&&(r=r.baseTexture),a.baseTexture=r,a._frame=n,a.trim=o,a.valid=!1,a.requiresUpdate=!1,a._uvs=null,a.orig=i||n,a._rotate=Number(s||0),!0===s)a._rotate=2;else if(a._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return r.hasLoaded?(a.noFrame&&(n=new l.Rectangle(0,0,r.width,r.height),r.on("update",a.onBaseTextureUpdated,a)),a.frame=n):r.once("loaded",a.onBaseTextureLoaded,a),a._updateID=0,a.transform=null,a.textureCacheIds=[],a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.update=function(){this.baseTexture.update()},e.prototype.onBaseTextureLoaded=function(t){this._updateID++,this.frame=this.noFrame?new l.Rectangle(0,0,t.width,t.height):this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},e.prototype.onBaseTextureUpdated=function(t){this._updateID++,this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},e.prototype.destroy=function(t){this.baseTexture&&(t&&(c.TextureCache[this.baseTexture.imageUrl]&&e.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},e.prototype._updateUvs=function(){this._uvs||(this._uvs=new s.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.fromImage=function(t,r,n,o){var s=c.TextureCache[t];return s||(s=new e(i.default.fromImage(t,r,n,o)),e.addToCache(s,t)),s},e.fromFrame=function(t){var e=c.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},e.fromCanvas=function(t,r){return new e(i.default.fromCanvas(t,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas"))},e.fromVideo=function(t,r){return"string"==typeof t?e.fromVideoUrl(t,r):new e(o.default.fromVideo(t,r))},e.fromVideoUrl=function(t,r){return new e(o.default.fromUrl(t,r))},e.from=function(t){return"string"==typeof t?c.TextureCache[t]||(null!==t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?e.fromVideoUrl(t):e.fromImage(t)):t instanceof HTMLImageElement?new e(i.default.from(t)):t instanceof HTMLCanvasElement?e.fromCanvas(t,u.default.SCALE_MODE,"HTMLCanvasElement"):t instanceof HTMLVideoElement?e.fromVideo(t):t instanceof i.default?new e(t):t},e.fromLoader=function(t,r,n){var o=new i.default(t,void 0,(0,c.getResolutionOfUrl)(r)),s=new e(o);return o.imageUrl=r,n||(n=r),i.default.addToCache(s.baseTexture,n),e.addToCache(s,n),n!==r&&(i.default.addToCache(s.baseTexture,r),e.addToCache(s,r)),s},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),c.TextureCache[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),c.TextureCache[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=c.TextureCache[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete c.TextureCache[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)c.TextureCache[t.textureCacheIds[n]]===t&&delete c.TextureCache[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},n(e,[{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,n=t.width,i=t.height,o=e+n>this.baseTexture.width,s=r+i>this.baseTexture.height;if(o||s)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+e+" + "+n+" = "+(e+n)+" > "+this.baseTexture.width+" "+(o&&s?"and":"or")+" Y: "+r+" + "+i+" = "+(r+i)+" > "+this.baseTexture.height);this.valid=n&&i&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=t),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),e}(a.default);function p(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}e.default=d,d.EMPTY=new d(new i.default),p(d.EMPTY),p(d.EMPTY.baseTexture),d.WHITE=function(){var t=document.createElement("canvas");t.width=10,t.height=10;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,10,10),new d(new i.default(t))}(),p(d.WHITE),p(d.WHITE.baseTexture)},qKrd:function(t,e){t.exports=function(t){function e(e,r){this.object=e,this.domElement=void 0!==r?r:document,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:t.MOUSE.LEFT,ZOOM:t.MOUSE.MIDDLE,PAN:t.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),l=a.NONE},this.update=function(){var r=new t.Vector3,o=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),s=o.clone().inverse(),m=new t.Vector3,v=new t.Quaternion;return function(){var t=n.object.position;return r.copy(t).sub(n.target),r.applyQuaternion(o),u.setFromVector3(r),n.autoRotate&&l===a.NONE&&M(2*Math.PI/60/60*n.autoRotateSpeed),u.theta+=h.theta,u.phi+=h.phi,u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),n.target.add(p),r.setFromSpherical(u),r.applyQuaternion(s),t.copy(n.target).add(r),n.object.lookAt(n.target),!0===n.enableDamping?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor):h.set(0,0,0),d=1,p.set(0,0,0),!!(f||m.distanceToSquared(n.object.position)>c||8*(1-v.dot(n.object.quaternion))>c)&&(n.dispatchEvent(i),m.copy(n.object.position),v.copy(n.object.quaternion),f=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",j,!1),n.domElement.removeEventListener("mousedown",L,!1),n.domElement.removeEventListener("wheel",D,!1),n.domElement.removeEventListener("touchstart",k,!1),n.domElement.removeEventListener("touchend",B,!1),n.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",R,!1),window.removeEventListener("keydown",F,!1)};var n=this,i={type:"change"},o={type:"start"},s={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},l=a.NONE,c=1e-6,u=new t.Spherical,h=new t.Spherical,d=1,p=new t.Vector3,f=!1,m=new t.Vector2,v=new t.Vector2,g=new t.Vector2,y=new t.Vector2,x=new t.Vector2,b=new t.Vector2,w=new t.Vector2,_=new t.Vector2,S=new t.Vector2;function T(){return Math.pow(.95,n.zoomSpeed)}function M(t){h.theta-=t}function A(t){h.phi-=t}var E=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),p.add(e)}}(),C=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),p.add(e)}}(),P=function(){var e=new t.Vector3;return function(r,i){var o=n.domElement===document?n.domElement.body:n.domElement;if(n.object instanceof t.PerspectiveCamera){e.copy(n.object.position).sub(n.target);var s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),E(2*r*s/o.clientHeight,n.object.matrix),C(2*i*s/o.clientHeight,n.object.matrix)}else n.object instanceof t.OrthographicCamera?(E(r*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),C(i*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(e){n.object instanceof t.PerspectiveCamera?d/=e:n.object instanceof t.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object instanceof t.PerspectiveCamera?d*=e:n.object instanceof t.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t){if(!1!==n.enabled){if(t.preventDefault(),t.button===n.mouseButtons.ORBIT){if(!1===n.enableRotate)return;!function(t){m.set(t.clientX,t.clientY)}(t),l=a.ROTATE}else if(t.button===n.mouseButtons.ZOOM){if(!1===n.enableZoom)return;!function(t){w.set(t.clientX,t.clientY)}(t),l=a.DOLLY}else if(t.button===n.mouseButtons.PAN){if(!1===n.enablePan)return;!function(t){y.set(t.clientX,t.clientY)}(t),l=a.PAN}l!==a.NONE&&(document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",R,!1),n.dispatchEvent(o))}}function I(t){if(!1!==n.enabled)if(t.preventDefault(),l===a.ROTATE){if(!1===n.enableRotate)return;!function(t){v.set(t.clientX,t.clientY),g.subVectors(v,m);var e=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*g.x/e.clientWidth*n.rotateSpeed),A(2*Math.PI*g.y/e.clientHeight*n.rotateSpeed),m.copy(v),n.update()}(t)}else if(l===a.DOLLY){if(!1===n.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),S.subVectors(_,w),S.y>0?O(T()):S.y<0&&N(T()),w.copy(_),n.update()}(t)}else if(l===a.PAN){if(!1===n.enablePan)return;!function(t){x.set(t.clientX,t.clientY),b.subVectors(x,y),P(b.x,b.y),y.copy(x),n.update()}(t)}}function R(t){!1!==n.enabled&&(document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",R,!1),n.dispatchEvent(s),l=a.NONE)}function D(t){!1===n.enabled||!1===n.enableZoom||l!==a.NONE&&l!==a.ROTATE||(t.preventDefault(),t.stopPropagation(),function(t){t.deltaY<0?N(T()):t.deltaY>0&&O(T()),n.update()}(t),n.dispatchEvent(o),n.dispatchEvent(s))}function F(t){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&function(t){switch(t.keyCode){case n.keys.UP:P(0,n.keyPanSpeed),n.update();break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),n.update();break;case n.keys.LEFT:P(n.keyPanSpeed,0),n.update();break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),n.update()}}(t)}function k(t){if(!1!==n.enabled){switch(t.touches.length){case 1:if(!1===n.enableRotate)return;!function(t){m.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=a.TOUCH_ROTATE;break;case 2:if(!1===n.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);w.set(0,n)}(t),l=a.TOUCH_DOLLY;break;case 3:if(!1===n.enablePan)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=a.TOUCH_PAN;break;default:l=a.NONE}l!==a.NONE&&n.dispatchEvent(o)}}function U(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===n.enableRotate)return;if(l!==a.TOUCH_ROTATE)return;!function(t){v.set(t.touches[0].pageX,t.touches[0].pageY),g.subVectors(v,m);var e=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*g.x/e.clientWidth*n.rotateSpeed),A(2*Math.PI*g.y/e.clientHeight*n.rotateSpeed),m.copy(v),n.update()}(t);break;case 2:if(!1===n.enableZoom)return;if(l!==a.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);_.set(0,i),S.subVectors(_,w),S.y>0?N(T()):S.y<0&&O(T()),w.copy(_),n.update()}(t);break;case 3:if(!1===n.enablePan)return;if(l!==a.TOUCH_PAN)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY),b.subVectors(x,y),P(b.x,b.y),y.copy(x),n.update()}(t);break;default:l=a.NONE}}function B(t){!1!==n.enabled&&(n.dispatchEvent(s),l=a.NONE)}function j(t){t.preventDefault()}n.domElement.addEventListener("contextmenu",j,!1),n.domElement.addEventListener("mousedown",L,!1),n.domElement.addEventListener("wheel",D,!1),n.domElement.addEventListener("touchstart",k,!1),n.domElement.addEventListener("touchend",B,!1),n.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",F,!1),this.update()}return(e.prototype=Object.create(t.EventDispatcher.prototype)).constructor=e,Object.defineProperties(e.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}}),e}},qLff:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r("/B0E")),o=l(r("vpgX")),s=l(r("5Ljx")),a=l(r("+QcN"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(r,n,a,l){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var c=(0,o.default)(l=l||5,!1),u=(0,s.default)(l),h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,c,u));return h.resolution=a||i.settings.RESOLUTION,h._quality=0,h.quality=n||4,h.strength=r||8,h.firstRun=!0,h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.apply=function(t,e,r,n){if(this.firstRun){var i=(0,a.default)(t.renderer.gl);this.vertexSrc=(0,o.default)(i,!1),this.fragmentSrc=(0,s.default)(i),this.firstRun=!1}if(this.uniforms.strength=1/r.size.height*(r.size.height/e.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{for(var l=t.getRenderTarget(!0),c=e,u=l,h=0;h<this.passes-1;h++){t.applyFilter(this,c,u,!0);var d=u;u=c,c=d}t.applyFilter(this,c,r,n),t.returnRenderTarget(l)}},n(e,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),e}(i.Filter);e.default=c},qOJP:function(t,e,r){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},qisP:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r("Q5/2"),o=function(t){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.position=new i.ObservablePoint(r.onChange,r,0,0),r.scale=new i.ObservablePoint(r.onChange,r,1,1),r.pivot=new i.ObservablePoint(r.onChange,r,0,0),r.skew=new i.ObservablePoint(r.updateSkew,r,0,0),r._rotation=0,r._cx=1,r._sx=0,r._cy=0,r._sy=1,r._localID=0,r._currentLocalID=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onChange=function(){this._localID++},e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},e.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},e.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},e.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},n(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(r("mAOr")).default);e.default=o},qo3d:function(t,e,r){"use strict";e.__esModule=!0;var n=y(r("PjB0")),i=y(r("vNDr")),o=y(r("0Emr")),s=y(r("QAU/")),a=y(r("EoU7")),l=y(r("MIKO")),c=y(r("yMAt")),u=y(r("8USZ")),h=y(r("8o49")),d=y(r("m0PG")),p=y(r("n5XU")),f=y(r("ZSfh")),m=r("aH6o"),v=y(r("8QNu")),g=r("FjAT");function y(t){return t&&t.__esModule?t:{default:t}}var x=0,b=function(t){function e(r,n,s){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,"WebGL",r,n,s));return a.legacy=a.options.legacy,a.legacy&&(v.default.VertexArrayObject.FORCE_NATIVE=!0),a.type=g.RENDERER_TYPE.WEBGL,a.handleContextLost=a.handleContextLost.bind(a),a.handleContextRestored=a.handleContextRestored.bind(a),a.view.addEventListener("webglcontextlost",a.handleContextLost,!1),a.view.addEventListener("webglcontextrestored",a.handleContextRestored,!1),a._contextOptions={alpha:a.transparent,antialias:a.options.antialias,premultipliedAlpha:a.transparent&&"notMultiplied"!==a.transparent,stencil:!0,preserveDrawingBuffer:a.options.preserveDrawingBuffer,powerPreference:a.options.powerPreference},a._backgroundColorRgba[3]=a.transparent?0:1,a.maskManager=new i.default(a),a.stencilManager=new o.default(a),a.emptyRenderer=new l.default(a),a.currentRenderer=a.emptyRenderer,a.textureManager=null,a.filterManager=null,a.initPlugins(),a.options.context&&(0,f.default)(a.options.context),a.gl=a.options.context||v.default.createContext(a.view,a._contextOptions),a.CONTEXT_UID=x++,a.state=new d.default(a.gl),a.renderingToScreen=!0,a.boundTextures=null,a._activeShader=null,a._activeVao=null,a._activeRenderTarget=null,a._initContext(),a.drawModes=(0,p.default)(a.gl),a._nextTextureLocation=0,a.setBlendMode(0),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._initContext=function(){var t=this.gl;t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext();var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(e),this.emptyTextures=new Array(e),this.textureManager=new c.default(this),this.filterManager=new s.default(this),this.textureGC=new h.default(this),this.state.resetToDefault(),this.rootRenderTarget=new a.default(t,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var r=new v.default.GLTexture.fromData(t,null,1,1),n={_glTextures:{}};n._glTextures[this.CONTEXT_UID]={};for(var i=0;i<e;i++){var o=new u.default;o._glTextures[this.CONTEXT_UID]=r,this.boundTextures[i]=n,this.emptyTextures[i]=o,this.bindTexture(null,i)}this.emit("context",t),this.resize(this.screen.width,this.screen.height)},e.prototype.render=function(t,e,r,n,i){if(this.renderingToScreen=!e,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.bindRenderTexture(e,n),this.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this._activeRenderTarget.clear(),t.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.resize=function(t,e){n.default.prototype.resize.call(this,t,e),this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},e.prototype.setBlendMode=function(t){this.state.setBlendMode(t)},e.prototype.clear=function(t){this._activeRenderTarget.clear(t)},e.prototype.setTransform=function(t){this._activeRenderTarget.transform=t},e.prototype.clearRenderTexture=function(t,e){var r=t.baseTexture._glRenderTargets[this.CONTEXT_UID];return r&&r.clear(e),this},e.prototype.bindRenderTexture=function(t,e){var r=void 0;if(t){var n=t.baseTexture;n._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(n,0),this.unbindTexture(n),(r=n._glRenderTargets[this.CONTEXT_UID]).setFrame(t.frame)}else r=this.rootRenderTarget;return r.transform=e,this.bindRenderTarget(r),this},e.prototype.bindRenderTarget=function(t){return t!==this._activeRenderTarget&&(this._activeRenderTarget=t,t.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(t.stencilMaskStack)),this},e.prototype.bindShader=function(t,e){return this._activeShader!==t&&(this._activeShader=t,t.bind(),!1!==e&&(t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},e.prototype.bindTexture=function(t,e,r){if((t=(t=t||this.emptyTextures[e]).baseTexture||t).touched=this.textureGC.count,r)e=e||0;else{for(var n=0;n<this.boundTextures.length;n++)if(this.boundTextures[n]===t)return n;void 0===e&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,e=this.boundTextures.length-this._nextTextureLocation-1)}var i=this.gl,o=t._glTextures[this.CONTEXT_UID];return o?(this.boundTextures[e]=t,i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,o.texture)):this.textureManager.updateTexture(t,e),e},e.prototype.unbindTexture=function(t){var e=this.gl;t=t.baseTexture||t;for(var r=0;r<this.boundTextures.length;r++)this.boundTextures[r]===t&&(this.boundTextures[r]=this.emptyTextures[r],e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture));return this},e.prototype.createVao=function(){return new v.default.VertexArrayObject(this.gl,this.state.attribState)},e.prototype.bindVao=function(t){return this._activeVao===t?this:(t?t.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=t,this)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.emptyTextures[t];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},e.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),t.prototype.destroy.call(this,e),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},e}(n.default);e.default=b,m.pluginTarget.mixin(b)},qsr7:function(t,e,r){"use strict";e.__esModule=!0,e.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0}},rN5J:function(t,e,r){var n=r("NZvU"),i=r("aoKs");t.exports=function(t,e){for(var r={},o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),s=0;s<o;s++){var a=t.getActiveUniform(e,s),l=a.name.replace(/\[.*?\]/,""),c=n(t,a.type);r[l]={type:c,size:a.size,location:t.getUniformLocation(e,l),value:i(c,a.size)}}return r}},rW72:function(t,e,r){t.exports={compileProgram:r("JD0k"),defaultValue:r("aoKs"),extractAttributes:r("7IZn"),extractUniforms:r("rN5J"),generateUniformAccessObject:r("sMVv"),setPrecision:r("Qn7E"),mapSize:r("3JLa"),mapType:r("NZvU")}},"rdl+":function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0},t.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},t}();e.default=n},"s+UU":function(t,e,r){"use strict";var n=r("6MRC"),i=r("FvzS"),o=r("WFWZ"),s=r("UEsV"),a=r("hfO1"),l=r("la7E");class c{constructor(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let t,e=!1;if(this.closed)return;let{_parent:r,_parents:c,_unsubscribe:h,_subscriptions:d}=this;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;let p=-1,f=c?c.length:0;for(;r;)r.remove(this),r=++p<f&&c[p]||null;if(Object(o.a)(h)&&Object(s.a)(h).call(this)===a.a&&(e=!0,t=t||(a.a.e instanceof l.a?u(a.a.e.errors):[a.a.e])),Object(n.a)(d))for(p=-1,f=d.length;++p<f;){const r=d[p];if(Object(i.a)(r)&&Object(s.a)(r.unsubscribe).call(r)===a.a){e=!0,t=t||[];let r=a.a.e;r instanceof l.a?t=t.concat(u(r.errors)):t.push(r)}}if(e)throw new l.a(t)}add(t){if(!t||t===c.EMPTY)return c.EMPTY;if(t===this)return this;let e=t;switch(typeof t){case"function":e=new c(t);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if("function"!=typeof e._addParent){const t=e;(e=new c)._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(e),e._addParent(this),e}remove(t){const e=this._subscriptions;if(e){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}}_addParent(t){let{_parent:e,_parents:r}=this;e&&e!==t?r?-1===r.indexOf(t)&&r.push(t):this._parents=[t]:this._parent=t}}function u(t){return t.reduce((t,e)=>t.concat(e instanceof l.a?e.errors:e),[])}e.a=c,c.EMPTY=function(t){return t.closed=!0,t}(new c)},s4oU:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("8QNu")),i=o(r("fq6b"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e,r,n,i){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<r.length;++o){var s=r[o];s={attribute:s.attribute,size:s.size,uploadFunction:s.uploadFunction,unsignedByte:s.unsignedByte,offset:s.offset},n[o]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.gl,e=0;this.indices=(0,i.default)(this.size),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];o.offset=e,e+=o.size,this.dynamicStride+=o.size}var s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=n.default.GLBuffer.createVertexBuffer(t,s,t.STREAM_DRAW);var a=0;this.staticStride=0;for(var l=0;l<this.staticProperties.length;++l){var c=this.staticProperties[l];c.offset=a,a+=c.size,this.staticStride+=c.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=n.default.GLBuffer.createVertexBuffer(t,u,t.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(t).addIndex(this.indexBuffer);for(var h=0;h<this.dynamicProperties.length;++h){var d=this.dynamicProperties[h];d.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*d.offset):this.vao.addAttribute(this.dynamicBuffer,d.attribute,t.FLOAT,!1,4*this.dynamicStride,4*d.offset)}for(var p=0;p<this.staticProperties.length;++p){var f=this.staticProperties[p];f.unsignedByte?this.vao.addAttribute(this.staticBuffer,f.attribute,t.UNSIGNED_BYTE,!0,4*this.staticStride,4*f.offset):this.vao.addAttribute(this.staticBuffer,f.attribute,t.FLOAT,!1,4*this.staticStride,4*f.offset)}},t.prototype.uploadDynamic=function(t,e,r){for(var n=0;n<this.dynamicProperties.length;n++){var i=this.dynamicProperties[n];i.uploadFunction(t,e,r,i.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer.upload()},t.prototype.uploadStatic=function(t,e,r){for(var n=0;n<this.staticProperties.length;n++){var i=this.staticProperties[n];i.uploadFunction(t,e,r,i.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer.upload()},t.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},t}();e.default=s},sMVv:function(t,e){var r=function(t){return function(){return this.data[t].value}},n={float:function(t,e,r){t.uniform1f(e,r)},vec2:function(t,e,r){t.uniform2f(e,r[0],r[1])},vec3:function(t,e,r){t.uniform3f(e,r[0],r[1],r[2])},vec4:function(t,e,r){t.uniform4f(e,r[0],r[1],r[2],r[3])},int:function(t,e,r){t.uniform1i(e,r)},ivec2:function(t,e,r){t.uniform2i(e,r[0],r[1])},ivec3:function(t,e,r){t.uniform3i(e,r[0],r[1],r[2])},ivec4:function(t,e,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},bool:function(t,e,r){t.uniform1i(e,r)},bvec2:function(t,e,r){t.uniform2i(e,r[0],r[1])},bvec3:function(t,e,r){t.uniform3i(e,r[0],r[1],r[2])},bvec4:function(t,e,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},mat2:function(t,e,r){t.uniformMatrix2fv(e,!1,r)},mat3:function(t,e,r){t.uniformMatrix3fv(e,!1,r)},mat4:function(t,e,r){t.uniformMatrix4fv(e,!1,r)},sampler2D:function(t,e,r){t.uniform1i(e,r)}},i={float:function(t,e,r){t.uniform1fv(e,r)},vec2:function(t,e,r){t.uniform2fv(e,r)},vec3:function(t,e,r){t.uniform3fv(e,r)},vec4:function(t,e,r){t.uniform4fv(e,r)},int:function(t,e,r){t.uniform1iv(e,r)},ivec2:function(t,e,r){t.uniform2iv(e,r)},ivec3:function(t,e,r){t.uniform3iv(e,r)},ivec4:function(t,e,r){t.uniform4iv(e,r)},bool:function(t,e,r){t.uniform1iv(e,r)},bvec2:function(t,e,r){t.uniform2iv(e,r)},bvec3:function(t,e,r){t.uniform3iv(e,r)},bvec4:function(t,e,r){t.uniform4iv(e,r)},sampler2D:function(t,e,r){t.uniform1iv(e,r)}};function o(t,e){return function(r){this.data[t].value=r;var o=this.data[t].location;1===e.size?n[e.type](this.gl,o,r):i[e.type](this.gl,o,r)}}function s(t,e){for(var r=e,n=0;n<t.length-1;n++){var i=r[t[n]]||{data:{}};r[t[n]]=i,r=i}return r}t.exports=function(t,e){var n={data:{}};n.gl=t;for(var i=Object.keys(e),a=0;a<i.length;a++){var l=i[a],c=l.split("."),u=c[c.length-1],h=s(c,n),d=e[l];h.data[u]=d,h.gl=t,Object.defineProperty(h,u,{get:r(u),set:o(u,d)})}return n}},sOR5:function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},slDu:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=t.mesh,r=t.particles,n=t.extras,o=t.filters,s=t.prepare,a=t.loaders,l=t.interaction;Object.defineProperties(t,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return i("You do not need to use a PIXI Stage any more, you can simply render any container."),t.Container}},DisplayObjectContainer:{get:function(){return i("DisplayObjectContainer has been shortened to Container, please use Container from now on."),t.Container}},Strip:{get:function(){return i("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),e.Mesh}},Rope:{get:function(){return i("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),e.Rope}},ParticleContainer:{get:function(){return i("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),r.ParticleContainer}},MovieClip:{get:function(){return i("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),n.AnimatedSprite}},TilingSprite:{get:function(){return i("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),n.TilingSprite}},BitmapText:{get:function(){return i("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),n.BitmapText}},blendModes:{get:function(){return i("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),t.BLEND_MODES}},scaleModes:{get:function(){return i("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),t.SCALE_MODES}},BaseTextureCache:{get:function(){return i("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),t.utils.BaseTextureCache}},TextureCache:{get:function(){return i("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),t.utils.TextureCache}},math:{get:function(){return i("The math namespace is deprecated, please access members already accessible on PIXI."),t}},AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.Filter}},TransformManual:{get:function(){return i("TransformManual has been renamed to TransformBase, please update your pixi-spine"),t.TransformBase}},TARGET_FPMS:{get:function(){return i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS},set:function(e){i("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),t.settings.TARGET_FPMS=e}},FILTER_RESOLUTION:{get:function(){return i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION},set:function(e){i("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),t.settings.FILTER_RESOLUTION=e}},RESOLUTION:{get:function(){return i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION},set:function(e){i("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),t.settings.RESOLUTION=e}},MIPMAP_TEXTURES:{get:function(){return i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES},set:function(e){i("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),t.settings.MIPMAP_TEXTURES=e}},SPRITE_BATCH_SIZE:{get:function(){return i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE},set:function(e){i("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),t.settings.SPRITE_BATCH_SIZE=e}},SPRITE_MAX_TEXTURES:{get:function(){return i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES},set:function(e){i("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),t.settings.SPRITE_MAX_TEXTURES=e}},RETINA_PREFIX:{get:function(){return i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX},set:function(e){i("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),t.settings.RETINA_PREFIX=e}},DEFAULT_RENDER_OPTIONS:{get:function(){return i("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),t.settings.RENDER_OPTIONS}}});for(var c=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],u=function(e){var r=c[e];Object.defineProperty(t[r.parent],"DEFAULT",{get:function(){return i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),t.settings[r.target]},set:function(e){i("PIXI."+r.parent+".DEFAULT has been deprecated, please use PIXI.settings."+r.target),t.settings[r.target]=e}})},h=0;h<c.length;h++)u(h);Object.defineProperties(t.settings,{PRECISION:{get:function(){return i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT},set:function(e){i("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),t.settings.PRECISION_FRAGMENT=e}}}),n.AnimatedSprite&&Object.defineProperties(n,{MovieClip:{get:function(){return i("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),n.AnimatedSprite}}}),n&&Object.defineProperties(n,{TextureTransform:{get:function(){return i("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),t.TextureMatrix}}}),t.DisplayObject.prototype.generateTexture=function(t,e,r){return i("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),t.generateTexture(this,e,r)},t.Graphics.prototype.generateTexture=function(t,e){return i("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(t,e)},t.GroupD8.isSwapWidthHeight=function(e){return i("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),t.GroupD8.isVertical(e)},t.RenderTexture.prototype.render=function(t,e,r,n){this.legacyRenderer.render(t,this,r,e,!n),i("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},t.RenderTexture.prototype.getImage=function(t){return i("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(t)},t.RenderTexture.prototype.getBase64=function(t){return i("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(t)},t.RenderTexture.prototype.getCanvas=function(t){return i("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(t)},t.RenderTexture.prototype.getPixels=function(t){return i("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(t)},t.Sprite.prototype.setTexture=function(t){this.texture=t,i("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},n.BitmapText&&(n.BitmapText.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}),t.Text.prototype.setText=function(t){this.text=t,i("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},t.Text.calculateFontProperties=function(e){return i("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),t.TextMetrics.measureFont(e)},Object.defineProperties(t.Text,{fontPropertiesCache:{get:function(){return i("Text.fontPropertiesCache is deprecated"),t.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return i("Text.fontPropertiesCanvas is deprecated"),t.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return i("Text.fontPropertiesContext is deprecated"),t.TextMetrics._context}}}),t.Text.prototype.setStyle=function(t){this.style=t,i("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},t.Text.prototype.determineFontProperties=function(e){return i("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),t.TextMetrics.measureFont(e)},t.Text.getFontStyle=function(e){return i("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(e=e||{})instanceof t.TextStyle||(e=new t.TextStyle(e)),e.toFontString()},Object.defineProperties(t.TextStyle.prototype,{font:{get:function(){return i("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on"),this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+("number"==typeof this._fontSize?this._fontSize+"px":this._fontSize)+" "+this._fontFamily},set:function(t){i("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),this._fontStyle=t.indexOf("italic")>1?"italic":t.indexOf("oblique")>-1?"oblique":"normal",this._fontVariant=t.indexOf("small-caps")>-1?"small-caps":"normal";var e=t.split(" "),r=-1;this._fontSize=26;for(var n=0;n<e.length;++n)if(e[n].match(/(px|pt|em|%)/)){r=n,this._fontSize=e[n];break}this._fontWeight="normal";for(var o=0;o<r;++o)if(e[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=e[o];break}if(r>-1&&r<e.length-1){this._fontFamily="";for(var s=r+1;s<e.length;++s)this._fontFamily+=e[s]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),t.Texture.prototype.setFrame=function(t){this.frame=t,i("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},t.Texture.addTextureToCache=function(e,r){t.Texture.addToCache(e,r),i("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},t.Texture.removeTextureFromCache=function(e){return i("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),t.BaseTexture.removeFromCache(e),t.Texture.removeFromCache(e)},Object.defineProperties(o,{AbstractFilter:{get:function(){return i("AstractFilter has been renamed to Filter, please use PIXI.Filter"),t.AbstractFilter}},SpriteMaskFilter:{get:function(){return i("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),t.SpriteMaskFilter}},VoidFilter:{get:function(){return i("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),o.AlphaFilter}}}),t.utils.uuid=function(){return i("utils.uuid() is deprecated, please use utils.uid() from now on."),t.utils.uid()},t.utils.canUseNewCanvasBlendModes=function(){return i("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),t.CanvasTinter.canUseMultiply};var d=!0;if(Object.defineProperty(t.utils,"_saidHello",{set:function(t){t&&(i("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),d=t},get:function(){return d}}),s.BasePrepare&&(s.BasePrepare.prototype.register=function(t,e){return i("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),t&&this.registerFindHook(t),e&&this.registerUploadHook(e),this}),s.canvas&&Object.defineProperty(s.canvas,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),s.webgl&&Object.defineProperty(s.webgl,"UPLOADS_PER_FRAME",{set:function(){i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return i("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),a.Loader){var p=a.Resource,f=a.Loader;Object.defineProperties(p.prototype,{isJson:{get:function(){return i("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===p.TYPE.JSON}},isXml:{get:function(){return i("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===p.TYPE.XML}},isImage:{get:function(){return i("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===p.TYPE.IMAGE}},isAudio:{get:function(){return i("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===p.TYPE.AUDIO}},isVideo:{get:function(){return i("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===p.TYPE.VIDEO}}}),Object.defineProperties(f.prototype,{before:{get:function(){return i("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return i("The after() method is deprecated, please use use()."),this.use}}})}l.interactiveTarget&&Object.defineProperty(l.interactiveTarget,"defaultCursor",{set:function(t){i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=t},get:function(){return i("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}}),l.InteractionManager&&(Object.defineProperty(l.InteractionManager,"defaultCursorStyle",{set:function(t){i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=t},get:function(){return i("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(l.InteractionManager,"currentCursorStyle",{set:function(t){i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=t},get:function(){return i("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))};var n={};function i(t){if(!n[t]){var e=(new Error).stack;"undefined"==typeof e?console.warn("Deprecation Warning: ",t):(e=e.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t),console.warn(e),console.groupEnd()):(console.warn("Deprecation Warning: ",t),console.warn(e))),n[t]=!0}}},tIUM:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},n(t,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(t){this._flags=t}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(t){this._doSet(this.constructor.FLAGS.OVER,t)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)}}]),t}();e.default=i,i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4})},tOxb:function(t,e,r){"use strict";t.exports=function(t,e){for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[(e=e||{}).strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[r.key[o]]=n[o]||"";return i[r.q.name]={},i[r.key[12]].replace(r.q.parser,function(t,e,n){e&&(i[r.q.name][e]=n)}),i}},thfa:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("5tzz")),i=r("FjAT"),o=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e}return t.prototype.render=function(t){var e=this.renderer,r=e.context,n=t.worldAlpha,o=t.transform.worldTransform,s=e.resolution;this._prevTint!==this.tint&&(this.dirty=!0),r.setTransform(o.a*s,o.b*s,o.c*s,o.d*s,o.tx*s,o.ty*s),t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),e.setBlendMode(t.blendMode);for(var a=0;a<t.graphicsData.length;a++){var l=t.graphicsData[a],c=l.shape,u=l._fillTint,h=l._lineTint;if(r.lineWidth=l.lineWidth,l.type===i.SHAPES.POLY){r.beginPath(),this.renderPolygon(c.points,c.closed,r);for(var d=0;d<l.holes.length;d++)this.renderPolygon(l.holes[d].points,!0,r);l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RECT)(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fillRect(c.x,c.y,c.width,c.height)),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.strokeRect(c.x,c.y,c.width,c.height));else if(l.type===i.SHAPES.CIRC)r.beginPath(),r.arc(c.x,c.y,c.radius,0,2*Math.PI),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke());else if(l.type===i.SHAPES.ELIP){var p=2*c.width,f=2*c.height,m=c.x-p/2,v=c.y-f/2;r.beginPath();var g=p/2*.5522848,y=f/2*.5522848,x=m+p,b=v+f,w=m+p/2,_=v+f/2;r.moveTo(m,_),r.bezierCurveTo(m,_-y,w-g,v,w,v),r.bezierCurveTo(w+g,v,x,_-y,x,_),r.bezierCurveTo(x,_+y,w+g,b,w,b),r.bezierCurveTo(w-g,b,m,_+y,m,_),r.closePath(),l.fill&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}else if(l.type===i.SHAPES.RREC){var S=c.x,T=c.y,M=c.width,A=c.height,E=c.radius,C=Math.min(M,A)/2|0;E=E>C?C:E,r.beginPath(),r.moveTo(S,T+E),r.lineTo(S,T+A-E),r.quadraticCurveTo(S,T+A,S+E,T+A),r.lineTo(S+M-E,T+A),r.quadraticCurveTo(S+M,T+A,S+M,T+A-E),r.lineTo(S+M,T+E),r.quadraticCurveTo(S+M,T,S+M-E,T),r.lineTo(S+E,T),r.quadraticCurveTo(S,T,S,T+E),r.closePath(),(l.fillColor||0===l.fillColor)&&(r.globalAlpha=l.fillAlpha*n,r.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),r.fill()),l.lineWidth&&(r.globalAlpha=l.lineAlpha*n,r.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),r.stroke())}}},t.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint;for(var e=(t.tint>>16&255)/255,r=(t.tint>>8&255)/255,n=(255&t.tint)/255,i=0;i<t.graphicsData.length;++i){var o=t.graphicsData[i],s=0|o.fillColor,a=0|o.lineColor;o._fillTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*r*255<<8)+(255&s)/255*n*255,o._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*n*255}},t.prototype.renderPolygon=function(t,e,r){r.moveTo(t[0],t[1]);for(var n=1;n<t.length/2;++n)r.lineTo(t[2*n],t[2*n+1]);e&&r.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();e.default=o,n.default.registerPlugin("graphics",o)},tl0p:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("8QNu")),i=o(r("fq6b"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e,r){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.gl=e,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var o=0;o<4;o++)this.interleaved[4*o]=this.vertices[2*o],this.interleaved[4*o+1]=this.vertices[2*o+1],this.interleaved[4*o+2]=this.uvs[2*o],this.interleaved[4*o+3]=this.uvs[2*o+1];this.indices=(0,i.default)(1),this.vertexBuffer=n.default.GLBuffer.createVertexBuffer(e,this.interleaved,e.STATIC_DRAW),this.indexBuffer=n.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.vao=new n.default.VertexArrayObject(e,r)}return t.prototype.initVao=function(t){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,t.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,t.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},t.prototype.map=function(t,e){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,n=e.y,this.vertices[0]=r=e.x,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this},t.prototype.upload=function(){for(var t=0;t<4;t++)this.interleaved[4*t]=this.vertices[2*t],this.interleaved[4*t+1]=this.vertices[2*t+1],this.interleaved[4*t+2]=this.uvs[2*t],this.interleaved[4*t+3]=this.uvs[2*t+1];return this.vertexBuffer.upload(this.interleaved),this},t.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},t}();e.default=s},tv36:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.vertices=new ArrayBuffer(e),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return t.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},t}();e.default=n},umD3:function(t,e,r){"use strict";function n(){}function i(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}e.__esModule=!0,e.eachSeries=function(t,e,r,n){var i=0,o=t.length;!function s(a){a||i===o?r&&r(a):n?setTimeout(function(){e(t[i++],s)},1):e(t[i++],s)}()},e.queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=0,o={_tasks:[],concurrency:e,saturated:n,unsaturated:n,buffer:e/4,empty:n,drain:n,error:n,started:!1,paused:!1,push:function(t,e){s(t,!1,e)},kill:function(){r=0,o.drain=n,o.started=!1,o._tasks=[]},unshift:function(t,e){s(t,!0,e)},process:function(){for(;!o.paused&&r<o.concurrency&&o._tasks.length;){var e=o._tasks.shift();0===o._tasks.length&&o.empty(),(r+=1)===o.concurrency&&o.saturated(),t(e.data,i(a(e)))}},length:function(){return o._tasks.length},running:function(){return r},idle:function(){return o._tasks.length+r===0},pause:function(){!0!==o.paused&&(o.paused=!0)},resume:function(){if(!1!==o.paused){o.paused=!1;for(var t=1;t<=o.concurrency;t++)o.process()}}};function s(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(o.started=!0,null==t&&o.idle())setTimeout(function(){return o.drain()},1);else{var i={data:t,callback:"function"==typeof r?r:n};e?o._tasks.unshift(i):o._tasks.push(i),setTimeout(function(){return o.process()},1)}}function a(t){return function(){r-=1,t.callback.apply(t,arguments),null!=arguments[0]&&o.error(arguments[0],t.data),r<=o.concurrency-o.buffer&&o.unsaturated(),o.idle()&&o.drain(),o.process()}}return o}},vNDr:function(t,e,r){"use strict";e.__esModule=!0;var n=o(r("3psj")),i=o(r("hScZ"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.scissor=!1,n.scissorData=null,n.scissorRenderTarget=null,n.enableScissor=!0,n.alphaMaskPool=[],n.alphaMaskIndex=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.pushMask=function(t,e){if(e.texture)this.pushSpriteMask(t,e);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&e.isFastRect()){var r=e.worldTransform,n=Math.atan2(r.b,r.a);(n=Math.round(n*(180/Math.PI)))%90?this.pushStencilMask(e):this.pushScissorMask(t,e)}else this.pushStencilMask(e)},e.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(t,e):this.popStencilMask(t,e)},e.prototype.pushSpriteMask=function(t,e){var r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new i.default(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e,t.filterArea=e.getBounds(!0),this.renderer.filterManager.pushFilter(t,r),this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},e.prototype.pushStencilMask=function(t){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(t)},e.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},e.prototype.pushScissorMask=function(t,e){e.renderable=!0;var r=this.renderer._activeRenderTarget,n=e.getBounds();n.fit(r.size),e.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(n.x*i,(r.root?r.size.height-n.y-n.height:n.y)*i,n.width*i,n.height*i),this.scissorRenderTarget=r,this.scissorData=e,this.scissor=!0},e.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var t=this.renderer.gl;t.disable(t.SCISSOR_TEST)},e}(n.default);e.default=s},ves3:function(t,e,r){"use strict";var n=r("bbL7"),i=r("2zkT"),o=r("73T8"),s=r("dMus"),a=r("zOxy"),l=r("7VlU");class c{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const e=new c;return e.source=this,e.operator=t,e}subscribe(t,e,r){const{operator:n}=this,a=function(t,e,r){if(t){if(t instanceof i.a)return t;if(t[o.a])return t[o.a]()}return t||e||r?new i.a(t,e,r):new i.a(s.a)}(t,e,r);if(n?n.call(a,this.source):a.add(this.source||!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}_trySubscribe(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}}forEach(t,e){if(e||(n.a.Rx&&n.a.Rx.config&&n.a.Rx.config.Promise?e=n.a.Rx.config.Promise:n.a.Promise&&(e=n.a.Promise)),!e)throw new Error("no Promise impl found");return new e((e,r)=>{let n;n=this.subscribe(e=>{if(n)try{t(e)}catch(t){r(t),n.unsubscribe()}else t(e)},r,e)})}_subscribe(t){return this.source.subscribe(t)}[a.a](){return this}pipe(...t){return 0===t.length?this:Object(l.b)(t)(this)}toPromise(t){if(t||(n.a.Rx&&n.a.Rx.config&&n.a.Rx.config.Promise?t=n.a.Rx.config.Promise:n.a.Promise&&(t=n.a.Promise)),!t)throw new Error("no Promise impl found");return new t((t,e)=>{let r;this.subscribe(t=>r=t,t=>e(t),()=>t(r))})}}e.a=c,c.create=(t=>new c(t))},vmzn:function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,i=+new Date;t.diff=i-(r||i),t.prev=r,t.curr=i,r=i;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;a++;var i=e.formatters[n];return"function"==typeof i&&(r=i.call(t,o[a]),o.splice(a,1),a--),r}),e.formatArgs.call(t,o),(n.log||e.log||console.log.bind(console)).apply(t,o)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var o=e.instances[r];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r("EarI"),e.instances=[],e.names=[],e.skips=[],e.formatters={}},vpgX:function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=Math.ceil(t/2),i=n,o="",s=void 0;s=e?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var l=s.replace("%index%",a);o+=l=l.replace("%sampleIndex%",a-(r-1)+".0"),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",t)};var n=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n")},vwuV:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r("/MUw")),o=function(){function t(e,r,n){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||i.default.RESOLUTION,this.resize(e,r)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},n(t,[{key:"width",get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},{key:"height",get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}]),t}();e.default=o},x35b:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={};r.d(n,"audit",function(){return nS}),r.d(n,"auditTime",function(){return sS}),r.d(n,"buffer",function(){return bw}),r.d(n,"bufferCount",function(){return Sw}),r.d(n,"bufferTime",function(){return Ew}),r.d(n,"bufferToggle",function(){return Rw}),r.d(n,"bufferWhen",function(){return kw}),r.d(n,"catchError",function(){return ce}),r.d(n,"combineAll",function(){return jw}),r.d(n,"combineLatest",function(){return sb}),r.d(n,"concat",function(){return zw}),r.d(n,"concatAll",function(){return Ve}),r.d(n,"concatMap",function(){return L}),r.d(n,"concatMapTo",function(){return Vw}),r.d(n,"count",function(){return Gw}),r.d(n,"debounce",function(){return Zw}),r.d(n,"debounceTime",function(){return Kw}),r.d(n,"defaultIfEmpty",function(){return dr}),r.d(n,"delay",function(){return r_}),r.d(n,"delayWhen",function(){return s_}),r.d(n,"dematerialize",function(){return Xw}),r.d(n,"distinct",function(){return d_}),r.d(n,"distinctUntilChanged",function(){return m_}),r.d(n,"distinctUntilKeyChanged",function(){return y_}),r.d(n,"elementAt",function(){return L_}),r.d(n,"every",function(){return Je}),r.d(n,"exhaust",function(){return S_}),r.d(n,"exhaustMap",function(){return A_}),r.d(n,"expand",function(){return P_}),r.d(n,"filter",function(){return D}),r.d(n,"finalize",function(){return D_}),r.d(n,"find",function(){return B_}),r.d(n,"findIndex",function(){return V_}),r.d(n,"first",function(){return We}),r.d(n,"groupBy",function(){return W_}),r.d(n,"ignoreElements",function(){return Q_}),r.d(n,"isEmpty",function(){return tS}),r.d(n,"last",function(){return tr}),r.d(n,"map",function(){return B}),r.d(n,"mapTo",function(){return lS}),r.d(n,"materialize",function(){return hS}),r.d(n,"max",function(){return fS}),r.d(n,"merge",function(){return mS}),r.d(n,"mergeAll",function(){return ze.a}),r.d(n,"mergeMap",function(){return N.a}),r.d(n,"flatMap",function(){return N.a}),r.d(n,"mergeMapTo",function(){return vS}),r.d(n,"mergeScan",function(){return bS}),r.d(n,"min",function(){return SS}),r.d(n,"multicast",function(){return TS.a}),r.d(n,"observeOn",function(){return Re}),r.d(n,"onErrorResumeNext",function(){return Fb}),r.d(n,"pairwise",function(){return MS}),r.d(n,"partition",function(){return CS}),r.d(n,"pluck",function(){return PS}),r.d(n,"publish",function(){return OS}),r.d(n,"publishBehavior",function(){return NS}),r.d(n,"publishLast",function(){return IS}),r.d(n,"publishReplay",function(){return LS}),r.d(n,"race",function(){return RS}),r.d(n,"reduce",function(){return vr}),r.d(n,"repeat",function(){return DS}),r.d(n,"repeatWhen",function(){return US}),r.d(n,"retry",function(){return zS}),r.d(n,"retryWhen",function(){return HS}),r.d(n,"refCount",function(){return BM.a}),r.d(n,"sample",function(){return qS}),r.d(n,"sampleTime",function(){return JS}),r.d(n,"scan",function(){return or}),r.d(n,"sequenceEqual",function(){return tT}),r.d(n,"share",function(){return jM.a}),r.d(n,"shareReplay",function(){return oT}),r.d(n,"single",function(){return sT}),r.d(n,"skip",function(){return cT}),r.d(n,"skipLast",function(){return dT}),r.d(n,"skipUntil",function(){return mT}),r.d(n,"skipWhile",function(){return yT}),r.d(n,"startWith",function(){return wT}),r.d(n,"switchAll",function(){return PT}),r.d(n,"switchMap",function(){return MT}),r.d(n,"switchMapTo",function(){return NT}),r.d(n,"take",function(){return RT}),r.d(n,"takeLast",function(){return cr}),r.d(n,"takeUntil",function(){return kT}),r.d(n,"takeWhile",function(){return jT}),r.d(n,"tap",function(){return x_}),r.d(n,"throttle",function(){return HT}),r.d(n,"throttleTime",function(){return qT}),r.d(n,"timeInterval",function(){return QT}),r.d(n,"timeout",function(){return rM}),r.d(n,"timeoutWith",function(){return oM}),r.d(n,"timestamp",function(){return lM}),r.d(n,"toArray",function(){return hM}),r.d(n,"window",function(){return dM}),r.d(n,"windowCount",function(){return mM}),r.d(n,"windowTime",function(){return yM}),r.d(n,"windowToggle",function(){return MM}),r.d(n,"windowWhen",function(){return CM}),r.d(n,"withLatestFrom",function(){return NM}),r.d(n,"zip",function(){return Yb}),r.d(n,"zipAll",function(){return RM});var i=r("48oy");class o{}var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function a(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function l(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e){var r=function(t){return"data-"+t.toString().replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};Object.defineProperty(t,e,{set:function(t){t=t.toString(),this.setAttribute(r(e),t)},get:function(){return this.getAttribute(r(e))},enumerable:!0})}function h(t,e){return{enumerable:!0,value:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return this._instance?this._instance[e].apply(this._instance,t):(console.warn("ng2-facebook-sdk: tried calling instance method before component is ready."),null)}}}Object;var d=function(){function t(t,e,r){this.el=t,this.rnd=e,this.fbClass=r,this.nativeElement=this.el.nativeElement,this.rnd.setElementClass(this.nativeElement,this.fbClass,!0)}return t.prototype.setAttribute=function(t,e){t&&e&&this.rnd.setElementAttribute(this.nativeElement,t,e)},t.prototype.getAttribute=function(t){if(t)return this.nativeElement.getAttribute(t)},t}(),p=function(t){function e(e,r){return t.call(this,e,r,"fb-comment-embed")||this}return a(e,t),e}(d);l([u,c("design:type",String)],p.prototype,"href",void 0),l([u,c("design:type",String)],p.prototype,"width",void 0),l([u,c("design:type",Boolean)],p.prototype,"includeParent",void 0);var f=function(t){function e(e,r){var n=t.call(this,e,r,"fb-comments")||this;return n.href=window.location.href,n}return a(e,t),e}(d);l([u,c("design:type",String)],f.prototype,"colorscheme",void 0),l([u,c("design:type",String)],f.prototype,"href",void 0),l([u,c("design:type",Boolean)],f.prototype,"mobile",void 0),l([u,c("design:type",Number)],f.prototype,"numposts",void 0),l([u,c("design:type",String)],f.prototype,"orderBy",void 0),l([u,c("design:type",String)],f.prototype,"width",void 0);var m=function(t){function e(e,r){return t.call(this,e,r,"fb-follow")||this}return a(e,t),e}(d);l([u,c("design:type",String)],m.prototype,"colorScheme",void 0),l([u,c("design:type",String)],m.prototype,"href",void 0),l([u,c("design:type",Boolean)],m.prototype,"kidDirectedSite",void 0),l([u,c("design:type",String)],m.prototype,"layout",void 0),l([u,c("design:type",String)],m.prototype,"showFaces",void 0),l([u,c("design:type",String)],m.prototype,"size",void 0),l([u,c("design:type",String)],m.prototype,"width",void 0);var v=function(t){function e(e,r){var n=t.call(this,e,r,"fb-like")||this;return n.href=window.location.href,n}return a(e,t),e}(d);l([u,c("design:type",String)],v.prototype,"action",void 0),l([u,c("design:type",String)],v.prototype,"colorScheme",void 0),l([u,c("design:type",String)],v.prototype,"href",void 0),l([u,c("design:type",Boolean)],v.prototype,"kidDirectedSite",void 0),l([u,c("design:type",String)],v.prototype,"layout",void 0),l([u,c("design:type",String)],v.prototype,"ref",void 0),l([u,c("design:type",Boolean)],v.prototype,"share",void 0),l([u,c("design:type",Boolean)],v.prototype,"showFaces",void 0),l([u,c("design:type",String)],v.prototype,"size",void 0),l([u,c("design:type",String)],v.prototype,"width",void 0);var g=function(t){function e(e,r){return t.call(this,e,r,"fb-page")||this}return a(e,t),e}(d);l([u,c("design:type",String)],g.prototype,"href",void 0),l([u,c("design:type",Number)],g.prototype,"width",void 0),l([u,c("design:type",Number)],g.prototype,"height",void 0),l([u,c("design:type",String)],g.prototype,"tabs",void 0),l([u,c("design:type",Boolean)],g.prototype,"hideCover",void 0),l([u,c("design:type",Boolean)],g.prototype,"showFacepile",void 0),l([u,c("design:type",Boolean)],g.prototype,"hideCTA",void 0),l([u,c("design:type",Boolean)],g.prototype,"smallHeader",void 0),l([u,c("design:type",Boolean)],g.prototype,"adaptContainerWidth",void 0);var y=function(t){function e(e,r){return t.call(this,e,r,"fb-post")||this}return a(e,t),e}(d);l([u,c("design:type",String)],y.prototype,"href",void 0),l([u,c("design:type",String)],y.prototype,"width",void 0),l([u,c("design:type",Boolean)],y.prototype,"showText",void 0);var x=function(t){function e(e,r){return t.call(this,e,r,"fb-quote")||this}return a(e,t),e}(d);l([u,c("design:type",String)],x.prototype,"href",void 0),l([u,c("design:type",String)],x.prototype,"layout",void 0);var b=function(t){function e(e,r){var n=t.call(this,e,r,"fb-save")||this;return n.uri=window.location.href,n}return a(e,t),e}(d);l([u,c("design:type",String)],b.prototype,"uri",void 0);var w=function(t){function e(e,r){var n=t.call(this,e,r,"fb-send")||this;return n.href=window.location.href,n}return a(e,t),e}(d);l([u,c("design:type",String)],w.prototype,"colorScheme",void 0),l([u,c("design:type",String)],w.prototype,"href",void 0),l([u,c("design:type",Boolean)],w.prototype,"kidDirectedSite",void 0),l([u,c("design:type",String)],w.prototype,"ref",void 0),l([u,c("design:type",String)],w.prototype,"size",void 0);var _=function(t){function e(e,r){return t.call(this,e,r,"fb-share-button")||this}return a(e,t),e}(d);l([u,c("design:type",String)],_.prototype,"href",void 0),l([u,c("design:type",String)],_.prototype,"layout",void 0),l([u,c("design:type",Boolean)],_.prototype,"mobileIframe",void 0),l([u,c("design:type",String)],_.prototype,"size",void 0);var S=function(t){function e(e,r){var n=t.call(this,e,r,"fb-video")||this;return n.startedPlaying=new i.m,n.paused=new i.m,n.finishedPlaying=new i.m,n.startedBuffering=new i.m,n.finishedBuffering=new i.m,n.error=new i.m,n._listeners=[],n.nativeElement.id=n._id="video-"+String(Math.floor(1e4*Math.random()+1)),n}return a(e,t),e.prototype.ngOnInit=function(){var t=this;FB.Event.subscribe("xfbml.ready",function(e){"video"===e.type&&e.id===t._id&&(t._instance=e.instance,t._listeners.push(t._instance.subscribe("startedPlaying",function(e){return t.startedPlaying.emit(e)}),t._instance.subscribe("paused",function(e){return t.paused.emit(e)}),t._instance.subscribe("finishedPlaying",function(e){return t.finishedPlaying.emit(e)}),t._instance.subscribe("startedBuffering",function(e){return t.startedBuffering.emit(e)}),t._instance.subscribe("finishedBuffering",function(e){return t.finishedBuffering.emit(e)}),t._instance.subscribe("error",function(e){return t.error.emit(e)})))})},e.prototype.ngOnDestroy=function(){this._listeners.forEach(function(t){"function"==typeof t.release&&t.release()})},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.seek=function(t){},e.prototype.mute=function(){},e.prototype.unmute=function(){},e.prototype.isMuted=function(){},e.prototype.setVolume=function(t){},e.prototype.getVolume=function(){},e.prototype.getCurrentPosition=function(){},e.prototype.getDuration=function(){},e}(d);l([u,c("design:type",String)],S.prototype,"href",void 0),l([u,c("design:type",Boolean)],S.prototype,"allowfullscreen",void 0),l([u,c("design:type",Boolean)],S.prototype,"autoplay",void 0),l([u,c("design:type",String)],S.prototype,"width",void 0),l([u,c("design:type",Boolean)],S.prototype,"showText",void 0),l([u,c("design:type",Boolean)],S.prototype,"showCaptions",void 0),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"play",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"pause",null),l([h,c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",void 0)],S.prototype,"seek",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"mute",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"unmute",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Boolean)],S.prototype,"isMuted",null),l([h,c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",void 0)],S.prototype,"setVolume",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Number)],S.prototype,"getVolume",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"getCurrentPosition",null),l([h,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],S.prototype,"getDuration",null);var T=function(){function t(){}return t.prototype.init=function(t){try{return Promise.resolve(FB.init(t))}catch(t){return Promise.reject(t)}},t.prototype.api=function(t,e,r){return void 0===e&&(e="get"),void 0===r&&(r={}),new Promise(function(n,i){try{FB.api(t,e,r,function(t){t?t.error?i(t.error):n(t):i()})}catch(t){i(t)}})},t.prototype.ui=function(t){return new Promise(function(e,r){try{FB.ui(t,function(t){t?t.error?r(t.error):e(t):r()})}catch(t){r(t)}})},t.prototype.getLoginStatus=function(){return new Promise(function(t,e){try{FB.getLoginStatus(function(r){r?t(r):e()})}catch(t){e(t)}})},t.prototype.login=function(t){return new Promise(function(e,r){try{FB.login(function(t){t.authResponse?e(t):r()},t)}catch(t){r(t)}})},t.prototype.logout=function(){return new Promise(function(t,e){try{FB.logout(function(e){t(e)})}catch(t){e(t)}})},t.prototype.getAuthResponse=function(){try{return FB.getAuthResponse()}catch(t){console.error("ng2-facebook-sdk: ",t)}},t}(),M=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[T]}},t}();class A{constructor(t){this.fb=t,t.init({appId:"396487237479561",xfbml:!0,version:"v2.8"})}}var E=r("ves3");class C{}C.BACKEND_URL="https://racing-demo-dev.pp.ua",C.FPS=60,C.MOVE_TIMEOUT=7e3;var P=r("y3s0");const O=P.a.of;var N=r("XLJA");function L(t,e){return Object(N.a)(t,e,1)}function I(t,e){return L(t,e)(this)}var R=r("2zkT");function D(t,e){return function(r){return r.lift(new F(t,e))}}class F{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new k(t,this.predicate,this.thisArg))}}class k extends R.a{constructor(t,e,r){super(t),this.predicate=e,this.thisArg=r,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)}}function U(t,e){return D(t,e)(this)}function B(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new j(t,e))}}class j{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new z(t,this.project,this.thisArg))}}class z extends R.a{constructor(t,e,r){super(t),this.project=e,this.count=0,this.thisArg=r||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}function V(t,e){return B(t,e)(this)}class G{}const H=new i.o("Location Initialized");class W{}const X=new i.o("appBaseHref");class q{constructor(t){this._subject=new i.m,this._platformStrategy=t;const e=this._platformStrategy.getBaseHref();this._baseHref=q.stripTrailingSlash(Y(e)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+q.normalizeQueryParams(e))}normalize(t){return q.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,Y(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e=""){this._platformStrategy.pushState(null,"",t,e)}replaceState(t,e=""){this._platformStrategy.replaceState(null,"",t,e)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}subscribe(t,e,r){return this._subject.subscribe({next:t,error:e,complete:r})}static normalizeQueryParams(t){return t&&"?"!==t[0]?"?"+t:t}static joinWithSlash(t,e){if(0==t.length)return e;if(0==e.length)return t;let r=0;return t.endsWith("/")&&r++,e.startsWith("/")&&r++,2==r?t+e.substring(1):1==r?t+e:t+"/"+e}static stripTrailingSlash(t){const e=t.match(/#|\?|$/),r=e&&e.index||t.length;return t.slice(0,r-("/"===t[r-1]?1:0))+t.slice(r)}}function Y(t){return t.replace(/\/index.html$/,"")}class Z extends W{constructor(t,e){super(),this._platformLocation=t,this._baseHref="",null!=e&&(this._baseHref=e)}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=q.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,r,n){let i=this.prepareExternalUrl(r+q.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(t,e,i)}replaceState(t,e,r,n){let i=this.prepareExternalUrl(r+q.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}class J extends W{constructor(t,e){if(super(),this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return q.joinWithSlash(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+q.normalizeQueryParams(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${e}${r}`:e}pushState(t,e,r,n){const i=this.prepareExternalUrl(r+q.normalizeQueryParams(n));this._platformLocation.pushState(t,e,i)}replaceState(t,e,r,n){const i=this.prepareExternalUrl(r+q.normalizeQueryParams(n));this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}var Q=["en",[["a","p"],["AM","PM"]],[["AM","PM"],,],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",,"{1} 'at' {0}"],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",function(t){let e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===r?1:5}];const K={},$=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),tt=new i.o("UseV4Plurals");class et{}class rt extends et{constructor(t,e){super(),this.locale=t,this.deprecatedPluralFn=e}getPluralCategory(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){const e=t.toLowerCase().replace(/_/g,"-");let r=K[e];if(r)return r;const n=e.split("-")[0];if(r=K[n])return r;if("en"===n)return Q;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[17]}(e||this.locale)(t)){case $.Zero:return"zero";case $.One:return"one";case $.Two:return"two";case $.Few:return"few";case $.Many:return"many";default:return"other"}}}function nt(t,e){e=encodeURIComponent(e);for(const r of t.split(";")){const t=r.indexOf("="),[n,i]=-1==t?[r,""]:[r.slice(0,t),r.slice(t+1)];if(n.trim()===e)return decodeURIComponent(i)}return null}class it{constructor(t,e,r,n){this.$implicit=t,this.ngForOf=e,this.index=r,this.count=n}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}class ot{constructor(t,e,r){this._viewContainer=t,this._template=e,this._differs=r,this._differ=null}set ngForTrackBy(t){Object(i.T)()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(t)}. `+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngOnChanges(t){if("ngForOf"in t){const e=t.ngForOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${e}' of type '${e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}}ngDoCheck(){if(this._differ){const t=this._differ.diff(this.ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,r,n)=>{if(null==t.previousIndex){const r=this._viewContainer.createEmbeddedView(this._template,new it(null,this.ngForOf,-1,-1),n),i=new st(t,r);e.push(i)}else if(null==n)this._viewContainer.remove(r);else{const i=this._viewContainer.get(r);this._viewContainer.move(i,n);const o=new st(t,i);e.push(o)}});for(let r=0;r<e.length;r++)this._perViewChange(e[r].view,e[r].record);for(let r=0,n=this._viewContainer.length;r<n;r++){const t=this._viewContainer.get(r);t.context.index=r,t.context.count=n}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}}class st{constructor(t,e){this.record=t,this.view=e}}class at{constructor(t,e){this._viewContainer=t,this._context=new lt,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}class lt{constructor(){this.$implicit=null,this.ngIf=null}}const ct=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ut=/((?:[^yMLdHhmsazZEwGjJ']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|J+|j+|m+|s+|a|z|Z|G+|w+))(.*)/,ht={yMMMdjms:wt(bt([yt("year",1),xt("month",3),yt("day",1),yt("hour",1),yt("minute",1),yt("second",1)])),yMdjm:wt(bt([yt("year",1),yt("month",1),yt("day",1),yt("hour",1),yt("minute",1)])),yMMMMEEEEd:wt(bt([yt("year",1),xt("month",4),xt("weekday",4),yt("day",1)])),yMMMMd:wt(bt([yt("year",1),xt("month",4),yt("day",1)])),yMMMd:wt(bt([yt("year",1),xt("month",3),yt("day",1)])),yMd:wt(bt([yt("year",1),yt("month",1),yt("day",1)])),jms:wt(bt([yt("hour",1),yt("second",1),yt("minute",1)])),jm:wt(bt([yt("hour",1),yt("minute",1)]))},dt={yyyy:wt(yt("year",4)),yy:wt(yt("year",2)),y:wt(yt("year",1)),MMMM:wt(xt("month",4)),MMM:wt(xt("month",3)),MM:wt(yt("month",2)),M:wt(yt("month",1)),LLLL:wt(xt("month",4)),L:wt(xt("month",1)),dd:wt(yt("day",2)),d:wt(yt("day",1)),HH:pt(ft(wt(gt(yt("hour",2),!1)))),H:ft(wt(gt(yt("hour",1),!1))),hh:pt(ft(wt(gt(yt("hour",2),!0)))),h:ft(wt(gt(yt("hour",1),!0))),jj:wt(yt("hour",2)),j:wt(yt("hour",1)),mm:pt(wt(yt("minute",2))),m:wt(yt("minute",1)),ss:pt(wt(yt("second",2))),s:wt(yt("second",1)),sss:wt(yt("second",3)),EEEE:wt(xt("weekday",4)),EEE:wt(xt("weekday",3)),EE:wt(xt("weekday",2)),E:wt(xt("weekday",1)),a:function(t){return function(e,r){return t(e,r).split(" ")[1]}}(wt(gt(yt("hour",1),!0))),Z:vt("short"),z:vt("long"),ww:wt({}),w:wt({}),G:wt(xt("era",1)),GG:wt(xt("era",2)),GGG:wt(xt("era",3)),GGGG:wt(xt("era",4))};function pt(t){return function(e,r){const n=t(e,r);return 1==n.length?"0"+n:n}}function ft(t){return function(e,r){return t(e,r).split(" ")[0]}}function mt(t,e,r){return new Intl.DateTimeFormat(e,r).format(t).replace(/[\u200e\u200f]/g,"")}function vt(t){const e={hour:"2-digit",hour12:!1,timeZoneName:t};return function(t,r){const n=mt(t,r,e);return n?n.substring(3):""}}function gt(t,e){return t.hour12=e,t}function yt(t,e){return function(){var r={};return r[t]=2===e?"2-digit":"numeric",r}()}function xt(t,e){const r={};return r[t]=e<4?e>1?"short":"narrow":"long",r}function bt(t){return t.reduce((t,e)=>Object.assign({},t,e),{})}function wt(t){return(e,r)=>mt(e,r,t)}const _t=new Map;class St{static format(t,e,r){return function(t,e,r){const n=ht[t];if(n)return n(e,r);const i=t;let o=_t.get(i);if(!o){let e;o=[],ut.exec(t);let r=t;for(;r;)(e=ut.exec(r))?r=(o=o.concat(e.slice(1))).pop():(o.push(r),r=null);_t.set(i,o)}return o.reduce((t,n)=>{const i=dt[n];return t+(i?i(e,r):function(t){return"''"===t?"'":t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}(n))},"")}(r,t,e)}}class Tt{constructor(t){this._locale=t}transform(t,e="mediumDate"){if(null==t||""===t||t!=t)return null;let r;if("string"==typeof t&&(t=t.trim()),Mt(t))r=t;else if(isNaN(t-parseFloat(t)))if("string"==typeof t&&/^(\d{4}-\d{1,2}-\d{1,2})$/.test(t)){const[e,n,i]=t.split("-").map(t=>parseInt(t,10));r=new Date(e,n-1,i)}else r=new Date(t);else r=new Date(parseFloat(t));if(!Mt(r)){let e;if("string"!=typeof t||!(e=t.match(ct)))throw function(t,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${Object(i._19)(t)}'`)}(Tt,t);r=function(t){const e=new Date(0);let r=0,n=0;const i=t[8]?e.setUTCHours:e.setHours;t[9]&&(r=+(t[9]+t[10]),n=+(t[9]+t[11])),(t[8]?e.setUTCFullYear:e.setFullYear).call(e,+t[1],+t[2]-1,+t[3]);const o=+(t[4]||"0")-r,s=+(t[5]||"0")-n,a=+(t[6]||"0"),l=Math.round(1e3*parseFloat("0."+(t[7]||0)));return i.call(e,o,s,a,l),e}(e)}return St.format(r,this._locale,Tt._ALIASES[e]||e)}}function Mt(t){return t instanceof Date&&!isNaN(t.valueOf())}Tt._ALIASES={medium:"yMMMdjms",short:"yMdjm",fullDate:"yMMMMEEEEd",longDate:"yMMMMd",mediumDate:"yMMMd",shortDate:"yMd",mediumTime:"jms",shortTime:"jm"},new class{createSubscription(t,e){return t.then(e,t=>{throw t})}dispose(t){}onDestroy(t){}},new class{createSubscription(t,e){return t.subscribe({next:e,error:t=>{throw t}})}dispose(t){t.unsubscribe()}onDestroy(t){t.unsubscribe()}};class At{}const Et=new i.o("DocumentToken");new i.L("5.2.9");class Ct{}class Pt{}class Ot{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(t=>{const e=t.indexOf(":");if(e>0){const r=t.slice(0,e),n=r.toLowerCase(),i=t.slice(e+1).trim();this.maybeSetNormalizedName(r,n),this.headers.has(n)?this.headers.get(n).push(i):this.headers.set(n,[i])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let r=t[e];const n=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(n,r),this.maybeSetNormalizedName(e,n))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Ot?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Ot;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Ot?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,e);const n=("a"===t.op?this.headers.get(e):void 0)||[];n.push(...r),this.headers.set(e,n);break;case"d":const i=t.value;if(i){let t=this.headers.get(e);if(!t)return;0===(t=t.filter(t=>-1===i.indexOf(t))).length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,t)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class Nt{encodeKey(t){return Lt(t)}encodeValue(t){return Lt(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}function Lt(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class It{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Nt,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const r=new Map;return t.length>0&&t.split("&").forEach(t=>{const n=t.indexOf("="),[i,o]=-1==n?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,n)),e.decodeValue(t.slice(n+1))],s=r.get(i)||[];s.push(o),r.set(i,s)}),r}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const r=t.fromObject[e];this.map.set(e,Array.isArray(r)?r:[r])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).join("&")}clone(t){const e=new It({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat([t]),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(t.value),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let e=this.map.get(t.param)||[];const r=e.indexOf(t.value);-1!==r&&e.splice(r,1),e.length>0?this.map.set(t.param,e):this.map.delete(t.param)}}}),this.cloneFrom=null)}}function Rt(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function Dt(t){return"undefined"!=typeof Blob&&t instanceof Blob}function Ft(t){return"undefined"!=typeof FormData&&t instanceof FormData}class kt{constructor(t,e,r,n){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,i=n):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ot),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const r=e.indexOf("?");this.urlWithParams=e+(-1===r?"?":r<e.length-1?"&":"")+t}}else this.params=new It,this.urlWithParams=e}serializeBody(){return null===this.body?null:Rt(this.body)||Dt(this.body)||Ft(this.body)||"string"==typeof this.body?this.body:this.body instanceof It?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body?null:Ft(this.body)?null:Dt(this.body)?this.body.type||null:Rt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof It?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(t={}){const e=t.method||this.method,r=t.url||this.url,n=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,o=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,s=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let a=t.headers||this.headers,l=t.params||this.params;return void 0!==t.setHeaders&&(a=Object.keys(t.setHeaders).reduce((e,r)=>e.set(r,t.setHeaders[r]),a)),t.setParams&&(l=Object.keys(t.setParams).reduce((e,r)=>e.set(r,t.setParams[r]),l)),new kt(e,r,i,{params:l,headers:a,reportProgress:s,responseType:n,withCredentials:o})}}const Ut=function(){var t={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return t[t.Sent]="Sent",t[t.UploadProgress]="UploadProgress",t[t.ResponseHeader]="ResponseHeader",t[t.DownloadProgress]="DownloadProgress",t[t.Response]="Response",t[t.User]="User",t}();class Bt{constructor(t,e=200,r="OK"){this.headers=t.headers||new Ot,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class jt extends Bt{constructor(t={}){super(t),this.type=Ut.ResponseHeader}clone(t={}){return new jt({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class zt extends Bt{constructor(t={}){super(t),this.type=Ut.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new zt({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Vt extends Bt{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Gt(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}class Ht{constructor(t){this.handler=t}request(t,e,r={}){let n;if(t instanceof kt)n=t;else{let i=void 0;i=r.headers instanceof Ot?r.headers:new Ot(r.headers);let o=void 0;r.params&&(o=r.params instanceof It?r.params:new It({fromObject:r.params})),n=new kt(t,e,void 0!==r.body?r.body:null,{headers:i,params:o,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const i=I.call(O(n),t=>this.handler.handle(t));if(t instanceof kt||"events"===r.observe)return i;const o=U.call(i,t=>t instanceof zt);switch(r.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return V.call(o,t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body});case"blob":return V.call(o,t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body});case"text":return V.call(o,t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body});case"json":default:return V.call(o,t=>t.body)}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new It).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,r={}){return this.request("PATCH",t,Gt(r,e))}post(t,e,r={}){return this.request("POST",t,Gt(r,e))}put(t,e,r={}){return this.request("PUT",t,Gt(r,e))}}class Wt{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const Xt=new i.o("HTTP_INTERCEPTORS");class qt{intercept(t,e){return e.handle(t)}}const Yt=/^\)\]\}',?\n/;class Zt{}class Jt{constructor(){}build(){return new XMLHttpRequest}}class Qt{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without JsonpClientModule installed.");return new E.a(e=>{const r=this.xhrFactory.build();if(r.open(t.method,t.urlWithParams),t.withCredentials&&(r.withCredentials=!0),t.headers.forEach((t,e)=>r.setRequestHeader(t,e.join(","))),t.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const e=t.detectContentTypeHeader();null!==e&&r.setRequestHeader("Content-Type",e)}if(t.responseType){const e=t.responseType.toLowerCase();r.responseType="json"!==e?e:"text"}const n=t.serializeBody();let i=null;const o=()=>{if(null!==i)return i;const e=1223===r.status?204:r.status,n=r.statusText||"OK",o=new Ot(r.getAllResponseHeaders()),s=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(r)||t.url;return i=new jt({headers:o,status:e,statusText:n,url:s})},s=()=>{let{headers:n,status:i,statusText:s,url:a}=o(),l=null;204!==i&&(l="undefined"==typeof r.response?r.responseText:r.response),0===i&&(i=l?200:0);let c=i>=200&&i<300;if("json"===t.responseType&&"string"==typeof l){const t=l;l=l.replace(Yt,"");try{l=""!==l?JSON.parse(l):null}catch(e){l=t,c&&(c=!1,l={error:e,text:l})}}c?(e.next(new zt({body:l,headers:n,status:i,statusText:s,url:a||void 0})),e.complete()):e.error(new Vt({error:l,headers:n,status:i,statusText:s,url:a||void 0}))},a=t=>{const n=new Vt({error:t,status:r.status||0,statusText:r.statusText||"Unknown Error"});e.error(n)};let l=!1;const c=n=>{l||(e.next(o()),l=!0);let i={type:Ut.DownloadProgress,loaded:n.loaded};n.lengthComputable&&(i.total=n.total),"text"===t.responseType&&r.responseText&&(i.partialText=r.responseText),e.next(i)},u=t=>{let r={type:Ut.UploadProgress,loaded:t.loaded};t.lengthComputable&&(r.total=t.total),e.next(r)};return r.addEventListener("load",s),r.addEventListener("error",a),t.reportProgress&&(r.addEventListener("progress",c),null!==n&&r.upload&&r.upload.addEventListener("progress",u)),r.send(n),e.next({type:Ut.Sent}),()=>{r.removeEventListener("error",a),r.removeEventListener("load",s),t.reportProgress&&(r.removeEventListener("progress",c),null!==n&&r.upload&&r.upload.removeEventListener("progress",u)),r.abort()}})}}const Kt=new i.o("XSRF_COOKIE_NAME"),$t=new i.o("XSRF_HEADER_NAME");class te{}class ee{constructor(t,e,r){this.doc=t,this.platform=e,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=nt(t,this.cookieName),this.lastCookieString=t),this.lastToken}}class re{constructor(t,e){this.tokenService=t,this.headerName=e}intercept(t,e){const r=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||r.startsWith("http://")||r.startsWith("https://"))return e.handle(t);const n=this.tokenService.getToken();return null===n||t.headers.has(this.headerName)||(t=t.clone({headers:t.headers.set(this.headerName,n)})),e.handle(t)}}class ne{constructor(t,e){this.backend=t,this.injector=e,this.chain=null}handle(t){if(null===this.chain){const t=this.injector.get(Xt,[]);this.chain=t.reduceRight((t,e)=>new Wt(t,e),this.backend)}return this.chain.handle(t)}}class ie{static disable(){return{ngModule:ie,providers:[{provide:re,useClass:qt}]}}static withOptions(t={}){return{ngModule:ie,providers:[t.cookieName?{provide:Kt,useValue:t.cookieName}:[],t.headerName?{provide:$t,useValue:t.headerName}:[]]}}}class se{}E.a.prototype.map=V;var ae=r("JEOp"),le=r("73El");function ce(t){return function(e){const r=new ue(t),n=e.lift(r);return r.caught=n}}class ue{constructor(t){this.selector=t}call(t,e){return e.subscribe(new he(t,this.selector,this.caught))}}class he extends ae.a{constructor(t,e,r){super(t),this.selector=e,this.caught=r}error(t){if(!this.isStopped){let e;try{e=this.selector(t,this.caught)}catch(t){return void super.error(t)}this._unsubscribeAndRecycle(),this.add(Object(le.a)(this,e))}}}function de(t){return ce(t)(this)}E.a.prototype.catch=de,E.a.prototype._catch=de;var pe=r("W/Sc"),fe=r("7nan");class me extends pe.b{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new fe.a;return this._value}next(t){super.next(this._value=t)}}function ve(t,e,r=Number.POSITIVE_INFINITY){return Object(N.a)(t,e,r)(this)}var ge=r("6MRC"),ye=r("crq8"),xe=r("jzaW"),be=r("bbL7");class we extends E.a{constructor(t,e){super(),this.promise=t,this.scheduler=e}static create(t,e){return new we(t,e)}_subscribe(t){const e=this.promise,r=this.scheduler;if(null==r)this._isScalar?t.closed||(t.next(this.value),t.complete()):e.then(e=>{this.value=e,this._isScalar=!0,t.closed||(t.next(e),t.complete())},e=>{t.closed||t.error(e)}).then(null,t=>{be.a.setTimeout(()=>{throw t})});else if(this._isScalar){if(!t.closed)return r.schedule(_e,0,{value:this.value,subscriber:t})}else e.then(e=>{this.value=e,this._isScalar=!0,t.closed||t.add(r.schedule(_e,0,{value:e,subscriber:t}))},e=>{t.closed||t.add(r.schedule(Se,0,{err:e,subscriber:t}))}).then(null,t=>{be.a.setTimeout(()=>{throw t})})}}function _e(t){const{value:e,subscriber:r}=t;r.closed||(r.next(e),r.complete())}function Se(t){const{err:e,subscriber:r}=t;r.closed||r.error(e)}var Te=r("dzdQ");class Me extends E.a{constructor(t,e){if(super(),this.scheduler=e,null==t)throw new Error("iterator cannot be null.");this.iterator=Ce(t)}static create(t,e){return new Me(t,e)}static dispatch(t){const{index:e,hasError:r,iterator:n,subscriber:i}=t;if(r)return void i.error(t.error);let o=n.next();o.done?i.complete():(i.next(o.value),t.index=e+1,i.closed?"function"==typeof n.return&&n.return():this.schedule(t))}_subscribe(t){const{iterator:e,scheduler:r}=this;if(r)return r.schedule(Me.dispatch,0,{index:0,iterator:e,subscriber:t});for(;;){let r=e.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed){"function"==typeof e.return&&e.return();break}}}}class Ae{constructor(t,e=0,r=t.length){this.str=t,this.idx=e,this.len=r}[Te.a](){return this}next(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}}}class Ee{constructor(t,e=0,r=function(e){let r=+t.length;return isNaN(r)?0:0!==r&&"number"==typeof r&&be.a.isFinite(r)?(r=function(t){let e=+r;return 0===e?e:isNaN(e)?e:e<0?-1:1}()*Math.floor(Math.abs(r)))<=0?0:r>Pe?Pe:r:r}()){this.arr=t,this.idx=e,this.len=r}[Te.a](){return this}next(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}}}function Ce(t){const e=t[Te.a];if(!e&&"string"==typeof t)return new Ae(t);if(!e&&void 0!==t.length)return new Ee(t);if(!e)throw new TypeError("object is not iterable");return t[Te.a]()}const Pe=Math.pow(2,53)-1;var Oe=r("R3ym"),Ne=r("XVqe");class Le extends E.a{constructor(t,e){super(),this.arrayLike=t,this.scheduler=e,e||1!==t.length||(this._isScalar=!0,this.value=t[0])}static create(t,e){const r=t.length;return 0===r?new Ne.a:1===r?new Oe.a(t[0],e):new Le(t,e)}static dispatch(t){const{arrayLike:e,index:r,length:n,subscriber:i}=t;i.closed||(r>=n?i.complete():(i.next(e[r]),t.index=r+1,this.schedule(t)))}_subscribe(t){const{arrayLike:e,scheduler:r}=this,n=e.length;if(r)return r.schedule(Le.dispatch,0,{arrayLike:e,index:0,length:n,subscriber:t});for(let i=0;i<n&&!t.closed;i++)t.next(e[i]);t.complete()}}class Ie{constructor(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}}accept(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)}toObservable(){switch(this.kind){case"N":return E.a.of(this.value);case"E":return E.a.throw(this.error);case"C":return E.a.empty()}throw new Error("unexpected notification kind value")}static createNext(t){return"undefined"!=typeof t?new Ie("N",t):Ie.undefinedValueNotification}static createError(t){return new Ie("E",void 0,t)}static createComplete(){return Ie.completeNotification}}function Re(t,e=0){return function(r){return r.lift(new De(t,e))}}Ie.completeNotification=new Ie("C"),Ie.undefinedValueNotification=new Ie("N",void 0);class De{constructor(t,e=0){this.scheduler=t,this.delay=e}call(t,e){return e.subscribe(new Fe(t,this.scheduler,this.delay))}}class Fe extends R.a{constructor(t,e,r=0){super(t),this.scheduler=e,this.delay=r}static dispatch(t){const{notification:e,destination:r}=t;e.observe(r),this.unsubscribe()}scheduleMessage(t){this.add(this.scheduler.schedule(Fe.dispatch,this.delay,new ke(t,this.destination)))}_next(t){this.scheduleMessage(Ie.createNext(t))}_error(t){this.scheduleMessage(Ie.createError(t))}_complete(){this.scheduleMessage(Ie.createComplete())}}class ke{constructor(t,e){this.notification=t,this.destination=e}}var Ue=r("zOxy");class Be extends E.a{constructor(t,e){super(null),this.ish=t,this.scheduler=e}static create(t,e){if(null!=t){if("function"==typeof t[Ue.a])return t instanceof E.a&&!e?t:new Be(t,e);if(Object(ge.a)(t))return new P.a(t,e);if(Object(xe.a)(t))return new we(t,e);if("function"==typeof t[Te.a]||"string"==typeof t)return new Me(t,e);if(Object(ye.a)(t))return new Le(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}_subscribe(t){const e=this.ish,r=this.scheduler;return null==r?e[Ue.a]().subscribe(t):e[Ue.a]().subscribe(new Fe(t,r,0))}}const je=Be.create;var ze=r("Ynfn");function Ve(){return Object(ze.a)(1)}function Ge(){return Ve()(this)}class He extends Error{constructor(){const t=super("no elements in sequence");this.name=t.name="EmptyError",this.stack=t.stack,this.message=t.message}}function We(t,e,r){return n=>n.lift(new Xe(t,e,r,n))}class Xe{constructor(t,e,r,n){this.predicate=t,this.resultSelector=e,this.defaultValue=r,this.source=n}call(t,e){return e.subscribe(new qe(t,this.predicate,this.resultSelector,this.defaultValue,this.source))}}class qe extends R.a{constructor(t,e,r,n,i){super(t),this.predicate=e,this.resultSelector=r,this.defaultValue=n,this.source=i,this.index=0,this.hasCompleted=!1,this._emitted=!1}_next(t){const e=this.index++;this.predicate?this._tryPredicate(t,e):this._emit(t,e)}_tryPredicate(t,e){let r;try{r=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}r&&this._emit(t,e)}_emit(t,e){this.resultSelector?this._tryResultSelector(t,e):this._emitFinal(t)}_tryResultSelector(t,e){let r;try{r=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this._emitFinal(r)}_emitFinal(t){const e=this.destination;this._emitted||(this._emitted=!0,e.next(t),e.complete(),this.hasCompleted=!0)}_complete(){const t=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||t.error(new He):(t.next(this.defaultValue),t.complete())}}function Ye(t,e,r){return We(t,e,r)(this)}const Ze=we.create;function Je(t,e){return r=>r.lift(new Qe(t,e,r))}class Qe{constructor(t,e,r){this.predicate=t,this.thisArg=e,this.source=r}call(t,e){return e.subscribe(new Ke(t,this.predicate,this.thisArg,this.source))}}class Ke extends R.a{constructor(t,e,r,n){super(t),this.predicate=e,this.thisArg=r,this.source=n,this.index=0,this.thisArg=r||this}notifyComplete(t){this.destination.next(t),this.destination.complete()}_next(t){let e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}function $e(t,e){return Je(t,e)(this)}function tr(t,e,r){return n=>n.lift(new er(t,e,r,n))}class er{constructor(t,e,r,n){this.predicate=t,this.resultSelector=e,this.defaultValue=r,this.source=n}call(t,e){return e.subscribe(new rr(t,this.predicate,this.resultSelector,this.defaultValue,this.source))}}class rr extends R.a{constructor(t,e,r,n,i){super(t),this.predicate=e,this.resultSelector=r,this.defaultValue=n,this.source=i,this.hasValue=!1,this.index=0,"undefined"!=typeof n&&(this.lastValue=n,this.hasValue=!0)}_next(t){const e=this.index++;if(this.predicate)this._tryPredicate(t,e);else{if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}}_tryPredicate(t,e){let r;try{r=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}if(r){if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}}_tryResultSelector(t,e){let r;try{r=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this.lastValue=r,this.hasValue=!0}_complete(){const t=this.destination;this.hasValue?(t.next(this.lastValue),t.complete()):t.error(new He)}}function nr(t,e,r){return tr(t,e,r)(this)}function ir(t=Number.POSITIVE_INFINITY){return Object(ze.a)(t)(this)}function or(t,e){let r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new sr(t,e,r))}}class sr{constructor(t,e,r=!1){this.accumulator=t,this.seed=e,this.hasSeed=r}call(t,e){return e.subscribe(new ar(t,this.accumulator,this.seed,this.hasSeed))}}class ar extends R.a{constructor(t,e,r,n){super(t),this.accumulator=e,this._seed=r,this.hasSeed=n,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let r;try{r=this.accumulator(this.seed,t,e)}catch(t){this.destination.error(t)}this.seed=r,this.destination.next(r)}}class lr extends Error{constructor(){const t=super("argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}}function cr(t){return function(e){return 0===t?new Ne.a:e.lift(new ur(t))}}class ur{constructor(t){if(this.total=t,this.total<0)throw new lr}call(t,e){return e.subscribe(new hr(t,this.total))}}class hr extends R.a{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,r=this.total,n=this.count++;e.length<r?e.push(t):e[n%r]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const r=this.count>=this.total?this.total:this.count,n=this.ring;for(let i=0;i<r;i++){const i=e++%r;t.next(n[i])}}t.complete()}}function dr(t=null){return e=>e.lift(new pr(t))}class pr{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new fr(t,this.defaultValue))}}class fr extends R.a{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var mr=r("7VlU");function vr(t,e){return arguments.length>=2?function(r){return Object(mr.a)(or(t,e),cr(1),dr(e))(r)}:function(e){return Object(mr.a)(or((e,r,n)=>t(e,r,n+1)),cr(1))(e)}}function gr(t,e){return arguments.length>=2?vr(t,e)(this):vr(t)(this)}let yr=null;function xr(){return yr}class br{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(t){this._attrToPropMap=t}}class wr extends br{constructor(){super(),this._animationPrefix=null,this._transitionEnd=null;try{const t=this.createElement("div",document);if(null!=this.getStyle(t,"animationName"))this._animationPrefix="";else{const e=["Webkit","Moz","O","ms"];for(let r=0;r<e.length;r++)if(null!=this.getStyle(t,e[r]+"AnimationName")){this._animationPrefix="-"+e[r].toLowerCase()+"-";break}}const e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(e).forEach(r=>{null!=this.getStyle(t,r)&&(this._transitionEnd=e[r])})}catch(t){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(t){return t.getDistributedNodes()}resolveAndSetHref(t,e,r){t.href=null==r?e:e+"/../"+r}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}const _r={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Sr=3,Tr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Mr={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};let Ar;i._4.Node&&(Ar=i._4.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});class Er extends wr{parse(t){throw new Error("parse not implemented")}static makeCurrent(){!function(t){yr||(yr=t)}(new Er)}hasProperty(t,e){return e in t}setProperty(t,e,r){t[e]=r}getProperty(t,e){return t[e]}invoke(t,e,r){t[e](...r)}logError(t){window.console&&(console.error?console.error(t):console.log(t))}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}get attrToPropMap(){return _r}contains(t,e){return Ar.call(t,e)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return t.querySelectorAll(e)}on(t,e,r){t.addEventListener(e,r,!1)}onAndCancel(t,e,r){return t.addEventListener(e,r,!1),()=>{t.removeEventListener(e,r,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}createMouseEvent(t){const e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e}createEvent(t){const e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e}preventDefault(t){t.preventDefault(),t.returnValue=!1}isPrevented(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}getInnerHTML(t){return t.innerHTML}getTemplateContent(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}getOuterHTML(t){return t.outerHTML}nodeName(t){return t.nodeName}nodeValue(t){return t.nodeValue}type(t){return t.type}content(t){return this.hasProperty(t,"content")?t.content:t}firstChild(t){return t.firstChild}nextSibling(t){return t.nextSibling}parentElement(t){return t.parentNode}childNodes(t){return t.childNodes}childNodesAsList(t){const e=t.childNodes,r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n];return r}clearNodes(t){for(;t.firstChild;)t.removeChild(t.firstChild)}appendChild(t,e){t.appendChild(e)}removeChild(t,e){t.removeChild(e)}replaceChild(t,e,r){t.replaceChild(e,r)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}insertBefore(t,e,r){t.insertBefore(r,e)}insertAllBefore(t,e,r){r.forEach(r=>t.insertBefore(r,e))}insertAfter(t,e,r){t.insertBefore(r,e.nextSibling)}setInnerHTML(t,e){t.innerHTML=e}getText(t){return t.textContent}setText(t,e){t.textContent=e}getValue(t){return t.value}setValue(t,e){t.value=e}getChecked(t){return t.checked}setChecked(t,e){t.checked=e}createComment(t){return this.getDefaultDocument().createComment(t)}createTemplate(t){const e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createElementNS(t,e,r){return(r=r||this.getDefaultDocument()).createElementNS(t,e)}createTextNode(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}createScriptTag(t,e,r){const n=(r=r||this.getDefaultDocument()).createElement("SCRIPT");return n.setAttribute(t,e),n}createStyleElement(t,e){const r=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(r,this.createTextNode(t,e)),r}createShadowRoot(t){return t.createShadowRoot()}getShadowRoot(t){return t.shadowRoot}getHost(t){return t.host}clone(t){return t.cloneNode(!0)}getElementsByClassName(t,e){return t.getElementsByClassName(e)}getElementsByTagName(t,e){return t.getElementsByTagName(e)}classList(t){return Array.prototype.slice.call(t.classList,0)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}hasClass(t,e){return t.classList.contains(e)}setStyle(t,e,r){t.style[e]=r}removeStyle(t,e){t.style[e]=""}getStyle(t,e){return t.style[e]}hasStyle(t,e,r){const n=this.getStyle(t,e)||"";return r?n==r:n.length>0}tagName(t){return t.tagName}attributeMap(t){const e=new Map,r=t.attributes;for(let n=0;n<r.length;n++){const t=r.item(n);e.set(t.name,t.value)}return e}hasAttribute(t,e){return t.hasAttribute(e)}hasAttributeNS(t,e,r){return t.hasAttributeNS(e,r)}getAttribute(t,e){return t.getAttribute(e)}getAttributeNS(t,e,r){return t.getAttributeNS(e,r)}setAttribute(t,e,r){t.setAttribute(e,r)}setAttributeNS(t,e,r,n){t.setAttributeNS(e,r,n)}removeAttribute(t,e){t.removeAttribute(e)}removeAttributeNS(t,e,r){t.removeAttributeNS(e,r)}templateAwareRoot(t){return this.isTemplateElement(t)?this.content(t):t}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(t){try{return t.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(t){return t.title}setTitle(t,e){t.title=e||""}elementMatches(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}isTemplateElement(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}isTextNode(t){return t.nodeType===Node.TEXT_NODE}isCommentNode(t){return t.nodeType===Node.COMMENT_NODE}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}hasShadowRoot(t){return null!=t.shadowRoot&&t instanceof HTMLElement}isShadowRoot(t){return t instanceof DocumentFragment}importIntoDoc(t){return document.importNode(this.templateAwareRoot(t),!0)}adoptNode(t){return document.adoptNode(t)}getHref(t){return t.getAttribute("href")}getEventKey(t){let e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),t.location===Sr&&Mr.hasOwnProperty(e)&&(e=Mr[e]))}return Tr[e]||e}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=Pr||(Pr=document.querySelector("base"))?Pr.getAttribute("href"):null;return null==e?null:function(t){return Cr||(Cr=document.createElement("a")),Cr.setAttribute("href",t),"/"===Cr.pathname.charAt(0)?Cr.pathname:"/"+Cr.pathname}(e)}resetBaseElement(){Pr=null}getUserAgent(){return window.navigator.userAgent}setData(t,e,r){this.setAttribute(t,"data-"+e,r)}getData(t,e){return this.getAttribute(t,"data-"+e)}getComputedStyle(t){return getComputedStyle(t)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return nt(document.cookie,t)}setCookie(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}}let Cr,Pr=null;const Or=Et;function Nr(){return!!window.history.pushState}class Lr extends G{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=xr().getLocation(),this._history=xr().getHistory()}getBaseHrefFromDOM(){return xr().getBaseHref(this._doc)}onPopState(t){xr().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){xr().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,r){Nr()?this._history.pushState(t,e,r):this.location.hash=r}replaceState(t,e,r){Nr()?this._history.replaceState(t,e,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}}Lr.ctorParameters=(()=>[{type:void 0,decorators:[{type:i.n,args:[Or]}]}]);class Ir{constructor(t){this._doc=t,this._dom=xr()}addTag(t,e=!1){return t?this._getOrCreateElement(t,e):null}addTags(t,e=!1){return t?t.reduce((t,r)=>(r&&t.push(this._getOrCreateElement(r,e)),t),[]):[]}getTag(t){return t&&this._dom.querySelector(this._doc,`meta[${t}]`)||null}getTags(t){if(!t)return[];const e=this._dom.querySelectorAll(this._doc,`meta[${t}]`);return e?[].slice.call(e):[]}updateTag(t,e){if(!t)return null;e=e||this._parseSelector(t);const r=this.getTag(e);return r?this._setMetaElementAttributes(t,r):this._getOrCreateElement(t,!0)}removeTag(t){this.removeTagElement(this.getTag(t))}removeTagElement(t){t&&this._dom.remove(t)}_getOrCreateElement(t,e=!1){if(!e){const e=this._parseSelector(t),r=this.getTag(e);if(r&&this._containsAttributes(t,r))return r}const r=this._dom.createElement("meta");this._setMetaElementAttributes(t,r);const n=this._dom.getElementsByTagName(this._doc,"head")[0];return this._dom.appendChild(n,r),r}_setMetaElementAttributes(t,e){return Object.keys(t).forEach(r=>this._dom.setAttribute(e,r,t[r])),e}_parseSelector(t){const e=t.name?"name":"property";return`${e}="${t[e]}"`}_containsAttributes(t,e){return Object.keys(t).every(r=>this._dom.getAttribute(e,r)===t[r])}}const Rr=new i.o("TRANSITION_ID"),Dr=[{provide:i.d,useFactory:function(t,e,r){return()=>{r.get(i.e).donePromise.then(()=>{const r=xr();Array.prototype.slice.apply(r.querySelectorAll(e,"style[ng-transition]")).filter(e=>r.getAttribute(e,"ng-transition")===t).forEach(t=>r.remove(t))})}},deps:[Rr,Or,i.p],multi:!0}];class Fr{static init(){Object(i.V)(new Fr)}addToWindow(t){i._4.getAngularTestability=((e,r=!0)=>{const n=t.findTestabilityInTree(e,r);if(null==n)throw new Error("Could not find testability for element.");return n}),i._4.getAllAngularTestabilities=(()=>t.getAllTestabilities()),i._4.getAllAngularRootElements=(()=>t.getAllRootElements()),i._4.frameworkStabilizers||(i._4.frameworkStabilizers=[]),i._4.frameworkStabilizers.push(t=>{const e=i._4.getAllAngularTestabilities();let r=e.length,n=!1;const o=function(e){n=n||e,0==--r&&t(n)};e.forEach(function(t){t.whenStable(o)})})}findTestabilityInTree(t,e,r){if(null==e)return null;const n=t.getTestability(e);return null!=n?n:r?xr().isShadowRoot(e)?this.findTestabilityInTree(t,xr().getHost(e),!0):this.findTestabilityInTree(t,xr().parentElement(e),!0):null}}class kr{constructor(t){this._doc=t}getTitle(){return xr().getTitle(this._doc)}setTitle(t){xr().setTitle(this._doc,t)}}function Ur(t,e){"undefined"!=typeof COMPILED&&COMPILED||((i._4.ng=i._4.ng||{})[t]=e)}const Br={ApplicationRef:i.g,NgZone:i.x};function jr(t){return Object(i.S)(t)}new i.y;const zr=new i.o("EventManagerPlugins");class Vr{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,r){return this._findPluginFor(e).addEventListener(t,e,r)}addGlobalEventListener(t,e,r){return this._findPluginFor(e).addGlobalEventListener(t,e,r)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const r=this._plugins;for(let n=0;n<r.length;n++){const e=r[n];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}class Gr{constructor(t){this._doc=t}addGlobalEventListener(t,e,r){const n=xr().getGlobalEventTarget(this._doc,t);if(!n)throw new Error(`Unsupported event target ${n} for event ${e}`);return this.addEventListener(n,e,r)}}class Hr{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}class Wr extends Hr{constructor(t){super(),this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(t.head)}_addStylesToHost(t,e){t.forEach(t=>{const r=this._doc.createElement("style");r.textContent=t,this._styleNodes.add(e.appendChild(r))})}addHost(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}removeHost(t){this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach(e=>this._addStylesToHost(t,e))}ngOnDestroy(){this._styleNodes.forEach(t=>xr().remove(t))}}const Xr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},qr=/%COMP%/g,Yr="_nghost-%COMP%",Zr="_ngcontent-%COMP%";function Jr(t,e,r){for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?Jr(t,i,r):(i=i.replace(qr,t),r.push(i))}return r}function Qr(t){return e=>{!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}class Kr{constructor(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new $r(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case i.N.Emulated:{let r=this.rendererByCompId.get(e.id);return r||(r=new rn(this.eventManager,this.sharedStylesHost,e),this.rendererByCompId.set(e.id,r)),r.applyToHost(t),r}case i.N.Native:return new nn(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=Jr(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}class $r{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(Xr[e],t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,r){t&&t.insertBefore(e,r)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t){let e="string"==typeof t?document.querySelector(t):t;if(!e)throw new Error(`The selector "${t}" did not match any elements`);return e.textContent="",e}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,n){if(n){e=`${n}:${e}`;const i=Xr[n];i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){const n=Xr[r];n?t.removeAttributeNS(n,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,n){n&i.D.DashCase?t.style.setProperty(e,r,n&i.D.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&i.D.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){en(e,"property"),t[e]=r}setValue(t,e){t.nodeValue=e}listen(t,e,r){return en(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Qr(r)):this.eventManager.addEventListener(t,e,Qr(r))}}const tn="@".charCodeAt(0);function en(t,e){if(t.charCodeAt(0)===tn)throw new Error(`Found the synthetic ${e} ${t}. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.`)}class rn extends $r{constructor(t,e,r){super(t),this.component=r;const n=Jr(r.id,r.styles,[]);e.addStyles(n),this.contentAttr=Zr.replace(qr,r.id),this.hostAttr=Yr.replace(qr,r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}}class nn extends $r{constructor(t,e,r,n){super(t),this.sharedStylesHost=e,this.hostEl=r,this.component=n,this.shadowRoot=r.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=Jr(n.id,n.styles,[]);for(let o=0;o<i.length;o++){const t=document.createElement("style");t.textContent=i[o],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}const on="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},sn=on("addEventListener"),an=on("removeEventListener"),ln={},cn="__zone_symbol__propagationStopped",un="undefined"!=typeof Zone&&Zone[on("BLACK_LISTED_EVENTS")];let hn;un&&(hn={},un.forEach(t=>{hn[t]=t}));const dn=function(t){return!!hn&&hn.hasOwnProperty(t)},pn=function(t){const e=ln[t.type];if(!e)return;const r=this[e];if(!r)return;const n=[t];if(1===r.length){const t=r[0];return t.zone!==Zone.current?t.zone.run(t.handler,this,n):t.handler.apply(this,n)}{const e=r.slice();for(let r=0;r<e.length&&!0!==t[cn];r++){const t=e[r];t.zone!==Zone.current?t.zone.run(t.handler,this,n):t.handler.apply(this,n)}}},fn={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},mn=new i.o("HammerGestureConfig");class vn{constructor(){this.events=[],this.overrides={}}buildHammer(t){const e=new Hammer(t);e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0});for(const r in this.overrides)e.get(r).set(this.overrides[r]);return e}}const gn=["alt","control","meta","shift"],yn={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};class xn extends Gr{constructor(t){super(t)}supports(t){return null!=xn.parseEventName(t)}addEventListener(t,e,r){const n=xn.parseEventName(e),i=xn.eventCallback(n.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xr().onAndCancel(t,n.domEventName,i))}static parseEventName(t){const e=t.toLowerCase().split("."),r=e.shift();if(0===e.length||"keydown"!==r&&"keyup"!==r)return null;const n=xn._normalizeKey(e.pop());let i="";if(gn.forEach(t=>{const r=e.indexOf(t);r>-1&&(e.splice(r,1),i+=t+".")}),i+=n,0!=e.length||0===n.length)return null;const o={};return o.domEventName=r,o.fullKey=i,o}static getEventFullKey(t){let e="",r=xr().getEventKey(t);return" "===(r=r.toLowerCase())?r="space":"."===r&&(r="dot"),gn.forEach(n=>{n!=r&&(0,yn[n])(t)&&(e+=n+".")}),e+=r}static eventCallback(t,e,r){return n=>{xn.getEventFullKey(n)===t&&r.runGuarded(()=>e(n))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}class bn{constructor(t,e){this.defaultDoc=t,this.DOM=e;const r=this.DOM.createHtmlDocument();if(this.inertBodyElement=r.body,null==this.inertBodyElement){const t=this.DOM.createElement("html",r);this.inertBodyElement=this.DOM.createElement("body",r),this.DOM.appendChild(t,this.inertBodyElement),this.DOM.appendChild(r,t)}this.DOM.setInnerHTML(this.inertBodyElement,'<svg><g onload="this.parentNode.remove()"></g></svg>'),!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.DOM.setInnerHTML(this.inertBodyElement,'<svg><p><style><img src="</style><img src=x onerror=alert(1)//">'),this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(t){return null}const e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(null);const r=e.response.body;return r.removeChild(r.firstChild),r}getInertBodyElement_DOMParser(t){t="<body><remove></remove>"+t+"</body>";try{const e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(t){return null}}getInertBodyElement_InertDocument(t){const e=this.DOM.createElement("template");return"content"in e?(this.DOM.setInnerHTML(e,t),e):(this.DOM.setInnerHTML(this.inertBodyElement,t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}stripCustomNsAttrs(t){this.DOM.attributeMap(t).forEach((e,r)=>{"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||this.DOM.removeAttribute(t,r)});for(const e of this.DOM.childNodesAsList(t))this.DOM.isElementNode(e)&&this.stripCustomNsAttrs(e)}}const wn=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,_n=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Sn(t){return(t=String(t)).match(wn)||t.match(_n)?t:(Object(i.T)()&&xr().log(`WARNING: sanitizing unsafe URL value ${t} (see http://g.co/ng/security#xss)`),"unsafe:"+t)}function Tn(t){const e={};for(const r of t.split(","))e[r]=!0;return e}function Mn(...t){const e={};for(const r of t)for(const t in r)r.hasOwnProperty(t)&&(e[t]=!0);return e}const An=Tn("area,br,col,hr,img,wbr"),En=Tn("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Cn=Tn("rp,rt"),Pn=Mn(Cn,En),On=Mn(En,Tn("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Nn=Mn(Cn,Tn("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ln=Mn(An,On,Nn,Pn),In=Tn("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Rn=Tn("srcset"),Dn=Tn("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Fn=Mn(In,Rn,Dn);class kn{constructor(){this.sanitizedSomething=!1,this.buf=[],this.DOM=xr()}sanitizeChildren(t){let e=this.DOM.firstChild(t);for(;e;)if(this.DOM.isElementNode(e)?this.startElement(e):this.DOM.isTextNode(e)?this.chars(this.DOM.nodeValue(e)):this.sanitizedSomething=!0,this.DOM.firstChild(e))e=this.DOM.firstChild(e);else for(;e;){this.DOM.isElementNode(e)&&this.endElement(e);let t=this.checkClobberedElement(e,this.DOM.nextSibling(e));if(t){e=t;break}e=this.checkClobberedElement(e,this.DOM.parentElement(e))}return this.buf.join("")}startElement(t){const e=this.DOM.nodeName(t).toLowerCase();Ln.hasOwnProperty(e)?(this.buf.push("<"),this.buf.push(e),this.DOM.attributeMap(t).forEach((t,e)=>{const r=e.toLowerCase();Fn.hasOwnProperty(r)?(In[r]&&(t=Sn(t)),Rn[r]&&(t=String(t).split(",").map(t=>Sn(t.trim())).join(", ")),this.buf.push(" "),this.buf.push(e),this.buf.push('="'),this.buf.push(jn(t)),this.buf.push('"')):this.sanitizedSomething=!0}),this.buf.push(">")):this.sanitizedSomething=!0}endElement(t){const e=this.DOM.nodeName(t).toLowerCase();Ln.hasOwnProperty(e)&&!An.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(jn(t))}checkClobberedElement(t,e){if(e&&this.DOM.contains(t,e))throw new Error(`Failed to sanitize html because the element is clobbered: ${this.DOM.getOuterHTML(t)}`);return e}}const Un=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Bn=/([^\#-~ |!])/g;function jn(t){return t.replace(/&/g,"&amp;").replace(Un,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Bn,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let zn;const Vn=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Gn=/^url\(([^)]+)\)$/;class Hn{}class Wn extends Hn{constructor(t){super(),this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case i.F.NONE:return e;case i.F.HTML:return e instanceof qn?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){const r=xr();let n=null;try{zn=zn||new bn(t,r);let o=e?String(e):"";n=zn.getInertBodyElement(o);let s=5,a=o;do{if(0===s)throw new Error("Failed to sanitize html because the input is unstable");s--,o=a,a=r.getInnerHTML(n),n=zn.getInertBodyElement(o)}while(o!==a);const l=new kn,c=l.sanitizeChildren(r.getTemplateContent(n)||n);return Object(i.T)()&&l.sanitizedSomething&&r.log("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),c}finally{if(n){const t=r.getTemplateContent(n)||n;for(const e of r.childNodesAsList(t))r.removeChild(t,e)}}}(this._doc,String(e)));case i.F.STYLE:return e instanceof Yn?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";const e=t.match(Gn);return e&&Sn(e[1])===e[1]||t.match(Vn)&&function(t){let e=!0,r=!0;for(let n=0;n<t.length;n++){const i=t.charAt(n);"'"===i&&r?e=!e:'"'===i&&e&&(r=!r)}return e&&r}(t)?t:(Object(i.T)()&&xr().log(`WARNING: sanitizing unsafe style value ${t} (see http://g.co/ng/security#xss).`),"unsafe")}(e));case i.F.SCRIPT:if(e instanceof Zn)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case i.F.URL:return e instanceof Qn||e instanceof Jn?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),Sn(String(e)));case i.F.RESOURCE_URL:if(e instanceof Qn)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(t,e){if(t instanceof Xn)throw new Error(`Required a safe ${e}, got a ${t.getTypeName()} `+"(see http://g.co/ng/security#xss)")}bypassSecurityTrustHtml(t){return new qn(t)}bypassSecurityTrustStyle(t){return new Yn(t)}bypassSecurityTrustScript(t){return new Zn(t)}bypassSecurityTrustUrl(t){return new Jn(t)}bypassSecurityTrustResourceUrl(t){return new Qn(t)}}class Xn{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}`+" (see http://g.co/ng/security#xss)"}}class qn extends Xn{getTypeName(){return"HTML"}}class Yn extends Xn{getTypeName(){return"Style"}}class Zn extends Xn{getTypeName(){return"Script"}}class Jn extends Xn{getTypeName(){return"URL"}}class Qn extends Xn{getTypeName(){return"ResourceURL"}}const Kn=[{provide:i.z,useValue:"browser"},{provide:i.A,useValue:function(){Er.makeCurrent(),Fr.init()},multi:!0},{provide:G,useClass:Lr,deps:[Or]},{provide:Or,useFactory:function(){return document},deps:[]}],$n=Object(i.P)(i.U,"browser",Kn);function ti(){return new i.l}class ei{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:ei,providers:[{provide:i.c,useValue:t.appId},{provide:Rr,useExisting:i.c},Dr]}}}"undefined"!=typeof window&&window,new i.L("5.2.9");class ri{constructor(t,e){this.id=t,this.url=e}}class ni extends ri{toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ii extends ri{constructor(t,e,r){super(t,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class oi extends ri{constructor(t,e,r){super(t,e),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class si extends ri{constructor(t,e,r){super(t,e),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ai extends ri{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class li extends ri{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ci extends ri{constructor(t,e,r,n,i){super(t,e),this.urlAfterRedirects=r,this.state=n,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ui extends ri{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hi extends ri{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class di{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class pi{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class fi{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class mi{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vi{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gi{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}const yi="primary";class xi{constructor(t){this.params=t||{}}has(t){return this.params.hasOwnProperty(t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function bi(t){return new xi(t)}const wi="ngNavigationCancelingError";function _i(t,e,r){const n=r.path.split("/");if(n.length>t.length)return null;if("full"===r.pathMatch&&(e.hasChildren()||n.length<t.length))return null;const i={};for(let o=0;o<n.length;o++){const e=n[o],r=t[o];if(e.startsWith(":"))i[e.substring(1)]=r;else if(e!==r.path)return null}return{consumed:t.slice(0,n.length),posParams:i}}class Si{constructor(t,e){this.routes=t,this.module=e}}function Ti(t,e=""){for(let r=0;r<t.length;r++){const n=t[r];Mi(n,Ai(e,n))}}function Mi(t,e){if(!t)throw new Error(`\n      Invalid configuration of route '${e}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(t))throw new Error(`Invalid configuration of route '${e}': Array cannot be specified`);if(!t.component&&t.outlet&&t.outlet!==yi)throw new Error(`Invalid configuration of route '${e}': a componentless route cannot have a named outlet set`);if(t.redirectTo&&t.children)throw new Error(`Invalid configuration of route '${e}': redirectTo and children cannot be used together`);if(t.redirectTo&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': redirectTo and loadChildren cannot be used together`);if(t.children&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': children and loadChildren cannot be used together`);if(t.redirectTo&&t.component)throw new Error(`Invalid configuration of route '${e}': redirectTo and component cannot be used together`);if(t.path&&t.matcher)throw new Error(`Invalid configuration of route '${e}': path and matcher cannot be used together`);if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error(`Invalid configuration of route '${e}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===t.path&&void 0===t.matcher)throw new Error(`Invalid configuration of route '${e}': routes must have either a path or a matcher specified`);if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error(`Invalid configuration of route '${e}': path cannot start with a slash`);if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error(`Invalid configuration of route '{path: "${e}", redirectTo: "${t.redirectTo}"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`);if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error(`Invalid configuration of route '${e}': pathMatch can only be set to 'prefix' or 'full'`);t.children&&Ti(t.children,e)}function Ai(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function Ei(t){const e=t.children&&t.children.map(Ei);return e?Object.assign({},t,{children:e}):Object.assign({},t)}function Ci(t,e){const r=Object.keys(t),n=Object.keys(e);if(r.length!=n.length)return!1;let i;for(let o=0;o<r.length;o++)if(t[i=r[o]]!==e[i])return!1;return!0}function Pi(t){return Array.prototype.concat.apply([],t)}function Oi(t){return t.length>0?t[t.length-1]:null}function Ni(t,e){for(const r in t)t.hasOwnProperty(r)&&e(t[r],r)}function Li(t){const e=ir.call(t);return $e.call(e,t=>!0===t)}function Ii(t){return Object(i._8)(t)?t:Object(i._9)(t)?Ze(Promise.resolve(t)):O(t)}function Ri(t,e,r){return r?function(t,e){return Ci(t,e)}(t.queryParams,e.queryParams)&&function t(e,r){if(!Ui(e.segments,r.segments))return!1;if(e.numberOfChildren!==r.numberOfChildren)return!1;for(const n in r.children){if(!e.children[n])return!1;if(!t(e.children[n],r.children[n]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(r=>e[r]===t[r])}(t.queryParams,e.queryParams)&&function t(e,r){return function e(r,n,i){if(r.segments.length>i.length){return!!Ui(r.segments.slice(0,i.length),i)&&!n.hasChildren()}if(r.segments.length===i.length){if(!Ui(r.segments,i))return!1;for(const e in n.children){if(!r.children[e])return!1;if(!t(r.children[e],n.children[e]))return!1}return!0}{const t=i.slice(0,r.segments.length),o=i.slice(r.segments.length);return!!Ui(r.segments,t)&&!!r.children[yi]&&e(r.children[yi],n,o)}}(e,r,r.segments)}(t.root,e.root)}class Di{constructor(t,e,r){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=bi(this.queryParams)),this._queryParamMap}toString(){return Vi.serialize(this)}}class Fi{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Ni(e,(t,e)=>t.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Gi(this)}}class ki{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=bi(this.parameters)),this._parameterMap}toString(){return Zi(this)}}function Ui(t,e){return t.length===e.length&&t.every((t,r)=>t.path===e[r].path)}function Bi(t,e){let r=[];return Ni(t.children,(t,n)=>{n===yi&&(r=r.concat(e(t,n)))}),Ni(t.children,(t,n)=>{n!==yi&&(r=r.concat(e(t,n)))}),r}class ji{}class zi{parse(t){const e=new to(t);return new Di(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){return`${`/${function t(e,r){if(!e.hasChildren())return Gi(e);if(r){const r=e.children[yi]?t(e.children[yi],!1):"",n=[];return Ni(e.children,(e,r)=>{r!==yi&&n.push(`${r}:${t(e,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=Bi(e,(r,n)=>n===yi?[t(e.children[yi],!1)]:[`${n}:${t(r,!1)}`]);return`${Gi(e)}/(${r.join("//")})`}}(t.root,!0)}`}${function(t){const e=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(t=>`${Wi(e)}=${Wi(t)}`).join("&"):`${Wi(e)}=${Wi(r)}`});return e.length?`?${e.join("&")}`:""}(t.queryParams)}${"string"==typeof t.fragment?`#${encodeURI(t.fragment)}`:""}`}}const Vi=new zi;function Gi(t){return t.segments.map(t=>Zi(t)).join("/")}function Hi(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Wi(t){return Hi(t).replace(/%3B/gi,";")}function Xi(t){return Hi(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qi(t){return decodeURIComponent(t)}function Yi(t){return qi(t.replace(/\+/g,"%20"))}function Zi(t){return`${Xi(t.path)}${function(t){return Object.keys(t).map(e=>`;${Xi(e)}=${Xi(t[e])}`).join("")}(t.parameters)}`}const Ji=/^[^\/()?;=&#]+/;function Qi(t){const e=t.match(Ji);return e?e[0]:""}const Ki=/^[^=?&#]+/,$i=/^[^?&#]+/;class to{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fi([],{}):new Fi([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[yi]=new Fi(t,e)),r}parseSegment(){const t=Qi(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new ki(qi(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Qi(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const t=Qi(this.remaining);t&&this.capture(r=t)}t[qi(e)]=qi(r)}parseQueryParam(t){const e=function(t){const e=t.match(Ki);return e?e[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const t=function(t){const e=t.match($i);return e?e[0]:""}(this.remaining);t&&this.capture(r=t)}const n=Yi(e),i=Yi(r);if(t.hasOwnProperty(n)){let e=t[n];Array.isArray(e)||(t[n]=e=[e]),e.push(i)}else t[n]=i}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Qi(this.remaining),n=this.remaining[r.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;r.indexOf(":")>-1?(i=r.substr(0,r.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=yi);const o=this.parseChildren();e[i]=1===Object.keys(o).length?o[yi]:new Fi([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class eo{constructor(t){this.segmentGroup=t||null}}class ro{constructor(t){this.urlTree=t}}function no(t){return new E.a(e=>e.error(new eo(t)))}function io(t){return new E.a(e=>e.error(new ro(t)))}function oo(t){return new E.a(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class so{constructor(t,e,r,n,o){this.configLoader=e,this.urlSerializer=r,this.urlTree=n,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(i.v)}apply(){const t=this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,yi),e=V.call(t,t=>this.createUrlTree(t,this.urlTree.queryParams,this.urlTree.fragment));return de.call(e,t=>{if(t instanceof ro)return this.allowRedirects=!1,this.match(t.urlTree);if(t instanceof eo)throw this.noMatchError(t);throw t})}match(t){const e=this.expandSegmentGroup(this.ngModule,this.config,t.root,yi),r=V.call(e,e=>this.createUrlTree(e,t.queryParams,t.fragment));return de.call(r,t=>{if(t instanceof eo)throw this.noMatchError(t);throw t})}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,r){const n=t.segments.length>0?new Fi([],{[yi]:t}):t;return new Di(n,e,r)}expandSegmentGroup(t,e,r,n){return 0===r.segments.length&&r.hasChildren()?V.call(this.expandChildren(t,e,r),t=>new Fi([],t)):this.expandSegment(t,r,e,r.segments,n,!0)}expandChildren(t,e,r){return function(t,e){if(0===Object.keys(t).length)return O({});const r=[],n=[],i={};Ni(t,(t,o)=>{const s=V.call(e(o,t),t=>i[o]=t);o===yi?r.push(s):n.push(s)});const o=Ge.call(O(...r,...n)),s=nr.call(o);return V.call(s,()=>i)}(r.children,(r,n)=>this.expandSegmentGroup(t,e,n,r))}expandSegment(t,e,r,n,i,o){const s=O(...r),a=V.call(s,s=>{const a=this.expandSegmentAgainstRoute(t,e,r,s,n,i,o);return de.call(a,t=>{if(t instanceof eo)return O(null);throw t})}),l=Ge.call(a),c=Ye.call(l,t=>!!t);return de.call(c,(t,r)=>{if(t instanceof He||"EmptyError"===t.name){if(this.noLeftoversInUrl(e,n,i))return O(new Fi([],{}));throw new eo(e)}throw t})}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}expandSegmentAgainstRoute(t,e,r,n,i,o,s){return uo(n)!==o?no(e):void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,e,n,i):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o):no(e)}expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){return"**"===n.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,n,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,r,n){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?io(i):ve.call(this.lineralizeSegments(r,i),r=>{const i=new Fi(r,{});return this.expandSegment(t,i,e,r,n,!1)})}expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){const{matched:s,consumedSegments:a,lastChild:l,positionalParamSegments:c}=ao(e,n,i);if(!s)return no(e);const u=this.applyRedirectCommands(a,n.redirectTo,c);return n.redirectTo.startsWith("/")?io(u):ve.call(this.lineralizeSegments(n,u),n=>this.expandSegment(t,e,r,n.concat(i.slice(l)),o,!1))}matchSegmentAgainstRoute(t,e,r,n){if("**"===r.path)return r.loadChildren?V.call(this.configLoader.load(t.injector,r),t=>(r._loadedConfig=t,new Fi(n,{}))):O(new Fi(n,{}));const{matched:i,consumedSegments:o,lastChild:s}=ao(e,r,n);if(!i)return no(e);const a=n.slice(s),l=this.getChildConfig(t,r);return ve.call(l,t=>{const r=t.module,n=t.routes,{segmentGroup:i,slicedSegments:s}=function(t,e,r,n){return r.length>0&&function(t,e,r){return n.some(r=>co(t,e,r)&&uo(r)!==yi)}(t,r)?{segmentGroup:lo(new Fi(e,function(t,e){const r={};r[yi]=e;for(const n of t)""===n.path&&uo(n)!==yi&&(r[uo(n)]=new Fi([],{}));return r}(n,new Fi(r,t.children)))),slicedSegments:[]}:0===r.length&&function(t,e,r){return n.some(r=>co(t,e,r))}(t,r)?{segmentGroup:lo(new Fi(t.segments,function(t,e,r,n){const i={};for(const o of r)co(t,e,o)&&!n[uo(o)]&&(i[uo(o)]=new Fi([],{}));return Object.assign({},n,i)}(t,r,n,t.children))),slicedSegments:r}:{segmentGroup:t,slicedSegments:r}}(e,o,a,n);if(0===s.length&&i.hasChildren()){const t=this.expandChildren(r,n,i);return V.call(t,t=>new Fi(o,t))}if(0===n.length&&0===s.length)return O(new Fi(o,{}));const l=this.expandSegment(r,i,n,s,yi,!0);return V.call(l,t=>new Fi(o.concat(t.segments),t.children))})}getChildConfig(t,e){return e.children?O(new Si(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?O(e._loadedConfig):ve.call(function(t,e){const r=e.canLoad;return r&&0!==r.length?Li(V.call(je(r),r=>{const n=t.get(r);return Ii(n.canLoad?n.canLoad(e):n(e))})):O(!0)}(t.injector,e),r=>r?V.call(this.configLoader.load(t.injector,e),t=>(e._loadedConfig=t,t)):function(t){return new E.a(e=>e.error(function(t){const e=Error("NavigationCancelingError: "+t);return e[wi]=!0,e}(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e)):O(new Si([],t))}lineralizeSegments(t,e){let r=[],n=e.root;for(;;){if(r=r.concat(n.segments),0===n.numberOfChildren)return O(r);if(n.numberOfChildren>1||!n.children[yi])return oo(t.redirectTo);n=n.children[yi]}}applyRedirectCommands(t,e,r){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,r)}applyRedirectCreatreUrlTree(t,e,r,n){const i=this.createSegmentGroup(t,e.root,r,n);return new Di(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const r={};return Ni(t,(t,n)=>{if("string"==typeof t&&t.startsWith(":")){const i=t.substring(1);r[n]=e[i]}else r[n]=t}),r}createSegmentGroup(t,e,r,n){const i=this.createSegments(t,e.segments,r,n);let o={};return Ni(e.children,(e,i)=>{o[i]=this.createSegmentGroup(t,e,r,n)}),new Fi(i,o)}createSegments(t,e,r,n){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,n):this.findOrReturn(e,r))}findPosParam(t,e,r){const n=r[e.path.substring(1)];if(!n)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return n}findOrReturn(t,e){let r=0;for(const n of e){if(n.path===t.path)return e.splice(r),n;r++}return t}}function ao(t,e,r){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||r.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const n=(e.matcher||_i)(r,t,e);return n?{matched:!0,consumedSegments:n.consumed,lastChild:n.consumed.length,positionalParamSegments:n.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function lo(t){if(1===t.numberOfChildren&&t.children[yi]){const e=t.children[yi];return new Fi(t.segments.concat(e.segments),e.children)}return t}function co(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0!==r.redirectTo}function uo(t){return t.outlet||yi}class ho{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=po(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=po(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=fo(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return fo(t,this._root).map(t=>t.value)}}function po(t,e){if(t===e.value)return e;for(const r of e.children){const e=po(t,r);if(e)return e}return null}function fo(t,e){if(t===e.value)return[e];for(const r of e.children){const n=fo(t,r);if(n.length)return n.unshift(e),n}return[]}class mo{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function vo(t){const e={};return t&&t.children.forEach(t=>e[t.value.outlet]=t),e}class go extends ho{constructor(t,e){super(t),this.snapshot=e,So(this,t)}toString(){return this.snapshot.toString()}}function yo(t,e){const r=function(t,e){const r=new wo([],{},{},"",{},yi,e,null,t.root,-1,{});return new _o("",new mo(r,[]))}(t,e),n=new me([new ki("",{})]),i=new me({}),o=new me({}),s=new me({}),a=new me(""),l=new xo(n,i,s,a,o,yi,e,r.root);return l.snapshot=r.root,new go(new mo(l,[]),r)}class xo{constructor(t,e,r,n,i,o,s,a){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=V.call(this.params,t=>bi(t))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=V.call(this.queryParams,t=>bi(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bo(t,e="emptyOnly"){const r=t.pathFromRoot;let n=0;if("always"!==e)for(n=r.length-1;n>=1;){const t=r[n],e=r[n-1];if(t.routeConfig&&""===t.routeConfig.path)n--;else{if(e.component)break;n--}}return function(t){return t.reduce((t,e)=>({params:Object.assign({},t.params,e.params),data:Object.assign({},t.data,e.data),resolve:Object.assign({},t.resolve,e._resolvedData)}),{params:{},data:{},resolve:{}})}(r.slice(n))}class wo{constructor(t,e,r,n,i,o,s,a,l,c,u){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=s,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=bi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=bi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class _o extends ho{constructor(t,e){super(e),this.url=t,So(this,e)}toString(){return To(this._root)}}function So(t,e){e.value._routerState=t,e.children.forEach(e=>So(t,e))}function To(t){const e=t.children.length>0?` { ${t.children.map(To).join(", ")} } `:"";return`${t.value}${e}`}function Mo(t){if(t.snapshot){const e=t.snapshot,r=t._futureSnapshot;t.snapshot=r,Ci(e.queryParams,r.queryParams)||t.queryParams.next(r.queryParams),e.fragment!==r.fragment&&t.fragment.next(r.fragment),Ci(e.params,r.params)||t.params.next(r.params),function(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Ci(t[r],e[r]))return!1;return!0}(e.url,r.url)||t.url.next(r.url),Ci(e.data,r.data)||t.data.next(r.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Ao(t,e){return Ci(t.params,e.params)&&function(t,e){return Ui(t,e)&&t.every((t,r)=>Ci(t.parameters,e[r].parameters))}(t.url,e.url)&&!(!t.parent!=!e.parent)&&(!t.parent||Ao(t.parent,e.parent))}function Eo(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Co(t,e,r,n,i){let o={};return n&&Ni(n,(t,e)=>{o[e]=Array.isArray(t)?t.map(t=>`${t}`):`${t}`}),new Di(r.root===t?e:function t(e,r,n){const i={};return Ni(e.children,(e,o)=>{i[o]=e===r?n:t(e,r,n)}),new Fi(e.segments,i)}(r.root,t,e),o,i)}class Po{constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&Eo(r[0]))throw new Error("Root segment cannot have matrix parameters");const n=r.find(t=>"object"==typeof t&&null!=t&&t.outlets);if(n&&n!==Oi(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Oo{constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}}function No(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[yi]:`${t}`}function Lo(t,e,r){if(t||(t=new Fi([],{})),0===t.segments.length&&t.hasChildren())return Io(t,e,r);const n=function(t,e,r){let n=0,i=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(n>=r.length)return o;const e=t.segments[i],s=No(r[n]),a=n<r.length-1?r[n+1]:null;if(i>0&&void 0===s)break;if(s&&a&&"object"==typeof a&&void 0===a.outlets){if(!ko(s,a,e))return o;n+=2}else{if(!ko(s,{},e))return o;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(t,e,r),i=r.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){const e=new Fi(t.segments.slice(0,n.pathIndex),{});return e.children[yi]=new Fi(t.segments.slice(n.pathIndex),t.children),Io(e,0,i)}return n.match&&0===i.length?new Fi(t.segments,{}):n.match&&!t.hasChildren()?Ro(t,e,r):n.match?Io(t,0,i):Ro(t,e,r)}function Io(t,e,r){if(0===r.length)return new Fi(t.segments,{});{const n=function(t){return"object"!=typeof t[0]?{[yi]:t}:void 0===t[0].outlets?{[yi]:t}:t[0].outlets}(r),i={};return Ni(n,(r,n)=>{null!==r&&(i[n]=Lo(t.children[n],e,r))}),Ni(t.children,(t,e)=>{void 0===n[e]&&(i[e]=t)}),new Fi(t.segments,i)}}function Ro(t,e,r){const n=t.segments.slice(0,e);let i=0;for(;i<r.length;){if("object"==typeof r[i]&&void 0!==r[i].outlets){const t=Do(r[i].outlets);return new Fi(n,t)}if(0===i&&Eo(r[0])){n.push(new ki(t.segments[e].path,r[0])),i++;continue}const o=No(r[i]),s=i<r.length-1?r[i+1]:null;o&&s&&Eo(s)?(n.push(new ki(o,Fo(s))),i+=2):(n.push(new ki(o,{})),i++)}return new Fi(n,{})}function Do(t){const e={};return Ni(t,(t,r)=>{null!==t&&(e[r]=Ro(new Fi([],{}),0,t))}),e}function Fo(t){const e={};return Ni(t,(t,r)=>e[r]=`${t}`),e}function ko(t,e,r){return t==r.path&&Ci(e,r.parameters)}class Uo{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Bo{constructor(t,e){this.component=t,this.route=e}}class jo{constructor(t,e,r,n){this.future=t,this.curr=e,this.moduleInjector=r,this.forwardEvent=n,this.canActivateChecks=[],this.canDeactivateChecks=[]}initialize(t){const e=this.future._root;this.setupChildRouteGuards(e,this.curr?this.curr._root:null,t,[e.value])}checkGuards(){if(!this.isDeactivating()&&!this.isActivating())return O(!0);const t=this.runCanDeactivateChecks();return ve.call(t,t=>t?this.runCanActivateChecks():O(!1))}resolveData(t){if(!this.isActivating())return O(null);const e=je(this.canActivateChecks),r=I.call(e,e=>this.runResolve(e.route,t));return gr.call(r,(t,e)=>t)}isDeactivating(){return 0!==this.canDeactivateChecks.length}isActivating(){return 0!==this.canActivateChecks.length}setupChildRouteGuards(t,e,r,n){const i=vo(e);t.children.forEach(t=>{this.setupRouteGuards(t,i[t.value.outlet],r,n.concat([t.value])),delete i[t.value.outlet]}),Ni(i,(t,e)=>this.deactivateRouteAndItsChildren(t,r.getContext(e)))}setupRouteGuards(t,e,r,n){const i=t.value,o=e?e.value:null,s=r?r.getContext(t.value.outlet):null;if(o&&i.routeConfig===o.routeConfig){const a=this.shouldRunGuardsAndResolvers(o,i,i.routeConfig.runGuardsAndResolvers);a?this.canActivateChecks.push(new Uo(n)):(i.data=o.data,i._resolvedData=o._resolvedData),this.setupChildRouteGuards(t,e,i.component?s?s.children:null:r,n),a&&this.canDeactivateChecks.push(new Bo(s.outlet.component,o))}else o&&this.deactivateRouteAndItsChildren(e,s),this.canActivateChecks.push(new Uo(n)),this.setupChildRouteGuards(t,null,i.component?s?s.children:null:r,n)}shouldRunGuardsAndResolvers(t,e,r){switch(r){case"always":return!0;case"paramsOrQueryParamsChange":return!Ao(t,e)||!Ci(t.queryParams,e.queryParams);case"paramsChange":default:return!Ao(t,e)}}deactivateRouteAndItsChildren(t,e){const r=vo(t),n=t.value;Ni(r,(t,r)=>{this.deactivateRouteAndItsChildren(t,n.component?e?e.children.getContext(r):null:e)}),this.canDeactivateChecks.push(new Bo(n.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,n))}runCanDeactivateChecks(){const t=je(this.canDeactivateChecks),e=ve.call(t,t=>this.runCanDeactivate(t.component,t.route));return $e.call(e,t=>!0===t)}runCanActivateChecks(){const t=je(this.canActivateChecks),e=I.call(t,t=>Li(je([this.fireChildActivationStart(t.route.parent),this.fireActivationStart(t.route),this.runCanActivateChild(t.path),this.runCanActivate(t.route)])));return $e.call(e,t=>!0===t)}fireActivationStart(t){return null!==t&&this.forwardEvent&&this.forwardEvent(new vi(t)),O(!0)}fireChildActivationStart(t){return null!==t&&this.forwardEvent&&this.forwardEvent(new fi(t)),O(!0)}runCanActivate(t){const e=t.routeConfig?t.routeConfig.canActivate:null;return e&&0!==e.length?Li(V.call(je(e),e=>{const r=this.getToken(e,t);let n;return n=Ii(r.canActivate?r.canActivate(t,this.future):r(t,this.future)),Ye.call(n)})):O(!0)}runCanActivateChild(t){const e=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(t=>this.extractCanActivateChild(t)).filter(t=>null!==t);return Li(V.call(je(r),t=>Li(V.call(je(t.guards),r=>{const n=this.getToken(r,t.node);let i;return i=Ii(n.canActivateChild?n.canActivateChild(e,this.future):n(e,this.future)),Ye.call(i)}))))}extractCanActivateChild(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}runCanDeactivate(t,e){const r=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!r||0===r.length)return O(!0);const n=ve.call(je(r),r=>{const n=this.getToken(r,e);let i;return i=Ii(n.canDeactivate?n.canDeactivate(t,e,this.curr,this.future):n(t,e,this.curr,this.future)),Ye.call(i)});return $e.call(n,t=>!0===t)}runResolve(t,e){return V.call(this.resolveNode(t._resolve,t),r=>(t._resolvedData=r,t.data=Object.assign({},t.data,bo(t,e).resolve),null))}resolveNode(t,e){const r=Object.keys(t);if(0===r.length)return O({});if(1===r.length){const n=r[0];return V.call(this.getResolver(t[n],e),t=>({[n]:t}))}const n={},i=ve.call(je(r),r=>V.call(this.getResolver(t[r],e),t=>(n[r]=t,t)));return V.call(nr.call(i),()=>n)}getResolver(t,e){const r=this.getToken(t,e);return Ii(r.resolve?r.resolve(e,this.future):r(e,this.future))}getToken(t,e){const r=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:this.moduleInjector).get(t)}}class zo{}class Vo{constructor(t,e,r,n,i){this.rootComponentType=t,this.config=e,this.urlTree=r,this.url=n,this.paramsInheritanceStrategy=i}recognize(){try{const t=Wo(this.urlTree.root,[],[],this.config).segmentGroup,e=this.processSegmentGroup(this.config,t,yi),r=new wo([],Object.freeze({}),Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,{},yi,this.rootComponentType,null,this.urlTree.root,-1,{}),n=new mo(r,e),i=new _o(this.url,n);return this.inheritParamsAndData(i._root),O(i)}catch(t){return new E.a(e=>e.error(t))}}inheritParamsAndData(t){const e=t.value,r=bo(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),t.children.forEach(t=>this.inheritParamsAndData(t))}processSegmentGroup(t,e,r){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,r)}processChildren(t,e){const r=Bi(e,(e,r)=>this.processSegmentGroup(t,e,r));return function(t){const e={};r.forEach(t=>{const r=e[t.value.outlet];if(r){const e=r.url.map(t=>t.toString()).join("/"),n=t.value.url.map(t=>t.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${e}' and '${n}'.`)}e[t.value.outlet]=t.value})}(),r.sort((t,e)=>t.value.outlet===yi?-1:e.value.outlet===yi?1:t.value.outlet.localeCompare(e.value.outlet)),r}processSegment(t,e,r,n){for(const i of t)try{return this.processSegmentAgainstRoute(i,e,r,n)}catch(t){if(!(t instanceof zo))throw t}if(this.noLeftoversInUrl(e,r,n))return[];throw new zo}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}processSegmentAgainstRoute(t,e,r,n){if(t.redirectTo)throw new zo;if((t.outlet||yi)!==n)throw new zo;let i,o=[],s=[];if("**"===t.path){const o=r.length>0?Oi(r).parameters:{};i=new wo(r,o,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Yo(t),n,t.component,t,Go(e),Ho(e)+r.length,Zo(t))}else{const a=function(t,e,r){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||r.length>0))throw new zo;return{consumedSegments:[],lastChild:0,parameters:{}}}const n=(e.matcher||_i)(r,t,e);if(!n)throw new zo;const i={};Ni(n.posParams,(t,e)=>{i[e]=t.path});const o=n.consumed.length>0?Object.assign({},i,n.consumed[n.consumed.length-1].parameters):i;return{consumedSegments:n.consumed,lastChild:n.consumed.length,parameters:o}}(e,t,r);o=a.consumedSegments,s=r.slice(a.lastChild),i=new wo(o,a.parameters,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,Yo(t),n,t.component,t,Go(e),Ho(e)+o.length,Zo(t))}const a=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),{segmentGroup:l,slicedSegments:c}=Wo(e,o,s,a);if(0===c.length&&l.hasChildren()){const t=this.processChildren(a,l);return[new mo(i,t)]}if(0===a.length&&0===c.length)return[new mo(i,[])];const u=this.processSegment(a,l,c,yi);return[new mo(i,u)]}}function Go(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function Ho(t){let e=t,r=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)r+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return r-1}function Wo(t,e,r,n){if(r.length>0&&function(t,e,r){return n.some(r=>Xo(t,e,r)&&qo(r)!==yi)}(t,r)){const i=new Fi(e,function(t,e,r,n){const i={};i[yi]=n,n._sourceSegment=t,n._segmentIndexShift=e.length;for(const o of r)if(""===o.path&&qo(o)!==yi){const r=new Fi([],{});r._sourceSegment=t,r._segmentIndexShift=e.length,i[qo(o)]=r}return i}(t,e,n,new Fi(r,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===r.length&&function(t,e,r){return n.some(r=>Xo(t,e,r))}(t,r)){const i=new Fi(t.segments,function(t,e,r,n){const i={};for(const o of r)if(Xo(t,e,o)&&!n[qo(o)]){const e=new Fi([],{});e._sourceSegment=t,e._segmentIndexShift=t.segments.length,i[qo(o)]=e}return Object.assign({},n,i)}(t,r,n,t.children));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:r}}const i=new Fi(t.segments,t.children);return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:r}}function Xo(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0===r.redirectTo}function qo(t){return t.outlet||yi}function Yo(t){return t.data||{}}function Zo(t){return t.resolve||{}}class Jo{}class Qo{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}const Ko=new i.o("ROUTES");class $o{constructor(t,e,r,n){this.loader=t,this.compiler=e,this.onLoadStartListener=r,this.onLoadEndListener=n}load(t,e){this.onLoadStartListener&&this.onLoadStartListener(e);const r=this.loadModuleFactory(e.loadChildren);return V.call(r,r=>{this.onLoadEndListener&&this.onLoadEndListener(e);const n=r.create(t);return new Si(Pi(n.injector.get(Ko)).map(Ei),n)})}loadModuleFactory(t){return"string"==typeof t?Ze(this.loader.load(t)):ve.call(Ii(t()),t=>t instanceof i.t?O(t):Ze(this.compiler.compileModuleAsync(t)))}}class ts{}class es{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function rs(t){throw t}function ns(t){return O(null)}class is{constructor(t,e,r,n,o,s,a,l){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=r,this.location=n,this.config=l,this.navigations=new me(null),this.navigationId=0,this.events=new pe.b,this.errorHandler=rs,this.navigated=!1,this.hooks={beforePreactivation:ns,afterPreactivation:ns},this.urlHandlingStrategy=new es,this.routeReuseStrategy=new Qo,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.ngModule=o.get(i.v),this.resetConfig(l),this.currentUrlTree=new Di(new Fi([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.configLoader=new $o(s,a,t=>this.triggerEvent(new di(t)),t=>this.triggerEvent(new pi(t))),this.routerState=yo(this.currentUrlTree,this.rootComponentType),this.processNavigations()}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const e=this.urlSerializer.parse(t.url),r="popstate"===t.type?"popstate":"hashchange";setTimeout(()=>{this.scheduleNavigation(e,r,{replaceUrl:!0})},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}triggerEvent(t){this.events.next(t)}resetConfig(t){Ti(t),this.config=t.map(Ei),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}createUrlTree(t,e={}){const{relativeTo:r,queryParams:n,fragment:o,preserveQueryParams:s,queryParamsHandling:a,preserveFragment:l}=e;Object(i.T)()&&s&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const c=r||this.routerState.root,u=l?this.currentUrlTree.fragment:o;let h=null;if(a)switch(a){case"merge":h=Object.assign({},this.currentUrlTree.queryParams,n);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=n||null}else h=s?this.currentUrlTree.queryParams:n||null;return null!==h&&(h=this.removeEmptyProps(h)),function(t,e,r,n,i){if(0===r.length)return Co(e.root,e.root,e,n,i);const o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Po(!0,0,t);let e=0,r=!1;const n=t.reduce((t,n,i)=>{if("object"==typeof n&&null!=n){if(n.outlets){const e={};return Ni(n.outlets,(t,r)=>{e[r]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(n.segmentPath)return[...t,n.segmentPath]}return"string"!=typeof n?[...t,n]:0===i?(n.split("/").forEach((n,i)=>{0==i&&"."===n||(0==i&&""===n?r=!0:".."===n?e++:""!=n&&t.push(n))}),t):[...t,n]},[]);return new Po(r,e,n)}(r);if(o.toRoot())return Co(e.root,new Fi([],{}),e,n,i);const s=function(t,r,n){if(t.isAbsolute)return new Oo(e.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new Oo(n.snapshot._urlSegment,!0,0);const i=Eo(t.commands[0])?0:1;return function(e,r,o){let s=n.snapshot._urlSegment,a=n.snapshot._lastPathIndex+i,l=t.numberOfDoubleDots;for(;l>a;){if(l-=a,!(s=s.parent))throw new Error("Invalid number of '../'");a=s.segments.length}return new Oo(s,!1,a-l)}()}(o,0,t),a=s.processChildren?Io(s.segmentGroup,s.index,o.commands):Lo(s.segmentGroup,s.index,o.commands);return Co(s.segmentGroup,a,e,n,i)}(c,this.currentUrlTree,t,h,u)}navigateByUrl(t,e={skipLocationChange:!1}){const r=t instanceof Di?t:this.parseUrl(t),n=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(n,"imperative",e)}navigate(t,e={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const r=t[e];if(null==r)throw new Error(`The requested path contains ${r} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){return this.urlSerializer.parse(t)}isActive(t,e){if(t instanceof Di)return Ri(this.currentUrlTree,t,e);const r=this.urlSerializer.parse(t);return Ri(this.currentUrlTree,r,e)}removeEmptyProps(t){return Object.keys(t).reduce((e,r)=>{const n=t[r];return null!==n&&void 0!==n&&(e[r]=n),e},{})}processNavigations(){I.call(this.navigations,t=>t?(this.executeScheduledNavigation(t),t.promise.catch(()=>{})):O(null)).subscribe(()=>{})}scheduleNavigation(t,e,r){const n=this.navigations.value;if(n&&"imperative"!==e&&"imperative"===n.source&&n.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(n&&"hashchange"==e&&"popstate"===n.source&&n.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(n&&"popstate"==e&&"hashchange"===n.source&&n.rawUrl.toString()===t.toString())return Promise.resolve(!0);let i=null,o=null;const s=new Promise((t,e)=>{i=t,o=e}),a=++this.navigationId;return this.navigations.next({id:a,source:e,rawUrl:t,extras:r,resolve:i,reject:o,promise:s}),s.catch(t=>Promise.reject(t))}executeScheduledNavigation({id:t,rawUrl:e,extras:r,resolve:n,reject:i}){const o=this.urlHandlingStrategy.extract(e),s=!this.navigated||o.toString()!==this.currentUrlTree.toString();("reload"===this.onSameUrlNavigation||s)&&this.urlHandlingStrategy.shouldProcessUrl(e)?(this.events.next(new ni(t,this.serializeUrl(o))),Promise.resolve().then(n=>this.runNavigate(o,e,!!r.skipLocationChange,!!r.replaceUrl,t,null)).then(n,i)):s&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)?(this.events.next(new ni(t,this.serializeUrl(o))),Promise.resolve().then(r=>this.runNavigate(o,e,!1,!1,t,yo(o,this.rootComponentType).snapshot)).then(n,i)):(this.rawUrlTree=e,n(null))}runNavigate(t,e,r,n,i,o){return i!==this.navigationId?(this.events.next(new oi(i,this.serializeUrl(t),`Navigation ID ${i} is not equal to the current navigation id ${this.navigationId}`)),Promise.resolve(!1)):new Promise((s,a)=>{let l;if(o)l=O({appliedUrl:t,snapshot:o});else{const e=function(e,r,n,i,o){return new so(e,r,n,t,o).apply()}(this.ngModule.injector,this.configLoader,this.urlSerializer,0,this.config);l=ve.call(e,e=>V.call(function(t,e,r,n,i="emptyOnly"){return new Vo(t,e,r,n,i).recognize()}(this.rootComponentType,this.config,e,this.serializeUrl(e),this.paramsInheritanceStrategy),r=>(this.events.next(new ai(i,this.serializeUrl(t),this.serializeUrl(e),r)),{appliedUrl:e,snapshot:r})))}const c=ve.call(l,t=>V.call(this.hooks.beforePreactivation(t.snapshot),()=>t));let u;const h=V.call(c,({appliedUrl:t,snapshot:e})=>((u=new jo(e,this.routerState.snapshot,this.ngModule.injector,t=>this.triggerEvent(t))).initialize(this.rootContexts),{appliedUrl:t,snapshot:e})),d=ve.call(h,({appliedUrl:e,snapshot:r})=>this.navigationId!==i?O(!1):(this.triggerEvent(new li(i,this.serializeUrl(t),e,r)),V.call(u.checkGuards(),n=>(this.triggerEvent(new ci(i,this.serializeUrl(t),e,r,n)),{appliedUrl:e,snapshot:r,shouldActivate:n})))),p=ve.call(d,e=>this.navigationId!==i?O(!1):e.shouldActivate&&u.isActivating()?(this.triggerEvent(new ui(i,this.serializeUrl(t),e.appliedUrl,e.snapshot)),V.call(u.resolveData(this.paramsInheritanceStrategy),()=>(this.triggerEvent(new hi(i,this.serializeUrl(t),e.appliedUrl,e.snapshot)),e))):O(e)),f=ve.call(p,t=>V.call(this.hooks.afterPreactivation(t.snapshot),()=>t)),m=V.call(f,({appliedUrl:t,snapshot:e,shouldActivate:r})=>r?{appliedUrl:t,state:function(t,e,r){const n=function t(e,r,n){if(n&&e.shouldReuseRoute(r.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=r.value;const o=function(e,r,n){return r.children.map(r=>{for(const i of n.children)if(e.shouldReuseRoute(i.value.snapshot,r.value))return t(e,r,i);return t(e,r)})}(e,r,n);return new mo(i,o)}if(e.retrieve(r.value)){const t=e.retrieve(r.value).route;return function t(e,r){if(e.value.routeConfig!==r.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==r.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");r.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)t(e.children[n],r.children[n])}(r,t),t}{const n=function(t){return new xo(new me(t.url),new me(t.params),new me(t.queryParams),new me(t.fragment),new me(t.data),t.outlet,t.component,t)}(r.value),i=r.children.map(r=>t(e,r));return new mo(n,i)}}(t,e._root,r?r._root:void 0);return new go(n,e)}(this.routeReuseStrategy,e,this.routerState),shouldActivate:r}:{appliedUrl:t,state:null,shouldActivate:r});this.activateRoutes(m,this.routerState,this.currentUrlTree,i,t,e,r,n,s,a)})}activateRoutes(t,e,r,n,i,o,s,a,l,c){let u;t.forEach(({appliedUrl:t,state:r,shouldActivate:i})=>{if(i&&n===this.navigationId){if(this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,o),this.routerState=r,!s){const t=this.urlSerializer.serialize(this.rawUrlTree);this.location.isCurrentPathEqualTo(t)||a?this.location.replaceState(t):this.location.go(t)}new os(this.routeReuseStrategy,r,e,t=>this.triggerEvent(t)).activate(this.rootContexts),u=!0}else u=!1}).then(()=>{u?(this.navigated=!0,this.events.next(new ii(n,this.serializeUrl(i),this.serializeUrl(this.currentUrlTree))),l(!0)):(this.resetUrlToCurrentUrlTree(),this.events.next(new oi(n,this.serializeUrl(i),"")),l(!1))},t=>{if(t&&t[wi])this.navigated=!0,this.resetStateAndUrl(e,r,o),this.events.next(new oi(n,this.serializeUrl(i),t.message)),l(!1);else{this.resetStateAndUrl(e,r,o),this.events.next(new si(n,this.serializeUrl(i),t));try{l(this.errorHandler(t))}catch(t){c(t)}}})}resetStateAndUrl(t,e,r){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree))}}class os{constructor(t,e,r,n){this.routeReuseStrategy=t,this.futureState=e,this.currState=r,this.forwardEvent=n}activate(t){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,t),Mo(this.futureState.root),this.activateChildRoutes(e,r,t)}deactivateChildRoutes(t,e,r){const n=vo(e);t.children.forEach(t=>{const e=t.value.outlet;this.deactivateRoutes(t,n[e],r),delete n[e]}),Ni(n,(t,e)=>{this.deactivateRouteAndItsChildren(t,r)})}deactivateRoutes(t,e,r){const n=t.value,i=e?e.value:null;if(n===i)if(n.component){const i=r.getContext(n.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const r=e.getContext(t.value.outlet);if(r&&r.outlet){const e=r.outlet.detach(),n=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:e,route:t,contexts:n})}}deactivateRouteAndOutlet(t,e){const r=e.getContext(t.value.outlet);if(r){const n=vo(t),i=t.value.component?r.children:e;Ni(n,(t,e)=>this.deactivateRouteAndItsChildren(t,i)),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}activateChildRoutes(t,e,r){const n=vo(e);t.children.forEach(t=>{this.activateRoutes(t,n[t.value.outlet],r),this.forwardEvent(new gi(t.value.snapshot))}),t.children.length&&this.forwardEvent(new mi(t.value.snapshot))}activateRoutes(t,e,r){const n=t.value,i=e?e.value:null;if(Mo(n),n===i)if(n.component){const i=r.getOrCreateContext(n.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,r);else if(n.component){const e=r.getOrCreateContext(n.outlet);if(this.routeReuseStrategy.shouldAttach(n.snapshot)){const t=this.routeReuseStrategy.retrieve(n.snapshot);this.routeReuseStrategy.store(n.snapshot,null),e.children.onOutletReAttached(t.contexts),e.attachRef=t.componentRef,e.route=t.route.value,e.outlet&&e.outlet.attach(t.componentRef,t.route.value),ss(t.route)}else{const r=function(t){for(let e=n.snapshot.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(),i=r?r.module.componentFactoryResolver:null;e.route=n,e.resolver=i,e.outlet&&e.outlet.activateWith(n,i),this.activateChildRoutes(t,null,e.children)}}else this.activateChildRoutes(t,null,r)}}function ss(t){Mo(t.value),t.children.forEach(ss)}class as{constructor(t,e,r,n,i){this.router=t,this.route=e,this.commands=[],null==r&&n.setAttribute(i.nativeElement,"tabindex","0")}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}set preserveQueryParams(t){Object(i.T)()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated!, use queryParamsHandling instead."),this.preserve=t}onClick(){const t={skipLocationChange:ls(this.skipLocationChange),replaceUrl:ls(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,t),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:ls(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:ls(this.preserveFragment)})}}function ls(t){return""===t||!!t}class cs{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new us,this.attachRef=null}}class us{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const r=this.getOrCreateContext(t);r.outlet=e,this.contexts.set(t,r)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new cs,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}class hs{constructor(t,e,r,n,o){this.parentContexts=t,this.location=e,this.resolver=r,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new i.m,this.deactivateEvents=new i.m,this.name=n||yi,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const r=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),n=this.parentContexts.getOrCreateContext(this.name).children,i=new ds(t,n,this.location.injector);this.activated=this.location.createComponent(r,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}class ds{constructor(t,e,r){this.route=t,this.childContexts=e,this.parent=r}get(t,e){return t===xo?this.route:t===us?this.childContexts:this.parent.get(t,e)}}class ps{}class fs{preload(t,e){return de.call(e(),()=>O(null))}}class ms{preload(t,e){return O(null)}}class vs{constructor(t,e,r,n,i){this.router=t,this.injector=n,this.preloadingStrategy=i,this.loader=new $o(e,r,e=>t.triggerEvent(new di(e)),e=>t.triggerEvent(new pi(e)))}setUpPreloading(){const t=U.call(this.router.events,t=>t instanceof ii);this.subscription=I.call(t,()=>this.preload()).subscribe(()=>{})}preload(){const t=this.injector.get(i.v);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription.unsubscribe()}processRoutes(t,e){const r=[];for(const n of e)if(n.loadChildren&&!n.canLoad&&n._loadedConfig){const t=n._loadedConfig;r.push(this.processRoutes(t.module,t.routes))}else n.loadChildren&&!n.canLoad?r.push(this.preloadConfig(t,n)):n.children&&r.push(this.processRoutes(t,n.children));return ir.call(je(r))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>{const r=this.loader.load(t.injector,e);return ve.call(r,t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))})}}const gs=new i.o("ROUTER_CONFIGURATION"),ys=new i.o("ROUTER_FORROOT_GUARD"),xs=[q,{provide:ji,useClass:zi},{provide:is,useFactory:Ms,deps:[i.g,ji,us,q,i.p,i.u,i.i,Ko,gs,[ts,new i.y],[Jo,new i.y]]},us,{provide:xo,useFactory:As,deps:[is]},{provide:i.u,useClass:i.H},vs,ms,fs,{provide:gs,useValue:{enableTracing:!1}}];function bs(){return new i.w("Router",is)}class ws{constructor(t,e){}static forRoot(t,e){return{ngModule:ws,providers:[xs,Ts(t),{provide:ys,useFactory:Ss,deps:[[is,new i.y,new i.G]]},{provide:gs,useValue:e||{}},{provide:W,useFactory:_s,deps:[G,[new i.n(X),new i.y],gs]},{provide:ps,useExisting:e&&e.preloadingStrategy?e.preloadingStrategy:ms},{provide:i.w,multi:!0,useFactory:bs},[Es,{provide:i.d,multi:!0,useFactory:Cs,deps:[Es]},{provide:Os,useFactory:Ps,deps:[Es]},{provide:i.b,multi:!0,useExisting:Os}]]}}static forChild(t){return{ngModule:ws,providers:[Ts(t)]}}}function _s(t,e,r={}){return r.useHash?new Z(t,e):new J(t,e)}function Ss(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Ts(t){return[{provide:i.a,multi:!0,useValue:t},{provide:Ko,multi:!0,useValue:t}]}function Ms(t,e,r,n,i,o,s,a,l={},c,u){const h=new is(null,e,r,n,i,o,s,Pi(a));if(c&&(h.urlHandlingStrategy=c),u&&(h.routeReuseStrategy=u),l.errorHandler&&(h.errorHandler=l.errorHandler),l.enableTracing){const t=xr();h.events.subscribe(e=>{t.logGroup(`Router Event: ${e.constructor.name}`),t.log(e.toString()),t.log(e),t.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),h}function As(t){return t.routerState.root}class Es{constructor(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new pe.b}appInitializer(){return this.injector.get(H,Promise.resolve(null)).then(()=>{let t=null;const e=new Promise(e=>t=e),r=this.injector.get(is),n=this.injector.get(gs);if(this.isLegacyDisabled(n)||this.isLegacyEnabled(n))t(!0);else if("disabled"===n.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==n.initialNavigation)throw new Error(`Invalid initialNavigation options: '${n.initialNavigation}'`);r.hooks.afterPreactivation=(()=>this.initNavigation?O(null):(this.initNavigation=!0,t(!0),this.resultOfPreactivationDone)),r.initialNavigation()}return e})}bootstrapListener(t){const e=this.injector.get(gs),r=this.injector.get(vs),n=this.injector.get(is),o=this.injector.get(i.g);t===o.components[0]&&(this.isLegacyEnabled(e)?n.initialNavigation():this.isLegacyDisabled(e)&&n.setUpLocationChangeListener(),r.setUpPreloading(),n.resetRootComponentType(o.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation}isLegacyDisabled(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation}}function Cs(t){return t.appInitializer.bind(t)}function Ps(t){return t.bootstrapListener.bind(t)}const Os=new i.o("Router Initializer");new i.L("5.2.9");class Ns{constructor(t,e){this.http=t,this.router=e,this.apiUrl=C.BACKEND_URL,this.apiHeaders=new Ot({"Content-type":"application/json"})}apiGet(t,e=null){return this.apiCall(Ls.Get,t,e)}apiPost(t,e){return this.apiCall(Ls.Post,t,e)}apiCall(t,e,r=null){let n=this.apiUrl;switch(e&&e.length>0&&(n+="/"+e),t){case Ls.Get:case Ls.Post:return this.http.request(t,n,{body:r&&JSON.stringify(r),headers:this.apiHeaders||new Ot,responseType:"json",withCredentials:!0,reportProgress:!0,observe:"body"}).catch(t=>{switch(t.status){case Is.Unauthorized:this.router.navigate(["login"]);break;default:console.log(`No specific handler for error with status = ${t.status}`)}return console.log(t),E.a.throw(t.error)});default:return E.a.throw("Method "+Ls[t]+"is not supported! See api-http service")}}}var Ls,Is;!function(t){t.Get="get",t.Head="head",t.Post="post",t.Put="put",t.Patch="patch",t.Delete="delete",t.Connect="connect",t.Options="options",t.Trace="trace"}(Ls||(Ls={})),function(t){t[t.BadRequest=400]="BadRequest",t[t.Unauthorized=401]="Unauthorized"}(Is||(Is={}));class Rs{constructor(t){this.apiHttpService=t}login(t){return this.apiHttpService.apiPost("auth/login/",t)}register(t){return this.apiHttpService.apiPost("auth/register/",t)}}class Ds{constructor(t,e){this.authDelegate=t,this.router=e,this.currentUser=this.setUserFromLocalStorage()}setUserFromLocalStorage(){try{return JSON.parse(localStorage.getItem("currentUser"))}catch(t){console.warn("LocalStorage unavailable")}}login(t,e){return this.authDelegate.login({login:t,password:e}).map(t=>{try{localStorage.setItem("currentUser",JSON.stringify(t))}catch(t){console.warn("LocalStorage unavailable")}return this.currentUser=t})}logout(){this.currentUser=null;try{localStorage.removeItem("currentUser"),this.router.navigate(["login"])}catch(t){console.warn("LocalStorage unavailable")}}createUser(t,e){return this.authDelegate.register({login:t,password:e}).map(t=>this.currentUser=t)}}var Fs=r("DmT9"),ks=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};class Us{static sleep(t){return ks(this,void 0,void 0,function*(){return new Promise(e=>{setTimeout(()=>{e()},t)})})}static wait(t,e=!0){return ks(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>{e?r():n("Rejected by timeout")},t)})})}static doWithFailTimeout(t,e){return ks(this,void 0,void 0,function*(){return Promise.race([t,Us.wait(e,!1)])})}}var Bs=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};class js{constructor(){this.host=C.BACKEND_URL,this.stepSubject=new pe.b,this.finishSubject=new pe.b}connectToLobby(t){return Bs(this,void 0,void 0,function*(){if(t.startsWith("::")){const e=+t.substr(2);let r=C.BACKEND_URL;r.match(/:\d+\/?$/)&&(r=r.substr(0,r.lastIndexOf(":"))),t=`${r}:${e}`}try{return yield Us.doWithFailTimeout(new Promise((e,r)=>{const n=(...t)=>{console.log("$%%%%% conn "+this.socket.id)},i=(...t)=>{s(),r("disconnected")},o=(...t)=>{console.log("$%%%%% lobbydata "+JSON.stringify(t)),s(),e()},s=()=>{this.socket.off("connect",n),this.socket.off("disconnect",i),this.socket.off("addedToLobby",o)};console.log(`Connecting to lobby ${t}...`),this.socket=this.initSocket(t),(()=>{this.socket.on("connect",n),this.socket.on("disconnect",i),this.socket.on("addedToLobby",o)})(),this.socket.connect()}),1e4)}catch(t){if(this.socket)return this.socket.disconnect(),Promise.reject(t)}})}socketAvailable(){return!!this.socket}disconnect(){this.socket.disconnect(),this.socket=null}readyToStart(t){console.log("emitting readyToStart",JSON.stringify(t)),this.carId=t.id,this.socket.emit("readyToStart",t)}nextStep(t){console.log("emitting nextStep",JSON.stringify(t)),this.socket.emit("nextStep",t)}finished(t){console.log("emitting finished",{id:this.carId,stepsCount:t}),this.socket.emit("finished",{id:this.carId,stepsCount:t})}onStepComplete(t){console.log("stepComplete",JSON.stringify(t)),this.stepSubject.next(t)}onRaceFinished(t){console.log("raceComplete. winner?",t===this.carId),this.finishSubject.next(t===this.carId),this.disconnect()}initSocket(t){const e=Fs(t);return e.on("connect",()=>{console.log("socket connected")}),e.on("disconnect",()=>{console.log("socket disconnected")}),e.on("error",t=>{console.log("ERROR: ",t)}),e.on("stepComplete",t=>this.onStepComplete(t)),e.on("raceFinished",t=>this.onRaceFinished(t)),e}}class zs{constructor(t){this.apiHttpService=t}createLobby(t){return this.apiHttpService.apiPost("lobby/createLobby",{playersCount:t})}getLobbies(){return this.apiHttpService.apiGet("lobby/getLobbies")}quickStart(){return this.apiHttpService.apiPost("lobby/quickStart")}}class Vs{constructor(t){this.lobbyDelegate=t}createPracticeLobby(t=1){return this.lobbyDelegate.createLobby(t)}createLobby(t=2){return this.lobbyDelegate.createLobby(t)}getLobbies(){return this.lobbyDelegate.getLobbies()}quickStart(){return this.lobbyDelegate.quickStart()}}var Gs=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};class Hs{constructor(t,e,r,n){this.loginService=t,this.lobbyService=e,this.socketService=r,this.router=n}onPracticeClick(){this.lobbyService.createPracticeLobby().subscribe(t=>Gs(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onCreateLobby(t){+t<2?console.log("not creating lobby for 1 or less player"):this.lobbyService.createPracticeLobby(+t).subscribe(t=>Gs(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onPlayClick(){this.lobbyService.quickStart().subscribe(t=>Gs(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}onSettingsClick(){}onExitClick(){this.loginService.logout()}}var Ws=i._1({encapsulation:0,styles:[[".main-container[_ngcontent-%COMP%]{width:100vw;height:100vh;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.button-login[_ngcontent-%COMP%]{max-width:300px;width:60%;margin-bottom:20px;text-align:center}.main-container[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;width:100%}.main-container[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   #numberOfPlayers[_ngcontent-%COMP%]{width:-webkit-min-content;width:-moz-min-content;width:min-content;text-align:center}"]],data:{}});function Xs(t){return i._21(0,[(t()(),i._3(0,0,null,null,36,"div",[["class","main-container"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(2,0,null,null,9,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(4,0,null,null,1,"label",[["for","numberOfPlayers"]],null,null,null,null,null)),(t()(),i._20(-1,null,["Enter number of players"])),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(7,0,[["numberOfPlayers",1]],null,0,"input",[["id","numberOfPlayers"],["max","4"],["min","2"],["name","numberOfPlayers"],["step","1"],["type","number"],["value","2"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(9,0,null,null,1,"button",[["class","button-login"]],[[8,"disabled",0]],[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onCreateLobby(i._14(t,7).value)&&n),n},null,null)),(t()(),i._20(-1,null,["Create Lobby"])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(13,0,null,null,4,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(15,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onPlayClick()&&n),n},null,null)),(t()(),i._20(-1,null,["Quick Start"])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(19,0,null,null,4,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(21,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onPracticeClick()&&n),n},null,null)),(t()(),i._20(-1,null,["Practice"])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(25,0,null,null,4,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(27,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onSettingsClick()&&n),n},null,null)),(t()(),i._20(-1,null,["Settings"])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(31,0,null,null,4,"div",[["class","btn-group"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(33,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onExitClick()&&n),n},null,null)),(t()(),i._20(-1,null,["Exit"])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n"])),(t()(),i._20(-1,null,["\n\n"]))],null,function(t,e){t(e,9,0,i._14(e,7).value<2)})}var qs=i.Z("page-menu",Hs,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"page-menu",[],null,null,null,Xs,Ws)),i._2(1,49152,null,0,Hs,[Ds,Vs,js,is],null,null)],null,null)},{},{},[]);class Ys{constructor(t){this.apiHttpService=t}getAllCars(){return this.apiHttpService.apiGet("car/")}}class Zs{constructor(t){this.carDelegate=t}loadCars(){return this.carDelegate.getAllCars()}}class Js{constructor(t,e){this.carService=t,this.router=e,this.selectedCar=0,this.carsList=[]}ngOnInit(){this.getCars()}getCars(){this.carService.loadCars().subscribe(t=>{this.carService.cars=t,this.carsList=this.carService.cars},t=>{console.error(t)})}setSelectedCar(t){this.carService.selectedCar=t,this.router.navigate(["/game"])}}var Qs=i._1({encapsulation:0,styles:[["#canvasContainer[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.car-container[_ngcontent-%COMP%]   .car-image[_ngcontent-%COMP%]{margin-left:1em;height:8em;width:auto}.selected-car[_ngcontent-%COMP%]{opacity:.7}span[_ngcontent-%COMP%]{font-size:.8em}.car-info-container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}"]],data:{}});function Ks(t){return i._21(0,[(t()(),i._3(0,0,null,null,6,"div",[["class","image-container"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(2,0,null,null,3,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.setSelectedCar(t.context.$implicit)&&n),n},null,null)),(t()(),i._20(-1,null,["\n      "])),(t()(),i._3(4,0,null,null,0,"img",[["height","99"],["width","150"]],[[8,"src",4]],null,null,null,null)),(t()(),i._20(5,null,["\n      ","\n    "])),(t()(),i._20(-1,null,["\n  "]))],null,function(t,e){t(e,4,0,i._6(1,"",e.context.$implicit.image,"")),t(e,5,0,e.context.$implicit.name)})}function $s(t){return i._21(0,[(t()(),i._3(0,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),i._20(-1,null,["\n  "])),(t()(),i.Y(16777216,null,null,1,null,Ks)),i._2(3,802816,null,0,ot,[i.M,i.J,i.q],{ngForOf:[0,"ngForOf"]},null),(t()(),i._20(-1,null,["\n"])),(t()(),i._20(-1,null,["\n"]))],function(t,e){t(e,3,0,e.component.carsList)},null)}var ta=i.Z("page-car-selection",Js,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"page-car-selection",[],null,null,null,$s,Qs)),i._2(1,114688,null,0,Js,[Zs,is],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),ea=r("Ml+6"),ra=r("qKrd"),na=r("Z7et"),ia=r("50uv");class oa{static isInRange(t,e,r,n=!0){return t>e&&t<r||n&&[e,r].indexOf(t)>-1}static toRange(t,e,r){return Math.min(Math.max(t,e),r)}static toNearestPowerOfTwo(t){return Math.pow(2,Math.round(Math.log2(t)))}}var sa=r("Wj7o"),aa=PIXI.Point;class la{static getAngleBetweenPoints(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static getDistanceBetweenPoints(t,e){return Math.hypot(e.y-t.y,e.x-t.x)}static getMiddlePoint(t,e){return new aa((t.x+e.x)/2,(t.y+e.y)/2)}static isPointInsidePolygon(t,e){return sa([t.x,t.y],e)}}class ca{constructor(t,e){this.r=t,this.theta=e}get cartesianPoint(){return new aa(this.r*Math.cos(this.theta),this.r*Math.sin(this.theta))}static fromCartesian(t,e){const r=t.clone();return e&&(r.x-=e.x,r.y-=e.y),new ca(Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),Math.atan2(r.y,r.x))}}var ua=PIXI.Point;class ha{constructor(t,e){this.l=t,this.c=e}get arcRadius(){return 1/Math.abs(this.c)}get arcCenter(){return new ua(0,this.c>0?this.arcRadius:-this.arcRadius)}get pointerRotation(){return this.l*this.c}get position(){return this.polarPosition.cartesianPoint}get polarPosition(){return new ca(0===this.c?this.l:2/this.c*Math.sin(this.l*this.c/2),this.l*this.c/2)}breakToSegments(t=Math.ceil(2*Math.abs(this.l))){if(0===this.l)return[new ua];const e=[],r=this.l/t;for(let n=1;n<=t;n++)e.push(new ha(n*r,this.c).position);return e}clone(){return new ha(this.l,this.c)}static fromPolarPosition(t){return(t.theta>Math.PI/2||t.theta<-Math.PI/2)&&(t.theta-=Math.PI*Math.sign(t.theta),t.r=-t.r),new ha(t.theta*t.r/Math.sin(t.theta),2*Math.sin(t.theta)/t.r)}static fromCartesianPosition(t){return ha.fromPolarPosition(ca.fromCartesian(t))}}var da=PIXI.Graphics;class pa extends da{constructor(t=1,e=.2){super(),this.strokeColor=4357620,this.areaFillColor=4301812,this.areaFillColorAlpha=.3,this._pixelsInUnit=t,this.areaWidth=pa.BASE_TEXTURE_WIDTH,this.areaHeight=pa.BASE_TEXTURE_HEIGHT,this.relativeCarOffset=e,this.carOffset=pa.BASE_TEXTURE_WIDTH*e,this.outerStrokeWeight=Math.round(pa.BASE_OUTER_STROKE_WEIGHT),this.innerStrokeWeight=Math.round(pa.BASE_INNER_STROKE_WEIGHT)}get pixelsInUnit(){return this._pixelsInUnit}set pixelsInUnit(t){this._pixelsInUnit!==t&&(this._pixelsInUnit=t,this.visible&&this.redraw())}redraw(){}}pa.BASE_TEXTURE_WIDTH=1024,pa.BASE_TEXTURE_HEIGHT=512,pa.BASE_OUTER_STROKE_WEIGHT=3,pa.BASE_INNER_STROKE_WEIGHT=1;var fa=PIXI.Point;class ma extends pa{redraw(){super.redraw(),this.drawInner()}draw(t,e,r,n){this.currentData={minDistance:t,maxDistance:e,momentumDistance:r,maxCurvature:n},this.drawInner()}drawInner(){if(!this.currentData)return;let t=this.currentData.minDistance,e=this.currentData.maxDistance,r=this.currentData.momentumDistance,n=this.currentData.maxCurvature;e*=this.pixelsInUnit,r*=this.pixelsInUnit;const i=new ha(t*=this.pixelsInUnit,n/=this.pixelsInUnit).position,o=new ha(t,-n).position,s=new ha(e,n).position,a=new ha(e,-n).position;this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor,1),this.beginFill(this.areaFillColor,this.areaFillColorAlpha),this.moveTo(i.x+this.carOffset,i.y+this.areaHeight/2),i.equals(o)||this.drawCardioid(t,n,-n),this.arc(this.carOffset,-1/n+this.areaHeight/2,1/n,ca.fromCartesian(o,new fa(0,-1/n)).theta,ca.fromCartesian(a,new fa(0,-1/n)).theta,!0),this.drawCardioid(e,-n,n),this.arc(this.carOffset,1/n+this.areaHeight/2,1/n,ca.fromCartesian(s,new fa(0,1/n)).theta,ca.fromCartesian(i,new fa(0,1/n)).theta,!0),this.endFill(),this.lineStyle(this.innerStrokeWeight,this.strokeColor,1),this.drawCardioid(r,-n,n,!0)}drawCardioid(t,e,r,n=!1,i=new fa(this.carOffset,this.areaHeight/2)){this.getCardiodPathPoints(t,e,r,16).forEach((t,e)=>{0!==e?this.lineTo(t.x+i.x,t.y+i.y):n&&this.moveTo(t.x+i.x,t.y+i.y)})}getCardiodPathPoints(t,e,r,n=32){const i=[],o=(r-e)/n;for(let s=0;s<=n;s++)i.push(e+s*o);return i.map(e=>new ha(t,e).position)}}var va=PIXI.Point;class ga extends pa{draw(t){this.currentTrajectory=t,this.drawInner()}redraw(){super.redraw(),this.drawInner()}drawInner(){if(!this.currentTrajectory)return;const t=this.currentTrajectory.clone();t.l*=this.pixelsInUnit,t.c/=this.pixelsInUnit;const e=new va(this.carOffset,this.areaHeight/2),r=new va(t.position.x+this.carOffset,this.areaHeight/2-t.position.y);if(this.clear(),this.lineStyle(this.outerStrokeWeight,this.strokeColor),Math.abs(t.c)<1e-5)this.moveTo(e.x,e.y),this.lineTo(r.x,r.y);else{const n=new va(this.carOffset,this.areaHeight/2-t.arcCenter.y);this.arc(n.x,n.y,t.arcRadius,ca.fromCartesian(e,n).theta,ca.fromCartesian(r,n).theta,t.l>0?t.c>0:t.c<0)}}}class ya{static getDistanceInUniformlyAcceleratedMotion(t,e,r){return r*(t+e*r/2)}static getAccelerationInUniformlyAcceleratedMotion(t,e,r){return 2/Math.pow(r,2)*(e-t*r)}static getSpeedInUniformlyAcceleratedMotion(t,e,r){return t+e*r}static getSpeedInUniformlyAcceleratedMotionByDistance(t,e,r){return ya.getSpeedInUniformlyAcceleratedMotion(t,ya.getAccelerationInUniformlyAcceleratedMotion(t,e,r),r)}static getAccelerationToAchieveSpeed(t,e,r){return(e-t)/r}}var xa=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},ba=ia.Point;class wa{constructor(t){this.socketService=t,this.mousePosition=new ba,this.currentStepMinDistance=0,this.currentStepMaxDistance=0,this.currentStepMomentumDistance=0,this.currentStepMaxCurvature=0,this.cameraDistance=64,this.cameraDistanceSubject=new pe.b,this.trajectorySelected=new pe.b,this.isInSelectionState=!1,this.nextStepArea=new ma(1024/this.controlPlaneLength),this.nextStepArc=new ga(1024/this.controlPlaneLength),this.controlPlaneTextureRenderer=ia.autoDetectRenderer(this.nextStepArea.areaWidth,this.nextStepArea.areaHeight,{antialias:!0,resolution:1,transparent:!0}),this.controlPlaneTextureStage=new ia.Container,this.controlPlaneTextureStage.addChild(this.nextStepArea),this.controlPlaneTextureStage.addChild(this.nextStepArc),this.controlPlaneTexture=new ea.Texture(this.controlPlaneTextureRenderer.view),this.controlPlane=new ea.Mesh(new ea.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),new ea.MeshBasicMaterial({map:this.controlPlaneTexture,side:ea.DoubleSide,transparent:!0,depthWrite:!1})),this.controlPlane.geometry.applyMatrix((new ea.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.controlSphere=new ea.Mesh(new ea.SphereGeometry(.5),new ea.MeshBasicMaterial({color:this.nextStepArc.strokeColor,side:ea.DoubleSide,transparent:!0,opacity:1})),this.controlSphere.visible=!1}get controlPlaneWidth(){return.6*this.cameraDistance}get controlPlaneLength(){return 1.2*this.cameraDistance}initControls(t,e){this.canvas=t.controlCanvas,this.stage3d=t,this.car=e,t.addControlElement(this.controlPlane),t.addControlElement(this.controlSphere),this.canvas.addEventListener("mousemove",t=>{this.onCanvasMouseMove(t)}),this.canvas.addEventListener("click",t=>{this.onCanvasMouseClick(t)}),this.updateTrajectorySelector(),this.updateCameraDistance()}adjustControlPositions(){this.car&&this.car.mesh&&this.controlPlane&&(this.controlPlane.position.set(this.car.mesh.position.x,this.car.mesh.position.y,this.car.mesh.position.z),this.controlPlane.rotation.set(this.car.mesh.rotation.x,this.car.mesh.rotation.y,this.car.mesh.rotation.z))}askForSelectedPosition(t,e,r,n){return new Promise(i=>xa(this,void 0,void 0,function*(){this.currentStepMinDistance=t,this.currentStepMaxDistance=e,this.currentStepMomentumDistance=r,this.currentStepMaxCurvature=n,this.isInSelectionState=!0,yield this.stage3d.renderControlsOnceSync(),this.showStepArea(),this.updateTrajectorySelector();const o=this.trajectorySelected.asObservable().subscribe(t=>{clearTimeout(s),o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.hideStepAreaAndCurve(),i(t)}),s=setTimeout(()=>{this.socketService.socketAvailable()?(o.unsubscribe(),this.isInSelectionState=!1,this.controlSphere.visible=!1,this.hideStepAreaAndCurve(),i(new ha(Math.max(t,0),0))):clearInterval(s)},C.MOVE_TIMEOUT)}))}updateCameraDistance(){let t=Math.max(ya.getDistanceInUniformlyAcceleratedMotion(0,this.car.characteristics.getMaxAcceleration(0),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/720),ya.getDistanceInUniformlyAcceleratedMotion(Math.max(this.car.speed,0),this.car.characteristics.getMaxAcceleration(Math.max(this.car.speed,0)),1)/Math.tan(this.stage3d.fieldOfView*Math.PI/360));t!==this.cameraDistance&&(this.cameraDistance=t,this.controlPlane.geometry=new ea.PlaneGeometry(this.controlPlaneLength,this.controlPlaneWidth,1,1),this.controlPlane.geometry.applyMatrix((new ea.Matrix4).makeTranslation(this.controlPlaneLength*(.5-this.nextStepArc.relativeCarOffset),0,0)),this.nextStepArea.pixelsInUnit=1024/this.controlPlaneLength,this.nextStepArc.pixelsInUnit=1024/this.controlPlaneLength,(this.nextStepArc.visible||this.nextStepArea.visible)&&this.updateControlPlaneTexture(),this.cameraDistanceSubject.next(this.cameraDistance))}onCanvasMouseMove(t){const e=this.canvas.getBoundingClientRect();this.mousePosition=new ba(t.x-e.left,t.y-e.top),this.isInSelectionState&&this.updateTrajectorySelector()}onCanvasMouseClick(t){const e=this.canvas.getBoundingClientRect();if(this.mousePosition=new ba(t.x-e.left,t.y-e.top),this.isInSelectionState){const t=this.updateTrajectorySelector();t&&this.trajectorySelected.next(t)}}updateTrajectorySelector(){const t=this.canvas.getBoundingClientRect(),e=new ea.Raycaster;e.setFromCamera({x:this.mousePosition.x/t.width*2-1,y:-this.mousePosition.y/t.height*2+1},this.stage3d.camera);const r=e.intersectObjects([this.controlPlane]);if(0===r.length)return this.controlSphere.visible=!1,void this.hideStepCurve();const n=this.getTrajectoryFromControlPlaneIntersection(r[0]);return oa.isInRange(n.l,this.currentStepMinDistance,this.currentStepMaxDistance)&&oa.isInRange(n.c,-this.currentStepMaxCurvature,this.currentStepMaxCurvature)?(this.controlSphere.visible=!0,this.controlSphere.position.set(r[0].point.x,r[0].point.y,r[0].point.z),this.showStepCurve(n),n):(this.controlSphere.visible=!1,this.hideStepCurve(),null)}getTrajectoryFromControlPlaneIntersection(t){return ha.fromCartesianPosition(this.uvToLocalWorld(t.uv))}showStepArea(){this.nextStepArea.visible=!0,this.nextStepArea.draw(this.currentStepMinDistance,this.currentStepMaxDistance,this.currentStepMomentumDistance,this.currentStepMaxCurvature),this.updateControlPlaneTexture()}showStepCurve(t){this.nextStepArc.draw(t),this.nextStepArc.visible=!0,this.updateControlPlaneTexture()}hideStepAreaAndCurve(){(this.nextStepArea.visible||this.nextStepArc.visible)&&(this.nextStepArea.visible&&(this.nextStepArea.visible=!1),this.nextStepArc.visible&&(this.nextStepArc.visible=!1),this.updateControlPlaneTexture())}hideStepCurve(){this.nextStepArc.visible&&(this.nextStepArc.visible=!1,this.updateControlPlaneTexture())}updateControlPlaneTexture(){this.controlPlaneTextureRenderer.render(this.controlPlaneTextureStage),this.controlPlaneTexture.needsUpdate=!0,this.stage3d.renderControlsOnce()}uvToLocalWorld(t){return new ba((t.x-this.nextStepArc.relativeCarOffset)*this.controlPlaneLength,(t.y-.5)*this.controlPlaneWidth)}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){var e=arguments;if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var i=e[n];if(void 0!==i&&null!==i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r});var _a={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*_a.DEG2RAD},radToDeg:function(t){return t*_a.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Sa(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Ta(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function Ma(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}function Aa(){}function Ea(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||Ea.DefaultOrder}function Ca(){this.mask=1}function Pa(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Sa.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,s,a,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=s,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Sa).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new Ta;return function(e){var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),s=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*s,r[9]=n[9]*s,r[10]=n[10]*s,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),s=Math.sin(r),a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,d=o*u,p=s*c,f=s*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-s*a,e[2]=f-h*l,e[6]=p+d*l,e[10]=o*a}else if("YXZ"===t.order){var m=a*u,v=l*c;e[0]=(g=a*c)+(y=l*u)*s,e[4]=v*s-m,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-s,e[2]=m*s-v,e[6]=y+g*s,e[10]=o*a}else if("ZXY"===t.order){var g,y;m=a*u,v=l*c,e[0]=(g=a*c)-(y=l*u)*s,e[4]=-o*u,e[8]=v+m*s,e[1]=m+v*s,e[5]=o*c,e[9]=y-g*s,e[2]=-o*l,e[6]=s,e[10]=o*a}else if("ZYX"===t.order)h=o*c,d=o*u,p=s*c,f=s*u,e[0]=a*c,e[4]=p*l-d,e[8]=h*l+f,e[1]=a*u,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=s*a,e[10]=o*a;else if("YZX"===t.order){var x=o*a,b=o*l,w=s*a,_=s*l;e[0]=a*c,e[4]=_-x*u,e[8]=w*u+b,e[1]=u,e[5]=o*c,e[9]=-s*c,e[2]=-l*c,e[6]=b*u+w,e[10]=x-_*u}else"XZY"===t.order&&(x=o*a,b=o*l,w=s*a,_=s*l,e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=x*u+_,e[5]=o*c,e[9]=b*u-w,e[2]=w*u-b,e[6]=s*c,e[10]=_*u+x);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t._x,n=t._y,i=t._z,o=t._w,s=r+r,a=n+n,l=i+i,c=r*s,u=r*a,h=r*l,d=n*a,p=n*l,f=i*l,m=o*s,v=o*a,g=o*l;return e[0]=1-(d+f),e[4]=u-g,e[8]=h+v,e[1]=u+g,e[5]=1-(c+f),e[9]=p-m,e[2]=h-v,e[6]=p+m,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new Ta,e=new Ta,r=new Ta;return function(n,i,o){var s=this.elements;return r.subVectors(n,i),0===r.lengthSq()&&(r.z=1),r.normalize(),t.crossVectors(o,r),0===t.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),t.crossVectors(o,r)),t.normalize(),e.crossVectors(r,t),s[0]=t.x,s[4]=e.x,s[8]=r.x,s[1]=t.y,s[5]=e.y,s[9]=r.y,s[2]=t.z,s[6]=e.z,s[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],s=r[4],a=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=n[0],_=n[4],S=n[8],T=n[12],M=n[1],A=n[5],E=n[9],C=n[13],P=n[2],O=n[6],N=n[10],L=n[14],I=n[3],R=n[7],D=n[11],F=n[15];return i[0]=o*w+s*M+a*P+l*I,i[4]=o*_+s*A+a*O+l*R,i[8]=o*S+s*E+a*N+l*D,i[12]=o*T+s*C+a*L+l*F,i[1]=c*w+u*M+h*P+d*I,i[5]=c*_+u*A+h*O+d*R,i[9]=c*S+u*E+h*N+d*D,i[13]=c*T+u*C+h*L+d*F,i[2]=p*w+f*M+m*P+v*I,i[6]=p*_+f*A+m*O+v*R,i[10]=p*S+f*E+m*N+v*D,i[14]=p*T+f*C+m*L+v*F,i[3]=g*w+y*M+x*P+b*I,i[7]=g*_+y*A+x*O+b*R,i[11]=g*S+y*E+x*N+b*D,i[15]=g*T+y*C+x*L+b*F,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Ta;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],s=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-n*l*u-i*s*h+r*l*h+n*s*d-r*a*d)+t[7]*(+e*a*d-e*l*h+i*o*h-n*o*d+n*l*c-i*a*c)+t[11]*(+e*l*u-e*s*d-i*o*u+r*o*d+i*s*c-r*l*c)+t[15]*(-n*s*c-e*a*u+e*s*h+n*o*u-r*o*h+r*a*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],b=p*y*h-g*f*h+g*u*m-c*y*m-p*u*x+c*f*x,w=v*f*h-d*y*h-v*u*m+l*y*m+d*u*x-l*f*x,_=d*g*h-v*p*h+v*c*m-l*g*m-d*c*x+l*p*x,S=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,T=i*b+o*w+s*_+a*S;if(0===T){var M="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(M);return console.warn(M),this.identity()}var A=1/T;return r[0]=b*A,r[1]=(g*f*a-p*y*a-g*s*m+o*y*m+p*s*x-o*f*x)*A,r[2]=(c*y*a-g*u*a+g*s*h-o*y*h-c*s*x+o*u*x)*A,r[3]=(p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m)*A,r[4]=w*A,r[5]=(d*y*a-v*f*a+v*s*m-i*y*m-d*s*x+i*f*x)*A,r[6]=(v*u*a-l*y*a-v*s*h+i*y*h+l*s*x-i*u*x)*A,r[7]=(l*f*a-d*u*a+d*s*h-i*f*h-l*s*m+i*u*m)*A,r[8]=_*A,r[9]=(v*p*a-d*g*a-v*o*m+i*g*m+d*o*x-i*p*x)*A,r[10]=(l*g*a-v*c*a+v*o*h-i*g*h-l*o*x+i*c*x)*A,r[11]=(d*c*a-l*p*a-d*o*h+i*p*h+l*o*m-i*c*m)*A,r[12]=S*A,r[13]=(d*g*s-v*p*s+v*o*f-i*g*f-d*o*y+i*p*y)*A,r[14]=(v*c*s-l*g*s-v*o*u+i*g*u+l*o*y-i*c*y)*A,r[15]=(l*p*s-d*c*s+d*o*u-i*p*u-l*o*f+i*c*f)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,s=t.y,a=t.z,l=i*o,c=i*s;return this.set(l*o+r,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+r,c*a-n*o,0,l*a-n*s,c*a+n*o,i*a*a+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t=new Ta,e=new Sa;return function(r,n,i){var o=this.elements,s=t.set(o[0],o[1],o[2]).length(),a=t.set(o[4],o[5],o[6]).length(),l=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),r.x=o[12],r.y=o[13],r.z=o[14],e.copy(this);var c=1/s,u=1/a,h=1/l;return e.elements[0]*=c,e.elements[1]*=c,e.elements[2]*=c,e.elements[4]*=u,e.elements[5]*=u,e.elements[6]*=u,e.elements[8]*=h,e.elements[9]*=h,e.elements[10]*=h,n.setFromRotationMatrix(e),i.x=s,i.y=a,i.z=l,this}}(),makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),u=-(o+i)/(o-i),h=-2*o*i/(o-i);return s[0]=2*i/(e-t),s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=a,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var s=this.elements,a=1/(e-t),l=1/(r-n),c=1/(o-i),u=(e+t)*a,h=(r+n)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}),Object.assign(Ta.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new Ma;return function(e){return e&&e.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new Ma;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,s=t.z,a=t.w,l=a*e+o*n-s*r,c=a*r+s*e-i*n,u=a*n+i*r-o*e,h=-i*e-o*r-s*n;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this},project:function(){var t=new Sa;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new Sa;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new Ta,e=new Ta;return function(r,n){return t.set(r,r,r),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,s=e.y,a=e.z;return this.x=n*a-i*s,this.y=i*o-r*a,this.z=r*s-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new Ta;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new Ta;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(_a.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Ma,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,s){var a=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||l!==d||c!==p){var m=1-s,v=a*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,s=Math.sin(s*b)/x}var w=s*g;if(a=a*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=_,l*=_,c*=_,u*=_}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}}),Object.defineProperties(Ma.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(Ma.prototype,{set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,s=Math.cos,a=Math.sin,l=s(r/2),c=s(n/2),u=s(i/2),h=a(r/2),d=a(n/2),p=a(i/2);return"XYZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===o?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===o?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===o&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],s=r[1],a=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+a+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-l)*e,this._y=(o-c)*e,this._z=(s-i)*e):n>a&&n>h?(e=2*Math.sqrt(1+n-a-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(o+c)/e):a>h?(e=2*Math.sqrt(1+a-n-h),this._w=(o-c)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-n-a),this._w=(s-i)/e,this._x=(o+c)/e,this._y=(l+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new Ta;return function(r,n){return void 0===e&&(e=new Ta),(t=r.dot(n)+1)<1e-6?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,s=e._x,a=e._y,l=e._z,c=e._w;return this._x=r*c+o*s+n*l-i*a,this._y=n*c+o*a+i*s-r*l,this._z=i*c+o*l+r*a-n*s,this._w=o*c-r*s-n*a-i*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,s=o*t._w+r*t._x+n*t._y+i*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(a,s),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Aa.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}}),Ea.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ea.DefaultOrder="XYZ",Object.defineProperties(Ea.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(Ea.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=_a.clamp,i=t.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===e?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new Sa;return function(e,r,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new Ma;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Ta(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Ca.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(Pa.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,s,a,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=s,c[3]=e,c[4]=i,c[5]=a,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Ta;return function(e){for(var r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],s=r[3],a=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return i[0]=o*f+s*g+a*b,i[3]=o*m+s*y+a*w,i[6]=o*v+s*x+a*_,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*_,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*w,i[8]=h*v+d*x+p*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return e*o*c-e*s*l-r*i*c+r*s*a+n*i*l-n*o*a},getInverse:function(t,e){t&&t.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*a,m=h*a-l*u,v=i*p+o*f+s*m;if(0===v){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(s*h-d*o)*y,n[2]=(c*o-s*l)*y,n[3]=f*y,n[4]=(d*i-s*u)*y,n[5]=(s*a-c*i)*y,n[6]=m*y,n[7]=(o*u-h*i)*y,n[8]=(l*i-o*a)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,s){var a=Math.cos(i),l=Math.sin(i);this.set(r*a,r*l,-r*(a*o+l*s)+o+t,-n*l,n*a,-n*(-l*o+a*s)+s+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],s=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*i+r*a,n[3]=e*o+r*l,n[6]=e*s+r*c,n[1]=-r*i+e*a,n[4]=-r*o+e*l,n[7]=-r*s+e*c,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Oa=0;function Na(){Object.defineProperty(this,"id",{value:Oa++}),this.uuid=_a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Na.DefaultUp.clone();var t=new Ta,e=new Ea,r=new Ma,n=new Ta(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Sa},normalMatrix:{value:new Pa}}),this.matrix=new Sa,this.matrixWorld=new Sa,this.matrixAutoUpdate=Na.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ca,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Na.DefaultUp=new Ta(0,1,0),Na.DefaultMatrixAutoUpdate=!0,Na.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Na,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new Ma;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new Ma;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Ta(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Ta(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Ta(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Ta;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new Ta(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Ta(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Ta(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new Sa;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new Sa,e=new Ta;return function(r,n,i){r.isVector3?e.copy(r):e.set(r,n,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){var e=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(e[r]);return this}return t===this?(console.error("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this)},remove:function(t){var e=arguments;if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.remove(e[r]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("Object3D: .getWorldPosition() target is now required"),t=new Ta),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new Ta,e=new Ta;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),r=new Ma),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldScale:function(){var t=new Ta,e=new Ma;return function(r){return void 0===r&&(console.warn("Object3D: .getWorldScale() target is now required"),r=new Ta),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new Ma;return function(e){return void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new Ta),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++)i(t.shapes,s[a]);else i(t.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(a=0,l=this.material.length;a<l;a++)c.push(i(t.materials,this.material[a]));n.material=c}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(t).object);if(e){var u=f(t.geometries),h=f(t.materials),d=f(t.textures),p=f(t.images);s=f(t.shapes),u.length>0&&(r.geometries=u),h.length>0&&(r.materials=h),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),s.length>0&&(r.shapes=s)}return r.object=n,r;function f(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}});var La={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ia(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function Ra(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new Ta,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Ia,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function Da(t,e){this.min=void 0!==t?t:new Ta(1/0,1/0,1/0),this.max=void 0!==e?e:new Ta(-1/0,-1/0,-1/0)}function Fa(t,e){this.center=void 0!==t?t:new Ta,this.radius=void 0!==e?e:0}function ka(t,e){this.x=t||0,this.y=e||0}Object.assign(Ia.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,n){if(e=_a.euclideanModulo(e,1),r=_a.clamp(r,0,1),n=_a.clamp(n,0,1),0===r)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+r):n+r-n*r,o=2*n-i;this.r=t(o,i,e+1/3),this.g=t(o,i,e),this.b=t(o,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[2];switch(r[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,a=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(o,s,a)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(l=La[t])?this.setHex(l):console.warn("Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;return this.r=t*t,this.g=e*e,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,s=Math.max(n,i,o),a=Math.min(n,i,o),l=(a+s)/2;if(a===s)e=0,r=0;else{var c=s-a;switch(r=l<=.5?c/(s+a):c/(2-s-a),s){case n:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var t={};return function(e,r,n){return this.getHSL(t),t.h+=e,t.s+=r,t.l+=n,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Object.assign(Ra.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),Object.assign(Da.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=t.length;a<l;a+=3){var c=t[a],u=t[a+1],h=t[a+2];c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(e,r,n),this.max.set(i,o,s),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=t.count;a<l;a++){var c=t.getX(a),u=t.getY(a),h=t.getZ(a);c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>s&&(s=h)}return this.min.set(e,r,n),this.max.set(i,o,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Ta;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("Box3: .getCenter() target is now required"),t=new Ta),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box3: .getSize() target is now required"),t=new Ta),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,n=new Ta;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(e=0,r=s.length;e<r;e++)n.copy(s[e]),n.applyMatrix4(i.matrixWorld),t.expandByPoint(n)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(e=0,r=a.count;e<r;e++)n.fromBufferAttribute(a,e).applyMatrix4(i.matrixWorld),t.expandByPoint(n)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("Box3: .getParameter() target is now required"),e=new Ta),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new Ta;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=t.constant&&r>=t.constant},intersectsTriangle:function(){var t=new Ta,e=new Ta,r=new Ta,n=new Ta,i=new Ta,o=new Ta,s=new Ta,a=new Ta,l=new Ta,c=new Ta;function u(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){s.fromArray(n,i);var a=l.x*Math.abs(s.x)+l.y*Math.abs(s.y)+l.z*Math.abs(s.z),c=t.dot(s),u=e.dot(s),h=r.dot(s);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>a)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(a),l.subVectors(this.max,a),t.subVectors(s.a,a),e.subVectors(s.b,a),r.subVectors(s.c,a),n.subVectors(e,t),i.subVectors(r,e),o.subVectors(t,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("Box3: .clampPoint() target is now required"),e=new Ta),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Ta;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Ta;return function(e){return void 0===e&&(console.warn("Box3: .getBoundingSphere() target is now required"),e=new Fa),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta,new Ta];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Fa.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new Da;return function(e,r){var n=this.center;void 0!==r?n.copy(r):t.setFromPoints(e).getCenter(n);for(var i=0,o=0,s=e.length;o<s;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("Sphere: .clampPoint() target is now required"),e=new Ta),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("Sphere: .getBoundingBox() target is now required"),t=new Da),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.defineProperties(ka.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(ka.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new ka,e=new ka;return function(r,n){return t.set(r,r),e.set(n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this}});var Ua=0;function Ba(){Object.defineProperty(this,"id",{value:Ua+=2}),this.uuid=_a.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function ja(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function za(t,e,r){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Va(t,e,r){za.call(this,new Int8Array(t),e,r)}function Ga(t,e,r){za.call(this,new Uint8Array(t),e,r)}function Ha(t,e,r){za.call(this,new Uint8ClampedArray(t),e,r)}function Wa(t,e,r){za.call(this,new Int16Array(t),e,r)}function Xa(t,e,r){za.call(this,new Uint16Array(t),e,r)}function qa(t,e,r){za.call(this,new Int32Array(t),e,r)}function Ya(t,e,r){za.call(this,new Uint32Array(t),e,r)}function Za(t,e,r){za.call(this,new Float32Array(t),e,r)}function Ja(t,e,r){za.call(this,new Float64Array(t),e,r)}function Qa(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Ba.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ba,isGeometry:!0,applyMatrix:function(t){for(var e=(new Pa).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,s=i.vertexNormals.length;o<s;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new Sa;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Sa;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Sa;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Sa;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Sa;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Na;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)e.vertices.push(new Ta(i[d],i[d+1],i[d+2])),void 0!==o&&c.push(new Ta(o[d],o[d+1],o[d+2])),void 0!==s&&e.colors.push(new Ia(s[d],s[d+1],s[d+2])),void 0!==a&&u.push(new ka(a[p],a[p+1])),void 0!==l&&h.push(new ka(l[p],l[p+1]));function f(t,r,n,i){var d=new Ra(t,r,n,void 0!==o?[c[t].clone(),c[r].clone(),c[n].clone()]:[],void 0!==s?[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()]:[],i);e.faces.push(d),void 0!==a&&e.faceVertexUvs[0].push([u[t].clone(),u[r].clone(),u[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([h[t].clone(),h[r].clone(),h[n].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=(p=g,g+v.count);p<y;p+=3)void 0!==r?f(r[p],r[p+1],r[p+2],v.materialIndex):f(p,p+1,p+2,v.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)f(r[d],r[d+1],r[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new Ta;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new Sa;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Ta,e=new Ta,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b];t.subVectors(this.vertices[i.c],s),e.subVectors(o,s),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,s;for(void 0===t&&(t=!0),s=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)s[e]=new Ta;if(t){var a,l,c=new Ta,u=new Ta;for(n=0,i=this.faces.length;n<i;n++)a=this.vertices[(o=this.faces[n]).a],c.subVectors(this.vertices[o.c],l=this.vertices[o.b]),u.subVectors(a,l),c.cross(u),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)s[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var h=(o=this.faces[n]).vertexNormals;3===h.length?(h[0].copy(s[o.a]),h[1].copy(s[o.b]),h[2].copy(s[o.c])):(h[0]=s[o.a].clone(),h[1]=s[o.b].clone(),h[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new Ba;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Ta,c={a:new Ta,b:new Ta,c:new Ta},s.push(l),a.push(c)}var l,c,u=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)c=u.vertexNormals[r],(l=u.faceNormals[r]).copy((i=this.faces[r]).normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Da),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Fa),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,l=t.faces,c=this.faceVertexUvs[0],u=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new Pa).getNormalMatrix(e));for(var p=0,f=s.length;p<f;p++){var m=s[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y=l[p],x=y.vertexNormals,b=y.vertexColors;(v=new Ra(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var w=0,_=x.length;w<_;w++)g=x[w].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);for(v.color.copy(y.color),w=0,_=b.length;w<_;w++)v.vertexColors.push(b[w].clone());v.materialIndex=y.materialIndex+r,a.push(v)}for(p=0,f=u.length;p<f;p++){var S=u[p],T=[];if(void 0!==S){for(w=0,_=S.length;w<_;w++)T.push(S[w].clone());c.push(T)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,s,a,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[e]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new Ta(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,i,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];for(o&&o.length===e&&(n=[]),s&&s.length===e&&(i=[]),r=0;r<e;r++){var a=t[r]._id;n&&n.push(o[a]),i&&i.push(s[a])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x=S(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),s.push(x),s.push(p.a,p.b,p.c),s.push(p.materialIndex),f){var b=this.faceVertexUvs[0][i];s.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&s.push(T(p.normal)),v){var w=p.vertexNormals;s.push(T(w[0]),T(w[1]),T(w[2]))}if(g&&s.push(M(p.color)),y){var _=p.vertexColors;s.push(M(_[0]),M(_[1]),M(_[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=a.length/3,a.push(t.x,t.y,t.z),l[e])}function M(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]?u[e]:(u[e]=c.length,c.push(t.getHex()),u[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=n,t.data.normals=a,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=s,t},clone:function(){return(new Ba).copy(this)},copy:function(t){var e,r,n,i,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,r=a.length;e<r;e++)this.vertices.push(a[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,r=c.length;e<r;e++)this.faces.push(c[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(o=0,s=h.length;o<s;o++)d.push(h[o].clone());this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,r=p.length;e<r;e++){var f={};if(f.name=p[e].name,void 0!==p[e].vertices)for(f.vertices=[],n=0,i=p[e].vertices.length;n<i;n++)f.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(f.normals=[],n=0,i=p[e].normals.length;n<i;n++)f.normals.push(p[e].normals[n].clone());this.morphTargets.push(f)}var m=t.morphNormals;for(e=0,r=m.length;e<r;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,i=m[e].vertexNormals.length;n<i;n++){var g=m[e].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,i=m[e].faceNormals.length;n<i;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var x=t.skinWeights;for(e=0,r=x.length;e<r;e++)this.skinWeights.push(x[e].clone());var b=t.skinIndices;for(e=0,r=b.length;e<r;e++)this.skinIndices.push(b[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(ja.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=t.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(s+1)/2,v=(u+1)/2,g=(f+1)/2,y=(a+c)/4,x=(l+d)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=x/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(g)),n=b/i),this.set(r,n,i,e),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-a)/w,this.w=Math.acos((s+u+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(r,n){return void 0===t&&(t=new ja,e=new ja),t.set(r,r,r,r),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.defineProperty(za.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(za.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",n),o=new Ia),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new ka),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Ta),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new ja),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Va.prototype=Object.create(za.prototype)).constructor=Va,(Ga.prototype=Object.create(za.prototype)).constructor=Ga,(Ha.prototype=Object.create(za.prototype)).constructor=Ha,(Wa.prototype=Object.create(za.prototype)).constructor=Wa,(Xa.prototype=Object.create(za.prototype)).constructor=Xa,(qa.prototype=Object.create(za.prototype)).constructor=qa,(Ya.prototype=Object.create(za.prototype)).constructor=Ya,(Za.prototype=Object.create(za.prototype)).constructor=Za,(Ja.prototype=Object.create(za.prototype)).constructor=Ja,Object.assign(Qa.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var s=i[o];s.materialIndex!==n&&(n=s.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=t.morphTargets,l=a.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]=[];this.morphTargets.position=e}var u,h=t.morphNormals,d=h.length;if(d>0){for(u=[],c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=t.skinIndices,f=t.skinWeights,m=p.length===n.length,v=f.length===n.length;for(c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}!0===o&&(void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new ka,new ka,new ka))),!0===s&&(void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new ka,new ka,new ka)));for(var S=0;S<l;S++){var T=a[S].vertices;e[S].push(T[g.a],T[g.b],T[g.c])}for(S=0;S<d;S++){var M=h[S].vertexNormals[c];u[S].push(M.a,M.b,M.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Ka=1;function $a(){Object.defineProperty(this,"id",{value:Ka+=2}),this.uuid=_a.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function tl(t,e,r,n,i,o,s){Ba.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new el(t,e,r,n,i,o,s)),this.mergeVertices()}function el(t,e,r,n,i,o,s){$a.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var a,l,c=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),u=0,h=[],d=new Ta,p=new Ta,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],x=l/r;for(a=0;a<=e;a++){var b=a/e;d.x=-t*Math.cos(n+b*i)*Math.sin(o+x*s),d.y=t*Math.cos(o+x*s),d.z=t*Math.sin(n+b*i)*Math.sin(o+x*s),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-x),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(a=0;a<e;a++){var w=h[l][a],_=h[l+1][a],S=h[l+1][a+1];(0!==l||o>0)&&f.push(h[l][a+1],w,S),(l!==r-1||c<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.addAttribute("position",new Za(m,3)),this.addAttribute("normal",new Za(v,3)),this.addAttribute("uv",new Za(g,2))}$a.prototype=Object.assign(Object.create(Aa.prototype),{constructor:$a,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(function(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}(t)>65535?Ya:Xa)(t,1):t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new za(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;return void 0!==r&&((new Pa).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new Sa;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Sa;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Sa;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Sa;return function(e,r,n){return t.makeTranslation(e,r,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Sa;return function(e,r,n){return t.makeScale(e,r,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Na;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Ta;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new Za(3*e.vertices.length,3),n=new Za(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Za(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Za(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Qa).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new za(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new za(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new za(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new za(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new za(o,2).copyVector2sArray(t.uvs2))}for(var s in this.groups=t.groups,t.morphTargets){for(var a=[],l=t.morphTargets[s],c=0,u=l.length;c<u;c++){var h=l[c],d=new Za(3*h.length,3);a.push(d.copyVector3sArray(h))}this.morphAttributes[s]=a}if(t.skinIndices.length>0){var p=new Za(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Za(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Da);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new Da,e=new Ta;return function(){null===this.boundingSphere&&(this.boundingSphere=new Fa);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;t.setFromBufferAttribute(r),t.getCenter(n);for(var i=0,o=0,s=r.count;o<s;o++)e.x=r.getX(o),e.y=r.getY(o),e.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new za(new Float32Array(n.length),3));else for(var i=e.normal.array,o=0,s=i.length;o<s;o++)i[o]=0;var a,l,c,u=e.normal.array,h=new Ta,d=new Ta,p=new Ta,f=new Ta,m=new Ta;if(t){var v=t.array;0===r.length&&this.addGroup(0,v.length);for(var g=0,y=r.length;g<y;++g){var x=r[g],b=x.start;for(o=b,s=b+x.count;o<s;o+=3)l=3*v[o+1],c=3*v[o+2],h.fromArray(n,a=3*v[o+0]),d.fromArray(n,l),p.fromArray(n,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[a]+=f.x,u[a+1]+=f.y,u[a+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,s=n.length;o<s;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],s=o.array,a=0,l=o.itemSize*e;a<s.length;a++,l++)i[l]=s[a];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",t)},normalizeNormals:function(){var t=new Ta;return function(){for(var e=this.attributes.normal,r=0,n=e.count;r<n;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new $a,e=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,s=i.itemSize,a=new o.constructor(e.length*s),l=0,c=0,u=0,h=e.length;u<h;u++){l=e[u]*s;for(var d=0;d<s;d++)a[c++]=o[l++]}t.addAttribute(n,new za(a,s))}var p=this.groups;for(u=0,h=p.length;u<h;u++){var f=p[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var s=o[r];i=Array.prototype.slice.call(s.array),t.data.attributes[r]={itemSize:s.itemSize,type:s.array.constructor.name,array:i,normalized:s.normalized}}var a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new $a).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o)this.addAttribute(e,o[e].clone());var s=t.morphAttributes;for(e in s){var a=[],l=s[e];for(r=0,n=l.length;r<n;r++)a.push(l[r].clone());this.morphAttributes[e]=a}var c=t.groups;for(r=0,n=c.length;r<n;r++){var u=c[r];this.addGroup(u.start,u.count,u.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(tl.prototype=Object.create(Ba.prototype)).constructor=tl,(el.prototype=Object.create($a.prototype)).constructor=el;var rl=0,nl=1,il=2,ol=0,sl=1,al=2,ll=1,cl=100,ul=204,hl=205,dl=3,pl=0,fl=301,ml=303,vl=305,gl=1e3,yl=1001,xl=1002,bl=1003,wl=1006,_l=1008,Sl=1009,Tl=1012,Ml=1020,Al=1022,El=1023,Cl=El,Pl=1026,Ol=1027,Nl=2201,Ll=2300,Il=2400,Rl=0,Dl=1,Fl=2,kl=3e3,Ul=3200,Bl=0;function jl(){Object.defineProperty(this,"id",{value:Bl++}),this.uuid=_a.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=ll,this.side=rl,this.flatShading=!1,this.vertexColors=ol,this.opacity=1,this.transparent=!1,this.blendSrc=ul,this.blendDst=hl,this.blendEquation=cl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=dl,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function zl(t){jl.call(this),this.type="MeshBasicMaterial",this.color=new Ia(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Vl(t){jl.call(this),this.type="LineBasicMaterial",this.color=new Ia(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function Gl(t,e){this.origin=void 0!==t?t:new Ta,this.direction=void 0!==e?e:new Ta}function Hl(t,e){this.start=void 0!==t?t:new Ta,this.end=void 0!==e?e:new Ta}function Wl(t,e){this.normal=void 0!==t?t:new Ta(1,0,0),this.constant=void 0!==e?e:0}function Xl(t,e,r){this.a=void 0!==t?t:new Ta,this.b=void 0!==e?e:new Ta,this.c=void 0!==r?r:new Ta}function ql(t,e){Na.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new $a,this.material=void 0!==e?e:new zl({color:16777215*Math.random()}),this.drawMode=Rl,this.updateMorphTargets()}function Yl(t,e,r){1===r&&console.error("Line: parameter LinePieces no longer supported. Created LineSegments instead."),Na.call(this),this.type="Line",this.geometry=void 0!==t?t:new $a,this.material=void 0!==e?e:new Vl({color:16777215*Math.random()})}jl.prototype=Object.assign(Object.create(Aa.prototype),{constructor:jl,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]="overdraw"===e?Number(r):r:console.warn(this.type+": '"+e+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==ll&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==rl&&(r.side=this.side),this.vertexColors!==ol&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(zl.prototype=Object.create(jl.prototype)).constructor=zl,zl.prototype.isMeshBasicMaterial=!0,zl.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},(Vl.prototype=Object.create(jl.prototype)).constructor=Vl,Vl.prototype.isLineBasicMaterial=!0,Vl.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Object.assign(Gl.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("Ray: .at() target is now required"),e=new Ta),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Ta;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("Ray: .closestPointToPoint() target is now required"),e=new Ta),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Ta;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new Ta,e=new Ta,r=new Ta;return function(n,i,o,s){t.copy(n).add(i).multiplyScalar(.5),e.copy(i).sub(n).normalize(),r.copy(this.origin).sub(t);var a,l,c,u,h=.5*n.distanceTo(i),d=-this.direction.dot(e),p=r.dot(this.direction),f=-r.dot(e),m=r.lengthSq(),v=Math.abs(1-d*d);if(v>0)if(l=d*p-f,u=h*v,(a=d*f-p)>=0)if(l>=-u)if(l<=u){var g=1/v;c=(a*=g)*(a+d*(l*=g)+2*p)+l*(d*a+l+2*f)+m}else l=h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l=-h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;else l<=-u?c=-(a=Math.max(0,-(-d*h+p)))*a+(l=a>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(a=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(a=Math.max(0,-(d*h+p)))*a+(l=a>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(a=Math.max(0,-(d*l+p)))*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(e).multiplyScalar(l).add(t),c}}(),intersectSphere:function(){var t=new Ta;return function(e,r){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),i=t.dot(t)-n*n,o=e.radius*e.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=n-s,l=n+s;return a<0&&l<0?null:this.at(a<0?l:a,r)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(s=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(s=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),r>a||s>n?null:((s>r||r!=r)&&(r=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(){var t=new Ta;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new Ta,e=new Ta,r=new Ta,n=new Ta;return function(i,o,s,a,l){e.subVectors(o,i),r.subVectors(s,i),n.crossVectors(e,r);var c,u=this.direction.dot(n);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}t.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=c*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>u)return null;var p=-c*t.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Hl.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("Line3: .getCenter() target is now required"),t=new Ta),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("Line3: .delta() target is now required"),t=new Ta),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("Line3: .at() target is now required"),e=new Ta),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new Ta,e=new Ta;return function(r,n){t.subVectors(r,this.start),e.subVectors(this.end,this.start);var i=e.dot(e),o=e.dot(t)/i;return n&&(o=_a.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("Line3: .closestPointToPoint() target is now required"),r=new Ta),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Wl.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Ta,e=new Ta;return function(r,n,i){var o=t.subVectors(i,n).cross(e.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("Plane: .projectPoint() target is now required"),e=new Ta),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Ta;return function(e,r){void 0===r&&(console.warn("Plane: .intersectLine() target is now required"),r=new Ta);var n=e.delta(t),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("Plane: .coplanarPoint() target is now required"),t=new Ta),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Ta,e=new Pa;return function(r,n){var i=n||e.getNormalMatrix(r),o=this.coplanarPoint(t).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Xl,{getNormal:function(){var t=new Ta;return function(e,r,n,i){void 0===i&&(console.warn("Triangle: .getNormal() target is now required"),i=new Ta),i.subVectors(n,r),t.subVectors(e,r),i.cross(t);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var t=new Ta,e=new Ta,r=new Ta;return function(n,i,o,s,a){t.subVectors(s,i),e.subVectors(o,i),r.subVectors(n,i);var l=t.dot(t),c=t.dot(e),u=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-c*c;if(void 0===a&&(console.warn("Triangle: .getBarycoord() target is now required"),a=new Ta),0===p)return a.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return a.set(1-m-v,v,m)}}(),containsPoint:function(){var t=new Ta;return function(e,r,n,i){return Xl.getBarycoord(e,r,n,i,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}()}),Object.assign(Xl.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Ta,e=new Ta;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("Triangle: .getMidpoint() target is now required"),t=new Ta),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Xl.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("Triangle: .getPlane() target is now required"),t=new Ta),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Xl.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Xl.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Wl,e=[new Hl,new Hl,new Hl],r=new Ta,n=new Ta;return function(i,o){void 0===o&&(console.warn("Triangle: .closestPointToPoint() target is now required"),o=new Ta);var s=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var a=0;a<e.length;a++){e[a].closestPointToPoint(r,!0,n);var l=r.distanceToSquared(n);l<s&&(s=l,o.copy(n))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),ql.prototype=Object.assign(Object.create(Na.prototype),{constructor:ql,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return Na.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var s=i[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)r=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var a=n.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}},raycast:function(){var t=new Sa,e=new Gl,r=new Fa,n=new Ta,i=new Ta,o=new Ta,s=new Ta,a=new Ta,l=new Ta,c=new ka,u=new ka,h=new ka,d=new Ta,p=new Ta,f=new Ta;function m(t,e,r,n,i,o,s){return Xl.getBarycoord(t,e,r,n,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),s.multiplyScalar(d.z),i.add(o).add(s),i.clone()}function v(t,e,r,n,i,o,s,a){if(null===(e.side===nl?n.intersectTriangle(s,o,i,!0,a):n.intersectTriangle(i,o,s,e.side!==il,a)))return null;f.copy(a),f.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(f);return l<r.near||l>r.far?null:{distance:l,point:f.clone(),object:t}}function g(t,e,r,s,a,l,d,f){n.fromBufferAttribute(s,l),i.fromBufferAttribute(s,d),o.fromBufferAttribute(s,f);var g=v(t,t.material,e,r,n,i,o,p);if(g){a&&(c.fromBufferAttribute(a,l),u.fromBufferAttribute(a,d),h.fromBufferAttribute(a,f),g.uv=m(p,n,i,o,c,u,h));var y=new Ra(l,d,f);Xl.getNormal(n,i,o,y.normal),g.face=y,g.faceIndex=l}return g}return function(d,f){var y,x=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===x.boundingSphere&&x.computeBoundingSphere(),r.copy(x.boundingSphere),r.applyMatrix4(w),!1!==d.ray.intersectsSphere(r)&&(t.getInverse(w),e.copy(d.ray).applyMatrix4(t),null===x.boundingBox||!1!==e.intersectsBox(x.boundingBox))))if(x.isBufferGeometry){var _,S,T,M,A,E=x.index,C=x.attributes.position,P=x.attributes.uv;if(null!==E)for(M=0,A=E.count;M<A;M+=3)_=E.getX(M),S=E.getX(M+1),T=E.getX(M+2),(y=g(this,d,e,C,P,_,S,T))&&(y.faceIndex=Math.floor(M/3),f.push(y));else if(void 0!==C)for(M=0,A=C.count;M<A;M+=3)(y=g(this,d,e,C,P,_=M,S=M+1,T=M+2))&&(y.index=_,f.push(y))}else if(x.isGeometry){var O,N,L,I,R=Array.isArray(b),D=x.vertices,F=x.faces,k=x.faceVertexUvs[0];k.length>0&&(I=k);for(var U=0,B=F.length;U<B;U++){var j=F[U],z=R?b[j.materialIndex]:b;if(void 0!==z){if(O=D[j.a],N=D[j.b],L=D[j.c],!0===z.morphTargets){var V=x.morphTargets,G=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var H=0,W=V.length;H<W;H++){var X=G[H];if(0!==X){var q=V[H].vertices;n.addScaledVector(s.subVectors(q[j.a],O),X),i.addScaledVector(a.subVectors(q[j.b],N),X),o.addScaledVector(l.subVectors(q[j.c],L),X)}}n.add(O),i.add(N),o.add(L),O=n,N=i,L=o}if(y=v(this,z,d,e,O,N,L,p)){if(I&&I[U]){var Y=I[U];c.copy(Y[0]),u.copy(Y[1]),h.copy(Y[2]),y.uv=m(p,O,N,L,c,u,h)}y.face=j,y.faceIndex=U,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Yl.prototype=Object.assign(Object.create(Na.prototype),{constructor:Yl,isLine:!0,computeLineDistances:function(){var t=new Ta,e=new Ta;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[0],o=1,s=n.count;o<s;o++)t.fromBufferAttribute(n,o-1),e.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=t.distanceTo(e);r.addAttribute("lineDistance",new Za(i,1))}else console.error("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for((i=r.lineDistances)[0]=0,o=1,s=a.length;o<s;o++)i[o]=i[o-1],i[o]+=a[o-1].distanceTo(a[o])}return this}}(),raycast:function(){var t=new Sa,e=new Gl,r=new Fa;return function(n,i){var o=n.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var c=new Ta,u=new Ta,h=new Ta,d=new Ta,p=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=p){var x=v[g+1];c.fromArray(m,3*v[g]),u.fromArray(m,3*x),e.distanceSqToSegment(c,u,d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,y=m.length/3-1;g<y;g+=p)c.fromArray(m,3*g),u.fromArray(m,3*g+3),e.distanceSqToSegment(c,u,d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(a.isGeometry){var b=a.vertices,w=b.length;for(g=0;g<w-1;g+=p){var _;e.distanceSqToSegment(b[g],b[g+1],d,h)>s||(d.applyMatrix4(this.matrixWorld),(_=n.ray.origin.distanceTo(d))<n.near||_>n.far||i.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Zl=function(t){this.mesh=t,this._valid()};Zl.prototype={constructor:Zl,_valid:function(){for(var t=this.mesh.geometry.iks,e=this.mesh.skeleton.bones,r=0,n=t.length;r<n;r++){var i,o,s=t[r],a=s.links;i=e[s.effector];for(var l=0,c=a.length;l<c;l++)i.parent!==(o=e[a[l].index])&&console.warn("CCDIKSolver: bone "+i.name+" is not the child of bone "+o.name),i=o}},_saveOriginalBonesInfo:function(){for(var t=this.mesh.skeleton.bones,e=0,r=t.length;e<r;e++){var n=t[e];void 0===n.userData.ik&&(n.userData.ik={}),n.userData.ik.originalMatrix=n.matrix.toArray()}},update:function(t){var e=new Ma,r=new Ta,n=new Ta,i=new Ta,o=new Ta,s=new Ta,a=new Ma,l=new Ta,c=new Ta,u=this.mesh.skeleton.bones,h=this.mesh.geometry.iks,d=Math;this.mesh.updateMatrixWorld(!0),!0===t&&this._saveOriginalBonesInfo();for(var p=0,f=h.length;p<f;p++){var m=h[p],v=u[m.effector];r.setFromMatrixPosition(u[m.target].matrixWorld);for(var g=m.links,y=void 0!==m.iteration?m.iteration:1,x=0;x<y;x++){for(var b=!1,w=0,_=g.length;w<_;w++){var S=u[g[w].index];if(!1===g[w].enabled)break;var T=g[w].limitation;S.matrixWorld.decompose(s,a,l),a.inverse(),i.setFromMatrixPosition(v.matrixWorld),o.subVectors(i,s),o.applyQuaternion(a),o.normalize(),n.subVectors(r,s),n.applyQuaternion(a),n.normalize();var M=n.dot(o);if(M>1?M=1:M<-1&&(M=-1),!((M=d.acos(M))<1e-5)){if(void 0!==m.minAngle&&M<m.minAngle&&(M=m.minAngle),void 0!==m.maxAngle&&M>m.maxAngle&&(M=m.maxAngle),c.crossVectors(o,n),c.normalize(),e.setFromAxisAngle(c,M),S.quaternion.multiply(e),void 0!==T){var A=S.quaternion.w;A>1&&(A=1);var E=d.sqrt(1-A*A);S.quaternion.set(T.x*E,T.y*E,T.z*E,A)}S.updateMatrixWorld(!0),b=!0}}if(!b)break}}this.mesh.updateMatrixWorld(!0)}};var Jl=function(t){if(void 0===t.geometry.iks||void 0===t.skeleton)throw"CCDIKHelper requires iks in mesh.geometry and skeleton in mesh.";Na.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.sphereGeometry=new el(.25,16,8),this.targetSphereMaterial=new zl({color:new Ia(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new zl({color:new Ia(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new zl({color:new Ia(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new Vl({color:new Ia(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init(),this.update()};function Ql(){Na.call(this),this.type="Bone"}function Kl(t,e,r,n,i,o){Ba.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new $l(t,e,r,n,i,o)),this.mergeVertices()}function $l(t,e,r,n,i,o){$a.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var s=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var a=[],l=[],c=[],u=[],h=0,d=0;function p(t,e,r,n,i,o,p,f,m,v,g){var y,x,b=o/m,w=p/v,_=o/2,S=p/2,T=f/2,M=m+1,A=v+1,E=0,C=0,P=new Ta;for(x=0;x<A;x++){var O=x*w-S;for(y=0;y<M;y++)P[t]=(y*b-_)*n,P[e]=O*i,P[r]=T,l.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-x/v),E+=1}for(x=0;x<v;x++)for(y=0;y<m;y++){var N=h+y+M*(x+1),L=h+(y+1)+M*(x+1),I=h+(y+1)+M*x;a.push(h+y+M*x,N,I),a.push(N,L,I),C+=6}s.addGroup(d,C,g),d+=C,h+=E}p("z","y","x",-1,-1,r,e,t,o=Math.floor(o)||1,i,0),p("z","y","x",1,-1,r,e,-t,o,i,1),p("x","z","y",1,1,t,r,e,n,o,2),p("x","z","y",1,-1,t,r,-e,n,o,3),p("x","y","z",1,-1,t,e,r,n,i,4),p("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(a),this.addAttribute("position",new Za(l,3)),this.addAttribute("normal",new Za(c,3)),this.addAttribute("uv",new Za(u,2))}function tc(t,e,r,n,i,o,s,a){Ba.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new ec(t,e,r,n,i,o,s,a)),this.mergeVertices()}function ec(t,e,r,n,i,o,s,a){$a.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,o,f,g=new ka,y=new Ta,x=0,b=!0===r?t:e,w=!0===r?1:-1;for(o=p,i=1;i<=n;i++)u.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var _=i/n*a+s,S=Math.cos(_),T=Math.sin(_);y.x=b*T,y.y=m*w,y.z=b*S,u.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*S+.5,g.y=.5*T*w+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=o+i,A=f+i;!0===r?c.push(A,A+1,M):c.push(A+1,A,M),x+=3}l.addGroup(v,x,!0===r?1:2),v+=x}!function(){var o,g,y=new Ta,x=new Ta,b=0,w=(e-t)/r;for(g=0;g<=i;g++){var _=[],S=g/i,T=S*(e-t)+t;for(o=0;o<=n;o++){var M=o/n,A=M*a+s,E=Math.sin(A),C=Math.cos(A);x.x=T*E,x.y=-S*r+m,x.z=T*C,u.push(x.x,x.y,x.z),y.set(E,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),_.push(p++)}f.push(_)}for(o=0;o<n;o++)for(g=0;g<i;g++){var P=f[g+1][o],O=f[g+1][o+1],N=f[g][o+1];c.push(f[g][o],P,N),c.push(P,O,N),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new Za(u,3)),this.addAttribute("normal",new Za(h,3)),this.addAttribute("uv",new Za(d,2))}(Jl.prototype=Object.create(Na.prototype)).constructor=Jl,Jl.prototype._init=function(){var t=this,e=this.root.geometry.iks;function r(e){return new Yl(function(t){var e=new $a,r=new Float32Array(3*(2+t.links.length));return e.addAttribute("position",new za(r,3)),e}(e),t.lineMaterial)}for(var n=0,i=e.length;n<i;n++){var o=e[n];this.add(new ql(t.sphereGeometry,t.targetSphereMaterial)),this.add(new ql(t.sphereGeometry,t.effectorSphereMaterial));for(var s=0,a=o.links.length;s<a;s++)this.add(new ql(t.sphereGeometry,t.linkSphereMaterial));this.add(r(o))}},Jl.prototype.update=function(){var t=0,e=this.root,r=e.geometry.iks,n=e.skeleton.bones,i=(new Sa).getInverse(e.matrixWorld),o=new Ta;function s(t){return o.setFromMatrixPosition(t.matrixWorld),o.applyMatrix4(i),o}function a(t,e,r){var n=s(r);t[3*e+0]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z}for(var l=0,c=r.length;l<c;l++){var u=r[l],h=n[u.target],d=n[u.effector],p=this.children[t++],f=this.children[t++];p.position.copy(s(h)),f.position.copy(s(d));for(var m=0,v=u.links.length;m<v;m++)this.children[t++].position.copy(s(n[u.links[m].index]));var g=this.children[t++],y=g.geometry.attributes.position.array;for(a(y,0,h),a(y,1,d),m=0,v=u.links.length;m<v;m++)a(y,m+2,n[u.links[m].index]);g.geometry.attributes.position.needsUpdate=!0}},Ql.prototype=Object.assign(Object.create(Na.prototype),{constructor:Ql,isBone:!0}),(Kl.prototype=Object.create(Ba.prototype)).constructor=Kl,($l.prototype=Object.create($a.prototype)).constructor=$l,(tc.prototype=Object.create(Ba.prototype)).constructor=tc,(ec.prototype=Object.create($a.prototype)).constructor=ec;var rc=function(t,e){void 0===e&&(e={}),this.mesh=t,this.helper=new rc.ResourceHelper,this.unitStep=void 0!==e.unitStep?e.unitStep:1/65,this.maxStepNum=void 0!==e.maxStepNum?e.maxStepNum:3,this.world=void 0!==e.world?e.world:null,this.bodies=[],this.constraints=[],this.init(t)};rc.prototype={constructor:rc,init:function(t){var e=t.parent;null!==e&&e.remove(t);var r=this.helper,n=r.allocThreeVector3(),i=r.allocThreeEuler(),o=r.allocThreeVector3();n.copy(t.position),i.copy(t.rotation),o.copy(t.scale),t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrixWorld(!0),null===this.world&&this.initWorld(),this.initRigidBodies(),this.initConstraints(),null!==e&&e.add(t),t.position.copy(n),t.rotation.copy(i),t.scale.copy(o),t.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(n),r.freeThreeEuler(i),r.freeThreeVector3(o)},initWorld:function(){var t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver,i=new Ammo.btDiscreteDynamicsWorld(e,r,n,t);i.setGravity(new Ammo.btVector3(0,-98,0)),this.world=i},initRigidBodies:function(){for(var t=this.mesh.geometry.rigidBodies,e=0;e<t.length;e++){var r=new rc.RigidBody(this.mesh,this.world,t[e],this.helper);this.bodies.push(r)}},initConstraints:function(){for(var t=this.mesh.geometry.constraints,e=0;e<t.length;e++){var r=t[e],n=new rc.Constraint(this.mesh,this.world,this.bodies[r.rigidBodyIndex1],this.bodies[r.rigidBodyIndex2],r,this.helper);this.constraints.push(n)}},update:function(t){this.updateRigidBodies(),this.stepSimulation(t),this.updateBones()},stepSimulation:function(t){var e=this.unitStep,r=t,n=1+(t/e|0);r<e&&(r=e,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,e)},updateRigidBodies:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateFromBone()},updateBones:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].updateBone()},reset:function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].reset()},warmup:function(t){for(var e=0;e<t;e++)this.update(1/60)}},rc.ResourceHelper=function(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]},rc.ResourceHelper.prototype={allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Ta},freeThreeVector3:function(t){this.threeVector3s.push(t)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Sa},freeThreeMatrix4:function(t){this.threeMatrix4s.push(t)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Ma},freeThreeQuaternion:function(t){this.threeQuaternions.push(t)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new Ea},freeThreeEuler:function(t){this.threeEulers.push(t)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(t){this.transforms.push(t)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(t){this.quaternions.push(t)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(t){this.vector3s.push(t)},setIdentity:function(t){t.setIdentity()},getBasis:function(t){var e=this.allocQuaternion();return t.getBasis().getRotation(e),e},getBasisAsMatrix3:function(t){var e=this.getBasis(t),r=this.quaternionToMatrix3(e);return this.freeQuaternion(e),r},getOrigin:function(t){return t.getOrigin()},setOrigin:function(t,e){t.getOrigin().setValue(e.x(),e.y(),e.z())},copyOrigin:function(t,e){var r=e.getOrigin();this.setOrigin(t,r)},setBasis:function(t,e){t.setRotation(e)},setBasisFromMatrix3:function(t,e){var r=this.matrix3ToQuaternion(e);this.setBasis(t,r),this.freeQuaternion(r)},setOriginFromArray3:function(t,e){t.getOrigin().setValue(e[0],e[1],e[2])},setOriginFromThreeVector3:function(t,e){t.getOrigin().setValue(e.x,e.y,e.z)},setBasisFromArray3:function(t,e){var r=this.allocThreeQuaternion(),n=this.allocThreeEuler();n.set(e[0],e[1],e[2]),this.setBasisFromThreeQuaternion(t,r.setFromEuler(n)),this.freeThreeEuler(n),this.freeThreeQuaternion(r)},setBasisFromThreeQuaternion:function(t,e){var r=this.allocQuaternion();r.setX(e.x),r.setY(e.y),r.setZ(e.z),r.setW(e.w),this.setBasis(t,r),this.freeQuaternion(r)},multiplyTransforms:function(t,e){var r=this.allocTransform();this.setIdentity(r);var n=this.getBasisAsMatrix3(t),i=this.getBasisAsMatrix3(e),o=this.getOrigin(t),s=this.getOrigin(e),a=this.multiplyMatrix3ByVector3(n,s),l=this.addVector3(a,o);this.setOrigin(r,l);var c=this.multiplyMatrices3(n,i);return this.setBasisFromMatrix3(r,c),this.freeVector3(a),this.freeVector3(l),r},inverseTransform:function(t){var e=this.allocTransform(),r=this.getBasisAsMatrix3(t),n=this.getOrigin(t),i=this.transposeMatrix3(r),o=this.negativeVector3(n),s=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(e,s),this.setBasisFromMatrix3(e,i),this.freeVector3(o),this.freeVector3(s),e},multiplyMatrices3:function(t,e){var r=[],n=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),s=this.columnOfMatrix3(e,0),a=this.columnOfMatrix3(e,1),l=this.columnOfMatrix3(e,2);return r[0]=this.dotVectors3(n,s),r[1]=this.dotVectors3(n,a),r[2]=this.dotVectors3(n,l),r[3]=this.dotVectors3(i,s),r[4]=this.dotVectors3(i,a),r[5]=this.dotVectors3(i,l),r[6]=this.dotVectors3(o,s),r[7]=this.dotVectors3(o,a),r[8]=this.dotVectors3(o,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),this.freeVector3(s),this.freeVector3(a),this.freeVector3(l),r},addVector3:function(t,e){var r=this.allocVector3();return r.setValue(t.x()+e.x(),t.y()+e.y(),t.z()+e.z()),r},dotVectors3:function(t,e){return t.x()*e.x()+t.y()*e.y()+t.z()*e.z()},rowOfMatrix3:function(t,e){var r=this.allocVector3();return r.setValue(t[3*e+0],t[3*e+1],t[3*e+2]),r},columnOfMatrix3:function(t,e){var r=this.allocVector3();return r.setValue(t[e+0],t[e+3],t[e+6]),r},negativeVector3:function(t){var e=this.allocVector3();return e.setValue(-t.x(),-t.y(),-t.z()),e},multiplyMatrix3ByVector3:function(t,e){var r=this.allocVector3(),n=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),s=this.dotVectors3(n,e),a=this.dotVectors3(i,e),l=this.dotVectors3(o,e);return r.setValue(s,a,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),r},transposeMatrix3:function(t){var e=[];return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},quaternionToMatrix3:function(t){var e=[],r=t.x(),n=t.y(),i=t.z(),o=t.w(),s=r*r,a=n*n,l=i*i,c=r*n,u=n*i,h=i*r,d=r*o,p=n*o,f=i*o;return e[0]=1-2*(a+l),e[1]=2*(c-f),e[2]=2*(h+p),e[3]=2*(c+f),e[4]=1-2*(l+s),e[5]=2*(u-d),e[6]=2*(h-p),e[7]=2*(u+d),e[8]=1-2*(s+a),e},matrix3ToQuaternion:function(t){var e,r,n,i,o,s=t[0]+t[4]+t[8];s>0?(o=.25*(e=2*Math.sqrt(s+1)),r=(t[7]-t[5])/e,n=(t[2]-t[6])/e,i=(t[3]-t[1])/e):t[0]>t[4]&&t[0]>t[8]?(e=2*Math.sqrt(1+t[0]-t[4]-t[8]),o=(t[7]-t[5])/e,r=.25*e,n=(t[1]+t[3])/e,i=(t[2]+t[6])/e):t[4]>t[8]?(e=2*Math.sqrt(1+t[4]-t[0]-t[8]),o=(t[2]-t[6])/e,r=(t[1]+t[3])/e,n=.25*e,i=(t[5]+t[7])/e):(e=2*Math.sqrt(1+t[8]-t[0]-t[4]),o=(t[3]-t[1])/e,r=(t[2]+t[6])/e,n=(t[5]+t[7])/e,i=.25*e);var a=this.allocQuaternion();return a.setX(r),a.setY(n),a.setZ(i),a.setW(o),a}},rc.RigidBody=function(t,e,r,n){this.mesh=t,this.world=e,this.params=r,this.helper=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this.init()},rc.RigidBody.prototype={constructor:rc.RigidBody,init:function(){var t=this.helper,e=this.params,r=this.mesh.skeleton.bones,n=-1===e.boneIndex?new Ql:r[e.boneIndex],i=function(t){switch(t.shapeType){case 0:return new Ammo.btSphereShape(t.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(t.width,t.height,t.depth));case 2:return new Ammo.btCapsuleShape(t.width,t.height);default:throw"unknown shape type "+t.shapeType}}(e),o=0===e.type?0:e.weight,s=t.allocVector3();s.setValue(0,0,0),0!==o&&i.calculateLocalInertia(o,s);var a=t.allocTransform();t.setIdentity(a),t.setOriginFromArray3(a,e.position),t.setBasisFromArray3(a,e.rotation);var l=t.allocThreeVector3(),c=t.allocTransform();t.setIdentity(c),t.setOriginFromThreeVector3(c,n.getWorldPosition(l));var u=t.multiplyTransforms(c,a),h=new Ammo.btDefaultMotionState(u),d=new Ammo.btRigidBodyConstructionInfo(o,h,i,s);d.set_m_friction(e.friction),d.set_m_restitution(e.restitution);var p=new Ammo.btRigidBody(d);0===e.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(e.positionDamping,e.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<e.groupIndex,e.groupTarget),this.body=p,this.bone=n,this.boneOffsetForm=a,this.boneOffsetFormInverse=t.inverseTransform(a),t.freeVector3(s),t.freeTransform(u),t.freeTransform(c),t.freeThreeVector3(l)},reset:function(){this.setTransformFromBone()},updateFromBone:function(){-1!==this.params.boneIndex&&0===this.params.type&&this.setTransformFromBone()},updateBone:function(){0!==this.params.type&&-1!==this.params.boneIndex&&(this.updateBoneRotation(),1===this.params.type&&this.updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this.setPositionFromBone())},getBoneTransform:function(){var t=this.helper,e=t.allocThreeVector3(),r=t.allocThreeQuaternion();this.bone.getWorldPosition(e),this.bone.getWorldQuaternion(r);var n=t.allocTransform();t.setOriginFromThreeVector3(n,e),t.setBasisFromThreeQuaternion(n,r);var i=t.multiplyTransforms(n,this.boneOffsetForm);return t.freeTransform(n),t.freeThreeQuaternion(r),t.freeThreeVector3(e),i},getWorldTransformForBone:function(){var t=this.helper,e=t.allocTransform();this.body.getMotionState().getWorldTransform(e);var r=t.multiplyTransforms(e,this.boneOffsetFormInverse);return t.freeTransform(e),r},setTransformFromBone:function(){var t=this.helper,e=this.getBoneTransform();this.body.setCenterOfMassTransform(e),this.body.getMotionState().setWorldTransform(e),t.freeTransform(e)},setPositionFromBone:function(){var t=this.helper,e=this.getBoneTransform(),r=t.allocTransform();this.body.getMotionState().getWorldTransform(r),t.copyOrigin(r,e),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),t.freeTransform(r),t.freeTransform(e)},updateBoneRotation:function(){this.bone.updateMatrixWorld(!0);var t=this.helper,e=this.getWorldTransformForBone(),r=t.getBasis(e),n=t.allocThreeQuaternion(),i=t.allocThreeQuaternion(),o=t.allocThreeQuaternion();n.set(r.x(),r.y(),r.z(),r.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(n),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o)),t.freeThreeQuaternion(n),t.freeThreeQuaternion(i),t.freeThreeQuaternion(o),t.freeQuaternion(r),t.freeTransform(e)},updateBonePosition:function(){var t=this.helper,e=this.getWorldTransformForBone(),r=t.allocThreeVector3(),n=t.getOrigin(e);r.set(n.x(),n.y(),n.z());var i=this.bone.worldToLocal(r);this.bone.position.add(i),t.freeThreeVector3(r),t.freeTransform(e)}},rc.Constraint=function(t,e,r,n,i,o){this.mesh=t,this.world=e,this.bodyA=r,this.bodyB=n,this.params=i,this.helper=o,this.constraint=null,this.init()},rc.Constraint.prototype={constructor:rc.Constraint,init:function(){var t=this.helper,e=this.params,r=this.bodyA,n=this.bodyB,i=t.allocTransform();t.setIdentity(i),t.setOriginFromArray3(i,e.position),t.setBasisFromArray3(i,e.rotation);var o=t.allocTransform(),s=t.allocTransform();r.body.getMotionState().getWorldTransform(o),n.body.getMotionState().getWorldTransform(s);var a=t.inverseTransform(o),l=t.inverseTransform(s),c=t.multiplyTransforms(a,i),u=t.multiplyTransforms(l,i),h=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,c,u,!0),d=t.allocVector3(),p=t.allocVector3(),f=t.allocVector3(),m=t.allocVector3();d.setValue(e.translationLimitation1[0],e.translationLimitation1[1],e.translationLimitation1[2]),p.setValue(e.translationLimitation2[0],e.translationLimitation2[1],e.translationLimitation2[2]),f.setValue(e.rotationLimitation1[0],e.rotationLimitation1[1],e.rotationLimitation1[2]),m.setValue(e.rotationLimitation2[0],e.rotationLimitation2[1],e.rotationLimitation2[2]),h.setLinearLowerLimit(d),h.setLinearUpperLimit(p),h.setAngularLowerLimit(f),h.setAngularUpperLimit(m);for(var v=0;v<3;v++)0!==e.springPosition[v]&&(h.enableSpring(v,!0),h.setStiffness(v,e.springPosition[v]));for(v=0;v<3;v++)0!==e.springRotation[v]&&(h.enableSpring(v+3,!0),h.setStiffness(v+3,e.springRotation[v]));if(void 0!==h.setParam)for(v=0;v<6;v++)h.setParam(2,.475,v);this.world.addConstraint(h,!0),this.constraint=h,t.freeTransform(i),t.freeTransform(o),t.freeTransform(s),t.freeTransform(a),t.freeTransform(l),t.freeTransform(c),t.freeTransform(u),t.freeVector3(d),t.freeVector3(p),t.freeVector3(f),t.freeVector3(m)}};var nc=function(t){if(void 0===t.physics||void 0===t.geometry.rigidBodies)throw"MMDPhysicsHelper requires physics in mesh and rigidBodies in mesh.geometry.";Na.call(this),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new zl({color:new Ia(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new zl({color:new Ia(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new zl({color:new Ia(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init(),this.update()};function ic(t,e,r,n){mc.call(this,t,e,r,n)}function oc(t,e,r){mc.call(this,t,e,r)}function sc(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function ac(t,e,r,n){sc.call(this,t,e,r,n)}function lc(t,e,r,n){mc.call(this,t,e,r,n)}function cc(t,e,r,n){mc.call(this,t,e,r,n)}function uc(t,e,r,n){mc.call(this,t,e,r,n)}function hc(t,e,r,n){sc.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function dc(t,e,r,n){sc.call(this,t,e,r,n)}function pc(t,e,r,n){sc.call(this,t,e,r,n)}(nc.prototype=Object.create(Na.prototype)).constructor=nc,nc.prototype._init=function(){var t=this.root.geometry.rigidBodies;function e(t){switch(t.shapeType){case 0:return new el(t.width,16,8);case 1:return new $l(2*t.width,2*t.height,2*t.depth,8,8,8);case 2:return new function(t,e,r,n){var i=new ec(t,t,e,16,8,!0),o=new ql(new el(t,16,8,0,2*Math.PI,0,Math.PI/2)),s=new ql(new el(t,16,8,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,e/2,0),s.position.set(0,-e/2,0),o.updateMatrix(),s.updateMatrix(),i.merge(o.geometry,o.matrix),i.merge(s.geometry,s.matrix),i}(t.width,t.height,16,8);default:return null}}for(var r=0,n=t.length;r<n;r++){var i=t[r];this.add(new ql(e(i),this.materials[i.type]))}},nc.prototype.update=function(){var t=(u=this.root).geometry.rigidBodies,e=u.physics.bodies,r=(new Sa).getInverse(u.matrixWorld),n=new Ta,i=new Ma,o=new Ma;function s(t){return n.set(t.x(),t.y(),t.z()),n.applyMatrix4(r),n}function a(t){return i.set(t.x(),t.y(),t.z(),t.w()),o.setFromRotationMatrix(r),o.multiply(i),o}for(var l=0,c=t.length;l<c;l++){var u=this.children[l],h=e[l].body.getCenterOfMassTransform();u.position.copy(s(h.getOrigin())),u.quaternion.copy(a(h.getRotation()))}},ic.prototype=Object.assign(Object.create(mc.prototype),{constructor:ic,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ll,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),oc.prototype=Object.assign(Object.create(mc.prototype),{constructor:oc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ll,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(sc.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var s=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===s)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var a=e[1];for(t<a&&(r=2,i=a),s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===s)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var l=r+o>>>1;t<e[l]?o=l:r=l+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(sc.prototype,{beforeStart_:sc.prototype.copySampleValue_,afterEnd_:sc.prototype.copySampleValue_}),ac.prototype=Object.assign(Object.create(sc.prototype),{constructor:ac,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=(r-e)/(n-e),c=a+s;a!==c;a+=4)Ma.slerpFlat(i,0,o,a-s,o,a,l);return i}}),lc.prototype=Object.assign(Object.create(mc.prototype),{constructor:lc,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new ac(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),cc.prototype=Object.assign(Object.create(mc.prototype),{constructor:cc,ValueTypeName:"color"}),uc.prototype=Object.assign(Object.create(mc.prototype),{constructor:uc,ValueTypeName:"vector"}),hc.prototype=Object.assign(Object.create(sc.prototype),{constructor:hc,DefaultSettings_:{endingStart:Il,endingEnd:Il},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,s=n[i],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:i=t,s=2*e-r;break;case 2402:s=e+n[i=n.length-2]-n[i+1];break;default:i=t,s=r}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=t,a=2*r-e;break;case 2402:o=1,a=r+n[1]-n[0];break;default:o=t-1,a=e}var l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(a-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(n-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==s;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[a+b]+x*o[u+b];return i}}),dc.prototype=Object.assign(Object.create(sc.prototype),{constructor:dc,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=(r-e)/(n-e),u=1-c,h=0;h!==s;++h)i[h]=o[l+h]*u+o[a+h]*c;return i}}),pc.prototype=Object.assign(Object.create(sc.prototype),{constructor:pc,interpolate_:function(t){return this.copySampleValue_(t-1)}});var fc={arraySlice:function(t,e,r){return fc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,s=0;s!==n;++o)for(var a=r[o]*e,l=0;l!==e;++l)i[s++]=t[a+l];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(e.push(o.time),r.push.apply(r,s)),o=t[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(e.push(o.time),s.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(e.push(o.time),r.push(s)),o=t[i++]}while(void 0!==o)}}};function mc(t,e,r,n){if(void 0===t)throw new Error("KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fc.convertArray(e,this.TimeBufferType),this.values=fc.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function vc(t,e,r,n){mc.call(this,t,e,r,n)}function gc(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=_a.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}Object.assign(mc,{parse:function(t){if(void 0===t.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var e=mc._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var r=[],n=[];fc.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:fc.convertArray(t.times,Array),values:fc.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return vc;case"vector":case"vector2":case"vector3":case"vector4":return uc;case"color":return cc;case"quaternion":return lc;case"bool":case"boolean":return oc;case"string":return ic}throw new Error("KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(mc.prototype,{constructor:mc,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new pc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new dc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new hc(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Ll:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("KeyframeTrack:",r)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ll;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=fc.arraySlice(r,i,o),this.values=fc.arraySlice(this.values,i*s,o*s)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,s=0;s!==i;s++){var a=r[s];if("number"==typeof a&&isNaN(a)){console.error("KeyframeTrack: Time is not a valid number.",this,s,a),t=!1;break}if(null!==o&&o>a){console.error("KeyframeTrack: Out of order keys.",this,s,a,o),t=!1;break}o=a}if(void 0!==n&&fc.isTypedArray(n)){s=0;for(var l=n.length;s!==l;++s){var c=n[s];if(isNaN(c)){console.error("KeyframeTrack: Value is not a valid number.",this,s,c),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=t.length-1,s=1;s<o;++s){var a=!1,l=t[s];if(l!==t[s+1]&&(1!==s||l!==l[0]))if(n)a=!0;else for(var c=s*r,u=c-r,h=c+r,d=0;d!==r;++d){var p=e[c+d];if(p!==e[u+d]||p!==e[h+d]){a=!0;break}}if(a){if(s!==i){t[i]=t[s];var f=s*r,m=i*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++i}}if(o>0){for(t[i]=t[o],f=o*r,m=i*r,d=0;d!==r;++d)e[m+d]=e[f+d];++i}return i!==t.length&&(this.times=fc.arraySlice(t,0,i),this.values=fc.arraySlice(e,0,i*r)),this}}),vc.prototype=Object.assign(Object.create(mc.prototype),{constructor:vc,ValueTypeName:"number"}),Object.assign(gc,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(mc.parse(r[i]).scale(n));return new gc(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e},i=0,o=r.length;i!==o;++i)e.push(mc.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],s=0;s<i;s++){var a=[],l=[];a.push((s+i-1)%i,s,(s+1)%i),l.push(0,1,0);var c=fc.getKeyframeOrder(a);a=fc.sortedArray(a,1,c),l=fc.sortedArray(l,1,c),n||0!==a[0]||(a.push(i),l.push(l[0])),o.push(new vc(".morphTargetInfluences["+e[s].name+"]",a,l).scale(1/r))}return new gc(t,-1,o)},findByName:function(t,e){var r=t;Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,s=t.length;o<s;o++){var a=t[o],l=a.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(a)}}var u=[];for(var h in n)u.push(gc.CreateFromMorphTargetSequence(h,n[h],e,r));return u},parseAnimation:function(t,e){if(!t)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],s=[];fc.flattenJSON(r,o,s,n),0!==o.length&&i.push(new t(e,o,s))}},n=[],i=t.name||"default",o=t.length||-1,s=t.fps||30,a=t.hierarchy||[],l=0;l<a.length;l++){var c=a[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new vc(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(s||1)}else{var g=".bones["+e[l].name+"]";r(uc,g+".position",c,"pos",n),r(lc,g+".quaternion",c,"rot",n),r(uc,g+".scale",c,"scl",n)}}return 0===n.length?null:new gc(i,o,n)}}),Object.assign(gc.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}});var yc=function(){};function xc(){Na.call(this),this.type="Camera",this.matrixWorldInverse=new Sa,this.projectionMatrix=new Sa}function bc(t,e,r,n){xc.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function wc(t){jl.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ul,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function _c(){Na.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Sc(t,e,r,n,i,o){xc.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}yc.CreateRotationAnimation=function(t,e){return new gc(null,t,[new vc(".rotation["+(e=e||"x")+"]",[0,t],[0,360])])},yc.CreateScaleAxisAnimation=function(t,e){return new gc(null,t,[new vc(".scale["+(e=e||"x")+"]",[0,t],[0,1])])},yc.CreateShakeAnimation=function(t,e){for(var r=[],n=[],i=new Ta,o=0;o<10*t;o++)r.push(o/10),i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(e).toArray(n,n.length);return new gc(null,t,[new uc(".position",r,n)])},yc.CreatePulsationAnimation=function(t,e){for(var r=[],n=[],i=new Ta,o=0;o<10*t;o++){r.push(o/10);var s=Math.random()*e;i.set(s,s,s).toArray(n,n.length)}return new gc(null,t,[new uc(".scale",r,n)])},yc.CreateVisibilityAnimation=function(t){return new gc(null,t,[new oc(".visible",[0,t/2,t],[!0,!1,!0])])},yc.CreateMaterialColorAnimation=function(t,e){for(var r=[],n=[],i=t/e.length,o=0;o<=e.length;o++)r.push(o*i),n.push(e[o%e.length]);return new gc(null,t,[new cc(".material[0].color",r,n)])},xc.prototype=Object.assign(Object.create(Na.prototype),{constructor:xc,isCamera:!0,copy:function(t,e){return Na.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new Ma;return function(e){return void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new Ta),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){Na.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),bc.prototype=Object.assign(Object.create(xc.prototype),{constructor:bc,isPerspectiveCamera:!0,copy:function(t,e){return xc.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*_a.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*_a.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*_a.RAD2DEG*Math.atan(Math.tan(.5*_a.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*_a.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;i+=o.offsetX*n/s,e-=o.offsetY*r/a,n*=o.width/s,r*=o.height/a}var l=this.filmOffset;0!==l&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far)},toJSON:function(t){var e=Na.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),(wc.prototype=Object.create(jl.prototype)).constructor=wc,wc.prototype.isMeshDepthMaterial=!0,wc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},_c.prototype=Object.assign(Object.create(Na.prototype),{constructor:_c,copy:function(t,e){return Na.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Na.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),Sc.prototype=Object.assign(Object.create(xc.prototype),{constructor:Sc,isOrthographicCamera:!0,copy:function(t,e){return xc.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,s=n+e,a=n-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=u*(this.view.offsetX/l))+u*(this.view.width/l),a=(s-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far)},toJSON:function(t){var e=Na.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}});var Tc=0;function Mc(t,e,r,n,i,o,s,a,l,c){Object.defineProperty(this,"id",{value:Tc++}),this.uuid=_a.generateUUID(),this.name="",this.image=void 0!==t?t:Mc.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Mc.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:yl,this.wrapT=void 0!==n?n:yl,this.magFilter=void 0!==i?i:wl,this.minFilter=void 0!==o?o:_l,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:El,this.type=void 0!==a?a:Sl,this.offset=new ka(0,0),this.repeat=new ka(1,1),this.center=new ka(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pa,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:kl,this.version=0,this.onUpdate=null}function Ac(t,e,r){this.width=t,this.height=e,this.scissor=new ja(0,0,t,e),this.scissorTest=!1,this.viewport=new ja(0,0,t,e),void 0===(r=r||{}).minFilter&&(r.minFilter=wl),this.texture=new Mc(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}Mc.DEFAULT_IMAGE=void 0,Mc.DEFAULT_MAPPING=300,Mc.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Mc,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=_a.generateUUID()),e||void 0!==t.images[n.uuid]||(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var r=e.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case gl:t.x=t.x-Math.floor(t.x);break;case yl:t.x=t.x<0?0:1;break;case xl:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case gl:t.y=t.y-Math.floor(t.y);break;case yl:t.y=t.y<0?0:1;break;case xl:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(Mc.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Ac.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ac,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ec={merge:function(t){for(var e={},r=0;r<t.length;r++){var n=this.clone(t[r]);for(var i in n)e[i]=n[i]}return e},clone:function(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];e[r][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}};function Cc(t){jl.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(t))}function Pc(t,e,r,n){Ba.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Oc(t,e,r,n)),this.mergeVertices()}function Oc(t,e,r,n){$a.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,s=(t=t||1)/2,a=(e=e||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=t/l,p=e/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*p-a;for(i=0;i<u;i++)m.push(i*d-s,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}for(o=0;o<c;o++)for(i=0;i<l;i++){var x=i+u*(o+1),b=i+1+u*(o+1),w=i+1+u*o;f.push(i+u*o,x,w),f.push(x,b,w)}this.setIndex(f),this.addAttribute("position",new Za(m,3)),this.addAttribute("normal",new Za(v,3)),this.addAttribute("uv",new Za(g,2))}(Cc.prototype=Object.create(jl.prototype)).constructor=Cc,Cc.prototype.isShaderMaterial=!0,Cc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ec.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Cc.prototype.toJSON=function(t){var e=jl.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},(Pc.prototype=Object.create(Ba.prototype)).constructor=Pc,(Oc.prototype=Object.create($a.prototype)).constructor=Oc;var Nc={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},Lc=function(t,e,r,n){bc.call(this,t,e,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4},this.material_depth=new wc,this.setLens(),this.initPostProcessing()};(Lc.prototype=Object.create(bc.prototype)).constructor=Lc,Lc.prototype.setLens=function(t,e,r,n){void 0===t&&(t=35),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=t/this.fNumber,this.hyperFocal=t*t/(this.aperture*this.coc)},Lc.prototype.linearize=function(t){var e=this.far,r=this.near;return-e*r/(t*(e-r)-e)},Lc.prototype.smoothstep=function(t,e,r){var n=this.saturate((r-t)/(e-t));return n*n*(3-2*n)},Lc.prototype.saturate=function(t){return Math.max(0,Math.min(1,t))},Lc.prototype.focusAt=function(t){void 0===t&&(t=20);var e=this.getFocalLength();this.focus=t,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-e)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-e)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},Lc.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new _c,this.postprocessing.camera=new Sc(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var t={minFilter:wl,magFilter:wl,format:Al};this.postprocessing.rtTextureDepth=new Ac(window.innerWidth,window.innerHeight,t),this.postprocessing.rtTextureColor=new Ac(window.innerWidth,window.innerHeight,t);var e=Nc;this.postprocessing.bokeh_uniforms=Ec.clone(e.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new Cc({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}}),this.postprocessing.quad=new ql(new Oc(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},Lc.prototype.renderCinematic=function(t,e){this.postprocessing.enabled&&(e.clear(),t.overrideMaterial=null,e.render(t,camera,this.postprocessing.rtTextureColor,!0),t.overrideMaterial=this.material_depth,e.render(t,camera,this.postprocessing.rtTextureDepth,!0),e.render(this.postprocessing.scene,this.postprocessing.camera))};var Ic={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Rc(t,e,r){var n=this,i=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){s++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,s),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,s),o===s&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this}}var Dc=new Rc,Fc={};function kc(t){this.manager=void 0!==t?t:Dc}function Uc(t){Vl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Bc(t){jl.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ta,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function jc(t){jl.call(this),this.type="MeshLambertMaterial",this.color=new Ia(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ia(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function zc(t){jl.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Vc(t){jl.call(this),this.type="MeshPhongMaterial",this.color=new Ia(16777215),this.specular=new Ia(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ia(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Gc(t){jl.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ia(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ia(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Hc(t){Gc.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function Wc(t){Vc.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Xc(t){jl.call(this),this.type="PointsMaterial",this.color=new Ia(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function qc(t){Cc.call(this,t),this.type="RawShaderMaterial"}function Yc(t){jl.call(this),this.type="ShadowMaterial",this.color=new Ia(0),this.transparent=!0,this.setValues(t)}function Zc(t){jl.call(this),this.type="SpriteMaterial",this.color=new Ia(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Jc(t){this.manager=void 0!==t?t:Dc,this.textures={}}function Qc(t){this.manager=void 0!==t?t:Dc}function Kc(t){this.manager=void 0!==t?t:Dc}function $c(){}Object.assign(kc.prototype,{load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ic.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===Fc[t]){var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:a}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,a);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){e&&e(u),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{Fc[t]=[],Fc[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;Ic.add(t,r);var n=Fc[t];if(delete Fc[t],200===this.status){for(var o=0,s=n.length;o<s;o++)(a=n[o]).onLoad&&a.onLoad(r);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("FileLoader: HTTP Status 0 received."),o=0,s=n.length;o<s;o++)(a=n[o]).onLoad&&a.onLoad(r);i.manager.itemEnd(t)}else{for(o=0,s=n.length;o<s;o++){var a;(a=n[o]).onError&&a.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)}},!1),m.addEventListener("progress",function(e){for(var r=Fc[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Fc[t];delete Fc[t];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(e)}i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}Fc[t].push({onLoad:e,onProgress:r,onError:n})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),(Uc.prototype=Object.create(Vl.prototype)).constructor=Uc,Uc.prototype.isLineDashedMaterial=!0,Uc.prototype.copy=function(t){return Vl.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},(Bc.prototype=Object.create(jl.prototype)).constructor=Bc,Bc.prototype.isMeshDistanceMaterial=!0,Bc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},(jc.prototype=Object.create(jl.prototype)).constructor=jc,jc.prototype.isMeshLambertMaterial=!0,jc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(zc.prototype=Object.create(jl.prototype)).constructor=zc,zc.prototype.isMeshNormalMaterial=!0,zc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Vc.prototype=Object.create(jl.prototype)).constructor=Vc,Vc.prototype.isMeshPhongMaterial=!0,Vc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Gc.prototype=Object.create(jl.prototype)).constructor=Gc,Gc.prototype.isMeshStandardMaterial=!0,Gc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(Hc.prototype=Object.create(Gc.prototype)).constructor=Hc,Hc.prototype.isMeshPhysicalMaterial=!0,Hc.prototype.copy=function(t){return Gc.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(Wc.prototype=Object.create(Vc.prototype)).constructor=Wc,Wc.prototype.isMeshToonMaterial=!0,Wc.prototype.copy=function(t){return Vc.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(Xc.prototype=Object.create(jl.prototype)).constructor=Xc,Xc.prototype.isPointsMaterial=!0,Xc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},(qc.prototype=Object.create(Cc.prototype)).constructor=qc,qc.prototype.isRawShaderMaterial=!0,(Yc.prototype=Object.create(jl.prototype)).constructor=Yc,Yc.prototype.isShadowMaterial=!0,Yc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this},(Zc.prototype=Object.create(jl.prototype)).constructor=Zc,Zc.prototype.isSpriteMaterial=!0,Zc.prototype.copy=function(t){return jl.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Object.assign(Jc.prototype,{load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("MaterialLoader: Undefined texture",t),e[t]}var n=new{LineBasicMaterial:Vl,LineDashedMaterial:Uc,MeshBasicMaterial:zl,MeshDepthMaterial:wc,MeshDistanceMaterial:Bc,MeshLambertMaterial:jc,MeshNormalMaterial:zc,MeshPhongMaterial:Vc,MeshPhysicalMaterial:Hc,MeshStandardMaterial:Gc,MeshToonMaterial:Wc,PointsMaterial:Xc,RawShaderMaterial:qc,ShaderMaterial:Cc,ShadowMaterial:Yc,SpriteMaterial:Zc}[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new ka).fromArray(i)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),n}}),Object.assign(Qc.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ic.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){Ic.add(t,this),e&&e(this),i.manager.itemEnd(t)},!1),s.addEventListener("error",function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Kc.prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new Mc,o=new Qc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){i.image=r;var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?Al:El,i.needsUpdate=!0,void 0!==e&&e(i)},r,n),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),$c.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,n=e.length;r<n;r+=2){var i=e[r+1];if(e[r].test(t))return i}return null}},Object.assign($c.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:function(){var t={NoBlending:0,NormalBlending:ll,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},e=new Ia,r=new Kc,n=new Jc;return function(i,o,s){var a={};function l(t,e,n,i,l){var c,u=o+t,h=$c.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(s),c=r.load(u)),void 0!==e&&(c.repeat.fromArray(e),1!==e[0]&&(c.wrapS=gl),1!==e[1]&&(c.wrapT=gl)),void 0!==n&&c.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(c.wrapS=gl),"mirror"===i[0]&&(c.wrapS=xl),"repeat"===i[1]&&(c.wrapT=gl),"mirror"===i[1]&&(c.wrapT=xl)),void 0!==l&&(c.anisotropy=l);var d=_a.generateUUID();return a[d]=c,d}var c={uuid:_a.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var h=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=t[h];break;case"colorAmbient":case"mapAmbient":console.warn("Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(h).getHex();break;case"colorSpecular":c.specular=e.fromArray(h).getHex();break;case"colorEmissive":c.emissive=e.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=nl;break;case"doubleSided":c.side=il;break;case"transparency":console.warn("Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=al),"face"===h&&(c.vertexColors=sl);break;default:console.error("Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(a),n.parse(c)}}()});var tu={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function eu(t){"boolean"==typeof t&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Dc,this.withCredentials=!1}Object.assign(eu.prototype,{load:function(t,e,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:tu.extractUrlBase(t),s=new kc(this.manager);s.setWithCredentials(this.withCredentials),s.load(t,function(r){var n=JSON.parse(r),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("JSONLoader: "+t+" should be loaded with ObjectLoader instead.")}var l=i.parse(n,o);e(l.geometry,l.materials)},r,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var r=new Ba;return function(t,e){function r(t,e){return t&1<<e}var n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C=t.faces,P=t.vertices,O=t.normals,N=t.colors,L=t.scale,I=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&I++;for(n=0;n<I;n++)e.faceVertexUvs[n]=[]}for(s=0,a=P.length;s<a;)(b=new Ta).x=P[s++]*L,b.y=P[s++]*L,b.z=P[s++]*L,e.vertices.push(b);for(s=0,a=C.length;s<a;)if(p=r(d=C[s++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),x=r(d,7),p){if((_=new Ra).a=C[s],_.b=C[s+1],_.c=C[s+3],(S=new Ra).a=C[s+1],S.b=C[s+2],S.c=C[s+3],s+=4,f&&(h=C[s++],_.materialIndex=h,S.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],e.faceVertexUvs[n][o+1]=[],i=0;i<4;i++)E=new ka(A[2*(u=C[s++])],A[2*u+1]),2!==i&&e.faceVertexUvs[n][o].push(E),0!==i&&e.faceVertexUvs[n][o+1].push(E);if(v&&(c=3*C[s++],_.normal.set(O[c++],O[c++],O[c]),S.normal.copy(_.normal)),g)for(n=0;n<4;n++)c=3*C[s++],M=new Ta(O[c++],O[c++],O[c]),2!==n&&_.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(y&&(l=C[s++],_.color.setHex(T=N[l]),S.color.setHex(T)),x)for(n=0;n<4;n++)T=N[l=C[s++]],2!==n&&_.vertexColors.push(new Ia(T)),0!==n&&S.vertexColors.push(new Ia(T));e.faces.push(_),e.faces.push(S)}else{if((w=new Ra).a=C[s++],w.b=C[s++],w.c=C[s++],f&&(h=C[s++],w.materialIndex=h),o=e.faces.length,m)for(n=0;n<I;n++)for(A=t.uvs[n],e.faceVertexUvs[n][o]=[],i=0;i<3;i++)E=new ka(A[2*(u=C[s++])],A[2*u+1]),e.faceVertexUvs[n][o].push(E);if(v&&(c=3*C[s++],w.normal.set(O[c++],O[c++],O[c])),g)for(n=0;n<3;n++)c=3*C[s++],M=new Ta(O[c++],O[c++],O[c]),w.vertexNormals.push(M);if(y&&(l=C[s++],w.color.setHex(N[l])),x)for(n=0;n<3;n++)l=C[s++],w.vertexColors.push(new Ia(N[l]));e.faces.push(w)}}(t,r),function(t,e){var r=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,i=t.skinWeights.length;n<i;n+=r)e.skinWeights.push(new ja(t.skinWeights[n],r>1?t.skinWeights[n+1]:0,r>2?t.skinWeights[n+2]:0,r>3?t.skinWeights[n+3]:0));if(t.skinIndices)for(n=0,i=t.skinIndices.length;n<i;n+=r)e.skinIndices.push(new ja(t.skinIndices[n],r>1?t.skinIndices[n+1]:0,r>2?t.skinIndices[n+2]:0,r>3?t.skinIndices[n+3]:0));e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,r),function(t,e){var r=t.scale;if(void 0!==t.morphTargets)for(var n=0,i=t.morphTargets.length;n<i;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var o=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,a=0,l=s.length;a<l;a+=3){var c=new Ta;c.x=s[a]*r,c.y=s[a+1]*r,c.z=s[a+2]*r,o.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=e.faces,h=t.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(t,r),function(t,e){var r=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var i=0;i<n.length;i++){var o=gc.parseAnimation(n[i],e.bones);o&&r.push(o)}if(e.morphTargets){var s=gc.CreateClipsFromMorphTargetSequences(e.morphTargets,10);r=r.concat(s)}r.length>0&&(e.animations=r)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:$c.prototype.initMaterials(t.materials,e,this.crossOrigin)}}});var ru=function(t){"boolean"==typeof t&&(console.warn("BinaryLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Dc};function nu(t,e,r,n){this.ray=new Gl(t,e),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function iu(t,e){return t.distance-e.distance}function ou(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,o=0,s=i.length;o<s;o++)ou(i[o],e,r,!0)}ru.prototype={constructor:ru,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this.texturePath||tu.extractUrlBase(t),o=this.binaryPath||tu.extractUrlBase(t),s=this;new kc(this.manager).load(t,function(t){var a=JSON.parse(t),l=o+a.buffers,c=new kc(s.manager);c.setResponseType("arraybuffer"),c.load(l,function(t){s.parse(t,e,i,a.materials)},r,n)},r,n)},setBinaryPath:function(t){this.binaryPath=t},setCrossOrigin:function(t){this.crossOrigin=t},setTexturePath:function(t){this.texturePath=t},parse:function(t,e,r,n){var i=function(){var e,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x=this,b=0,w=[],_=[];function S(t){return t%4?4-t%4:0}function T(t,e){return new Uint8Array(t,e,1)[0]}function M(t,e){return new Uint32Array(t,e,1)[0]}function A(e,r){var n,i,o,s,a,l,c,u,h=new Uint32Array(t,r,3*e);for(n=0;n<e;n++)a=_[2*(o=h[3*n+1])],c=_[2*o+1],l=_[2*(s=h[3*n+2])],u=_[2*s+1],x.faceVertexUvs[0].push([new ka(_[2*(i=h[3*n])],_[2*i+1]),new ka(a,c),new ka(l,u)])}function E(e,r){var n,i,o,s,a,l,c,u,h,d,p,f=new Uint32Array(t,r,4*e);for(n=0;n<e;n++)l=_[2*(o=f[4*n+1])],h=_[2*o+1],c=_[2*(s=f[4*n+2])],d=_[2*s+1],u=_[2*(a=f[4*n+3])],p=_[2*a+1],x.faceVertexUvs[0].push([new ka(_[2*(i=f[4*n])],_[2*i+1]),new ka(l,h),new ka(u,p)]),x.faceVertexUvs[0].push([new ka(l,h),new ka(c,d),new ka(u,p)])}function C(e,r,n){var i,o=new Uint32Array(t,r,3*e),s=new Uint16Array(t,n,e);for(i=0;i<e;i++)x.faces.push(new Ra(o[3*i],o[3*i+1],o[3*i+2],null,null,s[i]))}function P(e,r,n){var i,o,s,a,l,c=new Uint32Array(t,r,4*e),u=new Uint16Array(t,n,e);for(i=0;i<e;i++)s=c[4*i+2],x.faces.push(new Ra(c[4*i],o=c[4*i+1],a=c[4*i+3],null,null,l=u[i])),x.faces.push(new Ra(o,s,a,null,null,l))}function O(e,r,n,i){var o,s,a,l,c,u=new Uint32Array(t,r,3*e),h=new Uint32Array(t,n,3*e),d=new Uint16Array(t,i,e);for(o=0;o<e;o++){s=d[o];var p=w[3*(l=h[3*o+1])],f=w[3*l+1],m=w[3*l+2],v=w[3*(c=h[3*o+2])],g=w[3*c+1],y=w[3*c+2];x.faces.push(new Ra(u[3*o],u[3*o+1],u[3*o+2],[new Ta(w[3*(a=h[3*o])],w[3*a+1],w[3*a+2]),new Ta(p,f,m),new Ta(v,g,y)],null,s))}}function N(e,r,n,i){var o,s,a,l,c,u,h,d,p,f=new Uint32Array(t,r,4*e),m=new Uint32Array(t,n,4*e),v=new Uint16Array(t,i,e);for(o=0;o<e;o++){a=f[4*o+2],c=v[o];var g=w[3*(h=m[4*o+1])],y=w[3*h+1],b=w[3*h+2],_=w[3*(d=m[4*o+2])],S=w[3*d+1],T=w[3*d+2],M=w[3*(p=m[4*o+3])],A=w[3*p+1],E=w[3*p+2];x.faces.push(new Ra(f[4*o],s=f[4*o+1],l=f[4*o+3],[new Ta(w[3*(u=m[4*o])],w[3*u+1],w[3*u+2]),new Ta(g,y,b),new Ta(M,A,E)],null,c)),x.faces.push(new Ra(s,a,l,[new Ta(g,y,b),new Ta(_,S,T),new Ta(M,A,E)],null,c))}}Ba.call(this),b+=(e=function(t,e){return{signature:function(t,e,r){return tu.decodeText(new Uint8Array(t,e,12))}(t,e),header_bytes:T(t,e+12),vertex_coordinate_bytes:T(t,e+13),normal_coordinate_bytes:T(t,e+14),uv_coordinate_bytes:T(t,e+15),vertex_index_bytes:T(t,e+16),normal_index_bytes:T(t,e+17),uv_index_bytes:T(t,e+18),material_index_bytes:T(t,e+19),nvertices:M(t,e+20),nnormals:M(t,e+20+4),nuvs:M(t,e+20+8),ntri_flat:M(t,e+20+12),ntri_smooth:M(t,e+20+16),ntri_flat_uv:M(t,e+20+20),ntri_smooth_uv:M(t,e+20+24),nquad_flat:M(t,e+20+28),nquad_smooth:M(t,e+20+32),nquad_flat_uv:M(t,e+20+36),nquad_smooth_uv:M(t,e+20+40)}}(t,b)).header_bytes,d=e.ntri_flat*(u=3*e.vertex_index_bytes+e.material_index_bytes),p=e.ntri_smooth*(u+3*e.normal_index_bytes),f=e.ntri_flat_uv*(u+3*e.uv_index_bytes),m=e.ntri_smooth_uv*(u+3*e.normal_index_bytes+3*e.uv_index_bytes),v=e.nquad_flat*(h=4*e.vertex_index_bytes+e.material_index_bytes),g=e.nquad_smooth*(h+4*e.normal_index_bytes),y=e.nquad_flat_uv*(h+4*e.uv_index_bytes),b+=function(r){var n,i=e.nvertices,o=new Float32Array(t,b,3*i);for(n=0;n<i;n++)x.vertices.push(new Ta(o[3*n],o[3*n+1],o[3*n+2]));return 3*i*Float32Array.BYTES_PER_ELEMENT}(),b+=function(r){var n=e.nnormals;if(n){var i,o=new Int8Array(t,b,3*n);for(i=0;i<n;i++)w.push(o[3*i]/127,o[3*i+1]/127,o[3*i+2]/127)}return 3*n*Int8Array.BYTES_PER_ELEMENT}(),b+=S(3*e.nnormals),c=(l=(a=(s=(o=(i=(n=(r=b+=function(r){var n=e.nuvs;if(n){var i,o=new Float32Array(t,b,2*n);for(i=0;i<n;i++)_.push(o[2*i],o[2*i+1])}return 2*n*Float32Array.BYTES_PER_ELEMENT}())+d+S(2*e.ntri_flat))+p+S(2*e.ntri_smooth))+f+S(2*e.ntri_flat_uv))+m+S(2*e.ntri_smooth_uv))+v+S(2*e.nquad_flat))+g+S(2*e.nquad_smooth))+y+S(2*e.nquad_flat_uv),function(t){var r=e.ntri_flat_uv;if(r){var n=i+r*Uint32Array.BYTES_PER_ELEMENT*3;C(r,i,n+r*Uint32Array.BYTES_PER_ELEMENT*3),A(r,n)}}(),function(t){var r=e.ntri_smooth_uv;if(r){var n=o+r*Uint32Array.BYTES_PER_ELEMENT*3,i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,o,n,i+r*Uint32Array.BYTES_PER_ELEMENT*3),A(r,i)}}(),function(t){var r=e.nquad_flat_uv;if(r){var n=l+r*Uint32Array.BYTES_PER_ELEMENT*4;P(r,l,n+r*Uint32Array.BYTES_PER_ELEMENT*4),E(r,n)}}(),function(t){var r=e.nquad_smooth_uv;if(r){var n=c+r*Uint32Array.BYTES_PER_ELEMENT*4,i=n+r*Uint32Array.BYTES_PER_ELEMENT*4;N(r,c,n,i+r*Uint32Array.BYTES_PER_ELEMENT*4),E(r,i)}}(),function(t){var n=e.ntri_flat;n&&C(n,r,r+n*Uint32Array.BYTES_PER_ELEMENT*3)}(),function(t){var r=e.ntri_smooth;if(r){var i=n+r*Uint32Array.BYTES_PER_ELEMENT*3;O(r,n,i,i+r*Uint32Array.BYTES_PER_ELEMENT*3)}}(),function(t){var r=e.nquad_flat;r&&P(r,s,s+r*Uint32Array.BYTES_PER_ELEMENT*4)}(),function(t){var r=e.nquad_smooth;if(r){var n=a+r*Uint32Array.BYTES_PER_ELEMENT*4;N(r,a,n,n+r*Uint32Array.BYTES_PER_ELEMENT*4)}}(),this.computeFaceNormals()};(i.prototype=Object.create(Ba.prototype)).constructor=i,e(new i,$c.prototype.initMaterials(n,r,this.crossOrigin))}},Object.assign(nu.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return ou(t,this,n,e),n.sort(iu),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)ou(t[i],this,n,e);return n.sort(iu),n}});var su=function(t,e,r){if(t instanceof xc){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var n=t;t=e,e=n}var i=new Wl,o=new nu,s=new ka,a=new Ta,l=new Ta,c=null,u=null,h=this;function d(){r.addEventListener("mousemove",f,!1),r.addEventListener("mousedown",m,!1),r.addEventListener("mouseup",v,!1),r.addEventListener("mouseleave",v,!1),r.addEventListener("touchmove",g,!1),r.addEventListener("touchstart",y,!1),r.addEventListener("touchend",x,!1)}function p(){r.removeEventListener("mousemove",f,!1),r.removeEventListener("mousedown",m,!1),r.removeEventListener("mouseup",v,!1),r.removeEventListener("mouseleave",v,!1),r.removeEventListener("touchmove",g,!1),r.removeEventListener("touchstart",y,!1),r.removeEventListener("touchend",x,!1)}function f(n){n.preventDefault();var d=r.getBoundingClientRect();if(s.x=(n.clientX-d.left)/d.width*2-1,s.y=-(n.clientY-d.top)/d.height*2+1,o.setFromCamera(s,e),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(a)),void h.dispatchEvent({type:"drag",object:c});o.setFromCamera(s,e);var p=o.intersectObjects(t);if(p.length>0){var f=p[0].object;i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),f.position),u!==f&&(h.dispatchEvent({type:"hoveron",object:f}),r.style.cursor="pointer",u=f)}else null!==u&&(h.dispatchEvent({type:"hoveroff",object:u}),r.style.cursor="auto",u=null)}function m(n){n.preventDefault(),o.setFromCamera(s,e);var u=o.intersectObjects(t);u.length>0&&(c=u[0].object,o.ray.intersectPlane(i,l)&&a.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function v(t){t.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}function g(t){t.preventDefault(),t=t.changedTouches[0];var n=r.getBoundingClientRect();if(s.x=(t.clientX-n.left)/n.width*2-1,s.y=-(t.clientY-n.top)/n.height*2+1,o.setFromCamera(s,e),c&&h.enabled)return o.ray.intersectPlane(i,l)&&c.position.copy(l.sub(a)),void h.dispatchEvent({type:"drag",object:c})}function y(n){n.preventDefault(),n=n.changedTouches[0];var u=r.getBoundingClientRect();s.x=(n.clientX-u.left)/u.width*2-1,s.y=-(n.clientY-u.top)/u.height*2+1,o.setFromCamera(s,e);var d=o.intersectObjects(t);d.length>0&&(c=d[0].object,i.setFromNormalAndCoplanarPoint(e.getWorldDirection(i.normal),c.position),o.ray.intersectPlane(i,l)&&a.copy(l).sub(c.position),r.style.cursor="move",h.dispatchEvent({type:"dragstart",object:c}))}function x(t){t.preventDefault(),c&&(h.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=p,this.dispose=function(){p()},this.setObjects=function(){console.error("DragControls: setObjects() has been removed.")},this.on=function(t,e){console.warn("DragControls: on() has been deprecated. Use addEventListener() instead."),h.addEventListener(t,e)},this.off=function(t,e){console.warn("DragControls: off() has been deprecated. Use removeEventListener() instead."),h.removeEventListener(t,e)},this.notify=function(t){console.error("DragControls: notify() has been deprecated. Use dispatchEvent() instead."),h.dispatchEvent({type:t})}};function au(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}(su.prototype=Object.create(Aa.prototype)).constructor=su,Object.assign(au.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(_a.clamp(t.y/this.radius,-1,1))),this}});var lu=function(t,e){e=void 0!==e?e:document,this.enabled=!0,this.center=new Ta,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var r=this,n=new Ta,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},o=i.NONE,s=this.center,a=new Pa,l=new ka,c=new ka,u=new au,h={type:"change"};function d(t){!1!==r.enabled&&(0===t.button?o=i.ROTATE:1===t.button?o=i.ZOOM:2===t.button&&(o=i.PAN),c.set(t.clientX,t.clientY),e.addEventListener("mousemove",p,!1),e.addEventListener("mouseup",f,!1),e.addEventListener("mouseout",f,!1),e.addEventListener("dblclick",f,!1))}function p(t){if(!1!==r.enabled){l.set(t.clientX,t.clientY);var e=l.x-c.x,n=l.y-c.y;o===i.ROTATE?r.rotate(new Ta(-e*r.rotationSpeed,-n*r.rotationSpeed,0)):o===i.ZOOM?r.zoom(new Ta(0,0,n)):o===i.PAN&&r.pan(new Ta(-e,n,0)),c.set(t.clientX,t.clientY)}}function f(t){e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),o=i.NONE}function m(t){t.preventDefault(),r.zoom(new Ta(0,0,t.deltaY))}function v(t){t.preventDefault()}this.focus=function(e){var n,i=(new Da).setFromObject(e);!1===i.isEmpty()?(s.copy(i.getCenter()),n=i.getBoundingSphere().radius):(s.setFromMatrixPosition(e.matrixWorld),n=.1);var o=new Ta(0,0,1);o.applyQuaternion(t.quaternion),o.multiplyScalar(4*n),t.position.copy(s).add(o),r.dispatchEvent(h)},this.pan=function(e){var n=t.position.distanceTo(s);e.multiplyScalar(n*r.panSpeed),e.applyMatrix3(a.getNormalMatrix(t.matrix)),t.position.add(e),s.add(e),r.dispatchEvent(h)},this.zoom=function(e){var n=t.position.distanceTo(s);e.multiplyScalar(n*r.zoomSpeed),e.length()>n||(e.applyMatrix3(a.getNormalMatrix(t.matrix)),t.position.add(e),r.dispatchEvent(h))},this.rotate=function(e){n.copy(t.position).sub(s),u.setFromVector3(n),u.theta+=e.x,u.phi+=e.y,u.makeSafe(),n.setFromSpherical(u),t.position.copy(s).add(n),t.lookAt(s),r.dispatchEvent(h)},this.dispose=function(){e.removeEventListener("contextmenu",v,!1),e.removeEventListener("mousedown",d,!1),e.removeEventListener("wheel",m,!1),e.removeEventListener("mousemove",p,!1),e.removeEventListener("mouseup",f,!1),e.removeEventListener("mouseout",f,!1),e.removeEventListener("dblclick",f,!1),e.removeEventListener("touchstart",b,!1),e.removeEventListener("touchmove",w,!1)},e.addEventListener("contextmenu",v,!1),e.addEventListener("mousedown",d,!1),e.addEventListener("wheel",m,!1);var g=[new Ta,new Ta,new Ta],y=[new Ta,new Ta,new Ta],x=null;function b(t){if(!1!==r.enabled){switch(t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0);break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0),x=g[0].distanceTo(g[1])}y[0].copy(g[0]),y[1].copy(g[1])}}function w(t){if(!1!==r.enabled){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[0].pageX,t.touches[0].pageY,0),r.rotate(g[0].sub(o(g[0],y)).multiplyScalar(-r.rotationSpeed));break;case 2:g[0].set(t.touches[0].pageX,t.touches[0].pageY,0),g[1].set(t.touches[1].pageX,t.touches[1].pageY,0);var e=g[0].distanceTo(g[1]);r.zoom(new Ta(0,0,x-e)),x=e;var n=g[0].clone().sub(o(g[0],y)),i=g[1].clone().sub(o(g[1],y));n.x=-n.x,i.x=-i.x,r.pan(n.add(i).multiplyScalar(.5))}y[0].copy(g[0]),y[1].copy(g[1])}function o(t,e){var r=e[0];for(var n in e)r.distanceTo(t)>e[n].distanceTo(t)&&(r=e[n]);return r}}e.addEventListener("touchstart",b,!1),e.addEventListener("touchmove",w,!1)};(lu.prototype=Object.create(Aa.prototype)).constructor=lu;var cu=function(t,e){this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new Ta,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.panningMode=uu,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),a=s.NONE},this.update=function(){var e=new Ta,i=(new Ma).setFromUnitVectors(t.up,new Ta(0,1,0)),o=i.clone().inverse(),f=new Ta,m=new Ma;return function(){var t=r.object.position;return e.copy(t).sub(r.target),e.applyQuaternion(i),c.setFromVector3(e),r.autoRotate&&a===s.NONE&&T(2*Math.PI/60/60*r.autoRotateSpeed),c.theta+=u.theta,c.phi+=u.phi,c.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(r.minDistance,Math.min(r.maxDistance,c.radius)),r.target.add(d),e.setFromSpherical(c),e.applyQuaternion(o),t.copy(r.target).add(e),r.object.lookAt(r.target),!0===r.enableDamping?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(n),f.copy(r.object.position),m.copy(r.object.quaternion),p=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",B,!1),r.domElement.removeEventListener("mousedown",N,!1),r.domElement.removeEventListener("wheel",R,!1),r.domElement.removeEventListener("touchstart",F,!1),r.domElement.removeEventListener("touchend",U,!1),r.domElement.removeEventListener("touchmove",k,!1),document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),window.removeEventListener("keydown",D,!1)};var r=this,n={type:"change"},i={type:"start"},o={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},a=s.NONE,l=1e-6,c=new au,u=new au,h=1,d=new Ta,p=!1,f=new ka,m=new ka,v=new ka,g=new ka,y=new ka,x=new ka,b=new ka,w=new ka,_=new ka;function S(){return Math.pow(.95,r.zoomSpeed)}function T(t){u.theta-=t}function M(t){u.phi-=t}var A=function(){var t=new Ta;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),d.add(t)}}(),E=function(){var t=new Ta;return function(e,n){switch(r.panningMode){case uu:t.setFromMatrixColumn(n,1);break;case hu:t.setFromMatrixColumn(n,0),t.crossVectors(r.object.up,t)}t.multiplyScalar(e),d.add(t)}}(),C=function(){var t=new Ta;return function(e,n){var i=r.domElement===document?r.domElement.body:r.domElement;if(r.object.isPerspectiveCamera){t.copy(r.object.position).sub(r.target);var o=t.length();o*=Math.tan(r.object.fov/2*Math.PI/180),A(2*e*o/i.clientHeight,r.object.matrix),E(2*n*o/i.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(e*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),E(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function P(t){r.object.isPerspectiveCamera?h/=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*t)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(t){r.object.isPerspectiveCamera?h*=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/t)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function N(t){if(!1!==r.enabled){switch(t.preventDefault(),t.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(t){f.set(t.clientX,t.clientY)}(t),a=s.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(t){b.set(t.clientX,t.clientY)}(t),a=s.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(t){g.set(t.clientX,t.clientY)}(t),a=s.PAN}a!==s.NONE&&(document.addEventListener("mousemove",L,!1),document.addEventListener("mouseup",I,!1),r.dispatchEvent(i))}}function L(t){if(!1!==r.enabled)switch(t.preventDefault(),a){case s.ROTATE:if(!1===r.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/e.clientWidth),M(2*Math.PI*v.y/e.clientHeight),f.copy(m),r.update()}(t);break;case s.DOLLY:if(!1===r.enableZoom)return;!function(t){w.set(t.clientX,t.clientY),_.subVectors(w,b),_.y>0?P(S()):_.y<0&&O(S()),b.copy(w),r.update()}(t);break;case s.PAN:if(!1===r.enablePan)return;!function(t){y.set(t.clientX,t.clientY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(t)}}function I(t){!1!==r.enabled&&(document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),r.dispatchEvent(o),a=s.NONE)}function R(t){!1===r.enabled||!1===r.enableZoom||a!==s.NONE&&a!==s.ROTATE||(t.preventDefault(),t.stopPropagation(),r.dispatchEvent(i),function(t){t.deltaY<0?O(S()):t.deltaY>0&&P(S()),r.update()}(t),r.dispatchEvent(o))}function D(t){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(t){switch(t.keyCode){case r.keys.UP:C(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:C(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:C(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:C(-r.keyPanSpeed,0),r.update()}}(t)}function F(t){if(!1!==r.enabled){switch(t.touches.length){case 1:if(!1===r.enableRotate)return;!function(t){f.set(t.touches[0].pageX,t.touches[0].pageY)}(t),a=s.TOUCH_ROTATE;break;case 2:if(!1===r.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);b.set(0,n)}(t),a=s.TOUCH_DOLLY;break;case 3:if(!1===r.enablePan)return;!function(t){g.set(t.touches[0].pageX,t.touches[0].pageY)}(t),a=s.TOUCH_PAN;break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(i)}}function k(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===r.enableRotate)return;if(a!==s.TOUCH_ROTATE)return;!function(t){m.set(t.touches[0].pageX,t.touches[0].pageY),v.subVectors(m,f).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;T(2*Math.PI*v.x/e.clientWidth),M(2*Math.PI*v.y/e.clientHeight),f.copy(m),r.update()}(t);break;case 2:if(!1===r.enableZoom)return;if(a!==s.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);w.set(0,i),_.subVectors(w,b),_.y>0?O(S()):_.y<0&&P(S()),b.copy(w),r.update()}(t);break;case 3:if(!1===r.enablePan)return;if(a!==s.TOUCH_PAN)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(y,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(y),r.update()}(t);break;default:a=s.NONE}}function U(t){!1!==r.enabled&&(r.dispatchEvent(o),a=s.NONE)}function B(t){!1!==r.enabled&&t.preventDefault()}r.domElement.addEventListener("contextmenu",B,!1),r.domElement.addEventListener("mousedown",N,!1),r.domElement.addEventListener("wheel",R,!1),r.domElement.addEventListener("touchstart",F,!1),r.domElement.addEventListener("touchend",U,!1),r.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",D,!1),this.update()};(cu.prototype=Object.create(Aa.prototype)).constructor=cu,Object.defineProperties(cu.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var uu=0,hu=1,du=function(t,e){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new Ta;var i=!0,o=n.NONE,s=n.NONE,a=new Ta,l=new Ta,c=new Ta,u=new ka,h=new ka,d=0,p=0,f=new ka,m=new ka;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var x=function(){var t=new ka;return function(e,n){return t.set((e-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),t}}(),b=function(){var t=new Ta,e=new Ta,n=new Ta;return function(i,o){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-o)/r.radius,0);var s=n.length();return r.noRoll?n.z=s<Math.SQRT1_2?Math.sqrt(1-s*s):.5/s:s>1?n.normalize():n.z=Math.sqrt(1-s*s),a.copy(r.object.position).sub(r.target),t.copy(r.object.up).setLength(n.y),t.add(e.copy(r.object.up).cross(a).setLength(n.x)),t.add(a.setLength(n.z)),t}}();function w(t){!1!==r.enabled&&(window.removeEventListener("keydown",w),s=o,o===n.NONE&&(t.keyCode!==r.keys[n.ROTATE]||r.noRotate?t.keyCode!==r.keys[n.ZOOM]||r.noZoom?t.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function _(t){!1!==r.enabled&&(o=s,window.addEventListener("keydown",w,!1))}function S(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o===n.NONE&&(o=t.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(f.copy(x(t.pageX,t.pageY)),m.copy(f)):(u.copy(x(t.pageX,t.pageY)),h.copy(u)):(l.copy(b(t.pageX,t.pageY)),c.copy(l)),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",M,!1),r.dispatchEvent(g))}function T(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||m.copy(x(t.pageX,t.pageY)):h.copy(x(t.pageX,t.pageY)):c.copy(b(t.pageX,t.pageY)))}function M(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",M),r.dispatchEvent(y))}function A(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),u.y+=.01*t.deltaY,r.dispatchEvent(g),r.dispatchEvent(y))}function E(t){if(!1!==r.enabled){switch(t.touches.length){case 1:o=n.TOUCH_ROTATE,l.copy(b(t.touches[0].pageX,t.touches[0].pageY)),c.copy(l);break;case 2:o=n.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=d=Math.sqrt(e*e+i*i),f.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),m.copy(f);break;default:o=n.NONE}r.dispatchEvent(g)}}function C(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:c.copy(b(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=Math.sqrt(e*e+i*i),m.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2));break;default:o=n.NONE}}function P(t){if(!1!==r.enabled){switch(t.touches.length){case 1:c.copy(b(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c);break;case 2:d=p=0,m.copy(x((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),f.copy(m)}o=n.NONE,r.dispatchEvent(y)}}function O(t){t.preventDefault()}this.rotateCamera=function(){var t=new Ta,e=new Ma;return function(){var n=Math.acos(l.dot(c)/l.length()/c.length());n&&(t.crossVectors(l,c).normalize(),e.setFromAxisAngle(t,-(n*=r.rotateSpeed)),a.applyQuaternion(e),r.object.up.applyQuaternion(e),c.applyQuaternion(e),r.staticMoving?l.copy(c):(e.setFromAxisAngle(t,n*(r.dynamicDampingFactor-1)),l.applyQuaternion(e)),i=!0)}}(),this.zoomCamera=function(){if(o===n.TOUCH_ZOOM_PAN){var t=p/d;d=p,r.object.zoom*=t,i=!0}else t=1+(h.y-u.y)*r.zoomSpeed,Math.abs(t-1)>1e-6&&t>0&&(r.object.zoom/=t,r.staticMoving?u.copy(h):u.y+=(h.y-u.y)*this.dynamicDampingFactor,i=!0)},this.panCamera=function(){var t=new ka,e=new Ta,n=new Ta;return function(){if(t.copy(m).sub(f),t.lengthSq()){var o=(r.object.top-r.object.bottom)/r.object.zoom;t.x*=(r.object.right-r.object.left)/r.object.zoom,t.y*=o,n.copy(a).cross(r.object.up).setLength(t.x),n.add(e.copy(r.object.up).setLength(t.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?f.copy(m):f.add(t.subVectors(m,f).multiplyScalar(r.dynamicDampingFactor)),i=!0}}}(),this.update=function(){a.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),i&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,a),r.object.lookAt(r.target),i&&(r.dispatchEvent(v),i=!1)},this.reset=function(){o=n.NONE,s=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),a.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(v),i=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",O,!1),this.domElement.removeEventListener("mousedown",S,!1),this.domElement.removeEventListener("wheel",A,!1),this.domElement.removeEventListener("touchstart",E,!1),this.domElement.removeEventListener("touchend",P,!1),this.domElement.removeEventListener("touchmove",C,!1),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",w,!1),window.removeEventListener("keyup",_,!1)},this.domElement.addEventListener("contextmenu",O,!1),this.domElement.addEventListener("mousedown",S,!1),this.domElement.addEventListener("wheel",A,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",P,!1),this.domElement.addEventListener("touchmove",C,!1),window.addEventListener("keydown",w,!1),window.addEventListener("keyup",_,!1),this.handleResize(),this.update()};(du.prototype=Object.create(Aa.prototype)).constructor=du;var pu=function(t,e){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new Ta;var i=new Ta,o=n.NONE,s=n.NONE,a=new Ta,l=new ka,c=new ka,u=new Ta,h=0,d=new ka,p=new ka,f=0,m=0,v=new ka,g=new ka;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},x={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var w=function(){var t=new ka;return function(e,n){return t.set((e-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),t}}(),_=function(){var t=new ka;return function(e,n){return t.set((e-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),t}}();function S(t){!1!==r.enabled&&(window.removeEventListener("keydown",S),s=o,o===n.NONE&&(t.keyCode!==r.keys[n.ROTATE]||r.noRotate?t.keyCode!==r.keys[n.ZOOM]||r.noZoom?t.keyCode!==r.keys[n.PAN]||r.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function T(t){!1!==r.enabled&&(o=s,window.addEventListener("keydown",S,!1))}function M(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o===n.NONE&&(o=t.button),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||(v.copy(w(t.pageX,t.pageY)),g.copy(v)):(d.copy(w(t.pageX,t.pageY)),p.copy(d)):(c.copy(_(t.pageX,t.pageY)),l.copy(c)),document.addEventListener("mousemove",A,!1),document.addEventListener("mouseup",E,!1),r.dispatchEvent(x))}function A(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o!==n.ROTATE||r.noRotate?o!==n.ZOOM||r.noZoom?o!==n.PAN||r.noPan||g.copy(w(t.pageX,t.pageY)):p.copy(w(t.pageX,t.pageY)):(l.copy(c),c.copy(_(t.pageX,t.pageY))))}function E(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",E),r.dispatchEvent(b))}function C(t){if(!1!==r.enabled&&!0!==r.noZoom){switch(t.preventDefault(),t.stopPropagation(),t.deltaMode){case 2:d.y-=.025*t.deltaY;break;case 1:d.y-=.01*t.deltaY;break;default:d.y-=25e-5*t.deltaY}r.dispatchEvent(x),r.dispatchEvent(b)}}function P(t){if(!1!==r.enabled){switch(t.touches.length){case 1:o=n.TOUCH_ROTATE,c.copy(_(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c);break;default:o=n.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;m=f=Math.sqrt(e*e+i*i),v.copy(w((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2)),g.copy(v)}r.dispatchEvent(x)}}function O(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:l.copy(c),c.copy(_(t.touches[0].pageX,t.touches[0].pageY));break;default:var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;m=Math.sqrt(e*e+n*n),g.copy(w((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2))}}function N(t){if(!1!==r.enabled){switch(t.touches.length){case 0:o=n.NONE;break;case 1:o=n.TOUCH_ROTATE,c.copy(_(t.touches[0].pageX,t.touches[0].pageY)),l.copy(c)}r.dispatchEvent(b)}}function L(t){!1!==r.enabled&&t.preventDefault()}this.rotateCamera=function(){var t,e=new Ta,n=new Ma,i=new Ta,o=new Ta,s=new Ta,d=new Ta;return function(){d.set(c.x-l.x,c.y-l.y,0),(t=d.length())?(a.copy(r.object.position).sub(r.target),i.copy(a).normalize(),o.copy(r.object.up).normalize(),s.crossVectors(o,i).normalize(),o.setLength(c.y-l.y),s.setLength(c.x-l.x),d.copy(o.add(s)),e.crossVectors(d,a).normalize(),n.setFromAxisAngle(e,t*=r.rotateSpeed),a.applyQuaternion(n),r.object.up.applyQuaternion(n),u.copy(e),h=t):!r.staticMoving&&h&&(h*=Math.sqrt(1-r.dynamicDampingFactor),a.copy(r.object.position).sub(r.target),n.setFromAxisAngle(u,h),a.applyQuaternion(n),r.object.up.applyQuaternion(n)),l.copy(c)}}(),this.zoomCamera=function(){var t;o===n.TOUCH_ZOOM_PAN?(t=f/m,f=m,a.multiplyScalar(t)):(1!=(t=1+(p.y-d.y)*r.zoomSpeed)&&t>0&&a.multiplyScalar(t),r.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=function(){var t=new ka,e=new Ta,n=new Ta;return function(){t.copy(g).sub(v),t.lengthSq()&&(t.multiplyScalar(a.length()*r.panSpeed),n.copy(a).cross(r.object.up).setLength(t.x),n.add(e.copy(r.object.up).setLength(t.y)),r.object.position.add(n),r.target.add(n),r.staticMoving?v.copy(g):v.add(t.subVectors(g,v).multiplyScalar(r.dynamicDampingFactor)))}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(a.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,a.setLength(r.maxDistance)),d.copy(p)),a.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,a.setLength(r.minDistance)),d.copy(p)))},this.update=function(){a.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,a),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(y),i.copy(r.object.position))},this.reset=function(){o=n.NONE,s=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),a.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",L,!1),this.domElement.removeEventListener("mousedown",M,!1),this.domElement.removeEventListener("wheel",C,!1),this.domElement.removeEventListener("touchstart",P,!1),this.domElement.removeEventListener("touchend",N,!1),this.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",A,!1),document.removeEventListener("mouseup",E,!1),window.removeEventListener("keydown",S,!1),window.removeEventListener("keyup",T,!1)},this.domElement.addEventListener("contextmenu",L,!1),this.domElement.addEventListener("mousedown",M,!1),this.domElement.addEventListener("wheel",C,!1),this.domElement.addEventListener("touchstart",P,!1),this.domElement.addEventListener("touchend",N,!1),this.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",S,!1),window.addEventListener("keyup",T,!1),this.handleResize(),this.update()};function fu(t,e,r,n){Ba.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new mu(t,e,r,n)),this.mergeVertices()}function mu(t,e,r,n){$a.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function s(t,e,r,n){var i,o,s=Math.pow(2,n),l=[];for(i=0;i<=s;i++){l[i]=[];var c=t.clone().lerp(r,i/s),u=e.clone().lerp(r,i/s),h=s-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===s?c:c.clone().lerp(u,o/h)}for(i=0;i<s;i++)for(o=0;o<2*(s-i)-1;o++){var d=Math.floor(o/2);o%2==0?(a(l[i][d+1]),a(l[i+1][d]),a(l[i][d])):(a(l[i][d+1]),a(l[i+1][d+1]),a(l[i+1][d]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function c(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var r=new Ta,n=new Ta,i=new Ta,o=0;o<e.length;o+=3)l(e[o+0],r),l(e[o+1],n),l(e[o+2],i),s(r,n,i,t)}(n=n||0),function(t){for(var e=new Ta,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new Ta,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=u(t)/2/Math.PI+.5,n=h(t)/Math.PI+.5;o.push(r,1-n)}(function(){for(var t=new Ta,e=new Ta,r=new Ta,n=new Ta,s=new ka,a=new ka,l=new ka,h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),n.copy(t).add(e).add(r).divideScalar(3);var p=u(n);c(s,d+0,t,p),c(a,d+2,e,p),c(l,d+4,r,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),s=Math.min(e,r,n);i>.9&&s<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.addAttribute("position",new Za(i,3)),this.addAttribute("normal",new Za(i.slice(),3)),this.addAttribute("uv",new Za(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function vu(t,e){Ba.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new gu(t,e)),this.mergeVertices()}function gu(t,e){mu.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function yu(t,e,r,n,i){Ba.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new xu(t,e,r,n,i)),this.mergeVertices()}function xu(t,e,r,n,i){$a.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,s,a=[],l=[],c=[],u=[],h=new Ta,d=new Ta,p=new Ta;for(o=0;o<=r;o++)for(s=0;s<=n;s++){var f=s/n*i,m=o/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(s/n),u.push(o/r)}for(o=1;o<=r;o++)for(s=1;s<=n;s++){var v=(n+1)*(o-1)+s-1,g=(n+1)*(o-1)+s,y=(n+1)*o+s;a.push((n+1)*o+s-1,v,y),a.push(v,g,y)}this.setIndex(a),this.addAttribute("position",new Za(l,3)),this.addAttribute("normal",new Za(c,3)),this.addAttribute("uv",new Za(u,2))}(pu.prototype=Object.create(Aa.prototype)).constructor=pu,(fu.prototype=Object.create(Ba.prototype)).constructor=fu,(mu.prototype=Object.create($a.prototype)).constructor=mu,(vu.prototype=Object.create(Ba.prototype)).constructor=vu,(gu.prototype=Object.create(mu.prototype)).constructor=gu,(yu.prototype=Object.create(Ba.prototype)).constructor=yu,(xu.prototype=Object.create($a.prototype)).constructor=xu;var bu=function(t){zl.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=rl,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(bu.prototype=Object.create(zl.prototype)).constructor=bu;var wu=function(t){Vl.call(this),this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(wu.prototype=Object.create(Vl.prototype)).constructor=wu;var _u=new bu({visible:!1,transparent:!1}),Su=function(){this.init=function(){Na.call(this),this.handles=new Na,this.pickers=new Na,this.planes=new Na,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var t=new Oc(50,50,2,2),e=new zl({visible:!1,side:il}),r={XY:new ql(t,e),YZ:new ql(t,e),XZ:new ql(t,e),XYZE:new ql(t,e)};for(var n in this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0),r)r[n].name=n,this.planes.add(r[n]),this.planes[n]=r[n];var i=function(t,e){for(var r in t)for(n=t[r].length;n--;){var i=t[r][n][0],o=t[r][n][1],s=t[r][n][2];i.name=r,i.renderOrder=1/0,o&&i.position.set(o[0],o[1],o[2]),s&&i.rotation.set(s[0],s[1],s[2]),e.add(i)}};i(this.handleGizmos,this.handles),i(this.pickerGizmos,this.pickers),this.traverse(function(t){if(t instanceof ql){t.updateMatrix();var e=t.geometry.clone();e.applyMatrix(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}})},this.highlight=function(t){this.traverse(function(e){e.material&&e.material.highlight&&e.material.highlight(e.name===t)})}};(Su.prototype=Object.create(Na.prototype)).constructor=Su,Su.prototype.update=function(t,e){var r=new Ta(0,0,0),n=new Ta(0,1,0),i=new Sa;this.traverse(function(o){-1!==o.name.search("E")?o.quaternion.setFromRotationMatrix(i.lookAt(e,r,n)):-1===o.name.search("X")&&-1===o.name.search("Y")&&-1===o.name.search("Z")||o.quaternion.setFromEuler(t)})};var Tu=function(){Su.call(this);var t=new Ba,e=new ql(new tc(0,.05,.2,12,1,!1));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var r=new $a;r.addAttribute("position",new Za([0,0,0,1,0,0],3));var n=new $a;n.addAttribute("position",new Za([0,0,0,0,1,0],3));var i=new $a;i.addAttribute("position",new Za([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new ql(t,new bu({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Yl(r,new wu({color:16711680}))]],Y:[[new ql(t,new bu({color:65280})),[0,.5,0]],[new Yl(n,new wu({color:65280}))]],Z:[[new ql(t,new bu({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Yl(i,new wu({color:255}))]],XYZ:[[new ql(new vu(.1,0),new bu({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new ql(new Oc(.29,.29),new bu({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new ql(new Oc(.29,.29),new bu({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ql(new Oc(.29,.29),new bu({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new ql(new ec(.2,0,1,4,1,!1),_u),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new ql(new ec(.2,0,1,4,1,!1),_u),[0,.6,0]]],Z:[[new ql(new ec(.2,0,1,4,1,!1),_u),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new ql(new vu(.2,0),_u)]],XY:[[new ql(new Oc(.4,.4),_u),[.2,.2,0]]],YZ:[[new ql(new Oc(.4,.4),_u),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new ql(new Oc(.4,.4),_u),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(t,e){var r=new Sa;e.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE),"XY"===t&&(this.activePlane=this.planes.XY),"YZ"===t&&(this.activePlane=this.planes.YZ),"XZ"===t&&(this.activePlane=this.planes.XZ)},this.init()};(Tu.prototype=Object.create(Su.prototype)).constructor=Tu;var Mu=function(){Su.call(this);var t=function(t,e,r){var n=new $a,i=[];r=r||1;for(var o=0;o<=64*r;++o)"x"===e&&i.push(0,Math.cos(o/32*Math.PI)*t,Math.sin(o/32*Math.PI)*t),"y"===e&&i.push(Math.cos(o/32*Math.PI)*t,0,Math.sin(o/32*Math.PI)*t),"z"===e&&i.push(Math.sin(o/32*Math.PI)*t,Math.cos(o/32*Math.PI)*t,0);return n.addAttribute("position",new Za(i,3)),n};this.handleGizmos={X:[[new Yl(new t(1,"x",.5),new wu({color:16711680}))]],Y:[[new Yl(new t(1,"y",.5),new wu({color:65280}))]],Z:[[new Yl(new t(1,"z",.5),new wu({color:255}))]],E:[[new Yl(new t(1.25,"z",1),new wu({color:13421568}))]],XYZE:[[new Yl(new t(1,"z",1),new wu({color:7895160}))]]},this.pickerGizmos={X:[[new ql(new xu(1,.12,4,12,Math.PI),_u),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ql(new xu(1,.12,4,12,Math.PI),_u),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ql(new xu(1,.12,4,12,Math.PI),_u),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ql(new xu(1.25,.12,2,24),_u)]],XYZE:[[new ql]]},this.setActivePlane=function(t){"E"===t&&(this.activePlane=this.planes.XYZE),"X"===t&&(this.activePlane=this.planes.YZ),"Y"===t&&(this.activePlane=this.planes.XZ),"Z"===t&&(this.activePlane=this.planes.XY)},this.update=function(t,e){Su.prototype.update.apply(this,arguments);var r=new Sa,n=new Ea(0,0,1),i=new Ma,o=new Ta(1,0,0),s=new Ta(0,1,0),a=new Ta(0,0,1),l=new Ma,c=new Ma,u=new Ma,h=e.clone();n.copy(this.planes.XY.rotation),i.setFromEuler(n),r.makeRotationFromQuaternion(i).getInverse(r),h.applyMatrix4(r),this.traverse(function(t){i.setFromEuler(n),"X"===t.name&&(l.setFromAxisAngle(o,Math.atan2(-h.y,h.z)),i.multiplyQuaternions(i,l),t.quaternion.copy(i)),"Y"===t.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),i.multiplyQuaternions(i,c),t.quaternion.copy(i)),"Z"===t.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),i.multiplyQuaternions(i,u),t.quaternion.copy(i))})},this.init()};(Mu.prototype=Object.create(Su.prototype)).constructor=Mu;var Au=function(){Su.call(this);var t=new Ba,e=new ql(new Kl(.125,.125,.125));e.position.y=.5,e.updateMatrix(),t.merge(e.geometry,e.matrix);var r=new $a;r.addAttribute("position",new Za([0,0,0,1,0,0],3));var n=new $a;n.addAttribute("position",new Za([0,0,0,0,1,0],3));var i=new $a;i.addAttribute("position",new Za([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new ql(t,new bu({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new Yl(r,new wu({color:16711680}))]],Y:[[new ql(t,new bu({color:65280})),[0,.5,0]],[new Yl(n,new wu({color:65280}))]],Z:[[new ql(t,new bu({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new Yl(i,new wu({color:255}))]],XYZ:[[new ql(new $l(.125,.125,.125),new bu({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new ql(new ec(.2,0,1,4,1,!1),_u),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new ql(new ec(.2,0,1,4,1,!1),_u),[0,.6,0]]],Z:[[new ql(new ec(.2,0,1,4,1,!1),_u),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new ql(new $l(.4,.4,.4),_u)]]},this.setActivePlane=function(t,e){var r=new Sa;e.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"===t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"===t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===t&&(this.activePlane=this.planes.XYZE)},this.init()};(Au.prototype=Object.create(Su.prototype)).constructor=Au;var Eu=function(t,e){Na.call(this),e=void 0!==e?e:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var r=this,n="translate",i=!1,o={translate:new Tu,rotate:new Mu,scale:new Au};for(var s in o){var a=o[s];a.visible=s===n,this.add(a)}var l={type:"change"},c={type:"mouseDown"},u={type:"mouseUp",mode:n},h={type:"objectChange"},d=new nu,p=new ka,f=new Ta,m=new Ta,v=new Ta,g=new Ta,y=1,x=new Sa,b=new Ta,w=new Sa,_=new Ta,S=new Ma,T=new Ta(1,0,0),M=new Ta(0,1,0),A=new Ta(0,0,1),E=new Ma,C=new Ma,P=new Ma,O=new Ma,N=new Ma,L=new Ta,I=new Ta,R=new Sa,D=new Sa,F=new Ta,k=new Ta,U=new Ea,B=new Sa,j=new Ta,z=new Ea;function V(t){if(void 0!==r.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,o[n].pickers.children),s=null;e&&(s=e.object.name,t.preventDefault()),r.axis!==s&&(r.axis=s,r.update(),r.dispatchEvent(l))}}function G(t){if(void 0!==r.object&&!0!==i&&(void 0===t.button||0===t.button)){var e=t.changedTouches?t.changedTouches[0]:t;if(0===e.button||void 0===e.button){var s=X(e,o[n].pickers.children);if(s){t.preventDefault(),t.stopPropagation(),r.axis=s.object.name,r.dispatchEvent(c),r.update(),b.copy(j).sub(k).normalize(),o[n].setActivePlane(r.axis,b);var a=X(e,[o[n].activePlane]);a&&(L.copy(r.object.position),I.copy(r.object.scale),R.extractRotation(r.object.matrix),B.extractRotation(r.object.matrixWorld),D.extractRotation(r.object.parent.matrixWorld),F.setFromMatrixScale(w.getInverse(r.object.parent.matrixWorld)),m.copy(a.point))}}i=!0}}function H(t){if(void 0!==r.object&&null!==r.axis&&!1!==i&&(void 0===t.button||0===t.button)){var e=X(t.changedTouches?t.changedTouches[0]:t,[o[n].activePlane]);!1!==e&&(t.preventDefault(),t.stopPropagation(),f.copy(e.point),"translate"===n?(f.sub(m),f.multiply(F),"local"===r.space&&(f.applyMatrix4(w.getInverse(B)),-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(R),r.object.position.copy(L),r.object.position.add(f)),"world"!==r.space&&-1===r.axis.search("XYZ")||(-1===r.axis.search("X")&&(f.x=0),-1===r.axis.search("Y")&&(f.y=0),-1===r.axis.search("Z")&&(f.z=0),f.applyMatrix4(w.getInverse(D)),r.object.position.copy(L),r.object.position.add(f)),null!==r.translationSnap&&("local"===r.space&&r.object.position.applyMatrix4(w.getInverse(B)),-1!==r.axis.search("X")&&(r.object.position.x=Math.round(r.object.position.x/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Y")&&(r.object.position.y=Math.round(r.object.position.y/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Z")&&(r.object.position.z=Math.round(r.object.position.z/r.translationSnap)*r.translationSnap),"local"===r.space&&r.object.position.applyMatrix4(B))):"scale"===n?(f.sub(m),f.multiply(F),"local"===r.space&&("XYZ"===r.axis?(y=1+f.y/Math.max(I.x,I.y,I.z),r.object.scale.x=I.x*y,r.object.scale.y=I.y*y,r.object.scale.z=I.z*y):(f.applyMatrix4(w.getInverse(B)),"X"===r.axis&&(r.object.scale.x=I.x*(1+f.x/I.x)),"Y"===r.axis&&(r.object.scale.y=I.y*(1+f.y/I.y)),"Z"===r.axis&&(r.object.scale.z=I.z*(1+f.z/I.z))))):"rotate"===n&&(f.sub(k),f.multiply(F),_.copy(m).sub(k),_.multiply(F),"E"===r.axis?(f.applyMatrix4(w.getInverse(x)),_.applyMatrix4(w.getInverse(x)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),N.setFromAxisAngle(b,v.z-g.z),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,N),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"XYZE"===r.axis?(N.setFromEuler(f.clone().cross(_).normalize()),S.setFromRotationMatrix(w.getInverse(D)),C.setFromAxisAngle(N,-f.clone().angleTo(_)),E.setFromRotationMatrix(B),S.multiplyQuaternions(S,C),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S)):"local"===r.space?(f.applyMatrix4(w.getInverse(B)),_.applyMatrix4(w.getInverse(B)),v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),E.setFromRotationMatrix(R),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),"X"===r.axis&&E.multiplyQuaternions(E,C),"Y"===r.axis&&E.multiplyQuaternions(E,P),"Z"===r.axis&&E.multiplyQuaternions(E,O),r.object.quaternion.copy(E)):"world"===r.space&&(v.set(Math.atan2(f.z,f.y),Math.atan2(f.x,f.z),Math.atan2(f.y,f.x)),g.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.setFromRotationMatrix(w.getInverse(D)),null!==r.rotationSnap?(C.setFromAxisAngle(T,Math.round((v.x-g.x)/r.rotationSnap)*r.rotationSnap),P.setFromAxisAngle(M,Math.round((v.y-g.y)/r.rotationSnap)*r.rotationSnap),O.setFromAxisAngle(A,Math.round((v.z-g.z)/r.rotationSnap)*r.rotationSnap)):(C.setFromAxisAngle(T,v.x-g.x),P.setFromAxisAngle(M,v.y-g.y),O.setFromAxisAngle(A,v.z-g.z)),E.setFromRotationMatrix(B),"X"===r.axis&&S.multiplyQuaternions(S,C),"Y"===r.axis&&S.multiplyQuaternions(S,P),"Z"===r.axis&&S.multiplyQuaternions(S,O),S.multiplyQuaternions(S,E),r.object.quaternion.copy(S))),r.update(),r.dispatchEvent(l),r.dispatchEvent(h))}}function W(t){t.preventDefault(),void 0!==t.button&&0!==t.button||(i&&null!==r.axis&&(u.mode=n,r.dispatchEvent(u)),i=!1,"TouchEvent"in window&&t instanceof TouchEvent?(r.axis=null,r.update(),r.dispatchEvent(l)):V(t))}function X(r,n){var i=e.getBoundingClientRect();p.set((r.clientX-i.left)/i.width*2-1,(r.clientY-i.top)/i.height*-2+1),d.setFromCamera(p,t);var o=d.intersectObjects(n,!0);return!!o[0]&&o[0]}e.addEventListener("mousedown",G,!1),e.addEventListener("touchstart",G,!1),e.addEventListener("mousemove",V,!1),e.addEventListener("touchmove",V,!1),e.addEventListener("mousemove",H,!1),e.addEventListener("touchmove",H,!1),e.addEventListener("mouseup",W,!1),e.addEventListener("mouseout",W,!1),e.addEventListener("touchend",W,!1),e.addEventListener("touchcancel",W,!1),e.addEventListener("touchleave",W,!1),this.dispose=function(){e.removeEventListener("mousedown",G),e.removeEventListener("touchstart",G),e.removeEventListener("mousemove",V),e.removeEventListener("touchmove",V),e.removeEventListener("mousemove",H),e.removeEventListener("touchmove",H),e.removeEventListener("mouseup",W),e.removeEventListener("mouseout",W),e.removeEventListener("touchend",W),e.removeEventListener("touchcancel",W),e.removeEventListener("touchleave",W)},this.attach=function(t){this.object=t,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return n},this.setMode=function(t){for(var e in"scale"===(n=t||n)&&(r.space="local"),o)o[e].visible=e===n;this.update(),r.dispatchEvent(l)},this.setTranslationSnap=function(t){r.translationSnap=t},this.setRotationSnap=function(t){r.rotationSnap=t},this.setSize=function(t){r.size=t,this.update(),r.dispatchEvent(l)},this.setSpace=function(t){r.space=t,this.update(),r.dispatchEvent(l)},this.update=function(){void 0!==r.object&&(r.object.updateMatrixWorld(),k.setFromMatrixPosition(r.object.matrixWorld),U.setFromRotationMatrix(w.extractRotation(r.object.matrixWorld)),t.updateMatrixWorld(),j.setFromMatrixPosition(t.matrixWorld),z.setFromRotationMatrix(w.extractRotation(t.matrixWorld)),y=k.distanceTo(j)/6*r.size,this.position.copy(k),this.scale.set(y,y,y),t instanceof bc?b.copy(j).sub(k).normalize():t instanceof Sc&&b.copy(j).normalize(),"local"===r.space?o[n].update(U,b):"world"===r.space&&o[n].update(new Ea,b),o[n].highlight(r.axis))}};(Eu.prototype=Object.create(Na.prototype)).constructor=Eu;var Cu=0;function Pu(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Iu,this.unassigned=new Iu,this.vertices=[]}function Ou(){this.normal=new Ta,this.midpoint=new Ta,this.area=0,this.constant=0,this.outside=null,this.mark=Cu,this.edge=null}function Nu(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function Lu(t){this.point=t,this.prev=null,this.next=null,this.face=null}function Iu(){this.head=null,this.tail=null}function Ru(t){Ba.call(this),this.fromBufferGeometry(new Du(t)),this.mergeVertices()}function Du(t){$a.call(this);var e=[],r=[];void 0===Pu&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull");for(var n=(new Pu).setFromPoints(t).faces,i=0;i<n.length;i++){var o=n[i],s=o.edge;do{var a=s.head().point;e.push(a.x,a.y,a.z),r.push(o.normal.x,o.normal.y,o.normal.z),s=s.next}while(s!==o.edge)}this.addAttribute("position",new Za(e,3)),this.addAttribute("normal",new Za(r,3))}Object.assign(Pu.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("QuickHull: Points parameter is not an array."),t.length<4&&console.error("QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.vertices.push(new Lu(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var r,n,i,o=t.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)(i=s[r].clone()).applyMatrix4(t.matrixWorld),e.push(i)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)(i=new Ta).fromBufferAttribute(a,r).applyMatrix4(t.matrixWorld),e.push(i)}}),this.setFromPoints(e)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(e.outside=null!==t.next&&t.next.face===e?t.next:null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,r=t.outside;null!==r.next&&r.next.face===t;)r=r.next;return this.assigned.removeSubList(e,r),e.prev=r.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var r=this.removeAllVerticesFromFace(t);if(void 0!==r)if(void 0===e)this.unassigned.appendChain(r);else{var n=r;do{var i=n.next;e.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,e):this.unassigned.append(n),n=i}while(null!==n)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var r=e.next,n=this.tolerance,i=null,o=0;o<t.length;o++){var s=t[o];if(s.mark===Cu){var a=s.distanceToPoint(e.point);if(a>n&&(n=a,i=s),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(e,i),e=r}while(null!==e)}return this},computeExtremes:function(){var t,e,r,n=new Ta,i=new Ta,o=[],s=[];for(t=0;t<3;t++)o[t]=s[t]=this.vertices[0];for(n.copy(this.vertices[0].point),i.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var a=this.vertices[t],l=a.point;for(r=0;r<3;r++)l.getComponent(r)<n.getComponent(r)&&(n.setComponent(r,l.getComponent(r)),o[r]=a);for(r=0;r<3;r++)l.getComponent(r)>i.getComponent(r)&&(i.setComponent(r,l.getComponent(r)),s[r]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:o,max:s}},computeInitialHull:function(){var t,e,r;return function(){void 0===t&&(t=new Hl,e=new Wl,r=new Ta);var n,i,o,s,a,l,c,u,h,d=this.vertices,p=this.computeExtremes(),f=p.min,m=p.max,v=0,g=0;for(l=0;l<3;l++)(h=m[l].point.getComponent(l)-f[l].point.getComponent(l))>v&&(v=h,g=l);for(v=0,t.set((i=f[g]).point,(o=m[g]).point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&(t.closestPointToPoint(n.point,!0,r),(h=r.distanceToSquared(n.point))>v&&(v=h,s=n));for(v=-1,e.setFromCoplanarPoints(i.point,o.point,s.point),l=0,c=this.vertices.length;l<c;l++)(n=d[l])!==i&&n!==o&&n!==s&&(h=Math.abs(e.distanceToPoint(n.point)))>v&&(v=h,a=n);var y=[];if(e.distanceToPoint(a.point)<0)for(y.push(Ou.create(i,o,s),Ou.create(a,o,i),Ou.create(a,s,o),Ou.create(a,i,s)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(u)),y[l+1].getEdge(1).setTwin(y[u+1].getEdge(0));else for(y.push(Ou.create(i,s,o),Ou.create(a,i,o),Ou.create(a,o,s),Ou.create(a,s,i)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[u+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,c=d.length;l<c;l++)if((n=d[l])!==i&&n!==o&&n!==s&&n!==a){v=this.tolerance;var x=null;for(u=0;u<4;u++)(h=this.faces[u].distanceToPoint(n.point))>v&&(v=h,x=this.faces[u]);null!==x&&this.addVertexToFace(n,x)}return this}}(),reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var r=this.faces[e];r.mark===Cu&&t.push(r)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,r=this.assigned.first().face,n=r.outside;do{var i=r.distanceToPoint(n.point);i>e&&(e=i,t=n),n=n.next}while(null!==n&&n.face===r);return t}},computeHorizon:function(t,e,r,n){var i;this.deleteFaceVertices(r),r.mark=1,i=null===e?e=r.getEdge(0):e.next;do{var o=i.twin,s=o.face;s.mark===Cu&&(s.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,s,n):n.push(i)),i=i.next}while(i!==e);return this},addAdjoiningFace:function(t,e){var r=Ou.create(t,e.tail(),e.head());return this.faces.push(r),r.getEdge(-1).setTwin(e.twin),r.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var r=null,n=null,i=0;i<e.length;i++){var o=this.addAdjoiningFace(t,e[i]);null===r?r=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return r.next.setTwin(n),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Ou,{create:function(t,e,r){var n=new Ou,i=new Nu(t,n),o=new Nu(e,n),s=new Nu(r,n);return i.next=s.prev=o,o.next=i.prev=s,s.next=o.prev=i,n.edge=i,n.compute()}}),Object.assign(Ou.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){var t;return function(){void 0===t&&(t=new Xl);var e=this.edge.tail(),r=this.edge.head(),n=this.edge.next.head();return t.set(e.point,r.point,n.point),t.getNormal(this.normal),t.getMidpoint(this.midpoint),this.area=t.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(Nu.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(Iu.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),(Ru.prototype=Object.create(Ba.prototype)).constructor=Ru,(Du.prototype=Object.create($a.prototype)).constructor=Du;var Fu=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new Hl,this.tempPlane1=new Wl,this.tempPlane2=new Wl,this.tempCM1=new Ta,this.tempCM2=new Ta,this.tempVector3=new Ta,this.tempVector3_2=new Ta,this.tempVector3_3=new Ta,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var r=0;r<900;r++)this.segments[r]=!1};function ku(){this.type="Curve",this.arcLengthDivisions=200}function Uu(){ku.call(this)}function Bu(t){ku.call(this),this.scale=void 0===t?5:t}function ju(t){ku.call(this),this.scale=void 0===t?70:t}function zu(){ku.call(this)}function Vu(){ku.call(this)}function Gu(t){ku.call(this),this.scale=void 0===t?10:t}function Hu(t){ku.call(this),this.scale=void 0===t?10:t}function Wu(t){ku.call(this),this.scale=void 0===t?10:t}function Xu(t){ku.call(this),this.scale=void 0===t?10:t}function qu(t){ku.call(this),this.scale=void 0===t?1:t}function Yu(t){ku.call(this),this.scale=void 0===t?40:t}function Zu(t){ku.call(this),this.scale=void 0===t?40:t}function Ju(t){ku.call(this),this.scale=void 0===t?40:t}function Qu(t){ku.call(this),this.scale=void 0===t?40:t}Fu.prototype={constructor:Fu,prepareBreakableObject:function(t,e,r,n,i){for(var o=t.geometry.vertices,s=0,a=o.length;s<a;s++)o[s].mark=0;var l=t.userData;l.mass=e,l.velocity=r.clone(),l.angularVelocity=n.clone(),l.breakable=i},subdivideByImpact:function(t,e,r,n,i,o){var s=[],a=this.tempPlane1,l=this.tempPlane2;this.tempVector3.addVectors(e,r),a.setFromCoplanarPoints(e,t.position,this.tempVector3);var c=i+n,u=this;return function i(o,h,d,p){if(Math.random()<.05*p||p>c)s.push(o);else{var f=Math.PI;0===p?(l.normal.copy(a.normal),l.constant=a.constant):p<=n?(f=(d-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(r,f).add(e),l.setFromCoplanarPoints(e,u.tempVector3,u.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(e).sub(o.position).applyAxisAngle(r,f).add(o.position),u.tempVector3_3.copy(r).add(o.position),l.setFromCoplanarPoints(o.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(o,l,u.tempResultObjects);var m=u.tempResultObjects.object1,v=u.tempResultObjects.object2;m&&i(m,h,f,p+1),v&&i(v,f,d,p+1)}}(t,0,2*Math.PI,0),s},cutByPlane:function(t,e,r){for(var n=t.geometry,i=n.vertices,o=n.faces,s=i.length,a=[],l=[],c=this.smallDelta,u=0;u<s;u++)i[u].mark=0;var h=s*s;for(u=0;u<h;u++)this.segments[u]=!1;u=0;for(var d=o.length-1;u<d;u++)for(var p=o[u],f=u+1,m=o.length;f<m;f++){var v=o[f];if(1-p.normal.dot(v.normal)<c){var g=p.a,y=p.b,x=p.c,b=v.a,w=v.b,_=v.c;g===b||g===w||g===_?y===b||y===w||y===_?(this.segments[g*s+y]=!0,this.segments[y*s+g]=!0):(this.segments[x*s+g]=!0,this.segments[g*s+x]=!0):y!==b&&y!==w&&y!==_||(this.segments[x*s+y]=!0,this.segments[y*s+x]=!0)}}var S=this.tempPlane1;for(t.updateMatrix(),Fu.transformPlaneToLocalSpace(e,t.matrix,S),u=0,d=o.length;u<d;u++)for(var T=o[u],M=0;M<3;M++){var A=0===M?T.a:1===M?T.b:T.c,E=0===M?T.b:1===M?T.c:T.a;if(!this.segments[A*s+E]){this.segments[A*s+E]=!0,this.segments[E*s+A]=!0;var C,P=i[A],O=i[E];if(0===P.mark)if((C=S.distanceToPoint(P))>c)P.mark=2,l.push(P);else if(C<-c)P.mark=1,a.push(P);else{P.mark=3,a.push(P);var N=P.clone();N.mark=3,l.push(N)}if(0===O.mark)if((C=S.distanceToPoint(O))>c)O.mark=2,l.push(O);else if(C<-c)O.mark=1,a.push(O);else{O.mark=3,a.push(O);var L=O.clone();L.mark=3,l.push(L)}var I=P.mark,R=O.mark;if(1===I&&2===R||2===I&&1===R){this.tempLine1.start.copy(P),this.tempLine1.end.copy(O);var D=S.intersectLine(this.tempLine1);if(void 0===D)return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;D.mark=1,a.push(D);var F=D.clone();F.mark=2,l.push(F)}}}var k=.5*t.userData.mass;this.tempCM1.set(0,0,0);var U=0,B=a.length;if(B>0){for(u=0;u<B;u++)this.tempCM1.add(a[u]);for(this.tempCM1.divideScalar(B),u=0;u<B;u++)(V=a[u]).sub(this.tempCM1),U=Math.max(U,V.x,V.y,V.z);this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var j=0,z=l.length;if(z>0){for(u=0;u<z;u++)this.tempCM2.add(l[u]);for(this.tempCM2.divideScalar(z),u=0;u<z;u++){var V;(V=l[u]).sub(this.tempCM2),j=Math.max(j,V.x,V.y,V.z)}this.tempCM2.add(t.position)}var G=null,H=null,W=0;return B>4&&((G=new ql(new Ru(a),t.material)).position.copy(this.tempCM1),G.quaternion.copy(t.quaternion),this.prepareBreakableObject(G,k,t.userData.velocity,t.userData.angularVelocity,2*U>this.minSizeForBreak),W++),z>4&&((H=new ql(new Ru(l),t.material)).position.copy(this.tempCM2),H.quaternion.copy(t.quaternion),this.prepareBreakableObject(H,k,t.userData.velocity,t.userData.angularVelocity,2*j>this.minSizeForBreak),W++),r.object1=G,r.object2=H,W}},Fu.transformFreeVector=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[4]*n+o[8]*i,t.y=o[1]*r+o[5]*n+o[9]*i,t.z=o[2]*r+o[6]*n+o[10]*i,t},Fu.transformFreeVectorInverse=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[1]*n+o[2]*i,t.y=o[4]*r+o[5]*n+o[6]*i,t.z=o[8]*r+o[9]*n+o[10]*i,t},Fu.transformTiedVectorInverse=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.elements;return t.x=o[0]*r+o[1]*n+o[2]*i-o[12],t.y=o[4]*r+o[5]*n+o[6]*i-o[13],t.z=o[8]*r+o[9]*n+o[10]*i-o[14],t},Fu.transformPlaneToLocalSpace=function(){var t=new Ta;return new Pa,function(e,r,n){n.normal.copy(e.normal),n.constant=e.constant;var i=Fu.transformTiedVectorInverse(e.coplanarPoint(t),r);Fu.transformFreeVectorInverse(n.normal,r),n.constant=-i.dot(n.normal)}}(),Object.assign(ku.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=n[i=Math.floor(a+(l-a)/2)]-r)<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var n=this.getPoint(e);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i=new Ta,o=[],s=[],a=[],l=new Ta,c=new Sa;for(r=0;r<=t;r++)o[r]=this.getTangentAt(r/t),o[r].normalize();s[0]=new Ta,a[0]=new Ta;var u=Number.MAX_VALUE,h=Math.abs(o[0].x),d=Math.abs(o[0].y),p=Math.abs(o[0].z);for(h<=u&&(u=h,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),p<=u&&i.set(0,0,1),l.crossVectors(o[0],i).normalize(),s[0].crossVectors(o[0],l),a[0].crossVectors(o[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),a[r]=a[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),n=Math.acos(_a.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(l,n))),a[r].crossVectors(o[r],s[r]);if(!0===e)for(n=Math.acos(_a.clamp(s[0].dot(s[t]),-1,1)),n/=t,o[0].dot(l.crossVectors(s[0],s[t]))>0&&(n=-n),r=1;r<=t;r++)s[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),a[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Uu.prototype=Object.create(ku.prototype)).constructor=Uu,Uu.prototype.getPoint=function(t,e){var r=e||new Ta;t=2*Math.PI*t;var n=-.22*Math.cos(t)-1.28*Math.sin(t)-.44*Math.cos(3*t)-.78*Math.sin(3*t),i=-.1*Math.cos(2*t)-.27*Math.sin(2*t)+.38*Math.cos(4*t)+.46*Math.sin(4*t),o=.7*Math.cos(3*t)-.4*Math.sin(3*t);return r.set(n,i,o).multiplyScalar(20)},(Bu.prototype=Object.create(ku.prototype)).constructor=Bu,Bu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=16*Math.pow(Math.sin(t),3),i=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);return r.set(n,i,0).multiplyScalar(this.scale)},(ju.prototype=Object.create(ku.prototype)).constructor=ju,ju.prototype.getPoint=function(t,e){var r=e||new Ta;t=4*t*Math.PI;var n=this.scale/2,i=n*(1+Math.cos(t)),o=n*Math.sin(t),s=2*n*Math.sin(t/2);return r.set(i,o,s)},(zu.prototype=Object.create(ku.prototype)).constructor=zu,zu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=50*Math.sin(t),i=Math.cos(t)*(10+50*Math.cos(t)),o=Math.sin(t)*(10+50*Math.cos(t));return r.set(n,i,o)},(Vu.prototype=Object.create(ku.prototype)).constructor=Vu,Vu.prototype.getPoint=function(t,e){var r=e||new Ta,n=2*Math.PI*t*150/30,i=30*Math.cos(n),o=30*Math.sin(n);return r.set(i,o,150*t)},(Gu.prototype=Object.create(ku.prototype)).constructor=Gu,Gu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=(2+Math.cos(3*t))*Math.cos(2*t),i=(2+Math.cos(3*t))*Math.sin(2*t),o=Math.sin(3*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Hu.prototype=Object.create(ku.prototype)).constructor=Hu,Hu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=(2+Math.cos(4*t))*Math.cos(3*t),i=(2+Math.cos(4*t))*Math.sin(3*t),o=Math.sin(4*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Wu.prototype=Object.create(ku.prototype)).constructor=Wu,Wu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=(2+Math.cos(5*t))*Math.cos(2*t),i=(2+Math.cos(5*t))*Math.sin(2*t),o=Math.sin(5*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Xu.prototype=Object.create(ku.prototype)).constructor=Xu,Xu.prototype.getPoint=function(t,e){var r=e||new Ta;t=4*t-2;var n=Math.pow(t,3)-3*t,i=Math.pow(t,4)-4*t*t,o=.2*Math.pow(t,5)-2*t;return r.set(n,i,o).multiplyScalar(this.scale)},(qu.prototype=Object.create(ku.prototype)).constructor=qu,qu.prototype.getPoint=function(t,e){var r=e||new Ta,n=.4*(t=function(t,e,r){return 8*r-4}(0,0,t))*(t*t-7)*(t*t-10),i=Math.pow(t,4)-13*t*t;return r.set(n,i,.1*t*(t*t-4)*(t*t-9)*(t*t-12)).multiplyScalar(this.scale)},(Yu.prototype=Object.create(ku.prototype)).constructor=Yu,Yu.prototype.getPoint=function(t,e){var r=e||new Ta;t*=2*Math.PI;var n=Math.cos(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),i=Math.sin(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),o=.35*Math.sin(5*t);return r.set(n,i,o).multiplyScalar(this.scale)},(Zu.prototype=Object.create(ku.prototype)).constructor=Zu,Zu.prototype.getPoint=function(t,e){var r=e||new Ta,n=t*Math.PI*2,i=Math.cos(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),o=Math.sin(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),s=.2*Math.sin(9*n);return r.set(i,o,s).multiplyScalar(this.scale)},(Ju.prototype=Object.create(ku.prototype)).constructor=Ju,Ju.prototype.getPoint=function(t,e){var r=e||new Ta,n=t*Math.PI*2,i=Math.cos(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),o=Math.sin(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),s=.2*Math.sin(20*n);return r.set(i,o,s).multiplyScalar(this.scale)},(Qu.prototype=Object.create(ku.prototype)).constructor=Qu,Qu.prototype.getPoint=function(t,e){var r=e||new Ta,n=t*Math.PI*2,i=Math.cos(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),o=Math.sin(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),s=.35*Math.sin(15*n);return r.set(i,o,s).multiplyScalar(this.scale)};var Ku={findSpan:function(t,e,r){var n=r.length-t-1;if(e>=r[n])return n-1;if(e<=r[t])return t;for(var i=t,o=n,s=Math.floor((i+o)/2);e<r[s]||e>=r[s+1];)e<r[s]?o=s:i=s,s=Math.floor((i+o)/2);return s},calcBasisFunctions:function(t,e,r,n){var i=[],o=[],s=[];i[0]=1;for(var a=1;a<=r;++a){o[a]=e-n[t+1-a],s[a]=n[t+a]-e;for(var l=0,c=0;c<a;++c){var u=s[c+1],h=o[a-c],d=i[c]/(u+h);i[c]=l+u*d,l=h*d}i[a]=l}return i},calcBSplinePoint:function(t,e,r,n){for(var i=this.findSpan(t,n,e),o=this.calcBasisFunctions(i,n,t,e),s=new ja(0,0,0,0),a=0;a<=t;++a){var l=r[i-t+a],c=o[a],u=l.w*c;s.x+=l.x*u,s.y+=l.y*u,s.z+=l.z*u,s.w+=l.w*c}return s},calcBasisFunctionDerivatives:function(t,e,r,n,i){for(var o=[],s=0;s<=r;++s)o[s]=0;var a=[];for(s=0;s<=n;++s)a[s]=o.slice(0);var l=[];for(s=0;s<=r;++s)l[s]=o.slice(0);l[0][0]=1;for(var c=o.slice(0),u=o.slice(0),h=1;h<=r;++h){c[h]=e-i[t+1-h],u[h]=i[t+h]-e;for(var d=0,p=0;p<h;++p){var f=u[p+1],m=c[h-p];l[h][p]=f+m;var v=l[p][h-1]/l[h][p];l[p][h]=d+f*v,d=m*v}l[h][h]=d}for(h=0;h<=r;++h)a[0][h]=l[h][r];for(p=0;p<=r;++p){var g=0,y=1,x=[];for(s=0;s<=r;++s)x[s]=o.slice(0);x[0][0]=1;for(var b=1;b<=n;++b){var w=0,_=p-b,S=r-b;p>=b&&(x[y][0]=x[g][0]/l[S+1][_],w=x[y][0]*l[_][S]);var T=p-1<=S?b-1:r-p;for(h=_>=-1?1:-_;h<=T;++h)x[y][h]=(x[g][h]-x[g][h-1])/l[S+1][_+h],w+=x[y][h]*l[_+h][S];p<=S&&(x[y][b]=-x[g][b-1]/l[S+1][p],w+=x[y][b]*l[p][S]),a[b][p]=w,h=g,g=y,y=h}}for(p=r,b=1;b<=n;++b){for(h=0;h<=r;++h)a[b][h]*=p;p*=r-b}return a},calcBSplineDerivatives:function(t,e,r,n,i){for(var o=i<t?i:t,s=[],a=this.findSpan(t,n,e),l=this.calcBasisFunctionDerivatives(a,n,t,o,e),c=[],u=0;u<r.length;++u){var h=(p=r[u].clone()).w;p.x*=h,p.y*=h,p.z*=h,c[u]=p}for(var d=0;d<=o;++d){for(var p=c[a-t].clone().multiplyScalar(l[d][0]),f=1;f<=t;++f)p.add(c[a-t+f].clone().multiplyScalar(l[d][f]));s[d]=p}for(d=o+1;d<=i+1;++d)s[d]=new ja(0,0,0);return s},calcKoverI:function(t,e){for(var r=1,n=2;n<=t;++n)r*=n;var i=1;for(n=2;n<=e;++n)i*=n;for(n=2;n<=t-e;++n)i*=n;return r/i},calcRationalCurveDerivatives:function(t){for(var e=t.length,r=[],n=[],i=0;i<e;++i){var o=t[i];r[i]=new Ta(o.x,o.y,o.z),n[i]=o.w}for(var s=[],a=0;a<e;++a){var l=r[a].clone();for(i=1;i<=a;++i)l.sub(s[a-i].clone().multiplyScalar(this.calcKoverI(a,i)*n[i]));s[a]=l.divideScalar(n[0])}return s},calcNURBSDerivatives:function(t,e,r,n,i){var o=this.calcBSplineDerivatives(t,e,r,n,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(t,e,r,n,i,o,s){for(var a=this.findSpan(t,o,r),l=this.findSpan(e,s,n),c=this.calcBasisFunctions(a,o,t,r),u=this.calcBasisFunctions(l,s,e,n),h=[],d=0;d<=e;++d){h[d]=new ja(0,0,0,0);for(var p=0;p<=t;++p){var f=i[a-t+p][l-e+d].clone(),m=f.w;f.x*=m,f.y*=m,f.z*=m,h[d].add(f.multiplyScalar(c[p]))}}var v=new ja(0,0,0,0);for(d=0;d<=e;++d)v.add(h[d].multiplyScalar(u[d]));return v.divideScalar(v.w),new Ta(v.x,v.y,v.z)}},$u=function(t,e,r,n,i){ku.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<r.length;++o){var s=r[o];this.controlPoints[o]=new ja(s.x,s.y,s.z,s.w)}};$u.prototype=Object.create(ku.prototype),$u.prototype.constructor=$u,$u.prototype.getPoint=function(t){var e=Ku.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!=e.w&&e.divideScalar(e.w),new Ta(e.x,e.y,e.z)},$u.prototype.getTangent=function(t){var e=Ku.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),1)[1].clone();return e.normalize(),e};var th=function(t,e,r,n,i){this.degree1=t,this.degree2=e,this.knots1=r,this.knots2=n,this.controlPoints=[];for(var o=r.length-t-1,s=n.length-e-1,a=0;a<o;++a){this.controlPoints[a]=[];for(var l=0;l<s;++l){var c=i[a][l];this.controlPoints[a][l]=new ja(c.x,c.y,c.z,c.w)}}};th.prototype={constructor:th,getPoint:function(t,e){return Ku.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,this.knots1[0]+t*(this.knots1[this.knots1.length-1]-this.knots1[0]),this.knots2[0]+e*(this.knots2[this.knots2.length-1]-this.knots2[0]))}};var eh={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,r,n;e=void 0!==(t=t||{}).parent?t.parent:document.body,r=void 0!==t.id?t.id:"oldie",(n=eh.getWebGLErrorMessage()).id=r,e.appendChild(n)}};Object.assign((function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bc,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bc,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}).prototype,{update:function(){var t,e,r,n,i,o,s,a,l=new Sa,c=new Sa;return function(u){if(t!==this||e!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||o!==u.far||s!==u.zoom||a!==this.eyeSep){t=this,e=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,o=u.far,s=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(a=this.eyeSep/2)*i/e,m=i*Math.tan(_a.DEG2RAD*r*.5)/s;c.elements[12]=-a,l.elements[12]=a,p.elements[0]=2*i/((d=m*n+f)-(h=-m*n+f)),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),p.elements[0]=2*i/((d=m*n-f)-(h=-m*n-f)),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()});var rh={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit(  ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit(  );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance(  const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance(  geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance(  geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\t\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},nh={common:{diffuse:{value:new Ia(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Pa},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ka(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ia(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ia(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Pa}}},ih={basic:{uniforms:Ec.merge([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.fog]),vertexShader:rh.meshbasic_vert,fragmentShader:rh.meshbasic_frag},lambert:{uniforms:Ec.merge([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.fog,nh.lights,{emissive:{value:new Ia(0)}}]),vertexShader:rh.meshlambert_vert,fragmentShader:rh.meshlambert_frag},phong:{uniforms:Ec.merge([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.gradientmap,nh.fog,nh.lights,{emissive:{value:new Ia(0)},specular:{value:new Ia(1118481)},shininess:{value:30}}]),vertexShader:rh.meshphong_vert,fragmentShader:rh.meshphong_frag},standard:{uniforms:Ec.merge([nh.common,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.roughnessmap,nh.metalnessmap,nh.fog,nh.lights,{emissive:{value:new Ia(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:rh.meshphysical_vert,fragmentShader:rh.meshphysical_frag},points:{uniforms:Ec.merge([nh.points,nh.fog]),vertexShader:rh.points_vert,fragmentShader:rh.points_frag},dashed:{uniforms:Ec.merge([nh.common,nh.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rh.linedashed_vert,fragmentShader:rh.linedashed_frag},depth:{uniforms:Ec.merge([nh.common,nh.displacementmap]),vertexShader:rh.depth_vert,fragmentShader:rh.depth_frag},normal:{uniforms:Ec.merge([nh.common,nh.bumpmap,nh.normalmap,nh.displacementmap,{opacity:{value:1}}]),vertexShader:rh.normal_vert,fragmentShader:rh.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:rh.cube_vert,fragmentShader:rh.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rh.equirect_vert,fragmentShader:rh.equirect_frag},distanceRGBA:{uniforms:Ec.merge([nh.common,nh.displacementmap,{referencePosition:{value:new Ta},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rh.distanceRGBA_vert,fragmentShader:rh.distanceRGBA_frag},shadow:{uniforms:Ec.merge([nh.lights,nh.fog,{color:{value:new Ia(0)},opacity:{value:1}}]),vertexShader:rh.shadow_vert,fragmentShader:rh.shadow_frag}};function oh(t,e,r){var n=r||sh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function sh(t,e,r){this.path=e,this.parsedPath=r||sh.parseTrackName(e),this.node=sh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}ih.physical={uniforms:Ec.merge([ih.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:rh.meshphysical_vert,fragmentShader:rh.meshphysical_frag},Object.assign(oh.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(sh,{Composite:oh,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new sh.Composite(t,e,r):new sh(t,e,r)},sanitizeNodeName:function(){var t=new RegExp("[\\[\\]\\.:\\/]","g");return function(e){return e.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var t="[^\\[\\]\\.:\\/]",e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",t),n=/(WCOD+)?/.source.replace("WCOD",e),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t),s=new RegExp("^"+r+n+i+o+"$"),a=["material","materials","bones"];return function(t){var e=s.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==a.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(sh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=sh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var a=t[n];if(void 0!==a){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===i){i=s;break}}else{if(!t.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===i){i=s;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else console.error("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(sh.prototype,{_getValue_unbound:sh.prototype.getValue,_setValue_unbound:sh.prototype.setValue});var ah={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},lh={1003:ah.NEAREST,1004:ah.NEAREST_MIPMAP_NEAREST,1005:ah.NEAREST_MIPMAP_LINEAR,1006:ah.LINEAR,1007:ah.LINEAR_MIPMAP_NEAREST,1008:ah.LINEAR_MIPMAP_LINEAR},ch={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},uh=function(){};uh.prototype={constructor:uh,parse:function(t,e,r){(r=Object.assign({},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1},r)).animations.length>0&&(r.trs=!0);var n,i={asset:{version:"2.0",generator:"GLTFExporter"}},o=0,s=[],a=[],l=new Map,c=[],u={},h={materials:new Map,textures:new Map};function d(t,e){return t.length===e.length&&t.every(function(t,r){return t===e[r]})}function p(t){return 4*Math.ceil(t/4)}function f(t,e){e=e||0;var r=p(t.byteLength);if(r!==t.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(t)),0!==e)for(var i=t.byteLength;i<r;i++)n[i]=e;return n.buffer}return t}function m(t){return i.buffers||(i.buffers=[{byteLength:0}]),s.push(t),0}function v(t,e,n,s){var a;if(i.accessors||(i.accessors=[]),t.array.constructor===Float32Array)a=ah.FLOAT;else if(t.array.constructor===Uint32Array)a=ah.UNSIGNED_INT;else{if(t.array.constructor!==Uint16Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");a=ah.UNSIGNED_SHORT}if(void 0===n&&(n=0),void 0===s&&(s=t.count),r.truncateDrawRange&&void 0!==e&&null===e.index){var l=n+s,c=e.drawRange.count===1/0?t.count:e.drawRange.start+e.drawRange.count;n=Math.max(n,e.drawRange.start),(s=Math.min(l,c)-n)<0&&(s=0)}var u,h=function(t,e,r){for(var n={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)},i=e;i<e+r;i++)for(var o=0;o<t.itemSize;o++){var s=t.array[i*t.itemSize+o];n.min[o]=Math.min(n.min[o],s),n.max[o]=Math.max(n.max[o],s)}return n}(t,n,s);void 0!==e&&(u=t===e.index?ah.ELEMENT_ARRAY_BUFFER:ah.ARRAY_BUFFER);var d=function(t,e,r,n,s){i.bufferViews||(i.bufferViews=[]);for(var a=e===ah.UNSIGNED_SHORT?2:4,l=p(n*t.itemSize*a),c=new DataView(new ArrayBuffer(l)),u=0,h=r;h<r+n;h++)for(var d=0;d<t.itemSize;d++){var f=t.array[h*t.itemSize+d];e===ah.FLOAT?c.setFloat32(u,f,!0):e===ah.UNSIGNED_INT?c.setUint32(u,f,!0):e===ah.UNSIGNED_SHORT&&c.setUint16(u,f,!0),u+=a}var v={buffer:m(c.buffer),byteOffset:o,byteLength:l};return void 0!==s&&(v.target=s),s===ah.ARRAY_BUFFER&&(v.byteStride=t.itemSize*a),o+=l,i.bufferViews.push(v),{id:i.bufferViews.length-1,byteLength:0}}(t,a,n,s,u);return i.accessors.push({bufferView:d.id,byteOffset:d.byteOffset,componentType:a,count:s,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[t.itemSize]}),i.accessors.length-1}function g(t){if(h.textures.has(t))return h.textures.get(t);i.textures||(i.textures=[]);var e={sampler:function(t){return i.samplers||(i.samplers=[]),i.samplers.push({magFilter:lh[t.magFilter],minFilter:lh[t.minFilter],wrapS:lh[t.wrapS],wrapT:lh[t.wrapT]}),i.samplers.length-1}(t),source:function(t){i.images||(i.images=[]);var e=t.format===El?"image/png":"image/jpeg",s={mimeType:e};if(r.embedImages){var l=n=n||document.createElement("canvas");l.width=t.image.width,l.height=t.image.height,r.forcePowerOfTwoTextures&&!function(t){return _a.isPowerOfTwo(t.width)&&_a.isPowerOfTwo(t.height)}(t.image)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",t.image),l.width=_a.floorPowerOfTwo(l.width),l.height=_a.floorPowerOfTwo(l.height));var c=l.getContext("2d");!0===t.flipY&&(c.translate(0,l.height),c.scale(1,-1)),c.drawImage(t.image,0,0,l.width,l.height),!0===r.binary?a.push(new Promise(function(t){l.toBlob(function(e){(function(t){return i.bufferViews||(i.bufferViews=[]),new Promise(function(e){var r=new window.FileReader;r.readAsArrayBuffer(t),r.onloadend=function(){var t=f(r.result),n={buffer:m(t),byteOffset:o,byteLength:t.byteLength};o+=t.byteLength,i.bufferViews.push(n),e(i.bufferViews.length-1)}})})(e).then(function(e){s.bufferView=e,t()})},e)})):s.uri=l.toDataURL(e)}else s.uri=t.image.src;return i.images.push(s),i.images.length-1}(t)};i.textures.push(e);var s=i.textures.length-1;return h.textures.set(t,s),s}function y(t){if(h.materials.has(t))return h.materials.get(t);if(i.materials||(i.materials=[]),t.isShaderMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var e={pbrMetallicRoughness:{}};t.isMeshBasicMaterial?(e.extensions={KHR_materials_unlit:{}},u.KHR_materials_unlit=!0):t.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=t.color.toArray().concat([t.opacity]);if(d(r,[1,1,1,1])||(e.pbrMetallicRoughness.baseColorFactor=r),t.isMeshStandardMaterial?(e.pbrMetallicRoughness.metallicFactor=t.metalness,e.pbrMetallicRoughness.roughnessFactor=t.roughness):t.isMeshBasicMaterial?(e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9):(e.pbrMetallicRoughness.metallicFactor=.5,e.pbrMetallicRoughness.roughnessFactor=.5),(t.metalnessMap||t.roughnessMap)&&(t.metalnessMap===t.roughnessMap?e.pbrMetallicRoughness.metallicRoughnessTexture={index:g(t.metalnessMap)}:console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),t.map&&(e.pbrMetallicRoughness.baseColorTexture={index:g(t.map)}),t.isMeshBasicMaterial||t.isLineBasicMaterial||t.isPointsMaterial);else{var n=t.emissive.clone().multiplyScalar(t.emissiveIntensity).toArray();d(n,[0,0,0])||(e.emissiveFactor=n),t.emissiveMap&&(e.emissiveTexture={index:g(t.emissiveMap)})}t.normalMap&&(e.normalTexture={index:g(t.normalMap)},-1!==t.normalScale.x&&(t.normalScale.x!==t.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),e.normalTexture.scale=t.normalScale.x)),t.aoMap&&(e.occlusionTexture={index:g(t.aoMap)},1!==t.aoMapIntensity&&(e.occlusionTexture.strength=t.aoMapIntensity)),(t.transparent||t.alphaTest>0)&&(e.alphaMode=t.opacity<1?"BLEND":"MASK",t.alphaTest>0&&.5!==t.alphaTest&&(e.alphaCutoff=t.alphaTest)),t.side===il&&(e.doubleSided=!0),""!==t.name&&(e.name=t.name),i.materials.push(e);var o=i.materials.length-1;return h.materials.set(t,o),o}function x(t,e){i.animations||(i.animations=[]);for(var r=[],n=[],o=0;o<t.tracks.length;++o){var s=t.tracks[o],a=sh.parseTrackName(s.name),c=sh.findNode(e,a.nodeName),u=ch[a.propertyName];if("bones"===a.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(a.objectIndex):void 0),!c||!u)return console.warn('GLTFExporter: Could not export animation track "%s".',s.name),null;var h,d=s.values.length/s.times.length;u===ch.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=s.getInterpolation()===Ll?"STEP":"LINEAR",n.push({input:v(new za(s.times,1)),output:v(new za(s.values,d)),interpolation:h}),r.push({sampler:n.length-1,target:{node:l.get(c),path:u}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:n,channels:r}),i.animations.length-1}function b(t){var e=i.nodes[l.get(t)],r=t.skeleton,n=t.skeleton.bones[0];if(void 0===n)return null;for(var o=[],s=new Float32Array(16*r.bones.length),a=0;a<r.bones.length;++a)o.push(l.get(r.bones[a])),r.boneInverses[a].toArray(s,16*a);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:v(new za(s,16)),joints:o,skeleton:l.get(n)}),e.skin=i.skins.length-1}function w(t){if(t.isLight)return console.warn("GLTFExporter: Unsupported node type:",t.constructor.name),null;i.nodes||(i.nodes=[]);var e={};if(r.trs){var n=t.quaternion.toArray(),o=t.position.toArray(),s=t.scale.toArray();d(n,[0,0,0,1])||(e.rotation=n),d(o,[0,0,0])||(e.translation=o),d(s,[1,1,1])||(e.scale=s)}else t.updateMatrix(),d(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(e.matrix=t.matrix.elements);if(""!==t.name&&(e.name=String(t.name)),t.userData&&Object.keys(t.userData).length>0)try{e.extras=JSON.parse(JSON.stringify(t.userData))}catch(t){throw new Error("GLTFExporter: userData can't be serialized")}if(t.isMesh||t.isLine||t.isPoints?e.mesh=function(t){i.meshes||(i.meshes=[]);var e,n=t.geometry;if(t.isLineSegments)e=ah.LINES;else if(t.isLineLoop)e=ah.LINE_LOOP;else if(t.isLine)e=ah.LINE_STRIP;else if(t.isPoints)e=ah.POINTS;else{if(!n.isBufferGeometry){var o=new $a;o.fromGeometry(n),n=o}t.drawMode===Fl?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),e=ah.TRIANGLE_FAN):e=t.drawMode===Dl?t.material.wireframe?ah.LINE_STRIP:ah.TRIANGLE_STRIP:t.material.wireframe?ah.LINES:ah.TRIANGLES}var s={},a={},l=[],c=[],u={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var h in n.attributes){var d=n.attributes[h];"MORPH"!==(h=u[h]||h.toUpperCase()).substr(0,5)&&(a[h]=v(d,n))}if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var p=[],f=[],m={};if(void 0!==t.morphTargetDictionary)for(var g in t.morphTargetDictionary)m[t.morphTargetDictionary[g]]=g;for(var x=0;x<t.morphTargetInfluences.length;++x){var b={},w=!1;for(var h in n.morphAttributes)if("position"===h||"normal"===h){for(var _=n.attributes[h],S=(d=n.morphAttributes[h][x]).clone(),T=0,M=d.count;T<M;T++)S.setXYZ(T,d.getX(T)-_.getX(T),d.getY(T)-_.getY(T),d.getZ(T)-_.getZ(T));b[h.toUpperCase()]=v(S,n)}else w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);c.push(b),p.push(t.morphTargetInfluences[x]),void 0!==t.morphTargetDictionary&&f.push(m[x])}s.weights=p,f.length>0&&(s.extras={},s.extras.targetNames=f)}var A=r.forceIndices,E=Array.isArray(t.material);!A&&null===n.index&&E&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),A=!0);var C=!1;if(null===n.index&&A){for(var P=[],O=(x=0,n.attributes.position.count);x<O;x++)P[x]=x;n.setIndex(P),C=!0}var N=E?t.material:[t.material],L=E?t.geometry.groups:[{materialIndex:0,start:void 0,count:void 0}];for(x=0,O=L.length;x<O;x++){var I={mode:e,attributes:a};c.length>0&&(I.targets=c);var R=y(N[L[x].materialIndex]);null!==R&&(I.material=R),null!==n.index&&(I.indices=v(n.index,n,L[x].start,L[x].count)),l.push(I)}return C&&n.setIndex(null),s.primitives=l,i.meshes.push(s),i.meshes.length-1}(t):t.isCamera&&(e.camera=function(t){i.cameras||(i.cameras=[]);var e=t.isOrthographicCamera,r={type:e?"orthographic":"perspective"};return e?r.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:r.perspective={aspectRatio:t.aspect,yfov:_a.degToRad(t.fov)/t.aspect,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(r.name=t.type),i.cameras.push(r),i.cameras.length-1}(t)),t.isSkinnedMesh&&c.push(t),t.children.length>0){for(var a=[],u=0,h=t.children.length;u<h;u++){var p=t.children[u];if(p.visible||!1===r.onlyVisible){var f=w(p);null!==f&&a.push(f)}}a.length>0&&(e.children=a)}i.nodes.push(e);var m=i.nodes.length-1;return l.set(t,m),m}function _(t){i.scenes||(i.scenes=[],i.scene=0);var e={nodes:[]};""!==t.name&&(e.name=t.name),i.scenes.push(e);for(var n=[],o=0,s=t.children.length;o<s;o++){var a=t.children[o];if(a.visible||!1===r.onlyVisible){var l=w(a);null!==l&&n.push(l)}}n.length>0&&(e.nodes=n)}!function(t){t=t instanceof Array?t:[t];for(var e=[],n=0;n<t.length;n++)t[n]instanceof _c?_(t[n]):e.push(t[n]);for(e.length>0&&function(t){var e=new _c;e.name="AuxScene";for(var r=0;r<t.length;r++)e.children.push(t[r]);_(e)}(e),n=0;n<c.length;++n)b(c[n]);for(n=0;n<r.animations.length;++n)x(r.animations[n],t[0])}(t),Promise.all(a).then(function(){var t=new Blob(s,{type:"application/octet-stream"}),n=Object.keys(u);if(n.length>0&&(i.extensionsUsed=n),i.buffers&&i.buffers.length>0){i.buffers[0].byteLength=t.size;var o=new window.FileReader;!0===r.binary?(o.readAsArrayBuffer(t),o.onloadend=function(){var t=f(o.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,t.byteLength,!0),r.setUint32(4,5130562,!0);var n=f(function(t){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(t).buffer;for(var e=new Uint8Array(new ArrayBuffer(t.length)),r=0,n=t.length;r<n;r++){var i=t.charCodeAt(r);e[r]=i>255?32:i}return e.buffer}(JSON.stringify(i)),32),s=new DataView(new ArrayBuffer(8));s.setUint32(0,n.byteLength,!0),s.setUint32(4,1313821514,!0);var a=new ArrayBuffer(12),l=new DataView(a);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0),l.setUint32(8,12+s.byteLength+n.byteLength+r.byteLength+t.byteLength,!0);var c=new Blob([a,s,n,r,t],{type:"application/octet-stream"}),u=new window.FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){e(u.result)}}):(o.readAsDataURL(t),o.onloadend=function(){i.buffers[0].uri=o.result,e(i)})}else e(i)})}};var hh=function(){};hh.prototype={constructor:hh,parse:function(t){var e,r,n,i,o,s="",a=0,l=0,c=0,u=new Ta,h=new Ta,d=new ka,p=[];return t.traverse(function(t){t instanceof ql&&function(t){var n=0,f=0,m=0,v=t.geometry,g=new Pa;if(v instanceof Ba&&(v=(new $a).setFromObject(t)),v instanceof $a){var y=v.getAttribute("position"),x=v.getAttribute("normal"),b=v.getAttribute("uv"),w=v.getIndex();if(s+="o "+t.name+"\n",t.material&&t.material.name&&(s+="usemtl "+t.material.name+"\n"),void 0!==y)for(e=0,i=y.count;e<i;e++,n++)u.x=y.getX(e),u.y=y.getY(e),u.z=y.getZ(e),u.applyMatrix4(t.matrixWorld),s+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==b)for(e=0,i=b.count;e<i;e++,m++)d.x=b.getX(e),d.y=b.getY(e),s+="vt "+d.x+" "+d.y+"\n";if(void 0!==x)for(g.getNormalMatrix(t.matrixWorld),e=0,i=x.count;e<i;e++,f++)h.x=x.getX(e),h.y=x.getY(e),h.z=x.getZ(e),h.applyMatrix3(g),s+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==w)for(e=0,i=w.count;e<i;e+=3){for(o=0;o<3;o++)r=w.getX(e+o)+1,p[o]=a+r+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");s+="f "+p.join(" ")+"\n"}else for(e=0,i=y.count;e<i;e+=3){for(o=0;o<3;o++)p[o]=a+(r=e+o+1)+(x||b?"/"+(b?l+r:"")+(x?"/"+(c+r):""):"");s+="f "+p.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",v);a+=n,l+=m,c+=f}(t),t instanceof Yl&&function(t){var o=0,l=t.geometry,c=t.type;if(l instanceof Ba&&(l=(new $a).setFromObject(t)),l instanceof $a){var h=l.getAttribute("position");if(s+="o "+t.name+"\n",void 0!==h)for(e=0,i=h.count;e<i;e++,o++)u.x=h.getX(e),u.y=h.getY(e),u.z=h.getZ(e),u.applyMatrix4(t.matrixWorld),s+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(s+="l ",r=1,i=h.count;r<=i;r++)s+=a+r+" ";s+="\n"}if("LineSegments"===c)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)s+="l "+(a+r)+" "+(a+n)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",l);a+=o}(t)}),s}};var dh=function(){};dh.prototype={constructor:dh,parse:function(t,e){!0!==Array.isArray(e)&&(e=[]);var r=-1===e.indexOf("normal"),n=-1===e.indexOf("color"),i=-1===e.indexOf("uv"),o=0,s=0,a="",l="",c=new Ta,u=new Pa;t.traverse(function(t){if(t instanceof ql){var e=t,h=e.geometry;if(h instanceof Ba&&(h=(new $a).setFromObject(e)),h instanceof $a){var d=h.getAttribute("position"),p=h.getAttribute("normal"),f=h.getAttribute("uv"),m=h.getAttribute("color"),v=h.getIndex();if(u.getNormalMatrix(e.matrixWorld),void 0===d)return;for(y=0,x=d.count;y<x;y++){c.x=d.getX(y),c.y=d.getY(y),c.z=d.getZ(y),c.applyMatrix4(e.matrixWorld);var g=c.x+" "+c.y+" "+c.z;!0===r&&(void 0!==p?(c.x=p.getX(y),c.y=p.getY(y),c.z=p.getZ(y),c.applyMatrix3(u),g+=" "+c.x+" "+c.y+" "+c.z):g+=" 0 0 0"),!0===i&&(void 0!==f?g+=" "+f.getX(y)+" "+f.getY(y):!1!==i&&(g+=" 0 0")),!0===n&&(g+=void 0!==m?" "+Math.floor(m.getX(y))+" "+Math.floor(m.getY(y))+" "+Math.floor(m.getZ(y)):" 255 255 255"),a+=g+"\n"}if(null!==v)for(y=0,x=v.count;y<x;y+=3)l+="3 "+(v.getX(y+0)+o),l+=" "+(v.getX(y+1)+o),l+=" "+(v.getX(y+2)+o)+"\n";else for(var y=0,x=d.count;y<x;y+=3)l+="3 "+(o+y)+" "+(o+y+1)+" "+(o+y+2)+"\n";o+=d.count,s+=v?v.count/3:d.count/3}}});var h="ply\nformat ascii 1.0\nelement vertex "+o+"\nproperty float x\nproperty float y\nproperty float z\n";return!0===r&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),!0===i&&(h+="property float s\nproperty float t\n"),!0===n&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),h+"element face "+s+"\nproperty list uchar int vertex_index\nend_header\n"+a+"\n"+l+"\n"}};var ph=function(){};ph.prototype={constructor:ph,parse:function(){var t=new Ta,e=new Pa;return function(r){var n=[],i=0;r.traverse(function(t){if(t instanceof ql){var e=t.geometry;e instanceof $a&&(e=(new Ba).fromBufferGeometry(e)),e instanceof Ba&&(i+=e.faces.length,n.push({geometry:e,matrix:t.matrixWorld}))}});var o=80,s=new ArrayBuffer(2*i+3*i*4*4+80+4),a=new DataView(s);return a.setUint32(o,i,!0),o+=4,n.forEach(function(r){var n=r.geometry.vertices,i=r.geometry.faces;e.getNormalMatrix(r.matrix);for(var s=0,l=i.length;s<l;s++){var c=i[s];t.copy(c.normal).applyMatrix3(e).normalize(),a.setFloat32(o,t.x,!0),a.setFloat32(o+=4,t.y,!0),a.setFloat32(o+=4,t.z,!0),o+=4;for(var u=[c.a,c.b,c.c],h=0;h<3;h++)t.copy(n[u[h]]).applyMatrix4(r.matrix),a.setFloat32(o,t.x,!0),a.setFloat32(o+=4,t.y,!0),a.setFloat32(o+=4,t.z,!0),o+=4;a.setUint16(o,0,!0),o+=2}}),a}}()};var fh=function(){};fh.prototype={constructor:fh,parse:function(){var t=new Ta,e=new Pa;return function(r){var n="";return n+="solid exported\n",r.traverse(function(r){if(r instanceof ql){var i=r.geometry,o=r.matrixWorld;if(i instanceof $a&&(i=(new Ba).fromBufferGeometry(i)),i instanceof Ba){var s=i.vertices,a=i.faces;e.getNormalMatrix(o);for(var l=0,c=a.length;l<c;l++){var u=a[l];t.copy(u.normal).applyMatrix3(e).normalize(),n+="\tfacet normal "+t.x+" "+t.y+" "+t.z+"\n",n+="\t\touter loop\n";for(var h=[u.a,u.b,u.c],d=0;d<3;d++)t.copy(s[h[d]]).applyMatrix4(o),n+="\t\t\tvertex "+t.x+" "+t.y+" "+t.z+"\n";n+="\t\tendloop\n",n+="\tendfacet\n"}}}}),n+="endsolid exported\n"}}()};var mh=function(){};function vh(t,e,r,n){$a.call(this);var i=[],o=[],s=[],a=new Ta,l=new Sa;l.makeRotationFromEuler(r),l.setPosition(e);var c=(new Sa).getInverse(l);function u(e,r,n){r.applyMatrix4(t.matrix),r.applyMatrix4(c),e.push(new gh(r.clone(),n.clone()))}function h(t,e){for(var r=[],i=.5*Math.abs(n.dot(e)),o=0;o<t.length;o+=3){var s,a,l,c,u,h,p,f=t[o+0].position.dot(e)-i;switch(a=t[o+1].position.dot(e)-i>0,l=t[o+2].position.dot(e)-i>0,((s=f>0)?1:0)+(a?1:0)+(l?1:0)){case 0:r.push(t[o]),r.push(t[o+1]),r.push(t[o+2]);break;case 1:if(s&&(u=t[o+2],h=d(t[o],c=t[o+1],e,i),p=d(t[o],u,e,i)),a){u=t[o+2],h=d(t[o+1],c=t[o],e,i),p=d(t[o+1],u,e,i),r.push(h),r.push(u.clone()),r.push(c.clone()),r.push(u.clone()),r.push(h.clone()),r.push(p);break}l&&(u=t[o+1],h=d(t[o+2],c=t[o],e,i),p=d(t[o+2],u,e,i)),r.push(c.clone()),r.push(u.clone()),r.push(h),r.push(p),r.push(h.clone()),r.push(u.clone());break;case 2:s||(u=d(c=t[o].clone(),t[o+1],e,i),h=d(c,t[o+2],e,i),r.push(c),r.push(u),r.push(h)),a||(u=d(c=t[o+1].clone(),t[o+2],e,i),h=d(c,t[o],e,i),r.push(c),r.push(u),r.push(h)),l||(u=d(c=t[o+2].clone(),t[o],e,i),h=d(c,t[o+1],e,i),r.push(c),r.push(u),r.push(h))}}return r}function d(t,e,r,n){var i=t.position.dot(r)-n,o=i/(i-(e.position.dot(r)-n));return new gh(new Ta(t.position.x+o*(e.position.x-t.position.x),t.position.y+o*(e.position.y-t.position.y),t.position.z+o*(e.position.z-t.position.z)),new Ta(t.normal.x+o*(e.normal.x-t.normal.x),t.normal.y+o*(e.normal.y-t.normal.y),t.normal.z+o*(e.normal.z-t.normal.z)))}!function(){var e,r=new $a,c=[],d=new Ta,p=new Ta;t.geometry.isGeometry?r.fromGeometry(t.geometry):r.copy(t.geometry);var f=r.attributes.position,m=r.attributes.normal;if(null!==r.index){var v=r.index;for(e=0;e<v.count;e++)d.fromBufferAttribute(f,v.getX(e)),p.fromBufferAttribute(m,v.getX(e)),u(c,d,p)}else for(e=0;e<f.count;e++)d.fromBufferAttribute(f,e),p.fromBufferAttribute(m,e),u(c,d,p);for(c=h(c=h(c=h(c=h(c=h(c=h(c,a.set(1,0,0)),a.set(-1,0,0)),a.set(0,1,0)),a.set(0,-1,0)),a.set(0,0,1)),a.set(0,0,-1)),e=0;e<c.length;e++){var g=c[e];s.push(.5+g.position.x/n.x,.5+g.position.y/n.y),g.position.applyMatrix4(l),i.push(g.position.x,g.position.y,g.position.z),o.push(g.normal.x,g.normal.y,g.normal.z)}}(),this.addAttribute("position",new Za(i,3)),this.addAttribute("normal",new Za(o,3)),this.addAttribute("uv",new Za(s,2))}function gh(t,e){this.position=t,this.normal=e}mh.prototype={constructor:mh,parse:function(t){var e={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},r=["vertices","normals","uvs"];for(var n in r){for(var i=r[n],o=t[i],s=[],a=0,l=o.length;a<l;a++)s[a]=o[a];e[i]=s}var c=t.boundingSphere;return null!==c&&(e.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}},(vh.prototype=Object.create($a.prototype)).constructor=vh,gh.prototype.clone=function(){return new gh(this.position.clone(),this.normal.clone())};var yh=function(t,e,r,n,i,o,s){var a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],l=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];$a.call(this),t=t||50,e=void 0!==e?Math.max(2,Math.floor(e)||10):10,r=void 0===r||r,n=void 0===n||n,i=void 0===i||i,o=void 0===o||o;var c=3.15*((s=void 0===s||s)?1:1.3)/2,u=t/c,h=r?(8*e-4)*e:0;h+=n?(16*e-4)*e:0,h+=i?40*e*e:0;var d=new Uint32Array(3*h),p=r?4:0;p+=n?8:0,p+=i?20:0,p*=(e+1)*(e+1);var f=new Float32Array(3*p),m=new Float32Array(3*p),v=new Float32Array(2*p),g=new Sa;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,x,b,w,_,S,T,M,A,E,C,P,O,N,L,I,R=[],D=[],F=[],k=[],U=[],B=[],j=[],z=[],V=[],G=new Ta,H=0,W=0,X=new Ta,q=new Sa,Y=new Sa,Z=new ja,J=new ja,Q=new ja,K=new ja,$=new Ta,tt=new Ta,et=g.clone();et.transpose();var rt=function(t,e,r){return!(f[3*t]===f[3*e]&&f[3*t+1]===f[3*e+1]&&f[3*t+2]===f[3*e+2]||f[3*t]===f[3*r]&&f[3*t+1]===f[3*r+1]&&f[3*t+2]===f[3*r+2]||f[3*e]===f[3*r]&&f[3*e+1]===f[3*r+1]&&f[3*e+2]===f[3*r+2])};for(y=0;y<3;y++)B[y]=new Sa;var nt=r?32:28;T=e+1;for(var it=0,ot=0,st=0,at=0,lt=0,ct=i?0:20;ct<nt;ct++)if(n||ct<20||ct>=28){for(y=0;y<3;y++){for(x=0;x<4;x++)for(b=0;b<4;b++)R[4*b+x]=l[3*a[16*ct+4*x+b]+y],o&&ct>=20&&ct<28&&2!==y&&(R[4*b+x]*=1.077),s||2!==y||(R[4*b+x]*=1.3);q.set(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],R[8],R[9],R[10],R[11],R[12],R[13],R[14],R[15]),Y.multiplyMatrices(q,g),B[y].multiplyMatrices(et,Y)}for(_=0;_<=e;_++)for(M=_/e,S=0;S<=e;S++){for(A=S/e,P=4,E=C=1;P--;)D[P]=E,F[P]=C,E*=M,C*=A,3===P?(k[P]=U[P]=0,H=W=1):(k[P]=H*(3-P),U[P]=W*(3-P),H*=M,W*=A);for(Z.fromArray(D),J.fromArray(F),Q.fromArray(k),K.fromArray(U),y=0;y<3;y++)(w=Z.clone()).applyMatrix4(B[y]),j[y]=w.dot(J),(w=Q.clone()).applyMatrix4(B[y]),z[y]=w.dot(J),(w=Z.clone()).applyMatrix4(B[y]),V[y]=w.dot(K);$.fromArray(z),tt.fromArray(V),G.crossVectors(tt,$),G.normalize(),0===j[0]&&0===j[1]?X.set(0,j[2]>c?1:-1,0):X.set(G.x,G.z,-G.y),f[ot++]=u*j[0],f[ot++]=u*(j[2]-c),f[ot++]=-u*j[1],m[st++]=X.x,m[st++]=X.y,m[st++]=X.z,v[at++]=1-A,v[at++]=1-M}for(_=0;_<e;_++)for(S=0;S<e;S++)I=(O=it*T*T+_*T+S)+T,rt(O,N=O+1,L=N+T)&&(d[lt++]=O,d[lt++]=N,d[lt++]=L),rt(O,L,I)&&(d[lt++]=O,d[lt++]=L,d[lt++]=I);it++}this.setIndex(new za(d,1)),this.addAttribute("position",new za(f,3)),this.addAttribute("normal",new za(m,3)),this.addAttribute("uv",new za(v,2)),this.computeBoundingSphere()};function xh(t,e,r,n,i,o,s,a,l,c,u,h){Mc.call(this,null,o,s,a,l,c,n,i,u,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:bl,this.minFilter=void 0!==c?c:bl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function bh(t,e){Na.call(this),this.type="Points",this.geometry=void 0!==t?t:new $a,this.material=void 0!==e?e:new Xc({color:16777215*Math.random()})}(yh.prototype=Object.create($a.prototype)).constructor=yh,(xh.prototype=Object.create(Mc.prototype)).constructor=xh,xh.prototype.isDataTexture=!0,bh.prototype=Object.assign(Object.create(Na.prototype),{constructor:bh,isPoints:!0,raycast:function(){var t=new Sa,e=new Gl,r=new Fa;return function(n,i){var o=this,s=this.geometry,a=this.matrixWorld,l=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(a),r.radius+=l,!1!==n.ray.intersectsSphere(r)){t.getInverse(a),e.copy(n.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Ta,d=new Ta;if(s.isBufferGeometry){var p=s.index,f=s.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];h.fromArray(f,3*y),w(h,y)}else{v=0;for(var x=f.length/3;v<x;v++)h.fromArray(f,3*v),w(h,v)}}else{var b=s.vertices;for(v=0,x=b.length;v<x;v++)w(b[v],v)}}function w(t,r){var s=e.distanceSqToPoint(t);if(s<u){e.closestPointToPoint(t,d),d.applyMatrix4(a);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:d.clone(),index:r,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var wh=function(t){Na.apply(this,arguments),this.PARTICLE_COUNT=(t=t||{}).maxParticles||1e6,this.PARTICLE_CONTAINERS=t.containerCount||1,this.PARTICLE_NOISE_TEXTURE=t.particleNoiseTex||null,this.PARTICLE_SPRITE_TEXTURE=t.particleSpriteTex||null,this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS),this.PARTICLE_CURSOR=0,this.time=0,this.particleContainers=[],this.rand=[];var e,r={vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tv.x = ( velocity.x - 0.5 ) * 3.0;","\tv.y = ( velocity.y - 0.5 ) * 3.0;","\tv.z = ( velocity.z - 0.5 ) * 3.0;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0. && v.y < .05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};for(e=1e5;e>0;e--)this.rand.push(Math.random()-.5);this.random=function(){return++e>=this.rand.length?this.rand[e=1]:this.rand[e]};var n=new Kc;this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||n.load("textures/perlin-512.png"),this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=gl,this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||n.load("textures/particle2.png"),this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=gl,this.particleShaderMat=new Cc({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:this.particleNoiseTex},tSprite:{value:this.particleSpriteTex}},blending:2,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],this.init=function(){for(var t=0;t<this.PARTICLE_CONTAINERS;t++){var e=new _h(this.PARTICLES_PER_CONTAINER,this);this.particleContainers.push(e),this.add(e)}},this.spawnParticle=function(t){this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=1),this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)].spawnParticle(t)},this.update=function(t){for(var e=0;e<this.PARTICLE_CONTAINERS;e++)this.particleContainers[e].update(t)},this.dispose=function(){this.particleShaderMat.dispose(),this.particleNoiseTex.dispose(),this.particleSpriteTex.dispose();for(var t=0;t<this.PARTICLE_CONTAINERS;t++)this.particleContainers[t].dispose()},this.init()};(wh.prototype=Object.create(Na.prototype)).constructor=wh;var _h=function(t,e){Na.apply(this,arguments),this.PARTICLE_COUNT=t||1e5,this.PARTICLE_CURSOR=0,this.time=0,this.offset=0,this.count=0,this.DPR=window.devicePixelRatio,this.GPUParticleSystem=e,this.particleUpdate=!1,this.particleShaderGeo=new $a,this.particleShaderGeo.addAttribute("position",new za(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("positionStart",new za(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("startTime",new za(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("velocity",new za(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("turbulence",new za(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("color",new za(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("size",new za(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("lifeTime",new za(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var r=new Ta,n=new Ta,i=new Ia;this.spawnParticle=function(t){var o=this.particleShaderGeo.getAttribute("positionStart"),s=this.particleShaderGeo.getAttribute("startTime"),a=this.particleShaderGeo.getAttribute("velocity"),l=this.particleShaderGeo.getAttribute("turbulence"),c=this.particleShaderGeo.getAttribute("color"),u=this.particleShaderGeo.getAttribute("size"),h=this.particleShaderGeo.getAttribute("lifeTime");r=void 0!==(t=t||{}).position?r.copy(t.position):r.set(0,0,0),n=void 0!==t.velocity?n.copy(t.velocity):n.set(0,0,0),i=i.set(void 0!==t.color?t.color:16777215);var d=void 0!==t.positionRandomness?t.positionRandomness:0,p=void 0!==t.velocityRandomness?t.velocityRandomness:0,f=void 0!==t.colorRandomness?t.colorRandomness:1,m=void 0!==t.turbulence?t.turbulence:1,v=void 0!==t.lifetime?t.lifetime:5,g=void 0!==t.size?t.size:10,y=void 0!==t.sizeRandomness?t.sizeRandomness:0,x=void 0!==t.smoothPosition&&t.smoothPosition;void 0!==this.DPR&&(g*=this.DPR);var b=this.PARTICLE_CURSOR;o.array[3*b+0]=r.x+e.random()*d,o.array[3*b+1]=r.y+e.random()*d,o.array[3*b+2]=r.z+e.random()*d,!0===x&&(o.array[3*b+0]+=-n.x*e.random(),o.array[3*b+1]+=-n.y*e.random(),o.array[3*b+2]+=-n.z*e.random());var w=n.x+e.random()*p,_=n.y+e.random()*p,S=n.z+e.random()*p;w=_a.clamp((w- -2)/4,0,1),_=_a.clamp((_- -2)/4,0,1),S=_a.clamp((S- -2)/4,0,1),a.array[3*b+0]=w,a.array[3*b+1]=_,a.array[3*b+2]=S,i.r=_a.clamp(i.r+e.random()*f,0,1),i.g=_a.clamp(i.g+e.random()*f,0,1),i.b=_a.clamp(i.b+e.random()*f,0,1),c.array[3*b+0]=i.r,c.array[3*b+1]=i.g,c.array[3*b+2]=i.b,l.array[b]=m,u.array[b]=g+e.random()*y,h.array[b]=v,s.array[b]=this.time+.02*e.random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0},this.init=function(){this.particleSystem=new bh(this.particleShaderGeo,this.particleShaderMat),this.particleSystem.frustumCulled=!1,this.add(this.particleSystem)},this.update=function(t){this.time=t,this.particleShaderMat.uniforms.uTime.value=t,this.geometryUpdate()},this.geometryUpdate=function(){if(!0===this.particleUpdate){this.particleUpdate=!1;var t=this.particleShaderGeo.getAttribute("positionStart"),e=this.particleShaderGeo.getAttribute("startTime"),r=this.particleShaderGeo.getAttribute("velocity"),n=this.particleShaderGeo.getAttribute("turbulence"),i=this.particleShaderGeo.getAttribute("color"),o=this.particleShaderGeo.getAttribute("size"),s=this.particleShaderGeo.getAttribute("lifeTime");this.offset+this.count<this.PARTICLE_COUNT?(t.updateRange.offset=this.offset*t.itemSize,e.updateRange.offset=this.offset*e.itemSize,r.updateRange.offset=this.offset*r.itemSize,n.updateRange.offset=this.offset*n.itemSize,i.updateRange.offset=this.offset*i.itemSize,o.updateRange.offset=this.offset*o.itemSize,s.updateRange.offset=this.offset*s.itemSize,t.updateRange.count=this.count*t.itemSize,e.updateRange.count=this.count*e.itemSize,r.updateRange.count=this.count*r.itemSize,n.updateRange.count=this.count*n.itemSize,i.updateRange.count=this.count*i.itemSize,o.updateRange.count=this.count*o.itemSize,s.updateRange.count=this.count*s.itemSize):(t.updateRange.offset=0,e.updateRange.offset=0,r.updateRange.offset=0,n.updateRange.offset=0,i.updateRange.offset=0,o.updateRange.offset=0,s.updateRange.offset=0,t.updateRange.count=-1,e.updateRange.count=-1,r.updateRange.count=-1,n.updateRange.count=-1,i.updateRange.count=-1,o.updateRange.count=-1,s.updateRange.count=-1),t.needsUpdate=!0,e.needsUpdate=!0,r.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0,o.needsUpdate=!0,s.needsUpdate=!0,this.offset=0,this.count=0}},this.dispose=function(){this.particleShaderGeo.dispose()},this.init()};_h.prototype=Object.create(Na.prototype),_h.prototype.constructor=_h;var Sh=function(){Na.call(this)};function Th(){$a.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Mh(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ah(t,e,r){Mh.call(this,t,e),this.meshPerAttribute=r||1}function Eh(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function Ch(t){$a.call(this),this.type="WireframeGeometry";var e,r,n,i,o,s,a,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var v=m[e];for(r=0;r<3;r++)a=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)h.push((u=t.vertices[(s=p[c]).index1]).x,u.y,u.z),h.push((u=t.vertices[s.index2]).x,u.y,u.z)}else if(t&&t.isBufferGeometry){var g,y,x,b,w;if(u=new Ta,null!==t.index){for(g=t.attributes.position,y=t.index,0===(x=t.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(e=w=(b=x[i]).start,n=w+b.count;e<n;e+=3)for(r=0;r<3;r++)a=y.getX(e+r),l=y.getX(e+(r+1)%3),d[0]=Math.min(a,l),d[1]=Math.max(a,l),void 0===p[c=d[0]+","+d[1]]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)u.fromBufferAttribute(g,(s=p[c]).index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,s.index2),h.push(u.x,u.y,u.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)u.fromBufferAttribute(g,3*e+r),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,3*e+(r+1)%3),h.push(u.x,u.y,u.z)}this.addAttribute("position",new Za(h,3))}(Sh.prototype=Object.create(Na.prototype)).constructor=Sh,Sh.prototype.updateMatrixWorld=function(){var t=new Ta,e=new Ma,r=new Ta,n=new Ta,i=new Ma,o=new Ta;return function(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,i,o),this.matrix.decompose(t,e,r),this.matrixWorld.compose(n,e,o)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);for(var a=0,l=this.children.length;a<l;a++)this.children[a].updateMatrixWorld(s)}}(),Th.prototype=Object.assign(Object.create($a.prototype),{constructor:Th,isInstancedBufferGeometry:!0,copy:function(t){return $a.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperty(Mh.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Mh.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Ah.prototype=Object.assign(Object.create(Mh.prototype),{constructor:Ah,isInstancedInterleavedBuffer:!0,copy:function(t){return Mh.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.defineProperties(Eh.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Eh.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),(Ch.prototype=Object.create($a.prototype)).constructor=Ch;var Ph=function(){Th.call(this),this.type="LineSegmentsGeometry",new $a,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new Za([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new Za([0,1,1,1,0,.5,1,.5,0,.5,1,.5,0,0,1,0],2))};Ph.prototype=Object.assign(Object.create(Th.prototype),{constructor:Ph,isLineSegmentsGeometry:!0,applyMatrix:function(t){var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(r),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new Ah(e,6,1);return this.addAttribute("instanceStart",new Eh(r,3,0)),this.addAttribute("instanceEnd",new Eh(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new Ah(e,6,1);return this.addAttribute("instanceColorStart",new Eh(r,3,0)),this.addAttribute("instanceColorEnd",new Eh(r,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new Ch(t.geometry)),this},fromLineSegements:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},computeBoundingBox:function(){var t=new Da;return function(){null===this.boundingBox&&(this.boundingBox=new Da);var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;void 0!==e&&void 0!==r&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(r),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new Ta;return function(){null===this.boundingSphere&&(this.boundingSphere=new Fa),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==e&&void 0!==r){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var i=0,o=0,s=e.count;o<s;o++)t.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(t)),t.fromBufferAttribute(r,o),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},clone:function(){},copy:function(t){return this}}),nh.line={linewidth:{value:1},resolution:{value:new ka(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ih.line={uniforms:Ec.merge([nh.common,nh.fog,nh.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( vUv.y < 0.5 || vUv.y > 0.5 ) {\n\n\t\t\t\tfloat a = vUv.x - 0.5;\n\t\t\t\tfloat b = vUv.y - 0.5;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 0.25 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var Oh=function(t){Cc.call(this,{type:"LineMaterial",uniforms:Ec.clone(ih.line.uniforms),vertexShader:ih.line.vertexShader,fragmentShader:ih.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};(Oh.prototype=Object.create(Cc.prototype)).constructor=Oh,Oh.prototype.isLineMaterial=!0,Oh.prototype.copy=function(t){return Cc.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.resolution=t.resolution,this};var Nh=function(t,e){ql.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new Ph,this.material=void 0!==e?e:new Oh({color:16777215*Math.random()})};Nh.prototype=Object.assign(Object.create(ql.prototype),{constructor:Nh,isLineSegments2:!0,computeLineDistances:function(){var t=new Ta,e=new Ta;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),s=0,a=0,l=n.data.count;s<l;s++,a+=2)t.fromBufferAttribute(n,s),e.fromBufferAttribute(i,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+t.distanceTo(e);var c=new Ah(o,2,1);return r.addAttribute("instanceDistanceStart",new Eh(c,1,0)),r.addAttribute("instanceDistanceEnd",new Eh(c,1,1)),this}}(),copy:function(t){return this}});var Lh=function(){Ph.call(this),this.type="LineGeometry"};Lh.prototype=Object.assign(Object.create(Ph.prototype),{constructor:Lh,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return Ph.prototype.setPositions.call(this,r),this},setColors:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return Ph.prototype.setColors.call(this,r),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(t){return this}});var Ih=function(t,e){Nh.call(this),this.type="Line2",this.geometry=void 0!==t?t:new Lh,this.material=void 0!==e?e:new Oh({color:16777215*Math.random()})};Ih.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Ih,isLine2:!0,copy:function(t){return this}});var Rh=function(t,e){ql.call(this),this.type="Wireframe",this.geometry=void 0!==t?t:new Ph,this.material=void 0!==e?e:new Oh({color:16777215*Math.random()})};Rh.prototype=Object.assign(Object.create(ql.prototype),{constructor:Rh,isWireframe:!0,computeLineDistances:function(){var t=new Ta,e=new Ta;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count),s=0,a=0,l=n.data.count;s<l;s++,a+=2)t.fromBufferAttribute(n,s),e.fromBufferAttribute(i,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+t.distanceTo(e);var c=new Ah(o,2,1);return r.addAttribute("instanceDistanceStart",new Eh(c,1,0)),r.addAttribute("instanceDistanceEnd",new Eh(c,1,1)),this}}(),copy:function(t){return this}});var Dh=function(t){Ph.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new Ch(t))};function Fh(){Na.call(this),this.type="Group"}Dh.prototype=Object.assign(Object.create(Ph.prototype),{constructor:Dh,isWireframeGeometry2:!0,copy:function(t){return this}}),Fh.prototype=Object.assign(Object.create(Na.prototype),{constructor:Fh,isGroup:!0});var kh=function(t){this.manager=void 0!==t?t:Dc,this.availableExtensions=[]};kh.prototype={constructor:kh,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=this;function r(t){var e={type:t.getAttribute("type")},r=t.getAttribute("id");r&&(e.id=r);var n=t.getAttribute("pid");n&&(e.pid=n);var i=t.getAttribute("pindex");i&&(e.pindex=i);var o=t.getAttribute("thumbnail");o&&(e.thumbnail=o);var s=t.getAttribute("partnumber");s&&(e.partnumber=s);var a=t.getAttribute("name");a&&(e.name=a);var l=t.querySelector("mesh");return l&&(e.mesh=function(t,e){for(var r={},n=[],i=t.querySelectorAll("vertices vertex"),o=0;o<i.length;o++){var s=i[o],a=s.getAttribute("x"),l=s.getAttribute("y"),c=s.getAttribute("z");n.push(parseFloat(a),parseFloat(l),parseFloat(c))}for(r.vertices=new Float32Array(n.length),o=0;o<n.length;o++)r.vertices[o]=n[o];var u=[],h=[],d=t.querySelectorAll("triangles triangle");for(o=0;o<d.length;o++){var p=d[o],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),x=p.getAttribute("p3"),b=p.getAttribute("pid");h.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var w={};g&&(w.p1=parseInt(g,10)),y&&(w.p2=parseInt(y,10)),x&&(w.p3=parseInt(x,10)),b&&(w.pid=b),0<Object.keys(w).length&&u.push(w)}for(r.triangleProperties=u,r.triangles=new Uint32Array(h.length),o=0;o<h.length;o++)r.triangles[o]=h[o];return r}(l)),t.querySelector("components")&&(e.components=void 0),e}function n(t){var e={unit:t.getAttribute("unit")||"millimeter"},n=t.querySelectorAll("metadata");n&&(e.metadata=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(e[i]=n.textContent)}return e}(n));var i=t.querySelector("resources");i&&(e.resources=function(t){var e={};t.querySelector("basematerials")&&(e.basematerial=void 0),e.object={};for(var n=t.querySelectorAll("object"),i=0;i<n.length;i++){var o=r(n[i]);e.object[o.id]=o}return e}(i));var o=t.querySelector("build");return o&&(e.build=function(t){for(var e=[],r=t.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],o={objectid:i.getAttribute("objectid")},s=i.getAttribute("transform");if(s){var a=[];s.split(" ").forEach(function(t){a.push(parseFloat(t))});var l=new Sa;o.transform=l.set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1)}e.push(o)}return e}(o)),e}function i(t,e){var r=new $a;r.setIndex(new za(t.triangles,1)),r.addAttribute("position",new za(t.vertices,3)),t.colors&&r.addAttribute("color",new za(t.colors,3)),r.computeBoundingSphere();var n={flatShading:!0};return t.colors&&0<t.colors.length?n.vertexColors=al:n.color=11184895,new ql(r,new Vc(n))}function o(t,r,n,i){if(t){for(var o=[],s=Object.keys(t),a=0;a<s.length;a++)for(var l=s[a],c=0;c<e.availableExtensions.length;c++)(u=e.availableExtensions[c]).ns===l&&o.push(u);for(a=0;a<o.length;a++){var u;(u=o[a]).apply(n,t[u.ns],r)}}}var s=function(t){var e,r,i=null,o=null,s=[],a=[],l={},c={};try{i=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.error("ThreeMFLoader: jszip missing and file is compressed."),null}for(o in i.files)o.match(/\.rels$/)?e=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures\/.*/)?a.push(o):o.match(/^3D\/Other\/.*/));var u=new Uint8Array(i.file(e).asArrayBuffer());r=function(t){var e=(new DOMParser).parseFromString(t,"application/xml").querySelector("Relationship");return{target:e.getAttribute("Target"),id:e.getAttribute("Id"),type:e.getAttribute("Type")}}(tu.decodeText(u));for(var h=0;h<s.length;h++){var d=s[h],p=new Uint8Array(i.file(d).asArrayBuffer()),f=tu.decodeText(p),m=(new DOMParser).parseFromString(f,"application/xml");"model"!==m.documentElement.nodeName.toLowerCase()&&console.error("ThreeMFLoader: Error loading 3MF - no 3MF document found: ",d);var v=m.querySelector("model"),g={};for(h=0;h<v.attributes.length;h++){var y=v.attributes[h];y.name.match(/^xmlns:(.+)$/)&&(g[y.value]=RegExp.$1)}var x=n(v);x.xml=v,0<Object.keys(g).length&&(x.extensions=g),l[d]=x}for(h=0;h<a.length;h++){var b=a[h];c[b]=i.file(b).asBinary()}return{rels:r,model:l,printTicket:{},texture:c,other:{}}}(t);return function(t,e,r){for(var n=new Fh,i=r.model[e.target.substring(1)].build,o=0;o<i.length;o++){var s=i[o],a=t[s.objectid];s.transform&&a.geometry.applyMatrix(s.transform),n.add(a)}return n}(function(t){for(var e=t.model,r={},n=Object.keys(e),s=0;s<n.length;s++)for(var a=e[n[s]],l=a.xml,c=a.extensions,u=Object.keys(a.resources.object),h=0;h<u.length;h++){var d=u[h],p=a.resources.object[d].mesh;o(c,p,l),r[d]=i(p)}return r}(s),s.rels,s)},addExtension:function(t){this.availableExtensions.push(t)}};var Uh=function(t){this.manager=void 0!==t?t:Dc};Uh.prototype={constructor:Uh,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){for(var e="AMF Material",n=t.attributes.id.textContent,i={r:1,g:1,b:1,a:1},o=null,s=0;s<t.childNodes.length;s++){var a=t.childNodes[s];"metadata"===a.nodeName&&void 0!==a.attributes.type?"name"===a.attributes.type.value&&(e=a.textContent):"color"===a.nodeName&&(i=r(a))}return o=new Vc({flatShading:!0,color:new Ia(i.r,i.g,i.b),name:e}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:n,material:o}}function r(t){for(var e={r:1,g:1,b:1,a:1},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];"r"===n.nodeName?e.r=n.textContent:"g"===n.nodeName?e.g=n.textContent:"b"===n.nodeName?e.b=n.textContent:"a"===n.nodeName&&(e.a=n.textContent)}return e}function n(t){var e={name:"",triangles:[],materialid:null},r=t.firstElementChild;for(void 0!==t.attributes.materialid&&(e.materialId=t.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(e.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,o=r.getElementsByTagName("v3")[0].textContent;e.triangles.push(n,i,o)}r=r.nextElementSibling}return e}function i(t){for(var e=[],r=[],n=t.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var o=i.getElementsByTagName("x")[0].textContent,s=i.getElementsByTagName("y")[0].textContent,a=i.getElementsByTagName("z")[0].textContent;e.push(o,s,a)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,c=i.getElementsByTagName("ny")[0].textContent,u=i.getElementsByTagName("nz")[0].textContent;r.push(l,c,u)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:e,normals:r}}function o(t){for(var e=t.attributes.id.textContent,o={name:"amfobject",meshes:[]},s=null,a=t.firstElementChild;a;){if("metadata"===a.nodeName)void 0!==a.attributes.type&&"name"===a.attributes.type.value&&(o.name=a.textContent);else if("color"===a.nodeName)s=r(a);else if("mesh"===a.nodeName){for(var l=a.firstElementChild,c={vertices:[],normals:[],volumes:[],color:s};l;){if("vertices"===l.nodeName){var u=i(l);c.normals=c.normals.concat(u.normals),c.vertices=c.vertices.concat(u.vertices)}else"volume"===l.nodeName&&c.volumes.push(n(l));l=l.nextElementSibling}o.meshes.push(c)}a=a.nextElementSibling}return{id:e,obj:o}}var s,a,l=function(t){var e=new DataView(t);if("PK"===String.fromCharCode(e.getUint8(0),e.getUint8(1))){var r=null,n=null;console.log("AMFLoader: Loading Zip");try{r=new JSZip(t)}catch(t){if(t instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(n in r.files)if(".amf"===n.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+n),e=new DataView(r.file(n).asArrayBuffer())}var i=tu.decodeText(e),o=(new DOMParser).parseFromString(i,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):o}(t),c="",u="",h=function(t){var e=1,r="millimeter";void 0!==l.documentElement.attributes.unit&&(r=l.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(e=n[r]),console.log("AMFLoader: Unit scale: "+e),e}(),d={},p={},f=l.documentElement.childNodes;for(s=0;s<f.length;s++){var m=f[s];if("metadata"===m.nodeName)void 0!==m.attributes.type&&("name"===m.attributes.type.value?c=m.textContent:"author"===m.attributes.type.value&&(u=m.textContent));else if("material"===m.nodeName){var v=e(m);d[v.id]=v.material}else if("object"===m.nodeName){var g=o(m);p[g.id]=g.obj}}var y=new Fh,x=new Vc({color:11184895,flatShading:!0});for(var b in y.name=c,y.userData.author=u,y.userData.loader="AMF",p){var w=p[b],_=w.meshes,S=new Fh;for(S.name=w.name||"",s=0;s<_.length;s++){var T=x,M=_[s],A=new Za(M.vertices,3),E=null;if(M.normals.length&&(E=new Za(M.normals,3)),M.color){var C=M.color;(T=x.clone()).color=new Ia(C.r,C.g,C.b),1!==C.a&&(T.transparent=!0,T.opacity=C.a)}var P=M.volumes;for(a=0;a<P.length;a++){var O=P[a],N=new $a,L=T;N.setIndex(O.triangles),N.addAttribute("position",A.clone()),E&&N.addAttribute("normal",E.clone()),void 0!==d[O.materialId]&&(L=d[O.materialId]),N.scale(h,h,h),S.add(new ql(N,L.clone()))}}y.add(S)}return y}};var Bh=function(t){this.manager=void 0!==t?t:Dc};function jh(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Sa)}}function zh(t,e){ql.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Sa,this.bindMatrixInverse=new Sa;var r=new jh(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}Bh.prototype={constructor:Bh,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=tu.extractUrlBase(t);new kc(this.manager).load(t,function(t){var r=JSON.parse(t),s=r.__metadata__;if("undefined"!=typeof s){if("assimp2json"!==s.format)return void n("AssimpJSONLoader: Not an assimp2json scene.");if(s.version<100&&s.version>=200)return void n("AssimpJSONLoader: Unsupported assimp2json file format version.")}e(i.parse(r,o))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function r(t,e){for(var r=new Array(t.length),n=0;n<t.length;++n)r[n]=e.call(this,t[n]);return r}var n=new Kc(this.manager);n.setPath(e).setCrossOrigin(this.crossOrigin);var i=r(t.meshes,function(t){var e,r,n,i=new $a,o=[],s=t.vertices||[],a=t.normals||[],l=t.texturecoords||[],c=t.colors||[];for(l=l[0]||[],e=0,r=t.faces.length;e<r;e++)o.push((n=t.faces[e])[0],n[1],n[2]);return i.setIndex(o),i.addAttribute("position",new Za(s,3)),a.length>0&&i.addAttribute("normal",new Za(a,3)),l.length>0&&i.addAttribute("uv",new Za(l,2)),c.length>0&&i.addAttribute("color",new Za(c,3)),i.computeBoundingSphere(),i}),o=r(t.materials,function(t){var e=new Vc;for(var r in t.properties){var i=t.properties[r],o=i.value;switch(i.key){case"$tex.file":var s=i.semantic;if(1===s||2===s||5===s||6===s){var a;switch(s){case 1:a="map";break;case 2:a="specularMap";break;case 5:a="bumpMap";break;case 6:a="normalMap"}var l=n.load(o);l.wrapS=l.wrapT=gl,e[a]=l}break;case"?mat.name":e.name=o;break;case"$clr.diffuse":e.color.fromArray(o);break;case"$clr.specular":e.specular.fromArray(o);break;case"$clr.emissive":e.emissive.fromArray(o);break;case"$mat.shininess":e.shininess=o;break;case"$mat.shadingm":e.flatShading=1===o;break;case"$mat.opacity":o<1&&(e.opacity=o,e.transparent=!0)}}return e});return function t(e,r,n,i){var o,s,a=new Na;for(a.name=r.name||"",a.matrix=(new Sa).fromArray(r.transformation).transpose(),a.matrix.decompose(a.position,a.quaternion,a.scale),o=0;r.meshes&&o<r.meshes.length;o++)a.add(new ql(n[s=r.meshes[o]],i[e.meshes[s].materialindex]));for(o=0;r.children&&o<r.children.length;o++)a.add(t(e,r.children[o],n,i));return a}(t,t.rootnode,i,o)}},Object.assign(jh.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new Sa;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new Sa,e=new Sa;return function(){for(var r=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,s=0,a=r.length;s<a;s++)t.multiplyMatrices(r[s]?r[s].matrixWorld:e,n[s]),t.toArray(i,16*s);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new jh(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),zh.prototype=Object.assign(Object.create(ql.prototype),{constructor:zh,isSkinnedMesh:!0,initBones:function(){var t,e,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)e=this.geometry.bones[r],t=new Ql,i.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(e=this.geometry.bones[r]).parent&&null!==e.parent&&void 0!==i[e.parent]?i[e.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var r=this.geometry.skinWeights[e];(t=1/r.manhattanLength())!=1/0?r.multiplyScalar(t):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new ja,i=this.geometry.attributes.skinWeight;for(e=0;e<i.count;e++)n.x=i.getX(e),n.y=i.getY(e),n.z=i.getZ(e),n.w=i.getW(e),(t=1/n.manhattanLength())!=1/0?n.multiplyScalar(t):n.set(1,0,0,0),i.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){ql.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Vh=function(t){this.manager=void 0!==t?t:Dc};function Gh(){this.id=0,this.data=null}function Hh(){}Vh.prototype={constructor:Vh,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=tu.extractUrlBase(t),s=new kc(this.manager);s.setResponseType("arraybuffer"),s.load(t,function(t){e(i.parse(t,o))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=new Kc(this.manager);r.setPath(e).setCrossOrigin(this.crossOrigin);var n={KeyFrame:function(t,e){this.time=t,this.matrix=e.clone(),this.position=new Ta,this.quaternion=new Ma,this.scale=new Ta(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new n.KeyFrame(this.time,this.matrix)},this.lerp=function(t,e){var r=(e-=this.time)/(t.time-this.time),i=1-r,o=this.position,s=this.quaternion,a=t.position,l=t.quaternion;return n.KeyFrame.tempAniPos.x=o.x*i+a.x*r,n.KeyFrame.tempAniPos.y=o.y*i+a.y*r,n.KeyFrame.tempAniPos.z=o.z*i+a.z*r,n.KeyFrame.tempAniQuat.set(s.x,s.y,s.z,s.w),n.KeyFrame.tempAniQuat.slerp(l,r),n.KeyFrame.tempAniMatrix.compose(n.KeyFrame.tempAniPos,n.KeyFrame.tempAniQuat,n.KeyFrame.tempAniScale)}}};n.KeyFrame.tempAniPos=new Ta,n.KeyFrame.tempAniQuat=new Ma,n.KeyFrame.tempAniScale=new Ta(1,1,1),n.KeyFrame.tempAniMatrix=new Sa,n.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(t){this.keys.push(t)},this.init=function(){if(this.sortKeys(),this.length=this.keys.length>0?this.keys[this.keys.length-1].time:0,this.fps)for(var t=0;t<this.length*this.fps;t++)for(var e=0;e<this.keys.length;e++){if(this.keys[e].time==t){this._accelTable[t]=e;break}if(this.keys[e].time<t/this.fps&&this.keys[e+1]&&this.keys[e+1].time>=t/this.fps){this._accelTable[t]=e;break}}},this.parseFromThree=function(t){var e=t.fps;this.target=t.node;for(var r=t.hierarchy[0].keys,i=0;i<r.length;i++)this.addKey(new n.KeyFrame(i/e||r[i].time,r[i].targets[0].data));this.init()},this.parseFromCollada=function(t){for(var e=t.keys,r=this.fps,i=0;i<e.length;i++)this.addKey(new n.KeyFrame(i/r||e[i].time,e[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(t,e){return t.time-e.time},this.clone=function(){var t=new n.KeyFrameTrack;t.target=this.target,t.time=this.time,t.length=this.length;for(var e=0;e<this.keys.length;e++)t.addKey(this.keys[e].clone());return t.init(),t},this.reTarget=function(t,e){e||(e=n.TrackTargetNodeNameCompare),this.target=e(t,this.target)},this.keySearchAccel=function(t){return t*=this.fps,t=Math.floor(t),this._accelTable[t]||0},this.setTime=function(t){t=Math.abs(t),this.length&&(t=t%this.length+.05);for(var e=null,r=null,n=this.keySearchAccel(t);n<this.keys.length;n++){if(this.keys[n].time==t){e=this.keys[n],r=this.keys[n];break}if(this.keys[n].time<t&&this.keys[n+1]&&this.keys[n+1].time>t){e=this.keys[n],r=this.keys[n+1];break}if(this.keys[n].time<t&&n==this.keys.length-1){e=this.keys[n],(r=this.keys[0].clone()).time+=this.length+.05;break}}return e&&r&&e!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.lerp(r,t)),void(this.target.matrixWorldNeedsUpdate=!0)):e&&r&&e==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},n.TrackTargetNodeNameCompare=function(t,e){return function t(e,r){if(e.name==r)return e;for(var n=0;n<e.children.length;n++){var i=t(e.children[n],r);if(i)return i}return null}(t,e.name)},n.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(t){this.tracks.push(t),this.length=Math.max(t.length,this.length)},this.setTime=function(t){this.time=t;for(var e=0;e<this.tracks.length;e++)this.tracks[e].setTime(t)},this.clone=function(t,e){e||(e=n.TrackTargetNodeNameCompare);var r=new n.Animation;r.target=t;for(var i=0;i<this.tracks.length;i++){var o=this.tracks[i].clone();o.reTarget(t,e),r.addTrack(o)}return r}};var i=4660,o=4661,s=4662,a=4663,l=4664,c=4665,u=4666,h=4667,d=4668,p=4669,f=4670,m=1,v=2,g=4,y=256,x=65536,b=1,w=4,_=1,S=3,T=1,M=6,A=8,E=10,C=4;function P(t){return y<<t}function O(t){return x<<t}function N(t,e){var r=new Ql;for(var n in r.matrix.copy(t.matrix),r.matrixWorld.copy(t.matrixWorld),r.position.copy(t.position),r.quaternion.copy(t.quaternion),r.scale.copy(t.scale),e.nodeCount++,r.name="bone_"+t.name+e.nodeCount.toString(),e.nodeToBoneMap[t.name]||(e.nodeToBoneMap[t.name]=[]),e.nodeToBoneMap[t.name].push(r),t.children){var i=N(t.children[n],e);i&&r.add(i)}return r}function L(t,e){for(var r=[],n=0;n<t.length;n++)r.push({i:t[n],w:e[n]});for(r.sort(function(t,e){return e.w-t.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var i=0;for(n=0;n<4;n++)i+=r[n].w*r[n].w;for(i=Math.sqrt(i),n=0;n<4;n++)r[n].w=r[n].w/i,t[n]=r[n].i,e[n]=r[n].w}function I(t,e){if(0==t.name.indexOf("bone_"+e))return t;for(var r in t.children){var n=I(t.children[r],e);if(n)return n}}function R(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(t,e){if(0!=this.mBones.length){for(var r=[],n=[],i=t.findNode(this.mBones[0].mName);i.mParent&&i.mParent.isBone;)i=i.mParent;var o=N(i.toTHREE(t),t);this.threeNode.add(o);for(var s=0;s<this.mBones.length;s++)if(a=I(o,this.mBones[s].mName))r.push(a),n.push(this.mBones[s].mOffsetMatrix.toTHREE());else{if(!(i=t.findNode(this.mBones[s].mName)))return;o=N(i.toTHREE(t),t),this.threeNode.add(o);var a=I(o,this.mBones[s].mName);r.push(a),n.push(this.mBones[s].mOffsetMatrix.toTHREE())}var l=new jh(r,n);this.threeNode.bind(l,new Sa),this.threeNode.material.skinning=!0}},this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e,r,n=new $a;if(e=t.mMaterials[this.mMaterialIndex]?t.mMaterials[this.mMaterialIndex].toTHREE(t):new jc,n.setIndex(new za(new Uint32Array(this.mIndexArray),1)),n.addAttribute("position",new za(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.addAttribute("normal",new za(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.addAttribute("color",new za(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.addAttribute("uv",new za(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.addAttribute("uv1",new za(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.addAttribute("tangents",new za(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.addAttribute("bitangents",new za(this.mBitangentBuffer,3)),this.mBones.length>0){for(var i=[],o=[],s=0;s<this.mBones.length;s++)for(var a=0;a<this.mBones[s].mWeights.length;a++){var l=this.mBones[s].mWeights[a];l&&(i[l.mVertexId]||(i[l.mVertexId]=[]),o[l.mVertexId]||(o[l.mVertexId]=[]),i[l.mVertexId].push(l.mWeight),o[l.mVertexId].push(parseInt(s)))}for(var s in o)L(o[s],i[s]);var c=[],u=[];for(s=0;s<i.length;s++)for(a=0;a<4;a++)i[s]&&o[s]?(c.push(i[s][a]),u.push(o[s][a])):(c.push(0),u.push(0));n.addAttribute("skinWeight",new za(new Float32Array(c),C)),n.addAttribute("skinIndex",new za(new Float32Array(u),C))}return 0==this.mBones.length&&(r=new ql(n,e)),this.mBones.length>0&&(r=new zh(n,e)),this.threeNode=r,r}}function D(){this.mNumIndices=0,this.mIndices=[]}function F(){this.data=[],this.toString=function(){var t="";return this.data.forEach(function(e){t+=String.fromCharCode(e)}),t.replace(/[^\x20-\x7E]+/g,"")}}function k(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var e=new Na;e.name=this.mName,e.matrix=this.mTransformation.toTHREE();for(var r=0;r<this.mChildren.length;r++)e.add(this.mChildren[r].toTHREE(t));for(r=0;r<this.mMeshes.length;r++)e.add(t.mMeshes[this.mMeshes[r]].toTHREE(t));return this.threeNode=e,e.matrix.decompose(e.position,e.quaternion,e.scale),e}}function U(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function B(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var t=new Uint8Array(this.mData).buffer,e=new DataView(t);return new Ia(e.getFloat32(0,!0),e.getFloat32(4,!0),e.getFloat32(8,!0))},this.dataAsFloat=function(){var t=new Uint8Array(this.mData).buffer;return new DataView(t).getFloat32(0,!0)},this.dataAsBool=function(){var t=new Uint8Array(this.mData).buffer;return!!new DataView(t).getFloat32(0,!0)},this.dataAsString=function(){var t=new F;return t.data=this.mData,t.toString()},this.dataAsMap=function(){var t=new F;t.data=this.mData;var e=t.toString();return-1!=(e=e.replace(/\\/g,"/")).indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),r.load(e)}}var j={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},z={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function V(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(t){this.mProperties[0].dataAsString();for(var e=new Vc,r=0;r<this.mProperties.length;r++)if("float"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==z[this.mProperties[r].mKey]&&(e[j[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==z[this.mProperties[r].mKey]){var n=this.mProperties[r];n.mSemantic==T&&(e.map=this.mProperties[r].dataAsMap()),n.mSemantic==M&&(e.normalMap=this.mProperties[r].dataAsMap()),n.mSemantic==E&&(e.lightMap=this.mProperties[r].dataAsMap()),n.mSemantic==A&&(e.alphaMap=this.mProperties[r].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}function G(t,e,r){var n=new Ta,i=1-r;return n.x=t.x*r+e.x*i,n.y=t.y*r+e.y*i,n.z=t.z*r+e.z*i,n}function H(t,e,r){return t.clone().slerp(e,1-r)}function W(t,e,r,n){if(1==t.length)return t[0].mValue.toTHREE();for(var i=1/0,o=null,s=null,a=0;a<t.length;a++){var l=Math.abs(t[a].mTime-e);l<i&&t[a].mTime<=e&&(i=l,o=t[a],s=t[a+1])}if(o){if(s){var c=(o.mTime-e)/(s.mTime-o.mTime);return n(o.mValue.toTHREE(),s.mValue.toTHREE(),c)}return(s=t[0].clone()).mTime+=r,c=(o.mTime-e)/(s.mTime-o.mTime),n(o.mValue.toTHREE(),s.mValue.toTHREE(),c)}return null}function X(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(t){function e(e){e.mTime/=t}t||(t=1),this.mPositionKeys.forEach(e),this.mRotationKeys.forEach(e),this.mScalingKeys.forEach(e)},this.sortKeys=function(){function t(t,e){return t.mTime-e.mTime}this.mPositionKeys.sort(t),this.mRotationKeys.sort(t),this.mScalingKeys.sort(t)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(t){return t.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(t){return t.mTime})))},this.toTHREE=function(t,e){this.sortKeys();for(var r=this.getLength(),i=new n.KeyFrameTrack,o=0;o<r;o+=.05){var s=new Sa,a=o,l=W(this.mPositionKeys,a,r,G),c=W(this.mScalingKeys,a,r,G),u=W(this.mRotationKeys,a,r,H);s.compose(l,u,c);var h=new n.KeyFrame(a,s);i.addKey(h)}i.target=t.findNode(this.mNodeName).toTHREE();var d=[i];if(t.nodeToBoneMap[this.mNodeName])for(o=0;o<t.nodeToBoneMap[this.mNodeName].length;o++){var p=i.clone();p.target=t.nodeToBoneMap[this.mNodeName][o],d.push(p)}return d}}function q(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(t){var e=new n.Animation;for(var r in this.mChannels){this.mChannels[r].init(this.mTicksPerSecond);var i=this.mChannels[r].toTHREE(t);for(var o in i)i[o].init(),e.addTrack(i[o])}return e.length=Math.max.apply(null,e.tracks.map(function(t){return t.length})),e}}function Y(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function Z(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function J(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}var Q=!0;function K(t){var e=t.getFloat32(t.readOffset,Q);return t.readOffset+=4,e}function $(t){var e=t.getFloat64(t.readOffset,Q);return t.readOffset+=8,e}function tt(t){var e=t.getUint8(t.readOffset);return t.readOffset+=1,e}function et(t){var e=t.getUint16(t.readOffset,Q);return t.readOffset+=2,e}function rt(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function nt(t){var e=t.getUint32(t.readOffset,Q);return t.readOffset+=4,e}function it(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new Ta(this.x,this.y,this.z)}};return e.x=K(t),e.y=K(t),e.z=K(t),e}function ot(t){var e=new function(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new Ia(this.r,this.g,this.b,1)}};return e.r=K(t),e.g=K(t),e.b=K(t),e}function st(t){var e=new F,r=rt(t);return t.ReadBytes(e.data,1,r),e.toString()}function at(t){var e=new function(){this.mVertexId=0,this.mWeight=0};return e.mVertexId=rt(t),e.mWeight=K(t),e}function lt(t){for(var e=new function(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var t=new Sa,e=0;e<4;++e)for(var r=0;r<4;++r)t.elements[4*e+r]=this.elements[r][e];return t}},r=0;r<4;++r)for(var n=0;n<4;++n)e.elements[r][n]=K(t);return e}function ct(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=it(t),e}function ut(t){var e=new function(){this.mTime=0,this.mValue=null};return e.mTime=$(t),e.mValue=function(t){var e=new function(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new Ma(this.x,this.y,this.z,this.w)}};return e.w=K(t),e.x=K(t),e.y=K(t),e.z=K(t),e}(t),e}function ht(t,e,r){for(var n=0;n<r;n++)e[n]=ct(t)}function dt(t,e,r){return t.Seek(sizeof(e)*r,At)}function pt(t){if(!t)throw"asset failed"}function ft(t,e){return pt(nt(t)==u),nt(t),e.mName=st(t),e.mNumWeights=rt(t),e.mOffsetMatrix=lt(t),Tt?dt(t,e.mWeights,e.mNumWeights):(e.mWeights=[],function(t,e,r){for(var n=0;n<r;n++)e[n]=at(t)}(t,e.mWeights,e.mNumWeights)),e}function mt(t,e){pt(nt(t)==a),nt(t),e.mPrimitiveTypes=rt(t),e.mNumVertices=rt(t),e.mNumFaces=rt(t),e.mNumBones=rt(t),e.mMaterialIndex=rt(t),e.mNumUVComponents=[];var r=rt(t);r&m&&(Tt?dt(t,e.mVertices,e.mNumVertices):(e.mVertices=[],e.mVertexBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At))),r&v&&(Tt?dt(t,e.mNormals,e.mNumVertices):(e.mNormals=[],e.mNormalBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At))),r&g&&(Tt?(dt(t,e.mTangents,e.mNumVertices),dt(t,e.mBitangents,e.mNumVertices)):(e.mTangents=[],e.mTangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At),e.mBitangents=[],e.mBitangentBuffer=t.subArray32(t.readOffset,t.readOffset+3*e.mNumVertices*4),t.Seek(3*e.mNumVertices*4,At)));for(var n=0;n<b&&r&O(n);++n)Tt?dt(t,e.mColors[n],e.mNumVertices):(e.mColors[n]=[],e.mColorBuffer=t.subArray32(t.readOffset,t.readOffset+4*e.mNumVertices*4),t.Seek(4*e.mNumVertices*4,At));for(e.mTexCoordsBuffers=[],n=0;n<w&&r&P(n);++n)if(e.mNumUVComponents[n]=rt(t),Tt)dt(t,e.mTextureCoords[n],e.mNumVertices);else{e.mTextureCoords[n]=[],e.mTexCoordsBuffers[n]=[];for(var i=0;i<e.mNumVertices;i++)e.mTexCoordsBuffers[n].push(K(t)),e.mTexCoordsBuffers[n].push(K(t)),K(t)}if(Tt)rt(t);else{e.mFaces=[],e.mIndexArray=[];for(var o=0;o<e.mNumFaces;++o){var s=e.mFaces[o]=new D;s.mNumIndices=et(t),s.mIndices=[];for(var l=0;l<s.mNumIndices;++l)s.mIndices[l]=e.mNumVertices<65536?et(t):rt(t);if(3===s.mNumIndices)e.mIndexArray.push(s.mIndices[0]),e.mIndexArray.push(s.mIndices[1]),e.mIndexArray.push(s.mIndices[2]);else{if(4!==s.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");e.mIndexArray.push(s.mIndices[0]),e.mIndexArray.push(s.mIndices[1]),e.mIndexArray.push(s.mIndices[2]),e.mIndexArray.push(s.mIndices[2]),e.mIndexArray.push(s.mIndices[3]),e.mIndexArray.push(s.mIndices[0])}}}if(e.mNumBones)for(e.mBones=[],l=0;l<e.mNumBones;++l)e.mBones[l]=new U,ft(t,e.mBones[l])}function vt(t,e){pt(nt(t)==f),nt(t),e.mKey=st(t),e.mSemantic=rt(t),e.mIndex=rt(t),e.mDataLength=rt(t),e.mType=rt(t),e.mData=[],t.ReadBytes(e.mData,1,e.mDataLength)}function gt(t,e){if(pt(nt(t)==p),nt(t),e.mNumAllocated=e.mNumProperties=rt(t),e.mNumProperties){e.mProperties&&delete e.mProperties,e.mProperties=[];for(var r=0;r<e.mNumProperties;++r)e.mProperties[r]=new B,vt(t,e.mProperties[r])}}function yt(t,e){pt(nt(t)==l),nt(t),e.mNodeName=st(t),e.mNumPositionKeys=rt(t),e.mNumRotationKeys=rt(t),e.mNumScalingKeys=rt(t),e.mPreState=rt(t),e.mPostState=rt(t),e.mNumPositionKeys&&(Tt?dt(t,e.mPositionKeys,e.mNumPositionKeys):(e.mPositionKeys=[],ht(t,e.mPositionKeys,e.mNumPositionKeys))),e.mNumRotationKeys&&(Tt?dt(t,e.mRotationKeys,e.mNumRotationKeys):(e.mRotationKeys=[],function(t,e,r){for(var n=0;n<r;n++)e[n]=ut(t)}(t,e.mRotationKeys,e.mNumRotationKeys))),e.mNumScalingKeys&&(Tt?dt(t,e.mScalingKeys,e.mNumScalingKeys):(e.mScalingKeys=[],ht(t,e.mScalingKeys,e.mNumScalingKeys)))}function xt(t,e){if(pt(nt(t)==h),nt(t),e.mName=st(t),e.mDuration=$(t),e.mTicksPerSecond=$(t),e.mNumChannels=rt(t),e.mNumChannels){e.mChannels=[];for(var r=0;r<e.mNumChannels;++r)e.mChannels[r]=new X,yt(t,e.mChannels[r])}}function bt(t,e){pt(nt(t)==s),nt(t),e.mWidth=rt(t),e.mHeight=rt(t),t.ReadBytes(e.achFormatHint,1,4),Tt||(e.mHeight?(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth*e.mHeight*4)):(e.pcData=[],t.ReadBytes(e.pcData,1,e.mWidth)))}function wt(t,e){pt(nt(t)==o),nt(t),e.mName=st(t),e.mType=rt(t),e.mType!=_&&(e.mAttenuationConstant=K(t),e.mAttenuationLinear=K(t),e.mAttenuationQuadratic=K(t)),e.mColorDiffuse=ot(t),e.mColorSpecular=ot(t),e.mColorAmbient=ot(t),e.mType==S&&(e.mAngleInnerCone=K(t),e.mAngleOuterCone=K(t))}function _t(t,e){pt(nt(t)==i),nt(t),e.mName=st(t),e.mPosition=it(t),e.mLookAt=it(t),e.mUp=it(t),e.mHorizontalFOV=K(t),e.mClipPlaneNear=K(t),e.mClipPlaneFar=K(t),e.mAspect=K(t)}function St(t,e){if(pt(nt(t)==c),nt(t),e.mFlags=rt(t),e.mNumMeshes=rt(t),e.mNumMaterials=rt(t),e.mNumAnimations=rt(t),e.mNumTextures=rt(t),e.mNumLights=rt(t),e.mNumCameras=rt(t),e.mRootNode=new k,e.mRootNode=function t(e,r,n){pt(nt(e)==d),nt(e);var i=new k;if(i.mParent=r,i.mDepth=n,i.mName=st(e),i.mTransformation=lt(e),i.mNumChildren=rt(e),i.mNumMeshes=rt(e),i.mNumMeshes){i.mMeshes=[];for(var o=0;o<i.mNumMeshes;++o)i.mMeshes[o]=rt(e)}if(i.mNumChildren)for(i.mChildren=[],o=0;o<i.mNumChildren;++o){var s=t(e,i,n++);i.mChildren[o]=s}return i}(t,null,0),e.mNumMeshes){e.mMeshes=[];for(var r=0;r<e.mNumMeshes;++r)e.mMeshes[r]=new R,mt(t,e.mMeshes[r])}if(e.mNumMaterials)for(e.mMaterials=[],r=0;r<e.mNumMaterials;++r)e.mMaterials[r]=new V,gt(t,e.mMaterials[r]);if(e.mNumAnimations)for(e.mAnimations=[],r=0;r<e.mNumAnimations;++r)e.mAnimations[r]=new q,xt(t,e.mAnimations[r]);if(e.mNumTextures)for(e.mTextures=[],r=0;r<e.mNumTextures;++r)e.mTextures[r]=new Y,bt(t,e.mTextures[r]);if(e.mNumLights)for(e.mLights=[],r=0;r<e.mNumLights;++r)e.mLights[r]=new Z,wt(t,e.mLights[r]);if(e.mNumCameras)for(e.mCameras=[],r=0;r<e.mNumCameras;++r)e.mCameras[r]=new J,_t(t,e.mCameras[r])}var Tt,Mt,At=0;return function(t){var e=new function(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(t,e){if(e||(e=this.mRootNode),e.mName==t)return e;for(var r=0;r<e.mChildren.length;r++){var n=this.findNode(t,e.mChildren[r]);if(n)return n}return null},this.toTHREE=function(){this.nodeCount=0,function(t){for(var e in t.mMeshes){var r=t.mMeshes[e];for(var n in r.mBones){var i=t.findNode(r.mBones[n].mName);i&&(i.isBone=!0)}}}(this);var t=this.mRootNode.toTHREE(this);for(var e in this.mMeshes)this.mMeshes[e].hookupSkeletons(this,t);if(this.mAnimations.length>0)var r=this.mAnimations[0].toTHREE(this);return{object:t,animation:r}}},r=new DataView(t);if(function(t){t.readOffset=0,t.Seek=function(e,r){r==At&&(t.readOffset+=e),1==r&&(t.readOffset=e)},t.ReadBytes=function(t,e,r){for(var n=e*r,i=0;i<n;i++)t[i]=tt(this)},t.subArray32=function(t,e){var r=this.buffer.slice(t,e);return new Float32Array(r)},t.subArrayUint16=function(t,e){var r=this.buffer.slice(t,e);return new Uint16Array(r)},t.subArrayUint8=function(t,e){var r=this.buffer.slice(t,e);return new Uint8Array(r)},t.subArrayUint32=function(t,e){var r=this.buffer.slice(t,e);return new Uint32Array(r)}}(r),r.Seek(44,At),rt(r),rt(r),rt(r),rt(r),Tt=et(r)>0,Mt=et(r)>0,Tt)throw"Shortened binaries are not supported!";if(r.Seek(256,At),r.Seek(128,At),r.Seek(64,At),!Mt)return St(r,e),e.toTHREE();var n=nt(r),i=r.FileSize()-r.Tell(),o=[];r.Read(o,1,i);var s=[];uncompress(s,n,o,i),St(new ArrayBuffer(s),e)}(t)}},Hh.prototype={set:function(t,e){this[t]=e},get:function(t,e){return this.hasOwnProperty(t)?this[t]:e}};var Wh=function(t){this.manager=void 0!==t?t:Dc,this.trunk=new Na,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new Gh],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};function Xh(t,e){Na.call(this),this.type="Light",this.color=new Ia(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function qh(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new ka(512,512),this.map=null,this.matrix=new Sa}function Yh(t,e,r,n){Xh.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new qh(new bc(90,1,.5,500))}function Zh(){qh.call(this,new Sc(-5,5,5,-5,.5,500))}function Jh(t,e){Xh.call(this,t,e),this.type="DirectionalLight",this.position.copy(Na.DefaultUp),this.updateMatrix(),this.target=new Na,this.shadow=new Zh}function Qh(){qh.call(this,new bc(50,1,.5,500))}function Kh(t,e,r,n,i,o){Xh.call(this,t,e),this.type="SpotLight",this.position.copy(Na.DefaultUp),this.updateMatrix(),this.target=new Na,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Qh}function $h(t,e,r){Xh.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Na.DefaultUp),this.updateMatrix(),this.groundColor=new Ia(e)}Wh.prototype={constructor:Wh,load:function(t,e,r,n){var i=this;this._url=t,this._baseDir=t.substr(0,t.lastIndexOf("/")+1);var o=new kc(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=t.byteLength;for(this._ptr=0,this._data=new DataView(t),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==t.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,e-this._ptr);this._ptr<e;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,e,r=this.readU32(),n=(this.readU8(),this.readU8()),i=(this.readU8(),this.readU32());switch(n){case 1:t=this.parseMeshData(i);break;case 22:t=this.parseContainer(i);break;case 23:t=this.parseMeshInstance(i);break;case 81:t=this.parseMaterial(i);break;case 82:t=this.parseTexture(i);break;case 101:t=this.parseSkeleton(i);break;case 112:t=this.parseMeshPoseAnimation(i,!1);break;case 113:t=this.parseVertexAnimationSet(i);break;case 102:t=this.parseSkeletonPose(i);break;case 103:t=this.parseSkeletonAnimation(i);break;case 122:t=this.parseAnimatorSet(i);break;default:this._ptr+=i}this._blocks[r]=e=new Gh,e.data=t,e.id=r},_parseHeader:function(){var t=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");t[0]=this.readU8(),t[1]=this.readU8();var e=this.readU16();this._streaming=1==(1&e),2===t[0]&&1===t[1]&&(this._accuracyMatrix=2==(2&e),this._accuracyGeo=4==(4&e),this._accuracyProps=8==(8&e)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&e),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(t){var e=new Na,r=this.readU32(),n=this.parseMatrix4();return e.name=this.readUTF(),e.applyMatrix(n),(this._blocks[r].data||this.trunk).add(e),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),e.extra=this.parseUserAttributes(),e},parseMeshInstance:function(t){var e,r,n,i,o,s,a,l,c,u,h,d,p;for(s=this.readU32(),l=this.parseMatrix4(),e=this.readUTF(),a=this.readU32(),d=this.readU16(),n=this.getBlock(a),c=[],p=0;p<d;p++)h=this.readU32(),u=this.getBlock(h),c.push(u);if(o=[],(i=n.length)>1)for(r=new Na,p=0;p<i;p++){var f=new ql(n[p]);o.push(f),r.add(f)}else r=new ql(n[0]),o.push(r);r.applyMatrix(l),r.name=e,(this.getBlock(s)||this.trunk).add(r);var m=c.length,v=Math.max(i,m);for(p=0;p<v;p++)o[p%i].material=c[p%m];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(t){var e,r,n,i,o,s;for(e=this.readUTF(),r=this.readU8(),s=this.readU8(),n=this.parseProperties({1:3,2:23,11:21,12:7,13:21});0<s;)this.readU16(),this.parseProperties(null),this.parseUserAttributes();if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(e)))return i;if(i=new Vc,1===r)i.color.setHex(n.get(1,13421772));else if(2===r){var a=n.get(2,0);i.map=this.getBlock(a)}return i.extra=o,i.alphaThreshold=n.get(12,0),i.repeat=n.get(13,!1),i},parseTexture:function(t){var e,r;if(this.readUTF(),0===this.readU8()){r=this.readU32();var n=this.readUTFBytes(r);console.log(n),e=this.loadTexture(n)}return this.parseProperties(null),this.parseUserAttributes(),e},loadTexture:function(t){var e=new Mc;return new Qc(this.manager).load(this._baseDir+t,function(t){e.image=t,e.needsUpdate=!0}),e},parseSkeleton:function(t){this.readUTF();var e=this.readU16(),r=[],n=0;for(this.parseProperties(null);n<e;){var i,o;this.readU16(),(i=new Ql).parent=this.readU16()-1,i.name=this.readUTF(),o=this.parseMatrix4(),i.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),r.push(i),n++}return this.parseUserAttributes(),r},parseSkeletonPose:function(t){this.readUTF();var e=this.readU16();this.parseProperties(null);for(var r=[],n=0;n<e;){var i;i=1===this.readU8()?this.parseMatrix4():new Sa,r[n]=i,n++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(t){this.readUTF();var e,r,n=[],i=this.readU16();this.parseProperties(null);for(var o=0;o<i;)r=this.readU32(),e=this.readU16(),n.push({pose:this._blocks[r].data,duration:e}),o++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(t){this.readUTF();for(var e,r=this.readU16(),n=(this.parseProperties({1:5}),0),i=[];n<r;)e=this.readU32(),i.push(this._blocks[e].data),n++;return this.parseUserAttributes(),i},parseAnimatorSet:function(t){this.readUTF();var e,r=this.readU16(),n=this.parseProperties({1:23});e=this.readU32();for(var i=this.readU16(),o=[],s=0;s<i;s++)o.push(this.readU32());this.readU16(),Boolean(this.readU8()),this.parseUserAttributes(),this.parseUserAttributes();var a,l=[];for(s=0;s<o.length;s++)l.push(this._blocks[o[s]].data);for(1==r&&(a={animationSet:this._blocks[e].data,skeleton:this._blocks[n.get(1,0)].data}),s=0;s<l.length;s++)l[s].animator=a;return a},parseMeshData:function(t){var e,r,n=this.readUTF(),i=this.readU16(),o=0,s=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<i;){var a,l,c;for((e=new $a).name=n,s.push(e),a=this.readU32(),l=this._ptr+a,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<l;){var u=0,h=this.readU8(),d=(this.readU8(),this.readU32()),p=d+this._ptr;if(1===h)for(c=new za(r=new Float32Array(d/12*3),3),e.addAttribute("position",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else if(2===h)for(c=new za(r=new Uint16Array(d/2),1),e.setIndex(c),u=0;this._ptr<p;)r[u+1]=this.readU16(),r[u]=this.readU16(),r[u+2]=this.readU16(),u+=3;else if(3===h)for(c=new za(r=new Float32Array(d/8*2),2),e.addAttribute("uv",c),u=0;this._ptr<p;)r[u]=this.readF32(),r[u+1]=1-this.readF32(),u+=2;else if(4===h)for(c=new za(r=new Float32Array(d/12*3),3),e.addAttribute("normal",c),u=0;this._ptr<p;)r[u]=-this.readF32(),r[u+1]=this.readF32(),r[u+2]=this.readF32(),u+=3;else this._ptr=p}this.parseUserAttributes(),e.computeBoundingSphere(),o++}return this.parseUserAttributes(),s},parseMeshPoseAnimation:function(t,e){var r,n,i,o,s,a,l,c,u,h=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null!==v){for((a=v.geometry).morphTargets=[],e||(h=this.readU16()),r=this.readU16(),l=this.readU16(),c=0;c<l;)f.push(this.readU16()),c++;for(u=this.parseProperties({1:21,2:21}),p.looping=u.get(1,!0),p.stitchFinalFrame=u.get(2,!1),n=0;n<h;){for(this.readU16(),i=0;i<r;)for(c=0,o=this.readU32(),s=this._ptr+o;c<l;){if(1===f[c]){var g=new Float32Array(o/4);for(a.morphTargets.push({array:g}),d=0;this._ptr<s;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;i++}else this._ptr=s;c++}n++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",m)},getBlock:function(t){return this._blocks[t].data},parseMatrix4:function(){var t=new Sa,e=t.elements;return e[0]=this.readF32(),e[1]=this.readF32(),e[2]=this.readF32(),e[3]=0,e[4]=this.readF32(),e[5]=this.readF32(),e[6]=this.readF32(),e[7]=0,e[8]=this.readF32(),e[9]=this.readF32(),e[10]=this.readF32(),e[11]=0,e[12]=-this.readF32(),e[13]=this.readF32(),e[14]=this.readF32(),e[15]=1,t},parseProperties:function(t){var e=this.readU32(),r=this._ptr+e,n=new Hh;if(t)for(;this._ptr<r;){var i=this.readU16(),o=this.readU32();t.hasOwnProperty(i)?n.set(i,this.parseAttrValue(t[i],o)):this._ptr+=o}return n},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(t,e){var r,n;switch(t){case 1:r=1,n=this.readI8;break;case 2:r=2,n=this.readI16;break;case 3:r=4,n=this.readI32;break;case 21:case 4:r=1,n=this.readU8;break;case 5:r=2,n=this.readU16;break;case 6:case 23:r=4,n=this.readU32;break;case 7:r=4,n=this.readF32;break;case 8:r=8,n=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,n=this.readF64}if(r<e){var i,o,s;for(i=[],o=0,s=e/r;o<s;)i.push(n.call(this)),o++;return i}return n.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var t=this._data.getUint16(this._ptr,!0);return this._ptr+=2,t},readI16:function(){var t=this._data.getInt16(this._ptr,!0);return this._ptr+=2,t},readU32:function(){var t=this._data.getUint32(this._ptr,!0);return this._ptr+=4,t},readI32:function(){var t=this._data.getInt32(this._ptr,!0);return this._ptr+=4,t},readF32:function(){var t=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,t},readF64:function(){var t=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,t},readUTF:function(){var t=this.readU16();return this.readUTFBytes(t)},readUTFBytes:function(t){for(var e=[],r=0;e.length<t;){var n=this._data.getUint8(this._ptr++,!0);if(n<128)e[r++]=String.fromCharCode(n);else if(n>191&&n<224){var i=this._data.getUint8(this._ptr++,!0);e[r++]=String.fromCharCode((31&n)<<6|63&i)}else{i=this._data.getUint8(this._ptr++,!0);var o=this._data.getUint8(this._ptr++,!0);e[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&o)}}return e.join("")}},Xh.prototype=Object.assign(Object.create(Na.prototype),{constructor:Xh,isLight:!0,copy:function(t){return Na.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Na.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Object.assign(qh.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Yh.prototype=Object.assign(Object.create(Xh.prototype),{constructor:Yh,isPointLight:!0,copy:function(t){return Xh.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Zh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Zh}),Jh.prototype=Object.assign(Object.create(Xh.prototype),{constructor:Jh,isDirectionalLight:!0,copy:function(t){return Xh.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Qh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Qh,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*_a.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix())}}),Kh.prototype=Object.assign(Object.create(Xh.prototype),{constructor:Kh,isSpotLight:!0,copy:function(t){return Xh.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),$h.prototype=Object.assign(Object.create(Xh.prototype),{constructor:$h,isHemisphereLight:!0,copy:function(t){return Xh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});var td=function(t){this.manager=void 0!==t?t:Dc};td.prototype={constructor:td,load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){function e(t){var e=new $a,r=t.positions,n=t.normals,i=t.uvs;e.setIndex(t.indices);for(var o=2,s=r.length;o<s;o+=3)r[o]=-r[o];if(e.addAttribute("position",new Za(r,3)),n){for(o=2,s=n.length;o<s;o+=3)n[o]=-n[o];e.addAttribute("normal",new Za(n,3))}i&&e.addAttribute("uv",new Za(i,2));var a=t.subMeshes;if(a)for(o=0,s=a.length;o<s;o++){var l=a[o];e.addGroup(l.indexStart,l.indexCount)}return e}return function(t,r){for(var n={},i=new _c,o=t.cameras,s=0,a=o.length;s<a;s++){var l=new bc((d=o[s]).fov/Math.PI*180,1.33,d.minZ,d.maxZ);l.name=d.name,l.position.fromArray(d.position),d.rotation&&l.rotation.fromArray(d.rotation),n[d.id]=l}var c=t.lights;for(s=0,a=c.length;s<a;s++){var u;switch((d=c[s]).type){case 0:u=new Yh;break;case 1:u=new Jh;break;case 2:u=new Kh;break;case 3:u=new $h}u.name=d.name,d.position&&u.position.set(d.position[0],d.position[1],-d.position[2]),u.color.fromArray(d.diffuse),d.groundColor&&u.groundColor.fromArray(d.groundColor),d.intensity&&(u.intensity=d.intensity),n[d.id]=u,i.add(u)}var h=t.meshes;for(s=0,a=h.length;s<a;s++){var d,p;(p=(d=h[s]).indices?new ql(e(d),r[d.materialId]):new Fh).name=d.name,p.position.set(d.position[0],d.position[1],-d.position[2]),p.rotation.fromArray(d.rotation),d.rotationQuaternion&&p.quaternion.fromArray(d.rotationQuaternion),p.scale.fromArray(d.scaling),d.parentId?n[d.parentId].add(p):i.add(p),n[d.id]=p}return i}(t,function(t){for(var e={},r=0,n=t.materials.length;r<n;r++){var i=t.materials[r],o=new Vc;o.name=i.name,o.color.fromArray(i.diffuse),o.emissive.fromArray(i.emissive),o.specular.fromArray(i.specular),o.shininess=i.specularPower,o.opacity=i.alpha,e[i.id]=o}if(t.multiMaterials)for(r=0,n=t.multiMaterials.length;r<n;r++)i=t.multiMaterials[r],console.warn("BabylonLoader: Multi materials not yet supported."),e[i.id]=new Vc;return e}(t))}};var ed=function(t){this.manager=void 0!==t?t:Dc,this.animateBonePositions=!0,this.animateBoneRotations=!0};function rd(t,e){Xh.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function nd(t,e){Yl.call(this,t,e),this.type="LineSegments"}ed.prototype={constructor:ed,load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t,r,n){if("ENDSITE"!==n.type){var i={time:r,position:new Ta,rotation:new Ma};n.frames.push(i);for(var o=new Ma,s=new Ta(1,0,0),a=new Ta(0,1,0),l=new Ta(0,0,1),c=0;c<n.channels.length;c++)switch(n.channels[c]){case"Xposition":i.position.x=parseFloat(t.shift().trim());break;case"Yposition":i.position.y=parseFloat(t.shift().trim());break;case"Zposition":i.position.z=parseFloat(t.shift().trim());break;case"Xrotation":o.setFromAxisAngle(s,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(a,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(c=0;c<n.children.length;c++)e(t,r,n.children[c])}}function r(t){for(var e;0===(e=t.shift().trim()).length;);return e}var n=this,i=function(t){"HIERARCHY"!==r(t)&&console.error("BVHLoader: HIERARCHY expected.");var n=[],i=function t(e,n,i){var o={name:"",type:"",frames:[]};i.push(o);var s=n.split(/[\s]+/);"END"===s[0].toUpperCase()&&"SITE"===s[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=s[1],o.type=s[0].toUpperCase()),"{"!==r(e)&&console.error("BVHLoader: Expected opening { after type & name"),"OFFSET"!==(s=r(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+s[0]),4!==s.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var a=new Ta(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));if((isNaN(a.x)||isNaN(a.y)||isNaN(a.z))&&console.error("BVHLoader: Invalid values of OFFSET."),o.offset=a,"ENDSITE"!==o.type){"CHANNELS"!==(s=r(e).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var l=parseInt(s[1]);o.channels=s.splice(2,l),o.children=[]}for(;;){var c=r(e);if("}"===c)return o;o.children.push(t(e,c,i))}}(t,r(t),n);"MOTION"!==r(t)&&console.error("BVHLoader: MOTION expected.");var o=r(t).split(/[\s]+/),s=parseInt(o[1]);isNaN(s)&&console.error("BVHLoader: Failed to read number of frames."),o=r(t).split(/[\s]+/);var a=parseFloat(o[2]);isNaN(a)&&console.error("BVHLoader: Failed to read frame time.");for(var l=0;l<s;l++)e(o=r(t).split(/[\s]+/),l*a,i);return n}(t.split(/[\r\n]+/g)),o=[];!function t(e,r){var n=new Ql;if(r.push(n),n.position.add(e.offset),n.name=e.name,"ENDSITE"!==e.type)for(var i=0;i<e.children.length;i++)n.add(t(e.children[i],r));return n}(i[0],o);var s=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];if("ENDSITE"!==i.type){for(var o=[],s=[],a=[],l=0;l<i.frames.length;l++){var c=i.frames[l];o.push(c.time),s.push(c.position.x+i.offset.x),s.push(c.position.y+i.offset.y),s.push(c.position.z+i.offset.z),a.push(c.rotation.x),a.push(c.rotation.y),a.push(c.rotation.z),a.push(c.rotation.w)}n.animateBonePositions&&e.push(new uc(".bones["+i.name+"].position",o,s)),n.animateBoneRotations&&e.push(new lc(".bones["+i.name+"].quaternion",o,a))}}return new gc("animation",-1,e)}(i);return{skeleton:new jh(o),clip:s}}},rd.prototype=Object.assign(Object.create(Xh.prototype),{constructor:rd,isAmbientLight:!0}),nd.prototype=Object.assign(Object.create(Yl.prototype),{constructor:nd,isLineSegments:!0,computeLineDistances:function(){var t=new Ta,e=new Ta;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,s=n.count;o<s;o+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e);r.addAttribute("lineDistance",new Za(i,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var a=r.vertices;for(i=r.lineDistances,o=0,s=a.length;o<s;o+=2)t.copy(a[o]),e.copy(a[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+t.distanceTo(e)}return this}}()});var id=function(t){this.manager=void 0!==t?t:Dc};function od(t,e,r,n,i,o,s,a,l,c,u,h){Mc.call(this,null,o,s,a,l,c,n,i,u,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function sd(t){this.manager=void 0!==t?t:Dc,this._parser=null}id.prototype={constructor:id,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=void 0===i.path?tu.extractUrlBase(t):i.path;new kc(i.manager).load(t,function(t){e(i.parse(t,o))},r,n)},setPath:function(t){this.path=t},options:{set convertUpAxis(t){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){function r(t,e){for(var r=[],n=t.childNodes,i=0,o=n.length;i<o;i++){var s=n[i];s.nodeName===e&&r.push(s)}return r}function n(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=e[n];return r}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=parseFloat(e[n]);return r}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),n=0,i=e.length;n<i;n++)r[n]=parseInt(e[n]);return r}function s(t){return t.substring(1)}function a(t){return 0===Object.keys(t).length}function l(t,e,n,i){var o=r(t,e)[0];if(void 0!==o)for(var s=r(o,n),a=0;a<s.length;a++)i(s[a])}function c(t,e){for(var r in t)t[r].build=e(t[r])}function u(t,e){return void 0!==t.build?t.build:(t.build=e(t),t.build)}function h(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");e.inputs[a]=o}}return e}function d(t){var e={},r=t.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),o=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)i=(r=i.split(".")).shift(),e.member=r.shift();else if(o){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));e.indices=l}return e.id=n,e.sid=i,e.arraySyntax=o,e.memberSyntax=a,e.sampler=s(t.getAttribute("source")),e}function p(t){var e=[],r=t.channels,n=t.samplers,i=t.sources;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o],a=n[s.sampler];x(m(s,i[a.inputs.INPUT],i[a.inputs.OUTPUT]),e)}return e}function f(t){return u(Vt.animations[t],p)}function m(t,e,r){var n,i,o,s,a,l,c=Vt.nodes[t.id],u=Ot(c.id),h=c.transforms[t.sid],d=c.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,s=e.array.length;o<s;o++)if(i=o*r.stride,void 0===p[n=e.array[o]]&&(p[n]={}),!0===t.arraySyntax)p[n][t.indices[0]+4*t.indices[1]]=r.array[i];else for(a=0,l=r.stride;a<l;a++)p[n][a]=r.array[i+a];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var f=function(t,e){var r=[];for(var n in t)r.push({time:parseFloat(n),value:t[n]});r.sort(function(t,e){return t.time-e.time});for(var i=0;i<16;i++)b(r,i,e.elements[i]);return r}(p,d);return{name:u.uuid,keyframes:f}}var v=new Ta,g=new Ta,y=new Ma;function x(t,e){for(var r=t.keyframes,n=t.name,i=[],o=[],s=[],a=[],l=0,c=r.length;l<c;l++){var u=r[l],h=u.time;bt.fromArray(u.value).transpose(),bt.decompose(v,y,g),i.push(h),o.push(v.x,v.y,v.z),s.push(y.x,y.y,y.z,y.w),a.push(g.x,g.y,g.z)}return o.length>0&&e.push(new uc(n+".position",i,o)),s.length>0&&e.push(new lc(n+".quaternion",i,s)),a.length>0&&e.push(new uc(n+".scale",i,a)),e}function b(t,e,r){var n,i,o,s=!0;for(i=0,o=t.length;i<o;i++)void 0===(n=t[i]).value[e]?n.value[e]=null:s=!1;if(!0===s)for(i=0,o=t.length;i<o;i++)(n=t[i]).value[e]=r;else!function(t,e){for(var r,n,i=0,o=t.length;i<o;i++){var s=t[i];if(null===s.value[e]){if(r=w(t,i,e),n=_(t,i,e),null===r){s.value[e]=n.value[e];continue}if(null===n){s.value[e]=r.value[e];continue}S(s,r,n,e)}}}(t,e)}function w(t,e,r){for(;e>=0;){var n=t[e];if(null!==n.value[r])return n;e--}return null}function _(t,e,r){for(;e<t.length;){var n=t[e];if(null!==n.value[r])return n;e++}return null}function S(t,e,r,n){t.value[n]=r.time-e.time!=0?(t.time-e.time)*(r.value[n]-e.value[n])/(r.time-e.time)+e.value[n]:e.value[n]}function T(t){for(var e=[],r=t.name,n=t.end-t.start||-1,i=t.animations,o=0,s=i.length;o<s;o++)for(var a=f(i[o]),l=0,c=a.length;l<c;l++)e.push(a[l]);return new gc(r,n,e)}function M(t){return u(Vt.clips[t],T)}function A(t){for(var e={sources:{}},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=i(o.textContent);break;case"source":var s=o.getAttribute("id");e.sources[s]=nt(o);break;case"joints":e.joints=E(o);break;case"vertex_weights":e.vertexWeights=C(o)}}return e}function E(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));e.inputs[o]=a}}return e}function C(t){for(var e={inputs:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),l=s(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));e.inputs[a]={id:l,offset:c};break;case"vcount":e.vcount=o(i.textContent);break;case"v":e.v=o(i.textContent)}}return e}function P(t){var e={id:t.id},r=Vt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=t.vertexWeights,s=o.vcount,a=o.v,l=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,u=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],d=t.sources[o.inputs.WEIGHT.id].array,p=0;for(e=0,n=s.length;e<n;e++){var f=s[e],m=[];for(r=0;r<f;r++)m.push({index:a[p+l],weight:d[a[p+c]]}),p+=2;for(m.sort(x),r=0;r<4;r++){var v=m[r];void 0!==v?(i.indices.array.push(v.index),i.weights.array.push(v.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(i.bindMatrix=(new Sa).fromArray(t.bindShapeMatrix).transpose(),e=0,n=u.array.length;e<n;e++){var g=u.array[e],y=(new Sa).fromArray(h.array,e*h.stride).transpose();i.joints.push({name:g,boneInverse:y})}return i;function x(t,e){return e.weight-t.weight}}(t.skin),r.sources.skinIndices=e.skin.indices,r.sources.skinWeights=e.skin.weights),e}function O(t){return u(Vt.controllers[t],P)}function N(t){return void 0!==t.build?t.build:t.init_from}function L(t){return u(Vt.images[t],N)}function I(t){for(var e={surfaces:{},samplers:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":R(i,e);break;case"technique":e.technique=k(i);break;case"extra":e.extra=G(i)}}return e}function R(t,e){for(var r=t.getAttribute("sid"),n=0,i=t.childNodes.length;n<i;n++){var o=t.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[r]=D(o);break;case"sampler2D":e.samplers[r]=F(o)}}}function D(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent}}return e}function F(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent}}return e}function k(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=U(i)}}return e}function U(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":e[i.nodeName]=B(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:B(i)}}}return e}function B(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":e[o.nodeName]=i(o.textContent);break;case"float":e[o.nodeName]=parseFloat(o.textContent);break;case"texture":e[o.nodeName]={id:o.getAttribute("texture"),extra:j(o)}}}return e}function j(t){for(var e={technique:{}},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":z(i,e)}}return e}function z(t,e){for(var r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,e)}}}function V(t,e){for(var r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":e.technique[i.nodeName]="TRUE"===i.textContent.toUpperCase()?1:"FALSE"===i.textContent.toUpperCase()?0:parseInt(i.textContent)}}}function G(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=H(i)}}return e}function H(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent)}}return e}function W(t){return t}function X(t){var e,r=u(Vt.effects[t.url],W),n=r.profile.technique,i=r.profile.extra;switch(n.type){case"phong":case"blinn":e=new Vc;break;case"lambert":e=new jc;break;default:e=new zl}function o(t){var e,n=r.profile.samplers[t.id];if(void 0!==n?e=L(r.profile.surfaces[n.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),e=L(t.id)),void 0!==e){var i=Ut.load(e),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===a(o.technique)){var s=o.technique;i.wrapS=s.wrapU?gl:yl,i.wrapT=s.wrapV?gl:yl,i.offset.set(s.offsetU||0,s.offsetV||0),i.repeat.set(s.repeatU||1,s.repeatV||1)}else i.wrapS=gl,i.wrapT=gl;return i}return console.error("ColladaLoader: Unable to load texture with ID:",t.id),null}e.name=t.name;var s=n.parameters;for(var l in s){var c=s[l];switch(l){case"diffuse":c.color&&e.color.fromArray(c.color),c.texture&&(e.map=o(c.texture));break;case"specular":c.color&&e.specular&&e.specular.fromArray(c.color),c.texture&&(e.specularMap=o(c.texture));break;case"shininess":c.float&&e.shininess&&(e.shininess=c.float);break;case"emission":c.color&&e.emissive&&e.emissive.fromArray(c.color)}}var h=s.transparent,d=s.transparency;if(void 0===d&&h&&(d={float:1}),void 0===h&&d&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&d)if(h.data.texture)e.alphaMap=o(h.data.texture),e.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":e.opacity=p[3]*d.float;break;case"RGB_ZERO":e.opacity=1-p[0]*d.float;break;case"A_ZERO":e.opacity=1-p[3]*d.float;break;case"RGB_ONE":e.opacity=p[0]*d.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}e.opacity<1&&(e.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(e.side=il),e}function q(t){return u(Vt.materials[t],X)}function Y(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"technique_common":return Z(r)}}return{}}function Z(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":e.technique=n.nodeName,e.parameters=J(n)}}return e}function J(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[n.nodeName]=parseFloat(n.textContent)}}return e}function Q(t){var e;switch(t.optics.technique){case"perspective":e=new bc(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var r=t.optics.parameters.ymag,n=t.optics.parameters.xmag,i=t.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,e=new Sc(-(n*=.5),n,r*=.5,-r,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new bc}return e.name=t.name,e}function K(t){var e=Vt.cameras[t];return void 0!==e?u(e,Q):(console.warn("ColladaLoader: Couldn't find camera with ID:",t),null)}function $(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=tt(i)}}return e}function tt(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var s=i(o.textContent);e.color=(new Ia).fromArray(s);break;case"falloff_angle":e.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);e.distance=a?Math.sqrt(1/a):0}}return e}function et(t){var e;switch(t.technique){case"directional":e=new Jh;break;case"point":e=new Yh;break;case"spot":e=new Kh;break;case"ambient":e=new rd}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function rt(t){var e=Vt.lights[t];return void 0!==e?u(e,et):(console.warn("ColladaLoader: Couldn't find light with ID:",t),null)}function nt(t){for(var e={array:[],stride:3},o=0;o<t.childNodes.length;o++){var s=t.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":e.array=i(s.textContent);break;case"Name_array":e.array=n(s.textContent);break;case"technique_common":var a=r(s,"accessor")[0];void 0!==a&&(e.stride=parseInt(a.getAttribute("stride")))}}return e}function it(t){for(var e={},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];1===n.nodeType&&(e[n.getAttribute("semantic")]=s(n.getAttribute("source")))}return e}function ot(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=s(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset"));e.inputs[l]={id:a,offset:c},e.stride=Math.max(e.stride,c+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=o(i.textContent);break;case"p":e.p=o(i.textContent)}}return e}function st(t){for(var e=0,r=0,n=t.length;r<n;r++)!0===t[r].hasUV&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function at(t){var e={},r=t.sources,n=t.vertices,i=t.primitives;if(0===i.length)return{};var o=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r];void 0===e[n.type]&&(e[n.type]=[]),e[n.type].push(n)}return e}(i);for(var s in o){var a=o[s];st(a),e[s]=lt(a,r,n)}return e}function lt(t,e,r){for(var n={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},l=[],c=[],u=new $a,h=[],d=0,p=0,f=0;f<t.length;f++){var m=t[f],v=m.inputs,g=1;for(var y in m.vcount&&4===m.vcount[0]&&(g=2),u.addGroup(d,p="lines"===m.type||"linestrips"===m.type?2*m.count:3*m.count*g,f),d+=p,m.material&&h.push(m.material),v){var x=v[y];switch(y){case"VERTEX":for(var b in r){var w=r[b];switch(b){case"POSITION":var _=i.array.length;if(ct(m,e[w],x.offset,i.array),i.stride=e[w].stride,e.skinWeights&&e.skinIndices&&(ct(m,e.skinIndices,x.offset,l),ct(m,e.skinWeights,x.offset,c)),!1===m.hasUV&&!0===t.uvsNeedsFix){p=(i.array.length-_)/i.stride;for(var S=0;S<p;S++)s.array.push(0,0)}break;case"NORMAL":ct(m,e[w],x.offset,o.array),o.stride=e[w].stride;break;case"COLOR":ct(m,e[w],x.offset,a.array),a.stride=e[w].stride;break;case"TEXCOORD":ct(m,e[w],x.offset,s.array),s.stride=e[w].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',b)}}break;case"NORMAL":ct(m,e[x.id],x.offset,o.array),o.stride=e[x.id].stride;break;case"COLOR":ct(m,e[x.id],x.offset,a.array),a.stride=e[x.id].stride;break;case"TEXCOORD":ct(m,e[x.id],x.offset,s.array),s.stride=e[x.id].stride}}}return i.array.length>0&&u.addAttribute("position",new Za(i.array,i.stride)),o.array.length>0&&u.addAttribute("normal",new Za(o.array,o.stride)),a.array.length>0&&u.addAttribute("color",new Za(a.array,a.stride)),s.array.length>0&&u.addAttribute("uv",new Za(s.array,s.stride)),l.length>0&&u.addAttribute("skinIndex",new Za(l,4)),c.length>0&&u.addAttribute("skinWeight",new Za(c,4)),n.data=u,n.type=t[0].type,n.materialKeys=h,n}function ct(t,e,r,n){var i=t.p,o=t.stride,s=t.vcount;function a(t){for(var e=i[t+r]*u,o=e+u;e<o;e++)n.push(c[e])}var l=0,c=e.array,u=e.stride;if(void 0!==t.vcount){for(var h=0,d=0,p=s.length;d<p;d++){var f=s[d];if(4===f){var m=h+1*o,v=h+2*o,g=h+3*o;a(h+0*o),a(m),a(g),a(m),a(v),a(g)}else 3===f?(m=h+1*o,v=h+2*o,a(h+0*o),a(m),a(v)):l=Math.max(l,f);h+=o*f}l>0&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(d=0,p=i.length;d<p;d+=o)a(d)}function ut(t){return u(Vt.geometries[t],at)}function ht(t){return void 0!==t.build?t.build:t}function dt(t,e){for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":e.joints[n.getAttribute("sid")]=pt(n);break;case"link":e.links.push(mt(n))}}}function pt(t){for(var e,r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":e=ft(n)}}return e}function ft(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new Ta,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=i(n.textContent);e.axis.fromArray(o);break;case"limits":var s=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];e.limits.max=parseFloat(s.textContent),e.limits.min=parseFloat(a.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function mt(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":e.attachments.push(vt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(gt(n))}}return e}function vt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":e.links.push(mt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(gt(n))}}return e}function gt(t){var e={type:t.nodeName},r=i(t.textContent);switch(e.type){case"matrix":e.obj=new Sa,e.obj.fromArray(r).transpose();break;case"translate":e.obj=new Ta,e.obj.fromArray(r);break;case"rotate":e.obj=new Ta,e.obj.fromArray(r),e.angle=_a.degToRad(r[3])}return e}function yt(t){for(var e={target:t.getAttribute("target").split("/").pop()},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1)}}return e}function xt(t){return void 0!==t.build?t.build:t}var bt=new Sa,wt=new Ta;function _t(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new Sa,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":e.nodes.push(n.getAttribute("id")),_t(n);break;case"instance_camera":e.instanceCameras.push(s(n.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(St(n));break;case"instance_light":e.instanceLights.push(s(n.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(St(n));break;case"instance_node":e.instanceNodes.push(s(n.getAttribute("url")));break;case"matrix":var o=i(n.textContent);e.matrix.multiply(bt.fromArray(o).transpose()),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=i(n.textContent),wt.fromArray(o),e.matrix.multiply(bt.makeTranslation(wt.x,wt.y,wt.z)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=i(n.textContent);var a=_a.degToRad(o[3]);e.matrix.multiply(bt.makeRotationAxis(wt.fromArray(o),a)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=i(n.textContent),e.matrix.scale(wt.fromArray(o)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Vt.nodes[e.id]=e,e}function St(t){for(var e={id:s(t.getAttribute("url")),materials:{},skeletons:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],l=a.getAttribute("symbol"),c=a.getAttribute("target");e.materials[l]=s(c)}break;case"skeleton":e.skeletons.push(s(n.textContent))}}return e}function Tt(t,e){var r,n,i=[],o=[];for(r=0;r<t.length;r++){var s=t[r];if(Pt(s))Mt(Ot(s),e,i);else if(Lt(s))for(var a=Vt.visualScenes[s].children,l=0;l<a.length;l++){var c=a[l];"JOINT"===c.type&&Mt(Ot(c.id),e,i)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<e.length;r++)for(l=0;l<i.length;l++)if((n=i[l]).bone.name===e[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<i.length;r++)!1===(n=i[r]).processed&&(o.push(n),n.processed=!0);var u=[],h=[];for(r=0;r<o.length;r++)u.push((n=o[r]).bone),h.push(n.boneInverse);return new jh(u,h)}function Mt(t,e,r){t.traverse(function(t){if(!0===t.isBone){for(var n,i=0;i<e.length;i++){var o=e[i];if(o.name===t.name){n=o.boneInverse;break}}void 0===n&&(n=new Sa),r.push({bone:t,boneInverse:n,processed:!1})}})}function At(t){for(var e=[],r=t.matrix,n=t.nodes,i=t.type,o=t.instanceCameras,s=t.instanceControllers,a=t.instanceLights,l=t.instanceGeometries,c=t.instanceNodes,u=0,h=n.length;u<h;u++)e.push(Ot(n[u]));for(u=0,h=o.length;u<h;u++){var d=K(o[u]);null!==d&&e.push(d.clone())}for(u=0,h=s.length;u<h;u++)for(var p=O((b=s[u]).id),f=Ct(ut(p.id),b.materials),m=Tt(b.skeletons,p.skin.joints),v=0,g=f.length;v<g;v++){var y;(y=f[v]).isSkinnedMesh&&(y.bind(m,p.skin.bindMatrix),y.normalizeSkinWeights()),e.push(y)}for(u=0,h=a.length;u<h;u++){var x=rt(a[u]);null!==x&&e.push(x.clone())}for(u=0,h=l.length;u<h;u++){var b;for(v=0,g=(f=Ct(ut((b=l[u]).id),b.materials)).length;v<g;v++)e.push(f[v])}for(u=0,h=c.length;u<h;u++)e.push(Ot(c[u]).clone());if(0===n.length&&1===e.length)y=e[0];else for(y="JOINT"===i?new Ql:new Fh,u=0;u<e.length;u++)y.add(e[u]);return""===y.name&&(y.name="JOINT"===i?t.sid:t.name),y.matrix.copy(r),y.matrix.decompose(y.position,y.quaternion,y.scale),y}function Et(t,e){for(var r=[],n=0,i=t.length;n<i;n++)r.push(q(e[t[n]]));return r}function Ct(t,e){var r=[];for(var n in t){var i=t[n],o=Et(i.materialKeys,e);0===o.length&&o.push("lines"===n||"linestrips"===n?new Vl:new Vc);var s=void 0!==i.data.attributes.skinIndex;if(s)for(var a=0,l=o.length;a<l;a++)o[a].skinning=!0;var c,u=1===o.length?o[0]:o;switch(n){case"lines":c=new nd(i.data,u);break;case"linestrips":c=new Yl(i.data,u);break;case"triangles":case"polylist":c=s?new zh(i.data,u):new ql(i.data,u)}r.push(c)}return r}function Pt(t){return void 0!==Vt.nodes[t]}function Ot(t){return u(Vt.nodes[t],At)}function Nt(t){var e=new Fh;e.name=t.name;for(var r=t.children,n=0;n<r.length;n++)e.add(Ot(r[n].id));return e}function Lt(t){return void 0!==Vt.visualScenes[t]}function It(t){return u(Vt.visualScenes[t],Nt)}if(console.time("ColladaLoader"),0===t.length)return{scene:new _c};console.time("ColladaLoader: DOMParser");var Rt=(new DOMParser).parseFromString(t,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var Dt=r(Rt,"COLLADA")[0],Ft=Dt.getAttribute("version");console.log("ColladaLoader: File version",Ft);var kt=function(t){return{unit:function(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}(r(t,"unit")[0]),upAxis:function(t){return void 0!==t?t.textContent:"Y_UP"}(r(t,"up_axis")[0])}}(r(Dt,"asset")[0]),Ut=new Kc(this.manager);Ut.setPath(e).setCrossOrigin(this.crossOrigin);var Bt=[],jt={},zt=0,Vt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("ColladaLoader: Parse"),l(Dt,"library_animations","animation",function(t){for(var e={sources:{},samplers:{},channels:{}},r=0,n=t.childNodes.length;r<n;r++){var i,o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":i=o.getAttribute("id"),e.sources[i]=nt(o);break;case"sampler":i=o.getAttribute("id"),e.samplers[i]=h(o);break;case"channel":i=o.getAttribute("target"),e.channels[i]=d(o);break;default:console.log(o)}}Vt.animations[t.getAttribute("id")]=e}),l(Dt,"library_animation_clips","animation_clip",function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(s(i.getAttribute("url")))}}Vt.clips[t.getAttribute("id")]=e}),l(Dt,"library_controllers","controller",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=s(i.getAttribute("source")),e.skin=A(i);break;case"morph":e.id=s(i.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}Vt.controllers[t.getAttribute("id")]=e}),l(Dt,"library_images","image",function(t){var e={init_from:r(t,"init_from")[0].textContent};Vt.images[t.getAttribute("id")]=e}),l(Dt,"library_effects","effect",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=I(i)}}Vt.effects[t.getAttribute("id")]=e}),l(Dt,"library_materials","material",function(t){for(var e={name:t.getAttribute("name")},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=s(i.getAttribute("url"))}}Vt.materials[t.getAttribute("id")]=e}),l(Dt,"library_cameras","camera",function(t){for(var e={name:t.getAttribute("name")},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=Y(i)}}Vt.cameras[t.getAttribute("id")]=e}),l(Dt,"library_lights","light",function(t){for(var e={},r=0,n=t.childNodes.length;r<n;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=$(i)}}Vt.lights[t.getAttribute("id")]=e}),l(Dt,"library_geometries","geometry",function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(t,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[s]=nt(o);break;case"vertices":e.vertices=it(o);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(ot(o));break;default:console.log(o)}}}Vt.geometries[t.getAttribute("id")]=e}}),l(Dt,"library_nodes","node",_t),l(Dt,"library_visual_scenes","visual_scene",function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),r=0;r<e.length;r++){var n=e[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+zt++)}}(t);for(var n=r(t,"node"),i=0;i<n.length;i++)e.children.push(_t(n[i]));Vt.visualScenes[t.getAttribute("id")]=e}),l(Dt,"library_kinematics_models","kinematics_model",function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":dt(n,e)}}Vt.kinematicsModels[t.getAttribute("id")]=e}),l(Dt,"scene","instance_kinematics_scene",function(t){for(var e={bindJointAxis:[]},r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":e.bindJointAxis.push(yt(n))}}Vt.kinematicsScenes[s(t.getAttribute("url"))]=e}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),c(Vt.animations,p),c(Vt.clips,T),c(Vt.controllers,P),c(Vt.images,N),c(Vt.effects,W),c(Vt.materials,X),c(Vt.cameras,Q),c(Vt.lights,et),c(Vt.geometries,at),c(Vt.visualScenes,Nt),console.timeEnd("ColladaLoader: Build"),function(){var t=Vt.clips;if(!0===a(t)){if(!1===a(Vt.animations)){var e=[];for(var r in Vt.animations)for(var n=f(r),i=0,o=n.length;i<o;i++)e.push(n[i]);Bt.push(new gc("default",-1,e))}}else for(var r in t)Bt.push(M(r))}(),function(){var t=Object.keys(Vt.kinematicsModels)[0],e=Object.keys(Vt.kinematicsScenes)[0],r=Object.keys(Vt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var n=u(Vt.kinematicsModels[t],ht),o=u(Vt.kinematicsScenes[e],xt),s=It(r),a=o.bindJointAxis,l={},c=0,h=a.length;c<h;c++){var d=a[c],p=Dt.querySelector('[sid="'+d.target+'"]');p&&m(d.jointIndex,p.parentElement)}var f=new Sa;jt={joints:n&&n.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var r=l[t];if(r){var n=r.joint;if(e>n.limits.max||e<n.limits.min)console.warn("ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("ColladaLoader: Joint "+t+" is static.");else{var i=r.object,o=n.axis,s=r.transforms;bt.identity();for(var a=0;a<s.length;a++){var c=s[a];if(c.sid&&-1!==c.sid.indexOf(t))switch(n.type){case"revolute":bt.multiply(f.makeRotationAxis(o,_a.degToRad(e)));break;case"prismatic":bt.multiply(f.makeTranslation(o.x*e,o.y*e,o.z*e));break;default:console.warn("ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":bt.multiply(c.obj);break;case"translate":bt.multiply(f.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":bt.scale(c.obj);break;case"rotate":bt.multiply(f.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(bt),i.matrix.decompose(i.position,i.quaternion,i.scale),l[t].position=e}}else console.log("ColladaLoader: "+t+" does not exist.")}}}function m(t,e){var r=e.getAttribute("name"),o=n.joints[t];s.traverse(function(n){n.name===r&&(l[t]={object:n,transforms:function(t){for(var r=[],n=Dt.querySelector('[id="'+e.id+'"]'),o=0;o<n.childNodes.length;o++){var s=n.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"matrix":var a=i(s.textContent),l=(new Sa).fromArray(a).transpose();r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:l});break;case"translate":case"scale":a=i(s.textContent);var c=(new Ta).fromArray(a);r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:c});break;case"rotate":a=i(s.textContent),c=(new Ta).fromArray(a);var u=_a.degToRad(a[3]);r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:c,angle:u})}}return r}(),joint:o,position:o.zeroPosition})})}}();var Gt=It(s(r(r(Dt,"scene")[0],"instance_visual_scene")[0].getAttribute("url")));return"Z_UP"===kt.upAxis&&Gt.quaternion.setFromEuler(new Ea(-Math.PI/2,0,0)),Gt.scale.multiplyScalar(kt.unit),console.timeEnd("ColladaLoader"),{animations:Bt,kinematics:jt,library:Vt,scene:Gt}}},(od.prototype=Object.create(Mc.prototype)).constructor=od,od.prototype.isCompressedTexture=!0,Object.assign(sd.prototype,{load:function(t,e,r,n){var i=this,o=[],s=new od;s.image=o;var a=new kc(this.manager);function l(l){a.load(t[l],function(t){var r=i._parser(t,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(s.minFilter=wl),s.format=r.format,s.needsUpdate=!0,e&&e(s))},r,n)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else a.load(t,function(t){var r=i._parser(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,a=0;a<n;a++){o[a]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[a].mipmaps.push(r.mipmaps[a*r.mipmapCount+l]),o[a].format=r.format,o[a].width=r.width,o[a].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=wl),s.format=r.format,s.needsUpdate=!0,e&&e(s)},r,n);return s},setPath:function(t){return this.path=t,this}});var ad=function(){this._parser=ad.parse};function ld(t,e){Yl.call(this,t,e),this.type="LineLoop"}ad.prototype=Object.create(sd.prototype),ad.prototype.constructor=ad,ad.parse=function(t,e){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function i(t,e,r,n){for(var i=r*n*4,o=new Uint8Array(t,e,i),s=new Uint8Array(i),a=0,l=0,c=0;c<n;c++)for(var u=0;u<r;u++){var h=o[l],d=o[++l],p=o[++l],f=o[++l];l++,s[a]=p,s[++a]=d,s[++a]=h,s[++a]=f,a++}return s}var o,s=n("DXT1"),a=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(t,0,31);if(542327876!==u[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h=u[21],d=!1;switch(h){case s:o=8,r.format=33776;break;case a:o=16,r.format=33778;break;case l:o=16,r.format=33779;break;case c:o=8,r.format=36196;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255)),r;d=!0,o=64,r.format=El}r.mipmapCount=1,131072&u[2]&&!1!==e&&(r.mipmapCount=Math.max(1,u[7]));var p=u[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];for(var f=u[1]+4,m=r.isCubemap?6:1,v=0;v<m;v++)for(var g=r.width,y=r.height,x=0;x<r.mipmapCount;x++){if(d)var b=(w=i(t,f,g,y)).length;else{b=Math.max(4,g)/4*Math.max(4,y)/4*o;var w=new Uint8Array(t,f,b)}r.mipmaps.push({data:w,width:g,height:y}),f+=b,g=Math.max(g>>1,1),y=Math.max(y>>1,1)}return r},ld.prototype=Object.assign(Object.create(Yl.prototype),{constructor:ld,isLineLoop:!0}),function(){function t(t){this.manager=void 0!==t?t:Dc}function e(t,e){var r={},n=t.material.uniforms;for(var i in n){var o=n[i];if(o.semantic){var s=o.node,a=t;s&&(a=e[s]),r[i]={semantic:o.semantic,sourceNode:a,targetNode:t,uniform:o}}}this.boundUniforms=r,this._m4=new Sa}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=this.path&&"string"==typeof this.path?this.path:tu.extractUrlBase(t),s=new kc(i.manager);s.setResponseType("arraybuffer"),s.load(t,function(t){i.parse(t,o,e)},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},setPath:function(t){this.path=t},parse:function(t,e,i){var s,a={};tu.decodeText(new Uint8Array(t,0,4))===n.magic?(a[r.KHR_BINARY_GLTF]=new o(t),s=a[r.KHR_BINARY_GLTF].content):s=tu.decodeText(new Uint8Array(t));var l=JSON.parse(s);l.extensionsUsed&&l.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(a[r.KHR_MATERIALS_COMMON]=new function(t){this.name=r.KHR_MATERIALS_COMMON,this.lights={};var e=(t.extensions&&t.extensions[r.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in e){var i,o=e[n],s=o[o.type],a=(new Ia).fromArray(s.color);switch(o.type){case"directional":(i=new Jh(a)).position.set(0,0,1);break;case"point":i=new Yh(a);break;case"spot":(i=new Kh(a)).position.set(0,0,1);break;case"ambient":i=new rd(a)}i&&(this.lights[n]=i)}}(l)),console.time("LegacyGLTFLoader"),new T(l,a,{path:e||this.path,crossOrigin:this.crossOrigin}).parse(function(t,e,r,n){console.timeEnd("LegacyGLTFLoader"),i({scene:t,scenes:e,cameras:r,animations:n})})}},t.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},e.prototype.update=function(t,e){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var o=i.uniform.value;this._m4.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld),o.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(e.projectionMatrix);break;case"JOINTMATRIX":for(var s=i.uniform.value,a=0;a<s.length;a++)s[a].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[a].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[a]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},t.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"},n={magic:"glTF",version:1,contentFormat:0},i=20;function o(t){this.name=r.KHR_BINARY_GLTF;var e=new DataView(t,0,i),o={magic:tu.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0),contentLength:e.getUint32(12,!0),contentFormat:e.getUint32(16,!0)};for(var s in n){var a=n[s];if(o[s]!==a)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',s,a)}var l=new Uint8Array(t,i,o.contentLength);this.header=o,this.content=tu.decodeText(l),this.body=t.slice(i+o.contentLength,o.length)}o.prototype.loadShader=function(t,e){var n=new Uint8Array(e[t.extensions[r.KHR_BINARY_GLTF].bufferView]);return tu.decodeText(n)};var s={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},a={5126:Number,35675:Pa,35676:Sa,35664:ka,35665:Ta,35666:ja,35678:Mc},l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:bl,9729:wl,9984:1004,9985:1007,9986:1005,9987:_l},u={33071:yl,33648:xl,10497:gl},h={6406:1021,6407:Al,6408:El,6409:1024,6410:1025},d={5121:Sl,32819:1017,32820:1018,33635:1019},p={1028:nl,1029:rl},f={512:0,513:2,514:4,515:dl,516:5,517:7,518:5,519:1},m={32774:cl,32778:101,32779:102},v={0:200,1:201,768:202,769:203,770:ul,771:hl,772:206,773:207,774:208,775:209,776:210},g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={scale:"scale",translation:"position",rotation:"quaternion"},x={LINEAR:2301,STEP:Ll},b={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function w(t,e,r){var n;if(!t)return Promise.resolve();var i=[];if("[object Array]"===Object.prototype.toString.call(t)){n=[];for(var o=t.length,s=0;s<o;s++)(l=e.call(r||this,t[s],s))&&(i.push(l),l instanceof Promise?l.then((function(t,e){n[t]=e}).bind(this,s)):n[s]=l)}else for(var a in n={},t){var l;t.hasOwnProperty(a)&&(l=e.call(r||this,t[a],a))&&(i.push(l),l instanceof Promise?l.then((function(t,e){n[t]=e}).bind(this,a)):n[a]=l)}return Promise.all(i).then(function(){return n})}function _(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:(e||"")+t}function S(t){this.isDeferredShaderMaterial=!0,this.params=t}function T(t,e,r){this.json=t||{},this.extensions=e||{},this.options=r||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}},update:function(e,r){for(var n in t){var i=t[n];i.update&&i.update(e,r)}}}}}S.prototype.create=function(){var t=Ec.clone(this.params.uniforms);for(var e in this.params.uniforms){var r=this.params.uniforms[e];r.value instanceof Mc&&(t[e].value=r.value,t[e].value.needsUpdate=!0),t[e].semantic=r.semantic,t[e].node=r.node}return this.params.uniforms=t,new qc(this.params)},T.prototype._withDependencies=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),o=this.cache.get(n);if(void 0!==o)e[n]=o;else if(this[i]){var s=this[i]();this.cache.add(n,s),e[n]=s}}return w(e,function(t){return t})},T.prototype.parse=function(t){var e=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var o=void 0!==e.scene?r.scenes[e.scene]:n[0],s=[];for(var i in r.cameras)s.push(r.cameras[i]);var a=[];for(var i in r.animations)a.push(r.animations[i]);t(o,n,s,a)})},T.prototype.loadShaders=function(){var t=this.json,e=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then(function(i){return w(t.shaders,function(t){return t.extensions&&t.extensions[r.KHR_BINARY_GLTF]?e[r.KHR_BINARY_GLTF].loadShader(t,i.bufferViews):new Promise(function(e){var r=new kc;r.setResponseType("text"),r.load(_(t.uri,n.path),function(t){e(t)})})})})},T.prototype.loadBuffers=function(){var t=this.extensions,e=this.options;return w(this.json.buffers,function(n,i){return"binary_glTF"===i?t[r.KHR_BINARY_GLTF].body:"arraybuffer"===n.type||void 0===n.type?new Promise(function(t){var r=new kc;r.setResponseType("arraybuffer"),r.load(_(n.uri,e.path),function(e){t(e)})}):void console.warn("LegacyGLTFLoader: "+n.type+" buffer type is not supported")})},T.prototype.loadBufferViews=function(){var t=this.json;return this._withDependencies(["buffers"]).then(function(e){return w(t.bufferViews,function(t){return e.buffers[t.buffer].slice(t.byteOffset,t.byteOffset+(void 0!==t.byteLength?t.byteLength:0))})})},T.prototype.loadAccessors=function(){var t=this.json;return this._withDependencies(["bufferViews"]).then(function(e){return w(t.accessors,function(t){var r=e.bufferViews[t.bufferView],n=g[t.type],i=l[t.componentType],o=i.BYTES_PER_ELEMENT;if(t.byteStride&&t.byteStride!==o*n){var s=new i(r);return new Eh(new Mh(s,t.byteStride/o),n,t.byteOffset/o)}return new za(s=new i(r,t.byteOffset,t.count*n),n)})})},T.prototype.loadTextures=function(){var t=this.json,e=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return w(t.textures,function(i){if(i.source)return new Promise(function(o){var s=t.images[i.source],a=s.uri,l=!1;if(s.extensions&&s.extensions[r.KHR_BINARY_GLTF]){var p=s.extensions[r.KHR_BINARY_GLTF],f=new Blob([n.bufferViews[p.bufferView]],{type:p.mimeType});a=URL.createObjectURL(f),l=!0}var m=$c.Handlers.get(a);null===m&&(m=new Kc),m.setCrossOrigin(e.crossOrigin),m.load(_(a,e.path),function(e){if(l&&URL.revokeObjectURL(a),e.flipY=!1,void 0!==i.name&&(e.name=i.name),e.format=void 0!==i.format?h[i.format]:El,void 0!==i.internalFormat&&e.format!==h[i.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==i.type?d[i.type]:Sl,i.sampler){var r=t.samplers[i.sampler];e.magFilter=c[r.magFilter]||wl,e.minFilter=c[r.minFilter]||1005,e.wrapS=u[r.wrapS]||gl,e.wrapT=u[r.wrapT]||gl}o(e)},void 0,function(){l&&URL.revokeObjectURL(a),o()})})})})},T.prototype.loadMaterials=function(){var t=this.json;return this._withDependencies(["shaders","textures"]).then(function(e){return w(t.materials,function(n){var i,o,l={},c={};if(n.extensions&&n.extensions[r.KHR_MATERIALS_COMMON]&&(o=n.extensions[r.KHR_MATERIALS_COMMON]),o){var u=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":i=Vc,u.push("diffuse","specular","shininess");break;case"LAMBERT":i=jc,u.push("diffuse");break;case"CONSTANT":default:i=zl}u.forEach(function(t){void 0!==o.values[t]&&(l[t]=o.values[t])}),(o.doubleSided||l.doubleSided)&&(c.side=il),(o.transparent||l.transparent)&&(c.transparent=!0,c.opacity=void 0!==l.transparency?l.transparency:1)}else if(void 0===n.technique)i=Vc,Object.assign(l,n.values);else{i=S;var h=t.techniques[n.technique];c.uniforms={};var d=t.programs[h.program];if(d){c.fragmentShader=e.shaders[d.fragmentShader],c.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),i=Vc);var g=e.shaders[d.vertexShader];g||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),i=Vc),c.vertexShader=function(t,e){var r={};for(var n in e.attributes)r[n]={type:(c=e.parameters[l=e.attributes[n]]).type,semantic:u=c.semantic};var i=e.parameters,o=e.attributes,s={};for(var n in r){var a=i[l=o[n]];(u=a.semantic)&&(s[n]=a)}for(var l in s){var c,u=(c=s[l]).semantic,h=new RegExp("\\b"+l+"\\b","g");switch(u){case"POSITION":t=t.replace(h,"position");break;case"NORMAL":t=t.replace(h,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":t=t.replace(h,"uv");break;case"TEXCOORD_1":t=t.replace(h,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":t=t.replace(h,"color");break;case"WEIGHT":t=t.replace(h,"skinWeight");break;case"JOINT":t=t.replace(h,"skinIndex")}}return t}(g,h);var y=h.uniforms;for(var x in y){var w=y[x],_=h.parameters[w],T=_.type;if(!a[T])throw new Error("Unknown shader uniform param type: "+T);var M,A=_.count;void 0!==n.values&&(M=n.values[w]);var E=new a[T],C=_.semantic,P=_.node;switch(T){case s.FLOAT:E=_.value,"transparency"==w&&(c.transparent=!0),void 0!==M&&(E=M);break;case s.FLOAT_VEC2:case s.FLOAT_VEC3:case s.FLOAT_VEC4:case s.FLOAT_MAT3:_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case s.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case s.FLOAT_MAT4:if(A){E=new Array(A);for(var O=0;O<A;O++)E[O]=new a[T];_&&_.value&&E.fromArray(_.value),M&&E.fromArray(M)}else _&&_.value&&E.fromArray(_.value),M&&E.fromArray(M);break;case s.SAMPLER_2D:E=void 0!==M?e.textures[M]:void 0!==_.value?e.textures[_.value]:null}c.uniforms[x]={value:E,semantic:C,node:P}}for(var N=h.states||{},L=N.enable||[],I=N.functions||{},R=!1,D=!1,F=!1,k=0,U=L.length;k<U;k++){var B=L[k];switch(b[B]){case"CULL_FACE":R=!0;break;case"DEPTH_TEST":D=!0;break;case"BLEND":F=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+B)}}c.side=R?void 0!==I.cullFace?p[I.cullFace]:rl:il,c.depthTest=D,c.depthFunc=void 0!==I.depthFunc?f[I.depthFunc]:2,c.depthWrite=void 0===I.depthMask||I.depthMask[0],c.blending=F?5:0,c.transparent=F;var j=I.blendEquationSeparate;void 0!==j?(c.blendEquation=m[j[0]],c.blendEquationAlpha=m[j[1]]):(c.blendEquation=cl,c.blendEquationAlpha=cl);var z=I.blendFuncSeparate;void 0!==z?(c.blendSrc=v[z[0]],c.blendDst=v[z[1]],c.blendSrcAlpha=v[z[2]],c.blendDstAlpha=v[z[3]]):(c.blendSrc=201,c.blendDst=200,c.blendSrcAlpha=201,c.blendDstAlpha=200)}}Array.isArray(l.diffuse)?c.color=(new Ia).fromArray(l.diffuse):"string"==typeof l.diffuse&&(c.map=e.textures[l.diffuse]),delete c.diffuse,"string"==typeof l.reflective&&(c.envMap=e.textures[l.reflective]),"string"==typeof l.bump&&(c.bumpMap=e.textures[l.bump]),Array.isArray(l.emission)?i===zl?c.color=(new Ia).fromArray(l.emission):c.emissive=(new Ia).fromArray(l.emission):"string"==typeof l.emission&&(i===zl?c.map=e.textures[l.emission]:c.emissiveMap=e.textures[l.emission]),Array.isArray(l.specular)?c.specular=(new Ia).fromArray(l.specular):"string"==typeof l.specular&&(c.specularMap=e.textures[l.specular]),void 0!==l.shininess&&(c.shininess=l.shininess);var V=new i(c);return void 0!==n.name&&(V.name=n.name),V})})},T.prototype.loadMeshes=function(){var t=this.json;return this._withDependencies(["accessors","materials"]).then(function(e){return w(t.meshes,function(r){var n=new Fh;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);var i=r.primitives||[];for(var o in i){var a=i[o];if(a.mode===s.TRIANGLES||void 0===a.mode){var l=new $a,c=a.attributes;for(var u in c){if(!(f=c[u]))return;var h=e.accessors[f];switch(u){case"POSITION":l.addAttribute("position",h);break;case"NORMAL":l.addAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":l.addAttribute("uv",h);break;case"TEXCOORD_1":l.addAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h);break;case"WEIGHT":l.addAttribute("skinWeight",h);break;case"JOINT":l.addAttribute("skinIndex",h);break;default:if(!a.material)break;if(!(v=t.materials[a.material]).technique)break;var d=t.techniques[v.technique].parameters||{};for(var p in d)d[p].semantic===u&&l.addAttribute(p,h)}}a.indices&&l.setIndex(e.accessors[a.indices]),(m=new ql(l,v=void 0!==e.materials?e.materials[a.material]:new Vc({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:rl}))).castShadow=!0,m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else if(a.mode===s.LINES){for(var u in l=new $a,c=a.attributes){var f;if(!(f=c[u]))return;switch(h=e.accessors[f],u){case"POSITION":l.addAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",h)}}var m,v=e.materials[a.material];a.indices?(l.setIndex(e.accessors[a.indices]),m=new nd(l,v)):m=new Yl(l,v),m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else console.warn("Only triangular and line primitives are supported")}return n})})},T.prototype.loadCameras=function(){return w(this.json.cameras,function(t){if("perspective"==t.type&&t.perspective){var e=void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:1,r=new bc(_a.radToDeg(t.perspective.yfov*e),e,t.perspective.znear||1,t.perspective.zfar||2e6);return void 0!==t.name&&(r.name=t.name),t.extras&&(r.userData=t.extras),r}if("orthographic"==t.type&&t.orthographic)return r=new Sc(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,t.orthographic.znear,t.orthographic.zfar),void 0!==t.name&&(r.name=t.name),t.extras&&(r.userData=t.extras),r})},T.prototype.loadSkins=function(){var t=this.json;return this._withDependencies(["accessors"]).then(function(e){return w(t.skins,function(t){var r=new Sa;return void 0!==t.bindShapeMatrix&&r.fromArray(t.bindShapeMatrix),{bindShapeMatrix:r,jointNames:t.jointNames,inverseBindMatrices:e.accessors[t.inverseBindMatrices]}})})},T.prototype.loadAnimations=function(){var t=this.json;return this._withDependencies(["accessors","nodes"]).then(function(e){return w(t.animations,function(t,r){var n=[];for(var i in t.channels){var o=t.channels[i],s=t.samplers[o.sampler];if(s){var a=o.target,l=a.id,c=e.accessors[void 0!==t.parameters?t.parameters[s.input]:s.input],u=e.accessors[void 0!==t.parameters?t.parameters[s.output]:s.output],h=e.nodes[l];if(h){h.updateMatrix(),h.matrixAutoUpdate=!0;var d=void 0!==s.interpolation?x[s.interpolation]:2301;n.push(new(y[a.path]===y.rotation?lc:uc)((h.name?h.name:h.uuid)+"."+y[a.path],fc.arraySlice(c.array,0),fc.arraySlice(u.array,0),d))}}}return new gc(l=void 0!==t.name?t.name:"animation_"+r,void 0,n)})})},T.prototype.loadNodes=function(){var t=this.json,e=this.extensions,n=this;return w(t.nodes,function(t){var e,r=new Sa;return t.jointName?((e=new Ql).name=void 0!==t.name?t.name:t.jointName,e.jointName=t.jointName):(e=new Na,void 0!==t.name&&(e.name=t.name)),t.extras&&(e.userData=t.extras),void 0!==t.matrix?(r.fromArray(t.matrix),e.applyMatrix(r)):(void 0!==t.translation&&e.position.fromArray(t.translation),void 0!==t.rotation&&e.quaternion.fromArray(t.rotation),void 0!==t.scale&&e.scale.fromArray(t.scale)),e}).then(function(i){return n._withDependencies(["meshes","skins","cameras"]).then(function(n){return w(i,function(o,s){var a=t.nodes[s];if(void 0!==a.meshes)for(var l in a.meshes){var c=a.meshes[l],u=n.meshes[c];if(void 0!==u)for(var h in u.children){var d,p=u.children[h],f=p.material,m=p.geometry,v=p.userData,g=p.name;switch(f.isDeferredShaderMaterial?f=y=f.create():y=f,p.type){case"LineSegments":p=new nd(m,y);break;case"LineLoop":p=new ld(m,y);break;case"Line":p=new Yl(m,y);break;default:p=new ql(m,y)}if(p.castShadow=!0,p.userData=v,p.name=g,a.skin&&(d=n.skins[a.skin]),d){var y,x=function(t){for(var e=Object.keys(i),r=0,n=e.length;r<n;r++){var o=i[e[r]];if(o.jointName===t)return o}return null},b=m;(y=f).skinning=!0,(p=new zh(b,y)).castShadow=!0,p.userData=v,p.name=g;for(var w=[],_=[],S=0,T=d.jointNames.length;S<T;S++){var M=d.jointNames[S],A=x(M);if(A){w.push(A);var E=d.inverseBindMatrices.array,C=(new Sa).fromArray(E,16*S);_.push(C)}else console.warn("WARNING: joint: '"+M+"' could not be found")}p.bind(new jh(w,_),d.bindShapeMatrix);var P=function(e,r,n){var o=e[n];if(void 0!==o)for(var s=0,a=o.length;s<a;s++){var l=o[s],c=i[l],u=t.nodes[l];void 0!==c&&!0===c.isBone&&void 0!==u&&(r.add(c),P(u,c,"children"))}};P(a,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+c+'".')}return void 0!==a.camera&&o.add(n.cameras[a.camera]),a.extensions&&a.extensions[r.KHR_MATERIALS_COMMON]&&a.extensions[r.KHR_MATERIALS_COMMON].light&&o.add(e[r.KHR_MATERIALS_COMMON].lights[a.extensions[r.KHR_MATERIALS_COMMON].light]),o})})})},T.prototype.loadScenes=function(){var t=this.json;function r(e,n,i){var o=i[e];n.add(o);var s=t.nodes[e];if(s.children)for(var a=s.children,l=0,c=a.length;l<c;l++)r(a[l],o,i)}return this._withDependencies(["nodes"]).then(function(n){return w(t.scenes,function(t){var i=new _c;void 0!==t.name&&(i.name=t.name),t.extras&&(i.userData=t.extras);for(var o=t.nodes||[],s=0,a=o.length;s<a;s++)r(o[s],i,n.nodes);return i.traverse(function(t){t.material&&t.material.isRawShaderMaterial&&(t.gltfShader=new e(t,n.nodes),t.onBeforeRender=function(t,e,r){this.gltfShader.update(e,r)})}),i})})}}();var cd=function(t){this.timeLoaded=0,this.manager=t||Dc,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=Rl,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};function ud(t){this.manager=void 0!==t?t:Dc,this._parser=null}function hd(t){var e,r=t.Content,n=t.RelativeFilename||t.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+e+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:e}))}function dd(t,e,r,n){var i=function(t,e,r,n){var i,o=e.path,s=n.get(t.id).children;void 0!==s&&s.length>0&&void 0!==r[s[0].ID]&&(0!==(i=r[s[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||e.setPath(void 0));var a=e.load(i);return e.setPath(o),a}(t,e,r,n);i.ID=t.id,i.name=t.attrName;var o=t.WrapModeU,s=t.WrapModeV,a=void 0!==s?s.value:0;if(i.wrapS=0===(void 0!==o?o.value:0)?gl:yl,i.wrapT=0===a?gl:yl,"Scaling"in t){var l=t.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}return i}function pd(t,e,r,n){var i=e.id,o=e.attrName,s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!n.has(i))return null;var a,l=function(t,e,r,n,i){var o={};return e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new Ia).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new Ia).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Specular?o.specular=(new Ia).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.emissive=(new Ia).fromArray(e.SpecularColor.value)),e.Shininess&&(o.shininess=e.Shininess.value),e.Emissive?o.emissive=(new Ia).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new Ia).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),i.get(n).children.forEach(function(e){var n=e.relationship;switch(n){case"Bump":o.bumpMap=r.get(e.ID);break;case"DiffuseColor":o.map=fd(t,r,e.ID,i);break;case"DisplacementColor":o.displacementMap=fd(t,r,e.ID,i);break;case"EmissiveColor":o.emissiveMap=fd(t,r,e.ID,i);break;case"NormalMap":o.normalMap=fd(t,r,e.ID,i);break;case"ReflectionColor":o.envMap=fd(t,r,e.ID,i),o.envMap.mapping=ml;break;case"SpecularColor":o.specularMap=fd(t,r,e.ID,i);break;case"TransparentColor":o.alphaMap=fd(t,r,e.ID,i),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),o}(t,e,r,i,n);switch(s.toLowerCase()){case"phong":a=new Vc;break;case"lambert":a=new jc;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Vc({color:3342591})}return a.setValues(l),a.name=o,a}function fd(t,e,r,n){return"LayeredTexture"in t.Objects&&r in t.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=n.get(r).children[0].ID),e.get(r)}function md(t,e){var r=[];return t.children.forEach(function(t){var n=e[t.ID];if("Cluster"===n.attrType){var i={ID:t.ID,indices:[],weights:[],transform:(new Sa).fromArray(n.Transform.a),transformLink:(new Sa).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}}function vd(t,e,r,n){switch(r.attrType){case"Mesh":return function(t,e,r,n){var i=e.parents.map(function(e){return t.Objects.Model[e.ID]});if(0!==i.length){var o=e.children.reduce(function(t,e){return void 0!==n[e.ID]&&(t=n[e.ID]),t},null),s=new Sa,a=i[0];if("GeometricRotation"in a){var l=a.GeometricRotation.value.map(_a.degToRad);l[3]="ZYX",s.makeRotationFromEuler((new Ea).fromArray(l))}return"GeometricTranslation"in a&&s.setPosition((new Ta).fromArray(a.GeometricTranslation.value)),"GeometricScaling"in a&&s.scale((new Ta).fromArray(a.GeometricScaling.value)),function(t,e,r,n,i){var o=r.Vertices.a,s=r.PolygonVertexIndex.a,a=[],l=[],c=[],u=[],h=[],d=[],p=[];if(r.LayerElementColor)var f=function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.ColorIndex.a),{dataSize:4,buffer:t.Colors.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}(r.LayerElementColor[0]);if(r.LayerElementMaterial)var m=function(t){var e=t.MappingInformationType,r=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=t.Materials.a,i=[],o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:e,referenceType:r}}(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var v=function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:t.Normals.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var g=[],y=0;r.LayerElementUV[y];)g.push(gd(r.LayerElementUV[y])),y++;var x={};null!==n&&n.rawBones.forEach(function(t,e){t.indices.forEach(function(r,n){void 0===x[r]&&(x[r]=[]),x[r].push({id:e,weight:t.weights[n]})})});var b=0,w=0,_=!1,S=[],T=[],M=[],A=[],E=[],C=[];s.forEach(function(t,e){var r=!1;t<0&&(s[e]=t^=-1,r=!0);var i=[],y=[];if(S.push(3*t,3*t+1,3*t+2),f){var P=bd(e,b,t,f);M.push(P[0],P[1],P[2])}if(n){if(void 0!==x[t]&&x[t].forEach(function(t){y.push(t.weight),i.push(t.id)}),y.length>4){_||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),_=!0);var O=[0,0,0,0],N=[0,0,0,0];y.forEach(function(t,e){var r=t,n=i[e];N.forEach(function(t,e,i){if(r>t){i[e]=r,r=t;var o=O[e];O[e]=n,n=o}})}),i=O,y=N}for(;y.length<4;)y.push(0),i.push(0);for(var L=0;L<4;++L)E.push(y[L]),C.push(i[L])}if(v&&(P=bd(e,b,t,v),T.push(P[0],P[1],P[2])),m&&"AllSame"!==m.mappingType)var I=bd(e,b,t,m)[0];if(g&&g.forEach(function(r,n){var i=bd(e,b,t,r);void 0===A[n]&&(A[n]=[]),A[n].push(i[0]),A[n].push(i[1])}),w++,r){for(L=2;L<w;L++)a.push(o[S[0]]),a.push(o[S[1]]),a.push(o[S[2]]),a.push(o[S[3*(L-1)]]),a.push(o[S[3*(L-1)+1]]),a.push(o[S[3*(L-1)+2]]),a.push(o[S[3*L]]),a.push(o[S[3*L+1]]),a.push(o[S[3*L+2]]),n&&(d.push(E[0]),d.push(E[1]),d.push(E[2]),d.push(E[3]),d.push(E[4*(L-1)]),d.push(E[4*(L-1)+1]),d.push(E[4*(L-1)+2]),d.push(E[4*(L-1)+3]),d.push(E[4*L]),d.push(E[4*L+1]),d.push(E[4*L+2]),d.push(E[4*L+3]),p.push(C[0]),p.push(C[1]),p.push(C[2]),p.push(C[3]),p.push(C[4*(L-1)]),p.push(C[4*(L-1)+1]),p.push(C[4*(L-1)+2]),p.push(C[4*(L-1)+3]),p.push(C[4*L]),p.push(C[4*L+1]),p.push(C[4*L+2]),p.push(C[4*L+3])),f&&(c.push(M[0]),c.push(M[1]),c.push(M[2]),c.push(M[3*(L-1)]),c.push(M[3*(L-1)+1]),c.push(M[3*(L-1)+2]),c.push(M[3*L]),c.push(M[3*L+1]),c.push(M[3*L+2])),m&&"AllSame"!==m.mappingType&&(h.push(I),h.push(I),h.push(I)),v&&(l.push(T[0]),l.push(T[1]),l.push(T[2]),l.push(T[3*(L-1)]),l.push(T[3*(L-1)+1]),l.push(T[3*(L-1)+2]),l.push(T[3*L]),l.push(T[3*L+1]),l.push(T[3*L+2])),g&&g.forEach(function(t,e){void 0===u[e]&&(u[e]=[]),u[e].push(A[e][0]),u[e].push(A[e][1]),u[e].push(A[e][2*(L-1)]),u[e].push(A[e][2*(L-1)+1]),u[e].push(A[e][2*L]),u[e].push(A[e][2*L+1])});b++,w=0,S=[],T=[],M=[],A=[],E=[],C=[]}});var P=new $a;P.name=r.name;var O=new Za(a,3);if(i.applyToBufferAttribute(O),P.addAttribute("position",O),c.length>0&&P.addAttribute("color",new Za(c,3)),n&&(P.addAttribute("skinIndex",new Za(p,4)),P.addAttribute("skinWeight",new Za(d,4)),P.FBX_Deformer=n),l.length>0){var N=new Za(l,3);(new Pa).getNormalMatrix(i).applyToBufferAttribute(N),P.addAttribute("normal",N)}if(u.forEach(function(t,e){var r="uv"+(e+1).toString();0===e&&(r="uv"),P.addAttribute(r,new Za(u[e],2))}),m&&"AllSame"!==m.mappingType){var L=h[0],I=0;if(h.forEach(function(t,e){t!==L&&(P.addGroup(I,e-I,L),L=t,I=e)}),P.groups.length>0){var R=P.groups[P.groups.length-1],D=R.start+R.count;D!==h.length&&P.addGroup(D,h.length-D,L)}0===P.groups.length&&P.addGroup(0,h.length,h[0])}return P}(0,0,r,o,s)}}(t,e,r,n);case"NurbsCurve":return function(t){if(void 0===$u)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new $a;var e=parseInt(t.Order);if(isNaN(e))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new $a;for(var r,n,i=e-1,o=t.KnotVector.a,s=[],a=t.Points.a,l=0,c=a.length;l<c;l+=4)s.push((new ja).fromArray(a,l));if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form)for(n=o.length-1-(r=i),l=0;l<i;++l)s.push(s[l]);var u=new $u(i,o,s,r,n).getPoints(7*s.length),h=new Float32Array(3*u.length);u.forEach(function(t,e){t.toArray(h,3*e)});var d=new $a;return d.addAttribute("position",new za(h,3)),d}(r)}}function gd(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.UVIndex.a),{dataSize:2,buffer:t.UV.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}}cd.prototype={constructor:cd,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.load(t,function(t){i.decodeDracoFile(t,e)},r,n)},setPath:function(t){this.path=t},setCrossOrigin:function(t){this.crossOrigin=t},setVerbosity:function(t){this.verbosity=t},setDrawMode:function(t){this.drawMode=t},setSkipDequantization:function(t,e){var r=!0;"undefined"!=typeof e&&(r=e),this.getAttributeOptions(t).skipDequantization=r},decodeDracoFile:function(t,e,r){var n=this;cd.getDecoderModule().then(function(i){n.decodeDracoFileInternal(t,i.decoder,e,r||{})})},decodeDracoFileInternal:function(t,e,r,n){var i=new e.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength);var o=new e.Decoder,s=o.GetEncodedGeometryType(i);if(s==e.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=e.POINT_CLOUD){var a="DRACOLoader: Unknown geometry type.";throw console.error(a),new Error(a)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(e,o,s,i,n))},addAttributeToGeometry:function(t,e,r,n,i,o,s){if(0===i.ptr){var a="DRACOLoader: No attribute "+n;throw console.error(a),new Error(a)}var l=i.num_components(),c=new t.DracoFloat32Array;e.GetAttributeFloatForAllPoints(r,i,c);var u=r.num_points()*l;s[n]=new Float32Array(u);for(var h=0;h<u;h++)s[n][h]=c.GetValue(h);o.addAttribute(n,new Za(s[n],l)),t.destroy(c)},convertDracoGeometryTo3JS:function(t,e,r,n,i){var o,s;!0===this.getAttributeOptions("position").skipDequantization&&e.SkipAttributeTransform(t.POSITION);var a=performance.now();if(r===t.TRIANGULAR_MESH?(o=new t.Mesh,s=e.DecodeBufferToMesh(n,o)):(o=new t.PointCloud,s=e.DecodeBufferToPointCloud(n,o)),!s.ok()||0==o.ptr){var l="DRACOLoader: Decoding failed: ";throw l+=s.error_msg(),console.error(l),t.destroy(e),t.destroy(o),new Error(l)}var c,u=performance.now();t.destroy(n),r==t.TRIANGULAR_MESH?(c=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var h=o.num_points(),d=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+d.toString()));var p=e.GetAttributeId(o,t.POSITION);if(-1==p)throw l="DRACOLoader: No position attribute found.",console.error(l),t.destroy(e),t.destroy(o),new Error(l);var f=e.GetAttribute(o,p),m={},v=new $a;for(var g in this.nativeAttributeMap)if(void 0===i[g]){var y=e.GetAttributeId(o,t[this.nativeAttributeMap[g]]);if(-1!==y){this.verbosity>0&&console.log("Loaded "+g+" attribute.");var x=e.GetAttribute(o,y);this.addAttributeToGeometry(t,e,o,g,x,v,m)}}for(var g in i)x=e.GetAttributeByUniqueId(o,i[g]),this.addAttributeToGeometry(t,e,o,g,x,v,m);if(r==t.TRIANGULAR_MESH)if(this.drawMode===Dl){var b=new t.DracoInt32Array;e.GetTriangleStripsFromMesh(o,b),m.indices=new Uint32Array(b.size());for(var w=0;w<b.size();++w)m.indices[w]=b.GetValue(w);t.destroy(b)}else{m.indices=new Uint32Array(3*c);var _=new t.DracoInt32Array;for(w=0;w<c;++w){e.GetFaceFromMesh(o,w,_);var S=3*w;m.indices[S]=_.GetValue(0),m.indices[S+1]=_.GetValue(1),m.indices[S+2]=_.GetValue(2)}t.destroy(_)}v.drawMode=this.drawMode,r==t.TRIANGULAR_MESH&&v.setIndex(new(m.indices.length>65535?Ya:Xa)(m.indices,1));var T=new t.AttributeQuantizationTransform;if(T.InitFromAttribute(f))for(v.attributes.position.isQuantized=!0,v.attributes.position.maxRange=T.range(),v.attributes.position.numQuantizationBits=T.quantization_bits(),v.attributes.position.minValues=new Float32Array(3),w=0;w<3;++w)v.attributes.position.minValues[w]=T.min_value(w);return t.destroy(T),t.destroy(e),t.destroy(o),this.decode_time=u-a,this.import_time=performance.now()-u,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),v},isVersionSupported:function(t,e){cd.getDecoderModule().then(function(r){e(r.decoder.isVersionSupported(t))})},getAttributeOptions:function(t){return"undefined"==typeof this.attributeOptions[t]&&(this.attributeOptions[t]={}),this.attributeOptions[t]}},cd.decoderPath="./",cd.decoderConfig={},cd.decoderModulePromise=null,cd.setDecoderPath=function(t){cd.decoderPath=t},cd.setDecoderConfig=function(t){var e=cd.decoderConfig.wasmBinary;cd.decoderConfig=t||{},cd.releaseDecoderModule(),e&&(cd.decoderConfig.wasmBinary=e)},cd.releaseDecoderModule=function(){cd.decoderModulePromise=null},cd.getDecoderModule=function(){var t=this,e=cd.decoderPath,r=cd.decoderConfig,n=cd.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?n=cd._loadScript(e+"draco_decoder.js"):(r.wasmBinaryFile=e+"draco_decoder.wasm",n=cd._loadScript(e+"draco_wasm_wrapper.js").then(function(){return cd._loadArrayBuffer(r.wasmBinaryFile)}).then(function(t){r.wasmBinary=t})),n=n.then(function(){return new Promise(function(e){r.onModuleLoaded=function(r){t.timeLoaded=performance.now(),e({decoder:r})},DracoDecoderModule(r)})}),cd.decoderModulePromise=n,n)},cd._loadScript=function(t){var e=document.getElementById("decoder_script");null!==e&&e.parentNode.removeChild(e);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=t,new Promise(function(t){n.onload=t,r.appendChild(n)})},cd._loadArrayBuffer=function(t){var e=new kc;return e.setResponseType("arraybuffer"),new Promise(function(r,n){e.load(t,r,void 0,n)})},Object.assign(ud.prototype,{load:function(t,e,r,n){var i=this,o=new xh,s=new kc(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){var r=i._parser(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:yl,o.wrapT=void 0!==r.wrapT?r.wrapT:yl,o.magFilter=void 0!==r.magFilter?r.magFilter:wl,o.minFilter=void 0!==r.minFilter?r.minFilter:_l,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=wl),o.needsUpdate=!0,e&&e(o,r))},r,n),o}}),((function(t){this.manager=void 0!==t?t:Dc}).prototype=Object.create(ud.prototype))._parser=function(t){var e=65536,r=e>>3,n=14,i=65537,o=1<<n,s=o-1,a=59,l=63,c=2+l-a,u=8,h=4,d=4,p=2,f=1,m={l:0,c:0,lc:0};function v(t,e,r,n,i){for(;r<t;)e=e<<8|L(n,i),r+=8;m.l=e>>(r-=t)&(1<<t)-1,m.c=e,m.lc=r}var g=new Array(59);function y(t){return 63&t}function x(t){return t>>6}var b={c:0,lc:0};function w(t,e,r,n){t=t<<8|L(r,n),e+=8,b.c=t,b.lc=e}var _={c:0,lc:0};function S(t,e,r,n,i,o,s,a,l,c){if(t==e){n<8&&(w(r,n,i,s),r=b.c,n=b.lc);var u=r>>(n-=8);if(out+u>oe)throw"Issue with getCode";for(var h=out[-1];u-- >0;)a[l.value++]=h}else{if(!(l.value<c))throw"Issue with getCode";a[l.value++]=t}_.c=r,_.lc=n}function T(t){var e=function(t){return 65535&t}(t);return e>32767?e-65536:e}var M={a:0,b:0};function A(t,e){var r=T(t),n=T(e),i=r+(1&n)+(n>>1),o=i-n;M.a=i,M.b=o}function E(t,e,r,n,i,o,s){for(var a,l=r>i?i:r,c=1;c<=l;)c<<=1;for(a=c>>=1,c>>=1;c>=1;){for(var u,h,d,p=0,f=p+o*(i-a),m=o*c,v=o*a,g=n*c,y=n*a;p<=f;p+=v){for(var x=p,b=p+n*(r-a);x<=b;x+=y){var w,_=x+g,S=(w=x+m)+g;A(e[x+t],e[w+t]),u=M.a,h=M.b,A(e[_+t],e[S+t]),d=M.b,A(u,M.a),e[x+t]=M.a,e[_+t]=M.b,A(h,d),e[w+t]=M.a,e[S+t]=M.b}r&c&&(A(e[x+t],e[(w=x+m)+t]),u=M.a,e[w+t]=M.b,e[x+t]=u)}if(i&c)for(x=p,b=p+n*(r-a);x<=b;x+=y)A(e[x+t],e[(_=x+g)+t]),u=M.a,e[_+t]=M.b,e[x+t]=u;a=c,c>>=1}return p}function C(t,u,h,d,p,f,T,M,A,C){var P=new Uint8Array(r),O=F(d,p),L=F(d,p);if(L>=r)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(O<=L)for(var R=0;R<L-O+1;R++)P[R+O]=I(d,p);var D=new Uint16Array(e);!function(t,r){for(var n=0,i=0;i<e;++i)(0==i||t[i>>3]&1<<(7&i))&&(r[n++]=i);for(;n<e;)r[n++]=0}(P,D),function(t,e,r,u,h,d,p){var f=r.value,T=N(e,r),M=N(e,r);r.value+=4;var A=N(e,r);if(r.value+=4,T<0||T>=i||M<0||M>=i)throw"Something wrong with HUF_ENCSIZE";var E=new Array(i),C=new Array(o);if(function(t){for(var e=0;e<o;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(C),function(t,e,r,n,o,s,u){for(var h=r,d=0,p=0;o<=s;o++){if(h.value-r.value>n)return!1;v(6,d,p,t,h);var f=m.l;if(d=m.c,p=m.lc,u[o]=f,f==l){if(h.value-r.value>n)throw"Something wrong with hufUnpackEncTable";if(v(8,d,p,t,h),d=m.c,p=m.lc,o+(y=m.l+c)>s+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}else if(f>=a){var y;if(o+(y=f-a+2)>s+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)u[o++]=0;o--}}!function(t){for(var e=0;e<=58;++e)g[e]=0;for(e=0;e<i;++e)g[t[e]]+=1;var r=0;for(e=58;e>0;--e){var n=r+g[e]>>1;g[e]=r,r=n}for(e=0;e<i;++e){var o=t[e];o>0&&(t[e]=o|g[o]++<<6)}}(u)}(t,0,r,u-(r.value-f),T,M,E),A>8*(u-(r.value-f)))throw"Something wrong with hufUncompress";!function(t,e,r,i){for(;e<=r;e++){var o=x(t[e]),s=y(t[e]);if(o>>s)throw"Invalid table entry";if(s>n){if((u=i[o>>s-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var a=u.p;u.p=new Array(u.lit);for(var l=0;l<u.lit-1;++l)u.p[l]=a[l]}else u.p=new Array(1);u.p[u.lit-1]=e}else if(s){var c=0;for(l=1<<n-s;l>0;l--){var u;if((u=i[(o<<n-s)+c]).len||u.p)throw"Invalid table entry";u.len=s,u.lit=e,c++}}}}(E,T,M,C),function(t,e,r,i,o,a,l,c,u,h){for(var d=0,f=0,m=p,v=Math.trunc(o.value+(a+7)/8);o.value<v;)for(w(d,f,r,o),d=b.c,f=b.lc;f>=n;)if((A=e[d>>f-n&s]).len)S(A.lit,l,d,f-=A.len,r,0,o,u,h,m),d=_.c,f=_.lc;else{if(!A.p)throw"hufDecode issues";var g;for(g=0;g<A.lit;g++){for(var T=y(t[A.p[g]]);f<T&&o.value<v;)w(d,f,r,o),d=b.c,f=b.lc;if(f>=T&&x(t[A.p[g]])==(d>>f-T&(1<<T)-1)){S(A.p[g],l,d,f-=T,r,0,o,u,h,m),d=_.c,f=_.lc;break}}if(g==A.lit)throw"hufDecode issues"}var M=8-a&7;for(d>>=M,f-=M;f>0;){var A;if(!(A=e[d<<n-f&s]).len)throw"hufDecode issues";S(A.lit,l,d,f-=A.len,r,0,o,u,h,m),d=_.c,f=_.lc}}(E,C,t,0,r,A,M,0,h,d)}(h,d,p,N(d,p),t,u,f);var k=new Array(T),U=0;for(R=0;R<T;R++)k[R]={},k[R].start=U,k[R].end=k[R].start,k[R].nx=A,k[R].ny=C,k[R].size=1,U+=k[R].nx*k[R].ny*k[R].size;var B=0;for(R=0;R<T;R++)for(var j=0;j<k[R].size;++j)B+=E(j+B,t,k[R].nx,k[R].size,k[R].ny,k[R].nx*k[R].size);return function(t,e,r){for(var n=0;n<r;++n)e[n]=t[e[n]]}(D,t,U),!0}function P(t,e){for(var r=new Uint8Array(t),n=0;0!=r[e.value+n];)n+=1;var i=(new TextDecoder).decode(r.slice(e.value,e.value+n));return e.value=e.value+n+1,i}function O(t,e){var r=t.getUint32(0,!0);return e.value=e.value+u,r}function N(t,e){var r=t.getUint32(e.value,!0);return e.value=e.value+d,r}function L(t,e){var r=t[e.value];return e.value=e.value+f,r}function I(t,e){var r=t.getUint8(e.value);return e.value=e.value+f,r}function R(t,e){var r=t.getFloat32(e.value,!0);return e.value+=h,r}function D(t){var e=(31744&t)>>10,r=1023&t;return(t>>15?-1:1)*(e?31===e?r?NaN:1/0:Math.pow(2,e-15)*(1+r/1024):r/1024*6103515625e-14)}function F(t,e){var r=t.getUint16(e.value,!0);return e.value+=p,r}function k(t,e){return D(F(t,e))}function U(t,e,r,n,i){if("string"==n||"iccProfile"==n)return function(t,e,r){var n=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+r));return e.value=e.value+r,n}(e,r,i);if("chlist"==n)return function(t,e,r,n){for(var i=r.value,o=[];r.value<i+n-1;){var s=P(e,r),a=N(t,r),l=I(t,r);r.value+=3;var c=N(t,r),u=N(t,r);o.push({name:s,pixelType:a,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,o}(t,e,r,i);if("chromaticities"==n)return function(t,e){return{redX:R(t,e),redY:R(t,e),greenX:R(t,e),greenY:R(t,e),blueX:R(t,e),blueY:R(t,e),whiteX:R(t,e),whiteY:R(t,e)}}(e,r);if("compression"==n)return function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION"][I(t,e)]}(t,r);if("box2i"==n)return function(t,e){return{xMin:N(t,e),yMin:N(t,e),xMax:N(t,e),yMax:N(t,e)}}(t,r);if("lineOrder"==n)return function(t,e){return["INCREASING_Y"][I(t,e)]}(t,r);if("float"==n)return R(t,r);if("v2f"==n)return function(t,e){return[R(t,e),R(t,e)]}(t,r);throw"Cannot parse value for unsupported type: "+n}for(var B=new DataView(t),j=new Uint8Array(t),z={},V=(B.getUint32(0,!0),B.getUint8(4,!0),B.getUint8(5,!0),{value:8}),G=!0;G;){var H=P(t,V);if(0==H)G=!1;else{var W=U(B,t,V,P(t,V),N(B,V));z[H]=W}}var X=1;"PIZ_COMPRESSION"==z.compression&&(X=32);for(var q=(z.dataWindow.yMax+1)/X,Y=0;Y<q;Y++)O(B,V);var Z=z.dataWindow.xMax-z.dataWindow.xMin+1,J=z.dataWindow.yMax-z.dataWindow.yMin+1,Q=z.channels.length,K=new Float32Array(Z*J*Q),$={R:0,G:1,B:2,A:3};if("NO_COMPRESSION"==z.compression)for(var tt=0;tt<J;tt++)for(var et=N(t,V),rt=(N(t,V),0);rt<z.channels.length;rt++){var nt=$[z.channels[rt].name];if(1!=z.channels[rt].pixelType)throw"Only supported pixel format is HALF";for(var it=0;it<Z;it++){var ot=k(t,V);K[J*Q*(Z-et)+it*Q+nt]=ot}}else{if("PIZ_COMPRESSION"!=z.compression)throw"Cannot decompress unsupported compression";for(var st=0;st<J/X;st++){N(B,V),N(B,V);var at=Z*X*(2*z.channels.length),lt=new Uint16Array(at);C(lt,{value:0},j,B,V,at,Q,0,Z,X);for(var ct=0;ct<X;ct++)for(rt=0;rt<z.channels.length;rt++){if(nt=$[z.channels[rt].name],1!=z.channels[rt].pixelType)throw"Only supported pixel format is HALF";for(it=0;it<Z;it++)ot=D(lt[rt*(X*Z)+ct*Z+it]),K[Z*Q*(J-(ct+st*X))+it*Q+nt]=ot}}}return{header:z,width:Z,height:J,data:K,format:Al,type:1015}},Object.assign((function(t){this.manager=void 0!==t?t:Dc}).prototype,{load:function(t,e,r,n){var i=this,o=tu.extractUrlBase(t),s=new kc(this.manager);s.setResponseType("arraybuffer"),s.load(t,function(r){try{var s=i.parse(r,o);e(s)}catch(e){window.setTimeout(function(){n&&n(e),i.manager.itemError(t)},0)}},r,n)},parse:function(t,e){var r;if(function(e){var r="Kaydara FBX Binary  \0";return t.byteLength>=r.length&&r===Ud(t,0,r.length)}())r=(new Ld).parse(t);else{var n=Ud(t);if(!function(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(e){var n=t[e-1];return t=t.slice(r+e),r++,n}for(var i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}(n))throw new Error("FBXLoader: Unknown format.");if(Dd(n)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+Dd(n));r=(new Nd).parse(n)}var i=function(t){var e=new Map;return"Connections"in t&&t.Connections.connections.forEach(function(t){var r=t[0],n=t[1],i=t[2];e.has(r)||e.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};e.get(r).parents.push(o),e.has(n)||e.set(n,{parents:[],children:[]});var s={ID:r,relationship:i};e.get(n).children.push(s)}),e}(r),o=function(t){var e={},r={};if("Video"in t.Objects){var n=t.Objects.Video;for(var i in n){var o=n[i];if(e[a=parseInt(i)]=o.Filename,"Content"in o&&(o.Content instanceof ArrayBuffer&&o.Content.byteLength>0||"string"==typeof o.Content&&""!==o.Content)){var s=hd(n[i]);r[o.Filename]=s}}}for(var a in e){var l=e[a];e[a]=void 0!==r[l]?r[l]:e[a].split("\\").pop()}return e}(r),s=function(t,e,r){var n=new Map;if("Material"in t.Objects){var i=t.Objects.Material;for(var o in i){var s=pd(t,i[o],e,r);null!==s&&n.set(parseInt(o),s)}}return n}(r,function(t,e,r,n){var i=new Map;if("Texture"in t.Objects){var o=t.Objects.Texture;for(var s in o){var a=dd(o[s],e,r,n);i.set(parseInt(s),a)}}return i}(r,new Kc(this.manager).setPath(e),o,i),i),a=function(t,e){var r={};if("Deformer"in t.Objects){var n=t.Objects.Deformer;for(var i in n)if("Skin"===n[i].attrType){var o=e.get(parseInt(i)),s=md(o,n);s.ID=i,o.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),s.geometryID=o.parents[0].ID,r[i]=s}}return r}(r,i);return function(t,e,r,n,i){var o=new Fh,s=function(t,e,r,n,i){var o=new Map,s=t.Objects.Model;for(var a in s){var l=parseInt(a),c=s[a],u=i.get(l),h=wd(u,e,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=_d(t,u);break;case"Light":h=Sd(t,u);break;case"Mesh":h=Td(0,u,r,n);break;case"NurbsCurve":h=Md(u,r);break;case"LimbNode":case"Null":default:h=new Fh}h.name=sh.sanitizeNodeName(c.attrName),h.ID=l}Ad(0,h,c),o.set(l,h)}return o}(t,r,n,i,e),a=t.Objects.Model;return s.forEach(function(r){!function(t,e,r,n,i){"LookAtProperty"in r&&n.get(e.ID).children.forEach(function(r){if("LookAtProperty"===r.relationship){var n=t.Objects.Model[r.ID];if("Lcl_Translation"in n){var o=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(o),i.add(e.target)):e.lookAt((new Ta).fromArray(o))}}})}(t,r,a[r.ID],e,o),e.get(r.ID).parents.forEach(function(t){var e=s.get(t.ID);void 0!==e&&e.add(r)}),null===r.parent&&o.add(r)}),function(t,e,r,n,i){var o=function(t){var e={};if("Pose"in t.Objects){var r=t.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new Sa).fromArray(t.Matrix.a)}):e[i.Node]=(new Sa).fromArray(i.Matrix.a)}}return e}(t);for(var s in e){var a=e[s];i.get(parseInt(a.ID)).parents.forEach(function(t){r.has(t.ID)&&i.get(t.ID).parents.forEach(function(t){n.has(t.ID)&&n.get(t.ID).bind(new jh(a.bones),o[t.ID])})})}}(t,r,n,s,e),function(t,e,r){r.animations=[];var n=function(t,e){if(void 0!==t.Objects.AnimationCurve){var r=function(t){var e=t.Objects.AnimationCurveNode,r=new Map;for(var n in e){var i=e[n];if(null!==i.attrName.match(/S|R|T/)){var o={id:i.id,attr:i.attrName,curves:{}};r.set(o.id,o)}}return r}(t);return function(t,e,r){var n=t.Objects.AnimationCurve;for(var i in n){var o={id:n[i].id,times:n[i].KeyTime.a.map(Fd),values:n[i].KeyValueFloat.a},s=e.get(o.id);if(void 0!==s){var a=s.parents[0].ID,l=s.parents[0].relationship,c="";if(l.match(/X/))c="x";else if(l.match(/Y/))c="y";else{if(!l.match(/Z/))continue;c="z"}r.get(a).curves[c]=o}}}(t,e,r),function(t,e,r){var n=t.Objects.AnimationStack,i={};for(var o in n){var s=e.get(parseInt(o)).children;s.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=r.get(s[0].ID);i[o]={name:n[o].attrName,layer:a}}return i}(t,e,function(t,e,r){var n=t.Objects.AnimationLayer,i=new Map;for(var o in n){var s=[],a=e.get(parseInt(o));void 0!==a&&(a.children.forEach(function(n,i){if(r.has(n.ID)){var o=r.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[i]){var a;e.get(n.ID).parents.forEach(function(t){void 0!==t.relationship&&(a=t.ID)});var l=t.Objects.Model[a.toString()],c={modelName:sh.sanitizeNodeName(l.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in l&&(c.initialPosition=l.Lcl_Translation.value),"Lcl_Rotation"in l&&(c.initialRotation=l.Lcl_Rotation.value),"Lcl_Scaling"in l&&(c.initialScale=l.Lcl_Scaling.value),"PreRotation"in l&&(c.preRotations=l.PreRotation.value),s[i]=c}s[i][o.attr]=o}}}),i.set(parseInt(o),s))}return i}(t,e,r))}}(t,e);if(void 0!==n)for(var i in n){var o=Ed(n[i]);r.animations.push(o)}}(t,e,o),function(t,e){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var r=t.GlobalSettings.AmbientColor.value,n=r[0],i=r[1],o=r[2];if(0!==n||0!==i||0!==o){var s=new Ia(n,i,o);e.add(new rd(s,1))}}}(t,o),o}(r,i,a,function(t,e,r){var n=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var s=vd(t,e.get(parseInt(o)),i[o],r);n.set(parseInt(o),s)}}return n}(r,i,a),s)}});var yd=[],xd={ByPolygonVertex:{Direct:function(t,e,r,n){return Bd(yd,n.buffer,t*n.dataSize,t*n.dataSize+n.dataSize)},IndexToDirect:function(t,e,r,n){var i=n.indices[t];return Bd(yd,n.buffer,i*n.dataSize,i*n.dataSize+n.dataSize)}},ByPolygon:{Direct:function(t,e,r,n){return Bd(yd,n.buffer,e*n.dataSize,e*n.dataSize+n.dataSize)},IndexToDirect:function(t,e,r,n){var i=n.indices[e];return Bd(yd,n.buffer,i*n.dataSize,i*n.dataSize+n.dataSize)}},ByVertice:{Direct:function(t,e,r,n){return Bd(yd,n.buffer,r*n.dataSize,r*n.dataSize+n.dataSize)}},AllSame:{IndexToDirect:function(t,e,r,n){return Bd(yd,n.buffer,n.indices[0]*n.dataSize,n.indices[0]*n.dataSize+n.dataSize)}}};function bd(t,e,r,n){return xd[n.mappingType][n.referenceType](t,e,r,n)}function wd(t,e,r,n){var i=null;return t.parents.forEach(function(t){for(var o in e){var s=e[o];s.rawBones.forEach(function(e,o){if(e.ID===t.ID){var a=i;(i=new Ql).matrixWorld.copy(e.transformLink),i.name=sh.sanitizeNodeName(n),i.ID=r,s.bones[o]=i,null!==a&&i.add(a)}})}}),i}function _d(t,e){var r,n;if(e.children.forEach(function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)}),void 0===n)r=new Na;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);var a=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,l=n.AspectHeight.value);var c=a/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new bc(u,c,o,s),null!==h&&r.setFocalLength(h);break;case 1:r=new Sc(-a/2,a/2,l/2,-l/2,o,s);break;default:console.warn("FBXLoader: Unknown camera type "+i+"."),r=new Na}}return r}function Sd(t,e){var r,n;if(e.children.forEach(function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)}),void 0===n)r=new Na;else{var i;i=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new Ia).fromArray(n.Color.value));var s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);var a=0;switch(void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),i){case 0:r=new Yh(o,s,a,1);break;case 1:r=new Jh(o,s);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=_a.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=_a.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new Kh(o,s,a,l,c,1);break;default:console.warn("FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new Yh(o,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r}function Td(t,e,r,n){var i,o=null,s=null,a=[];return e.children.forEach(function(t){r.has(t.ID)&&(o=r.get(t.ID)),n.has(t.ID)&&a.push(n.get(t.ID))}),a.length>1?s=a:a.length>0?s=a[0]:(s=new Vc({color:13421772}),a.push(s)),"color"in o.attributes&&a.forEach(function(t){t.vertexColors=al}),o.FBX_Deformer?(a.forEach(function(t){t.skinning=!0}),i=new zh(o,s)):i=new ql(o,s),i}function Md(t,e){return new Yl(t.children.reduce(function(t,r){return e.has(r.ID)&&(t=e.get(r.ID)),t},null),new Vl({color:3342591,linewidth:1}))}function Ad(t,e,r){if("RotationOrder"in r){var n=parseInt(r.RotationOrder.value,10);n>0&&n<6?console.warn("FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][n]):6===n&&console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in r&&e.position.fromArray(r.Lcl_Translation.value),"Lcl_Rotation"in r){var i=r.Lcl_Rotation.value.map(_a.degToRad);i.push("ZYX"),e.quaternion.setFromEuler((new Ea).fromArray(i))}if("Lcl_Scaling"in r&&e.scale.fromArray(r.Lcl_Scaling.value),"PreRotation"in r){var o=r.PreRotation.value.map(_a.degToRad);o[3]="ZYX";var s=(new Ea).fromArray(o);s=(new Ma).setFromEuler(s),e.quaternion.premultiply(s)}}function Ed(t){var e=[];return t.layer.forEach(function(t){e=e.concat(function(t){var e=[];if(void 0!==t.T&&Object.keys(t.T.curves).length>0){var r=Cd(t.modelName,t.T.curves,t.initialPosition,"position");void 0!==r&&e.push(r)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var n=function(t,e,r,n){void 0!==e.x&&(e.x.values=e.x.values.map(_a.degToRad)),void 0!==e.y&&(e.y.values=e.y.values.map(_a.degToRad)),void 0!==e.z&&(e.z.values=e.z.values.map(_a.degToRad));var i=Od(e),o=Pd(i,e,r);void 0!==n&&((n=n.map(_a.degToRad)).push("ZYX"),n=(new Ea).fromArray(n),n=(new Ma).setFromEuler(n));for(var s=new Ma,a=new Ea,l=[],c=0;c<o.length;c+=3)a.set(o[c],o[c+1],o[c+2],"ZYX"),s.setFromEuler(a),void 0!==n&&s.premultiply(n),s.toArray(l,c/3*4);return new lc(t+".quaternion",i,l)}(t.modelName,t.R.curves,t.initialRotation,t.preRotations);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var i=Cd(t.modelName,t.S.curves,t.initialScale,"scale");void 0!==i&&e.push(i)}return e}(t))}),new gc(t.name,-1,e)}function Cd(t,e,r,n){var i=Od(e);return new uc(t+"."+n,i,Pd(i,e,r))}function Pd(t,e,r){var n=r,i=[],o=-1,s=-1,a=-1;return t.forEach(function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(s=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==o){var r=e.x.values[o];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==s){var l=e.y.values[s];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==a){var c=e.z.values[a];i.push(c),n[2]=c}else i.push(n[2])}),i}function Od(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e.sort(function(t,e){return t-e}).filter(function(t,e,r){return r.indexOf(t)==e})}function Nd(){}function Ld(){}function Id(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function Rd(){}function Dd(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function Fd(t){return t/46186158e3}function kd(t){return t.split(",").map(function(t){return parseFloat(t)})}function Ud(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.byteLength),tu.decodeText(new Uint8Array(t,e,r))}function Bd(t,e,r,n){for(var i=r,o=0;i<n;i++,o++)t[o]=e[i];return t}Object.assign(Nd.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new Rd,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,r=t.split("\n");return r.forEach(function(t,n){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var s=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");s?e.parseNodeBegin(t,s):a?e.parseNodeProperty(t,a,r[++n]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}}),this.allNodes},parseNodeBegin:function(t,e){var r=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map(function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},o=this.parseNodeAttr(n),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in s?("PoseNode"===r?s.PoseNode.push(i):void 0!==s[r].id&&(s[r]={},s[r][s[r].id]=s[r]),""!==o.id&&(s[r][o.id]=i)):"number"==typeof o.id?(s[r]={},s[r][o.id]=i):"Properties70"!==r&&(s[r]="PoseNode"===r?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var r="",n="";return t.length>1&&(r=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:r,type:n}},parseNodeProperty:function(t,e,r){var n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var s=i.split(",").slice(1),a=parseInt(s[0]),l=parseInt(s[1]),c=i.split(",").slice(3);n="connections",function(t,e){for(var r=0,n=t.length,i=e.length;r<i;r++,n++)t[n]=e[r]}(i=[a,l],c=c.map(function(t){return t.trim().replace(/^"/,"")})),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=kd(i))}else this.parseNodeSpecialProperty(t,n,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=kd(e.a))},parseNodeSpecialProperty:function(t,e,r){var n=r.split('",').map(function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],o=n[1],s=n[2],a=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=kd(l)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),i)}}),Object.assign(Ld.prototype,{parse:function(t){var e=new Id(t);e.skip(23);var r=e.getUint32();console.log("FBXLoader: FBX binary version: "+r);for(var n=new Rd;!this.endOfContent(e);){var i=this.parseNode(e,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var r={},n=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32(),o=(e>=7500?t.getUint64():t.getUint32(),t.getUint8()),s=t.getString(o);if(0===n)return null;for(var a=[],l=0;l<i;l++)a.push(this.parseProperty(t));var c=a.length>0?a[0]:"",u=a.length>1?a[1]:"",h=a.length>2?a[2]:"";for(r.singleProperty=1===i&&t.getOffset()===n;n>t.getOffset();){var d=this.parseNode(t,e);null!==d&&this.parseSubNode(s,r,d)}return r.propertyList=a,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==s&&(r.name=s),r},parseSubNode:function(t,e,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(e[r.name]=r,r.a=n):e[r.name]=n}else if("Connections"===t&&"C"===r.name){var i=[];r.propertyList.forEach(function(t,e){0!==e&&i.push(t)}),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===r.name)Object.keys(r).forEach(function(t){e[t]=r[t]});else if("Properties70"===t&&"P"===r.name){var o,s=r.propertyList[0],a=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),o="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],e[s]={type:a,type2:l,flag:c,value:o}}else void 0===e[r.name]?"number"==typeof r.id?(e[r.name]={},e[r.name][r.id]=r):e[r.name]=r:"PoseNode"===r.name?(Array.isArray(e[r.name])||(e[r.name]=[e[r.name]]),e[r.name].push(r)):void 0===e[r.name][r.id]&&(e[r.name][r.id]=r)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var r=t.getUint32();return t.getArrayBuffer(r);case"S":return r=t.getUint32(),t.getString(r);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=t.getUint32(),i=t.getUint32(),o=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}void 0===window.Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new Id(new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(o))).decompress().buffer);switch(e){case"b":case"c":return s.getBooleanArray(n);case"d":return s.getFloat64Array(n);case"f":return s.getFloat32Array(n);case"i":return s.getInt32Array(n);case"l":return s.getInt64Array(n)}default:throw new Error("FBXLoader: Unknown property type "+e)}}}),Object.assign(Id.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295==(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.getUint8();var n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),tu.decodeText(e)}}),Object.assign(Rd.prototype,{add:function(t,e){this[t]=e}});var jd=function(t){this.manager=void 0!==t?t:Dc,this.splitLayer=!1};function zd(t,e,r,n,i,o,s,a,l,c){Mc.call(this,t=void 0!==t?t:[],e=void 0!==e?e:fl,r,n,i,o,s,a,l,c),this.flipY=!1}jd.prototype.load=function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(t))},r,n)},jd.prototype.parse=function(t){var e={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new Vl({color:16711680});i.name="path";var o=new Vl({color:65280});function s(t){r.push(n={vertex:[],pathVertex:[],z:t.z})}function a(t,e){void 0===n&&s(t),m.extruding?(n.vertex.push(t.x,t.y,t.z),n.vertex.push(e.x,e.y,e.z)):(n.pathVertex.push(t.x,t.y,t.z),n.pathVertex.push(e.x,e.y,e.z))}function l(t,r){return e.relative?r:r-t}function c(t,r){return e.relative?t+r:r}o.name="extruded";for(var u=t.replace(/;.+/g,"").split("\n"),h=0;h<u.length;h++){var d=u[h].split(" "),p=d[0].toUpperCase(),f={};if(d.splice(1).forEach(function(t){if(void 0!==t[0]){var e=t[0].toLowerCase(),r=parseFloat(t.substring(1));f[e]=r}}),"G0"===p||"G1"===p){var m={x:void 0!==f.x?c(e.x,f.x):e.x,y:void 0!==f.y?c(e.y,f.y):e.y,z:void 0!==f.z?c(e.z,f.z):e.z,e:void 0!==f.e?c(e.e,f.e):e.e,f:void 0!==f.f?c(e.f,f.f):e.f};l(e.e,m.e)>0&&(m.extruding=l(e.e,m.e)>0,void 0!=n&&m.z==n.z||s(m)),a(e,m),e=m}else"G2"===p||"G3"===p?console.warn("GCodeLoader: Arc command not supported"):"G90"===p?e.relative=!1:"G91"===p?e.relative=!0:"G92"===p?((m=e).x=void 0!==f.x?f.x:m.x,m.y=void 0!==f.y?f.y:m.y,m.z=void 0!==f.z?f.z:m.z,m.e=void 0!==f.e?f.e:m.e,e=m):console.warn("GCodeLoader: Command not supported:"+p)}function v(t,e){var r=new $a;r.addAttribute("position",new Za(t,3));var n=new nd(r,e?o:i);n.name="layer"+h,g.add(n)}var g=new Fh;if(g.name="gcode",this.splitLayer)for(h=0;h<r.length;h++)v((b=r[h]).vertex,!0),v(b.pathVertex,!1);else{var y=[],x=[];for(h=0;h<r.length;h++){var b;y=y.concat((b=r[h]).vertex),x=x.concat(b.pathVertex)}v(y,!0),v(x,!1)}return g.quaternion.setFromEuler(new Ea(-Math.PI/2,0,0)),g},function(){function t(t){this.manager=void 0!==t?t:Dc,this.dracoLoader=null}t.prototype={constructor:t,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this,o=void 0!==this.path?this.path:tu.extractUrlBase(t),s=new kc(i.manager);s.setResponseType("arraybuffer"),s.load(t,function(t){try{i.parse(t,o,e,n)}catch(t){if(void 0===n)throw t;n(t)}},r,n)},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setDRACOLoader:function(t){return this.dracoLoader=t,this},parse:function(t,a,l,c){var u,h={};if("string"==typeof t)u=t;else if(tu.decodeText(new Uint8Array(t,0,4))===n){try{h[e.KHR_BINARY_GLTF]=new function(t){this.name=e.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(t,0,i);if(this.header={magic:tu.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==n)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var s=new DataView(t,i),a=0;a<s.byteLength;){var l=s.getUint32(a,!0),c=s.getUint32(a+=4,!0);if(a+=4,c===o.JSON){var u=new Uint8Array(t,i+a,l);this.content=tu.decodeText(u)}else if(c===o.BIN){var h=i+a;this.body=t.slice(h,h+l)}a+=l}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}(t)}catch(t){return void(c&&c(t))}u=h[e.KHR_BINARY_GLTF].content}else u=tu.decodeText(new Uint8Array(t));var d=JSON.parse(u);void 0===d.asset||d.asset.version[0]<2?c&&c(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(d.extensionsUsed&&(d.extensionsUsed.indexOf(e.KHR_LIGHTS)>=0&&(h[e.KHR_LIGHTS]=new function(t){this.name=e.KHR_LIGHTS,this.lights={};var r=(t.extensions&&t.extensions[e.KHR_LIGHTS]||{}).lights||{};for(var n in r){var i,o=r[n],s=(new Ia).fromArray(o.color);switch(o.type){case"directional":(i=new Jh(s)).position.set(0,0,1);break;case"point":i=new Yh(s);break;case"spot":(i=new Kh(s)).position.set(0,0,1);break;case"ambient":i=new rd(s)}i&&(void 0!==o.constantAttenuation&&(i.intensity=o.constantAttenuation),void 0!==o.linearAttenuation&&(i.distance=1/o.linearAttenuation),void 0!==o.quadraticAttenuation&&(i.decay=o.quadraticAttenuation),void 0!==o.fallOffAngle&&(i.angle=o.fallOffAngle),void 0!==o.fallOffExponent&&console.warn("GLTFLoader:: light.fallOffExponent not currently supported."),i.name=o.name||"light_"+n,this.lights[n]=i)}}(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_UNLIT)>=0&&(h[e.KHR_MATERIALS_UNLIT]=new r(d)),d.extensionsUsed.indexOf(e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(h[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new function(){return{name:e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return Cc},extendParams:function(t,e,r){var n=e.extensions[this.name],i=ih.standard,o=Ec.clone(i.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new Ia).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=i.vertexShader,t.fragmentShader=h,t.uniforms=o,t.defines={STANDARD:""},t.color=new Ia(1,1,1),t.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;t.color.fromArray(p),t.opacity=p[3]}if(void 0!==n.diffuseTexture&&d.push(r.assignTexture(t,"map",n.diffuseTexture.index)),t.emissive=new Ia(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new Ia(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var f=n.specularGlossinessTexture.index;d.push(r.assignTexture(t,"glossinessMap",f)),d.push(r.assignTexture(t,"specularMap",f))}return Promise.all(d)},createMaterial:function(t){var e=new Cc({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return e.isGLTFSpecularGlossinessMaterial=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e.extensions.derivatives=!0,e},cloneMaterial:function(t){var e=t.clone();e.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++)e[r[n]]=t[r[n]];return e},refreshUniforms:function(t,e,r,n,i,o){if(!0===i.isGLTFSpecularGlossinessMaterial){var s,a,l,c=i.uniforms,u=i.defines;if(c.opacity.value=i.opacity,c.diffuse.value.copy(i.color),c.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),c.map.value=i.map,c.specularMap.value=i.specularMap,c.alphaMap.value=i.alphaMap,c.lightMap.value=i.lightMap,c.lightMapIntensity.value=i.lightMapIntensity,c.aoMap.value=i.aoMap,c.aoMapIntensity.value=i.aoMapIntensity,i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.glossinessMap?s=i.glossinessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap&&(s=i.emissiveMap),void 0!==s)if(s.isWebGLRenderTarget&&(s=s.texture),void 0!==s.matrix){if(!0===s.matrixAutoUpdate){var h=s.center;s.matrix.setUvTransform((a=s.offset).x,a.y,(l=s.repeat).x,l.y,s.rotation,h.x,h.y)}c.uvTransform.value.copy(s.matrix)}else c.offsetRepeat.value.set((a=s.offset).x,a.y,(l=s.repeat).x,l.y);c.envMap.value=i.envMap,c.envMapIntensity.value=i.envMapIntensity,c.flipEnvMap.value=i.envMap&&i.envMap.isCubeTexture?-1:1,c.refractionRatio.value=i.refractionRatio,c.specular.value.copy(i.specular),c.glossiness.value=i.glossiness,c.glossinessMap.value=i.glossinessMap,c.emissiveMap.value=i.emissiveMap,c.bumpMap.value=i.bumpMap,c.normalMap.value=i.normalMap,c.displacementMap.value=i.displacementMap,c.displacementScale.value=i.displacementScale,c.displacementBias.value=i.displacementBias,null!==c.glossinessMap.value&&void 0===u.USE_GLOSSINESSMAP&&(u.USE_GLOSSINESSMAP="",u.USE_ROUGHNESSMAP=""),null===c.glossinessMap.value&&void 0!==u.USE_GLOSSINESSMAP&&(delete u.USE_GLOSSINESSMAP,delete u.USE_ROUGHNESSMAP)}}}}),d.extensionsUsed.indexOf(e.KHR_DRACO_MESH_COMPRESSION)>=0&&(h[e.KHR_DRACO_MESH_COMPRESSION]=new s(this.dracoLoader))),console.time("GLTFLoader"),new _(d,h,{path:a||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(t,e,r,n,i){console.timeEnd("GLTFLoader"),l({scene:t,scenes:e,cameras:r,animations:n,asset:i})},c))}};var e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit"};function r(t){this.name=e.KHR_MATERIALS_UNLIT}r.prototype.getMaterialType=function(t){return zl},r.prototype.extendParams=function(t,e,r){var n=[];t.color=new Ia(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(t,"map",i.baseColorTexture.index))}return Promise.all(n)};var n="glTF",i=12,o={JSON:1313821514,BIN:5130562};function s(t){if(!t)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=e.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=t}function a(t,e,r,n){sc.call(this,t,e,r,n)}s.prototype.decodePrimitive=function(t,e){var r=this.dracoLoader,n=t.extensions[this.name].bufferView,i=t.extensions[this.name].attributes,o={};for(var s in i)s in f&&(o[f[s]]=i[s]);return e.getDependency("bufferView",n).then(function(t){return new Promise(function(e){r.decodeDracoFile(t,e,o)})})},(a.prototype=Object.create(sc.prototype)).constructor=a,a.prototype.interpolate_=function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,c=n-e,u=(r-e)/c,h=u*u,d=h*u,p=t*l,f=p-l,m=2*d-3*h+1,v=d-2*h+u,g=-2*d+3*h,y=d-h,x=0;x!==s;x++)i[x]=m*o[f+x+s]+v*(o[f+x+a]*c)+g*o[p+x+s]+y*(o[p+x]*c);return i};var l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:bl,9729:wl,9984:1004,9985:1007,9986:1005,9987:_l},u={33071:yl,33648:xl,10497:gl},h={6406:1021,6407:Al,6408:El,6409:1024,6410:1025},d={5121:Sl,32819:1017,32820:1018,33635:1019},p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},m={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},v={CUBICSPLINE:2302,LINEAR:2301,STEP:Ll};function g(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t}function y(t,e,r,n){var i=t.geometry,o=t.material,s=r.targets,a=i.morphAttributes;a.position=[],a.normal=[],o.morphTargets=!0;for(var l=0,c=s.length;l<c;l++){var u,h,d=s[l],p="morphTarget"+l;if(void 0!==d.POSITION){u=w(n[d.POSITION]);for(var f=i.attributes.position,m=0,v=u.count;m<v;m++)u.setXYZ(m,u.getX(m)+f.getX(m),u.getY(m)+f.getY(m),u.getZ(m)+f.getZ(m))}else i.attributes.position&&(u=w(i.attributes.position));if(void 0!==u&&(u.name=p,a.position.push(u)),void 0!==d.NORMAL){o.morphNormals=!0,h=w(n[d.NORMAL]);var g=i.attributes.normal;for(m=0,v=h.count;m<v;m++)h.setXYZ(m,h.getX(m)+g.getX(m),h.getY(m)+g.getY(m),h.getZ(m)+g.getZ(m))}else void 0!==i.attributes.normal&&(h=w(i.attributes.normal));void 0!==h&&(h.name=p,a.normal.push(h))}if(t.updateMorphTargets(),void 0!==e.weights)for(l=0,c=e.weights.length;l<c;l++)t.morphTargetInfluences[l]=e.weights[l];if(e.extras&&Array.isArray(e.extras.targetNames))for(l=0,c=e.extras.targetNames.length;l<c;l++)t.morphTargetDictionary[e.extras.targetNames[l]]=l}function x(t,e){if(t.indices!==e.indices)return!1;var r=t.attributes||{},n=e.attributes||{},i=Object.keys(r),o=Object.keys(n);if(i.length!==o.length)return!1;for(var s=0,a=i.length;s<a;s++){var l=i[s];if(r[l]!==n[l])return!1}return!0}function b(t,e){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(x(i.primitive,e))return i.promise}return null}function w(t){if(t.isInterleavedBufferAttribute){for(var e=t.count,r=t.itemSize,n=t.array.slice(0,e*r),i=0;i<e;++i)n[i]=t.getX(i),r>=2&&(n[i+1]=t.getY(i)),r>=3&&(n[i+2]=t.getZ(i)),r>=4&&(n[i+3]=t.getW(i));return new za(n,r,t.normalized)}return t.clone()}function _(t,e,r){this.json=t||{},this.extensions=e||{},this.options=r||{},this.cache=new function(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}},this.primitiveCache=[],this.textureLoader=new Kc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new kc(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function S(t,e,r){var n=e.attributes;for(var i in n){var o=f[i];o&&(o in t.attributes||t.addAttribute(o,r[n[i]]))}void 0===e.indices||t.index||t.setIndex(r[e.indices])}_.prototype.parse=function(t,e){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var n=e.scenes||[];t(n[r.scene||0],n,e.cameras||[],e.animations||[],r.asset)}).catch(e)},_.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[],n={},i={},o=0,s=e.length;o<s;o++)for(var a=e[o].joints,l=0,c=a.length;l<c;l++)t[a[l]].isBone=!0;for(var u=0,h=t.length;u<h;u++){var d=t[u];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},_.prototype.getDependency=function(t,e){var r=t+":"+e,n=this.cache.get(r);return n||(n=this["load"+t.charAt(0).toUpperCase()+t.slice(1)](e),this.cache.add(r,n)),n},_.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var r=this;e=Promise.all((this.json[t+("mesh"===t?"es":"s")]||[]).map(function(e,n){return r.getDependency(t,n)})),this.cache.add(t,e)}return e},_.prototype.getMultiDependencies=function(t){for(var e={},r=[],n=0,i=t.length;n<i;n++){var o=t[n],s=this.getDependencies(o);s=s.then((function(t,r){e[t]=r}).bind(this,o+("mesh"===o?"es":"s"))),r.push(s)}return Promise.all(r).then(function(){return e})},_.prototype.loadBuffer=function(t){var r=this.json.buffers[t],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===t)return Promise.resolve(this.extensions[e.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(t,e){n.load(g(r.uri,i.path),t,void 0,function(){e(new Error('GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},_.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){var r=e.byteOffset||0;return t.slice(r,r+(e.byteLength||0))})},_.prototype.loadAccessor=function(t){var e=this,r=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return null;var i=[];return i.push(void 0!==n.bufferView?this.getDependency("bufferView",n.bufferView):null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(t){var i,o=t[0],s=p[n.type],a=l[n.componentType],c=a.BYTES_PER_ELEMENT,u=n.byteOffset||0,h=r.bufferViews[n.bufferView].byteStride,d=!0===n.normalized;if(h&&h!==c*s){var f="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=e.cache.get(f);m||(m=new Mh(new a(o),h/c),e.cache.add(f,m)),i=new Eh(m,s,u/c,d)}else i=new za(null===o?new a(n.count*s):new a(o,u,n.count*s),s,d);if(void 0!==n.sparse){var v=n.sparse.values.byteOffset||0,g=new(0,l[n.sparse.indices.componentType])(t[1],n.sparse.indices.byteOffset||0,n.sparse.count*p.SCALAR),y=new a(t[2],v,n.sparse.count*s);null!==o&&i.setArray(i.array.slice());for(var x=0,b=g.length;x<b;x++){var w=g[x];if(i.setX(w,y[x*s]),s>=2&&i.setY(w,y[x*s+1]),s>=3&&i.setZ(w,y[x*s+2]),s>=4&&i.setW(w,y[x*s+3]),s>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},_.prototype.loadTexture=function(t){var e=this.json,r=this.options,n=this.textureLoader,i=window.URL||window.webkitURL,o=e.textures[t],s=e.images[o.source],a=s.uri,l=!1;return void 0!==s.bufferView&&(a=this.getDependency("bufferView",s.bufferView).then(function(t){l=!0;var e=new Blob([t],{type:s.mimeType});return a=i.createObjectURL(e)})),Promise.resolve(a).then(function(t){var e=$c.Handlers.get(t)||n;return new Promise(function(n,i){e.load(g(t,r.path),n,void 0,i)})}).then(function(t){!0===l&&i.revokeObjectURL(a),t.flipY=!1,void 0!==o.name&&(t.name=o.name),t.format=void 0!==o.format?h[o.format]:El,void 0!==o.internalFormat&&t.format!==h[o.internalFormat]&&console.warn("GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==o.type?d[o.type]:Sl;var r=(e.samplers||{})[o.sampler]||{};return t.magFilter=c[r.magFilter]||wl,t.minFilter=c[r.minFilter]||_l,t.wrapS=u[r.wrapS]||gl,t.wrapT=u[r.wrapT]||gl,t})},_.prototype.assignTexture=function(t,e,r){return this.getDependency("texture",r).then(function(r){t[e]=r})},_.prototype.loadMaterial=function(t){var r,n=this.extensions,i=this.json.materials[t],o={},s=i.extensions||{},a=[];if(s[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=l.getMaterialType(i),a.push(l.extendParams(o,i,this))}else if(s[e.KHR_MATERIALS_UNLIT]){var c=n[e.KHR_MATERIALS_UNLIT];r=c.getMaterialType(i),a.push(c.extendParams(o,i,this))}else if(void 0!==i.pbrMetallicRoughness){r=Gc;var u=i.pbrMetallicRoughness;if(o.color=new Ia(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var h=u.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}if(void 0!==u.baseColorTexture&&a.push(this.assignTexture(o,"map",u.baseColorTexture.index)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture){var d=u.metallicRoughnessTexture.index;a.push(this.assignTexture(o,"metalnessMap",d)),a.push(this.assignTexture(o,"roughnessMap",d))}}else r=Vc;!0===i.doubleSided&&(o.side=il);var p=i.alphaMode||"OPAQUE";return"BLEND"===p?o.transparent=!0:(o.transparent=!1,"MASK"===p&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&r!==zl&&(a.push(this.assignTexture(o,"normalMap",i.normalTexture.index)),o.normalScale=new ka(1,1),void 0!==i.normalTexture.scale&&o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&r!==zl&&(a.push(this.assignTexture(o,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&r!==zl&&(o.emissive=(new Ia).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&r!==zl&&a.push(this.assignTexture(o,"emissiveMap",i.emissiveTexture.index)),Promise.all(a).then(function(){var t;return t=r===Cc?n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),void 0!==i.name&&(t.name=i.name),t.normalScale&&(t.normalScale.x=-t.normalScale.x),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),i.extras&&(t.userData=i.extras),t})},_.prototype.loadGeometries=function(t){var r=this,n=this.extensions,i=this.primitiveCache;return this.getDependencies("accessor").then(function(o){for(var s=[],a=[],l=0,c=t.length;l<c;l++){var u,h=t[l],d=b(i,h);if(d)a.push(d.then(function(t){s.push(t)}));else if(h.extensions&&h.extensions[e.KHR_DRACO_MESH_COMPRESSION]){var p=n[e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,r).then(function(t){return S(t,h,o),s.push(t),t});i.push({primitive:h,promise:p}),a.push(p)}else S(u=new $a,h,o),i.push({primitive:h,promise:Promise.resolve(u)}),s.push(u)}return Promise.all(a).then(function(){return s})})},_.prototype.loadMesh=function(t){var r=this,n=this.extensions,i=this.json.meshes[t];return this.getMultiDependencies(["accessor","material"]).then(function(o){var s=new Fh,a=i.primitives;return r.loadGeometries(a).then(function(l){for(var c=0,u=a.length;c<u;c++){var h=a[c],d=l[c],p=void 0===h.material?new Gc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:rl}):o.materials[h.material];p.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&(console.log("GLTFLoader: Duplicating UVs to support aoMap."),d.addAttribute("uv2",new za(d.attributes.uv.array,2)));var f,m=void 0!==d.attributes.color,v=void 0===d.attributes.normal,g=!0===i.isSkinnedMesh,x=void 0!==h.targets;if((m||v||g||x)&&(p=p.isGLTFSpecularGlossinessMaterial?n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(p):p.clone()),m&&(p.vertexColors=al,p.needsUpdate=!0),v&&(p.flatShading=!0),4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)g?(f=new zh(d,p),p.skinning=!0):f=new ql(d,p),5===h.mode?f.drawMode=Dl:6===h.mode&&(f.drawMode=Fl);else if(1===h.mode||3===h.mode||2===h.mode){var b=r.cache.get(w="LineBasicMaterial:"+p.uuid);b||(b=new Vl,jl.prototype.copy.call(b,p),b.color.copy(p.color),b.lights=!1,r.cache.add(w,b)),p=b,f=1===h.mode?new nd(d,p):3===h.mode?new Yl(d,p):new ld(d,p)}else{if(0!==h.mode)throw new Error("GLTFLoader: Primitive mode unsupported: "+h.mode);var w,_=r.cache.get(w="PointsMaterial:"+p.uuid);_||(_=new Xc,jl.prototype.copy.call(_,p),_.color.copy(p.color),_.map=p.map,_.lights=!1,r.cache.add(w,_)),f=new bh(d,p=_)}if(f.name=i.name||"mesh_"+t,x&&y(f,i,h,o.accessors),void 0!==i.extras&&(f.userData=i.extras),void 0!==h.extras&&(f.geometry.userData=h.extras),!0===p.isGLTFSpecularGlossinessMaterial&&(f.onBeforeRender=n[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(a.length>1))return f;f.name+="_"+c,s.add(f)}return s})})},_.prototype.loadCamera=function(t){var e,r=this.json.cameras[t],n=r[r.type];if(n){if("perspective"===r.type){var i=n.aspectRatio||1;e=new bc(_a.radToDeg(n.yfov*i),i,n.znear||1,n.zfar||2e6)}else"orthographic"===r.type&&(e=new Sc(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar));return void 0!==r.name&&(e.name=r.name),r.extras&&(e.userData=r.extras),Promise.resolve(e)}console.warn("GLTFLoader: Missing camera parameters.")},_.prototype.loadSkin=function(t){var e=this.json.skins[t],r={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return r.inverseBindMatrices=t,r})},_.prototype.loadAnimation=function(t){var e=this.json.animations[t];return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var n=[],i=0,o=e.channels.length;i<o;i++){var s=e.channels[i],l=e.samplers[s.sampler];if(l){var c=s.target,u=void 0!==c.node?c.node:c.id,h=r.accessors[void 0!==e.parameters?e.parameters[l.input]:l.input],d=r.accessors[void 0!==e.parameters?e.parameters[l.output]:l.output],p=r.nodes[u];if(p){var f;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,m[c.path]){case m.weights:f=vc;break;case m.rotation:f=lc;break;case m.position:case m.scale:default:f=uc}var g=p.name?p.name:p.uuid,y=void 0!==l.interpolation?v[l.interpolation]:2301,x=[];m[c.path]===m.weights?p.traverse(function(t){!0===t.isMesh&&!0===t.material.morphTargets&&x.push(t.name?t.name:t.uuid)}):x.push(g);for(var b=0,w=x.length;b<w;b++){var _=new f(x[b]+"."+m[c.path],fc.arraySlice(h.array,0),fc.arraySlice(d.array,0),y);"CUBICSPLINE"===l.interpolation&&(_.createInterpolant=function(t){return new a(this.times,this.values,this.getValueSize()/3,t)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),n.push(_)}}}}return new gc(u=void 0!==e.name?e.name:"animation_"+t,void 0,n)})},_.prototype.loadNode=function(t){var r=this.extensions,n=this.json.meshReferences,i=this.json.meshUses,o=this.json.nodes[t];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(t){var s;if(!0===o.isBone)s=new Ql;else if(void 0!==o.mesh){var a=t.meshes[o.mesh];if(s=a.clone(),!0===a.isGroup)for(var l=0,c=a.children.length;l<c;l++){var u=a.children[l];u.material&&!0===u.material.isGLTFSpecularGlossinessMaterial&&(s.children[l].onBeforeRender=u.onBeforeRender)}else a.material&&!0===a.material.isGLTFSpecularGlossinessMaterial&&(s.onBeforeRender=a.onBeforeRender);n[o.mesh]>1&&(s.name+="_instance_"+i[o.mesh]++)}else s=void 0!==o.camera?t.cameras[o.camera]:o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light?r[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]:new Na;if(void 0!==o.name&&(s.name=sh.sanitizeNodeName(o.name)),o.extras&&(s.userData=o.extras),void 0!==o.matrix){var h=new Sa;h.fromArray(o.matrix),s.applyMatrix(h)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return s})},_.prototype.loadScene=function(){function t(e,r,n,i,o){var s=i[e],a=n.nodes[e];if(void 0!==a.skin)for(var l=!0===s.isGroup?s.children:[s],c=0,u=l.length;c<u;c++){for(var h=l[c],d=o[a.skin],p=[],f=[],m=0,v=d.joints.length;m<v;m++){var g=d.joints[m],y=i[g];if(y){p.push(y);var x=new Sa;void 0!==d.inverseBindMatrices&&x.fromArray(d.inverseBindMatrices.array,16*m),f.push(x)}else console.warn('GLTFLoader: Joint "%s" could not be found.',g)}h.bind(new jh(p,f),h.matrixWorld)}if(r.add(s),a.children){var b=a.children;for(c=0,u=b.length;c<u;c++)t(b[c],s,n,i,o)}}return function(r){var n=this.json,i=this.extensions,o=this.json.scenes[r];return this.getMultiDependencies(["node","skin"]).then(function(r){var s=new _c;void 0!==o.name&&(s.name=o.name),o.extras&&(s.userData=o.extras);for(var a=o.nodes||[],l=0,c=a.length;l<c;l++)t(a[l],s,n,r.nodes,r.skins);return o.extensions&&o.extensions[e.KHR_LIGHTS]&&void 0!==o.extensions[e.KHR_LIGHTS].light&&s.add(i[e.KHR_LIGHTS].lights[o.extensions[e.KHR_LIGHTS].light]),s})}}()}(),((function(t){this.manager=void 0!==t?t:Dc}).prototype=Object.create(ud.prototype))._parser=function(t){var e=function(t,e){switch(t){case 1:console.error("RGBELoader Read Error: "+(e||""));break;case 2:console.error("RGBELoader Write Error: "+(e||""));break;case 3:console.error("RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("RGBELoader: Error: "+(e||""))}return-1},r=function(t,e,r){e=e||1024;for(var n=t.pos,i=-1,o=0,s="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));0>(i=a.indexOf("\n"))&&o<e&&n<t.byteLength;)s+=a,o+=a.length,n+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<i&&(!1!==r&&(t.pos+=o+i+1),s+a.slice(0,i))},n=new Uint8Array(t);n.pos=0;var i=function(t){var n,i,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(n=r(t)))return e(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(c.valid|=1,c.programtype=i[1],c.string+=n+"\n";!1!==(n=r(t));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(o))&&(c.gamma=parseFloat(i[1],10)),(i=n.match(s))&&(c.exposure=parseFloat(i[1],10)),(i=n.match(a))&&(c.valid|=2,c.format=i[1]),(i=n.match(l))&&(c.valid|=4,c.height=parseInt(i[1],10),c.width=parseInt(i[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:e(3,"missing image size specifier"):e(3,"missing format specifier")}(n);if(-1!==i){var o=i.width,s=i.height,a=function(t,r,n){var i,o,s,a,l,c,u,h,d,p,f,m,v,g=r,y=n;if(g<8||g>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(g!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return e(4,"unable to allocate buffer space");for(o=0,s=0,h=4*g,v=new Uint8Array(4),c=new Uint8Array(h);y>0&&s<t.byteLength;){if(s+4>t.byteLength)return e(1);if(v[0]=t[s++],v[1]=t[s++],v[2]=t[s++],v[3]=t[s++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return e(3,"bad rgbe scanline format");for(u=0;u<h&&s<t.byteLength;){if((m=(a=t[s++])>128)&&(a-=128),0===a||u+a>h)return e(3,"bad scanline data");if(m)for(l=t[s++],d=0;d<a;d++)c[u++]=l;else c.set(t.subarray(s,s+a),u),u+=a,s+=a}for(p=g,d=0;d<p;d++)i[o]=c[d+(f=0)],i[o+1]=c[d+(f+=g)],i[o+2]=c[d+(f+=g)],i[o+3]=c[d+(f+=g)],o+=4;y--}return i}(n.subarray(n.pos),o,s);if(-1!==a)return{width:o,height:s,data:a,header:i.string,gamma:i.gamma,exposure:i.exposure,format:Cl,type:Sl}}return null},(zd.prototype=Object.create(Mc.prototype)).constructor=zd,zd.prototype.isCubeTexture=!0,Object.defineProperty(zd.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var Vd=function(t){this.manager=void 0!==t?t:Dc};Vd.prototype={constructor:Vd,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){var e=new JSZip(t);function r(t){var r=decodeURI(t.init_from);r=r.replace("../","");var n=new RegExp(r+"$"),i=e.file(n);if(i.length){var o=new Blob([i[0].asArrayBuffer()],{type:"application/octet-binary"});t.build.src=URL.createObjectURL(o)}}var n=e.file(/dae$/i);if(n.length){var i=n[0],o=(new id).parse(i.asText()),s=o.library.images;for(var a in s)r(s[a]);return o}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Fh}}};var Gd=function(){this._parser=Gd.parse};Gd.prototype=Object.create(sd.prototype),Gd.prototype.constructor=Gd,Gd.parse=function(t,e){var r=new Hd(t,1);return{mipmaps:r.mipmaps(e),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}};var Hd=function(){function t(e,r,n,i){this.arrayBuffer=e;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[0]&&75===o[1]&&84===o[2]&&88===o[3]&&32===o[4]&&49===o[5]&&49===o[6]&&187===o[7]&&13===o[8]&&10===o[9]&&26===o[10]&&10===o[11]){var s=new Int32Array(this.arrayBuffer,12,13),a=16909060===s[0];this.glType=a?this.switchEndainness(s[1]):s[1],this.glTypeSize=a?this.switchEndainness(s[2]):s[2],this.glFormat=a?this.switchEndainness(s[3]):s[3],this.glInternalFormat=a?this.switchEndainness(s[4]):s[4],this.glBaseInternalFormat=a?this.switchEndainness(s[5]):s[5],this.pixelWidth=a?this.switchEndainness(s[6]):s[6],this.pixelHeight=a?this.switchEndainness(s[7]):s[7],this.pixelDepth=a?this.switchEndainness(s[8]):s[8],this.numberOfArrayElements=a?this.switchEndainness(s[9]):s[9],this.numberOfFaces=a?this.switchEndainness(s[10]):s[10],this.numberOfMipmapLevels=a?this.switchEndainness(s[11]):s[11],this.bytesOfKeyValueData=a?this.switchEndainness(s[12]):s[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===r?this.loadType=t.COMPRESSED_2D:console.warn("number of faces expected"+r+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return t.prototype.switchEndainness=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255},t.prototype.mipmaps=function(e){for(var r=[],n=t.HEADER_LEN+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight,s=e?this.numberOfMipmapLevels:1,a=0;a<s;a++){for(var l=new Int32Array(this.arrayBuffer,n,1)[0],c=0;c<this.numberOfFaces;c++){var u=new Uint8Array(this.arrayBuffer,n+4,l);r.push({data:u,width:i,height:o}),n+=l+4,n+=3-(l+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return r},t.HEADER_LEN=64,t.COMPRESSED_2D=0,t.COMPRESSED_3D=1,t.TEX_2D=2,t.TEX_3D=3,t}(),Wd={Validator:{isValid:function(t){return null!==t&&void 0!==t},verifyInput:function(t,e){return null===t||void 0===t?e:t}}};Wd.Callbacks=function(){var t=Wd.Validator;function e(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return e.prototype.setCallbackOnProgress=function(e){this.onProgress=t.verifyInput(e,this.onProgress)},e.prototype.setCallbackOnMeshAlter=function(e){this.onMeshAlter=t.verifyInput(e,this.onMeshAlter)},e.prototype.setCallbackOnLoad=function(e){this.onLoad=t.verifyInput(e,this.onLoad)},e.prototype.setCallbackOnLoadMaterials=function(e){this.onLoadMaterials=t.verifyInput(e,this.onLoadMaterials)},e}(),Wd.LoadedMeshUserOverride=function(){function t(t,e){this.disregardMesh=!0===t,this.alteredMesh=!0===e,this.meshes=[]}return t.prototype.addMesh=function(t){this.meshes.push(t),this.alteredMesh=!0},t.prototype.isDisregardMesh=function(){return this.disregardMesh},t.prototype.providesAlteredMeshes=function(){return this.alteredMesh},t}(),Wd.ResourceDescriptor=function(){var t=Wd.Validator;function e(e,r){var n=e.split("/");n.length<2?(this.path=null,this.name=e,this.url=e):(this.path=t.verifyInput(n.slice(0,n.length-1).join("/")+"/",null),this.name=t.verifyInput(n[n.length-1],null),this.url=e),this.extension=t.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}return e.prototype.setContent=function(e){this.content=t.verifyInput(e,null)},e}(),Wd.PrepData=function(){var t=Wd.Validator;function e(e){this.logging={enabled:!0,debug:!1},this.modelName=t.verifyInput(e,""),this.resources=[],this.callbacks=new Wd.Callbacks}return e.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},e.prototype.getCallbacks=function(){return this.callbacks},e.prototype.addResource=function(t){this.resources.push(t)},e.prototype.clone=function(){var t,e,r=new Wd.PrepData(this.modelName);for(t in r.logging.enabled=this.logging.enabled,r.logging.debug=this.logging.debug,r.resources=this.resources,r.callbacks=this.callbacks,this)e=this[t],r.hasOwnProperty(t)||"function"==typeof this[t]||(r[t]=e);return r},e.prototype.checkResourceDescriptorFiles=function(e,r){var n,i,o,s,a={};for(var l in e)if(s=!1,t.isValid((n=e[l]).name))if(t.isValid(n.content)){for(o=0;o<r.length&&!s;o++)if(i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase())if(i.ignore)s=!0;else if("ArrayBuffer"===i.type){if(!(n.content instanceof ArrayBuffer||n.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[i.ext]=n,s=!0}else if("String"===i.type){if(!("string"==typeof n.content||n.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[i.ext]=n,s=!0}if(!s)throw'Unidentified resource "'+n.name+'": '+n.url}else{if(!("string"==typeof n.name||n.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(o=0;o<r.length&&!s;o++)i=r[o],n.extension.toLowerCase()===i.ext.toLowerCase()&&(i.ignore||(a[i.ext]=n),s=!0);if(!s)throw'Unidentified resource "'+n.name+'": '+n.url}return a},e}(),Wd.MeshBuilder=function(){var t="1.2.0",e=Wd.Validator;function r(){console.info("Using LoaderSupport.MeshBuilder version: "+t),this.logging={enabled:!0,debug:!1},this.callbacks=new Wd.Callbacks,this.materials=[]}return r.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},r.prototype.init=function(){var t=new Gc({color:14479871});t.name="defaultMaterial";var e=new Gc({color:14479871});e.name="defaultVertexColorMaterial",e.vertexColors=al;var r=new Vl;r.name="defaultLineMaterial";var n=new Xc({size:1});n.name="defaultPointMaterial";var i={};i[t.name]=t,i[e.name]=e,i[r.name]=r,i[n.name]=n,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:i}})},r.prototype.setMaterials=function(t){var r={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:e.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(t):t}};this.updateMaterials(r)},r.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials)},r.prototype.processPayload=function(t){return"meshData"===t.cmd?this.buildMeshes(t):"materialData"===t.cmd?(this.updateMaterials(t),null):void 0},r.prototype.buildMeshes=function(t){var r,n,i=t.params.meshName,o=new $a;o.addAttribute("position",new za(new Float32Array(t.buffers.vertices),3)),e.isValid(t.buffers.indices)&&o.setIndex(new za(new Uint32Array(t.buffers.indices),1)),e.isValid(t.buffers.colors)&&o.addAttribute("color",new za(new Float32Array(t.buffers.colors),3)),e.isValid(t.buffers.normals)?o.addAttribute("normal",new za(new Float32Array(t.buffers.normals),3)):o.computeVertexNormals(),e.isValid(t.buffers.uvs)&&o.addAttribute("uv",new za(new Float32Array(t.buffers.uvs),2));var s=t.materials.materialNames,a=t.materials.multiMaterial,l=[];for(n in s)r=this.materials[s[n]],a&&l.push(r);if(a){r=l;var c,u=t.materials.materialGroups;for(n in u)o.addGroup((c=u[n]).start,c.count,c.index)}var h,d,p,f=[],m=this.callbacks.onMeshAlter,v=!0,g=e.verifyInput(t.geometryType,0);if(e.isValid(m)&&(d=m({detail:{meshName:i,bufferGeometry:o,material:r,geometryType:g}}),e.isValid(d))){if(!d.isDisregardMesh()&&d.providesAlteredMeshes())for(var y in d.meshes)f.push(d.meshes[y]);v=!1}if(v&&(t.computeBoundingSphere&&o.computeBoundingSphere(),(h=0===g?new ql(o,r):1===g?new nd(o,r):new bh(o,r)).name=i,f.push(h)),e.isValid(f)&&f.length>0){var x=[];for(var y in f)x[y]=(h=f[y]).name;p="Adding mesh(es) ("+x.length+": "+x+") from input mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)"}else p="Not adding mesh: "+i,p+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)";var b=this.callbacks.onProgress;return e.isValid(b)&&b(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:t.params.meshName,text:p,numericalValue:t.progress.numericalValue}})),f},r.prototype.updateMaterials=function(t){var r,n,i=t.materials.materialCloneInstructions;if(e.isValid(i)){var o=i.materialNameOrg,s=this.materials[o];if(e.isValid(o)){(r=s.clone()).name=n=i.materialName;var a=i.materialProperties;for(var l in a)r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&(r[l]=a[l]);this.materials[n]=r}else console.warn('Requested material "'+o+'" is not available!')}var c=t.materials.serializedMaterials;if(e.isValid(c)&&Object.keys(c).length>0){var u,h=new Jc;for(n in c)e.isValid(u=c[n])&&(r=h.parse(u),this.logging.enabled&&console.info('De-serialized material with name "'+n+'" will be added.'),this.materials[n]=r)}if(e.isValid(c=t.materials.runtimeMaterials)&&Object.keys(c).length>0)for(n in c)r=c[n],this.logging.enabled&&console.info('Material with name "'+n+'" will be added.'),this.materials[n]=r},r.prototype.getMaterialsJSON=function(){var t={};for(var e in this.materials)t[e]=this.materials[e].toJSON();return t},r.prototype.getMaterials=function(){return this.materials},r}(),Wd.WorkerRunnerRefImpl=function(){function t(){var t=this;self.addEventListener("message",function(e){t.processMessage(e.data)},!1)}return t.prototype.applyProperties=function(t,e){var r,n,i;for(r in e)n="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),i=e[r],"function"==typeof t[n]?t[n](i):t.hasOwnProperty(r)&&(t[r]=i)},t.prototype.processMessage=function(t){if("run"===t.cmd){var e={callbackMeshBuilder:function(t){self.postMessage(t)},callbackProgress:function(e){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+e)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(t.logging.enabled,t.logging.debug),this.applyProperties(r,t.params),this.applyProperties(r,t.materials),this.applyProperties(r,e),r.workerScope=self,r.parse(t.data.input,t.data.options),t.logging.enabled&&console.log("WorkerRunner: Run complete!"),e.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+t.cmd)},t}(),Wd.WorkerSupport=function(){var t="2.2.0",e=Wd.Validator,r=function(){function t(){this._reset()}return t.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.setForceCopy=function(t){this.forceCopy=!0===t},t.prototype.initWorker=function(t,e){this.runnerImplName=e;var r=new Blob([t],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},t.prototype._receiveWorkerMessage=function(t){var e=t.data;switch(e.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(e);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+e.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(e.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+e.cmd)}},t.prototype.setCallbacks=function(t,r){this.callbacks.meshBuilder=e.verifyInput(t,this.callbacks.meshBuilder),this.callbacks.onLoad=e.verifyInput(r,this.callbacks.onLoad)},t.prototype.run=function(t){if(e.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=t,this.started=!0,!e.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!e.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==t.cmd&&(t.cmd="run"),e.isValid(t.logging)?(t.logging.enabled=!0===t.logging.enabled,t.logging.debug=!0===t.logging.debug):t.logging={enabled:!0,debug:!1},this._postMessage()}},t.prototype._postMessage=function(){var t;e.isValid(this.queuedMessage)&&e.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(t=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[t])):this.worker.postMessage(this.queuedMessage))},t.prototype.setTerminateRequested=function(t){this.terminateRequested=!0===t,this.terminateRequested&&e.isValid(this.worker)&&!e.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},t.prototype._terminate=function(){this.worker.terminate(),this._reset()},t}();function n(){if(console.info("Using LoaderSupport.WorkerSupport version: "+t),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new r}n.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},n.prototype.setForceWorkerDataCopy=function(t){this.loaderWorker.setForceCopy(t)},n.prototype.validate=function(t,r,n,s,a){if(!e.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),e.isValid(a)?this.logging.enabled&&console.info('WorkerSupport: Using "'+a.name+'" as Runner class for worker.'):(a=Wd.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=t(i,o);l+="var Parser = "+r+";\n\n",l+=o(a.name,a),l+="new "+a.name+"();\n\n";var c=this;if(e.isValid(n)&&n.length>0){var u="",h=function(t,e){if(0===e.length)c.loaderWorker.initWorker(u+l,a.name),c.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new kc;r.setPath(t),r.setResponseType("text"),r.load(e[0],function(r){u+=r,h(t,e)}),e.shift()}};h(s,n)}else this.loaderWorker.initWorker(l,a.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},n.prototype.setCallbacks=function(t,e){this.loaderWorker.setCallbacks(t,e)},n.prototype.run=function(t){this.loaderWorker.run(t)},n.prototype.setTerminateRequested=function(t){this.loaderWorker.setTerminateRequested(t)};var i=function(t,e){var r,n=t+" = {\n";for(var i in e)"string"==typeof(r=e[i])||r instanceof String?n+="\t"+i+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?n+="\t"+i+": ["+r+"],\n":Number.isInteger(r)?n+="\t"+i+": "+r+",\n":"function"==typeof r&&(n+="\t"+i+": "+r+",\n");return n+"}\n\n"},o=function(t,r,n,i,o){var s,a,l="",c=e.isValid(n)?n:r.name;for(var u in o=e.verifyInput(o,[]),r.prototype)s=r.prototype[u],"constructor"===u?a="\tfunction "+c+s.toString().replace("function","")+";\n\n":"function"==typeof s&&o.indexOf(u)<0&&(l+="\t"+c+".prototype."+u+" = "+s.toString()+";\n\n");l+="\treturn "+c+";\n",l+="})();\n\n";var h="";return e.isValid(i)&&(h+="\n",h+=c+".prototype = Object.create( "+i+".prototype );\n",h+=c+".constructor = "+c+";\n",h+="\n"),e.isValid(a)?l=t+" = (function () {\n\n"+h+a+l:(a=t+" = (function () {\n\n",l=(a+=h+"\t"+r.prototype.constructor.toString()+"\n\n")+l),l};return n}(),Wd.WorkerDirector=function(){var t="2.2.0",e=Wd.Validator,r=16,n=8192;function i(i){if(console.info("Using LoaderSupport.WorkerDirector version: "+t),this.logging={enabled:!0,debug:!1},this.maxQueueSize=n,this.maxWebWorkers=r,this.crossOrigin=null,!e.isValid(i))throw"Provided invalid classDef: "+i;this.workerDescription={classDef:i,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return i.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},i.prototype.getMaxQueueSize=function(){return this.maxQueueSize},i.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},i.prototype.setCrossOrigin=function(t){this.crossOrigin=t},i.prototype.setForceWorkerDataCopy=function(t){this.workerDescription.forceWorkerDataCopy=!0===t},i.prototype.prepareWorkers=function(t,i,o){e.isValid(t)&&(this.workerDescription.globalCallbacks=t),this.maxQueueSize=Math.min(i,n),this.maxWebWorkers=Math.min(o,r),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var s=0;s<this.maxWebWorkers;s++){var a=new Wd.WorkerSupport;a.setLogging(this.logging.enabled,this.logging.debug),a.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[s]={instanceNo:s,inUse:!1,terminateRequested:!1,workerSupport:a,loader:null}}},i.prototype.enqueueForRun=function(t){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(t)},i.prototype.isRunning=function(){var t=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||t.length>0},i.prototype.processQueue=function(){var t;for(var e in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[e]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(this._kickWorkerRun(this.instructionQueue[this.instructionQueuePointer],t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},i.prototype._kickWorkerRun=function(t,r){r.inUse=!0,r.workerSupport.setTerminateRequested(r.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var n=this,i=t.getCallbacks(),o=this.workerDescription.globalCallbacks;r.loader=this._buildLoader(r.instanceNo);var s=new Wd.Callbacks;s.setCallbackOnLoad(function(t){e.isValid(o.onLoad)&&o.onLoad(t),e.isValid(i.onLoad)&&i.onLoad(t),n.objectsCompleted++,r.inUse=!1,n.processQueue()}),s.setCallbackOnProgress(function(t){e.isValid(o.onProgress)&&o.onProgress(t),e.isValid(i.onProgress)&&i.onProgress(t)}),s.setCallbackOnMeshAlter(function(t){e.isValid(o.onMeshAlter)&&o.onMeshAlter(t),e.isValid(i.onMeshAlter)&&i.onMeshAlter(t)}),t.callbacks=s,r.loader.run(t,r.workerSupport)},i.prototype._buildLoader=function(t){var r=this.workerDescription.classDef,n=Object.create(r.prototype);if(r.call(n,Dc),!n.hasOwnProperty("instanceNo"))throw r.name+' has no property "instanceNo".';if(n.instanceNo=t,!n.hasOwnProperty("workerSupport"))throw r.name+' has no property "workerSupport".';if("function"!=typeof n.run)throw r.name+' has no function "run".';return n.hasOwnProperty("callbacks")&&e.isValid(n.callbacks)||(console.warn(r.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"'),n.callbacks=new Wd.Callbacks),n},i.prototype._deregister=function(t){if(e.isValid(t)){t.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+t.instanceNo+".");var r=t.loader.callbacks;e.isValid(r.onProgress)&&r.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[t.instanceNo]}},i.prototype.tearDown=function(t){for(var r in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=e.verifyInput(t,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[r].terminateRequested=!0},i}();var Xd,qd=function(t){this.manager=void 0!==t?t:Dc};qd.prototype={constructor:qd,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(){var t=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(e){console.time("MD2Loader");for(var r=new DataView(e),n={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],o=0;o<i.length;o++)n[i[o]]=r.getInt32(4*o,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===r.byteLength){for(var s=new Ba,a=[],l=n.offset_st,c=(o=0,n.num_st);o<c;o++){var u=r.getInt16(l+0,!0),h=r.getInt16(l+2,!0);a.push(new ka(u/n.skinwidth,1-h/n.skinheight)),l+=4}for(l=n.offset_tris,o=0,c=n.num_tris;o<c;o++){var d=r.getUint16(l+0,!0),p=r.getUint16(l+2,!0),f=r.getUint16(l+4,!0);s.faces.push(new Ra(d,p,f)),s.faceVertexUvs[0].push([a[r.getUint16(l+6,!0)],a[r.getUint16(l+8,!0)],a[r.getUint16(l+10,!0)]]),l+=12}var m=new Ta,v=new Ta,g=[];for(l=n.offset_frames,o=0,c=n.num_frames;o<c;o++){v.set(r.getFloat32(l+0,!0),r.getFloat32(l+4,!0),r.getFloat32(l+8,!0)),m.set(r.getFloat32(l+12,!0),r.getFloat32(l+16,!0),r.getFloat32(l+20,!0)),l+=24;for(var y=0;y<16;y++){var x=r.getUint8(l+y,!0);if(0===x)break;g[y]=x}var b={name:String.fromCharCode.apply(null,g),vertices:[],normals:[]};for(l+=16,y=0;y<n.num_vertices;y++){var w=r.getUint8(l++,!0),_=r.getUint8(l++,!0),S=r.getUint8(l++,!0),T=t[r.getUint8(l++,!0)],M=new Ta(w*v.x+m.x,S*v.z+m.z,_*v.y+m.y),A=new Ta(T[0],T[2],T[1]);b.vertices.push(M),b.normals.push(A)}s.morphTargets.push(b)}s.vertices=s.morphTargets[0].vertices;for(var E=s.morphTargets[0],C=(y=0,s.faces.length);y<C;y++)(O=s.faces[y]).vertexNormals=[E.normals[O.a],E.normals[O.b],E.normals[O.c]];for(o=0,c=s.morphTargets.length;o<c;o++){E=s.morphTargets[o];var P=[];for(y=0,C=s.faces.length;y<C;y++){var O;P.push({a:E.normals[(O=s.faces[y]).a],b:E.normals[O.b],c:E.normals[O.c]})}s.morphNormals.push({vertexNormals:P})}return s.animations=gc.CreateClipsFromMorphTargetSequences(s.morphTargets,10),console.timeEnd("MD2Loader"),s}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")}}()};var Yd={getContext:function(){return void 0===Xd&&(Xd=new(window.AudioContext||window.webkitAudioContext)),Xd},setContext:function(t){Xd=t}};function Zd(){Na.call(this),this.type="AudioListener",this.context=Yd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Jd(t){Na.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Qd(t){this.manager=void 0!==t?t:Dc}Zd.prototype=Object.assign(Object.create(Na.prototype),{constructor:Zd,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new Ta,e=new Ma,r=new Ta,n=new Ta;return function(i){Na.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(t,e,r),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),Jd.prototype=Object.assign(Object.create(Na.prototype),{constructor:Jd,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),Object.assign(Qd.prototype,{load:function(t,e,r,n){var i=new kc(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){Yd.getContext().decodeAudioData(t,function(t){e(t)})},r,n)}});var Kd=function(t){this.manager=void 0!==t?t:Dc};function $d(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,o=new Array(i),s={endingStart:Il,endingEnd:Il},a=0;a!==i;++a){var l=n[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Nl,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function tp(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function ep(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Kd.prototype={constructor:Kd,load:function(t,e,r,n){var i=this,o=new Mc,s=new kc(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){o.image=i.parse(t),o.needsUpdate=!0,void 0!==e&&e(o)},r,n),o},parse:function(t){t.length<19&&console.error("TGALoader: Not enough data to contain header.");var e=new Uint8Array(t),r=0,n={id_length:e[r++],colormap_type:e[r++],image_type:e[r++],colormap_index:e[r++]|e[r++]<<8,colormap_length:e[r++]|e[r++]<<8,colormap_size:e[r++],origin:[e[r++]|e[r++]<<8,e[r++]|e[r++]<<8],width:e[r++]|e[r++]<<8,height:e[r++]|e[r++]<<8,pixel_size:e[r++],flags:e[r++]};!function(t){switch(t.image_type){case 1:case 9:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',t.pixel_size)}(n),n.id_length+r>t.length&&console.error("TGALoader: No data."),r+=n.id_length;var i=!1,o=!1,s=!1;switch(n.image_type){case 9:i=!0,o=!0;break;case 1:o=!0;break;case 10:i=!0;break;case 2:break;case 11:i=!0,s=!0;break;case 3:s=!0}var a=document.createElement("canvas");a.width=n.width,a.height=n.height;var l=a.getContext("2d"),c=l.createImageData(n.width,n.height),u=function(t,e,r,n,i){var o,s,a,l;if(a=r.width*r.height*(s=r.pixel_size>>3),e&&(l=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),t){var c,u,h;o=new Uint8Array(a);for(var d=0,p=new Uint8Array(s);d<a;)if(u=1+(127&(c=i[n++])),128&c){for(h=0;h<s;++h)p[h]=i[n++];for(h=0;h<u;++h)o.set(p,d+h*s);d+=s*u}else{for(u*=s,h=0;h<u;++h)o[d+h]=i[n++];d+=u}}else o=i.subarray(n,n+=e?r.width*r.height:a);return{pixel_data:o,palettes:l}}(i,o,n,r,e);return function(t,e,r,i,o){var a,l,c,u,h,d;switch((48&n.flags)>>4){default:case 2:a=0,c=1,h=e,l=0,u=1,d=r;break;case 0:a=0,c=1,h=e,l=r-1,u=-1,d=-1;break;case 3:a=e-1,c=-1,h=-1,l=0,u=1,d=r;break;case 1:a=e-1,c=-1,h=-1,l=r-1,u=-1,d=-1}if(s)switch(n.pixel_size){case 8:!function(t,e,r,i,o,s,a,l){var c,u,h,d=0,p=n.width;for(h=e;h!==i;h+=r)for(u=o;u!==a;u+=s,d++)t[4*(u+p*h)+0]=c=l[d],t[4*(u+p*h)+1]=c,t[4*(u+p*h)+2]=c,t[4*(u+p*h)+3]=255}(t,l,u,d,a,c,h,i);break;case 16:!function(t,e,r,i,o,s,a,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==a;c+=s,h+=2)t[4*(c+d*u)+0]=l[h+0],t[4*(c+d*u)+1]=l[h+0],t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+3]=l[h+1]}(t,l,u,d,a,c,h,i);break;default:console.error("TGALoader: Format not supported.")}else switch(n.pixel_size){case 8:!function(t,e,r,i,s,a,l,c,u){var h,d,p,f=o,m=0,v=n.width;for(p=e;p!==i;p+=r)for(d=s;d!==l;d+=a,m++)h=c[m],t[4*(d+v*p)+3]=255,t[4*(d+v*p)+2]=f[3*h+0],t[4*(d+v*p)+1]=f[3*h+1],t[4*(d+v*p)+0]=f[3*h+2]}(t,l,u,d,a,c,h,i);break;case 16:!function(t,e,r,i,o,s,a,l){var c,u,h,d=0,p=n.width;for(h=e;h!==i;h+=r)for(u=o;u!==a;u+=s,d+=2)t[4*(u+p*h)+0]=(31744&(c=l[d+0]+(l[d+1]<<8)))>>7,t[4*(u+p*h)+1]=(992&c)>>2,t[4*(u+p*h)+2]=(31&c)>>3,t[4*(u+p*h)+3]=32768&c?0:255}(t,l,u,d,a,c,h,i);break;case 24:!function(t,e,r,i,o,s,a,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==a;c+=s,h+=3)t[4*(c+d*u)+3]=255,t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+1]=l[h+1],t[4*(c+d*u)+0]=l[h+2]}(t,l,u,d,a,c,h,i);break;case 32:!function(t,e,r,i,o,s,a,l){var c,u,h=0,d=n.width;for(u=e;u!==i;u+=r)for(c=o;c!==a;c+=s,h+=4)t[4*(c+d*u)+2]=l[h+0],t[4*(c+d*u)+1]=l[h+1],t[4*(c+d*u)+0]=l[h+2],t[4*(c+d*u)+3]=l[h+3]}(t,l,u,d,a,c,h,i);break;default:console.error("TGALoader: Format not supported.")}}(c.data,n.width,n.height,u.pixel_data,u.palettes),l.putImageData(c,0,0),a}},Object.assign($d.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=n/i;t.warp(1,i/n,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+r,l[0]=t/s,l[1]=e/s,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var s=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(s),c[u].accumulate(n,a)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=2202===n;if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var s=Math.floor(e/r);e-=r*s,i+=Math.abs(s);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&i))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:Il:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:Il:2402)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=e,s[1]=i+t,a[1]=r,this}}),Object.assign(tp.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)r[i+s]=r[s];o=e}else this._mixBufferRegion(r,i,0,e/(o+=e),n);this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(r,n,3*e,1-i,e);for(var s=e,a=e+e;s!==a;++s)if(r[s]!==r[s+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e,i=r;n!==i;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){Ma.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,s=0;s!==i;++s){var a=e+s;t[a]=t[a]*o+t[r+s]*n}}}),ep.prototype=Object.assign(Object.create(Aa.prototype),{constructor:ep,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,s=t._interpolants,a=r.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(l[a]=c={});for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}++(p=new tp(sh.create(r,d,e&&e._propertyBindings[u].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,a,d),o[u]=p}s[u].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,s=i.length;o!==s;++o){var a=i[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var s=o.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(n[e]=i={}),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,s=o[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete s[i];t:{for(var c in s)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new dc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?gc.findByName(r,t):t,o=null!==i?i.uuid:t,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;a=s.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var c=new $d(this,i,e);return this._bindAction(c,a),this._addInactiveAction(c,o,n),c},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?gc.findByName(r,t):t,o=this._actionsByClip[i?i.uuid:t];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){for(var e=this._actions,r=this._nActiveActions,n=this.time+=t*=this.timeScale,i=Math.sign(t),o=this._accuIndex^=1,s=0;s!==r;++s)e[s]._update(n,t,i,o);var a=this._bindings,l=this._nActiveBindings;for(s=0;s!==l;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}});var rp=function(t){$c.call(this),this.manager=void 0!==t?t:Dc,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null};(rp.prototype=Object.create($c.prototype)).constructor=rp,rp.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],rp.prototype.setTextureCrossOrigin=function(t){this.textureCrossOrigin=t},rp.prototype.load=function(t,e,r,n,i){var o=this;this.loadModel(t,function(t){o.loadVmds(e,function(e){o.pourVmdIntoModel(t,e),r(t)},n,i)},n,i)},rp.prototype.loadModel=function(t,e,r,n){var i=this,o=tu.extractUrlBase(t),s=this.extractExtension(t);this.loadFileAsBuffer(t,function(t){e(i.createModel(t,s,o,r,n))},r,n)},rp.prototype.createModel=function(t,e,r,n,i){return this.createMesh(this.parseModel(t,e),r,n,i)},rp.prototype.loadVmd=function(t,e,r,n){var i=this;this.loadFileAsBuffer(t,function(t){e(i.parseVmd(t))},r,n)},rp.prototype.loadVmds=function(t,e,r,n){var i=this,o=[];t=t.slice(),function s(){var a=t.shift();i.loadVmd(a,function(r){o.push(r),t.length>0?s():e(i.mergeVmds(o))},r,n)}()},rp.prototype.loadAudio=function(t,e,r,n){var i=new Zd,o=new Jd(i);new Qd(this.manager).load(t,function(t){o.setBuffer(t),e(o,i)},r,n)},rp.prototype.loadVpd=function(t,e,r,n,i){var o=this;(i&&"unicode"===i.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(t,function(t){e(o.parseVpd(t))},r,n)},rp.prototype.parseModel=function(t,e){switch(e.toLowerCase()){case"pmd":return this.parsePmd(t);case"pmx":return this.parsePmx(t);default:throw"extension "+e+" is not supported."}},rp.prototype.parsePmd=function(t){return this.parser.parsePmd(t,!0)},rp.prototype.parsePmx=function(t){return this.parser.parsePmx(t,!0)},rp.prototype.parseVmd=function(t){return this.parser.parseVmd(t,!0)},rp.prototype.parseVpd=function(t){return this.parser.parseVpd(t,!0)},rp.prototype.mergeVmds=function(t){return this.parser.mergeVmds(t)},rp.prototype.pourVmdIntoModel=function(t,e,r){this.createAnimation(t,e,r)},rp.prototype.pourVmdIntoCamera=function(t,e,r){var n=new rp.DataCreationHelper;!function(){for(var i=n.createOrderedMotionArray(e.cameras),o=[],s=[],a=[],l=[],c=[],u=[],h=[],d=[],p=[],f=new Ma,m=new Ea,v=new Ta,g=new Ta,y=function(t,e){t.push(e.x),t.push(e.y),t.push(e.z)},x=function(t,e){t.push(e.x),t.push(e.y),t.push(e.z),t.push(e.w)},b=function(t,e,r){t.push(e[4*r+0]/127),t.push(e[4*r+1]/127),t.push(e[4*r+2]/127),t.push(e[4*r+3]/127)},w=function(t,e,r,n,i){if(r.length>2){r=r.slice(),n=n.slice(),i=i.slice();for(var o=n.length/r.length,s=3===o?12:4,a=1,l=2,c=r.length;l<c;l++){for(var u=0;u<o;u++)if(n[a*o+u]!==n[(a-1)*o+u]||n[a*o+u]!==n[l*o+u]){a++;break}if(l>a){for(r[a]=r[l],u=0;u<o;u++)n[a*o+u]=n[l*o+u];for(u=0;u<s;u++)i[a*s+u]=i[l*s+u]}}r.length=a+1,n.length=(a+1)*o,i.length=(a+1)*s}return new rp[e](t,r,n,i)},_=0;_<i.length;_++){var S=i[_],T=S.frameNum/30,M=S.position,A=S.rotation,E=S.fov,C=S.interpolation;v.set(0,0,-S.distance),g.set(M[0],M[1],M[2]),m.set(-A[0],-A[1],-A[2]),f.setFromEuler(m),v.add(g),v.applyQuaternion(f),o.length>0&&T<o[o.length-1]+.05&&(o[o.length-1]=T-1e-13),o.push(T),y(s,g),x(a,f),y(l,v),c.push(E);for(var P=0;P<3;P++)b(u,C,P);for(b(h,C,3),P=0;P<3;P++)b(d,C,4);b(p,C,5)}if(0!==o.length){var O=[];O.push(w(".center","VectorKeyframeTrackEx",o,s,u)),O.push(w(".quaternion","QuaternionKeyframeTrackEx",o,a,h)),O.push(w(".position","VectorKeyframeTrackEx",o,l,d)),O.push(w(".fov","NumberKeyframeTrackEx",o,c,p));var N=new gc(void 0===r?_a.generateUUID():r,-1,O);void 0===t.center&&(t.center=new Ta(0,0,0)),void 0===t.animations&&(t.animations=[]),t.animations.push(N)}}()},rp.prototype.extractExtension=function(t){var e=t.lastIndexOf(".");return e<0?null:t.slice(e+1)},rp.prototype.loadFile=function(t,e,r,n,i,o){var s=new kc(this.manager);return void 0!==o&&s.setMimeType(o),s.setResponseType(i),s.load(t,function(t){e(t)},r,n)},rp.prototype.loadFileAsBuffer=function(t,e,r,n){this.loadFile(t,e,r,n,"arraybuffer")},rp.prototype.loadFileAsText=function(t,e,r,n){this.loadFile(t,e,r,n,"text")},rp.prototype.loadFileAsShiftJISText=function(t,e,r,n){this.loadFile(t,e,r,n,"text","text/plain; charset=shift_jis")},rp.prototype.createMesh=function(t,e,r,n){var i=this,o=new $a,s=[],a={vertices:[],uvs:[],normals:[],skinIndices:[],skinWeights:[],indices:[]};return function(){for(var e=0;e<t.metadata.vertexCount;e++){for(var r=t.vertices[e],n=0,i=r.position.length;n<i;n++)a.vertices.push(r.position[n]);for(n=0,i=r.normal.length;n<i;n++)a.normals.push(r.normal[n]);for(n=0,i=r.uv.length;n<i;n++)a.uvs.push(r.uv[n]);for(n=0;n<4;n++)a.skinIndices.push(r.skinIndices.length-1>=n?r.skinIndices[n]:0);for(n=0;n<4;n++)a.skinWeights.push(r.skinWeights.length-1>=n?r.skinWeights[n]:0)}}(),function(){for(var e=0;e<t.metadata.faceCount;e++)for(var r=t.faces[e],n=0,i=r.indices.length;n<i;n++)a.indices.push(r.indices[n])}(),function(){for(var e=[],r=t.rigidBodies,n={},i=0,s=r.length;i<s;i++){var a=r[i],l=n[a.boneIndex];l=void 0===l?a.type:Math.max(a.type,l),n[a.boneIndex]=l}for(i=0;i<t.metadata.boneCount;i++){var c={},u=t.bones[i];c.parent=u.parentIndex,c.name=u.name,c.pos=[u.position[0],u.position[1],u.position[2]],c.rotq=[0,0,0,1],c.scl=[1,1,1],-1!==c.parent&&(c.pos[0]-=t.bones[c.parent].position[0],c.pos[1]-=t.bones[c.parent].position[1],c.pos[2]-=t.bones[c.parent].position[2]),c.rigidBodyType=void 0!==n[i]?n[i]:-1,e.push(c)}o.bones=e}(),function(){var e=[];if("pmd"===t.metadata.format)for(var r=0;r<t.metadata.ikCount;r++){(s={}).target=(i=t.iks[r]).target,s.effector=i.effector,s.iteration=i.iteration,s.maxAngle=4*i.maxAngle,s.links=[];for(var n=0;n<i.links.length;n++)(a={}).index=i.links[n].index,t.bones[a.index].name.indexOf("\u3072\u3056")>=0&&(a.limitation=new Ta(1,0,0)),s.links.push(a);e.push(s)}else for(r=0;r<t.metadata.boneCount;r++){var i;if(void 0!==(i=t.bones[r].ik)){var s;for((s={}).target=r,s.effector=i.effector,s.iteration=i.iteration,s.maxAngle=i.maxAngle,s.links=[],n=0;n<i.links.length;n++){var a;(a={}).index=i.links[n].index,a.enabled=!0,1===i.links[n].angleLimitation&&(a.limitation=new Ta(1,0,0)),s.links.push(a)}e.push(s)}}o.iks=e}(),function(){if("pmd"!==t.metadata.format){for(var e=[],r=0;r<t.metadata.boneCount;r++){var n=t.bones[r],i=n.grant;if(void 0!==i){var s={};s.index=r,s.parentIndex=i.parentIndex,s.ratio=i.ratio,s.isLocal=i.isLocal,s.affectRotation=i.affectRotation,s.affectPosition=i.affectPosition,s.transformationClass=n.transformationClass,e.push(s)}}e.sort(function(t,e){return t.transformationClass-e.transformationClass}),o.grants=e}}(),function(){function e(t,e,r,n){t.array[3*e+0]+=r.position[0]*n,t.array[3*e+1]+=r.position[1]*n,t.array[3*e+2]+=r.position[2]*n}function r(r,n,i){for(var o=0;o<n.elementCount;o++){var s=n.elements[o];e(r,"pmd"===t.metadata.format?t.morphs[0].elements[s.index].index:s.index,s,i)}}for(var n=[],i=[],s=0;s<t.metadata.morphCount;s++){var l=t.morphs[s],c={name:l.name},u=new Za(3*t.metadata.vertexCount,3);u.name=l.name;for(var h=0;h<3*t.metadata.vertexCount;h++)u.array[h]=a.vertices[h];if("pmd"===t.metadata.format)0!==s&&r(u,l,1);else if(0===l.type)for(h=0;h<l.elementCount;h++){var d=t.morphs[l.elements[h].index];1===d.type&&r(u,d,l.elements[h].ratio)}else 1===l.type&&r(u,l,1);n.push(c),i.push(u)}o.morphTargets=n,o.morphAttributes.position=i}(),function(){var a={},l=new Kc(i.manager),c=new Kd(i.manager),u=document.createElement("canvas"),h=u.getContext("2d"),d=0,p=[];function f(t,o){var s;if(void 0===o&&(o={}),!0===o.defaultTexturePath)try{s=i.defaultToonTextures[parseInt(t.match("toon([0-9]{2}).bmp$")[1])]}catch(e){console.warn("MMDLoader: "+t+" seems like not right default texture path. Using toon00.bmp instead."),s=i.defaultToonTextures[0]}else s=e+t;if(void 0!==a[s])return s;var d=$c.Handlers.get(s);null===d&&(d=t.indexOf(".tga")>=0?c:l);var p=d.load(s,function(t){if(!0===o.isToonTexture){var e=t.image,r=e.width,n=e.height;u.width=r,u.height=n,h.clearRect(0,0,r,n),h.translate(r/2,n/2),h.rotate(.5*Math.PI),h.translate(-r/2,-n/2),h.drawImage(e,0,0),t.image=h.getImageData(0,0,r,n)}t.flipY=!1,t.wrapS=gl,t.wrapT=gl;for(var i=0;i<p.readyCallbacks.length;i++)p.readyCallbacks[i](p);delete p.readyCallbacks},r,n);return!0===o.sphericalReflectionMapping&&(p.mapping=vl),p.readyCallbacks=[],a[s]=p,s}function m(t,e){return void 0===e[t]&&console.warn("MMDLoader: Undefined texture",t),e[t]}null!==i.textureCrossOrigin&&l.setCrossOrigin(i.textureCrossOrigin);for(var v=0;v<t.metadata.materialCount;v++){var g,y=t.materials[v],x={};if(x.faceOffset=d,x.faceNum=y.faceCount,d+=y.faceCount,x.name=y.name,x.color=new Ia(y.diffuse[0],y.diffuse[1],y.diffuse[2]),x.opacity=y.diffuse[3],x.specular=new Ia(y.specular[0],y.specular[1],y.specular[2]),x.shininess=y.shininess,1===x.opacity?(x.side=rl,x.transparent=!1):(x.side=il,x.transparent=!0),"pmd"===t.metadata.format){if(y.fileName){var b=y.fileName,w=[],_=b.lastIndexOf("*");_>=0?(w.push(b.slice(0,_)),w.push(b.slice(_+1))):w.push(b);for(var S=0;S<w.length;S++)(g=w[S]).indexOf(".sph")>=0||g.indexOf(".spa")>=0?(x.envMap=f(g,{sphericalReflectionMapping:!0}),x.envMapType=g.indexOf(".sph")>=0?pl:2):x.map=f(g)}}else-1!==y.textureIndex&&(x.map=f(g=t.textures[y.textureIndex])),-1===y.envTextureIndex||1!==y.envFlag&&2!=y.envFlag||(x.envMap=f(g=t.textures[y.envTextureIndex],{sphericalReflectionMapping:!0}),x.envMapType=1===y.envFlag?pl:2);var T=void 0===x.map?1:.2;x.emissive=new Ia(y.ambient[0]*T,y.ambient[1]*T,y.ambient[2]*T),p.push(x)}for(v=0;v<p.length;v++){var M=p[v],A=t.materials[v];if(y=new Wc,o.addGroup(3*M.faceOffset,3*M.faceNum,v),void 0!==M.name&&(y.name=M.name),y.skinning=o.bones.length>0,y.morphTargets=o.morphTargets.length>0,y.lights=!0,y.side="pmx"===t.metadata.format&&1==(1&A.flag)?il:M.side,y.transparent=M.transparent,y.fog=!0,y.blending=5,y.blendSrc=ul,y.blendDst=hl,y.blendSrcAlpha=ul,y.blendDstAlpha=206,void 0!==M.map){function E(t){t.map.readyCallbacks.push(function(e){function r(t,e){var r=t.width,n=t.height,i=Math.round(e.x*r)%r,o=Math.round(e.y*n)%n;return i<0&&(i+=r),o<0&&(o+=n),t.data[4*(o*r+i)+3]}var n=void 0!==e.image.data?e.image:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var r=e.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,e.width,e.height)}(e.image),i=o.index.array.slice(3*t.faceOffset,3*t.faceOffset+3*t.faceNum);(function(t,e,n){if(t.data.length/(t.width*t.height)!=4)return!1;for(var i=0;i<n.length;i+=3){for(var o={x:0,y:0},s=0;s<3;s++){var a=n[3*i+s],l={x:e[2*a+0],y:e[2*a+1]};if(r(t,l)<253)return!0;o.x+=l.x,o.y+=l.y}if(o.x/=3,o.y/=3,r(t,o)<253)return!0}return!1})(n,o.attributes.uv.array,i)&&(t.transparent=!0),delete t.faceOffset,delete t.faceNum})}y.faceOffset=M.faceOffset,y.faceNum=M.faceNum,y.map=m(M.map,a),E(y)}if(void 0!==M.envMap&&(y.envMap=m(M.envMap,a),y.combine=M.envMapType),y.opacity=M.opacity,y.color=M.color,void 0!==M.emissive&&(y.emissive=M.emissive),y.specular=M.specular,y.shininess=Math.max(M.shininess,1e-4),"pmd"===t.metadata.format){function C(t){return 10===t.length&&null!==t.match(/toon(10|0[0-9]).bmp/)}y.outlineParameters={thickness:1===A.edgeFlag?.003:0,color:new Ia(0,0,0),alpha:1},0===y.outlineParameters.thickness&&(y.outlineParameters.visible=!1);var P=f(O=-1===A.toonIndex?"toon00.bmp":t.toonTextures[A.toonIndex].fileName,{isToonTexture:!0,defaultTexturePath:C(O)});y.gradientMap=m(P,a)}else{var O,N;if(y.outlineParameters={thickness:A.edgeSize/300,color:new Ia(A.edgeColor[0],A.edgeColor[1],A.edgeColor[2]),alpha:A.edgeColor[3]},0!=(16&A.flag)&&0!==y.outlineParameters.thickness||(y.outlineParameters.visible=!1),-1===A.toonIndex||0!==A.toonFlag){var L=A.toonIndex+1;O="toon"+(L<10?"0"+L:L)+".bmp",N=!0}else O=t.textures[A.toonIndex],N=!1;P=f(O,{isToonTexture:!0,defaultTexturePath:N}),y.gradientMap=m(P,a)}s.push(y)}if("pmx"===t.metadata.format){function I(t,e){if(8===t.type)for(var r=0;r<e.length;r++){var n=e[r];if(-1!==n.index){var i=s[n.index];i.opacity!==n.diffuse[3]&&(i.transparent=!0)}}}for(v=0;v<t.morphs.length;v++){var R=t.morphs[v],D=R.elements;if(0===R.type)for(S=0;S<D.length;S++){var F=t.morphs[D[S].index];I(F,F.elements)}else I(R,D)}}}(),function(){for(var e=[],r=[],n=0;n<t.metadata.rigidBodyCount;n++){for(var i=t.rigidBodies[n],s=Object.keys(i),a={},l=0;l<s.length;l++)a[h=s[l]]=i[h];if("pmx"===t.metadata.format&&-1!==a.boneIndex){var c=t.bones[a.boneIndex];a.position[0]-=c.position[0],a.position[1]-=c.position[1],a.position[2]-=c.position[2]}e.push(a)}for(n=0;n<t.metadata.constraintCount;n++){var u=t.constraints[n];for(s=Object.keys(u),a={},l=0;l<s.length;l++){var h;a[h=s[l]]=u[h]}var d=e[a.rigidBodyIndex1],p=e[a.rigidBodyIndex2];0!==d.type&&2===p.type&&-1!==d.boneIndex&&-1!==p.boneIndex&&t.bones[p.boneIndex].parentIndex===d.boneIndex&&(p.type=1),r.push(a)}o.rigidBodies=e,o.constraints=r}(),o.setIndex(a.indices),o.addAttribute("position",new Za(a.vertices,3)),o.addAttribute("normal",new Za(a.normals,3)),o.addAttribute("uv",new Za(a.uvs,2)),o.addAttribute("skinIndex",new Xa(a.skinIndices,4)),o.addAttribute("skinWeight",new Za(a.skinWeights,4)),o.computeBoundingSphere(),o.mmdFormat=t.metadata.format,new zh(o,s)},rp.prototype.createAnimation=function(t,e,r){var n=new rp.DataCreationHelper;!function(){if(0!==e.metadata.motionCount){for(var i=t.geometry.bones,o=n.createOrderedMotionArrays(i,e.motions,"boneName"),s=[],a=function(t,e,r){t.push(e[r+0]/127),t.push(e[r+8]/127),t.push(e[r+4]/127),t.push(e[r+12]/127)},l=0;l<o.length;l++){for(var c=[],u=[],h=[],d=[],p=[],f=i[l],m=o[l],v=0;v<m.length;v++){var g=m[v].position,y=m[v].rotation,x=m[v].interpolation;c.push(m[v].frameNum/30);for(var b=0;b<3;b++)u.push(f.pos[b]+g[b]);for(b=0;b<4;b++)h.push(y[b]);for(b=0;b<3;b++)a(d,x,b);a(p,x,3)}if(0!==c.length){var w=".bones["+f.name+"]";s.push(new rp.VectorKeyframeTrackEx(w+".position",c,u,d)),s.push(new rp.QuaternionKeyframeTrackEx(w+".quaternion",c,h,p))}}var _=new gc(void 0===r?_a.generateUUID():r,-1,s);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(_)}}(),function(){if(0!==e.metadata.morphCount){for(var i=n.createOrderedMotionArrays(t.geometry.morphTargets,e.morphs,"morphName"),o=[],s=0;s<i.length;s++){for(var a=[],l=[],c=i[s],u=0;u<c.length;u++)a.push(c[u].frameNum/30),l.push(c[u].weight);0!==a.length&&o.push(new vc(".morphTargetInfluences["+s+"]",a,l))}var h=new gc(void 0===r?_a.generateUUID():r+"Morph",-1,o);void 0===t.geometry.animations&&(t.geometry.animations=[]),t.geometry.animations.push(h)}}()},(rp.DataCreationHelper=function(){}).prototype={constructor:rp.DataCreationHelper,toCharcodeStrings:function(t){for(var e="",r=0;r<t.length;r++)e+="0x"+("0000"+t[r].charCodeAt().toString(16)).substr(-4);return e},createDictionary:function(t){for(var e={},r=0;r<t.length;r++)e[t[r].name]=r;return e},initializeMotionArrays:function(t){for(var e=[],r=0;r<t.length;r++)e[r]=[];return e},sortMotionArray:function(t){t.sort(function(t,e){return t.frameNum-e.frameNum})},sortMotionArrays:function(t){for(var e=0;e<t.length;e++)this.sortMotionArray(t[e])},createMotionArray:function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r]);return e},createMotionArrays:function(t,e,r,n){for(var i=0;i<t.length;i++){var o=t[i],s=r[o[n]];void 0!==s&&e[s].push(o)}},createOrderedMotionArray:function(t){var e=this.createMotionArray(t);return this.sortMotionArray(e),e},createOrderedMotionArrays:function(t,e,r){var n=this.createDictionary(t),i=this.initializeMotionArrays(t);return this.createMotionArrays(e,i,n,r),this.sortMotionArrays(i),i}},((rp.VectorKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),uc.call(this,t,e,r)}).prototype=Object.create(uc.prototype)).constructor=rp.VectorKeyframeTrackEx,rp.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,rp.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new rp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},rp.VectorKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((rp.QuaternionKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),lc.call(this,t,e,r)}).prototype=Object.create(lc.prototype)).constructor=rp.QuaternionKeyframeTrackEx,rp.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,rp.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new rp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},rp.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((rp.NumberKeyframeTrackEx=function(t,e,r,n){this.interpolationParameters=new Float32Array(n),vc.call(this,t,e,r)}).prototype=Object.create(vc.prototype)).constructor=rp.NumberKeyframeTrackEx,rp.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,rp.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(t){return new rp.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),t,this.interpolationParameters)},rp.NumberKeyframeTrackEx.prototype.setInterpolation=function(t){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},((rp.CubicBezierInterpolation=function(t,e,r,n,i){sc.call(this,t,e,r,n),this.params=i}).prototype=Object.create(dc.prototype)).constructor=rp.CubicBezierInterpolation,rp.CubicBezierInterpolation.prototype.interpolate_=function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,l=a-s,c=(r-e)/(n-e);if(4===s){var u=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],c);Ma.slerpFlat(i,0,o,l,o,a,u)}else if(3===s)for(var h=0;h!==s;++h)u=this._calculate(this.params[12*t+4*h+0],this.params[12*t+4*h+1],this.params[12*t+4*h+2],this.params[12*t+4*h+3],c),i[h]=o[l+h]*(1-u)+o[a+h]*u;else u=this._calculate(this.params[4*t+0],this.params[4*t+1],this.params[4*t+2],this.params[4*t+3],c),i[0]=o[l]*(1-u)+o[a]*u;return i},rp.CubicBezierInterpolation.prototype._calculate=function(t,e,r,n,i){for(var o,s,a,l=.5,c=l,u=1-c,h=Math,d=0;d<15;d++){var p=(o=3*u*u*c)*t+(s=3*u*c*c)*e+(a=c*c*c)-i;if(h.abs(p)<1e-5)break;l/=2,u=1-(c+=p<0?l:-l)}return o*r+s*n+a};var np=function(t,e,r){var n=null===r||void 0===r?{}:r;this.audio=t,this.listener=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==n.delayTime?n.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime};np.prototype={constructor:np,control:function(t){this.elapsed+=t,this.currentTime+=t,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||(this.audio.startTime=this.currentTime-this.delayTime,0))},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}};var ip=function(t){this.mesh=t};ip.prototype={constructor:ip,update:function(){var t=new Ma;return function(){for(var e=0;e<this.mesh.geometry.grants.length;e++){var r=this.mesh.geometry.grants[e],n=this.mesh.skeleton.bones[r.index],i=this.mesh.skeleton.bones[r.parentIndex];r.isLocal||r.affectRotation&&(t.set(0,0,0,1),t.slerp(i.quaternion,r.ratio),n.quaternion.multiply(t))}}}()};var op=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null};op.prototype={constructor:op,add:function(t){if(!(t instanceof zh))throw new Error("MMDHelper.add() accepts only SkinnedMesh instance.");void 0===t.mixer&&(t.mixer=null),void 0===t.ikSolver&&(t.ikSolver=null),void 0===t.grantSolver&&(t.grantSolver=null),void 0===t.physics&&(t.physics=null),void 0===t.looped&&(t.looped=!1),this.meshes.push(t),this.initBackupBones(t)},setAudio:function(t,e,r){this.audioManager=new np(t,e,r)},setCamera:function(t){t.mixer=null,this.camera=t},setPhysicses:function(t){for(var e=0;e<this.meshes.length;e++)this.setPhysics(this.meshes[e],t)},setPhysics:function(t,e){if(void 0===(e=void 0===e?{}:Object.assign({},e)).world&&this.sharedPhysics){var r=this.getMasterPhysics();null!==r&&(e.world=r.world)}var n=void 0!==e.warmup?e.warmup:60,i=new rc(t,e);null!==t.mixer&&void 0!==t.mixer&&!0!==e.preventAnimationWarmup&&(this.animateOneMesh(0,t),i.reset()),i.warmup(n),this.updateIKParametersDependingOnPhysicsEnabled(t,!0),t.physics=i},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var t=0,e=this.meshes.length;t<e;t++){var r=this.meshes[t].physics;if(void 0!==r&&null!==r)return this.masterPhysics=r,this.masterPhysics}return null},enablePhysics:function(t){this.doPhysics=!0===t;for(var e=0,r=this.meshes.length;e<r;e++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[e],t)},updateIKParametersDependingOnPhysicsEnabled:function(t,e){for(var r=t.geometry.iks,n=t.geometry.bones,i=0,o=r.length;i<o;i++)for(var s=r[i].links,a=0,l=s.length;a<l;a++){var c=s[a];c.enabled=!0!==e||!(n[c.index].rigidBodyType>0)}},setAnimations:function(){for(var t=0;t<this.meshes.length;t++)this.setAnimation(this.meshes[t])},setAnimation:function(t){if(void 0!==t.geometry.animations){t.mixer=new ep(t),t.mixer.addEventListener("loop",function(t){t.action._clip.tracks.length>0&&0!==t.action._clip.tracks[0].name.indexOf(".bones")||(t.target._root.looped=!0)});for(var e=!1,r=!1,n=0;n<t.geometry.animations.length;n++){var i=t.geometry.animations[n],o=t.mixer.clipAction(i);i.tracks.length>0&&0===i.tracks[0].name.indexOf(".morphTargetInfluences")?r||(o.play(),r=!0):e||(o.play(),e=!0)}e&&(t.ikSolver=new Zl(t),void 0!==t.geometry.grants&&(t.grantSolver=new ip(t)))}},setCameraAnimation:function(t){void 0!==t.animations&&(t.mixer=new ep(t),t.mixer.clipAction(t.animations[0]).play())},unifyAnimationDuration:function(t){t=void 0===t?{}:t;for(var e=0,r=this.camera,n=this.audioManager,i=0;i<this.meshes.length;i++)if(null!==(a=this.meshes[i].mixer))for(var o=0;o<a._actions.length;o++){var s=a._actions[o];e=Math.max(e,s._clip.duration)}if(null!==r&&null!==r.mixer){var a=r.mixer;for(i=0;i<a._actions.length;i++)s=a._actions[i],e=Math.max(e,s._clip.duration)}for(null!==n&&(e=Math.max(e,n.duration)),void 0!==t.afterglow&&(e+=t.afterglow),i=0;i<this.meshes.length;i++)if(null!==(a=this.meshes[i].mixer))for(o=0;o<a._actions.length;o++)(s=a._actions[o])._clip.duration=e;if(null!==r&&null!==r.mixer)for(a=r.mixer,i=0;i<a._actions.length;i++)(s=a._actions[i])._clip.duration=e;null!==n&&(n.duration=e)},controlAudio:function(t){null!==this.audioManager&&this.audioManager.control(t)},animate:function(t){this.controlAudio(t);for(var e=0;e<this.meshes.length;e++)this.animateOneMesh(t,this.meshes[e]);this.sharedPhysics&&this.updateSharedPhysics(t),this.animateCamera(t)},animateOneMesh:function(t,e){var r=e.mixer,n=e.ikSolver,i=e.grantSolver,o=e.physics;null!==r&&!0===this.doAnimation&&(this.restoreBones(e),r.update(t),this.backupBones(e)),null!==n&&!0===this.doIk&&n.update(),null!==i&&!0===this.doGrant&&i.update(),!0===e.looped&&(null!==o&&o.reset(),e.looped=!1),null!==o&&this.doPhysics&&!this.sharedPhysics&&o.update(t)},updateSharedPhysics:function(t){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var e=this.getMasterPhysics();if(null!==e){for(var r=0,n=this.meshes.length;r<n;r++)null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateRigidBodies();for(e.stepSimulation(t),r=0,n=this.meshes.length;r<n;r++){var i;null!==(i=this.meshes[r].physics)&&void 0!==i&&i.updateBones()}}}},animateCamera:function(t){if(null!==this.camera){var e=this.camera.mixer;null!==e&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(e.update(t),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(t,e,r){void 0===r&&(r={}),!0!==r.preventResetPose&&t.pose();for(var n=t.skeleton.bones,i=e.bones,o={},s=0;s<n.length;s++)o[n[s].name]=s;var a=new Ta,l=new Ma;for(s=0;s<i.length;s++){var c=i[s],u=o[c.name];if(void 0!==u){var h=n[u],d=c.translation,p=c.quaternion;a.set(d[0],d[1],d[2]),l.set(p[0],p[1],p[2],p[3]),h.position.add(a),h.quaternion.multiply(l)}}t.updateMatrixWorld(!0),!0!==r.preventIk&&new Zl(t).update(r.saveOriginalBonesBeforeIK),!0!==r.preventGrant&&void 0!==t.geometry.grants&&new ip(t).update()},initBackupBones:function(t){t.skeleton.backupBones=[];for(var e=0;e<t.skeleton.bones.length;e++)t.skeleton.backupBones.push(t.skeleton.bones[e].clone())},backupBones:function(t){t.skeleton.backupBoneIsSaved=!0;for(var e=0;e<t.skeleton.bones.length;e++){var r=t.skeleton.backupBones[e],n=t.skeleton.bones[e];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}},restoreBones:function(t){if(!0===t.skeleton.backupBoneIsSaved){t.skeleton.backupBoneIsSaved=!1;for(var e=0;e<t.skeleton.bones.length;e++){var r=t.skeleton.bones[e],n=t.skeleton.backupBones[e];r.position.copy(n.position),r.quaternion.copy(n.quaternion)}}}};var sp=function(t){this.manager=void 0!==t?t:Dc};sp.prototype={constructor:sp,load:function(t,e,r,n){var i=this,o=new kc(this.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},r,n)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),r={},n=/\s+/,i={},o=0;o<e.length;o++){var s=e[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var a=s.indexOf(" "),l=a>=0?s.substring(0,a):s;l=l.toLowerCase();var c=a>=0?s.substring(a+1):"";if(c=c.trim(),"newmtl"===l)i[c]=r={name:c};else if(r)if("ka"===l||"kd"===l||"ks"===l){var u=c.split(n,3);r[l]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else r[l]=c}}var h=new sp.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(i),h}},(sp.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:rl,this.wrap=this.options&&this.options.wrap?this.options.wrap:gl}).prototype={constructor:sp.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var r in t){var n=t[r],i={};for(var o in e[r]=i,n){var s=!0,a=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(s=!1)}s&&(i[l]=a)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,r=this.materialsInfo[t],n={name:t,side:this.side};function i(t,r){if(!n[t]){var i=e.getTextureParams(r,n),o=e.loadTexture(function(t,e){return"string"!=typeof e||""===e?"":/^https?:\/\//i.test(e)?e:t+e}(e.baseUrl,i.url));o.repeat.copy(i.scale),o.offset.copy(i.offset),o.wrapS=e.wrap,o.wrapT=e.wrap,n[t]=o}}for(var o in r){var s,a=r[o];if(""!==a)switch(o.toLowerCase()){case"kd":n.color=(new Ia).fromArray(a);break;case"ks":n.specular=(new Ia).fromArray(a);break;case"map_kd":i("map",a);break;case"map_ks":i("specularMap",a);break;case"norm":i("normalMap",a);break;case"map_bump":case"bump":i("bumpMap",a);break;case"ns":n.shininess=parseFloat(a);break;case"d":(s=parseFloat(a))<1&&(n.opacity=s,n.transparent=!0);break;case"tr":s=parseFloat(a),this.options&&this.options.invertTrProperty&&(s=1-s),s<1&&(n.opacity=s,n.transparent=!0)}}return this.materials[t]=new Vc(n),this.materials[t]},getTextureParams:function(t,e){var r,n={scale:new ka(1,1),offset:new ka(0,0)},i=t.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(t,e,r,n,i){var o,s=$c.Handlers.get(t);return null===s&&(s=new Kc(void 0!==this.manager?this.manager:Dc)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(t,r,n,i),void 0!==e&&(o.mapping=e),o}};var ap=function(t){this.uuid=_a.generateUUID(),this.name="",this.allows={},this.type=t,this.userData={}};ap.prototype.isNode=!0,ap.prototype.parse=function(t,e){e=e||{},t.parsing=!0;var r=t.material;this.build(t.addCache(e.cache,e.requires).addSlot(e.slot),"v4"),r.clearVertexNode(),r.clearFragmentNode(),t.removeCache().removeSlot(),t.parsing=!1},ap.prototype.parseAndBuildCode=function(t,e,r){return this.parse(t,r=r||{}),this.buildCode(t,e,r)},ap.prototype.buildCode=function(t,e,r){var n=t.material,i={result:this.build(t.addCache((r=r||{}).cache,r.requires).addSlot(r.slot),e)};return i.code=t.isShader("vertex")?n.clearVertexNode():n.clearFragmentNode(),t.removeCache().removeSlot(),i},ap.prototype.build=function(t,e,r){e=e||this.getType(t,e);var n=t.material,i=n.getDataNode(r||this.uuid);if(t.parsing&&this.appendDepsNode(t,i,e),!1===this.allows[t.shader])throw new Error("Shader "+shader+" is not compatible with this node.");return-1===n.nodes.indexOf(this)&&n.nodes.push(this),void 0!==this.updateFrame&&-1===n.updaters.indexOf(this)&&n.updaters.push(this),this.generate(t,e,r)},ap.prototype.appendDepsNode=function(t,e,r){e.deps=(e.deps||0)+1;var n=t.getFormatLength(r);(n>(e.outputMax||0)||this.getType(t,r))&&(e.outputMax=n,e.output=r)},ap.prototype.getType=function(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type},ap.prototype.getJSONNode=function(t){if(void 0!==t&&"string"!=typeof t&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]},ap.prototype.createJSONNode=function(t){var e=void 0===t||"string"==typeof t,r={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return r.uuid=this.uuid,r.type=this.nodeType+"Node",""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e||(t.nodes[this.uuid]=r),r},ap.prototype.toJSON=function(t){return this.getJSONNode(t)||this.createJSONNode(t)};var lp=function(t,e){ap.call(this,t),this.shared=void 0===(e=e||{}).shared||e.shared,this.unique=void 0!==e.unique&&e.unique};(lp.prototype=Object.create(ap.prototype)).constructor=lp,lp.prototype.build=function(t,e,r,n){e=e||this.getType(t);var i=t.material;if(this.isShared(t,e)){var o=this.isUnique(t,e);o&&void 0===this.constructor.uuid&&(this.constructor.uuid=_a.generateUUID()),r=t.getUuid(r||this.getUuid(),!o);var s=i.getDataNode(r);if(t.parsing)return s.deps?(this.appendDepsNode(t,s,e),this.generate(t,l,r)):ap.prototype.build.call(this,t,e,r);if(o)return s.name=s.name||ap.prototype.build.call(this,t,e,r),s.name;if(!t.optimize||1==s.deps)return ap.prototype.build.call(this,t,e,r);r=this.getUuid(!1);var a=this.getTemp(t,r),l=s.output||this.getType(t);if(a)return t.format(a,l,e);a=lp.prototype.generate.call(this,t,e,r,s.output,n);var c=this.generate(t,l,r);return t.isShader("vertex")?i.addVertexNode(a+"="+c+";"):i.addFragmentNode(a+"="+c+";"),t.format(a,l,e)}return ap.prototype.build.call(this,t,e,r)},lp.prototype.isShared=function(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared},lp.prototype.isUnique=function(t,e){return this.unique},lp.prototype.getUuid=function(t){var e=(t||void 0==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e},lp.prototype.getTemp=function(t,e){e=e||this.uuid;var r=t.material;return t.isShader("vertex")&&r.vertexTemps[e]?r.vertexTemps[e].name:r.fragmentTemps[e]?r.fragmentTemps[e].name:void 0},lp.prototype.generate=function(t,e,r,n,i){return this.isShared(t,e)||console.error("TempNode is not shared!"),r=r||this.uuid,t.isShader("vertex")?t.material.getVertexTemp(r,n||this.getType(t),i).name:t.material.getFragmentTemp(r,n||this.getType(t),i).name};var cp=function(t,e,r,n){t=t||"",this.isMethod="string"!=typeof e,this.useKeywords=!0,lp.call(this,this.isMethod?null:e),this.isMethod?this.eval(t,e,r,n):this.eval(t,r,n)};cp.rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i,cp.rProperties=/[a-z_0-9]+/gi,(cp.prototype=Object.create(lp.prototype)).constructor=cp,cp.prototype.eval=function(t,e,r,n){if(t=(t||"").trim(),this.includes=e||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){var i=t.match(cp.rDeclaration);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(cp.rProperties);if(o)for(var s=0;s<o.length;){var a,l,c=o[s++];"in"==c||"out"==c||"inout"==c?a=o[s++]:(a=c,c=""),l=o[s++],this.inputs.push({name:l,type:a,qualifier:c})}}else this.type="",this.name=""}this.value=t};var up={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,r){this.keywords[t]={callback:e,cache:r=void 0===r||r}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!=this.nodes[t]},containsKeyword:function(t){return void 0!=this.keywords[t]}},hp=function(t){lp.call(this,"v2",{shared:!1}),this.index=t||0};hp.vertexDict=["uv","uv2"],hp.fragmentDict=["vUv","vUv2"],(hp.prototype=Object.create(lp.prototype)).constructor=hp,hp.prototype.nodeType="UV",hp.prototype.generate=function(t,e){var r;return t.material.requires.uv[this.index]=!0,r=t.isShader("vertex")?hp.vertexDict[this.index]:hp.fragmentDict[this.index],t.format(r,this.getType(t),e)},hp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var dp=function(t){lp.call(this,"v3"),this.scope=t||dp.LOCAL};dp.LOCAL="local",dp.WORLD="world",dp.VIEW="view",dp.PROJECTION="projection",dp.prototype=Object.create(lp.prototype),dp.prototype.constructor=dp,dp.prototype.nodeType="Position",dp.prototype.getType=function(t){switch(this.scope){case dp.PROJECTION:return"v4"}return this.type},dp.prototype.isShared=function(t){switch(this.scope){case dp.LOCAL:case dp.WORLD:return!1}return!0},dp.prototype.generate=function(t,e){var r,n=t.material;switch(this.scope){case dp.LOCAL:n.requires.position=!0,r=t.isShader("vertex")?"transformed":"vPosition";break;case dp.WORLD:n.requires.worldPosition=!0,t.isShader("vertex"),r="vWPosition";break;case dp.VIEW:r=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case dp.PROJECTION:r=t.isShader("vertex")?"(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))":"vec4( 0.0 )"}return t.format(r,this.getType(t),e)},dp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var pp=function(t){lp.call(this,"v3"),this.scope=t||pp.LOCAL};pp.LOCAL="local",pp.WORLD="world",pp.VIEW="view",pp.prototype=Object.create(lp.prototype),pp.prototype.constructor=pp,pp.prototype.nodeType="Normal",pp.prototype.isShared=function(t){switch(this.scope){case pp.WORLD:return!0}return!1},pp.prototype.generate=function(t,e){var r,n=t.material;switch(this.scope){case pp.LOCAL:n.requires.normal=!0,r=t.isShader("vertex")?"normal":"vObjectNormal";break;case pp.WORLD:n.requires.worldNormal=!0,r=t.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case pp.VIEW:r="vNormal"}return t.format(r,this.getType(t),e)},pp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var fp=function(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,lp.call(this,t,e),this.readonly=!1};(fp.prototype=Object.create(lp.prototype)).constructor=fp,fp.prototype.isReadonly=function(t){return this.readonly},fp.prototype.generate=function(t,e,r,n,i,o){var s=t.material;r=t.getUuid(r||this.getUuid()),n=n||this.getType(t);var a=s.getDataNode(r);return this.isReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,r,n,i,o):t.isShader("vertex")?(a.vertex||(a.vertex=s.createVertexUniform(n,this.value,i,o)),t.format(a.vertex.name,n,e)):(a.fragment||(a.fragment=s.createFragmentUniform(n,this.value,i,o)),t.format(a.fragment.name,n,e))};var mp=function(t){fp.call(this,"fv1"),this.value=[t||0]};(mp.prototype=Object.create(fp.prototype)).constructor=mp,mp.prototype.nodeType="Float",Object.defineProperties(mp.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=t}}}),mp.prototype.generateReadonly=function(t,e,r,n,i,o){var s=this.number;return t.format(Math.floor(s)!==s?s:s+".0",n,e)},mp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var vp=function(t,e){mp.call(this),this.scale=void 0!==t?t:1,this.scope=e||vp.GLOBAL,this.timeScale=1!==this.scale};vp.GLOBAL="global",vp.LOCAL="local",vp.DELTA="delta",vp.prototype=Object.create(mp.prototype),vp.prototype.constructor=vp,vp.prototype.nodeType="Timer",vp.prototype.isReadonly=function(t){return!1},vp.prototype.isUnique=function(t){return this.timeScale&&(this.scope===vp.GLOBAL||this.scope===vp.DELTA)},vp.prototype.updateFrame=function(t){var e=this.timeScale?this.scale:1;switch(this.scope){case vp.LOCAL:this.number+=t.delta*e;break;case vp.DELTA:this.number=t.delta*e;break;default:this.number=t.time*e}},vp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale),e};var gp=function(t,e){lp.call(this),this.eval(t||gp.PI,e)};gp.PI="PI",gp.PI2="PI2",gp.RECIPROCAL_PI="RECIPROCAL_PI",gp.RECIPROCAL_PI2="RECIPROCAL_PI2",gp.LOG2="LOG2",gp.EPSILON="EPSILON",gp.prototype=Object.create(lp.prototype),gp.prototype.constructor=gp,gp.prototype.nodeType="Const",gp.prototype.getType=function(t){return t.getTypeByFormat(this.type)},gp.prototype.eval=function(t,e){var r,n,i="",o=(t=(t||"").trim()).match(/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i);this.useDefine=e,o&&o.length>1?(n=o[1],r=o[2],i=o[3]):(r=t,n="fv1"),this.name=r,this.type=n,this.value=i},gp.prototype.build=function(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":void 0},gp.prototype.generate=function(t,e){return t.format(this.name,this.getType(t),e)},gp.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).name=this.name,e.out=this.type,this.value&&(e.value=this.value),!0===e.useDefine&&(e.useDefine=!0)),e},up.addKeyword("uv",function(){return new hp}),up.addKeyword("uv2",function(){return new hp(1)}),up.addKeyword("position",function(){return new dp}),up.addKeyword("worldPosition",function(){return new dp(dp.WORLD)}),up.addKeyword("normal",function(){return new pp}),up.addKeyword("worldNormal",function(){return new pp(pp.WORLD)}),up.addKeyword("viewPosition",function(){return new dp(pp.VIEW)}),up.addKeyword("viewNormal",function(){return new pp(pp.VIEW)}),up.addKeyword("time",function(){return new vp}),up.add(new gp("vec3 LUMA vec3(0.2125, 0.7154, 0.0721)")),up.add(new cp(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","\tvec3 q0 = dFdx( eye_pos );","\tvec3 q1 = dFdy( eye_pos );","\tvec2 st0 = dFdx( mUv.st );","\tvec2 st1 = dFdy( mUv.st );","\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );","\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );","\tvec3 N = normalize( surf_norm );","\tvec3 mapN = map * 2.0 - 1.0;","\tmapN.xy = scale * mapN.xy;","\tmat3 tsn = mat3( S, T, N );","\treturn normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})),up.add(new cp(["float snoise(vec2 co) {","\treturn fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n"))),up.add(new cp(["vec3 hue_rgb(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n"))),up.add(new cp(["vec3 saturation_rgb(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3(dot(rgb, LUMA));","\treturn mix(intensity, rgb, adjustment);","}"].join("\n"))),up.add(new cp(["float luminance_rgb(vec3 rgb) {","\treturn dot(rgb, LUMA);","}"].join("\n"))),up.add(new cp(["vec3 vibrance_rgb(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))),cp.prototype.isShared=function(t,e){return!this.isMethod},cp.prototype.getType=function(t){return t.getTypeByFormat(this.type)},cp.prototype.getInputByName=function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]},cp.prototype.getIncludeByName=function(t){for(var e=this.includes.length;e--;)if(this.includes[e].name===t)return this.includes[e]},cp.prototype.generate=function(t,e){for(var r,n=0,i=this.value,o=0;o<this.includes.length;o++)t.include(this.includes[o],this);for(var s in this.extensions)t.material.extensions[s]=!0;for(;r=cp.rProperties.exec(this.value);){var a=r[0],l=!this.isMethod||!this.getInputByName(a),c=a;if(this.keywords[a]||this.useKeywords&&l&&up.containsKeyword(a)){var u=this.keywords[a];if(!u){var h=up.getKeywordData(a);h.cache&&(u=t.keywords[a]),u=u||up.getKeyword(a,t),h.cache&&(t.keywords[a]=u)}c=u.build(t)}a!=c&&(i=i.substring(0,r.index+n)+c+i.substring(r.index+a.length+n),n+=c.length-a.length),void 0===this.getIncludeByName(c)&&up.contains(c)&&t.include(up.get(c))}return"source"===e?i:this.isMethod?(t.include(this,!1,i),this.name):t.format("("+i+")",this.getType(t),e)};var yp=function(t,e){lp.call(this,"v3"),this.setScope(t||yp.POSITION),this.setCamera(e)};yp.fDepthColor=new cp(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n")),yp.POSITION="position",yp.DEPTH="depth",yp.TO_VERTEX="toVertex",yp.prototype=Object.create(lp.prototype),yp.prototype.constructor=yp,yp.prototype.nodeType="Camera",yp.prototype.setCamera=function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0},yp.prototype.setScope=function(t){switch(this.scope){case yp.DEPTH:delete this.near,delete this.far}switch(this.scope=t,t){case yp.DEPTH:var e=this.camera;this.near=new mp(e?e.near:1),this.far=new mp(e?e.far:1200)}},yp.prototype.getType=function(t){switch(this.scope){case yp.DEPTH:return"fv1"}return this.type},yp.prototype.isUnique=function(t){switch(this.scope){case yp.DEPTH:case yp.TO_VERTEX:return!0}return!1},yp.prototype.isShared=function(t){switch(this.scope){case yp.POSITION:return!1}return!0},yp.prototype.generate=function(t,e){var r;switch(this.scope){case yp.POSITION:r="cameraPosition";break;case yp.DEPTH:var n=yp.fDepthColor;t.include(n),r=n.name+"("+this.near.build(t,"fv1")+","+this.far.build(t,"fv1")+")";break;case yp.TO_VERTEX:r="normalize( "+new dp(dp.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(r,this.getType(t),e)},yp.prototype.onUpdateFrame=function(t){switch(this.scope){case yp.DEPTH:var e=this.camera;this.near.number=e.near,this.far.number=e.far}},yp.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e)switch((e=this.createJSONNode(t)).scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope){case yp.DEPTH:e.near=this.near.number,e.far=this.far.number}return e},Object.assign((function(t,e){this.manager=void 0!==t?t:Dc,this.nodes={},this.materials={},this.passes={},this.names={},this.library=e||{}}).prototype,{load:function(t,e,r,n){var i=this;return new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n),this},getObjectByName:function(t){return this.names[t]},getObjectById:function(t){return this.library[t]||this.nodes[t]||this.names[t]},getNode:function(t){var e=this.getObjectById(t);return e||console.warn('Node "'+t+'" not found.'),e},parse:function(t){var e,r,n,i,o;for(e in t.nodes)r=t.nodes[e],n=new THREE[r.type],r.name?(n.name=r.name,this.names[n.name]=n):n.readonly=!0,void 0!==r.readonly&&(n.readonly=r.readonly),this.nodes[e]=n;for(e in t.materials)r=t.materials[e],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.materials[e]=n;for(e in t.passes)r=t.passes[e],n=new THREE[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.passes[e]=n;for(e in t.material&&(this.material=this.materials[e]),t.pass&&(this.pass=this.passes[e]),t.nodes)switch(n=this.nodes[e],(r=t.nodes[e]).type){case"FloatNode":n.number=r.number;break;case"ColorNode":n.value.copy(r);break;case"Vector2Node":n.x=r.x,n.y=r.y;break;case"Vector3Node":n.x=r.x,n.y=r.y,n.z=r.z;break;case"Vector4Node":n.x=r.x,n.y=r.y,n.z=r.z,n.w=r.w;break;case"Matrix3Node":case"Matrix4Node":n.value.fromArray(r.elements);break;case"OperatorNode":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.op=r.op;break;case"Math1Node":n.a=this.getNode(r.a),n.method=r.method;break;case"Math2Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.method=r.method;break;case"Math3Node":n.a=this.getNode(r.a),n.b=this.getNode(r.b),n.c=this.getNode(r.c),n.method=r.method;break;case"UVNode":case"ColorsNode":n.index=r.index;break;case"LuminanceNode":n.rgb=this.getNode(r.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":case"LightNode":n.scope=r.scope;break;case"SwitchNode":n.node=this.getNode(r.node),n.components=r.components;break;case"JoinNode":for(i in r.inputs)n[i]=this.getNode(r.inputs[i]);break;case"CameraNode":switch(n.setScope(r.scope),r.camera&&n.setCamera(this.getNode(r.camera)),r.scope){case yp.DEPTH:n.near.number=r.near,n.far.number=r.far}break;case"ColorAdjustmentNode":n.rgb=this.getNode(r.rgb),n.adjustment=this.getNode(r.adjustment),n.method=r.method;break;case"UVTransformNode":n.uv=this.getNode(r.uv),n.transform=this.getNode(r.transform);break;case"BumpNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale);break;case"BlurNode":n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.scale=this.getNode(r.scale),n.value=this.getNode(r.value),n.coord=this.getNode(r.coord),n.radius=this.getNode(r.radius),void 0!==r.size&&(n.size=new ka(r.size.x,r.size.y)),n.blurX=r.blurX,n.blurY=r.blurY;break;case"ResolutionNode":n.renderer=this.getNode(r.renderer);break;case"ScreenUVNode":n.resolution=this.getNode(r.resolution);break;case"VelocityNode":r.target&&n.setTarget(this.getNode(r.target)),n.setParams(r.params);break;case"TimerNode":n.scope=r.scope,n.scale=r.scale;break;case"ConstNode":n.name=r.name,n.type=r.out,n.value=r.value,n.useDefine=!0===r.useDefine;break;case"AttributeNode":case"VarNode":n.type=r.out;break;case"ReflectorNode":n.setMirror(this.getNode(r.mirror)),r.offset&&(n.offset=this.getNode(r.offset));break;case"NoiseNode":n.coord=this.getNode(r.coord);break;case"FunctionNode":for(i in n.isMethod=r.isMethod,n.useKeywords=r.useKeywords,n.extensions=r.extensions,n.keywords={},r.keywords)n.keywords[i]=this.getNode(r.keywords[i]);if(r.includes)for(o=0;o<r.includes.length;o++)n.includes.push(this.getNode(r.includes[o]));n.eval(r.src,n.includes,n.extensions,n.keywords),n.isMethod||(n.type=r.out);break;case"FunctionCallNode":for(i in r.inputs)n.inputs[i]=this.getNode(r.inputs[i]);n.value=this.getNode(r.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":r.value&&(n.value=this.getNode(r.value)),n.coord=this.getNode(r.coord),r.bias&&(n.bias=this.getNode(r.bias)),void 0!==n.project&&(n.project=r.project);break;case"RoughnessToBlinnExponentNode":break;case"RawNode":n.value=this.getNode(r.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":n.color=this.getNode(r.color),r.alpha&&(n.alpha=this.getNode(r.alpha)),r.specular&&(n.specular=this.getNode(r.specular)),r.shininess&&(n.shininess=this.getNode(r.shininess)),r.roughness&&(n.roughness=this.getNode(r.roughness)),r.metalness&&(n.metalness=this.getNode(r.metalness)),r.reflectivity&&(n.reflectivity=this.getNode(r.reflectivity)),r.clearCoat&&(n.clearCoat=this.getNode(r.clearCoat)),r.clearCoatRoughness&&(n.clearCoatRoughness=this.getNode(r.clearCoatRoughness)),r.normal&&(n.normal=this.getNode(r.normal)),r.normalScale&&(n.normalScale=this.getNode(r.normalScale)),r.emissive&&(n.emissive=this.getNode(r.emissive)),r.ambient&&(n.ambient=this.getNode(r.ambient)),r.shadow&&(n.shadow=this.getNode(r.shadow)),r.light&&(n.light=this.getNode(r.light)),r.ao&&(n.ao=this.getNode(r.ao)),r.environment&&(n.environment=this.getNode(r.environment)),r.environmentAlpha&&(n.environmentAlpha=this.getNode(r.environmentAlpha)),r.transform&&(n.transform=this.getNode(r.transform)),!1===r.spherical&&(n.spherical=!1);break;default:console.warn(r.type,"not supported.")}for(e in t.materials)n=this.materials[e],void 0!==(r=t.materials[e]).name&&(n.name=r.name),void 0!==r.blending&&(n.blending=r.blending),void 0!==r.flatShading&&(n.flatShading=r.flatShading),void 0!==r.side&&(n.side=r.side),n.depthFunc=r.depthFunc,n.depthTest=r.depthTest,n.depthWrite=r.depthWrite,void 0!==r.wireframe&&(n.wireframe=r.wireframe),void 0!==r.wireframeLinewidth&&(n.wireframeLinewidth=r.wireframeLinewidth),void 0!==r.wireframeLinecap&&(n.wireframeLinecap=r.wireframeLinecap),void 0!==r.wireframeLinejoin&&(n.wireframeLinejoin=r.wireframeLinejoin),void 0!==r.skinning&&(n.skinning=r.skinning),void 0!==r.morphTargets&&(n.morphTargets=r.morphTargets),void 0!==r.visible&&(n.visible=r.visible),void 0!==r.userData&&(n.userData=r.userData),n.vertex=this.getNode(r.vertex),n.fragment=this.getNode(r.fragment),n.vertex===n.fragment&&(n.node=n.vertex),n.build(),void 0!==r.fog&&(n.fog=r.fog),void 0!==r.lights&&(n.lights=r.lights),void 0!==r.transparent&&(n.transparent=r.transparent);for(e in t.passes)(n=this.passes[e]).value=this.getNode((r=t.passes[e]).value),n.build();return this.material||this.pass||this}}),function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,r=/^usemtl /;function n(t){this.manager=void 0!==t?t:Dc,this.materials=null}n.prototype={constructor:n,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setPath(this.path),o.load(t,function(t){e(i.parse(t))},r,n)},setPath:function(t){this.path=t},setMaterials:function(t){return this.materials=t,this},parse:function(n){console.time("OBJLoader");var i=new function(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseNormalIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseUVIndex:function(t,e){var r=parseInt(t,10);return 2*(r>=0?r-1:r+e/2)},addVertex:function(t,e,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(t,e,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(t,e,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[t+0],n[t+1]),i.push(n[e+0],n[e+1]),i.push(n[r+0],n[r+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,r,n,i,o,s,a,l){var c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),void 0!==n&&""!==n){var p=this.uvs.length;u=this.parseUVIndex(n,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(o,p),this.addUV(u,h,d)}if(void 0!==s&&""!==s){var f=this.normals.length;u=this.parseNormalIndex(s,f),h=s===a?u:this.parseNormalIndex(a,f),d=s===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,d)}this.colors.length>0&&this.addColor(u,h,d)},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,r=0,n=t.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(t[r],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],r));var s=0;for(o=e.length;s<o;s++)this.addUVLine(this.parseUVIndex(e[s],n))}};return t.startObject("",!1),t};-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var o=n.split("\n"),s="",a="",l=[],c="function"==typeof"".trimLeft,u=0,h=o.length;u<h;u++)if(s=o[u],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(a=s.charAt(0)))if("v"===a){var d=s.split(/\s+/);switch(d[0]){case"v":i.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&i.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":i.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":i.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===a){for(var p=s.substr(1).trim().split(/\s+/),f=[],m=0,v=p.length;m<v;m++){var g=p[m];if(g.length>0){var y=g.split("/");f.push(y)}}var x=f[0];for(m=1,v=f.length-1;m<v;m++){var b=f[m],w=f[m+1];i.addFace(x[0],b[0],w[0],x[1],b[1],w[1],x[2],b[2],w[2])}}else if("l"===a){var _=s.substring(1).trim().split(" "),S=[],T=[];if(-1===s.indexOf("/"))S=_;else for(var M=0,A=_.length;M<A;M++){var E=_[M].split("/");""!==E[0]&&S.push(E[0]),""!==E[1]&&T.push(E[1])}i.addLineGeometry(S,T)}else if("p"===a){var C=s.substr(1).trim().split(" ");i.addPointGeometry(C)}else if(null!==(l=t.exec(s))){var P=(" "+l[0].substr(1).trim()).substr(1);i.startObject(P)}else if(r.test(s))i.object.startMaterial(s.substring(7).trim(),i.materialLibraries);else if(e.test(s))i.materialLibraries.push(s.substring(7).trim());else{if("s"!==a){if("\0"===s)continue;throw new Error('OBJLoader: Unexpected line: "'+s+'"')}if((l=s.split(" ")).length>1){var O=l[1].trim().toLowerCase();i.object.smooth="0"!==O&&"off"!==O}else i.object.smooth=!0;(H=i.object.currentMaterial())&&(H.smooth=i.object.smooth)}i.finalize();var N=new Fh;for(N.materialLibraries=[].concat(i.materialLibraries),u=0,h=i.objects.length;u<h;u++){var L=i.objects[u],I=L.geometry,R=L.materials,D="Line"===I.type,F="Points"===I.type,k=!1;if(0!==I.vertices.length){var U=new $a;U.addAttribute("position",new Za(I.vertices,3)),I.normals.length>0?U.addAttribute("normal",new Za(I.normals,3)):U.computeVertexNormals(),I.colors.length>0&&(k=!0,U.addAttribute("color",new Za(I.colors,3))),I.uvs.length>0&&U.addAttribute("uv",new Za(I.uvs,2));for(var B,j=[],z=0,V=R.length;z<V;z++){var G=R[z],H=void 0;if(null!==this.materials)if(H=this.materials.create(G.name),!D||!H||H instanceof Vl){if(F&&H&&!(H instanceof Xc)){var W=new Xc({size:10,sizeAttenuation:!1});X.copy(H),H=W}}else{var X=new Vl;X.copy(H),X.lights=!1,H=X}H||((H=D?new Vl:F?new Xc({size:1,sizeAttenuation:!1}):new Vc).name=G.name),H.flatShading=!G.smooth,H.vertexColors=k?al:ol,j.push(H)}if(j.length>1){for(z=0,V=R.length;z<V;z++)U.addGroup((G=R[z]).groupStart,G.groupCount,z);B=D?new nd(U,j):F?new bh(U,j):new ql(U,j)}else B=D?new nd(U,j[0]):F?new bh(U,j[0]):new ql(U,j[0]);B.name=L.name,N.add(B)}}return console.timeEnd("OBJLoader"),N}}}(),void 0===Wd&&console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),function(){var t="2.4.0",e=Wd.Validator;function r(r){console.info("Using OBJLoader2 version: "+t),this.manager=e.verifyInput(r,Dc),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path="",this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.loaderRootNode=new Fh,this.meshBuilder=new Wd.MeshBuilder,this.callbacks=new Wd.Callbacks,this.workerSupport=new Wd.WorkerSupport,this.terminateWorkerOnLoad=!0}r.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},r.prototype.setModelName=function(t){this.modelName=e.verifyInput(t,this.modelName)},r.prototype.setPath=function(t){this.path=e.verifyInput(t,this.path)},r.prototype.setStreamMeshesTo=function(t){this.loaderRootNode=e.verifyInput(t,this.loaderRootNode)},r.prototype.setMaterials=function(t){this.meshBuilder.setMaterials(t)},r.prototype.setUseIndices=function(t){this.useIndices=!0===t},r.prototype.setDisregardNormals=function(t){this.disregardNormals=!0===t},r.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=!0===t},r.prototype._setCallbacks=function(t){e.isValid(t.onProgress)&&this.callbacks.setCallbackOnProgress(t.onProgress),e.isValid(t.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(t.onMeshAlter),e.isValid(t.onLoad)&&this.callbacks.setCallbackOnLoad(t.onLoad),e.isValid(t.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(t.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},r.prototype.onProgress=function(t,r,n){var i=e.isValid(r)?r:"",o={detail:{type:t,modelName:this.modelName,instanceNo:this.instanceNo,text:i,numericalValue:n}};e.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(o),this.logging.enabled&&this.logging.debug&&console.debug(i)},r.prototype._onError=function(t){var e="Error occurred while downloading!";throw t.currentTarget&&null!==t.currentTarget.statusText&&(e+="\nurl: "+t.currentTarget.responseURL+"\nstatus: "+t.currentTarget.statusText),this.onProgress("error",e,-1),e},r.prototype.load=function(t,e,r,n,i,o){var s=new Wd.ResourceDescriptor(t,"OBJ");this._loadObj(s,e,r,n,i,o)},r.prototype._loadObj=function(t,r,n,i,o,s){e.isValid(i)||(i=this._onError),e.isValid(t)||i("An invalid ResourceDescriptor was provided. Unable to continue!");var a=this,l=function(e){if(t.content=e,s)a.parseAsync(e,r);else{var n=new Wd.Callbacks;n.setCallbackOnMeshAlter(o),a._setCallbacks(n),r({detail:{loaderRootNode:a.parse(e),modelName:a.modelName,instanceNo:a.instanceNo}})}};if(!e.isValid(t.url)||e.isValid(t.content))l(e.isValid(t.content)?t.content:null);else{if(!e.isValid(n)){var c=0,u=0;n=function(e){if(e.lengthComputable&&(u=e.loaded/e.total)>c){c=u;var r='Download of "'+t.url+'": '+(100*u).toFixed(2)+"%";a.onProgress("progressLoad",r,u)}}}var h=new kc(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t.url,l,n,i)}},r.prototype.run=function(t,r){this._applyPrepData(t);var n=t.checkResourceDescriptorFiles(t.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);e.isValid(r)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=r,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var i=this;this._loadMtl(n.mtl,function(e){null!==e&&i.meshBuilder.setMaterials(e),i._loadObj(n.obj,i.callbacks.onLoad,null,null,i.callbacks.onMeshAlter,t.useAsync)},t.crossOrigin,t.materialOptions)},r.prototype._applyPrepData=function(t){e.isValid(t)&&(this.setLogging(t.logging.enabled,t.logging.debug),this.setModelName(t.modelName),this.setStreamMeshesTo(t.streamMeshesTo),this.meshBuilder.setMaterials(t.materials),this.setUseIndices(t.useIndices),this.setDisregardNormals(t.disregardNormals),this.setMaterialPerSmoothingGroup(t.materialPerSmoothingGroup),this._setCallbacks(t.getCallbacks()))},r.prototype.parse=function(t){if(!e.isValid(t))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var r=new n;r.setLogging(this.logging.enabled,this.logging.debug),r.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),r.setUseIndices(this.useIndices),r.setDisregardNormals(this.disregardNormals),r.setMaterials(this.meshBuilder.getMaterials());var i=this;if(r.setCallbackMeshBuilder(function(t){var e=i.meshBuilder.processPayload(t);for(var r in e)i.loaderRootNode.add(e[r])}),r.setCallbackProgress(function(t,e){i.onProgress("progressParse",t,e)}),t instanceof ArrayBuffer||t instanceof Uint8Array)this.logging.enabled&&console.info("Parsing arrayBuffer..."),r.parse(t);else{if(!("string"==typeof t||t instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logging.enabled&&console.info("Parsing text..."),r.parseText(t)}return this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},r.prototype.parseAsync=function(t,r){var i=this,o=!1,s=function(){r({detail:{loaderRootNode:i.loaderRootNode,modelName:i.modelName,instanceNo:i.instanceNo}}),o&&i.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+i.modelName)};e.isValid(t)?o=!0:(console.warn("Provided content is not a valid ArrayBuffer."),s()),o&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init(),this.workerSupport.validate(function(t,r){var i="";return i+="\n\n",i+="var LoaderSupport = {};\n\n",(i+=t("LoaderSupport.Validator",e))+r("Parser",n)},"Parser"),this.workerSupport.setCallbacks(function(t){var e=i.meshBuilder.processPayload(t);for(var r in e)i.loaderRootNode.add(e[r])},s),i.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var a={},l=this.meshBuilder.getMaterials();for(var c in l)a[c]=c;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:a},data:{input:t,options:null}})};var n=function(){function t(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}}return t.prototype.resetRawMesh=function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},t.prototype.setUseAsync=function(t){this.useAsync=t},t.prototype.setMaterialPerSmoothingGroup=function(t){this.materialPerSmoothingGroup=t},t.prototype.setUseIndices=function(t){this.useIndices=t},t.prototype.setDisregardNormals=function(t){this.disregardNormals=t},t.prototype.setMaterials=function(t){this.materials=Wd.Validator.verifyInput(t,this.materials),this.materials=Wd.Validator.verifyInput(this.materials,{})},t.prototype.setCallbackMeshBuilder=function(t){if(!Wd.Validator.isValid(t))throw'Unable to run as no "MeshBuilder" callback is set.';this.callbackMeshBuilder=t},t.prototype.setCallbackProgress=function(t){this.callbackProgress=t},t.prototype.setLogging=function(t,e){this.logging.enabled=!0===t,this.logging.debug=!0===e},t.prototype.configure=function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var t=Object.keys(this.materials),e=t.length>0?"\n\tmaterialNames:\n\t\t- "+t.join("\n\t\t- "):"\n\tmaterialNames: None";console.info("OBJLoader2.Parser configuration:"+e+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name)}},t.prototype.parse=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var e=new Uint8Array(t);this.contentRef=e;var r=e.byteLength;this.globalCounts.totalBytes=r;for(var n,i=new Array(128),o="",s=0,a=0,l=0;l<r;l++)switch(n=e[l]){case 32:o.length>0&&(i[s++]=o),o="";break;case 47:o.length>0&&(i[s++]=o),a++,o="";break;case 10:o.length>0&&(i[s++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=l,this.processLine(i,s,a),s=0,a=0;break;case 13:break;default:o+=String.fromCharCode(n)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},t.prototype.parseText=function(t){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0,this.contentRef=t;var e=t.length;this.globalCounts.totalBytes=e;for(var r,n=new Array(128),i="",o=0,s=0,a=0;a<e;a++)switch(r=t[a]){case" ":i.length>0&&(n[o++]=i),i="";break;case"/":i.length>0&&(n[o++]=i),s++,i="";break;case"\n":i.length>0&&(n[o++]=i),i="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=a,this.processLine(n,o,s),o=0,s=0;break;case"\r":break;default:i+=r}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},t.prototype.processLine=function(t,e,r){if(!(e<1)){var n,i,o,s,a=function(t,e,r,n){var i="";if(n>r){var o;if(e)for(o=r;o<n;o++)i+=t[o];else for(o=r;o<n;o++)i+=String.fromCharCode(t[o]);i=i.trim()}return i};switch(s=t[0]){case"v":this.vertices.push(parseFloat(t[1])),this.vertices.push(parseFloat(t[2])),this.vertices.push(parseFloat(t[3])),e>4&&(this.colors.push(parseFloat(t[4])),this.colors.push(parseFloat(t[5])),this.colors.push(parseFloat(t[6])));break;case"vt":this.uvs.push(parseFloat(t[1])),this.uvs.push(parseFloat(t[2]));break;case"vn":this.normals.push(parseFloat(t[1])),this.normals.push(parseFloat(t[2])),this.normals.push(parseFloat(t[3]));break;case"f":if(n=e-1,0===r)for(this.checkFaceType(0),o=2,i=n;o<i;o++)this.buildFace(t[1]),this.buildFace(t[o]),this.buildFace(t[o+1]);else if(n===2*r)for(this.checkFaceType(1),o=3,i=n-2;o<i;o+=2)this.buildFace(t[1],t[2]),this.buildFace(t[o],t[o+1]),this.buildFace(t[o+2],t[o+3]);else if(2*n==3*r)for(this.checkFaceType(2),o=4,i=n-3;o<i;o+=3)this.buildFace(t[1],t[2],t[3]),this.buildFace(t[o],t[o+1],t[o+2]),this.buildFace(t[o+3],t[o+4],t[o+5]);else for(this.checkFaceType(3),o=3,i=n-2;o<i;o+=2)this.buildFace(t[1],void 0,t[2]),this.buildFace(t[o],void 0,t[o+1]),this.buildFace(t[o+2],void 0,t[o+3]);break;case"l":case"p":if((n=e-1)==2*r)for(this.checkFaceType(4),o=1,i=n+1;o<i;o+=2)this.buildFace(t[o],t[o+1]);else for(this.checkFaceType("l"===s?5:6),o=1,i=n+1;o<i;o++)this.buildFace(t[o]);break;case"s":this.pushSmoothingGroup(t[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.rawMesh.objectName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var l=a(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==l&&this.rawMesh.activeMtlName!==l&&(this.rawMesh.activeMtlName=l,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},t.prototype.pushSmoothingGroup=function(t){var e=parseInt(t);isNaN(e)&&(e="off"===t?0:1);var r=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?e:0===e?0:1,this.rawMesh.smoothingGroup.real=e,r!==e&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},t.prototype.checkFaceType=function(t){this.rawMesh.faceType!==t&&(this.processCompletedMesh(),this.rawMesh.faceType=t,this.checkSubGroup())},t.prototype.checkSubGroup=function(){var t=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[t],Wd.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:t,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[t]=this.rawMesh.subGroupInUse)},t.prototype.buildFace=function(t,e,r){this.disregardNormals&&(r=void 0);var n=this,i=function(){var i=parseInt(t),o=3*(i>0?i-1:i+n.vertices.length/3),s=n.rawMesh.subGroupInUse.vertices;s.push(n.vertices[o++]),s.push(n.vertices[o++]),s.push(n.vertices[o]);var a=n.colors.length>0?o:null;if(null!==a){var l=n.rawMesh.subGroupInUse.colors;l.push(n.colors[a++]),l.push(n.colors[a++]),l.push(n.colors[a])}if(e){var c=parseInt(e),u=2*(c>0?c-1:c+n.uvs.length/2),h=n.rawMesh.subGroupInUse.uvs;h.push(n.uvs[u++]),h.push(n.uvs[u])}if(r){var d=parseInt(r),p=3*(d>0?d-1:d+n.normals.length/3),f=n.rawMesh.subGroupInUse.normals;f.push(n.normals[p++]),f.push(n.normals[p++]),f.push(n.normals[p])}};if(this.useIndices){var o=t+(e?"_"+e:"_n")+(r?"_"+r:"_n"),s=this.rawMesh.subGroupInUse.indexMappings[o];Wd.Validator.isValid(s)?this.rawMesh.counts.doubleIndicesCount++:(s=this.rawMesh.subGroupInUse.vertices.length/3,i(),this.rawMesh.subGroupInUse.indexMappings[o]=s,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(s)}else i();this.rawMesh.counts.faceCount++},t.prototype.createRawMeshReport=function(t){return"Input Object number: "+t+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},t.prototype.finalizeRawMesh=function(){var t,e,r=[],n=0,i=0,o=0,s=0,a=0,l=0;for(var c in this.rawMesh.subGroups)if((t=this.rawMesh.subGroups[c]).vertices.length>0){if((e=t.indices).length>0&&i>0)for(var u in e)e[u]=e[u]+i;r.push(t),n+=t.vertices.length,i+=t.indexMappingsCount,o+=t.indices.length,s+=t.colors.length,l+=t.uvs.length,a+=t.normals.length}var h=null;return r.length>0&&(h={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:r,absoluteVertexCount:n,absoluteIndexCount:o,absoluteColorCount:s,absoluteNormalCount:a,absoluteUvCount:l,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),h},t.prototype.processCompletedMesh=function(){var t=this.finalizeRawMesh();if(Wd.Validator.isValid(t)){if(this.colors.length>0&&this.colors.length!==this.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(t);var e=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*e).toFixed(2)+"%",e),this.resetRawMesh(),!0}return!1},t.prototype.buildMesh=function(t){var e=t.subGroups,r=new Float32Array(t.absoluteVertexCount);this.globalCounts.vertices+=t.absoluteVertexCount/3,this.globalCounts.faces+=t.faceCount,this.globalCounts.doubleIndicesCount+=t.doubleIndicesCount;var n,i,o,s,a,l,c=t.absoluteIndexCount>0?new Uint32Array(t.absoluteIndexCount):null,u=t.absoluteColorCount>0?new Float32Array(t.absoluteColorCount):null,h=t.absoluteNormalCount>0?new Float32Array(t.absoluteNormalCount):null,d=t.absoluteUvCount>0?new Float32Array(t.absoluteUvCount):null,p=Wd.Validator.isValid(u),f=[],m=e.length>1,v=0,g=[],y=[],x=0,b=0,w=0,_=0,S=0,T=0,M=0;for(var A in e)if(e.hasOwnProperty(A)){if(l=(n=e[A]).materialName,s=this.materials[a=this.rawMesh.faceType<4?l+(p?"_vertexColor":"")+(0===n.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial"],!Wd.Validator.isValid(o=this.materials[l])&&!Wd.Validator.isValid(s)){var E=p?"defaultVertexColorMaterial":"defaultMaterial";o=this.materials[E],this.logging.enabled&&console.warn('object_group "'+n.objectName+"_"+n.groupName+'" was defined with unresolvable material "'+l+'"! Assigning "'+E+'".'),(l=E)===a&&(s=o,a=E)}if(!Wd.Validator.isValid(s)){var C={materialNameOrg:l,materialName:a,materialProperties:{vertexColors:p?2:0,flatShading:0===n.smoothingGroup}};this.callbackMeshBuilder({cmd:"materialData",materials:{materialCloneInstructions:C}}),this.useAsync&&(this.materials[a]=C)}if(m?((i=g[a])||(i=v,g[a]=v,f.push(a),v++),y.push({start:T,count:M=this.useIndices?n.indices.length:n.vertices.length/3,index:i}),T+=M):f.push(a),r.set(n.vertices,x),x+=n.vertices.length,c&&(c.set(n.indices,b),b+=n.indices.length),u&&(u.set(n.colors,w),w+=n.colors.length),h&&(h.set(n.normals,_),_+=n.normals.length),d&&(d.set(n.uvs,S),S+=n.uvs.length),this.logging.enabled&&this.logging.debug){var P=Wd.Validator.isValid(i)?"\n\t\tmaterialIndex: "+i:"";console.debug("\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+n.groupName+"\n\t\tIndex: "+n.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+n.materialName+"\n\t\tsmoothingGroup: "+n.smoothingGroup+P+"\n\t\tobjectName: "+n.objectName+"\n\t\t#vertices: "+n.vertices.length/3+"\n\t\t#indices: "+n.indices.length+"\n\t\t#colors: "+n.colors.length/3+"\n\t\t#uvs: "+n.uvs.length/2+"\n\t\t#normals: "+n.normals.length/3)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:t.name},materials:{multiMaterial:m,materialNames:f,materialGroups:y},buffers:{vertices:r,indices:c,colors:u,normals:h,uvs:d},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[r.buffer],Wd.Validator.isValid(c)?[c.buffer]:null,Wd.Validator.isValid(u)?[u.buffer]:null,Wd.Validator.isValid(h)?[h.buffer]:null,Wd.Validator.isValid(d)?[d.buffer]:null)},t.prototype.finalizeParsing=function(){this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled&&console.info("Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount)},t}();r.prototype.loadMtl=function(t,e,r,n,i){var o=new Wd.ResourceDescriptor(t,"MTL");o.setContent(e),this._loadMtl(o,r,n,i)},r.prototype._loadMtl=function(t,r,n,i){void 0===sp&&console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.'),e.isValid(t)&&this.logging.enabled&&console.time("Loading MTL: "+t.name);var o=[],s=this,a=function(n){var i=[];if(e.isValid(n))for(var a in n.preload(),i=n.materials)i.hasOwnProperty(a)&&(o[a]=i[a]);e.isValid(t)&&s.logging.enabled&&console.timeEnd("Loading MTL: "+t.name),r(o,n)};if(e.isValid(t)&&(e.isValid(t.content)||e.isValid(t.url))){var l=new sp(this.manager);n=e.verifyInput(n,"anonymous"),l.setCrossOrigin(n),l.setPath(t.path),e.isValid(i)&&l.setMaterialOptions(i),e.isValid(t.content)?a(e.isValid(t.content)?l.parse(t.content):null):e.isValid(t.url)&&new kc(this.manager).load(t.url,function(e){t.content=e,a(l.parse(e))},this._onProgress,this._onError)}else a()}}();var xp=function(t){this.manager=void 0!==t?t:Dc,this.littleEndian=!0};xp.prototype={constructor:xp,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(r){e(i.parse(r,t))},r,n)},parse:function(t,e){var r=tu.decodeText(t),n=function(t){var e={},r=t.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(t.substr(r-1));if(e.data=n[1],e.headerLen=n[0].length+r,e.str=t.substr(0,e.headerLen),e.str=e.str.replace(/\#.*/gi,""),e.version=/VERSION (.*)/i.exec(e.str),e.fields=/FIELDS (.*)/i.exec(e.str),e.size=/SIZE (.*)/i.exec(e.str),e.type=/TYPE (.*)/i.exec(e.str),e.count=/COUNT (.*)/i.exec(e.str),e.width=/WIDTH (.*)/i.exec(e.str),e.height=/HEIGHT (.*)/i.exec(e.str),e.viewpoint=/VIEWPOINT (.*)/i.exec(e.str),e.points=/POINTS (.*)/i.exec(e.str),null!==e.version&&(e.version=parseFloat(e.version[1])),null!==e.fields&&(e.fields=e.fields[1].split(" ")),null!==e.type&&(e.type=e.type[1].split(" ")),null!==e.width&&(e.width=parseInt(e.width[1])),null!==e.height&&(e.height=parseInt(e.height[1])),null!==e.viewpoint&&(e.viewpoint=e.viewpoint[1]),null!==e.points&&(e.points=parseInt(e.points[1],10)),null===e.points&&(e.points=e.width*e.height),null!==e.size&&(e.size=e.size[1].split(" ").map(function(t){return parseInt(t,10)})),null!==e.count)e.count=e.count[1].split(" ").map(function(t){return parseInt(t,10)});else{e.count=[];for(var i=0,o=e.fields.length;i<o;i++)e.count.push(1)}e.offset={};var s=0;for(i=0,o=e.fields.length;i<o;i++)"ascii"===e.data?e.offset[e.fields[i]]=i:(e.offset[e.fields[i]]=s,s+=e.size[i]);return e.rowSize=s,e}(r),i=[],o=[],s=[];if("ascii"===n.data)for(var a=n.offset,l=r.substr(n.headerLen).split("\n"),c=0,u=l.length;c<u;c++){var h=l[c].split(" ");if(void 0!==a.x&&(i.push(parseFloat(h[a.x])),i.push(parseFloat(h[a.y])),i.push(parseFloat(h[a.z]))),void 0!==a.rgb){var d=new Float32Array([parseFloat(h[a.rgb])]),p=new DataView(d.buffer,0);s.push(p.getUint8(0)/255),s.push(p.getUint8(1)/255),s.push(p.getUint8(2)/255)}void 0!==a.normal_x&&(o.push(parseFloat(h[a.normal_x])),o.push(parseFloat(h[a.normal_y])),o.push(parseFloat(h[a.normal_z])))}if("binary_compressed"!==n.data){if("binary"===n.data){p=new DataView(t,n.headerLen),a=n.offset,c=0;for(var f=0;c<n.points;c++,f+=n.rowSize)void 0!==a.x&&(i.push(p.getFloat32(f+a.x,this.littleEndian)),i.push(p.getFloat32(f+a.y,this.littleEndian)),i.push(p.getFloat32(f+a.z,this.littleEndian))),void 0!==a.rgb&&(s.push(p.getUint8(f+a.rgb+0)/255),s.push(p.getUint8(f+a.rgb+1)/255),s.push(p.getUint8(f+a.rgb+2)/255)),void 0!==a.normal_x&&(o.push(p.getFloat32(f+a.normal_x,this.littleEndian)),o.push(p.getFloat32(f+a.normal_y,this.littleEndian)),o.push(p.getFloat32(f+a.normal_z,this.littleEndian)))}var m=new $a;i.length>0&&m.addAttribute("position",new Za(i,3)),o.length>0&&m.addAttribute("normal",new Za(o,3)),s.length>0&&m.addAttribute("color",new Za(s,3)),m.computeBoundingSphere();var v=new Xc({size:.005});s.length>0?v.vertexColors=!0:v.color.setHex(16777215*Math.random());var g=new bh(m,v),y=e.split("").reverse().join("");return y=(y=/([^\/]*)/.exec(y))[1].split("").reverse().join(""),g.name=y,g}console.error("PCDLoader: binary_compressed files are not supported")}};var bp=function(t){this.manager=void 0!==t?t:Dc};bp.prototype={constructor:bp,load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}function n(t,e){var r=parseInt(p[f].substr(t,e));if(r){var n=function(t,e){return"s"+Math.min(t,e)+"e"+Math.max(t,e)}(v,r);void 0===d[n]&&(h.push([v-1,r-1,1]),d[n]=h.length-1)}}for(var i,o,s,a,l,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},u=[],h=[],d={},p=t.split("\n"),f=0,m=p.length;f<m;f++)if("ATOM"===p[f].substr(0,4)||"HETATM"===p[f].substr(0,6))i=parseFloat(p[f].substr(30,7)),o=parseFloat(p[f].substr(38,7)),s=parseFloat(p[f].substr(46,7)),a=parseInt(p[f].substr(6,5))-1,""===(l=e(p[f].substr(76,2)).toLowerCase())&&(l=e(p[f].substr(12,2)).toLowerCase()),u[a]=[i,o,s,c[l],r(l)];else if("CONECT"===p[f].substr(0,6)){var v=parseInt(p[f].substr(6,5));n(11,5),n(16,5),n(21,5),n(26,5)}return function(){var t,e,r={geometryAtoms:new $a,geometryBonds:new $a,json:{atoms:u,bonds:h}},n=r.geometryAtoms,i=r.geometryBonds,o=[],s=[],a=[];for(t=0,e=u.length;t<e;t++){var l=u[t];o.push(l[0],l[1],l[2]),s.push(l[3][0]/255,l[3][1]/255,l[3][2]/255)}for(t=0,e=h.length;t<e;t++){var c=h[t],d=c[0],p=c[1];a.push(o[3*d+0]),a.push(o[3*d+1]),a.push(o[3*d+2]),a.push(o[3*p+0]),a.push(o[3*p+1]),a.push(o[3*p+2])}return n.addAttribute("position",new Za(o,3)),n.addAttribute("color",new Za(s,3)),i.addAttribute("position",new Za(a,3)),r}()}};var wp=function(t){this.manager=void 0!==t?t:Dc};wp.prototype={constructor:wp,load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){function e(t){var e={};for(var r in t){var n,i=t[r],o=i.type,s=i.components;switch(o){case"float32":n=new Za(i.data,s);break;case"uint8":n=new Ga(i.data,s);break;case"uint16":n=new Xa(i.data,s);break;default:console.log('PlayCanvasLoader: Array type "%s" not yet supported.',o)}e[r]=n}t._attributes=e}function r(t){var e=new $a;e.setIndex(t.indices);var r=o.vertices[t.vertices]._attributes;for(var n in r){var i=r[n];"texCoord0"===n&&(n="uv"),e.addAttribute(n,i)}t._geometry=e}function n(t){var e=o.nodes[t.node],r=o.meshes[t.mesh];void 0===e._geometries&&(e._geometries=[]),e._geometries.push(r._geometry)}function i(t){var e=new Fh,r=t._geometries;if(void 0!==r)for(var n=new Vc,i=0,o=r.length;i<o;i++)e.add(new ql(r[i],n));for(i=0,o=t.rotation.length;i<o;i++)t.rotation[i]*=Math.PI/180;e.name=t.name,e.position.fromArray(t.position),e.quaternion.setFromEuler((new Ea).fromArray(t.rotation)),e.scale.fromArray(t.scale),t._object=e}for(var o=t.model,s=0,a=o.vertices.length;s<a;s++)e(o.vertices[s]);for(s=0,a=o.meshes.length;s<a;s++)r(o.meshes[s]);for(s=0,a=o.meshInstances.length;s<a;s++)n(o.meshInstances[s]);for(s=0,a=o.nodes.length;s<a;s++)i(o.nodes[s]);for(s=0,a=o.parents.length;s<a;s++){var l=o.parents[s];-1!==l&&o.nodes[l]._object.add(o.nodes[s]._object)}return o.nodes[0]._object}};var _p=function(t){this.manager=void 0!==t?t:Dc,this.propertyNameMapping={}};_p.prototype={constructor:_p,load:function(t,e,r,n){var i=this,o=new kc(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},setPropertyNameMapping:function(t){this.propertyNameMapping=t},parse:function(t){function e(t){var e="",r=0,n=/ply([\s\S]*)end_header\s/.exec(t);null!==n&&(e=n[1],r=n[0].length);var i,o,s,a={comments:[],elements:[],headerLength:r},l=e.split("\n");function c(t,e){var r={type:t[0]};return"list"===r.type?(r.name=t[3],r.countType=t[1],r.itemType=t[2]):r.name=t[1],r.name in e&&(r.name=e[r.name]),r}for(var h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim()))switch(o=(s=d.split(/\s+/)).shift(),d=s.join(" "),o){case"format":a.format=s[0],a.version=s[1];break;case"comment":a.comments.push(d);break;case"element":void 0!==i&&a.elements.push(i),(i={}).name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push(c(s,u.propertyNameMapping));break;default:console.log("unhandled",o,s)}}return void 0!==i&&a.elements.push(i),a}function r(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t);case"float":case"double":case"float32":case"float64":return parseFloat(t)}}function n(t,e){for(var n=e.split(/\s+/),i={},o=0;o<t.length;o++)if("list"===t[o].type){for(var s=[],a=r(n.shift(),t[o].countType),l=0;l<a;l++)s.push(r(n.shift(),t[o].itemType));i[t[o].name]=s}else i[t[o].name]=r(n.shift(),t[o].type);return i}function i(t,e){var r,i={indices:[],vertices:[],normals:[],uvs:[],colors:[]},a="";null!==(r=/end_header\s([\s\S]*)$/.exec(t))&&(a=r[1]);for(var l=a.split("\n"),c=0,u=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){u>=e.elements[c].count&&(c++,u=0);var p=n(e.elements[c].properties,d);s(i,e.elements[c].name,p),u++}}return o(i)}function o(t){var e=new $a;return t.indices.length>0&&e.setIndex(t.indices),e.addAttribute("position",new Za(t.vertices,3)),t.normals.length>0&&e.addAttribute("normal",new Za(t.normals,3)),t.uvs.length>0&&e.addAttribute("uv",new Za(t.uvs,2)),t.colors.length>0&&e.addAttribute("color",new Za(t.colors,3)),e.computeBoundingSphere(),e}function s(t,e,r){if("vertex"===e)t.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&t.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&t.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&t.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===e){var n=r.vertex_indices||r.vertex_index;3===n.length?t.indices.push(n[0],n[1],n[2]):4===n.length&&(t.indices.push(n[0],n[1],n[3]),t.indices.push(n[1],n[2],n[3]))}}function a(t,e,r,n){switch(r){case"int8":case"char":return[t.getInt8(e),1];case"uint8":case"uchar":return[t.getUint8(e),1];case"int16":case"short":return[t.getInt16(e,n),2];case"uint16":case"ushort":return[t.getUint16(e,n),2];case"int32":case"int":return[t.getInt32(e,n),4];case"uint32":case"uint":return[t.getUint32(e,n),4];case"float32":case"float":return[t.getFloat32(e,n),4];case"float64":case"double":return[t.getFloat64(e,n),8]}}function l(t,e,r,n){for(var i,o={},s=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],u=(i=a(t,e+s,r[l].countType,n))[0];s+=i[1];for(var h=0;h<u;h++)i=a(t,e+s,r[l].itemType,n),c.push(i[0]),s+=i[1];o[r[l].name]=c}else i=a(t,e+s,r[l].type,n),o[r[l].name]=i[0],s+=i[1];return[o,s]}var c,u=this;if(t instanceof ArrayBuffer){var h=tu.decodeText(new Uint8Array(t)),d=e(h);c="ascii"===d.format?i(h,d):function(t,e){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},i="binary_little_endian"===e.format,a=new DataView(t,e.headerLength),c=0,u=0;u<e.elements.length;u++)for(var h=0;h<e.elements[u].count;h++)c+=(r=l(a,c,e.elements[u].properties,i))[1],s(n,e.elements[u].name,r[0]);return o(n)}(t,d)}else c=i(t,e(t));return c}};var Sp=null;function Tp(){if(null===Sp){var t=new ArrayBuffer(2),e=new Uint8Array(t),r=new Uint16Array(t);e[0]=170,e[1]=187,Sp=43707===r[0]}return Sp}var Mp=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],Ap={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function Ep(t,e,r,n,i){var o,s=e.BYTES_PER_ELEMENT;if(i===Tp()||1===s)o=new e(t,r,n);else{var a=new DataView(t,r,n*s),l=Ap[e.name],c=!i,u=0;for(o=new e(n);u<n;u++)o[u]=a[l](u*s,c)}return o}var Cp=function(t){this.manager=void 0!==t?t:Dc};Cp.prototype={constructor:Cp,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),t=t.replace(/\*/g,Tp()?"be":"le"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){console.time("PRWMLoader");var e,r,n=function(t){var e=new Uint8Array(t),r=e[0],n=e[1],i=!!(n>>7&1),o=n>>6&1,s=1==(n>>5&1),a=31&n,l=0,c=0;if(s?(l=(e[2]<<16)+(e[3]<<8)+e[4],c=(e[5]<<16)+(e[6]<<8)+e[7]):(l=e[2]+(e[3]<<8)+(e[4]<<16),c=e[5]+(e[6]<<8)+(e[7]<<16)),0===r)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==r)throw new Error("PRWM decoder: Unsupported format version: "+r);if(!i){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==c)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var u,h,d,p,f,m,v,g,y=8,x={};for(g=0;g<a;g++){for(u="";y<e.length&&(h=e[y],y++,0!==h);)u+=String.fromCharCode(h);d=(n=e[y])>>7&1,p=1+(n>>4&3),y++,m=Ep(t,f=Mp[15&n],y=4*Math.ceil(y/4),p*l,s),y+=f.BYTES_PER_ELEMENT*p*l,x[u]={type:d,cardinality:p,values:m}}return y=4*Math.ceil(y/4),v=null,i&&(v=Ep(t,1===o?Uint32Array:Uint16Array,y,c,s)),{version:r,attributes:x,indices:v}}(t),i=Object.keys(n.attributes),o=new $a;for(r=0;r<i.length;r++)o.addAttribute(i[r],new za((e=n.attributes[i[r]]).values,e.cardinality,e.normalized));return null!==n.indices&&o.setIndex(new za(n.indices,1)),console.timeEnd("PRWMLoader"),o}},Cp.isBigEndianPlatform=function(){return Tp()};var Pp=function(t){this.manager=void 0!==t?t:Dc,this._parser=Pp.parse};Pp.prototype=Object.create(sd.prototype),Pp.prototype.constructor=Pp,Pp.parse=function(t,e){var r=new Uint32Array(t,0,13),n={buffer:t,header:r,loadMipmaps:e};return 55727696===r[0]?Pp._parseV3(n):559044176===r[11]?Pp._parseV2(n):void console.error("PVRLoader: Unknown PVR format.")},Pp._parseV3=function(t){var e,r,n=t.header,i=n[12],o=n[2],s=n[6],a=n[7],l=n[10],c=n[11];switch(o){case 0:e=2,r=35841;break;case 1:e=2,r=35843;break;case 2:e=4,r=35840;break;case 3:e=4,r=35842;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return t.dataPtr=52+i,t.bpp=e,t.format=r,t.width=a,t.height=s,t.numSurfaces=l,t.numMipmaps=c,t.isCubemap=6===l,Pp._extract(t)},Pp._parseV2=function(t){var e,r,n=t.header,i=n[0],o=n[1],s=n[2],a=n[3],l=n[12],c=255&n[4],u=n[10]>0;return 25===c?(r=u?35842:35840,e=4):24===c?(r=u?35843:35841,e=2):console.error("PVRLoader: Unknown PVR format:",c),t.dataPtr=i,t.bpp=e,t.format=r,t.width=s,t.height=o,t.numSurfaces=l,t.numMipmaps=a+1,t.isCubemap=6===l,Pp._extract(t)},Pp._extract=function(t){var e,r={mipmaps:[],width:t.width,height:t.height,format:t.format,mipmapCount:t.numMipmaps,isCubemap:t.isCubemap},n=t.buffer,i=t.dataPtr,o=t.bpp,s=t.numSurfaces,a=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),e=l*c*o/8,r.mipmaps.length=t.numMipmaps*s;for(var d=0;d<t.numMipmaps;){var p=t.width>>d,f=t.height>>d;h=f/c,(u=p/l)<2&&(u=2),h<2&&(h=2),a=u*h*e;for(var m=0;m<s;m++){var v=new Uint8Array(n,i,a);r.mipmaps[m*t.numMipmaps+d]={data:v,width:p,height:f},i+=a}d++}return r};var Op=function(t){this.manager=void 0!==t?t:Dc};Op.prototype={constructor:Op,load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){try{e(i.parse(t))}catch(t){n&&n(t)}},r,n)},parse:function(t){var e=function(t){if("string"==typeof t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=255&t.charCodeAt(r);return e.buffer||e}return t}(t);return function(t){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(n[i]!=r.getUint8(i,!1))return!0;return!1}()?function(t){for(var r,n,i,o,s,a,l,c,u=new DataView(e),h=u.getUint32(80,!0),d=!1,p=0;p<70;p++)1129270351==u.getUint32(p,!1)&&82==u.getUint8(p+4)&&61==u.getUint8(p+5)&&(d=!0,o=[],s=u.getUint8(p+6)/255,a=u.getUint8(p+7)/255,l=u.getUint8(p+8)/255,c=u.getUint8(p+9)/255);for(var f=new $a,m=[],v=[],g=0;g<h;g++){var y=84+50*g,x=u.getFloat32(y,!0),b=u.getFloat32(y+4,!0),w=u.getFloat32(y+8,!0);if(d){var _=u.getUint16(y+48,!0);0==(32768&_)?(r=(31&_)/31,n=(_>>5&31)/31,i=(_>>10&31)/31):(r=s,n=a,i=l)}for(var S=1;S<=3;S++){var T=y+12*S;m.push(u.getFloat32(T,!0)),m.push(u.getFloat32(T+4,!0)),m.push(u.getFloat32(T+8,!0)),v.push(x,b,w),d&&o.push(r,n,i)}}return f.addAttribute("position",new za(new Float32Array(m),3)),f.addAttribute("normal",new za(new Float32Array(v),3)),d&&(f.addAttribute("color",new za(new Float32Array(o),3)),f.hasColors=!0,f.alpha=c),f}():function(t){for(var e,r=new $a,n=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),a=new RegExp("normal"+o+o+o,"g"),l=[],c=[],u=new Ta;null!==(e=n.exec(t));){for(var h=0,d=0,p=e[0];null!==(e=a.exec(p));)u.x=parseFloat(e[1]),u.y=parseFloat(e[2]),u.z=parseFloat(e[3]),d++;for(;null!==(e=s.exec(p));)l.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),c.push(u.x,u.y,u.z),h++;1!==d&&console.error("STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new Za(l,3)),r.addAttribute("normal",new Za(c,3)),r}(function(t){return"string"!=typeof t?tu.decodeText(new Uint8Array(t)):t}(t))}};var Np=function(t){this.manager=void 0!==t?t:Dc};Np.prototype={constructor:Np,load:function(t,e,r,n){var i=new DOMParser;new kc(this.manager).load(t,function(t){var r=i.parseFromString(t,"image/svg+xml");e(r.documentElement)},r,n)}};var Lp=function(t){this.manager=void 0!==t?t:Dc,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};Lp.prototype={constructor:Lp,load:function(t,e,r,n){var i=this,o=void 0!==this.path?this.path:tu.extractUrlBase(t),s=new kc(this.manager);s.setResponseType("arraybuffer"),s.load(t,function(t){e(i.parse(t,o))},r,n)},parse:function(t,e){this.group=new Fh,this.position=0,this.materials=[],this.meshes=[],this.readFile(t,e);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(t,e){var r=new DataView(t),n=this.readChunk(r);if(n.id===Rp||n.id===Dp||n.id===Ip)for(var i=this.nextChunk(r,n);0!==i;){if(i===Fp){var o=this.readDWord(r);this.debugMessage("3DS file version: "+o)}else i===zp?(this.resetPosition(r),this.readMeshData(r,e)):this.debugMessage("Unknown main chunk: "+i.toString(16));i=this.nextChunk(r,n)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(t,e){for(var r=this.readChunk(t),n=this.nextChunk(t,r);0!==n;){if(n===Vp){var i=+this.readDWord(t);this.debugMessage("Mesh Version: "+i)}else if(n===Gp){var o=this.readFloat(t);this.debugMessage("Master scale: "+o),this.group.scale.set(o,o,o)}else n===uf?(this.debugMessage("Named Object"),this.resetPosition(t),this.readNamedObject(t)):n===Hp?(this.debugMessage("Material"),this.resetPosition(t),this.readMaterialEntry(t,e)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(t,r)}},readNamedObject:function(t){var e=this.readChunk(t),r=this.readString(t,64);e.cur=this.position;for(var n=this.nextChunk(t,e);0!==n;){if(n===hf){this.resetPosition(t);var i=this.readMesh(t);i.name=r,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(t,e)}this.endChunk(e)},readMaterialEntry:function(t,e){for(var r=this.readChunk(t),n=this.nextChunk(t,r),i=new Vc;0!==n;){if(n===Wp)i.name=this.readString(t,64),this.debugMessage("   Name: "+i.name);else if(n===Kp)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===$p){var o=this.readByte(t);i.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(n===Jp)i.side=il,this.debugMessage("   DoubleSided");else if(n===Qp)this.debugMessage("   Additive Blending"),i.blending=2;else if(n===qp)this.debugMessage("   Diffuse Color"),i.color=this.readColor(t);else if(n===Yp)this.debugMessage("   Specular Color"),i.specular=this.readColor(t);else if(n===Xp)this.debugMessage("   Ambient color"),i.color=this.readColor(t);else if(n===Zp){var s=this.readWord(t);i.shininess=s,this.debugMessage("   Shininess : "+s)}else n===tf?(this.debugMessage("   ColorMap"),this.resetPosition(t),i.map=this.readMap(t,e)):n===rf?(this.debugMessage("   BumpMap"),this.resetPosition(t),i.bumpMap=this.readMap(t,e)):n===ef?(this.debugMessage("   OpacityMap"),this.resetPosition(t),i.alphaMap=this.readMap(t,e)):n===nf?(this.debugMessage("   SpecularMap"),this.resetPosition(t),i.specularMap=this.readMap(t,e)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(t,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(t){var e=this.readChunk(t),r=this.nextChunk(t,e),n=null,i=[],o=new ql(n=new Ba,new Vc);for(o.name="mesh";0!==r;){if(r===df){var s=this.readWord(t);this.debugMessage("   Vertex: "+s);for(var a=0;a<s;a++)n.vertices.push(new Ta(this.readFloat(t),this.readFloat(t),this.readFloat(t)))}else if(r===pf)this.resetPosition(t),this.readFaceArray(t,o);else if(r===mf){var l=this.readWord(t);for(this.debugMessage("   UV: "+l),i=[],a=0;a<l;a++)i.push(new ka(this.readFloat(t),this.readFloat(t)))}else if(r===vf){this.debugMessage("   Tranformation Matrix (TODO)");var c=[];for(a=0;a<12;a++)c[a]=this.readFloat(t);var u=new Sa;u.elements[0]=c[0],u.elements[1]=c[6],u.elements[2]=c[3],u.elements[3]=c[9],u.elements[4]=c[2],u.elements[5]=c[8],u.elements[6]=c[5],u.elements[7]=c[11],u.elements[8]=c[1],u.elements[9]=c[7],u.elements[10]=c[4],u.elements[11]=c[10],u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,u.transpose();var h=new Sa;h.getInverse(u,!0),n.applyMatrix(h),u.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(t,e)}if(this.endChunk(e),i.length>0){var d=[];for(a=0;a<n.faces.length;a++)d.push([i[n.faces[a].a],i[n.faces[a].b],i[n.faces[a].c]]);n.faceVertexUvs[0]=d}return n.computeVertexNormals(),o},readFaceArray:function(t,e){var r=this.readChunk(t),n=this.readWord(t);this.debugMessage("   Faces: "+n);for(var i=0;i<n;++i)e.geometry.faces.push(new Ra(this.readWord(t),this.readWord(t),this.readWord(t))),this.readWord(t);for(;this.position<r.end;){if((r=this.readChunk(t)).id===ff){this.debugMessage("      Material Group"),this.resetPosition(t);var o=this.readMaterialGroup(t),s=this.materials[o.name];void 0!==s&&(e.material=s,""===s.name&&(s.name=e.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(t,e){var r=this.readChunk(t),n=this.nextChunk(t,r),i={},o=new Kc(this.manager);for(o.setPath(e);0!==n;){if(n===of){var s=this.readString(t,128);i=o.load(s),this.debugMessage("      File: "+e+s)}else n===lf?(i.offset.x=this.readFloat(t),this.debugMessage("      OffsetX: "+i.offset.x)):n===cf?(i.offset.y=this.readFloat(t),this.debugMessage("      OffsetY: "+i.offset.y)):n===sf?(i.repeat.x=this.readFloat(t),this.debugMessage("      RepeatX: "+i.repeat.x)):n===af?(i.repeat.y=this.readFloat(t),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(t,r)}return this.endChunk(r),i},readMaterialGroup:function(t){this.readChunk(t);var e=this.readString(t,64),r=this.readWord(t);this.debugMessage("         Name: "+e),this.debugMessage("         Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(t));return{name:e,index:n}},readColor:function(t){var e=this.readChunk(t),r=new Ia;if(e.id===Up||e.id===Bp){var n=this.readByte(t),i=this.readByte(t),o=this.readByte(t);r.setRGB(n/255,i/255,o/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else e.id===kp||e.id===jp?(n=this.readFloat(t),i=this.readFloat(t),o=this.readFloat(t),r.setRGB(n,i,o),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)):this.debugMessage("      Unknown color chunk: "+e.toString(16));return this.endChunk(e),r},readChunk:function(t){var e={};return e.cur=this.position,e.id=this.readWord(t),e.size=this.readDWord(t),e.end=e.cur+e.size,e.cur+=6,e},endChunk:function(t){this.position=t.end},nextChunk:function(t,e){if(e.cur>=e.end)return 0;this.position=e.cur;try{var r=this.readChunk(t);return e.cur+=r.size,r.id}catch(t){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(t){var e=t.getUint8(this.position,!0);return this.position+=1,e},readFloat:function(t){try{var e=t.getFloat32(this.position,!0);return this.position+=4,e}catch(e){this.debugMessage(e+" "+this.position+" "+t.byteLength)}},readInt:function(t){var e=t.getInt32(this.position,!0);return this.position+=4,e},readShort:function(t){var e=t.getInt16(this.position,!0);return this.position+=2,e},readDWord:function(t){var e=t.getUint32(this.position,!0);return this.position+=4,e},readWord:function(t){var e=t.getUint16(this.position,!0);return this.position+=2,e},readString:function(t,e){for(var r="",n=0;n<e;n++){var i=this.readByte(t);if(!i)break;r+=String.fromCharCode(i)}return r},setPath:function(t){return this.path=t,this},debugMessage:function(t){this.debug&&console.log(t)}};var Ip=19789,Rp=15786,Dp=49725,Fp=2,kp=16,Up=17,Bp=18,jp=19,zp=15677,Vp=15678,Gp=256,Hp=45055,Wp=40960,Xp=40976,qp=40992,Yp=41008,Zp=41024,Jp=41089,Qp=41091,Kp=41093,$p=41095,tf=41472,ef=41488,rf=41520,nf=41476,of=41728,sf=41812,af=41814,lf=41816,cf=41818,uf=16384,hf=16640,df=16656,pf=16672,ff=16688,mf=16704,vf=16736,gf=function(t){this.manager=void 0!==t?t:Dc,this.reversed=!1};gf.prototype={constructor:gf,load:function(t,e,r,n){var i=this,o=new kc(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t){var e,r=[];t.forEach(function(t){"m"===t.type.toLowerCase()?r.push(e=[t]):"z"!==t.type.toLowerCase()&&e.push(t)});var n=[];return r.forEach(function(t){n.push(i={type:"m",x:t[t.length-1].x,y:t[t.length-1].y});for(var e=t.length-1;e>0;e--){var r=t[e],i={type:r.type};void 0!==r.x2&&void 0!==r.y2?(i.x1=r.x2,i.y1=r.y2,i.x2=r.x1,i.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(i.x1=r.x1,i.y1=r.y1),i.x=t[e-1].x,i.y=t[e-1].y,n.push(i)}}),n}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(t,r){for(var n=Math.round,i={},o=1e5/(72*(t.unitsPerEm||2048)),s=0;s<t.glyphs.length;s++){var a=t.glyphs.glyphs[s];if(void 0!==a.unicode){var l={ha:n(a.advanceWidth*o),x_min:n(a.xMin*o),x_max:n(a.xMax*o),o:""};r&&(a.path.commands=e(a.path.commands)),a.path.commands.forEach(function(t,e){"c"===t.type.toLowerCase()&&(t.type="b"),l.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(l.o+=n(t.x*o)+" "+n(t.y*o)+" "),void 0!==t.x1&&void 0!==t.y1&&(l.o+=n(t.x1*o)+" "+n(t.y1*o)+" "),void 0!==t.x2&&void 0!==t.y2&&(l.o+=n(t.x2*o)+" "+n(t.y2*o)+" ")}),i[String.fromCharCode(a.unicode)]=l}}return{glyphs:i,familyName:t.familyName,ascender:n(t.ascender*o),descender:n(t.descender*o),underlinePosition:t.tables.post.underlinePosition,underlineThickness:t.tables.post.underlineThickness,boundingBox:{xMin:t.tables.head.xMin,xMax:t.tables.head.xMax,yMin:t.tables.head.yMin,yMax:t.tables.head.yMax},resolution:1e3,original_font_information:t.tables.name}}(opentype.parse(t),this.reversed)}};var yf=function(){};yf.prototype.load=function(t,e,r){this.downloadModelJson(t,e,r)},(yf.BufferGeometryCreator=function(){}).prototype.create=function(t,e){var r,n,i=e.length/3,o=new $a,s=new Float32Array(3*i*3),a=new Float32Array(3*i*3),l=new Float32Array(3*i*2),c=t.length;for(n=0,r=0;r<c;r+=8)s[n++]=t[r],s[n++]=t[r+1],s[n++]=t[r+2];for(n=0,r=3;r<c;r+=8)l[n++]=t[r],l[n++]=t[r+1];for(n=0,r=5;r<c;r+=8)a[n++]=t[r],a[n++]=t[r+1],a[n++]=t[r+2];return o.setIndex(new za(e,1)),o.addAttribute("position",new za(s,3)),o.addAttribute("normal",new za(a,3)),o.addAttribute("uv",new za(l,2)),o.computeBoundingSphere(),o};var xf={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};function bf(t,e,r){(new kc).load(t,e,r)}yf.prototype.decompressAttribsInner_=function(t,e,r,n,i,o,s,a){for(var l=0,c=e;c<r;c++){var u=t.charCodeAt(c);n[i]=a*((l+=u>>1^-(1&u))+s),i+=o}},yf.prototype.decompressIndices_=function(t,e,r,n,i){for(var o=0,s=0;s<r;s++){var a=t.charCodeAt(e++);n[i++]=o-a,0===a&&o++}},yf.prototype.decompressAABBs_=function(t,e,r,n,i){for(var o=6*r,s=e+o,a=0,l=new Float32Array(o),c=e;c<s;c+=6){var u=t.charCodeAt(c+0)+n[0],h=t.charCodeAt(c+1)+n[1],d=t.charCodeAt(c+2)+n[2],p=t.charCodeAt(c+3)+1>>1,f=t.charCodeAt(c+4)+1>>1,m=t.charCodeAt(c+5)+1>>1;l[a++]=i[0]*(u+p),l[a++]=i[1]*(h+f),l[a++]=i[2]*(d+m),l[a++]=i[0]*p,l[a++]=i[1]*f,l[a++]=i[2]*m}return l},yf.prototype.decompressMesh=function(t,e,r,n,i,o){for(var s=r.decodeScales.length,a=r.decodeOffsets,l=r.decodeScales,c=e.attribRange[1],u=e.attribRange[0],h=new Float32Array(s*c),d=0;d<s;d++){var p=u+c,f=l[d];f&&this.decompressAttribsInner_(t,u,p,h,d,s,a[d],f),u=p}var m=3*e.indexRange[1],v=new Uint16Array(m);this.decompressIndices_(t,u,m,v,0);var g=void 0,y=e.bboxes;y&&(g=this.decompressAABBs_(t,y,e.names.length,a,l)),o(n,i,h,v,g,e)},yf.prototype.copyAttrib=function(t,e,r,n){for(var i=0;i<t;i++)r[i]=e[t*n+i]},yf.prototype.decodeAttrib2=function(t,e,r,n,i,o,s,a,l,c){for(var u=0;u<5;u++){var h=t.charCodeAt(i+o*u+c);l[u]+=h>>1^-(1&h),a[e*c+u]=l[u],s[e*c+u]=n[u]*(l[u]+r[u])}},yf.prototype.accumulateNormal=function(t,e,r,n,i){var o=n[8*t],s=n[8*t+1],a=n[8*t+2],l=n[8*e],c=n[8*e+1],u=n[8*e+2],h=n[8*r],d=n[8*r+1],p=n[8*r+2];c-=s,d-=s,s=(u-=a)*(h-=o)-(l-=o)*(p-=a),a=l*d-c*h,i[3*t]+=o=c*p-u*d,i[3*t+1]+=s,i[3*t+2]+=a,i[3*e]+=o,i[3*e+1]+=s,i[3*e+2]+=a,i[3*r]+=o,i[3*r+1]+=s,i[3*r+2]+=a},yf.prototype.decompressMesh2=function(t,e,r,n,i,o){for(var s=r.decodeScales.length,a=r.decodeOffsets,l=r.decodeScales,c=e.attribRange[0],u=e.attribRange[1],h=e.codeRange[0],d=3*e.codeRange[2],p=new Uint16Array(d),f=new Int32Array(3*u),m=new Uint16Array(s),v=new Uint16Array(s*u),g=new Float32Array(s*u),y=0,x=0,b=0;b<d;b+=3){var w=t.charCodeAt(h++),_=Math.min(b,96);if(w<_){var S,T,M,A=w%3,E=b-(w-A);switch(A){case 0:S=p[E+2],T=p[E+1],M=p[E+0];break;case 1:S=p[E+0],T=p[E+2],M=p[E+1];break;case 2:S=p[E+1],T=p[E+0],M=p[E+2]}p[x++]=S,p[x++]=T;var C=y-(w=t.charCodeAt(h++));if(p[x++]=C,0===w){for(var P=0;P<5;P++){var O=t.charCodeAt(c+u*P+y),N=(O>>1^-(1&O))+v[s*S+P]+v[s*T+P]-v[s*M+P];m[P]=N,v[s*y+P]=N,g[s*y+P]=l[P]*(N+a[P])}y++}else this.copyAttrib(s,v,m,C);this.accumulateNormal(S,T,C,v,f)}else{var L=y-(w-_);p[x++]=L,w===_?this.decodeAttrib2(t,s,a,l,c,u,g,v,m,y++):this.copyAttrib(s,v,m,L);var I=y-(w=t.charCodeAt(h++));p[x++]=I,0===w?this.decodeAttrib2(t,s,a,l,c,u,g,v,m,y++):this.copyAttrib(s,v,m,I);var R=y-(w=t.charCodeAt(h++));if(p[x++]=R,0===w){for(P=0;P<5;P++)m[P]=(v[s*L+P]+v[s*I+P])/2;this.decodeAttrib2(t,s,a,l,c,u,g,v,m,y++)}else this.copyAttrib(s,v,m,R);this.accumulateNormal(L,I,R,v,f)}}for(b=0;b<u;b++){var D=f[3*b],F=f[3*b+1],k=f[3*b+2],U=511/Math.sqrt(D*D+F*F+k*k),B=t.charCodeAt(c+5*u+b),j=t.charCodeAt(c+6*u+b),z=t.charCodeAt(c+7*u+b);g[s*b+5]=U*D+(B>>1^-(1&B)),g[s*b+6]=U*F+(j>>1^-(1&j)),g[s*b+7]=U*k+(z>>1^-(1&z))}o(n,i,g,p,void 0,e)},yf.prototype.downloadMesh=function(t,e,r,n,i){var o=this,s=0;bf(t,function(t){!function(t){for(;s<r.length;){var a=r[s],l=a.indexRange;if(l){if(t.length<l[0]+3*l[1])break;o.decompressMesh(t,a,n,e,s,i)}else{var c=a.codeRange;if(t.length<c[0]+c[1])break;o.decompressMesh2(t,a,n,e,s,i)}++s}}(t)})},yf.prototype.downloadMeshes=function(t,e,r,n){for(var i in e)this.downloadMesh(t+i,i,e[i],r,n)},yf.prototype.createMeshCallback=function(t,e,r){var n=0,i=0,o={},s={},a={},l=e.urls;for(var c in l)o[c]=l[c].length,s[c]=0,i++,a[c]=new Na;var u=new Na,h=new sp.MaterialCreator(t,e.options);h.setMaterials(e.materials),h.preload();var d=new yf.BufferGeometryCreator;return function(t,e,l,c,p,f){var m=new ql(d.create(l,c),h.create(f.material));a[t].add(m),s[t]++,s[t]===o[t]&&(n++,u.add(a[t]),n===i&&r(u))}},yf.prototype.downloadModel=function(t,e,r,n){var i=this.createMeshCallback(e,r,n);this.downloadMeshes(t,r.urls,r.decodeParams,i)},yf.prototype.downloadModelJson=function(t,e,r){!function(t,e){bf(t,function(t){e(JSON.parse(t))},function(){})}(t,(function(n){n.decodeParams||(n.decodeParams=r&&r.decodeParams?r.decodeParams:xf),n.options=r;var i=t.substr(0,t.lastIndexOf("/")+1),o=i;r&&r.geometryBase&&"/"!==(i=r.geometryBase).charAt(i.length-1)&&(i+="/"),r&&r.materialBase&&"/"!==(o=r.materialBase).charAt(o.length-1)&&(o+="/"),this.downloadModel(i,o,n,e)}).bind(this))};var wf=function(t){this.manager=void 0!==t?t:Dc};function _f(t){Na.call(this),this.material=t,this.render=function(){}}wf.prototype={constructor:wf,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(t,e,r,n){var i=this;new kc(this.manager).load(t,function(t){e(i.parse(t))},r,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=this.texturePath||"",r=new Kc(this.manager);r.setCrossOrigin(this.crossOrigin);for(var n=new _c,i=t.split("\n"),o=i.length-1;o>-1;o--){var s=i[o];if(/{.*[{\[]/.test(s))(a=s.split("{").join("{\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a);else if(/\].*}/.test(s)){var a;(a=s.split("]").join("]\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a)}/}.*}/.test(s)&&((a=s.split("}").join("}\n").split("\n")).unshift(1),a.unshift(o),i.splice.apply(i,a)),/^\b[^\s]+\b$/.test(s.trim())?(i[o+1]=s+" "+i[o+1].trim(),i.splice(o,1)):s.indexOf("coord")>-1&&s.indexOf("[")<0&&s.indexOf("{")<0&&(i[o]+=" Coordinate {}")}var l=i.shift();return/V1.0/.exec(l)?console.warn("VRMLLoader: V1.0 not supported yet."):/V2.0/.exec(l)&&function(t,n){var i={},o=/(\b|\-|\+)([\d\.e]+)/,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,a=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;function l(t,e,r,n,i){for(var o=!0===i?1:-1,s=[],a={},l={},c=0;c<r.length;c++){var u={x:o*(Math.cos(r[c])*e),y:o*(Math.sin(r[c])*e)};s.push(u)}for(var h=t.index,d=t.attributes.position,p=new za(new Float32Array(3*t.attributes.position.count),3),f=new Ta,m=new Ia,v=0;v<h.count;v++){var g=h.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<n.length;y++)if(0===y?(a.x=0,a.y=!0===i?e:-1*e):(a.x=s[y-1].x,a.y=s[y-1].y),void 0!==(l=s[y]))if(1==(!0===i?f.y<=a.y&&f.y>l.y:f.y>=a.y&&f.y<l.y)){var x=n[y],b=n[y+1],w=Math.abs(f.y-a.y)/(a.y-l.y);m.copy(x).lerp(b,w),p.setXYZ(g,m.r,m.g,m.b)}else{var _=n[!0===i?n.length-1:0];p.setXYZ(g,_.r,_.g,_.b)}}t.addAttribute("color",p)}var c=[];function u(t,e){for(var r,n,i,l=[],u={},h=/[^\s,\[\]]+/g;null!==(r=h.exec(e));)l.push(r[0]);switch(n=l[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=n,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=n,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=n,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=n,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(l.length>0)for(var d=0;d<l.length;d++)/(-?\d+)/.test(l[d])&&("-1"===l[d]?(c.length>0&&this.indexes.push(c),c=[]):c.push(parseInt(l[d])));/]/.exec(e)&&(c.length>0&&this.indexes.push(c),c=[],this.isRecordingFaces=!1,t[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==t.nodeType)for(;null!==(l=a.exec(e));)i={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])},this.points.push(i);if("TextureCoordinate"==t.nodeType)for(;null!==(l=s.exec(e));)i={x:parseFloat(l[1]),y:parseFloat(l[2])},this.points.push(i);/]/.exec(e)&&(this.isRecordingPoints=!1,t.points=this.points)}else if(this.isRecordingAngles){if(l.length>0)for(d=0;d<l.length;d++)o.test(l[d])&&this.angles.push(parseFloat(l[d]));/]/.exec(e)&&(this.isRecordingAngles=!1,t[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(l=a.exec(e));){var p={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};this.colors.push(p)}/]/.exec(e)&&(this.isRecordingColors=!1,t[this.recordingFieldname]=this.colors)}else if("NULL"!==l[l.length-1]&&"children"!==n){switch(n){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==l.length){console.warn("VRMLLoader: Invalid color format detected for %s.",n);break}u={r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==l.length){console.warn("VRMLLoader: Invalid vector format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==l.length){console.warn("VRMLLoader: Invalid single float value specification detected for %s.",n);break}u=parseFloat(l[1]);break;case"rotation":if(5!==l.length){console.warn("VRMLLoader: Invalid quaternion format detected for %s.",n);break}u={x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3]),w:parseFloat(l[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==l.length){console.warn("VRMLLoader: Invalid format detected for %s.",n);break}u="TRUE"===l[1]}t[n]=u}return u}!function t(o,s){var a;if("string"!=typeof o){a=s,o.string.indexOf("AmbientLight")>-1&&"PointLight"===o.nodeType&&(o.nodeType="AmbientLight");var c=void 0===o.on||o.on,u=void 0!==o.intensity?o.intensity:1,h=new Ia;if(o.color&&h.copy(o.color),"AmbientLight"===o.nodeType)(a=new rd(h,u)).visible=c,s.add(a);else if("PointLight"===o.nodeType){var d=0;void 0!==o.radius&&o.radius<1e3&&(d=o.radius),(a=new Yh(h,u,d)).visible=c,s.add(a)}else if("SpotLight"===o.nodeType){u=1,d=0;var p=Math.PI/3;c=!0,void 0!==o.radius&&o.radius<1e3&&(d=o.radius),void 0!==o.cutOffAngle&&(p=o.cutOffAngle),(a=new Kh(h,u,d,p,0)).visible=c,s.add(a)}else if("Transform"===o.nodeType||"Group"===o.nodeType){if(a=new Na,/DEF/.exec(o.string)&&(a.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[a.name]=a),void 0!==o.translation&&a.position.set((G=o.translation).x,G.y,G.z),void 0!==o.rotation){var f=o.rotation;a.quaternion.setFromAxisAngle(new Ta(f.x,f.y,f.z),f.w)}void 0!==o.scale&&a.scale.set((B=o.scale).x,B.y,B.z),s.add(a)}else if("Shape"===o.nodeType)a=new ql,/DEF/.exec(o.string)&&(a.name=/DEF\s+([^\s]+)/.exec(o.string)[1],i[a.name]=a),s.add(a);else if("Background"===o.nodeType){var m=2e4,v=new el(m,20,20),g=new zl({fog:!1,side:nl});if(o.skyColor.length>1)l(v,m,o.skyAngle,o.skyColor,!0),g.vertexColors=al;else{var y=o.skyColor[0];g.color.setRGB(y.r,y.b,y.g)}if(n.add(new ql(v,g)),void 0!==o.groundColor){var x=new el(m=12e3,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),b=new zl({fog:!1,side:nl,vertexColors:al});l(x,m,o.groundAngle,o.groundColor,!1),n.add(new ql(x,b))}}else{if(/geometry/.exec(o.string)){if("Box"===o.nodeType)s.geometry=new $l((B=o.size).x,B.y,B.z);else if("Cylinder"===o.nodeType)s.geometry=new ec(o.radius,o.radius,o.height);else if("Cone"===o.nodeType)s.geometry=new ec(o.topRadius,o.bottomRadius,o.height);else if("Sphere"===o.nodeType)s.geometry=new el(o.radius);else if("IndexedFaceSet"===o.nodeType){var w,_,S,T,M,A=new $a,E=[],C=[];for(k=0,S=o.children.length;k<S;k++){if("TextureCoordinate"===(U=o.children[k]).nodeType&&U.points)for(T=0,M=U.points.length;T<M;T++)C.push((_=U.points[T]).x,_.y);if("Coordinate"===U.nodeType){if(U.points)for(T=0,M=U.points.length;T<M;T++)E.push((w=U.points[T]).x,w.y,w.z);if(U.string.indexOf("DEF")>-1){var P=/DEF\s+([^\s]+)/.exec(U.string)[1];i[P]=E.slice(0)}U.string.indexOf("USE")>-1&&(X=/USE\s+([^\s]+)/.exec(U.string)[1],E=i[X])}}var O=0;if(o.coordIndex){var N=[],L=[];for(w=new Ta,_=new ka,k=0,S=o.coordIndex.length;k<S;k++){var I=o.coordIndex[k];for(O=0;I.length>=3&&O<I.length-2;){void 0===o.ccw&&(o.ccw=!0);var R=I[0],D=I[O+(o.ccw?1:2)],F=I[O+(o.ccw?2:1)];w.fromArray(E,3*R),_.fromArray(C,2*R),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*D),_.fromArray(C,2*D),N.push(w.x,w.y,w.z),L.push(_.x,_.y),w.fromArray(E,3*F),_.fromArray(C,2*F),N.push(w.x,w.y,w.z),L.push(_.x,_.y),O++}}E=N,C=L}else s.parent.remove(s);!1===o.solid&&(s.material.side=il),A.solid=o.solid,A.addAttribute("position",new Za(E,3)),C.length>0&&A.addAttribute("uv",new Za(C,2)),A.computeVertexNormals(),A.computeBoundingSphere(),/DEF/.exec(o.string)&&(A.name=/DEF ([^\s]+)/.exec(o.string)[1],i[A.name]=A),s.geometry=A}return}if(/appearance/.exec(o.string)){for(var k=0;k<o.children.length;k++){var U;if("Material"===(U=o.children[k]).nodeType){var B,j=new Vc;if(void 0!==U.diffuseColor){var z=U.diffuseColor;j.color.setRGB(z.r,z.g,z.b)}if(void 0!==U.emissiveColor){var V=U.emissiveColor;j.emissive.setRGB(V.r,V.g,V.b)}if(void 0!==U.specularColor&&j.specular.setRGB((B=U.specularColor).r,B.g,B.b),void 0!==U.transparency){var G=U.transparency;j.opacity=Math.abs(1-G),j.transparent=!0}/DEF/.exec(o.string)&&(j.name=/DEF ([^\s]+)/.exec(o.string)[1],i[j.name]=j),s.material=j}if("ImageTexture"===U.nodeType){var H=/"([^"]+)"/.exec(U.children[0]);H&&(s.material.name=H[1],s.material.map=r.load(e+H[1]))}}return}}k=0;for(var W=o.children.length;k<W;k++)t(o.children[k],a)}else if(/USE/.exec(o)){var X=/USE\s+?([^\s]+)/.exec(o)[1];void 0==i[X]?console.warn("VRMLLoader: %s is not defined.",X):/appearance/.exec(o)&&X?s.material=i[X].clone():/geometry/.exec(o)&&X?(s.geometry=i[X].clone(),void 0!==i[X].solid&&!1===i[X].solid&&(s.geometry.solid=!1,s.material.side=il)):X&&(a=i[X].clone(),s.add(a))}}(function(t){for(var e,r,n={string:"Scene",children:[]},i=n,o=0;o<t.length;o++){var s="",a=t[o];if(null===/^\s+?$/g.exec(a)&&""!==(a=a.trim())){if(/#/.exec(a)){var l=a.split("#");a=l[0],s=l[1]}if(e=/([^\s]*){1}(?:\s+)?{/.exec(a)){var c={nodeType:e[1],string:a,parent:i,children:[],comment:s};i.children.push(c),i=c,/}/.exec(a)&&(r=/{(.*)}/.exec(a)[1],c.children.push(r),u(i,r),i=i.parent)}else/}/.exec(a)?i=i.parent:""!==a&&(u(i,a),i.children.push(a))}}return n}(t),n)}(i,n),n}},Object.assign((function(t){this.manager=void 0!==t?t:Dc}).prototype,Aa.prototype,{load:function(t,e,r,n){var i=this,o=new kc(i.manager);o.setResponseType("arraybuffer"),o.load(t,function(t){e(i.parse(t))},r,n)},parse:function(t){function e(t,e){var r=t.length,n=new Float32Array(r+e.length);return n.set(t),n.set(e,r),n}function r(t,e){var r=t.length,n=new Int32Array(r+e.length);return n.set(t),n.set(e,r),n}function n(t){for(var e="",r=new Uint8Array(t),n=0,i=r.length;i--;)e+=String.fromCharCode(r[n++]);return e}var i=tu.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(t){function n(t){var e,r,n,i,o,s,a="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(e=0;e<h;e++)l[e]=u[e];for(e=0;e<h;++e)c[u.charCodeAt(e)]=e;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=new a(3*h/4-(o="="===t[h-2]?2:"="===t[h-1]?1:0)),n=o>0?h-4:h;var d=0;for(e=0,r=0;e<n;e+=4,r+=3)i=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],s[d++]=(16711680&i)>>16,s[d++]=(65280&i)>>8,s[d++]=255&i;return 2===o?(i=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,s[d++]=255&i):1===o&&(i=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,s[d++]=i>>8&255,s[d++]=255&i),s}function i(t,i){var o=0;if("UInt64"===s.attributes.header_type?o=8:"UInt32"===s.attributes.header_type&&(o=4),"binary"===t.attributes.format&&i){var a,l,c,u,h,d;if("Float32"===t.attributes.type)var p=new Float32Array;else"Int64"===t.attributes.type&&(p=new Int32Array);l=(a=n(t["#text"]))[0];for(var f=1;f<o-1;f++)l|=a[f]<<f*o;for(u=(l+3)*o,(h=[]).push(d=u+=u%3>0?3-u%3:0),c=3*o,f=0;f<l;f++){for(var m=a[f*o+c],v=1;v<o-1;v++)m|=a[f*o+c+v]<<8*v;h.push(d+=m)}for(f=0;f<h.length-1;f++)g=(g=new Zlib.Inflate(a.slice(h[f],h[f+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?p=e(p,g=new Float32Array(g)):"Int64"===t.attributes.type&&(p=r(p,g=new Int32Array(g)));delete t["#text"],"Float32"===t.attributes.type?"binary"===t.attributes.format&&(i||(p=p.filter(function(t,e){if(0!==e)return!0}))):"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(i||(p=p.filter(function(t,e){if(0!==e)return!0})),p=p.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||i)if(t["#text"])var g=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else g=new Int32Array(0).buffer;else g=(g=n(t["#text"])).slice(o).buffer;delete t["#text"],"Float32"===t.attributes.type?p=new Float32Array(g):"Int32"===t.attributes.type?p=new Int32Array(g):"Int64"===t.attributes.type&&(p=new Int32Array(g),"binary"===t.attributes.format&&(p=p.filter(function(t,e){if(e%2!=1)return!0})))}return p}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(t,"text/xml")}catch(t){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(t){o=null}}var s=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var s,a=e.childNodes.item(o),l=a.nodeName;"undefined"==typeof r[l]?""!==(s=t(a))&&(r[l]=s):("undefined"==typeof r[l].push&&(r[l]=[r[l]]),""!==(s=t(a))&&r[l].push(s))}return r}(o.documentElement),a=[],l=[],c=[];if(s.PolyData){for(var u=s.PolyData.Piece,h=s.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],p=0,f=d.length;p<f;){var m=u[d[p]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var v=m.DataArray;else v=[m.DataArray];for(var g=0,y=v.length;g<y;)"#text"in v[g]&&v[g]["#text"].length>0&&(v[g].text=i(v[g],h)),g++;switch(d[p]){case"PointData":var x=parseInt(u.attributes.NumberOfPoints),b=m.attributes.Normals;if(x>0)for(var w=0,_=v.length;w<_;w++)if(b===v[w].attributes.Name){var S=v[w].attributes.NumberOfComponents;(l=new Float32Array(x*S)).set(v[w].text,0)}break;case"Points":(x=parseInt(u.attributes.NumberOfPoints))>0&&(S=m.DataArray.attributes.NumberOfComponents,(a=new Float32Array(x*S)).set(m.DataArray.text,0));break;case"Strips":var T=parseInt(u.attributes.NumberOfStrips);if(T>0){var M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length);M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0);var E=T+M.length;c=new Uint32Array(3*E-9*T);var C=0;for(w=0,_=T;w<_;w++){for(var P=[],O=0,N=A[w],L=0;O<N-L;O++)P.push(M[O]),w>0&&(L=A[w-1]);var I=0;for(N=A[w],L=0;I<N-L-2;I++)I%2?(c[C++]=P[I],c[C++]=P[I+2],c[C++]=P[I+1]):(c[C++]=P[I],c[C++]=P[I+1],c[C++]=P[I+2]),w>0&&(L=A[w-1])}}break;case"Polys":var R=parseInt(u.attributes.NumberOfPolys);if(R>0){M=new Int32Array(m.DataArray[0].text.length),A=new Int32Array(m.DataArray[1].text.length),M.set(m.DataArray[0].text,0),A.set(m.DataArray[1].text,0),E=R+M.length,c=new Uint32Array(3*E-9*R),C=0;var D=0;for(w=0,_=R,L=0;w<_;){var F=[];for(O=0,N=A[w];O<N-L;)F.push(M[D++]),O++;for(I=1;I<N-L-1;)c[C++]=F[0],c[C++]=F[I],c[C++]=F[I+1],I++;L=A[++w-1]}}}}p++}var k=new $a;return k.setIndex(new za(c,1)),k.addAttribute("position",new za(a,3)),l.length===a.length&&k.addAttribute("normal",new za(l,3)),k}}(n(t)):i[2].includes("ASCII")?function(t){var e,r,n=[],i=[],o=[],s=[],a=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,c=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,x=!1,b=!1,w=!1,_=!1,S=t.split("\n");for(var T in S){var M=S[T];if(v)for(;null!==(e=a.exec(M));){var A=parseFloat(e[1]),E=parseFloat(e[2]),C=parseFloat(e[3]);i.push(A,E,C)}else if(g){if(null!==(e=l.exec(M))){var P=parseInt(e[1]),O=e[2].split(/\s+/);if(P>=3)for(var N=parseInt(O[0]),L=1,I=0;I<P-2;++I)R=parseInt(O[L]),D=parseInt(O[L+1]),n.push(N,R,D),L++}}else if(y){if(null!==(e=l.exec(M))){var R,D;if(P=parseInt(e[1]),O=e[2].split(/\s+/),P>=3)for(I=0;I<P-2;I++)I%2==1?(N=parseInt(O[I]),R=parseInt(O[I+2]),D=parseInt(O[I+1]),n.push(N,R,D)):(N=parseInt(O[I]),R=parseInt(O[I+1]),D=parseInt(O[I+2]),n.push(N,R,D))}}else if(x||b)if(w)for(;null!==(e=a.exec(M));){var F=parseFloat(e[1]),k=parseFloat(e[2]),U=parseFloat(e[3]);o.push(F,k,U)}else if(_)for(;null!==(e=a.exec(M));){var B=parseFloat(e[1]),j=parseFloat(e[2]),z=parseFloat(e[3]);s.push(B,j,z)}null!==u.exec(M)?(g=!0,v=!1,y=!1):null!==c.exec(M)?(g=!1,v=!0,y=!1):null!==h.exec(M)?(g=!1,v=!1,y=!0):null!==d.exec(M)?(x=!0,v=!1,g=!1,y=!1):null!==p.exec(M)?(b=!0,v=!1,g=!1,y=!1):null!==f.exec(M)?(w=!0,_=!1,v=!1,g=!1,y=!1):null!==m.exec(M)&&(_=!0,w=!1,v=!1,g=!1,y=!1)}var V="point";if(o.length===n.length&&(V="cell"),"point"===V)(r=new $a).setIndex(new za(new Uint32Array(n),1)),r.addAttribute("position",new za(new Float32Array(i),3)),o.length===i.length&&r.addAttribute("color",new za(new Float32Array(o),3)),s.length===i.length&&r.addAttribute("normal",new za(new Float32Array(s),3));else{r=new Ba;var G=n.length/3,H=i.length/3;for(I=0;I<H;++I)r.vertices.push(new Ta(A=i[3*I+0],E=i[3*I+1],C=i[3*I+2]));for(T=0;T<G;++T)r.faces.push(new Ra(n[3*T+0],n[3*T+1],n[3*T+2]));if(o.length===3*G)for(T=0;T<G;++T)F=o[3*T+0],k=o[3*T+1],U=o[3*T+2],r.faces[T].color=(new Ia).setRGB(F,k,U)}return r}(n(t)):function(t){var e,r,n,i,o,s,a,l=new Uint8Array(t),c=new DataView(t),u=[],h=[],d=[],p=0;function f(t,e){for(var r=e,n=t[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=t[++r];return{start:e,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(a=(s=f(l,p)).parsedString).indexOf("POINTS")){for(e=4*(i=parseInt(a.split(" ")[1],10))*3,u=new Float32Array(3*i),r=s.next,n=0;n<i;n++)u[3*n]=c.getFloat32(r,!1),u[3*n+1]=c.getFloat32(r+4,!1),u[3*n+2]=c.getFloat32(r+8,!1),r+=12;s.next=s.next+e+1}else if(0===a.indexOf("TRIANGLE_STRIPS")){var m=parseInt(a.split(" ")[1],10);e=4*(b=parseInt(a.split(" ")[2],10)),d=new Uint32Array(3*b-9*m);var v=0;for(r=s.next,n=0;n<m;n++){var g=c.getInt32(r,!1),y=[];for(r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(var x=0;x<g-2;x++)x%2?(d[v++]=y[x],d[v++]=y[x+2],d[v++]=y[x+1]):(d[v++]=y[x],d[v++]=y[x+1],d[v++]=y[x+2])}s.next=s.next+e+1}else if(0===a.indexOf("POLYGONS")){var b;for(m=parseInt(a.split(" ")[1],10),e=4*(b=parseInt(a.split(" ")[2],10)),d=new Uint32Array(3*b-9*m),v=0,r=s.next,n=0;n<m;n++){for(g=c.getInt32(r,!1),y=[],r+=4,o=0;o<g;o++)y.push(c.getInt32(r,!1)),r+=4;for(x=1;x<g-1;x++)d[v++]=y[0],d[v++]=y[x],d[v++]=y[x+1]}s.next=s.next+e+1}else if(0===a.indexOf("POINT_DATA")){for(i=parseInt(a.split(" ")[1],10),s=f(l,s.next),e=4*i*3,h=new Float32Array(3*i),r=s.next,n=0;n<i;n++)h[3*n]=c.getFloat32(r,!1),h[3*n+1]=c.getFloat32(r+4,!1),h[3*n+2]=c.getFloat32(r+8,!1),r+=12;s.next=s.next+e}if((p=s.next)>=l.byteLength)break}var w=new $a;return w.setIndex(new za(d,1)),w.addAttribute("position",new za(u,3)),h.length===u.length&&w.addAttribute("normal",new za(h,3)),w}(t)}}),(_f.prototype=Object.create(Na.prototype)).constructor=_f,_f.prototype.isImmediateRenderObject=!0;var Sf=function(t,e,r,n){_f.call(this,e);var i=this,o=new Float32Array(36),s=new Float32Array(36);function a(t,e,r){return t+(e-t)*r}function l(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n+d*i.delta,o[e+1]=l,o[e+2]=c,s[e+0]=a(p[t+0],p[t+3],d),s[e+1]=a(p[t+1],p[t+4],d),s[e+2]=a(p[t+2],p[t+5],d)}function c(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n,o[e+1]=l+d*i.delta,o[e+2]=c;var f=t+3*i.yd;s[e+0]=a(p[t+0],p[f+0],d),s[e+1]=a(p[t+1],p[f+1],d),s[e+2]=a(p[t+2],p[f+2],d)}function u(t,e,r,n,l,c,u,h){var d=(r-u)/(h-u),p=i.normal_cache;o[e+0]=n,o[e+1]=l,o[e+2]=c+d*i.delta;var f=t+3*i.zd;s[e+0]=a(p[t+0],p[f+0],d),s[e+1]=a(p[t+1],p[f+1],d),s[e+2]=a(p[t+2],p[f+2],d)}function h(t){var e=3*t;0===i.normal_cache[e]&&(i.normal_cache[e+0]=i.field[t-1]-i.field[t+1],i.normal_cache[e+1]=i.field[t-i.yd]-i.field[t+i.yd],i.normal_cache[e+2]=i.field[t-i.zd]-i.field[t+i.zd])}function d(t,e,r,n,a,d){var f=n+1,m=n+i.yd,v=n+i.zd,g=f+i.yd,y=f+i.zd,x=n+i.yd+i.zd,b=f+i.yd+i.zd,w=0,_=i.field[n],S=i.field[f],T=i.field[m],M=i.field[g],A=i.field[v],E=i.field[y],C=i.field[x],P=i.field[b];_<a&&(w|=1),S<a&&(w|=2),T<a&&(w|=8),M<a&&(w|=4),A<a&&(w|=16),E<a&&(w|=32),C<a&&(w|=128),P<a&&(w|=64);var O=Tf[w];if(0===O)return 0;var N=i.delta,L=t+N,I=e+N,R=r+N;1&O&&(h(n),h(f),l(3*n,0,a,t,e,r,_,S)),2&O&&(h(f),h(g),c(3*f,3,a,L,e,r,S,M)),4&O&&(h(m),h(g),l(3*m,6,a,t,I,r,T,M)),8&O&&(h(n),h(m),c(3*n,9,a,t,e,r,_,T)),16&O&&(h(v),h(y),l(3*v,12,a,t,e,R,A,E)),32&O&&(h(y),h(b),c(3*y,15,a,L,e,R,E,P)),64&O&&(h(x),h(b),l(3*x,18,a,t,I,R,C,P)),128&O&&(h(v),h(x),c(3*v,21,a,t,e,R,A,C)),256&O&&(h(n),h(v),u(3*n,24,a,t,e,r,_,A)),512&O&&(h(f),h(y),u(3*f,27,a,L,e,r,S,E)),1024&O&&(h(g),h(b),u(3*g,30,a,L,I,r,M,P)),2048&O&&(h(m),h(x),u(3*m,33,a,t,I,r,T,C)),w<<=4;for(var D,F=0,k=0;-1!=Mf[w+k];)p(o,s,3*Mf[D=w+k],3*Mf[D+1],3*Mf[D+2],d),k+=3,F++;return F}function p(t,e,r,n,o,s){var a=3*i.count;if(i.positionArray[a+0]=t[r],i.positionArray[a+1]=t[r+1],i.positionArray[a+2]=t[r+2],i.positionArray[a+3]=t[n],i.positionArray[a+4]=t[n+1],i.positionArray[a+5]=t[n+2],i.positionArray[a+6]=t[o],i.positionArray[a+7]=t[o+1],i.positionArray[a+8]=t[o+2],i.normalArray[a+0]=e[r],i.normalArray[a+1]=e[r+1],i.normalArray[a+2]=e[r+2],i.normalArray[a+3]=e[n],i.normalArray[a+4]=e[n+1],i.normalArray[a+5]=e[n+2],i.normalArray[a+6]=e[o],i.normalArray[a+7]=e[o+1],i.normalArray[a+8]=e[o+2],i.enableUvs){var l=2*i.count;i.uvArray[l+0]=t[r],i.uvArray[l+1]=t[r+2],i.uvArray[l+2]=t[n],i.uvArray[l+3]=t[n+2],i.uvArray[l+4]=t[o],i.uvArray[l+5]=t[o+2]}i.enableColors&&(i.colorArray[a+0]=t[r],i.colorArray[a+1]=t[r+1],i.colorArray[a+2]=t[r+2],i.colorArray[a+3]=t[n],i.colorArray[a+4]=t[n+1],i.colorArray[a+5]=t[n+2],i.colorArray[a+6]=t[o],i.colorArray[a+7]=t[o+1],i.colorArray[a+8]=t[o+2]),i.count+=3,i.count>=i.maxCount-3&&(i.hasPositions=!0,i.hasNormals=!0,i.enableUvs&&(i.hasUvs=!0),i.enableColors&&(i.hasColors=!0),s(i))}this.enableUvs=void 0!==r&&r,this.enableColors=void 0!==n&&n,this.init=function(t){this.resolution=t,this.isolation=80,this.size=t,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(t){if(0!==this.count){for(var e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),t(this)}},this.addBall=function(t,e,r,n,i){var o=Math.sign(n);n=Math.abs(n);var s=this.size*Math.sqrt(n/i),a=r*this.size,l=e*this.size,c=t*this.size,u=Math.floor(a-s);u<1&&(u=1);var h=Math.floor(a+s);h>this.size-1&&(h=this.size-1);var d=Math.floor(l-s);d<1&&(d=1);var p=Math.floor(l+s);p>this.size-1&&(p=this.size-1);var f=Math.floor(c-s);f<1&&(f=1);var m,v,g,y,x,b,w,_,S,T,M,A=Math.floor(c+s);for(A>this.size-1&&(A=this.size-1),g=u;g<h;g++)for(x=this.size2*g,S=(_=g/this.size-r)*_,v=d;v<p;v++)for(y=x+this.size*v,T=(w=v/this.size-e)*w,m=f;m<A;m++)(M=n/(1e-6+(b=m/this.size-t)*b+T+S)-i)>0&&(this.field[y+m]+=M*o)},this.addPlaneX=function(t,e){var r,n,i,o,s,a,l=this.size,c=this.yd,u=this.zd,h=this.field,d=l*Math.sqrt(t/e);for(d>l&&(d=l),r=0;r<d;r++)if((o=t/(1e-4+(s=r/l)*s)-e)>0)for(n=0;n<l;n++)for(a=r+n*c,i=0;i<l;i++)h[u*i+a]+=o},this.addPlaneY=function(t,e){var r,n,i,o,s,a,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(t/e);for(p>c&&(p=c),n=0;n<p;n++)if((o=t/(1e-4+(s=n/c)*s)-e)>0)for(a=n*u,r=0;r<c;r++)for(l=a+r,i=0;i<c;i++)d[h*i+l]+=o},this.addPlaneZ=function(t,e){var r,n,i,o,s,a,l,c=this.size,u=this.yd,h=this.zd,d=this.field,p=c*Math.sqrt(t/e);for(p>c&&(p=c),i=0;i<p;i++)if((o=t/(1e-4+(s=i/c)*s)-e)>0)for(a=h*i,n=0;n<c;n++)for(l=a+n*u,r=0;r<c;r++)d[l+r]+=o},this.reset=function(){var t;for(t=0;t<this.size3;t++)this.normal_cache[3*t]=0,this.field[t]=0},this.render=function(t){this.begin();for(var e=this.size-2,r=1;r<e;r++)for(var n=this.size2*r,i=(r-this.halfsize)/this.halfsize,o=1;o<e;o++)for(var s=n+this.size*o,a=(o-this.halfsize)/this.halfsize,l=1;l<e;l++)d((l-this.halfsize)/this.halfsize,a,i,s+l,this.isolation,t);this.end(t)},this.generateGeometry=function(){var t=0,e=new Ba,r=[];return this.render(function(n){for(var i=0;i<n.count;i++){var o=(new Ta).fromArray(n.positionArray,3*i),s=(new Ta).fromArray(n.normalArray,3*i);e.vertices.push(o),r.push(s)}var a=n.count/3;for(i=0;i<a;i++){var l=3*(t+i),c=l+1,u=l+2,h=new Ra(l,c,u,[r[l],r[c],r[u]]);e.faces.push(h)}t+=a,n.count=0}),e},this.init(t)};(Sf.prototype=Object.create(_f.prototype)).constructor=Sf;var Tf=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Mf=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);function Af(t,e,r,n,i,o,s,a,l){Mc.call(this,t,e,r,n,i,o,s,a,l),this.needsUpdate=!0}function Ef(t){Na.call(this),this.type="Sprite",this.material=void 0!==t?t:new Zc,this.center=new ka(.5,.5)}(Af.prototype=Object.create(Mc.prototype)).constructor=Af,Ef.prototype=Object.assign(Object.create(Na.prototype),{constructor:Ef,isSprite:!0,raycast:function(){var t=new Ta,e=new Ta,r=new Ta;return function(n,i){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),r.setFromMatrixScale(this.matrixWorld);var o=r.x*r.y/4;if(!(e.distanceToSquared(t)>o)){var s=n.ray.origin.distanceTo(t);s<n.near||s>n.far||i.push({distance:s,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Na.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var Cf=function(t,e){this.lut=[],this.map=Pf[t],this.n=e,this.mapname=t;for(var r=1/this.n,n=0;n<=1;n+=r)for(var i=0;i<this.map.length-1;i++)if(n>=this.map[i][0]&&n<this.map[i+1][0]){var o=this.map[i][0],s=this.map[i+1][0],a=new Ia(16777215).setHex(this.map[i][1]),l=new Ia(16777215).setHex(this.map[i+1][1]),c=a.lerp(l,(n-o)/(s-o));this.lut.push(c)}return this.set(this)};Cf.prototype={constructor:Cf,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(t){return t instanceof Cf&&this.copy(t),this},setMin:function(t){return this.minV=t,this},setMax:function(t){return this.maxV=t,this},changeNumberOfColors:function(t){return this.n=t,new Cf(this.mapname,this.n)},changeColorMap:function(t){return this.mapname=t,new Cf(this.mapname,this.n)},copy:function(t){return this.lut=t.lut,this.mapname=t.mapname,this.map=t.map,this.n=t.n,this.minV=t.minV,this.maxV=t.maxV,this},getColor:function(t){t<=this.minV?t=this.minV:t>=this.maxV&&(t=this.maxV),t=(t-this.minV)/(this.maxV-this.minV);var e=Math.round(t*this.n);return e==this.n&&(e-=1),this.lut[e]},addColorMap:function(t,e){Pf[t]=e},setLegendOn:function(t){void 0===t&&(t={}),this.legend={},this.legend.layout=t.hasOwnProperty("layout")?t.layout:"vertical",this.legend.position=t.hasOwnProperty("position")?t.position:{x:21.5,y:8,z:5},this.legend.dimensions=t.hasOwnProperty("dimensions")?t.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new Mc(this.legend.canvas);var e=this.legend.ctx.getImageData(0,0,1,this.n),r=e.data;this.map=Pf[this.mapname];for(var n=0,i=1/this.n,o=1;o>=0;o-=i)for(var s=this.map.length-1;s>=0;s--)if(o<this.map[s][0]&&o>=this.map[s-1][0]){var a=this.map[s-1][0],l=this.map[s][0],c=new Ia(16777215).setHex(this.map[s-1][1]),u=new Ia(16777215).setHex(this.map[s][1]),h=c.lerp(u,(o-a)/(l-a));r[4*n]=Math.round(255*h.r),r[4*n+1]=Math.round(255*h.g),r[4*n+2]=Math.round(255*h.b),r[4*n+3]=255,n+=1}return this.legend.ctx.putImageData(e,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new Oc(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new zl({map:this.legend.texture,side:il}),this.legend.mesh=new ql(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(t){return!!this.legend&&this.legend.layout!=t&&("horizontal"==t||"vertical"==t)&&(this.layout=t,"horizontal"==t&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==t&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)},setLegendPosition:function(t){return this.legend.position=new Ta(t.x,t.y,t.z),this.legend},setLegendLabels:function(t,e){if(!this.legend)return!1;"function"==typeof t&&(e=t),void 0===t&&(t={}),this.legend.labels={},this.legend.labels.fontsize=t.hasOwnProperty("fontsize")?t.fontsize:24,this.legend.labels.fontface=t.hasOwnProperty("fontface")?t.fontface:"Arial",this.legend.labels.title=t.hasOwnProperty("title")?t.title:"",this.legend.labels.um=t.hasOwnProperty("um")?" [ "+t.um+" ]":"",this.legend.labels.ticks=t.hasOwnProperty("ticks")?t.ticks:0,this.legend.labels.decimal=t.hasOwnProperty("decimal")?t.decimal:2,this.legend.labels.notation=t.hasOwnProperty("notation")?t.notation:"standard";var r=document.createElement("canvas"),n=r.getContext("2d");n.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface,n.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString()),n.fillStyle="rgba(255,100,100,0.8)",n.strokeStyle="rgba(255,0,0,1)",n.lineWidth=4,n.fillStyle="rgba( 0, 0, 0, 1.0 )",n.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var i=new Af(r);i.minFilter=wl;var o=new Ef(new Zc({map:i}));if(o.scale.set(2,1,1),"vertical"==this.legend.layout&&o.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&o.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var s={},a={};if("vertical"==this.legend.layout)var l=this.legend.position.y+.36*this.legend.dimensions.height,c=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var u=this.legend.position.x+.75*this.legend.dimensions.height,h=this.legend.position.x-1.2*this.legend.dimensions.width;for(var d=0;d<this.legend.labels.ticks;d++){var p=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*d+this.minV;p=e?e(p):"scientific"==this.legend.labels.notation?p.toExponential(this.legend.labels.decimal):p.toFixed(this.legend.labels.decimal);var f=document.createElement("canvas"),m=f.getContext("2d");m.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface,m.measureText(p.toString()),m.fillStyle="rgba(255,100,100,0.8)",m.strokeStyle="rgba(255,0,0,1)",m.lineWidth=4,m.fillStyle="rgba( 0, 0, 0, 1.0 )",m.fillText(p.toString(),4,this.legend.labels.fontsize+4);var v=new Af(f);v.minFilter=wl;var g=new Ef(new Zc({map:v}));if(g.scale.set(2,1,1),"vertical"==this.legend.layout&&g.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,y=c+(p-this.minV)/(this.maxV-this.minV)*(l-c),this.legend.position.z),"horizontal"==this.legend.layout){var y=h+(p-this.minV)/(this.maxV-this.minV)*(u-h);if(this.legend.labels.ticks>5)if(d%2==0)var x=1.7;else x=2.1;else x=1.7;g.position.set(y,this.legend.position.y-this.legend.dimensions.width*x,this.legend.position.z)}var b,w=new Vl({color:0,linewidth:2}),_=[];"vertical"==this.legend.layout&&(_.push(new Ta(this.legend.position.x+.55*this.legend.dimensions.width,b=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.z)),_.push(new Ta(this.legend.position.x+.7*this.legend.dimensions.width,b,this.legend.position.z))),"horizontal"==this.legend.layout&&(_.push(new Ta(b=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((p-this.minV)/(this.maxV-this.minV)*.99),this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),_.push(new Ta(b,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z)));var S=new Yl((new $a).setFromPoints(_),w);a[d]=S,s[d]=g}}return{title:o,ticks:s,lines:a}}};var Pf={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]},Of=function(t,e){ql.call(this,t,e),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)};Of.prototype=Object.assign(Object.create(ql.prototype),{constructor:Of,createAnimation:function(t,e,r,n){var i={start:e,end:r,length:r-e+1,fps:n,duration:(r-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=i,this.animationsList.push(i)},autoCreateAnimations:function(t){for(var e,r=/([a-z]+)_?(\d+)/i,n={},i=this.geometry,o=0,s=i.morphTargets.length;o<s;o++){var a=i.morphTargets[o].name.match(r);a&&a.length>1&&(n[l=a[1]]||(n[l]={start:1/0,end:-1/0}),o<(c=n[l]).start&&(c.start=o),o>c.end&&(c.end=o),e||(e=l))}for(var l in n){var c;this.createAnimation(l,(c=n[l]).start,c.end,t)}this.firstAnimation=e},setAnimationDirectionForward:function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},setAnimationDirectionBackward:function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},setAnimationFPS:function(t,e){var r=this.animationsMap[t];r&&(r.fps=e,r.duration=(r.end-r.start)/r.fps)},setAnimationDuration:function(t,e){var r=this.animationsMap[t];r&&(r.duration=e,r.fps=(r.end-r.start)/r.duration)},setAnimationWeight:function(t,e){var r=this.animationsMap[t];r&&(r.weight=e)},setAnimationTime:function(t,e){var r=this.animationsMap[t];r&&(r.time=e)},getAnimationTime:function(t){var e=0,r=this.animationsMap[t];return r&&(e=r.time),e},getAnimationDuration:function(t){var e=-1,r=this.animationsMap[t];return r&&(e=r.duration),e},playAnimation:function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},stopAnimation:function(t){var e=this.animationsMap[t];e&&(e.active=!1)},update:function(t){for(var e=0,r=this.animationsList.length;e<r;e++){var n=this.animationsList[e];if(n.active){var i=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+_a.clamp(Math.floor(n.time/i),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%i/i;n.directionBackwards&&(a=1-a),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s):this.morphTargetInfluences[n.currentFrame]=s}}}}),Ra.prototype.set=function(t,e,r){this.a=t,this.b=e,this.c=r};var Nf=function(t,e,r,n,i,o){this.array_type=n,this.register_type=r,this.unit_size=i,this.accessors=o,this.buffer=new n(t*i),this.register=[],this.length=0,this.real_length=t,this.available_registers=e;for(var s=0;s<e;s++)this.register.push(new r)};Nf.prototype={constructor:Nf,index_to_register:function(t,e,r){var n=t*this.unit_size;if(e>=this.available_registers)throw new Error("BufferSubdivisionModifier: Not enough registers in TypedArrayHelper.");if(t>this.length)throw new Error("BufferSubdivisionModifier: Index is out of range in TypedArrayHelper.");for(var i=0;i<this.unit_size;i++)this.register[e][this.accessors[i]]=this.buffer[n+i]},resize:function(t){var e;0===t&&(t=8),t<this.length?this.buffer=this.buffer.subarray(0,this.length*this.unit_size):this.buffer.length<t*this.unit_size?((e=new this.array_type(t*this.unit_size)).set(this.buffer),this.buffer=e,this.real_length=t):((e=new this.array_type(t*this.unit_size)).set(this.buffer.subarray(0,this.length*this.unit_size)),this.buffer=e,this.real_length=t)},from_existing:function(t){this.buffer=new this.array_type(t.length),this.buffer.set(t),this.length=t.length/this.unit_size,this.real_length=this.length},push_element:function(t){this.length+1>this.real_length&&this.resize(2*this.real_length);for(var e=this.length*this.unit_size,r=0;r<this.unit_size;r++)this.buffer[e+r]=t[this.accessors[r]];this.length++},trim_size:function(){this.length<this.real_length&&this.resize(this.length)}};var Lf=function(t){this.subdivisions=void 0===t?1:t};Lf.prototype.modify=function(t){t instanceof Ba?(t.mergeVertices(),"undefined"==typeof t.normals&&(t.normals=[]),t=function(t){for(var e=new $a,r=new Nf(t.vertices.length,0,Ta,Float32Array,3,["x","y","z"]),n=new Nf(t.faces.length,0,Ra,Uint32Array,3,["a","b","c"]),i=new Nf(3*t.faceVertexUvs[0].length*3,0,ka,Float32Array,2,["x","y"]),o=0,s=t.vertices.length;o<s;o++)r.push_element(t.vertices[o]);for(o=0,s=t.faces.length;o<s;o++)n.push_element(t.faces[o]);for(o=0,s=t.faceVertexUvs[0].length;o<s;o++)i.push_element(t.faceVertexUvs[0][o][0]),i.push_element(t.faceVertexUvs[0][o][1]),i.push_element(t.faceVertexUvs[0][o][2]);return n.trim_size(),r.trim_size(),i.trim_size(),e.setIndex(new za(n.buffer,3)),e.addAttribute("position",new za(r.buffer,3)),e.addAttribute("uv",new za(i.buffer,2)),e}(t)):t instanceof $a||console.error("BufferSubdivisionModifier: Geometry is not an instance of BufferGeometry or Geometry");for(var e=this.subdivisions;e-- >0;)this.smooth(t);return function(t){var e=["x","y","z"],r=["x","y"],n=new Nf(0,3,Ta,Float32Array,3,e),i=new Nf(0,3,Ra,Uint32Array,3,["a","b","c"]),o=new Nf(0,3,ka,Float32Array,2,r),s=new Nf(0,3,Ta,Float32Array,3,e);n.from_existing(t.getAttribute("position").array),i.from_existing(t.index.array),o.from_existing(t.getAttribute("uv").array),function(t){var e=["x","y","z"],r=new Nf(0,5,Ta,Float32Array,3,e),n=new Nf(0,3,Ra,Uint32Array,3,["a","b","c"]);r.from_existing(t.getAttribute("position").array);var i,o=new Nf(3*r.length,4,Ta,Float32Array,3,e),s=new Nf(r.length,1,function(){this.x=0},Float32Array,1,["x"]);o.length=r.length,n.from_existing(t.index.array);for(var a=[0,0,0],l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[1]),o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),s.buffer[n.register[0].a]+=i,s.buffer[n.register[0].b]+=i,s.buffer[n.register[0].c]+=i;for(l=0,c=n.length;l<c;l++)n.index_to_register(l,0),r.index_to_register(n.register[0].a,0),r.index_to_register(n.register[0].b,1),r.index_to_register(n.register[0].c,2),o.register[0].subVectors(r.register[1],r.register[0]),o.register[1].subVectors(r.register[2],r.register[0]),o.register[3].set(0,0,0),o.register[3].x=o.register[0].y*o.register[1].z-o.register[0].z*o.register[1].y,o.register[3].y=o.register[0].z*o.register[1].x-o.register[0].x*o.register[1].z,o.register[3].z=o.register[0].x*o.register[1].y-o.register[0].y*o.register[1].x,o.register[0].cross(o.register[1]),i=Math.abs(o.register[0].length()),a[0]=i/s.buffer[n.register[0].a],a[1]=i/s.buffer[n.register[0].b],a[2]=i/s.buffer[n.register[0].c],o.buffer[3*n.register[0].a+0]+=o.register[3].x*a[0],o.buffer[3*n.register[0].a+1]+=o.register[3].y*a[0],o.buffer[3*n.register[0].a+2]+=o.register[3].z*a[0],o.buffer[3*n.register[0].b+0]+=o.register[3].x*a[1],o.buffer[3*n.register[0].b+1]+=o.register[3].y*a[1],o.buffer[3*n.register[0].b+2]+=o.register[3].z*a[1],o.buffer[3*n.register[0].c+0]+=o.register[3].x*a[2],o.buffer[3*n.register[0].c+1]+=o.register[3].y*a[2],o.buffer[3*n.register[0].c+2]+=o.register[3].z*a[2];o.trim_size(),t.addAttribute("normal",new za(o.buffer,3))}(t),s.from_existing(t.getAttribute("normal").array);for(var a=new Nf(3*i.length,3,Ta,Float32Array,3,e),l=new Nf(3*i.length,3,Ta,Float32Array,3,e),c=new Nf(3*i.length,3,ka,Float32Array,2,r),u=0,h=i.length;u<h;u++)i.index_to_register(u,0),n.index_to_register(i.register[0].a,0),n.index_to_register(i.register[0].b,1),n.index_to_register(i.register[0].c,2),a.push_element(n.register[0]),a.push_element(n.register[1]),a.push_element(n.register[2]),0!==o.length&&(o.index_to_register(3*u+0,0),o.index_to_register(3*u+1,1),o.index_to_register(3*u+2,2),c.push_element(o.register[0]),c.push_element(o.register[1]),c.push_element(o.register[2])),s.index_to_register(i.register[0].a,0),s.index_to_register(i.register[0].b,1),s.index_to_register(i.register[0].c,2),l.push_element(s.register[0]),l.push_element(s.register[1]),l.push_element(s.register[2]);return a.trim_size(),c.trim_size(),l.trim_size(),t.index=null,t.addAttribute("position",new za(a.buffer,3)),t.addAttribute("normal",new za(l.buffer,3)),0!==c.length&&t.addAttribute("uv",new za(c.buffer,2)),t}(t)};var If=function(t,e){this.a=t,this.b=e,this.faces=[],this.newEdge=null};!function(){var t=["a","b","c"],e=["x","y","z"],r=["x","y"];function n(t,e,r){return r[Math.min(t,e)+"_"+Math.max(t,e)]}function i(t,e,r,n,i,o){var s,a=Math.min(t,e),l=Math.max(t,e),c=a+"_"+l;c in n?s=n[c]:(s=new If(a,l),n[c]=s),s.faces.push(i),o[t].edges.push(s),o[e].edges.push(s)}function o(t,e){t.push_element(e)}function s(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function a(t,e,r,n){t.push_element(e),t.push_element(r),t.push_element(n)}Lf.prototype.smooth=function(l){var c,u,h,d,p,f,m,v,g,y,x,b,w;c=new Nf(0,3,Ta,Float32Array,3,e),u=new Nf(0,3,Ra,Uint32Array,3,t),h=new Nf(0,3,ka,Float32Array,2,r),c.from_existing(l.getAttribute("position").array),u.from_existing(l.index.array),h.from_existing(l.getAttribute("uv").array);var _,S,T,M,A,E,C,P=!1;"undefined"!=typeof h&&0!==h.length&&(P=!0),function(t,e,r,n){var o,s,a;for(o=0,s=t.length;o<s;o++)r[o]={edges:[]};for(o=0,s=e.length;o<s;o++)e.index_to_register(o,0),i((a=e.register[0]).a,a.b,0,n,o,r),i(a.b,a.c,0,n,o,r),i(a.c,a.a,0,n,o,r)}(c,u,b=new Array(c.length),w={});var O=(d=new Nf(2*l.getAttribute("position").array.length/3,2,Ta,Float32Array,3,e)).register[1];for(v in w){for(T=d.register[0],A=3/8,E=1/8,2!==(C=(S=w[v]).faces.length)&&(A=.5,E=0),c.index_to_register(S.a,0),c.index_to_register(S.b,1),T.addVectors(c.register[0],c.register[1]).multiplyScalar(A),O.set(0,0,0),y=0;y<C;y++){for(u.index_to_register(S.faces[y],0),M=u.register[0],x=0;x<3&&(c.index_to_register(M[t[x]],2),_=c.register[2],M[t[x]]===S.a||M[t[x]]===S.b);x++);O.add(_)}O.multiplyScalar(E),T.add(O),S.newEdge=d.length,d.push_element(T)}var N,L,I,R,D,F,k,U,B,j=d.length;for(v=0,g=c.length;v<g;v++){for(c.index_to_register(v,0,e),3===(m=(D=b[v].edges).length)?N=3/16:m>3&&(N=3/(8*m)),L=1-m*N,I=N,m<=2&&2===m&&(L=.75,I=1/8),F=c.register[0].multiplyScalar(L),O.set(0,0,0),y=0;y<m;y++)c.index_to_register(_=(R=D[y]).a!==v?R.a:R.b,1,e),O.add(c.register[1]);O.multiplyScalar(I),F.add(O),d.push_element(F,e)}p=new Nf(4*l.index.array.length/3,1,Ra,Float32Array,3,t);var z=(f=new Nf(4*l.getAttribute("uv").array.length/2,3,ka,Float32Array,2,r)).register[0],V=f.register[1],G=f.register[2],H=p.register[0];for(v=0,g=u.length;v<g;v++)if(u.index_to_register(v,0),k=n((M=u.register[0]).a,M.b,w).newEdge,U=n(M.b,M.c,w).newEdge,B=n(M.c,M.a,w).newEdge,H.set(k,U,B),o(p,H),H.set(M.a+j,k,B),o(p,H),H.set(M.b+j,U,k),o(p,H),H.set(M.c+j,B,U),o(p,H),!0===P){h.index_to_register(3*v+0,0),h.index_to_register(3*v+1,1),h.index_to_register(3*v+2,2);var W=h.register[0],X=h.register[1],q=h.register[2];z.set(s(W.x,X.x),s(W.y,X.y)),V.set(s(X.x,q.x),s(X.y,q.y)),G.set(s(W.x,q.x),s(W.y,q.y)),a(f,z,V,G),a(f,W,z,G),a(f,X,V,z),a(f,q,G,V)}p.trim_size(),d.trim_size(),f.trim_size(),l.setIndex(new za(p.buffer,3)),l.addAttribute("position",new za(d.buffer,3)),l.addAttribute("uv",new za(f.buffer,2))}}(),function(){var t=new Ta,e=new Ta;function r(t,e,r,n,i,o){this.a=n,this.b=i,this.c=o,this.v1=t,this.v2=e,this.v3=r,this.normal=new Ta,this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(t),r.addUniqueNeighbor(e)}function n(t,e){this.position=t,this.id=e,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}r.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position;t.subVectors(this.v3.position,n),e.subVectors(r,n),t.cross(e).normalize(),this.normal.copy(t)},r.prototype.hasVertex=function(t){return t===this.v1||t===this.v2||t===this.v3},r.prototype.replaceVertex=function(t,e){t===this.v1?this.v1=e:t===this.v2?this.v2=e:t===this.v3&&(this.v3=e),function(t,e){var r=t.indexOf(e);r>-1&&t.splice(r,1)}(t.faces,this),e.faces.push(this),t.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(t),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},n.prototype.addUniqueNeighbor=function(t){!function(t,e){-1===t.indexOf(e)&&t.push(e)}(this.neighbors,t)},n.prototype.removeIfNonNeighbor=function(t){var e=this.neighbors,r=this.faces,n=e.indexOf(t);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(t))return;e.splice(n,1)}}}();var Rf=function(t){this.subdivisions=void 0===t?1:t};Rf.prototype.modify=function(t){for(var e=this.subdivisions;e-- >0;)this.smooth(t);t.computeFaceNormals(),t.computeVertexNormals()},function(){var t=["a","b","c"];function e(t,e,r){return r[Math.min(t,e)+"_"+Math.max(t,e)]}function r(t,e,r,n,i,o){var s,a=Math.min(t,e),l=Math.max(t,e),c=a+"_"+l;c in n?s=n[c]:n[c]=s={a:r[a],b:r[l],newEdge:null,faces:[]},s.faces.push(i),o[t].edges.push(s),o[e].edges.push(s)}function n(t,e,r,n){t.push(new Ra(e,r,n))}function i(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function o(t,e,r,n){t.push([e.clone(),r.clone(),n.clone()])}Rf.prototype.smooth=function(s){var a,l,c,u,h,d,p,f,m,v,g,y,x,b,w=new Ta,_=[];a=s.vertices,l=s.faces;var S,T,M,A,E,C,P,O,N,L,I,R,D,F,k=void 0!==(c=s.faceVertexUvs[0])&&c.length>0;for(p in function(t,e,n,i){var o,s,a;for(o=0,s=t.length;o<s;o++)n[o]={edges:[]};for(o=0,s=e.length;o<s;o++)r((a=e[o]).a,a.b,t,i,a,n),r(a.b,a.c,t,i,a,n),r(a.c,a.a,t,i,a,n)}(a,l,g=new Array(a.length),y={}),x=[],y){for(T=y[p],M=new Ta,E=3/8,C=1/8,2!=(P=T.faces.length)&&(E=.5,C=0),M.addVectors(T.a,T.b).multiplyScalar(E),w.set(0,0,0),m=0;m<P;m++){for(A=T.faces[m],v=0;v<3&&((S=a[A[t[v]]])===T.a||S===T.b);v++);w.add(S)}w.multiplyScalar(C),M.add(w),T.newEdge=x.length,x.push(M)}for(b=[],p=0,f=a.length;p<f;p++){for(D=a[p],3==(d=(R=g[p].edges).length)?O=3/16:d>3&&(O=3/(8*d)),N=1-d*O,L=O,d<=2&&2==d&&(N=.75,L=1/8),F=D.clone().multiplyScalar(N),w.set(0,0,0),m=0;m<d;m++)w.add(S=(I=R[m]).a!==D?I.a:I.b);w.multiplyScalar(L),F.add(w),b.push(F)}u=b.concat(x);var U,B,j,z,V,G,H,W=b.length;h=[];var X=new ka,q=new ka,Y=new ka;for(p=0,f=l.length;p<f;p++)n(h,U=e((A=l[p]).a,A.b,y).newEdge+W,B=e(A.b,A.c,y).newEdge+W,j=e(A.c,A.a,y).newEdge+W),n(h,A.a,U,j),n(h,A.b,B,U),n(h,A.c,j,B),k&&(H=(z=c[p])[2],X.set(i((V=z[0]).x,(G=z[1]).x),i(V.y,G.y)),q.set(i(G.x,H.x),i(G.y,H.y)),Y.set(i(V.x,H.x),i(V.y,H.y)),o(_,X,q,Y),o(_,V,X,Y),o(_,G,q,X),o(_,H,Y,q));s.vertices=u,s.faces=h,k&&(s.faceVertexUvs[0]=_)}}();var Df=function(t,e){ql.call(this,t,e),this.type="MorphAnimMesh",this.mixer=new ep(this),this.activeAction=null};(Df.prototype=Object.create(ql.prototype)).constructor=Df,Df.prototype.setDirectionForward=function(){this.mixer.timeScale=1},Df.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},Df.prototype.playAnimation=function(t,e){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var r=gc.findByName(this,t);if(!r)throw new Error("MorphAnimMesh: animations["+t+"] undefined in .playAnimation()");var n=this.mixer.clipAction(r);n.timeScale=r.tracks.length*e/r.duration,this.activeAction=n.play()},Df.prototype.updateAnimation=function(t){this.mixer.update(t)},Df.prototype.copy=function(t){return ql.prototype.copy.call(this,t),this.mixer=new ep(this),this};var Ff=function(t){lp.call(this,"v4",{shared:!1}),this.index=t||0};Ff.vertexDict=["color","color2"],Ff.fragmentDict=["vColor","vColor2"],(Ff.prototype=Object.create(lp.prototype)).constructor=Ff,Ff.prototype.generate=function(t,e){var r;return t.material.requires.color[this.index]=!0,r=t.isShader("vertex")?Ff.vertexDict[this.index]:Ff.fragmentDict[this.index],t.format(r,this.getType(t),e)},Ff.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e};var kf=function(t){lp.call(this,"v3",{shared:!1}),this.scope=t||kf.TOTAL};kf.TOTAL="total",kf.prototype=Object.create(lp.prototype),kf.prototype.constructor=kf,kf.prototype.nodeType="Light",kf.prototype.generate=function(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.getType(t),e):(console.warn('LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.getType(t),e))},kf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Uf=function(t){lp.call(this,"v3",{unique:!0}),this.scope=t||Uf.CUBE};Uf.CUBE="cube",Uf.SPHERE="sphere",Uf.VECTOR="vector",Uf.prototype=Object.create(lp.prototype),Uf.prototype.constructor=Uf,Uf.prototype.nodeType="Reflect",Uf.prototype.getType=function(t){switch(this.scope){case Uf.SPHERE:return"v2"}return this.type},Uf.prototype.generate=function(t,e){var r;switch(this.scope){case Uf.VECTOR:t.material.addFragmentNode("vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );"),r="reflectVec";break;case Uf.CUBE:var n=new Uf(Uf.VECTOR).build(t,"v3");t.material.addFragmentNode("vec3 reflectCubeVec = vec3( -1.0 * "+n+".x, "+n+".yz );"),r="reflectCubeVec";break;case Uf.SPHERE:n=new Uf(Uf.VECTOR).build(t,"v3"),t.material.addFragmentNode("vec2 reflectSphereVec = normalize((viewMatrix * vec4("+n+", 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;"),r="reflectSphereVec"}return t.format(r,this.getType(this.type),e)},Uf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e};var Bf=function(t){lp.call(this,"v2"),this.resolution=t};(Bf.prototype=Object.create(lp.prototype)).constructor=Bf,Bf.prototype.nodeType="ScreenUV",Bf.prototype.generate=function(t,e){var r;return t.isShader("fragment")?r="(gl_FragCoord.xy/"+this.resolution.build(t,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+t.shader+" shader."),r="vec2( 0.0 )"),t.format(r,this.getType(t),e)},Bf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),e};var jf=function(t,e){ap.call(this,e),this.name=t};(jf.prototype=Object.create(ap.prototype)).constructor=jf,jf.prototype.nodeType="Attribute",jf.prototype.getAttributeType=function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type},jf.prototype.getType=function(t){var e=this.getAttributeType(t);return t.getTypeByFormat(e)},jf.prototype.generate=function(t,e){var r=this.getAttributeType(t),n=t.material.getAttribute(this.name,r);return t.format(t.isShader("vertex")?this.name:n.varying.name,this.getType(t),e)},jf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e};var zf=function(t,e){lp.call(this),this.setFunction(t,e)};(zf.prototype=Object.create(lp.prototype)).constructor=zf,zf.prototype.nodeType="FunctionCall",zf.prototype.setFunction=function(t,e){this.value=t,this.inputs=e||[]},zf.prototype.getFunction=function(){return this.value},zf.prototype.getType=function(t){return this.value.getType(t)},zf.prototype.generate=function(t,e){for(var r=this.getType(t),n=this.value,i=n.build(t,e)+"(",o=[],s=0;s<n.inputs.length;s++){var a=n.inputs[s];o.push((this.inputs[s]||this.inputs[a.name]).build(t,t.getTypeByFormat(a.type)))}return i+=o.join(",")+")",t.format(i,r,e)},zf.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){var r=this.value;if((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,r.inputs.length){e.inputs={};for(var n=0;n<r.inputs.length;n++){var i=r.inputs[n];e.inputs[i.name]=(this.inputs[n]||this.inputs[i.name]).toJSON(t).uuid}}}return e};var Vf=function(t){ap.call(this,"v4"),this.value=t};(Vf.prototype=Object.create(ap.prototype)).constructor=Vf,Vf.prototype.nodeType="Raw",Vf.prototype.generate=function(t){var e=this.value.parseAndBuildCode(t,this.type);return e.code+"\n"+("vertex"==t.shader?"gl_Position = "+e.result+";":"gl_FragColor = "+e.result+";")},Vf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e};var Gf=function(t){this.material=t,this.caches=[],this.slots=[],this.keywords={},this.parsing=!1,this.optimize=!0,this.update()};Gf.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"},Gf.constructors=["float","vec2","vec3","vec4"],Gf.elements=["x","y","z","w"],Gf.prototype={constructor:Gf,addCache:function(t,e){return this.caches.push({name:t||"",requires:e||{}}),this.update()},removeCache:function(){return this.caches.pop(),this.update()},addSlot:function(t){return this.slots.push({name:t||""}),this.update()},removeSlot:function(){return this.slots.pop(),this.update()},isCache:function(t){for(var e=this.caches.length;e--;)if(this.caches[e].name==t)return!0;return!1},isSlot:function(t){for(var e=this.slots.length;e--;)if(this.slots[e].name==t)return!0;return!1},update:function(){var t=this.caches[this.caches.length-1],e=this.slots[this.slots.length-1];return this.slot=e?e.name:"",this.cache=t?t.name:"",this.requires=t?t.requires:{},this},require:function(t,e){return this.requires[t]=e,this},include:function(t,e,r){return this.material.include(this,t,e,r),this},colorToVector:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(t){return Gf.constructors[t-1]},getFormatName:function(t){return t.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(t){return/^m/.test(t)},getFormatLength:function(t){return parseInt(this.getFormatName(t).substr(1))},getFormatFromLength:function(t){return 1==t?"fv1":"v"+t},format:function(t,e,r){switch(this.getFormatName(r+"="+e)){case"v1=v2":case"v1=v3":case"v1=v4":return t+".x";case"v1=i":return"float("+t+")";case"v2=v1":return"vec2("+t+")";case"v2=v3":case"v2=v4":return t+".xy";case"v2=i":return"vec2(float("+t+"))";case"v3=v1":return"vec3("+t+")";case"v3=v2":return"vec3("+t+",0.0)";case"v3=v4":return t+".xyz";case"v3=i":return"vec2(float("+t+"))";case"v4=v1":return"vec4("+t+")";case"v4=v2":return"vec4("+t+",0.0,1.0)";case"v4=v3":return"vec4("+t+",1.0)";case"v4=i":return"vec4(float("+t+"))";case"i=v1":return"int("+t+")";case"i=v2":case"i=v3":case"i=v4":return"int("+t+".x)"}return t},getTypeByFormat:function(t){return Gf.type[t]||t},getUuid:function(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t},getElementByIndex:function(t){return Gf.elements[t]},getIndexByElement:function(t){return Gf.elements.indexOf(t)},isShader:function(t){return this.shader==t},setShader:function(t){return this.shader=t,this}};var Hf=function(t,e){Cc.call(this),this.vertex=t||new Vf(new dp(dp.PROJECTION)),this.fragment=e||new Vf(new Wf(16711680)),this.updaters=[]};Hf.types={t:"sampler2D",tc:"samplerCube",bv1:"bool",iv1:"int",fv1:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},Hf.addShortcuts=function(t,e,r){function n(t,e){return{get:function(){return this[t][e]},set:function(r){this[t][e]=r}}}return function(){for(var i={},o=0;o<r.length;++o){var s=r[o];i[s]=n(e,s)}Object.defineProperties(t,i)}()},(Hf.prototype=Object.create(Cc.prototype)).constructor=Hf,Hf.prototype.type="NodeMaterial",Hf.prototype.updateFrame=function(t){for(var e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])},Hf.prototype.build=function(){var t,e;this.nodes=[],this.defines={},this.uniforms={},this.attributes={},this.extensions={},this.nodeData={},this.vertexUniform=[],this.fragmentUniform=[],this.vars=[],this.vertexTemps=[],this.fragmentTemps=[],this.uniformList=[],this.consts=[],this.functions=[],this.updaters=[],this.requires={uv:[],color:[],lights:this.lights,fog:this.fog},this.vertexPars="",this.fragmentPars="",this.vertexCode="",this.fragmentCode="",this.vertexNode="",this.fragmentNode="",this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>"].join("\n");var r=new Gf(this);return t=this.vertex.build(r.setShader("vertex"),"v4"),e=this.fragment.build(r.setShader("fragment"),"v4"),this.requires.uv[0]&&(this.addVertexPars("varying vec2 vUv;"),this.addFragmentPars("varying vec2 vUv;"),this.addVertexCode("vUv = uv;")),this.requires.uv[1]&&(this.addVertexPars("varying vec2 vUv2; attribute vec2 uv2;"),this.addFragmentPars("varying vec2 vUv2;"),this.addVertexCode("vUv2 = uv2;")),this.requires.color[0]&&(this.addVertexPars("varying vec4 vColor; attribute vec4 color;"),this.addFragmentPars("varying vec4 vColor;"),this.addVertexCode("vColor = color;")),this.requires.color[1]&&(this.addVertexPars("varying vec4 vColor2; attribute vec4 color2;"),this.addFragmentPars("varying vec4 vColor2;"),this.addVertexCode("vColor2 = color2;")),this.requires.position&&(this.addVertexPars("varying vec3 vPosition;"),this.addFragmentPars("varying vec3 vPosition;"),this.addVertexCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVertexPars("varying vec3 vWPosition;"),this.addFragmentPars("varying vec3 vWPosition;"),this.addVertexCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVertexPars("varying vec3 vObjectNormal;"),this.addFragmentPars("varying vec3 vObjectNormal;"),this.addVertexCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVertexPars("varying vec3 vWNormal;"),this.addFragmentPars("varying vec3 vWNormal;"),this.addVertexCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this.fog=this.requires.fog,this.lights=this.requires.lights,this.transparent=this.requires.transparent||this.blending>ll,this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,"uniform"),this.getIncludes(this.consts.vertex),this.getIncludes(this.functions.vertex),"void main(){",this.getCodePars(this.vertexTemps),t,this.vertexCode,"}"].join("\n"),this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,"uniform"),this.getIncludes(this.consts.fragment),this.getIncludes(this.functions.fragment),"void main(){",this.getCodePars(this.fragmentTemps),this.fragmentCode,e,"}"].join("\n"),this.needsUpdate=!0,this.dispose(),this},Hf.prototype.define=function(t,e){this.defines[t]=void 0==e?1:e},Hf.prototype.isDefined=function(t){return void 0!=this.defines[t]},Hf.prototype.mergeUniform=function(t){for(var e in t)this.uniforms[e]=t[e]},Hf.prototype.createUniform=function(t,e,r,n){var i={type:t,value:e,name:r||"nVu"+this.uniformList.length,needsUpdate:n};return this.uniformList.push(i),i},Hf.prototype.getVertexTemp=function(t,e,r){var n=this.vertexTemps[t];return n||(this.vertexTemps.push(n={name:r||"nVt"+this.vertexTemps.length,type:e}),this.vertexTemps[t]=n),n},Hf.prototype.getFragmentTemp=function(t,e,r){var n=this.fragmentTemps[t];return n||(this.fragmentTemps.push(n={name:r||"nVt"+this.fragmentTemps.length,type:e}),this.fragmentTemps[t]=n),n},Hf.prototype.getVar=function(t,e,r){var n=this.vars[t];if(!n){var i=r||"nVv"+this.vars.length;this.vars.push(n={name:i,type:e}),this.vars[t]=n,this.addVertexPars("varying "+e+" "+i+";"),this.addFragmentPars("varying "+e+" "+i+";")}return n},Hf.prototype.getAttribute=function(t,e){if(!this.attributes[t]){var r=this.getVar(t,e);this.addVertexPars("attribute "+e+" "+t+";"),this.addVertexCode(r.name+" = "+t+";"),this.attributes[t]={varying:r,name:t,type:e}}return this.attributes[t]},Hf.prototype.getIncludes=function(){function t(t,e){return t.deps.length-e.deps.length}return function(e){if(!e)return"";for(var r="",n=(e=e.sort(t),0);n<e.length;n++)e[n].src&&(r+=e[n].src+"\n");return r}}(),Hf.prototype.addVertexPars=function(t){this.vertexPars+=t+"\n"},Hf.prototype.addFragmentPars=function(t){this.fragmentPars+=t+"\n"},Hf.prototype.addVertexCode=function(t){this.vertexCode+=t+"\n"},Hf.prototype.addFragmentCode=function(t){this.fragmentCode+=t+"\n"},Hf.prototype.addVertexNode=function(t){this.vertexNode+=t+"\n"},Hf.prototype.clearVertexNode=function(){var t=this.vertexNode;return this.vertexNode="",t},Hf.prototype.addFragmentNode=function(t){this.fragmentNode+=t+"\n"},Hf.prototype.clearFragmentNode=function(){var t=this.fragmentNode;return this.fragmentNode="",t},Hf.prototype.getCodePars=function(t,e){e=e||"";for(var r="",n=0,i=t.length;n<i;++n){var o=t[n].type,s=t[n].name;"t"==o&&t[n].value instanceof zd&&(o="tc");var a=Hf.types[o];if(void 0==a)throw new Error("Node pars "+o+" not found.");r+=e+" "+a+" "+s+";\n"}return r},Hf.prototype.createVertexUniform=function(t,e,r,n){var i=this.createUniform(t,e,r,n);return this.vertexUniform.push(i),this.vertexUniform[i.name]=i,this.uniforms[i.name]=i,i},Hf.prototype.createFragmentUniform=function(t,e,r,n){var i=this.createUniform(t,e,r,n);return this.fragmentUniform.push(i),this.fragmentUniform[i.name]=i,this.uniforms[i.name]=i,i},Hf.prototype.getDataNode=function(t){return this.nodeData[t]=this.nodeData[t]||{}},Hf.prototype.include=function(t,e,r,n){var i;(e="string"==typeof e?up.get(e):e)instanceof cp?i=this.functions[t.shader]=this.functions[t.shader]||[]:e instanceof gp&&(i=this.consts[t.shader]=this.consts[t.shader]||[]);var o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(t,"source")),e instanceof cp&&r&&i[r.name]&&-1==i[r.name].deps.indexOf(e)&&(i[r.name].deps.push(e),e.includes&&e.includes.length)){var s=0;do{this.include(t,e.includes[s++],r)}while(s<e.includes.length)}n&&(o.src=n)},Hf.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),this.blending!==ll&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==rl&&(e.side=this.side),!0===this.transparent&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(e.morphTargets=!0),!0===this.skinning&&(e.skinning=!0),e.fog=this.fog,e.lights=this.lights,!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t};var Wf=function(t){fp.call(this,"c"),this.value=new Ia(t||0)};Wf.prototype=Object.create(fp.prototype),Wf.prototype.constructor=Wf,Wf.prototype.nodeType="Color",Hf.addShortcuts(Wf.prototype,"value",["r","g","b"]),Wf.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",n,e)},Wf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e};var Xf=function(t,e,r){fp.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new Uf,this.bias=r};(Xf.prototype=Object.create(fp.prototype)).constructor=Xf,Xf.prototype.nodeType="CubeTexture",Xf.prototype.getTexture=function(t,e){return fp.prototype.generate.call(this,t,e,this.value.uuid,"t")},Xf.prototype.generate=function(t,e){if("samplerCube"===e)return this.getTexture(t,e);var r,n=this.getTexture(t,e),i=this.coord.build(t,"v3"),o=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==o&&t.requires.bias&&(o=t.requires.bias.build(t,"fv1")),r=o?"texCubeBias("+n+","+i+","+o+")":"texCube("+n+","+i+")",t.isSlot("color")?r="mapTexelToLinear("+r+")":t.isSlot("emissive")?r="emissiveMapTexelToLinear("+r+")":t.isSlot("environment")&&(r="envMapTexelToLinear("+r+")"),t.format(r,this.type,e)},Xf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.coord=this.coord.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var qf=function(t){fp.call(this,"iv1"),this.value=[Math.floor(t||0)]};(qf.prototype=Object.create(fp.prototype)).constructor=qf,qf.prototype.nodeType="Int",Object.defineProperties(qf.prototype,{number:{get:function(){return this.value[0]},set:function(t){this.value[0]=Math.floor(t)}}}),qf.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format(this.number,n,e)},qf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).number=this.number,!0===this.readonly&&(e.readonly=!0)),e};var Yf=function(t){fp.call(this,"m3"),this.value=t||new Pa};(Yf.prototype=Object.create(fp.prototype)).constructor=Yf,Yf.prototype.nodeType="Matrix3",Yf.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("mat3( "+this.value.elements.join(", ")+" )",n,e)},Yf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Zf=function(t){fp.call(this,"m4"),this.value=t||new Sa};(Zf.prototype=Object.create(fp.prototype)).constructor=Zf,Zf.prototype.nodeType="Matrix4",Zf.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("mat4( "+this.value.elements.join(", ")+" )",n,e)},Zf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat(),!0===this.readonly&&(e.readonly=!0)),e};var Jf=function(t,e,r){lp.call(this),this.a=t,this.b=e,this.op=r||Jf.ADD};Jf.ADD="+",Jf.SUB="-",Jf.MUL="*",Jf.DIV="/",Jf.prototype=Object.create(lp.prototype),Jf.prototype.constructor=Jf,Jf.prototype.nodeType="Operator",Jf.prototype.getType=function(t){var e=this.a.getType(t),r=this.b.getType(t);return t.isFormatMatrix(e)?"v4":t.getFormatLength(r)>t.getFormatLength(e)?r:e},Jf.prototype.generate=function(t,e){t.material.getDataNode(this.uuid);var r=this.getType(t),n=this.a.build(t,r),i=this.b.build(t,r);return t.format("("+n+this.op+i+")",r,e)},Jf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e};var Qf=function(t,e,r,n){fp.call(this,"v4",{shared:!0}),this.value=t,this.coord=e||new hp,this.bias=r,this.project=void 0!==n&&n};(Qf.prototype=Object.create(fp.prototype)).constructor=Qf,Qf.prototype.nodeType="Texture",Qf.prototype.getTexture=function(t,e){return fp.prototype.generate.call(this,t,e,this.value.uuid,"t")},Qf.prototype.generate=function(t,e){if("sampler2D"===e)return this.getTexture(t,e);var r,n,i=this.getTexture(t,e),o=this.coord.build(t,this.project?"v4":"v2"),s=this.bias?this.bias.build(t,"fv1"):void 0;return void 0==s&&t.requires.bias&&(s=t.requires.bias.build(t,"fv1")),r=this.project?"texture2DProj":s?"tex2DBias":"tex2D",n=s?r+"("+i+","+o+","+s+")":r+"("+i+","+o+")",t.isSlot("color")?n="mapTexelToLinear("+n+")":t.isSlot("emissive")?n="emissiveMapTexelToLinear("+n+")":t.isSlot("environment")&&(n="envMapTexelToLinear("+n+")"),t.format(n,this.type,e)},Qf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.coord=this.coord.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e};var Kf=function(t){lp.call(this,"v4"),t&&this.setMirror(t)};(Kf.prototype=Object.create(lp.prototype)).constructor=Kf,Kf.prototype.nodeType="Reflector",Kf.prototype.setMirror=function(t){this.mirror=t,this.textureMatrix=new Zf(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new dp(dp.LOCAL),this.coord=new Jf(this.textureMatrix,this.localPosition,Jf.MUL),this.coordResult=new Jf(null,this.coord,Jf.ADD),this.texture=new Qf(this.mirror.material.uniforms.tDiffuse.value,this.coord,null,!0)},Kf.prototype.generate=function(t,e){return t.isShader("fragment")?(this.coordResult.a=this.offset,this.texture.coord=this.offset?this.coordResult:this.coord,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4(0.0)",this.type,e))},Kf.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e};var $f=function(t){Qf.call(this,void 0,t)};($f.prototype=Object.create(Qf.prototype)).constructor=$f,$f.prototype.nodeType="Screen",$f.prototype.isUnique=function(){return!0},$f.prototype.getTexture=function(t,e){return fp.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")};var tm=function(t,e){fp.call(this,"v2"),this.value=new ka(t,e)};(tm.prototype=Object.create(fp.prototype)).constructor=tm,tm.prototype.nodeType="Vector2",Hf.addShortcuts(tm.prototype,"value",["x","y"]),tm.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec2( "+this.x+", "+this.y+" )",n,e)},tm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e};var em=function(t,e,r){fp.call(this,"v3"),this.type="v3",this.value=new Ta(t,e,r)};(em.prototype=Object.create(fp.prototype)).constructor=em,em.prototype.nodeType="Vector3",Hf.addShortcuts(em.prototype,"value",["x","y","z"]),em.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",n,e)},em.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e};var rm=function(t,e,r,n){fp.call(this,"v4"),this.value=new ja(t,e,r,n)};(rm.prototype=Object.create(fp.prototype)).constructor=rm,rm.prototype.nodeType="Vector4",Hf.addShortcuts(rm.prototype,"value",["x","y","z","w"]),rm.prototype.generateReadonly=function(t,e,r,n,i,o){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",n,e)},rm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e};var nm=function(){ap.call(this),this.color=new Wf(15658734),this.specular=new Wf(1118481),this.shininess=new mp(30)};(nm.prototype=Object.create(ap.prototype)).constructor=nm,nm.prototype.nodeType="Phong",nm.prototype.build=function(t){var e,r=t.material;if(r.define("PHONG"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(Ec.merge([nh.fog,nh.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>"),e=i.join("\n")}else{this.color.parse(t,{slot:"color"}),this.specular.parse(t),this.shininess.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.parse(t);var o=this.color.buildCode(t,"c",{slot:"color"}),s=this.specular.buildCode(t,"c"),a=this.shininess.buildCode(t,"fv1"),l=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,c=this.normal?this.normal.buildCode(t,"v3"):void 0,u=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,h=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.buildCode(t,"fv1"):void 0,p=this.ambient?this.ambient.buildCode(t,"c"):void 0,f=this.shadow?this.shadow.buildCode(t,"c"):void 0,m=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.buildCode(t,"c",{slot:"environment"}):void 0,g=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(t,"fv1"):void 0;r.requires.transparent=void 0!=l,r.addFragmentPars(["#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),i=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;",o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",s.code,"\tvec3 specular = "+s.result+";",a.code,"\tfloat shininess = max(0.0001,"+a.result+");","\tfloat specularStrength = 1.0;"],l&&i.push(l.code,"if ( "+l.result+" <= ALPHATEST ) discard;"),c&&(t.include("perturbNormal2Arb"),i.push(c.code),u&&i.push(u.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+c.result+","+(new hp).build(t,"v2")+","+(u?u.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),i.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(i.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),i.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&i.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),p&&i.push(p.code,"reflectedLight.indirectDiffuse += "+p.result+";"),f&&i.push(f.code,"reflectedLight.directDiffuse *= "+f.result+";","reflectedLight.directSpecular *= "+f.result+";"),m&&i.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(i.push(v.code),g?i.push(g.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+g.result+" );"):i.push("outgoingLight = "+v.result+";")),i.push(l?"gl_FragColor = vec4( outgoingLight, "+l.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},nm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e};var im=function(){this.node=new nm,Hf.call(this,this.node,this.node),this.type="PhongNodeMaterial"};(im.prototype=Object.create(Hf.prototype)).constructor=im,Hf.addShortcuts(im.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]);var om=function(){ap.call(this),this.color=new Wf(15658734),this.spherical=!0};(om.prototype=Object.create(ap.prototype)).constructor=om,om.prototype.nodeType="Sprite",om.prototype.build=function(t){var e,r=t.material;if(r.define("SPRITE"),r.requires.lights=!1,r.requires.transparent=void 0!=this.alpha,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(Ec.merge([nh.fog])),r.addVertexPars(["#include <fog_pars_vertex>"].join("\n")),e=["#include <begin_vertex>"],n&&e.push(n.code,"transformed = "+n.result+";"),e.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||e.push("modelMtx[1][1] = 1.0;"),e.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&e.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),e.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );")}else{r.addFragmentPars(["#include <fog_pars_fragment>"].join("\n")),this.color.parse(t,{slot:"color"}),this.alpha&&this.alpha.parse(t);var i=this.color.buildCode(t,"c",{slot:"color"}),o=this.alpha?this.alpha.buildCode(t,"fv1"):void 0;e=[i.code],o?e.push(o.code,"gl_FragColor = vec4( "+i.result+", "+o.result+" );"):e.push("gl_FragColor = vec4( "+i.result+", 1.0 );"),e.push("#include <fog_fragment>")}return e.join("\n")},om.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e};var sm=function(){this.node=new om,Hf.call(this,this.node,this.node),this.type="SpriteNodeMaterial"};(sm.prototype=Object.create(Hf.prototype)).constructor=sm,Hf.addShortcuts(sm.prototype,"node",["color","alpha","transform","spherical"]);var am=function(){lp.call(this,"fv1")};am.getSpecularMIPLevel=new cp(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {","\tfloat maxMIPLevelScalar = float( maxMIPLevel );","\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n")),(am.prototype=Object.create(lp.prototype)).constructor=am,am.prototype.nodeType="RoughnessToBlinnExponent",am.prototype.generate=function(t,e){var r=t.material;return t.isShader("fragment")?r.isDefined("PHYSICAL")?(t.include(am.getSpecularMIPLevel),t.isCache("clearCoat")?t.format("getSpecularMIPLevel( Material_ClearCoat_BlinnShininessExponent( material ), 8 )",this.type,e):t.format("getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial."),t.format("0.0",this.type,e)):(console.warn("RoughnessToBlinnExponentNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e))};var lm=function(){ap.call(this),this.color=new Wf(15658734),this.roughness=new mp(.5),this.metalness=new mp(.5)};(lm.prototype=Object.create(ap.prototype)).constructor=lm,lm.prototype.nodeType="Standard",lm.prototype.build=function(t){var e,r=t.material;if(r.define("PHYSICAL"),this.clearCoat||this.clearCoatRoughness||r.define("STANDARD"),r.define("ALPHATEST","0.0"),r.requires.lights=!0,r.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var n=this.transform?this.transform.parseAndBuildCode(t,"v3",{cache:"transform"}):void 0;r.mergeUniform(Ec.merge([nh.fog,nh.lights])),r.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,"transformed = "+n.result+";"),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=i.join("\n")}else{var o={bias:new am,offsetU:0,offsetV:0},s=!r.isDefined("STANDARD");this.color.parse(t,{slot:"color"}),this.roughness.parse(t),this.metalness.parse(t),this.alpha&&this.alpha.parse(t),this.normal&&this.normal.parse(t),this.normalScale&&this.normal&&this.normalScale.parse(t),this.clearCoat&&this.clearCoat.parse(t),this.clearCoatRoughness&&this.clearCoatRoughness.parse(t),this.reflectivity&&this.reflectivity.parse(t),this.light&&this.light.parse(t,{cache:"light"}),this.ao&&this.ao.parse(t),this.ambient&&this.ambient.parse(t),this.shadow&&this.shadow.parse(t),this.emissive&&this.emissive.parse(t,{slot:"emissive"}),this.environment&&this.environment.parse(t,{cache:"env",requires:o,slot:"environment"});var a=this.color.buildCode(t,"c",{slot:"color"}),l=this.roughness.buildCode(t,"fv1"),c=this.metalness.buildCode(t,"fv1"),u=this.alpha?this.alpha.buildCode(t,"fv1"):void 0,h=this.normal?this.normal.buildCode(t,"v3"):void 0,d=this.normalScale&&this.normal?this.normalScale.buildCode(t,"v2"):void 0,p=this.clearCoat?this.clearCoat.buildCode(t,"fv1"):void 0,f=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(t,"fv1"):void 0,m=this.reflectivity?this.reflectivity.buildCode(t,"fv1"):void 0,v=this.light?this.light.buildCode(t,"v3",{cache:"light"}):void 0,g=this.ao?this.ao.buildCode(t,"fv1"):void 0,y=this.ambient?this.ambient.buildCode(t,"c"):void 0,x=this.shadow?this.shadow.buildCode(t,"c"):void 0,b=this.emissive?this.emissive.buildCode(t,"c",{slot:"emissive"}):void 0,w=this.environment?this.environment.buildCode(t,"c",{cache:"env",requires:o,slot:"environment"}):void 0,_=s&&w?this.environment.buildCode(t,"c",{cache:"clearCoat",requires:o,slot:"environment"}):void 0;r.requires.transparent=void 0!=u,r.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_vertex>"].join("\n")),i=["\t#include <normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );",a.code,"\tvec3 diffuseColor = "+a.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",l.code,"\tfloat roughnessFactor = "+l.result+";",c.code,"\tfloat metalnessFactor = "+c.result+";"],u&&i.push(u.code,"if ( "+u.result+" <= ALPHATEST ) discard;"),h&&(t.include("perturbNormal2Arb"),i.push(h.code),d&&i.push(d.code),i.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+h.result+","+(new hp).build(t,"v2")+","+(d?d.result:"vec2( 1.0 )")+");")),i.push("material.diffuseColor = "+(v?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),i.push("material.specularRoughness = clamp( roughnessFactor, DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"),p?i.push(p.code,"material.clearCoat = saturate( "+p.result+" );"):s&&i.push("material.clearCoat = 0.0;"),f?i.push(f.code,"material.clearCoatRoughness = clamp( "+f.result+", DEFAULT_SPECULAR_COEFFICIENT, 1.0 );"):s&&i.push("material.clearCoatRoughness = 0.0;"),m?i.push(m.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>","#include <lights_fragment_end>"),v&&(i.push(v.code,"reflectedLight.directDiffuse = "+v.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),g&&i.push(g.code,"reflectedLight.indirectDiffuse *= "+g.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+g.result+", material.specularRoughness );"),y&&i.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),x&&i.push(x.code,"reflectedLight.directDiffuse *= "+x.result+";","reflectedLight.directSpecular *= "+x.result+";"),b&&i.push(b.code,"reflectedLight.directDiffuse += "+b.result+";"),w&&(i.push(w.code),_&&i.push(_.code,"clearCoatRadiance += "+_.result+";"),i.push("RE_IndirectSpecular("+w.result+", clearCoatRadiance, geometry, material, reflectedLight );")),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),i.push(u?"gl_FragColor = vec4( outgoingLight, "+u.result+" );":"gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),e=i.join("\n")}return e},lm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.transform&&(e.transform=this.transform.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.normalScale&&(e.normalScale=this.normalScale.toJSON(t).uuid),this.clearCoat&&(e.clearCoat=this.clearCoat.toJSON(t).uuid),this.clearCoatRoughness&&(e.clearCoatRoughness=this.clearCoatRoughness.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid)),e};var cm=function(){this.node=new lm,Hf.call(this,this.node,this.node),this.type="StandardNodeMaterial"};(cm.prototype=Object.create(Hf.prototype)).constructor=cm,Hf.addShortcuts(cm.prototype,"node",["color","alpha","roughness","metalness","reflectivity","clearCoat","clearCoatRoughness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]);var um=function(t,e){lp.call(this),this.a=t,this.method=e||um.SIN};um.RAD="radians",um.DEG="degrees",um.EXP="exp",um.EXP2="exp2",um.LOG="log",um.LOG2="log2",um.SQRT="sqrt",um.INV_SQRT="inversesqrt",um.FLOOR="floor",um.CEIL="ceil",um.NORMALIZE="normalize",um.FRACT="fract",um.SAT="saturate",um.SIN="sin",um.COS="cos",um.TAN="tan",um.ASIN="asin",um.ACOS="acos",um.ARCTAN="atan",um.ABS="abs",um.SIGN="sign",um.LENGTH="length",um.NEGATE="negate",um.INVERT="invert",um.prototype=Object.create(lp.prototype),um.prototype.constructor=um,um.prototype.nodeType="Math1",um.prototype.getType=function(t){switch(this.method){case um.LENGTH:return"fv1"}return this.a.getType(t)},um.prototype.generate=function(t,e){var r=this.getType(t),n=this.a.build(t,r);switch(this.method){case um.NEGATE:n="(-"+n+")";break;case um.INVERT:n="(1.0-"+n+")";break;default:n=this.method+"("+n+")"}return t.format(n,r,e)},um.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.method=this.method),e};var hm=function(t,e,r){lp.call(this),this.a=t,this.b=e,this.method=r||hm.DISTANCE};hm.MIN="min",hm.MAX="max",hm.MOD="mod",hm.STEP="step",hm.REFLECT="reflect",hm.DISTANCE="distance",hm.DOT="dot",hm.CROSS="cross",hm.POW="pow",hm.prototype=Object.create(lp.prototype),hm.prototype.constructor=hm,hm.prototype.nodeType="Math2",hm.prototype.getInputType=function(t){return t.getFormatLength(this.b.getType(t))>t.getFormatLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)},hm.prototype.getType=function(t){switch(this.method){case hm.DISTANCE:case hm.DOT:return"fv1";case hm.CROSS:return"v3"}return this.getInputType(t)},hm.prototype.generate=function(t,e){var r,n,i=this.getInputType(t),o=t.getFormatLength(this.a.getType(t)),s=t.getFormatLength(this.b.getType(t));switch(this.method){case hm.CROSS:r=this.a.build(t,"v3"),n=this.b.build(t,"v3");break;case hm.STEP:r=this.a.build(t,1==o?"fv1":i),n=this.b.build(t,i);break;case hm.MIN:case hm.MAX:case hm.MOD:r=this.a.build(t,i),n=this.b.build(t,1==s?"fv1":i);break;default:r=this.a.build(t,i),n=this.b.build(t,i)}return t.format(this.method+"("+r+","+n+")",this.getType(t),e)},hm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.method=this.method),e};var dm=function(t,e,r,n){lp.call(this),this.a=t,this.b=e,this.c=r,this.method=n||dm.MIX};dm.MIX="mix",dm.REFRACT="refract",dm.SMOOTHSTEP="smoothstep",dm.FACEFORWARD="faceforward",dm.prototype=Object.create(lp.prototype),dm.prototype.constructor=dm,dm.prototype.nodeType="Math3",dm.prototype.getType=function(t){var e=t.getFormatLength(this.a.getType(t)),r=t.getFormatLength(this.b.getType(t)),n=t.getFormatLength(this.c.getType(t));return e>r&&e>n?this.a.getType(t):r>n?this.b.getType(t):this.c.getType(t)},dm.prototype.generate=function(t,e){var r,n,i,o=this.getType(t),s=(t.getFormatLength(this.a.getType(t)),t.getFormatLength(this.b.getType(t)),t.getFormatLength(this.c.getType(t)));switch(this.method){case dm.REFRACT:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,"fv1");break;case dm.MIX:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,1==s?"fv1":o);break;default:r=this.a.build(t,o),n=this.b.build(t,o),i=this.c.build(t,o)}return t.format(this.method+"("+r+","+n+","+i+")",o,e)},dm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.c=this.c.toJSON(t).uuid,e.method=this.method),e};var pm=function(t){this.time=void 0!==t?t:0,this.frameId=0};pm.prototype.update=function(t){return++this.frameId,this.time+=t,this.delta=t,this},pm.prototype.updateNode=function(t){return t.frameId===this.frameId?this:(t.updateFrame(this),t.frameId=this.frameId,this)};var fm=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(fm.prototype,{setSize:function(t,e){},render:function(t,e,r,n,i){console.error("Pass: .render() must be implemented in derived pass.")}});var mm=function(t,e){fm.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Cc?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Ec.clone(t.uniforms),this.material=new Cc({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};mm.prototype=Object.assign(Object.create(fm.prototype),{constructor:mm,render:function(t,e,r,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var vm=function(){mm.call(this),this.name="",this.uuid=_a.generateUUID(),this.userData={},this.textureID="renderTexture",this.fragment=new Vf(new $f),this.node=new Hf,this.node.fragment=this.fragment,this.build()};(vm.prototype=Object.create(mm.prototype)).constructor=vm,Hf.addShortcuts(vm.prototype,"fragment",["value"]),vm.prototype.build=function(){this.node.build(),this.uniforms=this.node.uniforms,this.material=this.node},vm.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePass",t.passes[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.value=this.value.toJSON(t).uuid}return t.pass=this.uuid,t};var gm=function(t,e,r,n){lp.call(this,"v4"),this.value=t,this.coord=e||new hp,this.radius=new tm(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new mp(1/64),this.vertical=new mp(1/64)};gm.fBlurX=new cp(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum;","}"].join("\n")),gm.fBlurY=new cp(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum;","}"].join("\n")),(gm.prototype=Object.create(lp.prototype)).constructor=gm,gm.prototype.nodeType="Blur",gm.prototype.updateFrame=function(t){if(this.size)this.horizontal.number=this.radius.x/this.size.x,this.vertical.number=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var e=this.value.value.image;this.horizontal.number=this.radius.x/e.width,this.vertical.number=this.radius.y/e.height}},gm.prototype.generate=function(t,e){var r=gm.fBlurX,n=gm.fBlurY;if(t.include(r),t.include(n),t.isShader("fragment")){var i,o=[];return this.blurX&&o.push(r.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.horizontal.build(t,"fv1")+")"),this.blurY&&o.push(n.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.vertical.build(t,"fv1")+")"),i=2==o.length?"("+o.join("+")+"/2.0)":o.length?"("+o[0]+")":"vec4( 0.0 )",t.format(i,this.getType(t),e)}return console.warn("BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)},gm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e};var ym=function(t,e,r){lp.call(this,"v3"),this.value=t,this.coord=e||new hp,this.scale=r||new tm(1,1)};ym.fBumpToNormal=new cp(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, vec2 scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 + ( dBx * scale.x ), .5 + ( dBy * scale.y ), 1.0 );","}"].join("\n"),null,{derivatives:!0}),(ym.prototype=Object.create(lp.prototype)).constructor=ym,ym.prototype.nodeType="Bump",ym.prototype.generate=function(t,e){var r=ym.fBumpToNormal;return t.include(r),t.isShader("fragment")?t.format(r.name+"("+this.value.build(t,"sampler2D")+","+this.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("BumpNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},ym.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.coord=this.coord.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e};var xm=function(t,e,r){lp.call(this,"v3"),this.rgb=t,this.adjustment=e,this.method=r||xm.SATURATION};xm.SATURATION="saturation",xm.HUE="hue",xm.VIBRANCE="vibrance",xm.BRIGHTNESS="brightness",xm.CONTRAST="contrast",xm.prototype=Object.create(lp.prototype),xm.prototype.constructor=xm,xm.prototype.nodeType="ColorAdjustment",xm.prototype.generate=function(t,e){var r,n=this.rgb.build(t,"v3"),i=this.adjustment.build(t,"fv1");switch(this.method){case xm.SATURATION:r="saturation_rgb";break;case xm.HUE:r="hue_rgb";break;case xm.VIBRANCE:r="vibrance_rgb";break;case xm.BRIGHTNESS:return t.format("("+n+"+"+i+")",this.getType(t),e);case xm.CONTRAST:return t.format("("+n+"*"+i+")",this.getType(t),e)}return t.include(r),t.format(r+"("+n+","+i+")",this.getType(t),e)},xm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e};var bm=function(t,e,r,n){lp.call(this,"fv1"),this.x=t,this.y=e,this.z=r,this.w=n};bm.inputs=["x","y","z","w"],(bm.prototype=Object.create(lp.prototype)).constructor=bm,bm.prototype.nodeType="Join",bm.prototype.getNumElements=function(){for(var t=bm.inputs,e=t.length;e--;)if(void 0!==this[t[e]]){++e;break}return Math.max(e,2)},bm.prototype.getType=function(t){return t.getFormatFromLength(this.getNumElements())},bm.prototype.generate=function(t,e){for(var r=this.getType(t),n=this.getNumElements(),i=bm.inputs,o=[],s=0;s<n;s++){var a=this[i[s]];o.push(a?a.build(t,"fv1"):"0.")}var l=(n>1?t.getConstructorFromLength(n):"")+"("+o.join(",")+")";return t.format(l,r,e)},bm.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){(e=this.createJSONNode(t)).inputs={};for(var r=this.getNumElements(),n=bm.inputs,i=0;i<r;i++){var o=this[n[i]];o&&(e.inputs[n[i]]=o.toJSON(t).uuid)}}return e};var wm=function(t){lp.call(this,"fv1"),this.rgb=t};(wm.prototype=Object.create(lp.prototype)).constructor=wm,wm.prototype.nodeType="Luminance",wm.prototype.generate=function(t,e){return t.include("luminance_rgb"),t.format("luminance_rgb("+this.rgb.build(t,"v3")+")",this.getType(t),e)},wm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),e};var _m=function(t){lp.call(this,"fv1"),this.coord=t};(_m.prototype=Object.create(lp.prototype)).constructor=_m,_m.prototype.nodeType="Noise",_m.prototype.generate=function(t,e){return t.include("snoise"),t.format("snoise("+this.coord.build(t,"v2")+")",this.getType(t),e)},_m.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).coord=this.coord.toJSON(t).uuid),e};var Sm=function(t,e,r,n,i){lp.call(this,"v3"),this.value=t,this.scale=r||new mp(1),this.normal=n||new pp(pp.LOCAL),this.position=i||new dp(pp.VIEW)};(Sm.prototype=Object.create(lp.prototype)).constructor=Sm,Sm.prototype.nodeType="NormalMap",Sm.prototype.generate=function(t,e){return t.include("perturbNormal2Arb"),t.isShader("fragment")?t.format("perturbNormal2Arb(-"+this.position.build(t,"v3")+","+this.normal.build(t,"v3")+","+this.value.build(t,"v3")+","+this.value.coord.build(t,"v2")+","+this.scale.build(t,"v2")+")",this.getType(t),e):(console.warn("NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e))},Sm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.scale=this.scale.toJSON(t).uuid,e.normal=this.normal.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e};var Tm=function(t){tm.call(this),this.renderer=t};(Tm.prototype=Object.create(tm.prototype)).constructor=Tm,Tm.prototype.nodeType="Resolution",Tm.prototype.updateFrame=function(t){var e=this.renderer.getSize(),r=this.renderer.getPixelRatio();this.x=e.width*r,this.y=e.height*r},Tm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).renderer=this.renderer.uuid),e};var Mm=function(t,e){ap.call(this),this.node=t,this.components=e||"x"};(Mm.prototype=Object.create(ap.prototype)).constructor=Mm,Mm.prototype.nodeType="Switch",Mm.prototype.getType=function(t){return t.getFormatFromLength(this.components.length)},Mm.prototype.generate=function(t,e){var r=this.node.getType(t),n=t.getFormatLength(r)-1,i=this.node.build(t,r);if(n>0){var o,s=0,a=t.colorToVector(this.components),l=a.length;for(o=0;o<l;o++)s=Math.max(s,t.getIndexByElement(a.charAt(o)));for(s>n&&(s=n),i+=".",o=0;o<l;o++){a.charAt(o);var c=t.getIndexByElement(a.charAt(o));c>s&&(c=s),i+=t.getElementByIndex(c)}return t.format(i,this.getType(t),e)}return t.format(i,r,e)},Mm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,e.components=this.components),e};var Am=function(){cp.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=new hp,this.transform=new Yf};(Am.prototype=Object.create(cp.prototype)).constructor=Am,Am.prototype.nodeType="UVTransform",Am.prototype.generate=function(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.transform,cp.prototype.generate.call(this,t,e)},Am.prototype.setUvTransform=function(t,e,r,n,i,o,s){this.transform.value.setUvTransform(t,e,r,n,i,o=void 0!==o?o:.5,s=void 0!==s?s:.5)},Am.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.transform=this.transform.toJSON(t).uuid),e};var Em=function(t,e){em.call(this),this.params={},this.velocity=new Ta,this.setTarget(t),this.setParams(e)};(Em.prototype=Object.create(em.prototype)).constructor=Em,Em.prototype.nodeType="Velocity",Em.prototype.isReadonly=function(t){return!1},Em.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new Ta,this.speed=new Ta,this.springVelocity=new Ta,this.lastVelocity=new Ta}},Em.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(),this.oldPosition=this.position.clone())},Em.prototype.updateFrameVelocity=function(t){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},Em.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),r=Math.pow(this.params.spring,e),n=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(n).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(n),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},Em.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params))),e};var Cm=function(t){ap.call(this,t)};function Pm(t,e){this.min=void 0!==t?t:new ka(1/0,1/0),this.max=void 0!==e?e:new ka(-1/0,-1/0)}(Cm.prototype=Object.create(ap.prototype)).constructor=Cm,Cm.prototype.nodeType="Var",Cm.prototype.getType=function(t){return t.getTypeByFormat(this.type)},Cm.prototype.generate=function(t,e){var r=t.material.getVar(this.uuid,this.type);return t.format(r.name,this.getType(t),e)},Cm.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).out=this.type),e},Object.assign(Pm.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new ka;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("Box2: .getCenter() target is now required"),t=new ka),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("Box2: .getSize() target is now required"),t=new ka),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("Box2: .getParameter() target is now required"),e=new ka),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("Box2: .clampPoint() target is now required"),e=new ka),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new ka;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Om=function(){ql.call(this,Om.Geometry,new zl({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var t=new Ta,e=new xh(new Uint8Array(768),16,16,Al);e.minFilter=bl,e.magFilter=bl,e.wrapS=yl,e.wrapT=yl,e.needsUpdate=!0;var r=new xh(new Uint8Array(768),16,16,Al);r.minFilter=bl,r.magFilter=bl,r.wrapS=yl,r.wrapT=yl,r.needsUpdate=!0;var n=Om.Geometry,i=new qc({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new qc({uniforms:{map:{value:e},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new ql(n,i),a=[],l=Nm.Shader,c=new qc({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new Ia(16777215)},scale:{value:new ka},screenPosition:{value:new Ta}},vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:2,transparent:!0,depthWrite:!1}),u=new ql(n,c);this.addElement=function(t){a.push(t)};var h=new ka,d=new ka,p=new Pm,f=new ja;this.onBeforeRender=function(l,m,v){f.copy(l.getCurrentViewport());var g=f.z/2,y=f.w/2;if(h.set((T=16/f.w)*(f.w/f.z),T),p.min.set(f.x,f.y),p.max.set(f.x+(f.z-16),f.y+(f.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(v.matrixWorldInverse),t.applyMatrix4(v.projectionMatrix),d.x=f.x+t.x*g+g-8,d.y=f.y+t.y*y+y-8,p.containsPoint(d)){l.copyFramebufferToTexture(d,e),(S=i.uniforms).scale.value=h,S.screenPosition.value=t,l.renderBufferDirect(v,null,n,i,s,null),l.copyFramebufferToTexture(d,r),(S=o.uniforms).scale.value=h,S.screenPosition.value=t,l.renderBufferDirect(v,null,n,o,s,null);for(var x=2*-t.x,b=2*-t.y,w=0,_=a.length;w<_;w++){var S,T,M=a[w];(S=c.uniforms).color.value.copy(M.color),S.map.value=M.texture,S.screenPosition.value.x=t.x+x*M.distance,S.screenPosition.value.y=t.y+b*M.distance,S.scale.value.set((T=M.size/f.w)*(f.w/f.z),T),c.uniformsNeedUpdate=!0,l.renderBufferDirect(v,null,n,c,u,null)}}},this.dispose=function(){i.dispose(),o.dispose(),c.dispose(),e.dispose(),r.dispose();for(var t=0,n=a.length;t<n;t++)a[t].texture.dispose()}};Om.prototype=Object.create(ql.prototype),Om.prototype.constructor=Om,Om.prototype.isLensflare=!0;var Nm=function(t,e,r,n){this.texture=t,this.size=e||1,this.distance=r||0,this.color=n||new Ia(16777215)};Nm.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Om.Geometry=function(){var t=new $a,e=new Mh(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);return t.setIndex([0,1,2,0,2,3]),t.addAttribute("position",new Eh(e,3,0,!1)),t.addAttribute("uv",new Eh(e,2,3,!1)),t}();var Lm=function(t,e){ql.call(this,t),this.type="Reflector";var r=this,n=new Ia(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,s=e.clipBias||0,a=e.shader||Lm.ReflectorShader,l=void 0!==e.recursion?e.recursion:0,c=new Wl,u=new Ta,h=new Ta,d=new Ta,p=new Sa,f=new Ta(0,0,-1),m=new ja,v=new ja,g=new Ta,y=new Ta,x=new ja,b=new Sa,w=new bc,_=new Ac(i,o,{minFilter:wl,magFilter:wl,format:Al,stencilBuffer:!1});_a.isPowerOfTwo(i)&&_a.isPowerOfTwo(o)||(_.texture.generateMipmaps=!1);var S=new Cc({uniforms:Ec.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});S.uniforms.tDiffuse.value=_.texture,S.uniforms.color.value=n,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(t,e,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(h,d),!(g.dot(u)>0)){g.reflect(u).negate(),g.add(h),p.extractRotation(n.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),y.subVectors(h,f),y.reflect(u).negate(),y.add(h),w.position.copy(g),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(u),w.lookAt(y),w.far=n.far,w.updateMatrixWorld(),w.projectionMatrix.copy(n.projectionMatrix),w.userData.recursion=0,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(w.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var i=w.projectionMatrix;x.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],x.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],x.z=-1,x.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(x)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-s,i.elements[14]=m.w,r.visible=!1;var o=t.getRenderTarget(),a=t.vr.enabled,S=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,w,_,!0),t.vr.enabled=a,t.shadowMap.autoUpdate=S,t.setRenderTarget(o);var T=n.bounds;if(void 0!==T){var M=t.getSize(),A=t.getPixelRatio();v.x=T.x*M.width*A,v.y=T.y*M.height*A,v.z=T.z*M.width*A,v.w=T.w*M.height*A,t.state.viewport(v)}r.visible=!0}},this.getRenderTarget=function(){return _}};Lm.prototype=Object.create(ql.prototype),Lm.prototype.constructor=Lm,Lm.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},Object.create(Lm.prototype);var Im=function(t,e){ql.call(this,t),this.type="Refractor";var r=this,n=new Ia(void 0!==(e=e||{}).color?e.color:8355711),i=e.textureWidth||512,o=e.textureHeight||512,s=e.clipBias||0,a=e.shader||Im.RefractorShader,l=new bc;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new Wl,u=new Sa,h=new Ac(i,o,{minFilter:wl,magFilter:wl,format:Al,stencilBuffer:!1});_a.isPowerOfTwo(i)&&_a.isPowerOfTwo(o)||(h.texture.generateMipmaps=!1),this.material=new Cc({uniforms:Ec.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=h.texture,this.material.uniforms.textureMatrix.value=u;var d=function(){var t=new Ta,e=new Ta,n=new Sa,i=new Ta,o=new Ta;return function(s){return t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(s.matrixWorld),i.subVectors(t,e),n.extractRotation(r.matrixWorld),o.set(0,0,1),o.applyMatrix4(n),i.dot(o)<0}}(),p=function(){var t=new Ta,e=new Ta,n=new Ma,i=new Ta;return function(){r.matrixWorld.decompose(e,n,i),t.set(0,0,1).applyQuaternion(n).normalize(),t.negate(),c.setFromNormalAndCoplanarPoint(t,e)}}(),f=function(){var t=new Wl,e=new ja,r=new ja;return function(n){l.matrixWorld.copy(n.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(n.projectionMatrix),l.far=n.far,t.copy(c),t.applyMatrix4(l.matrixWorldInverse),e.set(t.normal.x,t.normal.y,t.normal.z,t.constant);var i=l.projectionMatrix;r.x=(Math.sign(e.x)+i.elements[8])/i.elements[0],r.y=(Math.sign(e.y)+i.elements[9])/i.elements[5],r.z=-1,r.w=(1+i.elements[10])/i.elements[14],e.multiplyScalar(2/e.dot(r)),i.elements[2]=e.x,i.elements[6]=e.y,i.elements[10]=e.z+1-s,i.elements[14]=e.w}}(),m=function(){var t=new ja;return function(e,n,i){r.visible=!1;var o=e.getRenderTarget(),s=e.vr.enabled,a=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(n,l,h,!0),e.vr.enabled=s,e.shadowMap.autoUpdate=a,e.setRenderTarget(o);var c=i.bounds;if(void 0!==c){var u=e.getSize(),d=e.getPixelRatio();t.x=c.x*u.width*d,t.y=c.y*u.height*d,t.z=c.z*u.width*d,t.w=c.w*u.height*d,e.state.viewport(t)}r.visible=!0}}();this.onBeforeRender=function(t,e,n){!0!==n.userData.refractor&&1!=!d(n)&&(p(),function(t){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(t.projectionMatrix),u.multiply(t.matrixWorldInverse),u.multiply(r.matrixWorld)}(n),f(n),m(t,e,n))},this.getRenderTarget=function(){return h}};Im.prototype=Object.create(ql.prototype),Im.prototype.constructor=Im,Im.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Rm=function(t){var e=new zl({color:0,transparent:!0,opacity:.6,depthWrite:!1});ql.call(this,t.geometry,e),this.meshMatrix=t.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1};(Rm.prototype=Object.create(ql.prototype)).constructor=Rm,Rm.prototype.update=function(){var t=new Sa;return function(e,r){var n=e.normal.x*r.x+e.normal.y*r.y+e.normal.z*r.z+-e.constant*r.w,i=t.elements;i[0]=n-r.x*e.normal.x,i[4]=-r.x*e.normal.y,i[8]=-r.x*e.normal.z,i[12]=-r.x*-e.constant,i[1]=-r.y*e.normal.x,i[5]=n-r.y*e.normal.y,i[9]=-r.y*e.normal.z,i[13]=-r.y*-e.constant,i[2]=-r.z*e.normal.x,i[6]=-r.z*e.normal.y,i[10]=n-r.z*e.normal.z,i[14]=-r.z*-e.constant,i[3]=-r.w*e.normal.x,i[7]=-r.w*e.normal.y,i[11]=-r.w*e.normal.z,i[15]=n-r.w*-e.constant,this.matrix.multiplyMatrices(t,this.meshMatrix)}}();var Dm=function(){var t=Dm.SkyShader,e=new Cc({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:Ec.clone(t.uniforms),side:nl});ql.call(this,new $l(1,1,1),e)};Dm.prototype=Object.create(ql.prototype),Dm.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Ta}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Fm=function(t,e){ql.call(this,t);var r=this,n=void 0!==(e=e||{}).textureWidth?e.textureWidth:512,i=void 0!==e.textureHeight?e.textureHeight:512,o=void 0!==e.clipBias?e.clipBias:0,s=void 0!==e.alpha?e.alpha:1,a=void 0!==e.time?e.time:0,l=void 0!==e.waterNormals?e.waterNormals:null,c=void 0!==e.sunDirection?e.sunDirection:new Ta(.70707,.70707,0),u=new Ia(void 0!==e.sunColor?e.sunColor:16777215),h=new Ia(void 0!==e.waterColor?e.waterColor:8355711),d=void 0!==e.eye?e.eye:new Ta(0,0,0),p=void 0!==e.distortionScale?e.distortionScale:20,f=void 0!==e.side?e.side:rl,m=void 0!==e.fog&&e.fog,v=new Wl,g=new Ta,y=new Ta,x=new Ta,b=new Sa,w=new Ta(0,0,-1),_=new ja,S=new Ta,T=new Ta,M=new ja,A=new Sa,E=new bc,C=new Ac(n,i,{minFilter:wl,magFilter:wl,format:Al,stencilBuffer:!1});_a.isPowerOfTwo(n)&&_a.isPowerOfTwo(i)||(C.texture.generateMipmaps=!1);var P={uniforms:Ec.merge([nh.fog,nh.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Sa},sunColor:{value:new Ia(8355711)},sunDirection:{value:new Ta(.70707,.70707,0)},eye:{value:new Ta},waterColor:{value:new Ia(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",rh.fog_pars_vertex,rh.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",rh.fog_vertex,rh.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",rh.common,rh.packing,rh.bsdfs,rh.fog_pars_fragment,rh.lights_pars_begin,rh.shadowmap_pars_fragment,rh.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",rh.tonemapping_fragment,rh.fog_fragment,"}"].join("\n")},O=new Cc({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:Ec.clone(P.uniforms),transparent:!0,lights:!0,side:f,fog:m});O.uniforms.mirrorSampler.value=C.texture,O.uniforms.textureMatrix.value=A,O.uniforms.alpha.value=s,O.uniforms.time.value=a,O.uniforms.normalSampler.value=l,O.uniforms.sunColor.value=u,O.uniforms.waterColor.value=h,O.uniforms.sunDirection.value=c,O.uniforms.distortionScale.value=p,O.uniforms.eye.value=d,r.material=O,r.onBeforeRender=function(t,e,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),b.extractRotation(r.matrixWorld),g.set(0,0,1),g.applyMatrix4(b),S.subVectors(y,x),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),b.extractRotation(n.matrixWorld),w.set(0,0,-1),w.applyMatrix4(b),w.add(x),T.subVectors(y,w),T.reflect(g).negate(),T.add(y),E.position.copy(S),E.up.set(0,1,0),E.up.applyMatrix4(b),E.up.reflect(g),E.lookAt(T),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(E.matrixWorldInverse),_.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var i=E.projectionMatrix;M.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],M.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],M.z=-1,M.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(M)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-o,i.elements[14]=_.w,d.setFromMatrixPosition(n.matrixWorld);var s=t.getRenderTarget(),a=t.vr.enabled,l=t.shadowMap.autoUpdate;r.visible=!1,t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(e,E,C,!0),r.visible=!0,t.vr.enabled=a,t.shadowMap.autoUpdate=l,t.setRenderTarget(s)}}};function km(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Um(t,e){ql.call(this,t),this.type="Water2";var r=this,n=new Ia(void 0!==(e=e||{}).color?e.color:16777215),i=e.textureWidth||512,o=e.textureHeight||512,s=e.clipBias||0,a=e.flowDirection||new ka(1,0),l=e.flowSpeed||.03,c=e.reflectivity||.02,u=e.scale||1,h=e.shader||Um.Water2Shader,d=new Kc,p=e.flowMap||void 0,f=e.normalMap0||d.load("textures/water/Water2_1_M_Normal.jpg"),m=e.normalMap1||d.load("textures/water/Water2_2_M_Normal.jpg"),v=new Sa,g=new km;if(void 0!==Lm)if(void 0!==Im){var y=new Lm(t,{textureWidth:i,textureHeight:o,clipBias:s}),x=new Im(t,{textureWidth:i,textureHeight:o,clipBias:s});y.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new Cc({uniforms:Ec.merge([nh.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:a},f.wrapS=f.wrapT=gl,m.wrapS=m.wrapT=gl,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=v,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(t,e,n){!function(t){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(t.projectionMatrix),v.multiply(t.matrixWorldInverse),v.multiply(r.matrixWorld)}(n),function(){var t=g.getDelta(),e=r.material.uniforms.config;e.value.x+=l*t,e.value.y=e.value.x+.075,e.value.x>=.15?(e.value.x=0,e.value.y=.075):e.value.y>=.15&&(e.value.y=e.value.y-.15)}(),r.visible=!1,y.matrixWorld.copy(r.matrixWorld),x.matrixWorld.copy(r.matrixWorld),y.onBeforeRender(t,e,n),x.onBeforeRender(t,e,n),r.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}Fm.prototype=Object.create(ql.prototype),Fm.prototype.constructor=Fm,Object.assign(km.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),(Um.prototype=Object.create(ql.prototype)).constructor=Um,Um.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new ja}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var Bm=function(t,e,r,n){function i(t,e){return void 0!==t?t:e}this.changed=!0,this.initial=!0,this.oceanCamera=new Sc,this.oceanCamera.position.z=1,this.renderer=t,this.renderer.clearColor(16777215),this.scene=new _c,this.clearColor=i((n=n||{}).CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=i(n.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=i(n.SUN_DIRECTION[0],-1),this.sunDirectionY=i(n.SUN_DIRECTION[1],1),this.sunDirectionZ=i(n.SUN_DIRECTION[2],1),this.oceanColor=i(n.OCEAN_COLOR,new Ta(.004,.016,.047)),this.skyColor=i(n.SKY_COLOR,new Ta(3.2,9.6,12.8)),this.exposure=i(n.EXPOSURE,.35),this.geometryResolution=i(n.GEOMETRY_RESOLUTION,32),this.geometrySize=i(n.GEOMETRY_SIZE,2e3),this.resolution=i(n.RESOLUTION,64),this.floatSize=i(n.SIZE_OF_FLOAT,4),this.windX=i(n.INITIAL_WIND[0],10),this.windY=i(n.INITIAL_WIND[1],10),this.size=i(n.INITIAL_SIZE,250),this.choppiness=i(n.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var o=i(n.USE_HALF_FLOAT,!1)?1016:1015,s={minFilter:wl,magFilter:wl,wrapS:yl,wrapT:yl,format:El,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},a={minFilter:bl,magFilter:bl,wrapS:yl,wrapT:yl,format:El,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o};this.initialSpectrumFramebuffer=new Ac(this.resolution,this.resolution,{minFilter:bl,magFilter:bl,wrapS:gl,wrapT:gl,format:El,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o}),this.spectrumFramebuffer=new Ac(this.resolution,this.resolution,a),this.pingPhaseFramebuffer=new Ac(this.resolution,this.resolution,a),this.pongPhaseFramebuffer=new Ac(this.resolution,this.resolution,a),this.pingTransformFramebuffer=new Ac(this.resolution,this.resolution,a),this.pongTransformFramebuffer=new Ac(this.resolution,this.resolution,a),this.displacementMapFramebuffer=new Ac(this.resolution,this.resolution,s),this.normalMapFramebuffer=new Ac(this.resolution,this.resolution,s);var l=ih.ocean_sim_vertex,c=ih.ocean_subtransform,u=Ec.clone(c.uniforms);this.materialOceanHorizontal=new Cc({uniforms:u,vertexShader:l.vertexShader,fragmentShader:"#define HORIZONTAL \n"+c.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var h=ih.ocean_subtransform,d=Ec.clone(h.uniforms);this.materialOceanVertical=new Cc({uniforms:d,vertexShader:l.vertexShader,fragmentShader:h.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var p=ih.ocean_initial_spectrum,f=Ec.clone(p.uniforms);this.materialInitialSpectrum=new Cc({uniforms:f,vertexShader:l.vertexShader,fragmentShader:p.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new ka},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var m=ih.ocean_phase,v=Ec.clone(m.uniforms);this.materialPhase=new Cc({uniforms:v,vertexShader:l.vertexShader,fragmentShader:m.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var g=ih.ocean_spectrum,y=Ec.clone(g.uniforms);this.materialSpectrum=new Cc({uniforms:y,vertexShader:l.vertexShader,fragmentShader:g.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var x=ih.ocean_normals,b=Ec.clone(x.uniforms);this.materialNormal=new Cc({uniforms:b,vertexShader:l.vertexShader,fragmentShader:x.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var w=ih.ocean_main,_=Ec.clone(w.uniforms);this.materialOcean=new Cc({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new Ta(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new ql(new Oc(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};function jm(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new $a;i.setIndex(new za(r,1)),i.addAttribute("position",new za(n,3)),nd.call(this,i,new Vl({color:e})),this.matrixAutoUpdate=!1,this.update()}function zm(t){return!isNaN(t)&&isFinite(t)}function Vm(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}Bm.prototype.generateMesh=function(){var t=new Oc(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);t.rotateX(-Math.PI/2),this.oceanMesh=new ql(t,this.materialOcean)},Bm.prototype.render=function(){this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null},Bm.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var t=new window.Float32Array(this.resolution*this.resolution*4),e=0;e<this.resolution;e++)for(var r=0;r<this.resolution;r++)t[e*this.resolution*4+4*r]=2*Math.random()*Math.PI,t[e*this.resolution*4+4*r+1]=0,t[e*this.resolution*4+4*r+2]=0,t[e*this.resolution*4+4*r+3]=0;this.pingPhaseTexture=new xh(t,this.resolution,this.resolution,El),this.pingPhaseTexture.wrapS=yl,this.pingPhaseTexture.wrapT=yl,this.pingPhaseTexture.type=1015,this.pingPhaseTexture.needsUpdate=!0},Bm.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.initialSpectrumFramebuffer,!0)},Bm.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.pingPhase=!this.pingPhase},Bm.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.spectrumFramebuffer)},Bm.prototype.renderSpectrumFFT=function(){var t=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var e=0;e<t;e++)0===e?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer)):e%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer));for(this.scene.overrideMaterial=this.materialOceanVertical,e=t;e<2*t;e++)e===2*t-1?(this.materialOceanVertical.uniforms.u_input.value=t%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.displacementMapFramebuffer)):e%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer))},Bm.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.render(this.scene,this.oceanCamera,this.normalMapFramebuffer,!0)},(jm.prototype=Object.create(nd.prototype)).constructor=jm,jm.prototype.update=function(){var t=new Da;return function(e){if(void 0!==e&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,n=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),jm.prototype.setFromObject=function(t){return this.object=t,this.update(),this};var Gm=function(t){if((t=t||{}).tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=zm(t.INDEX_OUTSIDE_POS_X)?t.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=zm(t.INDEX_OUTSIDE_NEG_X)?t.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=zm(t.INDEX_OUTSIDE_POS_Y)?t.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=zm(t.INDEX_OUTSIDE_NEG_Y)?t.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=zm(t.INDEX_OUTSIDE_POS_Z)?t.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=zm(t.INDEX_OUTSIDE_NEG_Z)?t.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new Ta,this.utilVec32Search=new Ta,this.scene=t.scene,this.scene){var e=new jm(new ql(new Kl(1,1,1)),16711782);this.visualGeometry=e.geometry,this.visualMaterial=e.material}this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=zm(t.depthMax)?t.depthMax:1/0,this.objectsThreshold=zm(t.objectsThreshold)?t.objectsThreshold:8,this.overlapPct=zm(t.overlapPct)?t.overlapPct:.15,this.undeferred=t.undeferred||!1,this.root=t.root instanceof Wm?t.root:new Wm(t)};Gm.prototype={update:function(){if(this.objectsDeferred.length>0){for(var t=0,e=this.objectsDeferred.length;t<e;t++){var r=this.objectsDeferred[t];this.addDeferred(r.object,r.options)}this.objectsDeferred.length=0}},add:function(t,e){this.undeferred?(this.updateObject(t),this.addDeferred(t,e)):this.objectsDeferred.push({object:t,options:e})},addDeferred:function(t,e){var r,n,i,o,s,a;if(t instanceof Hm&&(t=t.object),t.uuid||(t.uuid=_a.generateUUID()),!this.objectsMap[t.uuid])if(this.objects.push(t),this.objectsMap[t.uuid]=t,e&&(o=e.useFaces,a=e.useVertices),!0===a)for(r=0,n=(s=t.geometry.vertices).length;r<n;r++)this.addObjectData(t,s[r]);else if(!0===o)for(r=0,n=(i=t.geometry.faces).length;r<n;r++)this.addObjectData(t,i[r]);else this.addObjectData(t)},addObjectData:function(t,e){var r=new Hm(t,e);this.objectsData.push(r),this.root.addObject(r)},remove:function(t){var e,r,n,i,o=t;if(t instanceof Hm&&(t=t.object),this.objectsMap[t.uuid]){if(this.objectsMap[t.uuid]=void 0,-1!==(n=Vm(this.objects,t)))for(this.objects.splice(n,1),e=0,r=(i=this.root.removeObject(o)).length;e<r;e++)-1!==(n=Vm(this.objectsData,o=i[e]))&&this.objectsData.splice(n,1)}else this.objectsDeferred.length>0&&-1!==(n=function(t,e,r){for(var n=0,i=t.length;n<i;n++)if(t[n].object===r)return n;return-1}(this.objectsDeferred,0,t))&&this.objectsDeferred.splice(n,1)},extend:function(t){var e,r,n,i;if(t instanceof Gm)for(e=0,r=(n=t.objectsData).length;e<r;e++)this.add(i=n[e],{useFaces:i.faces,useVertices:i.vertices})},rebuild:function(){var t,e,r,n,i,o=[];for(t=0,e=this.objectsData.length;t<e;t++)r=(n=this.objectsData[t]).node,n.update(),r instanceof Wm&&!n.positionLast.equals(n.position)&&(i=n.indexOctant,r.getOctantIndex(n)!==i&&o.push(n));for(t=0,e=o.length;t<e;t++)(n=o[t]).node.removeObject(n),this.root.addObject(n)},updateObject:function(t){var e,r,n,i,o=[t];for(n=t.parent;n;)o.push(n),n=n.parent;for(e=0,r=o.length;e<r;e++)!0===(n=o[e]).matrixWorldNeedsUpdate&&(i=n);"undefined"!=typeof i&&i.updateMatrixWorld()},search:function(t,e,r,n){var i,o,s,a,l,c,u,h,d,p;for(s=[].concat(this.root.objects),e>0||(e=Number.MAX_VALUE),n instanceof Ta&&(n=this.utilVec31Search.copy(n).normalize(),p=this.utilVec32Search.set(1,1,1).divide(n)),i=0,o=this.root.nodesIndices.length;i<o;i++)s=this.root.nodesByIndex[this.root.nodesIndices[i]].search(t,e,s,n,p);if(!0===r)for(c=[],h=[],i=0,o=s.length;i<o;i++)-1===(d=Vm(h,l=(a=s[i]).object))?(c.push(u={object:l,faces:[],vertices:[]}),h.push(l)):u=c[d],a.faces?u.faces.push(a.faces):a.vertices&&u.vertices.push(a.vertices);else c=s;return c},setRoot:function(t){t instanceof Wm&&(this.root=t,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};var Hm=function(t,e){this.object=t,e instanceof Ra?(this.faces=e,this.face3=!0,this.utilVec31FaceBounds=new Ta):e instanceof Ta&&(this.vertices=e),this.radius=0,this.position=new Ta,this.object instanceof Na&&this.update(),this.positionLast=this.position.clone()};Hm.prototype={update:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(t,e){void 0===e.centroid&&(e.centroid=new Ta);var r=(t.geometry||t).vertices,n=e.centroid,i=r[e.a],o=r[e.b],s=r[e.c],a=this.utilVec31FaceBounds;return n.addVectors(i,o).add(s).divideScalar(3),Math.max(a.subVectors(n,i).length(),a.subVectors(n,o).length(),a.subVectors(n,s).length())}};var Wm=function(t){this.utilVec31Branch=new Ta,this.utilVec31Expand=new Ta,this.utilVec31Ray=new Ta,(t=t||{}).tree instanceof Gm?this.tree=t.tree:t.parent instanceof Wm!=1&&(t.root=this,this.tree=new Gm(t)),this.id=this.tree.nodeCount++,this.position=t.position instanceof Ta?t.position:new Ta,this.radius=t.radius>0?t.radius:1,this.indexOctant=t.indexOctant,this.depth=0,this.reset(),this.setParent(t.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new nd(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))};Wm.prototype={setParent:function(t){t!==this&&this.parent!==t&&(this.parent=t,this.updateProperties())},updateProperties:function(){var t,e;for(this.parent instanceof Wm?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,t=0,e=this.nodesIndices.length;t<e;t++)this.nodesByIndex[this.nodesIndices[t]].updateProperties()},reset:function(t,e){var r,n,i,o=this.nodesIndices||[],s=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},r=0,n=o.length;r<n;r++)(i=s[o[r]]).setParent(void 0),!0===t&&i.reset(t,e);!0===e&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(t,e){t.indexOctant=e,-1===Vm(this.nodesIndices,e)&&this.nodesIndices.push(e),this.nodesByIndex[e]=t,t.parent!==this&&t.setParent(this)},removeNode:function(t){var e,r;e=Vm(this.nodesIndices,t),this.nodesIndices.splice(e,1),r=r||this.nodesByIndex[t],delete this.nodesByIndex[t],r.parent===this&&r.setParent(void 0)},addObject:function(t){var e;(e=this.getOctantIndex(t))>-1&&this.nodesIndices.length>0?this.branch(e).addObject(t):e<-1&&this.parent instanceof Wm?this.parent.addObject(t):(-1===Vm(this.objects,t)&&this.objects.push(t),t.node=this,this.checkGrow())},addObjectWithoutCheck:function(t){var e,r,n;for(e=0,r=t.length;e<r;e++)this.objects.push(n=t[e]),n.node=this},removeObject:function(t){var e,r,n,i;if((n=(i=this.removeObjectRecursive(t,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]})).nodesRemovedFrom).length>0)for(e=0,r=n.length;e<r;e++)n[e].shrink();return i.objectsDataRemoved},removeObjectRecursive:function(t,e){var r,n,i,o,s=-1;if(t instanceof Hm)-1!==(s=Vm(this.objects,t))&&(this.objects.splice(s,1),t.node=void 0,e.objectsDataRemoved.push(t),e.searchComplete=o=!0);else for(r=this.objects.length-1;r>=0;r--)if((i=this.objects[r]).object===t&&(this.objects.splice(r,1),i.node=void 0,e.objectsDataRemoved.push(i),o=!0,!i.faces&&!i.vertices)){e.searchComplete=!0;break}if(!0===o&&e.nodesRemovedFrom.push(this),!0!==e.searchComplete)for(r=0,n=this.nodesIndices.length;r<n&&!0!==(e=this.nodesByIndex[this.nodesIndices[r]].removeObjectRecursive(t,e)).searchComplete;r++);return e},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var t,e,r,n,i=[],o=[],s=[],a=[],l=[];for(r=0,n=this.objects.length;r<n;r++)(t=this.getOctantIndex(e=this.objects[r]))>-1?(s.push(e),a.push(t)):t<-1?(i.push(e),o.push(t)):l.push(e);s.length>0&&(l=l.concat(this.split(s,a))),i.length>0&&(l=l.concat(this.expand(i,o))),this.objects=l,this.checkMerge()},split:function(t,e){var r,n,i,o,s;if(this.depth<this.tree.depthMax){for(t=t||this.objects,e=e||[],s=[],r=0,n=t.length;r<n;r++)o=t[r],(i=e[r])>-1?this.branch(i).addObject(o):s.push(o);t===this.objects&&(this.objects=s)}else s=this.objects;return s},branch:function(t){var e,r,n,i,o;return this.nodesByIndex[t]instanceof Wm?e=this.nodesByIndex[t]:(n=(r=.5*this.radiusOverlap)-r*this.tree.overlapPct,i=this.utilVec31Branch.set(1&t?n:-n,2&t?n:-n,4&t?n:-n),o=(new Ta).addVectors(this.position,i),e=new Wm({tree:this.tree,parent:this,position:o,radius:r,indexOctant:t}),this.addNode(e,t)),e},expand:function(t,e){var r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g,y,x,b,w,_,S,T,M,A,E,C,P=this.tree.INDEX_OUTSIDE_MAP,O=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(t=t||this.objects,e=e||[],o=[],s=[],r=0,n=P.length;r<n;r++)P[r].count=0;for(r=0,n=t.length;r<n;r++)i=t[r],(a=e[r])<-1?((l=-a-this.tree.INDEX_OUTSIDE_OFFSET)&this.tree.FLAG_POS_X?P[this.tree.INDEX_OUTSIDE_POS_X].count++:l&this.tree.FLAG_NEG_X&&P[this.tree.INDEX_OUTSIDE_NEG_X].count++,l&this.tree.FLAG_POS_Y?P[this.tree.INDEX_OUTSIDE_POS_Y].count++:l&this.tree.FLAG_NEG_Y&&P[this.tree.INDEX_OUTSIDE_NEG_Y].count++,l&this.tree.FLAG_POS_Z?P[this.tree.INDEX_OUTSIDE_POS_Z].count++:l&this.tree.FLAG_NEG_Z&&P[this.tree.INDEX_OUTSIDE_NEG_Z].count++,s.push(i)):o.push(i);if(s.length>0)for((u=P.slice(0)).sort(function(t,e){return e.count-t.count}),g=u[2],m=1|(d=(1|(v=u[1]).index)!=(f=1|(h=u[0]).index)?v:g).index,x=1|(g=u[3]).index,a=this.getOctantIndexFromPosition(b=h.x+d.x+(p=(y=1|(v=u[2]).index)!==f&&y!==m?v:x!==f&&x!==m?g:u[4]).x,w=h.y+d.y+p.y,_=h.z+d.z+p.z),c=this.getOctantIndexFromPosition(-b,-w,-_),S=this.overlap,T=this.radius,M=(A=this.tree.overlapPct>0?S/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*T)+A*this.tree.overlapPct-(T+S),O.set(1&a?M:-M,2&a?M:-M,4&a?M:-M),E=(new Ta).addVectors(this.position,O),(C=new Wm({tree:this.tree,position:E,radius:A})).addNode(this,c),this.tree.setRoot(C),r=0,n=s.length;r<n;r++)this.tree.root.addObject(s[r]);t===this.objects&&(this.objects=o)}else o=t;return o},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var t,e=this;e.parent instanceof Wm&&e.getObjectCountEnd()<this.tree.objectsThreshold;)t=e,e=e.parent;e!==this&&e.merge(t)},merge:function(t){var e,r,n;for(e=0,r=(t=function(t){return t?!0!==function(t){return"[object Array]"===Object.prototype.toString.call(t)}(t)?[t]:t:[]}(t)).length;e<r;e++)this.addObjectWithoutCheck((n=t[e]).getObjectsEnd()),n.reset(!0,!0),this.removeNode(n.indexOctant,n);this.checkMerge()},checkContract:function(){var t,e,r,n,i,o,s;if(this.nodesIndices.length>0){for(o=0,s=this.objects.length,t=0,e=this.nodesIndices.length;t<e;t++)s+=n=(r=this.nodesByIndex[this.nodesIndices[t]]).getObjectCountEnd(),(i instanceof Wm==0||n>o)&&(i=r,o=n);(s-=o)<this.tree.objectsThreshold&&i instanceof Wm&&this.contract(i)}},contract:function(t){var e,r,n;for(e=0,r=this.nodesIndices.length;e<r;e++)(n=this.nodesByIndex[this.nodesIndices[e]])!==t&&(t.addObjectWithoutCheck(n.getObjectsEnd()),n.reset(!0,!0));t.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(t),t.checkContract()},getOctantIndex:function(t){var e,r,n,i,o,s,a,l,c=this.position,u=this.radiusOverlap,h=this.overlap,d=0;if(t instanceof Hm?(r=t.radius,t.positionLast.copy(e=t.position)):t instanceof Wm&&(e=t.position,r=0),n=e.x-c.x,i=e.y-c.y,o=e.z-c.z,s=Math.abs(n),a=Math.abs(i),l=Math.abs(o),Math.max(s,a,l)+r>u)return s+r>u&&(d^=n>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),a+r>u&&(d^=i>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),l+r>u&&(d^=o>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),t.indexOctant=-d-this.tree.INDEX_OUTSIDE_OFFSET,t.indexOctant;if(n-r>-h)d|=1;else if(!(n+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(i-r>-h)d|=2;else if(!(i+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;if(o-r>-h)d|=4;else if(!(o+r<h))return t.indexOctant=this.tree.INDEX_INSIDE_CROSS,t.indexOctant;return t.indexOctant=d,t.indexOctant},getOctantIndexFromPosition:function(t,e,r){var n=0;return t>0&&(n|=1),e>0&&(n|=2),r>0&&(n|=4),n},search:function(t,e,r,n,i){var o,s;if(!0===(n?this.intersectRay(t,n,e,i):this.intersectSphere(t,e)))for(r=r.concat(this.objects),o=0,s=this.nodesIndices.length;o<s;o++)r=this.nodesByIndex[this.nodesIndices[o]].search(t,e,r,n);return r},intersectSphere:function(t,e){var r=e*e,n=t.x,i=t.y,o=t.z;return n<this.left?r-=Math.pow(n-this.left,2):n>this.right&&(r-=Math.pow(n-this.right,2)),i<this.bottom?r-=Math.pow(i-this.bottom,2):i>this.top&&(r-=Math.pow(i-this.top,2)),o<this.back?r-=Math.pow(o-this.back,2):o>this.front&&(r-=Math.pow(o-this.front,2)),r>=0},intersectRay:function(t,e,r,n){"undefined"==typeof n&&(n=this.utilVec31Ray.set(1,1,1).divide(e));var i,o=(this.left-t.x)*n.x,s=(this.right-t.x)*n.x,a=(this.bottom-t.y)*n.y,l=(this.top-t.y)*n.y,c=(this.back-t.z)*n.z,u=(this.front-t.z)*n.z,h=Math.min(Math.min(Math.max(o,s),Math.max(a,l)),Math.max(c,u));return!(h<0||(i=Math.max(Math.max(Math.min(o,s),Math.min(a,l)),Math.min(c,u)))>h||i>r)},getDepthEnd:function(t){var e,r;if(this.nodesIndices.length>0)for(e=0,r=this.nodesIndices.length;e<r;e++)t=this.nodesByIndex[this.nodesIndices[e]].getDepthEnd(t);else t=!t||this.depth>t?this.depth:t;return t},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var t,e,r=this.nodesIndices.length;for(t=0,e=this.nodesIndices.length;t<e;t++)r+=this.nodesByIndex[this.nodesIndices[t]].getNodeCountRecursive();return r},getObjectsEnd:function(t){var e,r;for(t=(t||[]).concat(this.objects),e=0,r=this.nodesIndices.length;e<r;e++)t=this.nodesByIndex[this.nodesIndices[e]].getObjectsEnd(t);return t},getObjectCountEnd:function(){var t,e,r=this.objects.length;for(t=0,e=this.nodesIndices.length;t<e;t++)r+=this.nodesByIndex[this.nodesIndices[t]].getObjectCountEnd();return r},getObjectCountStart:function(){for(var t=this.objects.length,e=this.parent;e instanceof Wm;)t+=e.objects.length,e=e.parent;return t},toConsole:function(t){var e,r;for(t="string"==typeof t?t:"   ",console.log(this.parent?t+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?t+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?t+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),e=0,r=this.nodesIndices.length;e<r;e++)this.nodesByIndex[this.nodesIndices[e]].toConsole(t+"   ")}},nu.prototype.intersectOctreeObject=function(t,e){var r,n,i,o;return t.object instanceof Na?(i=(t=(n=t).object).geometry.faces,(o=n.faces).length>0&&(t.geometry.faces=o),r=this.intersectObject(t,e),o.length>0&&(t.geometry.faces=i)):r=this.intersectObject(t,e),r},nu.prototype.intersectOctreeObjects=function(t,e){var r,n,i=[];for(r=0,n=t.length;r<n;r++)i=i.concat(this.intersectOctreeObject(t[r],e));return i};var Xm=function(t,e){this.cubeLods=t,this.numLods=e;var r=4*t[0].width,n=t[0].texture,i={format:n.format,magFilter:n.magFilter,minFilter:n.minFilter,type:n.type,generateMipmaps:n.generateMipmaps,anisotropy:n.anisotropy,encoding:3002===n.encoding?3005:n.encoding};3005===i.encoding&&(i.magFilter=wl,i.minFilter=wl),this.CubeUVRenderTarget=new Ac(r,r,i),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=306,this.camera=new Sc(.5*-r,.5*r,.5*-r,.5*r,0,1e3),this.scene=new _c,this.scene.add(this.camera),this.objects=[];var o=[];o.push(new ka(0,0)),o.push(new ka(1,0)),o.push(new ka(2,0)),o.push(new ka(0,1)),o.push(new ka(1,1)),o.push(new ka(2,1));var s=r;r=t[0].width;var a=0,l=4;this.numLods=Math.log(t[0].width)/Math.log(2)-2;for(var c=0;c<this.numLods;c++){var u=.5*(s-s/l);r>16&&(l*=2);for(var h=r>16?6:1,d=0,p=0,f=r,m=0;m<h;m++){for(var v=0;v<6;v++){var g=this.getShader();g.uniforms.envMap.value=this.cubeLods[c].texture,g.envMap=this.cubeLods[c].texture,g.uniforms.faceIndex.value=v,g.uniforms.mapSize.value=f;var y=new ql(new Pc(f,f,0),g);y.position.x=o[v].x*f-u+d,y.position.y=o[v].y*f-u+a+p,y.material.side=il,this.scene.add(y),this.objects.push(y)}p+=1.75*f,d+=1.25*f,f/=2}a+=2*r,r>16&&(r/=2)}};function qm(t,e,r){Ac.call(this,t,e,r),this.activeCubeFace=0,this.activeMipMapLevel=0}Xm.prototype={constructor:Xm,update:function(t){var e=t.gammaInput,r=t.gammaOutput,n=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.gammaInput=!1,t.gammaOutput=!1,t.toneMapping=1,t.toneMappingExposure=1,t.render(this.scene,this.camera,this.CubeUVRenderTarget,!1),t.setRenderTarget(o),t.toneMapping=n,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=r},getShader:function(){return new Cc({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new Ta(1,1,1)}},vertexShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tvoid main() {\t\t\t\t\tvUv = uv;\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\t\t\t\t}",fragmentShader:"precision highp float;\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform samplerCube envMap;\t\t\t\tuniform float mapSize;\t\t\t\tuniform vec3 testColor;\t\t\t\tuniform int faceIndex;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec3 sampleDirection;\t\t\t\t\tvec2 uv = vUv;\t\t\t\t\tuv = uv * 2.0 - 1.0;\t\t\t\t\tuv.y *= -1.0;\t\t\t\t\tif(faceIndex == 0) {\t\t\t\t\t\tsampleDirection = normalize(vec3(1.0, uv.y, -uv.x));\t\t\t\t\t} else if(faceIndex == 1) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, 1.0, uv.y));\t\t\t\t\t} else if(faceIndex == 2) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, uv.y, 1.0));\t\t\t\t\t} else if(faceIndex == 3) {\t\t\t\t\t\tsampleDirection = normalize(vec3(-1.0, uv.y, uv.x));\t\t\t\t\t} else if(faceIndex == 4) {\t\t\t\t\t\tsampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));\t\t\t\t\t} else {\t\t\t\t\t\tsampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));\t\t\t\t\t}\t\t\t\t\tvec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );\t\t\t\t\tgl_FragColor = linearToOutputTexel( color );\t\t\t\t}",blending:5,premultipliedAlpha:!1,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:cl})}},(qm.prototype=Object.create(Ac.prototype)).constructor=qm,qm.prototype.isWebGLRenderTargetCube=!0;var Ym=function(t,e,r){this.sourceTexture=t,this.resolution=void 0!==r?r:256,this.samplesPerLevel=void 0!==e?e:16;var n=t.encoding===kl||3007===t.encoding||3001===t.encoding;this.sourceTexture.minFilter=n?wl:bl,this.sourceTexture.magFilter=n?wl:bl,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&n,this.cubeLods=[];var i=this.resolution,o={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var s=0;s<this.numLods;s++){var a=new qm(i,i,o);a.texture.name="PMREMGenerator.cube"+s,this.cubeLods.push(a),i=Math.max(16,i/2)}this.camera=new Sc(-1,1,1,-1,0,1e3),this.shader=this.getShader(),this.shader.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,this.planeMesh=new ql(new Pc(2,2,0),this.shader),this.planeMesh.material.side=il,this.scene=new _c,this.scene.add(this.planeMesh),this.scene.add(this.camera),this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture};Ym.prototype={constructor:Ym,update:function(t){this.shader.uniforms.envMap.value=this.sourceTexture,this.shader.envMap=this.sourceTexture;var e=t.gammaInput,r=t.gammaOutput,n=t.toneMapping,i=t.toneMappingExposure,o=t.getRenderTarget();t.toneMapping=1,t.toneMappingExposure=1,t.gammaInput=!1,t.gammaOutput=!1;for(var s=0;s<this.numLods;s++)this.shader.uniforms.roughness.value=s/(this.numLods-1)*.9,this.shader.uniforms.queryScale.value.x=0==s?-1:1,this.shader.uniforms.mapSize.value=this.cubeLods[s].width,this.renderToCubeMapTarget(t,this.cubeLods[s]),s<5&&(this.shader.uniforms.envMap.value=this.cubeLods[s].texture);t.setRenderTarget(o),t.toneMapping=n,t.toneMappingExposure=i,t.gammaInput=e,t.gammaOutput=r},renderToCubeMapTarget:function(t,e){for(var r=0;r<6;r++)this.renderToCubeMapTargetFace(t,e,r)},renderToCubeMapTargetFace:function(t,e,r){e.activeCubeFace=r,this.shader.uniforms.faceIndex.value=r,t.render(this.scene,this.camera,e,!0)},getShader:function(){return new Cc({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},queryScale:{value:new Ta(1,1,1)},testColor:{value:new Ta(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform vec3 testColor;\n\t\t\t\tuniform vec3 queryScale;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tmat3 vecSpace = matrixFromVector(normalize(sampleDirection * queryScale));\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap,vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:5,blendSrc:201,blendDst:200,blendSrcAlpha:201,blendDstAlpha:200,blendEquation:cl})}};var Zm={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},Jm={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},Qm={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE","float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif","float fLumPixel = linearToRelativeLuminance( vColor );","float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},Km=function(t,e){fm.call(this),this.resolution=void 0!==e?e:256,this.needsInit=!0,this.adaptive=void 0===t||!!t,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===Zm&&console.error("AdaptiveToneMappingPass relies on CopyShader");var r=Zm;this.copyUniforms=Ec.clone(r.uniforms),this.materialCopy=new Cc({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:0,depthTest:!1}),void 0===Jm&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new Cc({uniforms:Ec.clone(Jm.uniforms),vertexShader:Jm.vertexShader,fragmentShader:Jm.fragmentShader,blending:0}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","float fLastLum = max( minLuminance, lastLum.r );","float fCurrentLum = max( minLuminance, currentLum.r );","fCurrentLum *= fCurrentLum;","float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","gl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new Cc({uniforms:Ec.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:0}),void 0===Qm&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new Cc({uniforms:Ec.clone(Qm.uniforms),vertexShader:Qm.vertexShader,fragmentShader:Qm.fragmentShader,blending:0}),this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Km.prototype=Object.assign(Object.create(fm.prototype),{constructor:Km,render:function(t,e,r,n,i){this.needsInit&&(this.reset(t),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,t.render(this.scene,this.camera,this.currentLuminanceRT),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,t.render(this.scene,this.camera,this.luminanceRT),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,t.render(this.scene,this.camera,this.previousLuminanceRT)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},reset:function(t){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var e={minFilter:wl,magFilter:wl,format:El};this.luminanceRT=new Ac(this.resolution,this.resolution,e),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new Ac(this.resolution,this.resolution,e),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,e.minFilter=_l,this.currentLuminanceRT=new Ac(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new zl({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(t){t?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(t){t&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(t))},setMinLuminance:function(t){t&&(this.materialToneMap.uniforms.minLuminance.value=t,this.materialAdaptiveLum.uniforms.minLuminance.value=t)},setMaxLuminance:function(t){t&&(this.materialToneMap.uniforms.maxLuminance.value=t)},setAverageLuminance:function(t){t&&(this.materialToneMap.uniforms.averageLuminance.value=t)},setMiddleGrey:function(t){t&&(this.materialToneMap.uniforms.middleGrey.value=t)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var $m={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new ka(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-t*t/(2*e*e))}var r,n,i,o,s=2*Math.ceil(3*t)+1;for(s>25&&(s=25),o=.5*(s-1),n=new Array(s),i=0,r=0;r<s;++r)n[r]=e(r-o,t),i+=n[r];for(r=0;r<s;++r)n[r]/=i;return n}},tv=function(t,e,r,n){fm.call(this),t=void 0!==t?t:1,e=void 0!==e?e:25,r=void 0!==r?r:4;var i={minFilter:wl,magFilter:wl,format:El};this.renderTargetX=new Ac(n=void 0!==n?n:256,n,i),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new Ac(n,n,i),this.renderTargetY.texture.name="BloomPass.y",void 0===Zm&&console.error("BloomPass relies on CopyShader");var o=Zm;this.copyUniforms=Ec.clone(o.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new Cc({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:2,transparent:!0}),void 0===$m&&console.error("BloomPass relies on ConvolutionShader");var s=$m;this.convolutionUniforms=Ec.clone(s.uniforms),this.convolutionUniforms.uImageIncrement.value=tv.blurX,this.convolutionUniforms.cKernel.value=$m.buildKernel(r),this.materialConvolution=new Cc({uniforms:this.convolutionUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)}}),this.needsSwap=!1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};tv.prototype=Object.assign(Object.create(fm.prototype),{constructor:tv,render:function(t,e,r,n,i){i&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=tv.blurX,t.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=tv.blurY,t.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,this.clear)}}),tv.blurX=new ka(.001953125,0),tv.blurY=new ka(0,.001953125);var ev=function(t,e,r){fm.call(this),this.scene=t,this.camera=e;var n=void 0!==r.focus?r.focus:1,i=void 0!==r.aspect?r.aspect:e.aspect,o=void 0!==r.aperture?r.aperture:.025,s=void 0!==r.maxblur?r.maxblur:1,a=r.width||window.innerWidth||1,l=r.height||window.innerHeight||1;this.renderTargetColor=new Ac(a,l,{minFilter:wl,magFilter:wl,format:Al}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new wc,this.materialDepth.depthPacking=3201,this.materialDepth.blending=0,void 0===Nc&&console.error("BokehPass relies on BokehShader");var c=Nc,u=Ec.clone(c.uniforms);u.tDepth.value=this.renderTargetDepth.texture,u.focus.value=n,u.aspect.value=i,u.aperture.value=o,u.maxblur.value=s,u.nearClip.value=e.near,u.farClip.value=e.far,this.materialBokeh=new Cc({defines:Object.assign({},c.defines),uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.uniforms=u,this.needsSwap=!1,this.camera2=new Sc(-1,1,1,-1,0,1),this.scene2=new _c,this.quad2=new ql(new Oc(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Ia,this.oldClearAlpha=1};ev.prototype=Object.assign(Object.create(fm.prototype),{constructor:ev,render:function(t,e,r,n,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha(),t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.render(this.scene,this.camera,this.renderTargetDepth,!0),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?t.render(this.scene2,this.camera2):t.render(this.scene2,this.camera2,e,this.clear),this.scene.overrideMaterial=null,t.setClearColor(this.oldClearColor),t.setClearAlpha(this.oldClearAlpha),t.autoClear=this.oldAutoClear}});var rv=function(t,e){fm.call(this),this.needsSwap=!1,this.clearColor=void 0!==t?t:0,this.clearAlpha=void 0!==e?e:0};rv.prototype=Object.assign(Object.create(fm.prototype),{constructor:rv,render:function(t,e,r,n,i){var o,s;this.clearColor&&(o=t.getClearColor().getHex(),s=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),t.setRenderTarget(this.renderToScreen?null:r),t.clear(),this.clearColor&&t.setClearColor(o,s)}});var nv=function(t,e,r){fm.call(this),this.camera=t,this.needsSwap=!1,this.cubeShader=ih.cube,this.cubeMesh=new ql(new $l(10,10,10),new Cc({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:nl})),this.envMap=e,this.opacity=void 0!==r?r:1,this.cubeScene=new _c,this.cubeCamera=new bc,this.cubeScene.add(this.cubeMesh)};nv.prototype=Object.assign(Object.create(fm.prototype),{constructor:nv,render:function(t,e,r,n,i){var o=t.autoClear;t.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,t.render(this.cubeScene,this.cubeCamera,this.renderToScreen?null:r,this.clear),t.autoClear=o}});var iv={uniforms:{tDiffuse:{value:null},tSize:{value:new ka(256,256)},center:{value:new ka(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},ov=function(t,e,r){fm.call(this),void 0===iv&&console.error("DotScreenPass relies on DotScreenShader");var n=iv;this.uniforms=Ec.clone(n.uniforms),void 0!==t&&this.uniforms.center.value.copy(t),void 0!==e&&(this.uniforms.angle.value=e),void 0!==r&&(this.uniforms.scale.value=r),this.material=new Cc({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};ov.prototype=Object.assign(Object.create(fm.prototype),{constructor:ov,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var sv=function(t,e){fm.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};sv.prototype=Object.assign(Object.create(fm.prototype),{constructor:sv,render:function(t,e,r,n,i){var o,s,a=t.context,l=t.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),l.buffers.stencil.setFunc(a.ALWAYS,o,4294967295),l.buffers.stencil.setClear(s),t.render(this.scene,this.camera,r,this.clear),t.render(this.scene,this.camera,e,this.clear),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setFunc(a.EQUAL,1,4294967295),l.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP)}});var av=function(){fm.call(this),this.needsSwap=!1};av.prototype=Object.create(fm.prototype),Object.assign(av.prototype,{render:function(t,e,r,n,i){t.state.buffers.stencil.setTest(!1)}}),Object.assign((function(t,e){if(this.renderer=t,void 0===e){var r={minFilter:wl,magFilter:wl,format:El,stencilBuffer:!1},n=t.getDrawingBufferSize();(e=new Ac(n.width,n.height,r)).texture.name="EffectComposer.rt1"}this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===Zm&&console.error("EffectComposer relies on CopyShader"),void 0===mm&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new mm(Zm)}).prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t);var e=this.renderer.getDrawingBufferSize();t.setSize(e.width,e.height)},insertPass:function(t,e){this.passes.splice(e,0,t)},render:function(t){var e,r,n=!1,i=this.passes.length;for(r=0;r<i;r++)if(!1!==(e=this.passes[r]).enabled){if(e.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),e.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==sv&&(e instanceof sv?n=!0:e instanceof av&&(n=!1))}},reset:function(t){if(void 0===t){var e=this.renderer.getDrawingBufferSize();(t=this.renderTarget1.clone()).setSize(e.width,e.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this.renderTarget1.setSize(t,e),this.renderTarget2.setSize(t,e);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(t,e)}});var lv={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},cv=function(t,e,r,n){fm.call(this),void 0===lv&&console.error("FilmPass relies on FilmShader");var i=lv;this.uniforms=Ec.clone(i.uniforms),this.material=new Cc({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==t&&(this.uniforms.nIntensity.value=t),void 0!==e&&(this.uniforms.sIntensity.value=e),void 0!==r&&(this.uniforms.sCount.value=r),this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};cv.prototype=Object.assign(Object.create(fm.prototype),{constructor:cv,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}});var uv={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},hv=function(t){fm.call(this),void 0===uv&&console.error("GlitchPass relies on DigitalGlitch");var e=uv;this.uniforms=Ec.clone(e.uniforms),void 0==t&&(t=64),this.uniforms.tDisp.value=this.generateHeightmap(t),this.material=new Cc({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()};hv.prototype=Object.assign(Object.create(fm.prototype),{constructor:hv,render:function(t,e,r,n,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=_a.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=_a.randFloat(-1,1),this.uniforms.seed_y.value=_a.randFloat(-1,1),this.uniforms.distortion_x.value=_a.randFloat(0,1),this.uniforms.distortion_y.value=_a.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=_a.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=_a.randFloat(0,1),this.uniforms.distortion_y.value=_a.randFloat(0,1),this.uniforms.seed_x.value=_a.randFloat(-.3,.3),this.uniforms.seed_y.value=_a.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},generateTrigger:function(){this.randX=_a.randInt(120,240)},generateHeightmap:function(t){for(var e=new Float32Array(t*t*3),r=t*t,n=0;n<r;n++){var i=_a.randFloat(0,1);e[3*n+0]=i,e[3*n+1]=i,e[3*n+2]=i}var o=new xh(e,t,t,Al,1015);return o.needsUpdate=!0,o}});var dv=function(t,e,r,n){this.renderScene=e,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new Ia(1,1,1),this.hiddenEdgeColor=new Ia(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,fm.call(this),this.resolution=void 0!==t?new ka(t.x,t.y):new ka(256,256);var i={minFilter:wl,magFilter:wl,format:El},o=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new zl({color:16777215}),this.maskBufferMaterial.side=il,this.renderTargetMaskBuffer=new Ac(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new wc,this.depthMaterial.side=il,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=il,this.prepareMaskMaterial.fragmentShader=function(t,e){return t.replace(/DEPTH_TO_VIEW_Z/g,(e.isPerspectiveCamera?"perspective":"orthographic")+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Ac(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Ac(o,s,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Ac(o,s,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Ac(Math.round(o/2),Math.round(s/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Ac(o,s,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Ac(Math.round(o/2),Math.round(s/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new ka(o,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new ka(Math.round(o/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===Zm&&console.error("OutlinePass relies on CopyShader");var a=Zm;this.copyUniforms=Ec.clone(a.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Cc({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Ia,this.oldClearAlpha=1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new Ia,this.tempPulseColor2=new Ia,this.textureMatrix=new Sa};dv.prototype=Object.assign(Object.create(fm.prototype),{constructor:dv,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,e){this.renderTargetMaskBuffer.setSize(t,e);var r=Math.round(t/this.downSampleRatio),n=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value=new ka(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value=new ka(r,n)},changeVisibilityOfSelectedObjects:function(t){function e(e){e instanceof ql&&(e.visible=t)}for(var r=0;r<this.selectedObjects.length;r++)this.selectedObjects[r].traverse(e)},changeVisibilityOfNonSelectedObjects:function(t){var e=[];function r(t){t instanceof ql&&e.push(t)}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(r);this.renderScene.traverse(function(r){if(r instanceof ql||r instanceof Yl||r instanceof Ef){for(var n=!1,i=0;i<e.length;i++)if(e[i].id===r.id){n=!0;break}if(!n){var o=r.visible;t&&!r.bVisible||(r.visible=t),r.bVisible=o}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,e,r,n,i){if(0!==this.selectedObjects.length){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,i&&t.context.disable(t.context.STENCIL_TEST),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.render(this.renderScene,this.renderCamera,this.renderTargetDepthBuffer,!0),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new ka(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.render(this.renderScene,this.renderCamera,this.renderTargetMaskBuffer,!0),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=s,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var a=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(a),this.tempPulseColor2.multiplyScalar(a)}this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new ka(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=dv.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=dv.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=dv.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=dv.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},getPrepareMaskMaterial:function(){return new Cc({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new ka(.5,.5)},textureMatrix:{value:new Sa}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new Cc({uniforms:{maskTexture:{value:null},texSize:{value:new ka(.5,.5)},visibleEdgeColor:{value:new Ta(1,1,1)},hiddenEdgeColor:{value:new Ta(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new Cc({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new ka(.5,.5)},direction:{value:new ka(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new Cc({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),dv.BlurDirectionX=new ka(1,0),dv.BlurDirectionY=new ka(0,1);var pv=function(t,e,r,n,i){fm.call(this),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function fv(t,e,r,n,i,o,s,a,l,c){if((c=void 0!==c?c:Pl)!==Pl&&c!==Ol)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===r&&c===Pl&&(r=Tl),void 0===r&&c===Ol&&(r=Ml),Mc.call(this,null,n,i,o,s,a,c,r,l),this.image={width:t,height:e},this.magFilter=void 0!==s?s:bl,this.minFilter=void 0!==a?a:bl,this.flipY=!1,this.generateMipmaps=!1}pv.prototype=Object.assign(Object.create(fm.prototype),{constructor:pv,render:function(t,e,r,n,i){var o,s,a=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=t.getClearColor().getHex(),s=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),this.clearColor&&t.setClearColor(o,s),this.scene.overrideMaterial=null,t.autoClear=a}}),(fv.prototype=Object.create(Mc.prototype)).constructor=fv,fv.prototype.isDepthTexture=!0;var mv={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},size:{type:"v2",value:new ka(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new Sa},cameraInverseProjectionMatrix:{type:"m4",value:new Sa},scale:{type:"f",value:1},intensity:{type:"f",value:.1},bias:{type:"f",value:.5},minResolution:{type:"f",value:0},kernelRadius:{type:"f",value:100},randomSeed:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},vv={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new ka(512,512)},sampleUvOffsets:{type:"v2v",value:[new ka(0,0)]},sampleWeights:{type:"1fv",value:[1]},tDepth:{type:"t",value:null},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3},depthCutoff:{type:"f",value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},gv={createSampleWeights:function(t,e){for(var r=function(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)},n=[],i=0;i<=t;i++)n.push(r(i,e));return n},createSampleOffsets:function(t,e){for(var r=[],n=0;n<=t;n++)r.push(e.clone().multiplyScalar(n));return r},configure:function(t,e,r,n){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=gv.createSampleOffsets(e,n),t.uniforms.sampleWeights.value=gv.createSampleWeights(e,r),t.needsUpdate=!0}},yv={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},xv=function(t,e,r,n,i){fm.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==r&&r,this.supportsNormalTexture=void 0!==n&&n,this.oldClearColor=new Ia,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new ka(i.x,i.y):new ka(256,256),this.saoRenderTarget=new Ac(this.resolution.x,this.resolution.y,{minFilter:wl,magFilter:wl,format:El}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Ac(this.resolution.x,this.resolution.y,{minFilter:bl,magFilter:bl,format:El}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&((r=new fv).type=Tl,r.minFilter=bl,r.maxFilter=bl,this.beautyRenderTarget.depthTexture=r,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new wc,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.normalMaterial=new zc,this.normalMaterial.blending=0,void 0===mv&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new Cc({defines:Object.assign({},mv.defines),fragmentShader:mv.fragmentShader,vertexShader:mv.vertexShader,uniforms:Ec.clone(mv.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,void 0===vv&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new Cc({uniforms:Ec.clone(vv.uniforms),defines:Object.assign({},vv.defines),vertexShader:vv.vertexShader,fragmentShader:vv.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new Cc({uniforms:Ec.clone(vv.uniforms),defines:Object.assign({},vv.defines),vertexShader:vv.vertexShader,fragmentShader:vv.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,void 0===Zm&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new Cc({uniforms:Ec.clone(Zm.uniforms),vertexShader:Zm.vertexShader,fragmentShader:Zm.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=5,this.materialCopy.blendSrc=208,this.materialCopy.blendDst=200,this.materialCopy.blendEquation=cl,this.materialCopy.blendSrcAlpha=206,this.materialCopy.blendDstAlpha=200,this.materialCopy.blendEquationAlpha=cl,void 0===Zm&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new Cc({uniforms:Ec.clone(yv.uniforms),vertexShader:yv.vertexShader,fragmentShader:yv.fragmentShader,blending:0}),this.quadCamera=new Sc(-1,1,1,-1,0,1),this.quadScene=new _c,this.quad=new ql(new Pc(2,2),null),this.quadScene.add(this.quad)};xv.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},xv.prototype=Object.assign(Object.create(fm.prototype),{constructor:xv,render:function(t,e,r,n,i){if(this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.clearTarget(this.depthRenderTarget),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(gv.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ka(0,1)),gv.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ka(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),t.setClearColor(0),t.render(this.scene,this.camera,this.beautyRenderTarget,!0),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var a=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),a.blending=0===this.params.output?5:0,this.renderPass(t,a,this.renderToScreen?null:r),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}},renderPass:function(t,e,r,n,i){var o=t.getClearColor(),s=t.getClearAlpha(),a=t.autoClear;t.autoClear=!1;var l=void 0!==n&&null!==n;l&&(t.setClearColor(n),t.setClearAlpha(i||0)),this.quad.material=e,t.render(this.quadScene,this.quadCamera,r,l),t.autoClear=a,t.setClearColor(o),t.setClearAlpha(s)},renderOverride:function(t,e,r,n,i){var o=t.getClearColor(),s=t.getClearAlpha(),a=t.autoClear;t.autoClear=!1,n=e.clearColor||n,i=e.clearAlpha||i;var l=void 0!==n&&null!==n;l&&(t.setClearColor(n),t.setClearAlpha(i||0)),this.scene.overrideMaterial=e,t.render(this.scene,this.camera,r,l),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(o),t.setClearAlpha(s)},setSize:function(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}});var bv=function(t){fm.call(this),void 0===Zm&&console.error("SavePass relies on CopyShader");var e=Zm;this.textureID="tDiffuse",this.uniforms=Ec.clone(e.uniforms),this.material=new Cc({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderTarget=t,void 0===this.renderTarget&&(this.renderTarget=new Ac(window.innerWidth,window.innerHeight,{minFilter:wl,magFilter:wl,format:Al,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};bv.prototype=Object.assign(Object.create(fm.prototype),{constructor:bv,render:function(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,t.render(this.scene,this.camera,this.renderTarget,this.clear)}});var wv=[{defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new ka(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );","vec2 edges = step( threshold, delta.xy );","if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;","vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );","float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );","maxDelta = max( max( maxDelta, delta.z ), delta.w );","edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new ka(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x += 0.25 * resolution.x;","texcoord.x += resolution.x;","texcoord.x += 2.0 * resolution.x;","texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;","texcoord.y -= resolution.y;","texcoord.y -= 2.0 * resolution.y;","texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;","texcoord.y += resolution.y;","texcoord.y += 2.0 * resolution.y;","texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {","vec2 d;","vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;","d.x = coords.x;","float e1 = texture2D( edgesTex, coords, 0.0 ).r;","coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;","d = d / resolution.x - pixcoord.x;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {","vec2 d;","vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;","d.x = coords.y;","float e1 = texture2D( edgesTex, coords, 0.0 ).g;","coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;","d = d / resolution.y - pixcoord.y;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new ka(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;","if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {","vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;","offset.y = a.g > a.r ? -a.g : a.r;","if ( abs( offset.x ) > abs( offset.y )) {","offset.y = 0.0;","} else {","offset.x = 0.0;","}","vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}],_v=function(t,e){fm.call(this),this.edgesRT=new Ac(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:wl,format:Al}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new Ac(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:wl,format:El}),this.weightsRT.texture.name="SMAAPass.weights";var r=new Image;r.src=this.getAreaTexture(),this.areaTexture=new Mc,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=r,this.areaTexture.format=Al,this.areaTexture.minFilter=wl,this.areaTexture.generateMipmaps=!1,this.areaTexture.needsUpdate=!0,this.areaTexture.flipY=!1;var n=new Image;n.src=this.getSearchTexture(),this.searchTexture=new Mc,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=n,this.searchTexture.magFilter=bl,this.searchTexture.minFilter=bl,this.searchTexture.generateMipmaps=!1,this.searchTexture.needsUpdate=!0,this.searchTexture.flipY=!1,void 0===wv&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=Ec.clone(wv[0].uniforms),this.uniformsEdges.resolution.value.set(1/t,1/e),this.materialEdges=new Cc({defines:Object.assign({},wv[0].defines),uniforms:this.uniformsEdges,vertexShader:wv[0].vertexShader,fragmentShader:wv[0].fragmentShader}),this.uniformsWeights=Ec.clone(wv[1].uniforms),this.uniformsWeights.resolution.value.set(1/t,1/e),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new Cc({defines:Object.assign({},wv[1].defines),uniforms:this.uniformsWeights,vertexShader:wv[1].vertexShader,fragmentShader:wv[1].fragmentShader}),this.uniformsBlend=Ec.clone(wv[2].uniforms),this.uniformsBlend.resolution.value.set(1/t,1/e),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new Cc({uniforms:this.uniformsBlend,vertexShader:wv[2].vertexShader,fragmentShader:wv[2].fragmentShader}),this.needsSwap=!1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};_v.prototype=Object.assign(Object.create(fm.prototype),{constructor:_v,render:function(t,e,r,n,i){this.uniformsEdges.tDiffuse.value=r.texture,this.quad.material=this.materialEdges,t.render(this.scene,this.camera,this.edgesRT,this.clear),this.quad.material=this.materialWeights,t.render(this.scene,this.camera,this.weightsRT,this.clear),this.uniformsBlend.tColor.value=r.texture,this.quad.material=this.materialBlend,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)},setSize:function(t,e){this.edgesRT.setSize(t,e),this.weightsRT.setSize(t,e),this.materialEdges.uniforms.resolution.value.set(1/t,1/e),this.materialWeights.uniforms.resolution.value.set(1/t,1/e),this.materialBlend.uniforms.resolution.value.set(1/t,1/e)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var Sv=function(t,e,r,n){fm.call(this),this.scene=t,this.camera=e,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,void 0===Zm&&console.error("SSAARenderPass relies on CopyShader");var i=Zm;this.copyUniforms=Ec.clone(i.uniforms),this.copyMaterial=new Cc({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.camera2=new Sc(-1,1,1,-1,0,1),this.scene2=new _c,this.quad2=new ql(new Pc(2,2),this.copyMaterial),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2)};Sv.prototype=Object.assign(Object.create(fm.prototype),{constructor:Sv,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,e){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,e)},render:function(t,e,r){this.sampleRenderTarget||(this.sampleRenderTarget=new Ac(r.width,r.height,{minFilter:wl,magFilter:wl,format:El}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=Sv.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=t.autoClear;t.autoClear=!1;var o=t.getClearColor().getHex(),s=t.getClearAlpha(),a=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var l=r.width,c=r.height,u=0;u<n.length;u++){var h=n[u];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,.0625*h[0],.0625*h[1],l,c);var d=a;this.unbiased&&(d+=1/32*((u+.5)/n.length-.5)),this.copyUniforms.opacity.value=d,t.setClearColor(this.clearColor,this.clearAlpha),t.render(this.scene,this.camera,this.sampleRenderTarget,!0),0===u&&t.setClearColor(0,0),t.render(this.scene2,this.camera2,this.renderToScreen?null:e,0===u)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=i,t.setClearColor(o,s)}}),Sv.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Tv={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new ka(512,512)},cameraNear:{value:1},cameraFar:{value:100},radius:{value:32},onlyAO:{value:0},aoClamp:{value:.25},lumInfluence:{value:.7}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#endif","uniform float radius;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","const int samples = 64;","const bool useNoise = true;","const float noiseAmount = 0.0004;","const float diffArea = 0.4;","const float gDisplace = 0.4;","#include <packing>","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","#ifdef USE_LOGDEPTHBUF","float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );","float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;","float z = (logz / w) + 1.0;","#else","float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );","#endif","return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 8.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * ( dd * dd ) / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + radius * vv;","vec2 coord2 = vUv - radius * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / size.x ) / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float l = 0.0;","float z = 1.0 - dz / 2.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},Mv=function(t,e,r,n){if(void 0===Tv)return console.warn("SSAOPass depends on SSAOShader"),new mm;mm.call(this,Tv),this.width=void 0!==r?r:512,this.height=void 0!==n?n:256,this.renderToScreen=!1,this.camera2=e,this.scene2=t,this.depthMaterial=new wc,this.depthMaterial.depthPacking=3201,this.depthMaterial.blending=0,this.depthRenderTarget=new Ac(this.width,this.height,{minFilter:wl,magFilter:wl}),this.uniforms.tDepth.value=this.depthRenderTarget.texture,this.uniforms.size.value.set(this.width,this.height),this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far,this.uniforms.radius.value=4,this.uniforms.onlyAO.value=!1,this.uniforms.aoClamp.value=.25,this.uniforms.lumInfluence.value=.7,Object.defineProperties(this,{radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},onlyAO:{get:function(){return this.uniforms.onlyAO.value},set:function(t){this.uniforms.onlyAO.value=t}},aoClamp:{get:function(){return this.uniforms.aoClamp.value},set:function(t){this.uniforms.aoClamp.value=t}},lumInfluence:{get:function(){return this.uniforms.lumInfluence.value},set:function(t){this.uniforms.lumInfluence.value=t}}})};(Mv.prototype=Object.create(mm.prototype)).render=function(t,e,r,n,i){this.scene2.overrideMaterial=this.depthMaterial,t.render(this.scene2,this.camera2,this.depthRenderTarget,!0),this.scene2.overrideMaterial=null,mm.prototype.render.call(this,t,e,r,n,i)},Mv.prototype.setScene=function(t){this.scene2=t},Mv.prototype.setCamera=function(t){this.camera2=t,this.uniforms.cameraNear.value=this.camera2.near,this.uniforms.cameraFar.value=this.camera2.far},Mv.prototype.setSize=function(t,e){this.width=t,this.height=e,this.uniforms.size.value.set(this.width,this.height),this.depthRenderTarget.setSize(this.width,this.height)};var Av=function(t,e,r){void 0===Sv&&console.error("TAARenderPass relies on SSAARenderPass"),Sv.call(this,t,e,r),this.sampleLevel=0,this.accumulate=!1};Av.JitterVectors=Sv.JitterVectors,Av.prototype=Object.assign(Object.create(Sv.prototype),{constructor:Av,render:function(t,e,r,n){if(!this.accumulate)return Sv.prototype.render.call(this,t,e,r,n),void(this.accumulateIndex=-1);var i=Av.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new Ac(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new Ac(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(Sv.prototype.render.call(this,t,this.holdRenderTarget,r,n),this.accumulateIndex=0);var o=t.autoClear;t.autoClear=!1;var s=1/i.length;if(this.accumulateIndex>=0&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=s,this.copyUniforms.tDiffuse.value=e.texture;for(var a=Math.pow(2,this.sampleLevel),l=0;l<a;l++){var c=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*c[0],.0625*c[1],r.width,r.height),t.render(this.scene,this.camera,e,!0),t.render(this.scene2,this.camera2,this.sampleRenderTarget,0===this.accumulateIndex),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var u=this.accumulateIndex*s;u>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,t.render(this.scene2,this.camera2,e,!0)),u<1&&(this.copyUniforms.opacity.value=1-u,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,t.render(this.scene2,this.camera2,e,0===u)),t.autoClear=o}});var Ev=function(t,e){fm.call(this),void 0===Zm&&console.error("TexturePass relies on CopyShader");var r=Zm;this.map=t,this.opacity=void 0!==e?e:1,this.uniforms=Ec.clone(r.uniforms),this.material=new Cc({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};Ev.prototype=Object.assign(Object.create(fm.prototype),{constructor:Ev,render:function(t,e,r,n,i){var o=t.autoClear;t.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,t.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),t.autoClear=o}});var Cv={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Ia(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Pv=function(t,e,r,n){fm.call(this),this.strength=void 0!==e?e:1,this.radius=r,this.threshold=n,this.resolution=void 0!==t?new ka(t.x,t.y):new ka(256,256);var i={minFilter:wl,magFilter:wl,format:El};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new Ac(o,s,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var a=0;a<this.nMips;a++){var l;(l=new Ac(o,s,i)).texture.name="UnrealBloomPass.h"+a,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l),(l=new Ac(o,s,i)).texture.name="UnrealBloomPass.v"+a,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),s=Math.round(s/2)}void 0===Cv&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var c=Cv;this.highPassUniforms=Ec.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Cc({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var u=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2),a=0;a<this.nMips;a++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[a])),this.separableBlurMaterials[a].uniforms.texSize.value=new ka(o,s),o=Math.round(o/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Ta(1,1,1),new Ta(1,1,1),new Ta(1,1,1),new Ta(1,1,1),new Ta(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===Zm&&console.error("BloomPass relies on CopyShader");var h=Zm;this.copyUniforms=Ec.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Cc({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Ia,this.oldClearAlpha=1,this.camera=new Sc(-1,1,1,-1,0,1),this.scene=new _c,this.basic=new zl,this.quad=new ql(new Oc(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};function Ov(t,e,r,n,i,o){this.planes=[void 0!==t?t:new Wl,void 0!==e?e:new Wl,void 0!==r?r:new Wl,void 0!==n?n:new Wl,void 0!==i?i:new Wl,void 0!==o?o:new Wl]}Pv.prototype=Object.assign(Object.create(fm.prototype),{constructor:Pv,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var r=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new ka(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(t,e,r,n,i){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(new Ia(0,0,0),0),i&&t.context.disable(t.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,t.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,t.render(this.scene,this.camera,this.renderTargetBright,!0);for(var s=this.renderTargetBright,a=0;a<this.nMips;a++)this.quad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[a].uniforms.direction.value=Pv.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetsHorizontal[a],!0),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=Pv.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetsVertical[a],!0),s=this.renderTargetsVertical[a];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,this.renderToScreen?void 0:r,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new Cc({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new ka(.5,.5)},direction:{value:new ka(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new Cc({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),Pv.BlurDirectionX=new ka(1,0),Pv.BlurDirectionY=new ka(0,1),Object.assign(Ov.prototype,{set:function(t,e,r,n,i,o){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return e[0].setComponents(s-n,u-a,f-h,y-m).normalize(),e[1].setComponents(s+n,u+a,f+h,y+m).normalize(),e[2].setComponents(s+i,u+l,f+d,y+v).normalize(),e[3].setComponents(s-i,u-l,f-d,y-v).normalize(),e[4].setComponents(s-o,u-c,f-p,y-g).normalize(),e[5].setComponents(s+o,u+c,f+p,y+g).normalize(),this},intersectsObject:function(){var t=new Fa;return function(e){var r=e.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),t.copy(r.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Fa;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(){var t=new Ta,e=new Ta;return function(r){for(var n=this.planes,i=0;i<6;i++){var o=n[i];t.x=o.normal.x>0?r.min.x:r.max.x,e.x=o.normal.x>0?r.max.x:r.min.x,t.y=o.normal.y>0?r.min.y:r.max.y,e.y=o.normal.y>0?r.max.y:r.min.y,t.z=o.normal.z>0?r.min.z:r.max.z,e.z=o.normal.z>0?r.max.z:r.min.z;var s=o.distanceToPoint(t),a=o.distanceToPoint(e);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Nv=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},Lv=function(){this.id=0,this.v1=new Iv,this.v2=new Iv,this.v3=new Iv,this.normalModel=new Ta,this.vertexNormalsModel=[new Ta,new Ta,new Ta],this.vertexNormalsLength=0,this.color=new Ia,this.material=null,this.uvs=[new ka,new ka,new ka],this.z=0,this.renderOrder=0},Iv=function(){this.position=new Ta,this.positionWorld=new Ta,this.positionScreen=new ja,this.visible=!0};Iv.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)};var Rv=function(){this.id=0,this.v1=new Iv,this.v2=new Iv,this.vertexColors=[new Ia,new Ia],this.material=null,this.z=0,this.renderOrder=0},Dv=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new ka,this.material=null,this.renderOrder=0},Fv=function(t){jl.call(this),this.type="SpriteCanvasMaterial",this.color=new Ia(16777215),this.program=function(){},this.setValues(t)};(Fv.prototype=Object.create(jl.prototype)).constructor=Fv,Fv.prototype.isSpriteCanvasMaterial=!0,Fv.prototype.clone=function(){var t=new Fv;return t.copy(this),t.color.copy(this.color),t.program=this.program,t};var kv=function(t){Na.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(t){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(kv.prototype=Object.create(Na.prototype)).constructor=kv;var Uv=function(t){Na.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};(Uv.prototype=Object.create(Na.prototype)).constructor=Uv;var Bv=function(t){Uv.call(this,t)};(Bv.prototype=Object.create(Uv.prototype)).constructor=Bv,Object.assign((function(t){console.log("RaytracingRenderer","91"),t=t||{};var e,r,n=this,i=[],o=!1,s=document.createElement("canvas"),a=s.getContext("2d",{alpha:!0===t.alpha}),l=new Ia(0);this.domElement=s,this.autoClear=!0;var c=t.workers,u=t.blockSize||64;this.randomize=t.randomize;var h,d,p,f=[],m=0,v=0;function g(t){t.postMessage({init:[e,r],worker:t.id,blockSize:u})}function y(t){if(!f.length)return o=!1,n.dispatchEvent({type:"complete"});var e=f.pop(),r=e%d*u,i=(e/d|0)*u;t.postMessage({render:!0,x:r,y:i,sceneId:v}),a.fillStyle="#"+t.color,a.fillRect(r,i,u,u)}console.log("%cSpinning off "+c+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(e){for(c=e||navigator.hardwareConcurrency||4;i.length<c;){var r=new Worker(t.workerPath);r.id=m++,r.onmessage=function(t){var e=t.data;if(e&&e.blockSize&&v==e.sceneId){var r=new ImageData(new Uint8ClampedArray(e.data),e.blockSize,e.blockSize);if(a.putImageData(r,e.blockX,e.blockY),console.log("Worker "+this.id,e.time/1e3,(Date.now()-w)/1e3+" s"),i.length>c)return i.splice(i.indexOf(this),1),this.terminate();y(this)}},r.color=(new Ia).setHSL(Math.random(),.8,.8).getHexString(),i.push(r),g(r),o&&(r.postMessage({scene:x,camera:b,annex:_,sceneId:v}),y(r))}if(!o)for(;i.length>c;)i.pop().terminate()},this.setWorkers(c),this.setClearColor=function(t,e){l.set(t)},this.setPixelRatio=function(){},this.setSize=function(t,n){s.width=t,s.height=n,e=s.width,r=s.height,a.fillStyle="white",i.forEach(g)},this.setSize(s.width,s.height),this.clear=function(){};var x,b,w,_={},S={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function T(t){var e=t.material;if(e&&!(e.uuid in _)){var r={};for(var n in S)void 0!==e[n]&&(r[n]=e[n]);_[e.uuid]=r}}this.render=function(t,s){o=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),x=t.toJSON(),b=s.toJSON(),++v,t.traverse(T),i.forEach(function(t){t.postMessage({scene:x,camera:b,annex:_,sceneId:v})}),a.clearRect(0,0,e,r),w=Date.now(),d=Math.ceil(e/u),p=Math.ceil(r/u),h=d*p,f=[];for(var l=0;l<h;l++)f.push(l);if(n.randomize)for(l=0;l<h;l++){var c=Math.random()*h|0,m=f[c];f[c]=f[l],f[l]=m}i.forEach(y)}}).prototype,Aa.prototype);var jv=function(t){console.log("SoftwareRenderer","91");var e,r,n,i,o,s,a,l,c,u,h,d,p,f,m,v,g=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),y=g.getContext("2d",{alpha:!0===t.alpha}),x=t.alpha,b={},w={},_=new Ia(0),S=1,T=2,M=4,A=(1<<M)-1,E=3,C=1<<E,P=1<<24,O=!1,N=new Ta(0,0,1),L=new Ta,I=1/0,R=1/0,D=0,F=0,k=1/0,U=1/0,B=0,j=0,z=new function(){var t,e,r,n,i,o,s,a,l,c,u,h=[],d=0,p=[],f=0,m=[],v=0,g=[],y=0,x=[],b=0,w={objects:[],lights:[],elements:[]},_=new Ta,S=new ja,T=new Da(new Ta(-1,-1,-1),new Ta(1,1,1)),M=new Da,A=new Array(3),E=new Sa,C=new Sa,P=new Sa,O=new Pa,N=new Ov,L=new ja,I=new ja;this.projectVector=function(t,e){console.warn("Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var R=new function(){var t=[],e=[],n=[],o=null,a=null,l=new Pa;function c(t){var e=t.positionWorld,r=t.positionScreen;e.copy(t.position).applyMatrix4(u),r.copy(e).applyMatrix4(C);var n=1/r.w;r.x*=n,r.y*=n,r.z*=n,t.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function h(t,e,r){return!0===t.visible||!0===e.visible||!0===r.visible||(A[0]=t.positionScreen,A[1]=e.positionScreen,A[2]=r.positionScreen,T.intersectsBox(M.setFromPoints(A)))}function d(t,e,r){return(r.positionScreen.x-t.positionScreen.x)*(e.positionScreen.y-t.positionScreen.y)-(r.positionScreen.y-t.positionScreen.y)*(e.positionScreen.x-t.positionScreen.x)<0}return{setObject:function(r){a=(o=r).material,l.getNormalMatrix(o.matrixWorld),t.length=0,e.length=0,n.length=0},projectVertex:c,checkTriangleVisibility:h,checkBackfaceCulling:d,pushVertex:function(t,e,n){(r=k()).position.set(t,e,n),c(r)},pushNormal:function(e,r,n){t.push(e,r,n)},pushColor:function(t,r,n){e.push(t,r,n)},pushUv:function(t,e){n.push(t,e)},pushLine:function(t,r){var n=p[t],i=p[r];n.positionScreen.copy(n.position).applyMatrix4(P),i.positionScreen.copy(i.position).applyMatrix4(P),!0===z(n.positionScreen,i.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(s=B()).id=o.id,s.v1.copy(n),s.v2.copy(i),s.z=Math.max(n.positionScreen.z,i.positionScreen.z),s.renderOrder=o.renderOrder,s.material=o.material,o.material.vertexColors===al&&(s.vertexColors[0].fromArray(e,3*t),s.vertexColors[1].fromArray(e,3*r)),w.elements.push(s))},pushTriangle:function(e,r,s){var c=arguments,u=p[e],f=p[r],m=p[s];if(!1!==h(u,f,m)&&(a.side===il||!0===d(u,f,m))){(i=U()).id=o.id,i.v1.copy(u),i.v2.copy(f),i.v3.copy(m),i.z=(u.positionScreen.z+f.positionScreen.z+m.positionScreen.z)/3,i.renderOrder=o.renderOrder,i.normalModel.fromArray(t,3*e),i.normalModel.applyMatrix3(l).normalize();for(var v=0;v<3;v++){var g=i.vertexNormalsModel[v];g.fromArray(t,3*c[v]),g.applyMatrix3(l).normalize(),i.uvs[v].fromArray(n,2*c[v])}i.vertexNormalsLength=3,i.material=o.material,w.elements.push(i)}}}};function D(r){(t=function(){if(e===d){var t=new Nv;return h.push(t),d++,e++,t}return h[e++]}()).id=r.id,t.object=r,_.setFromMatrixPosition(r.matrixWorld),_.applyMatrix4(C),t.z=_.z,t.renderOrder=r.renderOrder,w.objects.push(t)}function F(t,e,r){var n=1/t.w;t.z*=n,t.z>=-1&&t.z<=1&&((l=function(){if(c===b){var t=new Dv;return x.push(t),b++,c++,t}return x[c++]}()).id=e.id,l.x=t.x*n,l.y=t.y*n,l.z=t.z,l.renderOrder=e.renderOrder,l.object=e,l.rotation=e.rotation,l.scale.x=e.scale.x*Math.abs(l.x-(t.x+r.projectionMatrix.elements[0])/(t.w+r.projectionMatrix.elements[12])),l.scale.y=e.scale.y*Math.abs(l.y-(t.y+r.projectionMatrix.elements[5])/(t.w+r.projectionMatrix.elements[13])),l.material=e.material,w.elements.push(l))}function k(){if(n===f){var t=new Iv;return p.push(t),f++,n++,t}return p[n++]}function U(){if(o===v){var t=new Lv;return m.push(t),v++,o++,t}return m[o++]}function B(){if(a===y){var t=new Rv;return g.push(t),y++,a++,t}return g[a++]}function j(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id!==e.id?t.id-e.id:0}function z(t,e){var r=0,n=1,i=t.z+t.w,o=e.z+e.w,s=-t.z+t.w,a=-e.z+e.w;return i>=0&&o>=0&&s>=0&&a>=0||!(i<0&&o<0||s<0&&a<0)&&(i<0?r=Math.max(r,i/(i-o)):o<0&&(n=Math.min(n,i/(i-o))),s<0?r=Math.max(r,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<r||(t.lerp(e,r),e.lerp(t,1-n),0)))}this.projectScene=function(t,r,l,h){o=0,a=0,c=0,w.elements.length=0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),E.copy(r.matrixWorldInverse),C.multiplyMatrices(r.projectionMatrix,E),N.setFromMatrix(C),e=0,w.objects.length=0,w.lights.length=0,function t(e){if(!1!==e.visible){if(e instanceof Xh)w.lights.push(e);else if(e instanceof ql||e instanceof Yl||e instanceof bh){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsObject(e))return;D(e)}else if(e instanceof Ef){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===N.intersectsSprite(e))return;D(e)}for(var r=e.children,n=0,i=r.length;n<i;n++)t(r[n])}}(t),!0===l&&w.objects.sort(j);for(var d=w.objects,f=0,m=d.length;f<m;f++){var v=d[f].object,g=v.geometry;if(R.setObject(v),u=v.matrixWorld,n=0,v instanceof ql){if(g instanceof $a){var y=g.groups;if(void 0===(bt=g.attributes).position)continue;for(var x=0,b=(wt=bt.position.array).length;x<b;x+=3)R.pushVertex(wt[x],wt[x+1],wt[x+2]);if(void 0!==bt.normal){var T=bt.normal.array;for(x=0,b=T.length;x<b;x+=3)R.pushNormal(T[x],T[x+1],T[x+2])}if(void 0!==bt.uv){var M=bt.uv.array;for(x=0,b=M.length;x<b;x+=2)R.pushUv(M[x],M[x+1])}if(null!==g.index){var A=g.index.array;if(y.length>0)for(var V=0;V<y.length;V++){var G=y[V];for(x=G.start,b=G.start+G.count;x<b;x+=3)R.pushTriangle(A[x],A[x+1],A[x+2])}else for(x=0,b=A.length;x<b;x+=3)R.pushTriangle(A[x],A[x+1],A[x+2])}else for(x=0,b=wt.length/3;x<b;x+=3)R.pushTriangle(x,x+1,x+2)}else if(g instanceof Ba){var H=g.vertices,W=g.faces,X=g.faceVertexUvs[0];O.getNormalMatrix(u);for(var q=v.material,Y=Array.isArray(q),Z=0,J=H.length;Z<J;Z++){if(_.copy(xt=H[Z]),!0===q.morphTargets)for(var Q=g.morphTargets,K=v.morphTargetInfluences,$=0,tt=Q.length;$<tt;$++){var et=K[$];if(0!==et){var rt=Q[$].vertices[Z];_.x+=(rt.x-xt.x)*et,_.y+=(rt.y-xt.y)*et,_.z+=(rt.z-xt.z)*et}}R.pushVertex(_.x,_.y,_.z)}for(var nt=0,it=W.length;nt<it;nt++){var ot=W[nt];if(void 0!==(q=!0===Y?v.material[ot.materialIndex]:v.material)){var st=q.side,at=p[ot.a],lt=p[ot.b],ct=p[ot.c];if(!1!==R.checkTriangleVisibility(at,lt,ct)){var ut=R.checkBackfaceCulling(at,lt,ct);if(st!==il){if(st===rl&&!1===ut)continue;if(st===nl&&!0===ut)continue}(i=U()).id=v.id,i.v1.copy(at),i.v2.copy(lt),i.v3.copy(ct),i.normalModel.copy(ot.normal),!1!==ut||st!==nl&&st!==il||i.normalModel.negate(),i.normalModel.applyMatrix3(O).normalize();for(var ht=ot.vertexNormals,dt=0,pt=Math.min(ht.length,3);dt<pt;dt++){var ft=i.vertexNormalsModel[dt];ft.copy(ht[dt]),!1!==ut||st!==nl&&st!==il||ft.negate(),ft.applyMatrix3(O).normalize()}i.vertexNormalsLength=ht.length;var mt=X[nt];if(void 0!==mt)for(var vt=0;vt<3;vt++)i.uvs[vt].copy(mt[vt]);i.color=ot.color,i.material=q,i.z=(at.positionScreen.z+lt.positionScreen.z+ct.positionScreen.z)/3,i.renderOrder=v.renderOrder,w.elements.push(i)}}}}}else if(v instanceof Yl){if(P.multiplyMatrices(C,u),g instanceof $a){if(void 0!==(bt=g.attributes).position){for(x=0,b=(wt=bt.position.array).length;x<b;x+=3)R.pushVertex(wt[x],wt[x+1],wt[x+2]);if(void 0!==bt.color){var gt=bt.color.array;for(x=0,b=gt.length;x<b;x+=3)R.pushColor(gt[x],gt[x+1],gt[x+2])}if(null!==g.index)for(x=0,b=(A=g.index.array).length;x<b;x+=2)R.pushLine(A[x],A[x+1]);else{var yt=v instanceof nd?2:1;for(x=0,b=wt.length/3-1;x<b;x+=yt)R.pushLine(x,x+1)}}}else if(g instanceof Ba){if(0===(H=v.geometry.vertices).length)continue;for((at=k()).positionScreen.copy(H[0]).applyMatrix4(P),yt=v instanceof nd?2:1,Z=1,J=H.length;Z<J;Z++)(at=k()).positionScreen.copy(H[Z]).applyMatrix4(P),(Z+1)%yt>0||(lt=p[n-2],L.copy(at.positionScreen),I.copy(lt.positionScreen),!0===z(L,I)&&(L.multiplyScalar(1/L.w),I.multiplyScalar(1/I.w),(s=B()).id=v.id,s.v1.positionScreen.copy(L),s.v2.positionScreen.copy(I),s.z=Math.max(L.z,I.z),s.renderOrder=v.renderOrder,s.material=v.material,v.material.vertexColors===al&&(s.vertexColors[0].copy(v.geometry.colors[Z]),s.vertexColors[1].copy(v.geometry.colors[Z-1])),w.elements.push(s)))}}else if(v instanceof bh){if(P.multiplyMatrices(C,u),g instanceof Ba)for(Z=0,J=(H=v.geometry.vertices).length;Z<J;Z++){var xt;S.set((xt=H[Z]).x,xt.y,xt.z,1),S.applyMatrix4(P),F(S,v,r)}else if(g instanceof $a){var bt,wt;if(void 0!==(bt=g.attributes).position)for(x=0,b=(wt=bt.position.array).length;x<b;x+=3)S.set(wt[x],wt[x+1],wt[x+2],1),S.applyMatrix4(P),F(S,v,r)}}else v instanceof Ef&&(S.set(u.elements[12],u.elements[13],u.elements[14],1),S.applyMatrix4(C),F(S,v,r))}return!0===h&&w.elements.sort(j),w}},V=new ja,G=new ja,H=new ja,W=new ka,X=new ka,q=new ka,Y=[],Z=0,J=[],Q=0,K=[],$=0;function tt(t){for(var n=e*r*4,i=0;i<n;i+=4)d[i]=255*t.r|0,d[i+1]=255*t.g|0,d[i+2]=255*t.b|0,d[i+3]=x?0:255;y.fillStyle=x?"rgba(0, 0, 0, 0)":t.getStyle(),y.fillRect(0,0,e,r)}function et(t,e){var r=0,n=0,i=255*t.color.r,o=255*t.color.g,s=255*t.color.b,a=new Uint8Array(768);if(e){for(;r<204;)a[n++]=Math.min(r*i/204,255),a[n++]=Math.min(r*o/204,255),a[n++]=Math.min(r*s/204,255),++r;for(;r<256;)a[n++]=Math.min(i+(r-204)*(255-i)/82,255),a[n++]=Math.min(o+(r-204)*(255-o)/82,255),a[n++]=Math.min(s+(r-204)*(255-s)/82,255),++r}else for(;r<256;)a[n++]=Math.min(r*i/255,255),a[n++]=Math.min(r*o/255,255),a[n++]=Math.min(r*s/255,255),++r;return a}function rt(t,e,r,n,i,o,s,a,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=h-1,p=u.data,f=4*((o*h&d)*h+(i*h&d));if(l.transparent){var m=p[f+1],v=p[f+2],g=p[f+3]*l.opacity/255,y=t[c+1],x=t[c+2];t[c]=p[f]*g+t[c]*(1-g),t[c+1]=m*g+y*(1-g),t[c+2]=v*g+x*(1-g),t[c+3]=(l.opacity<<8)-1,255==t[c+3]&&(e[r]=n)}else t[c]=p[f],t[c+1]=p[f+1],t[c+2]=p[f+2],t[c+3]=(l.opacity<<8)-1,e[r]=n}}function nt(t,e,r,n,i,o,s,a,l){var c=4*r,u=w[l.map.id];if(u.data){var h=u.width,d=3*(s>0?~~s:0),p=h-1,f=u.data,m=4*((o*h&p)*h+(i*h&p));if(l.transparent){var v=l.palette[d+1]*f[m+1],g=l.palette[d+2]*f[m+2],y=f[m+3]*l.opacity/256,x=t[c+1],b=t[c+2];t[c]=l.palette[d]*f[m]*y+t[c]*(1-y),t[c+1]=v*y+x*(1-y),t[c+2]=g*y+b*(1-y),t[c+3]=(l.opacity<<8)-1,255==t[c+3]&&(e[r]=n)}else t[c]=l.palette[d]*f[m]>>8,t[c+1]=l.palette[d+1]*f[m+1]>>8,t[c+2]=l.palette[d+2]*f[m+2]>>8,t[c+3]=(l.opacity<<8)-1,e[r]=n}}function it(t){var e=t.id,r=b[e];if(r&&t.map&&!w[t.map.id]&&delete b[e],void 0===b[e]||!0===t.needsUpdate){if(t instanceof zl||t instanceof jc||t instanceof Vc||t instanceof Zc)if(t instanceof jc?t.palette||(t.palette=et(t,!1)):t instanceof Vc&&(t.palette||(t.palette=et(t,!0))),t.map){var n=new jv.Texture;if(n.fromImage(t.map.image),!n.data)return;w[t.map.id]=n,r=t instanceof zl||t instanceof Zc?rt:nt}else i=t.vertexColors===sl?["var colorOffset = offset * 4;","buffer[ colorOffset ] = face.color.r * 255;","buffer[ colorOffset + 1 ] = face.color.g * 255;","buffer[ colorOffset + 2 ] = face.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"):["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * 255;","buffer[ colorOffset + 1 ] = material.color.g * 255;","buffer[ colorOffset + 2 ] = material.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"),r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);else if(t instanceof Vl){var i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;","buffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;","buffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");r=new Function("buffer, depthBuf, offset, depth, color1, color2, material",i)}else i=["var colorOffset = offset * 4;","buffer[ colorOffset ] = u * 255;","buffer[ colorOffset + 1 ] = v * 255;","buffer[ colorOffset + 2 ] = 0;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n"),r=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",i);b[e]=r,t.needsUpdate=!1}return r}function ot(t,i,h,f,g,y,x,b,w){if(!(t.z<-1||t.z>1||i.z<-1||i.z>1||h.z<-1||h.z>1)){var _=1<<M,P=t.x*o+l|0,O=i.x*o+l|0,N=h.x*o+l|0,L=t.y*s+c|0,k=i.y*s+c|0,U=h.y*s+c|0,B=b.vertexNormalsModel&&b.vertexNormalsModel.length,j=f&&g&&y,z=Math.max(Math.sqrt((P-O)*(P-O)+(L-k)*(L-k)),Math.sqrt((O-N)*(O-N)+(k-U)*(k-U)),Math.sqrt((N-P)*(N-P)+(U-L)*(U-L)));if(!(b instanceof Dv)&&z>100*_){var V,G,H,W,X,q,tt,et,rt,nt,it={vertexNormalsModel:[],color:b.color};return j&&($===K.length?(V=new ka,K.push(V),++$,G=new ka,K.push(G),++$,H=new ka,K.push(H),++$):(V=K[$],G=K[++$],H=K[++$],++$),W=(1+i.z)*(i.w/t.w)/(1+t.z),V.copy(f).multiplyScalar(W).add(g).multiplyScalar(1/(W+1)),W=(1+h.z)*(h.w/i.w)/(1+i.z),G.copy(g).multiplyScalar(W).add(y).multiplyScalar(1/(W+1)),W=(1+t.z)*(t.w/h.w)/(1+h.z),H.copy(y).multiplyScalar(W).add(f).multiplyScalar(1/(W+1))),Z===Y.length?(X=new ja,Y.push(X),++Z,q=new ja,Y.push(q),++Z,tt=new ja,Y.push(tt),++Z):(X=Y[Z],q=Y[++Z],tt=Y[++Z],++Z),X.copy(t).add(i).multiplyScalar(.5),q.copy(i).add(h).multiplyScalar(.5),tt.copy(h).add(t).multiplyScalar(.5),B&&(Q===J.length?(et=new Ta,J.push(et),++Q,rt=new Ta,J.push(rt),++Q,nt=new Ta,J.push(nt),++Q):(et=J[Q],rt=J[++Q],nt=J[++Q],++Q),et.copy(b.vertexNormalsModel[0]).add(b.vertexNormalsModel[1]).normalize(),rt.copy(b.vertexNormalsModel[1]).add(b.vertexNormalsModel[2]).normalize(),nt.copy(b.vertexNormalsModel[2]).add(b.vertexNormalsModel[0]).normalize()),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[0],it.vertexNormalsModel[1]=et,it.vertexNormalsModel[2]=nt),ot(t,X,tt,f,V,H,x,it,w),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[1],it.vertexNormalsModel[1]=rt,it.vertexNormalsModel[2]=et),ot(i,q,X,g,G,V,x,it,w),B&&(it.vertexNormalsModel[0]=et,it.vertexNormalsModel[1]=rt,it.vertexNormalsModel[2]=nt),ot(X,q,tt,V,G,H,x,it,w),B&&(it.vertexNormalsModel[0]=b.vertexNormalsModel[2],it.vertexNormalsModel[1]=nt,it.vertexNormalsModel[2]=rt),void ot(h,tt,q,y,H,G,x,it,w)}var st,lt,ct,ut,ht,dt,pt,ft,mt,vt=t.z*a+u|0,gt=i.z*a+u|0,yt=h.z*a+u|0;j=!1,f&&g&&y&&(j=!0,st=f.x,lt=1-f.y,ct=g.x,ut=1-g.y,ht=y.x,dt=1-y.y),B&&(pt=255*b.vertexNormalsModel[0].z,ft=255*b.vertexNormalsModel[1].z,mt=255*b.vertexNormalsModel[2].z);var xt=P-O,bt=k-L,wt=O-N,_t=U-k,St=N-P,Tt=L-U,Mt=Math.max(Math.min(P,O,N)+A>>M,0),At=Math.min(Math.max(P,O,N)+A>>M,e),Et=Math.max(Math.min(L,k,U)+A>>M,0),Ct=Math.min(Math.max(L,k,U)+A>>M,r);I=Math.min(Mt,I),D=Math.max(At,D),R=Math.min(Et,R),F=Math.max(Ct,F);var Pt=C,Ot=(Mt&=~(Pt-1))<<M,Nt=(Et&=~(Pt-1))<<M,Lt=bt*(Ot-P)+xt*(Nt-L),It=_t*(Ot-O)+wt*(Nt-k),Rt=Tt*(Ot-N)+St*(Nt-U);(bt>0||0==bt&&xt>0)&&Lt++,(_t>0||0==_t&&wt>0)&&It++,(Tt>0||0==Tt&&St>0)&&Rt++,Lt=Lt-1>>M,It=It-1>>M,Rt=Rt-1>>M;var Dt,Ft,kt,Ut,Bt,jt=vt-gt,zt=yt-vt,Vt=1/(xt*Tt-St*bt),Gt=Vt*(jt*Tt-zt*bt),Ht=Vt*(jt*St-xt*zt),Wt=vt+(Ot-P)*Gt+(Nt-L)*Ht|0;if(Gt=Gt*_|0,Ht=Ht*_|0,j){var Xt=st-ct,qt=ht-st,Yt=Vt*(Xt*Tt-qt*bt),Zt=Vt*(Xt*St-xt*qt),Jt=lt-ut,Qt=dt-lt;kt=st+(Ot-P)*Yt+(Nt-L)*Zt,Ut=lt+(Ot-P)*(Dt=Vt*(Jt*Tt-Qt*bt))+(Nt-L)*(Ft=Vt*(Jt*St-xt*Qt)),Yt*=_,Zt*=_,Dt*=_,Ft*=_}if(B){var Kt,$t=pt-ft,te=mt-pt,ee=Vt*($t*Tt-te*bt);Bt=pt+(Ot-P)*ee+(Nt-L)*(Kt=Vt*($t*St-xt*te)),ee*=_,Kt*=_}var re=Pt-1,ne=0,ie=0,oe=0,se=0,ae=0,le=0,ce=0,ue=0;xt>=0?ie-=re*xt:ne-=re*xt,bt>=0?ie-=re*bt:ne-=re*bt,wt>=0?se-=re*wt:oe-=re*wt,_t>=0?se-=re*_t:oe-=re*_t,St>=0?le-=re*St:ae-=re*St,Tt>=0?le-=re*Tt:ae-=re*Tt,Gt>=0?ue+=re*Gt:ce+=re*Gt,Ht>=0?ue+=re*Ht:ce+=re*Ht;var he,de,pe,fe=e-Pt,me=Lt,ve=It,ge=Rt,ye=Wt,xe=-Pt,be=xe*bt,we=xe*_t,_e=xe*Tt,Se=xe*Gt;j&&(he=xe*Yt,de=xe*Dt),B&&(pe=xe*ee);for(var Te=Mt,Me=Et;Me<Ct;Me+=Pt){for(;Te>=Mt&&Te<At&&me>=ie&&ve>=se&&ge>=le;)Te+=xe,me+=be,ve+=we,ge+=_e,ye+=Se,j&&(kt+=he,Ut+=de),B&&(Bt+=pe);for(xe=-xe,be=-be,we=-we,_e=-_e,Se=-Se,j&&(he=-he,de=-de),B&&(pe=-pe);Te+=xe,me+=be,ve+=we,ge+=_e,ye+=Se,j&&(kt+=he,Ut+=de),B&&(Bt+=pe),!(Te<Mt||Te>=At);)if(me<ie){if(be<0)break}else if(ve<se){if(we<0)break}else if(ge<le){if(_e<0)break}else{var Ae=Te>>E,Ee=Me>>E,Ce=Ae+Ee*n;if(!(m[Ce]<ye+ce)){var Pe=v[Ce];Pe&T&&at(Ae,Ee),v[Ce]=Pe&~(S|T);var Oe=Te+Me*e;if(me>=ne&&ve>=oe&&ge>=ae){m[Ce]=Math.min(m[Ce],ye+ue);var Ne=me,Le=ve,Ie=ye;j&&(Be=kt,je=Ut),B&&(ze=Bt);for(var Re=0;Re<Pt;Re++){var De=Ne,Fe=Le,ke=Ie;j&&(Ge=Be,He=je),B&&(We=ze);for(var Ue=0;Ue<Pt;Ue++)(qe=ke)<p[Oe]&&x(d,p,Oe,qe,Ge,He,We,b,w),De+=bt,Fe+=_t,ke+=Gt,j&&(Ge+=Yt,He+=Dt),B&&(We+=ee),Oe++;Ne+=xt,Le+=wt,Ie+=Ht,j&&(Be+=Zt,je+=Ft),B&&(ze+=Kt),Oe+=fe}}else{Ne=me,Le=ve;var Be,je,ze,Ve=ge;for(Ie=ye,j&&(Be=kt,je=Ut),B&&(ze=Bt),Re=0;Re<Pt;Re++){De=Ne,Fe=Le;var Ge,He,We,Xe=Ve;for(ke=Ie,j&&(Ge=Be,He=je),B&&(We=ze),Ue=0;Ue<Pt;Ue++){var qe;(De|Fe|Xe)>=0&&(qe=ke)<p[Oe]&&x(d,p,Oe,qe,Ge,He,We,b,w),De+=bt,Fe+=_t,Xe+=Tt,ke+=Gt,j&&(Ge+=Yt,He+=Dt),B&&(We+=ee),Oe++}Ne+=xt,Le+=wt,Ve+=St,Ie+=Ht,j&&(Be+=Zt,je+=Ft),B&&(ze+=Kt),Oe+=fe}}}}me+=Pt*xt,ve+=Pt*wt,ge+=Pt*St,ye+=Pt*Ht,j&&(kt+=Pt*Zt,Ut+=Pt*Ft),B&&(Bt+=Pt*Kt)}}}function st(t,b,w,k,U,B){if(O||(O=!0,C=1<<(E=0),function(t,b){n=Math.floor(g.width/C),i=Math.floor(b/C);var w=1<<M;o=w*(e=n*C)/2,s=-w*(r=i*C)/2,a=P/2,l=w*e/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=e,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,r),h=y.getImageData(0,0,e,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)}(0,g.height)),!(t.z<-1||t.z>1||b.z<-1||b.z>1)){var j=Math.floor(.5*(B.linewidth-1)),z=t.x*o+l|0,V=b.x*o+l|0,G=t.y*s+c|0,H=b.y*s+c|0,W=t.z*a+u|0,X=b.z*a+u|0,q=z-V,Y=G-H,Z=W-X,J=Math.max(Math.min(z,V)+A>>M,0),Q=Math.min(Math.max(z,V)+A>>M,e),K=Math.max(Math.min(G,H)+A>>M,0),$=Math.min(Math.max(G,H)+A>>M,r),et=Math.max(Math.min(W,X)+A>>M,0),rt=Math.max(W,X)+A>>M;I=Math.min(J,I),D=Math.max(Q,D),R=Math.min(K,R),F=Math.max($,F);var nt,it,ot,st,lt,ct=Math.sqrt(Y*Y+q*q),ut=q/ct,ht=Y/ct,dt=Z/ct;for(L.set(ut,ht,dt),L.cross(N),L.normalize();ct>0;){nt=(nt=V+ct*ut)+A>>M,it=(it=H+ct*ht)+A>>M,lt=X+ct*dt+A>>M;for(var pt=-j;pt<=j;++pt)if(ot=Math.floor(nt+L.x*pt),st=Math.floor(it+L.y*pt),!(I>=ot||D<=ot||R>=st||F<=st)){var ft=ot>>E,mt=st>>E,vt=ft+mt*n;if(!(m[vt]<et)){m[vt]=Math.min(m[vt],rt);var gt=v[vt];gt&T&&at(ft,mt),v[vt]=gt&~(S|T);var yt=ot+st*e;lt<p[yt]&&U(d,p,yt,lt,w,k,B)}}--ct}}}function at(t,r){for(var n=t*C+r*C*e,i=4*n,o=e-C,s=4*o,a=0;a<C;a++){for(var l=0;l<C;l++)p[n++]=P,d[i++]=255*_.r|0,d[i++]=255*_.g|0,d[i++]=255*_.b|0,d[i++]=x?0:255;n+=o,i+=s}}this.domElement=g,this.autoClear=!0,this.setClearColor=function(t){_.set(t),tt(_)},this.setPixelRatio=function(){},this.setSize=function(t,b){n=Math.floor(t/C),i=Math.floor(b/C);var w=1<<M;o=w*(e=n*C)/2,s=-w*(r=i*C)/2,a=P/2,l=w*e/2+.5,c=w*r/2+.5,u=P/2+.5,g.width=e,g.height=r,y.fillStyle=x?"rgba(0, 0, 0, 0)":_.getStyle(),y.fillRect(0,0,e,r),h=y.getImageData(0,0,e,r),d=h.data,p=new Int32Array(d.length/4),f=n*i,m=new Int32Array(f),v=new Uint8Array(f);for(var T=0,A=p.length;T<A;T++)p[T]=P;for(T=0;T<f;T++)v[T]=S;tt(_)},this.setSize(g.width,g.height),this.clear=function(){I=1/0,R=1/0,D=0,F=0,Z=0,Q=0,$=0;for(var t=0;t<f;t++)m[t]=P,v[t]=v[t]&S?S:T},this.render=function(t,e){this.clear();var r=t.background;r&&r.isColor&&tt(r);for(var o=z.projectScene(t,e,!1,!1).elements,s=0,a=o.length;s<a;s++){var l=o[s],c=l.material;if(p=it(c))if(l instanceof Lv)l.uvs?ot(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,l.uvs[0],l.uvs[1],l.uvs[2],p,l,c):ot(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,null,null,null,p,l,c);else if(l instanceof Dv){var u=.5*l.scale.x,d=.5*l.scale.y;V.copy(l),V.x-=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y+=d,c.map?(W.set(0,1),X.set(0,0),q.set(1,1),ot(V,G,H,W,X,q,p,l,c)):ot(V,G,H,null,null,null,p,l,c),V.copy(l),V.x+=u,V.y+=d,G.copy(l),G.x-=u,G.y-=d,H.copy(l),H.x+=u,H.y-=d,c.map?(W.set(1,1),X.set(0,0),q.set(1,0),ot(V,G,H,W,X,q,p,l,c)):ot(V,G,H,null,null,null,p,l,c)}else if(l instanceof Rv){var p=it(c);st(l.v1.positionScreen,l.v2.positionScreen,l.vertexColors[0],l.vertexColors[1],p,c)}}!function(){for(var t=0,e=0;e<i;e++)for(var r=0;r<n;r++)v[t]&T&&(at(r,e),v[t]=S),t++}();var f=Math.min(I,k),m=Math.min(R,U),g=Math.max(D,B)-f,x=Math.max(F,j)-m;f!==1/0&&y.putImageData(h,0,0,f,m,g,x),k=I,U=R,B=D,j=F}};jv.Texture=function(){var t;this.fromImage=function(e){if(!(!e||e.width<=0||e.height<=0)){void 0===t&&(t=document.createElement("canvas"));var r=e.width>e.height?e.width:e.height;r=_a.ceilPowerOfTwo(r),t.width==r&&t.height==r||(t.width=r,t.height=r);var n=t.getContext("2d");n.clearRect(0,0,r,r),n.drawImage(e,0,0,r,r);var i=n.getImageData(0,0,r,r);this.data=i.data,this.width=r,this.height=r,this.srcUrl=e.src}}};var zv=function(t){Na.call(this),this.node=t};(zv.prototype=Object.create(Na.prototype)).constructor=zv;var Vv=new Mc,Gv=new zd;function Hv(){this.seq=[],this.map={}}var Wv=[],Xv=[],qv=new Float32Array(16),Yv=new Float32Array(9);function Zv(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=Wv[i];if(void 0===o&&(o=new Float32Array(i),Wv[i]=o),0!==e){n.toArray(o,0);for(var s=1,a=0;s!==e;++s)t[s].toArray(o,a+=r)}return o}function Jv(t,e){var r=Xv[e];void 0===r&&(r=new Int32Array(e),Xv[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocTextureUnit();return r}function Qv(t,e){t.uniform1f(this.addr,e)}function Kv(t,e){t.uniform1i(this.addr,e)}function $v(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function tg(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function eg(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function rg(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function ng(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(Yv.set(e.elements),t.uniformMatrix3fv(this.addr,!1,Yv))}function ig(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(qv.set(e.elements),t.uniformMatrix4fv(this.addr,!1,qv))}function og(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTexture2D(e||Vv,n)}function sg(t,e,r){var n=r.allocTextureUnit();t.uniform1i(this.addr,n),r.setTextureCube(e||Gv,n)}function ag(t,e){t.uniform2iv(this.addr,e)}function lg(t,e){t.uniform3iv(this.addr,e)}function cg(t,e){t.uniform4iv(this.addr,e)}function ug(t,e){t.uniform1fv(this.addr,e)}function hg(t,e){t.uniform1iv(this.addr,e)}function dg(t,e){t.uniform2fv(this.addr,Zv(e,this.size,2))}function pg(t,e){t.uniform3fv(this.addr,Zv(e,this.size,3))}function fg(t,e){t.uniform4fv(this.addr,Zv(e,this.size,4))}function mg(t,e){t.uniformMatrix2fv(this.addr,!1,Zv(e,this.size,4))}function vg(t,e){t.uniformMatrix3fv(this.addr,!1,Zv(e,this.size,9))}function gg(t,e){t.uniformMatrix4fv(this.addr,!1,Zv(e,this.size,16))}function yg(t,e,r){var n=e.length,i=Jv(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(e[o]||Vv,i[o])}function xg(t,e,r){var n=e.length,i=Jv(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(e[o]||Gv,i[o])}function bg(t,e,r){this.id=t,this.addr=r,this.setValue=function(t){switch(e.type){case 5126:return Qv;case 35664:return $v;case 35665:return tg;case 35666:return eg;case 35674:return rg;case 35675:return ng;case 35676:return ig;case 35678:case 36198:return og;case 35680:return sg;case 5124:case 35670:return Kv;case 35667:case 35671:return ag;case 35668:case 35672:return lg;case 35669:case 35673:return cg}}()}function wg(t,e,r){this.id=t,this.addr=r,this.size=e.size,this.setValue=function(t){switch(e.type){case 5126:return ug;case 35664:return dg;case 35665:return pg;case 35666:return fg;case 35674:return mg;case 35675:return vg;case 35676:return gg;case 35678:return yg;case 35680:return xg;case 5124:case 35670:return hg;case 35667:case 35671:return ag;case 35668:case 35672:return lg;case 35669:case 35673:return cg}}()}function _g(t){this.id=t,Hv.call(this)}_g.prototype.setValue=function(t,e){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(t,e[o.id])}};var Sg=/([\w\d_]+)(\])?(\[|\.)?/g;function Tg(t,e){t.seq.push(e),t.map[e.id]=e}function Mg(t,e,r){var n=t.name,i=n.length;for(Sg.lastIndex=0;;){var o=Sg.exec(n),s=o[1],a=o[3];if("]"===o[2]&&(s|=0),void 0===a||"["===a&&Sg.lastIndex+2===i){Tg(r,void 0===a?new bg(s,t,e):new wg(s,t,e));break}var l=r.map[s];void 0===l&&Tg(r,l=new _g(s)),r=l}}function Ag(t,e,r){Hv.call(this),this.renderer=r;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=t.getActiveUniform(e,i);Mg(o,t.getUniformLocation(e,o.name),this)}}function Eg(t){bc.call(this),this.cameras=t||[]}function Cg(t){"string"==typeof t&&(console.warn("Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}Ag.prototype.setValue=function(t,e,r){var n=this.map[e];void 0!==n&&n.setValue(t,r,this.renderer)},Ag.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},Ag.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var s=e[i],a=r[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},Ag.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r},Eg.prototype=Object.assign(Object.create(bc.prototype),{constructor:Eg,isArrayCamera:!0}),Cg.prototype.clone=function(){return new Cg(void 0===this.value.clone?this.value:this.value.clone())},new ka(1/1024,1/512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","","","","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","","#if (FXAA_PC == 1)","","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","    #endif","","                        }","                        #endif","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n");var Pg={packVector3:["float vec3_to_float( vec3 data ) {","\tconst float unit = 255.0/256.0;","\thighp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","\treturn compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","\tconst float unit = 255.0;","\tvec3 uncompressed;","\tuncompressed.x = fract( data );","\tfloat zInt = floor( data / unit );","\tuncompressed.z = fract( zInt / unit );","\tuncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","\treturn uncompressed;","}"].join("\n"),packNormal:["vec2 normal_to_vec2( vec3 normal ) {","\treturn normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","\tvec2 fenc = data * 4.0 - 2.0;","\tfloat f = dot( fenc, fenc );","\tfloat g = sqrt( 1.0 - f / 4.0 );","\tvec3 normal;","\tnormal.xy = fenc * g;","\tnormal.z = 1.0 - f / 2.0;","\treturn normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")},Og={commonUniforms:{matProjInverse:new Cg(new Sa),viewWidth:new Cg(800),viewHeight:new Cg(600)}};["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",Pg.packNormalDepth,"\tgl_FragColor = packedNormalDepth;","}"].join("\n"),new Cg(null),new Cg(new ja(0,0,1,1)),new Cg(new Ia(0)),new Cg(new Ia(0)),new Cg(new Ia(0)),new Cg(30),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",Pg.packVector3,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;","#include <map_fragment>",Pg.packColor,"\tgl_FragColor = packedColor;","}"].join("\n"),Object.assign({samplerColor:new Cg(null)},Og.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",Pg.unpackFloat,"void main() {",Pg.computeTextureCoord,Pg.unpackColor,"\tgl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n"),Object.assign({samplerNormalDepth:new Cg(null),samplerColor:new Cg(null),lightColor:new Cg(new Ia(0)),lightPositionVS:new Cg(new Ta(0,1,0)),lightIntensity:new Cg(1),lightRadius:new Cg(1)},Og.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",Pg.unpackFloat,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepth,Pg.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",Pg.unpackColor,Pg.computeSpecular,"\t//float cutoff = 0.3;","\t//float denom = distance / lightRadius + 1.0;","\t//float attenuation = 1.0 / ( denom * denom );","\t//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","\t//attenuation = max( attenuation, 0.0 );","\t//attenuation *= attenuation;","\t//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","\t//float attenuation = 1.0;","\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",Pg.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new Cg(null),samplerColor:new Cg(null),lightColor:new Cg(new Ia(0)),lightDirectionVS:new Cg(new Ta(0,1,0)),lightPositionVS:new Cg(new Ta(0,1,0)),lightAngle:new Cg(1),lightIntensity:new Cg(1)},Og.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Pg.unpackFloat,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepth,Pg.computeVertexPositionVS,Pg.unpackColor,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}","\tdiffuseColor *= spot;",Pg.computeSpecular,"\tconst float attenuation = 1.0;",Pg.combine,"}"].join("\n"),Object.assign({samplerNormalDepth:new Cg(null),samplerColor:new Cg(null),lightColor:new Cg(new Ia(0)),lightDirectionVS:new Cg(new Ta(0,1,0)),lightIntensity:new Cg(1)},Og.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Pg.unpackFloat,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepth,Pg.computeVertexPositionVS,Pg.unpackColor,"\tvec3 lightVector = normalize( lightDirectionVS );",Pg.computeSpecular,"\tconst float attenuation = 1.0;",Pg.combine,"}"].join("\n"),new Cg(30),["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",Pg.packNormal,"void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",Pg.packNormalDepthShininess,"\tgl_FragColor = packedNormalDepthShininess;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new Cg(null),lightColor:new Cg(new Ia(0)),lightPositionVS:new Cg(new Ta(0,1,0)),lightIntensity:new Cg(1),lightRadius:new Cg(1)},Og.commonUniforms),["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",Pg.unpackFloat,Pg.unpackVector2,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepthShininess,Pg.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",Pg.computeSpecular,"\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",Pg.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new Cg(null),lightColor:new Cg(new Ia(0)),lightDirectionVS:new Cg(new Ta(0,1,0)),lightPositionVS:new Cg(new Ta(0,1,0)),lightAngle:new Cg(1),lightIntensity:new Cg(1)},Og.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Pg.unpackFloat,Pg.unpackVector2,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepthShininess,Pg.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}",Pg.computeSpecular,"\tconst float attenuation = 1.0;",Pg.packLight,"\tgl_FragColor = spot * packedLight;","}"].join("\n"),Object.assign({samplerNormalDepthShininess:new Cg(null),lightColor:new Cg(new Ia(0)),lightDirectionVS:new Cg(new Ta(0,1,0)),lightIntensity:new Cg(1)},Og.commonUniforms),["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",Pg.unpackFloat,Pg.unpackVector2,"void main() {",Pg.computeTextureCoord,Pg.unpackNormalDepthShininess,Pg.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightDirectionVS );",Pg.computeSpecular,"\tconst float attenuation = 1.0;",Pg.packLight,"\tgl_FragColor = packedLight;","}"].join("\n"),Object.assign({samplerLight:new Cg(null),map:new Cg(null),offsetRepeat:new Cg(new ja(0,0,1,1)),diffuse:new Cg(new Ia(0)),emissive:new Cg(new Ia(0)),specular:new Cg(new Ia(0)),shininess:new Cg(30)},Og.commonUniforms),["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",Pg.unpackFloat,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;",Pg.computeTextureCoord,"\tvec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","\tvec3 diffuseFinal = diffuseColor.rgb * light.rgb;","\tvec3 emissiveFinal = emissiveColor;","\tvec3 specularFinal = specularColor * light.rgb * light.a;","\tgl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n"),new Cg(null),["varying vec2 texCoord;","void main() {","\tvec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","\ttexCoord = pos.xy * vec2( 0.5 ) + 0.5;","\tgl_Position = pos;","}"].join("\n"),["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","\tgl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n"),Object.create($a.prototype),Object.create($a.prototype),Object.create($a.prototype),Object.create($a.prototype),Object.create($a.prototype),new ka(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n"),new ka(.5,.5),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n"),new ka(.5,.5),new Ia(16772608),new Ia(0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n"),["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n"),new ka,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if (depthblur) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n"),new Ta(2,2,2),new Ta(1,1,1),new Ta(0,0,0),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n"),new Ia(16777215),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n"),new ka(512,512),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n"),["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n"),new ka(512,512),new ka(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n"),["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;","vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {","float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;","vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;","currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","if( heightFromTexture > currentLayerHeight ) {","currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;","float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","float weight = nextH / ( nextH - prevH );","return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else","return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n"),["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n"),new ka,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n"),new ka(1,1),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n"),["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n"),Ec.merge([nh.fog,nh.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new Ia(15658734)},specular:{value:new Ia(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new ja(0,0,1,1)},uWrapRGB:{value:new Ta(.75,.375,.1875)}}]),["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,rh.bsdfs,rh.packing,rh.lights_pars_begin,rh.shadowmap_pars_fragment,rh.fog_pars_fragment,rh.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",rh.fog_fragment,"}"].join("\n"),["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,rh.lights_pars_begin,rh.shadowmap_pars_vertex,rh.fog_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",rh.shadowmap_vertex,rh.fog_vertex,"}"].join("\n"),Ec.merge([nh.fog,nh.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new Ia(15658734)},specular:{value:new Ia(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,rh.lights_pars_begin,rh.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",rh.fog_fragment,"}"].join("\n"),["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,rh.fog_pars_vertex,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",rh.fog_vertex,"}"].join("\n"),["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n"),["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n"),Ec.merge([nh.fog,nh.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new Ia(15658734)},specular:{value:new Ia(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new ka(1,1)},uRepeatOverlay:{value:new ka(1,1)},uOffset:{value:new ka(0,0)}}]),["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.common,rh.bsdfs,rh.lights_pars_begin,rh.shadowmap_pars_fragment,rh.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",rh.fog_fragment,"}"].join("\n"),["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",rh.shadowmap_pars_vertex,rh.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",rh.shadowmap_vertex,rh.fog_vertex,"}"].join("\n"),new Ta,new Ia(15658734),new Ia(328965),new Ia(16777215),["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n"),new Ta,new Ia(15658734),new Ia(328965),new Ia(15658734),new Ia(8421504),new Ia(0),new Ia(0),new Ia(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n"),new Ta,new Ia(15658734),new Ia(328965),new Ia(16777215),new Ia(0),new Ia(0),new Ia(0),new Ia(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n"),new Ta,new Ia(15658734),new Ia(328965),new Ia(16777215),new Ia(0),["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n");var Ng=function(t){void 0==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());for(this.perm=[],e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Ng.prototype.dot=function(t,e,r){return t[0]*e+t[1]*r},Ng.prototype.dot3=function(t,e,r,n){return t[0]*e+t[1]*r+t[2]*n},Ng.prototype.dot4=function(t,e,r,n,i){return t[0]*e+t[1]*r+t[2]*n+t[3]*i},Ng.prototype.noise=function(t,e){var r,n,i=(t+e)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+i),s=Math.floor(e+i),a=(3-Math.sqrt(3))/6,l=(o+s)*a,c=t-(o-l),u=e-(s-l);c>u?(r=1,n=0):(r=0,n=1);var h=c-r+a,d=u-n+a,p=c-1+2*a,f=u-1+2*a,m=255&o,v=255&s,g=this.perm[m+r+this.perm[v+n]]%12,y=this.perm[m+1+this.perm[v+1]]%12,x=.5-c*c-u*u,b=.5-h*h-d*d,w=.5-p*p-f*f;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[this.perm[m+this.perm[v]]%12],c,u))+(b<0?0:(b*=b)*b*this.dot(this.grad3[g],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[y],p,f)))},Ng.prototype.noise3d=function(t,e,r){var n,i,o,s,a,l,c=(t+e+r)*(1/3),u=Math.floor(t+c),h=Math.floor(e+c),d=Math.floor(r+c),p=(u+h+d)*(1/6),f=t-(u-p),m=e-(h-p),v=r-(d-p);f>=m?m>=v?(n=1,i=0,o=0,s=1,a=1,l=0):f>=v?(n=1,i=0,o=0,s=1,a=0,l=1):(n=0,i=0,o=1,s=1,a=0,l=1):m<v?(n=0,i=0,o=1,s=0,a=1,l=1):f<v?(n=0,i=1,o=0,s=0,a=1,l=1):(n=0,i=1,o=0,s=1,a=1,l=0);var g=f-n+1/6,y=m-i+1/6,x=v-o+1/6,b=f-s+1/6*2,w=m-a+1/6*2,_=v-l+1/6*2,S=f-1+.5,T=m-1+.5,M=v-1+.5,A=255&u,E=255&h,C=255&d,P=this.perm[A+n+this.perm[E+i+this.perm[C+o]]]%12,O=this.perm[A+s+this.perm[E+a+this.perm[C+l]]]%12,N=this.perm[A+1+this.perm[E+1+this.perm[C+1]]]%12,L=.6-f*f-m*m-v*v,I=.6-g*g-y*y-x*x,R=.6-b*b-w*w-_*_,D=.6-S*S-T*T-M*M;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[this.perm[A+this.perm[E+this.perm[C]]]%12],f,m,v))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[P],g,y,x))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[O],b,w,_))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[N],S,T,M)))},Ng.prototype.noise4d=function(t,e,r,n){var i,o,s,a,l,c,u,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,w=(t+e+r+n)*x,_=Math.floor(t+w),S=Math.floor(e+w),T=Math.floor(r+w),M=Math.floor(n+w),A=(_+S+T+M)*b,E=t-(_-A),C=e-(S-A),P=r-(T-A),O=n-(M-A),N=(E>C?32:0)+(E>P?16:0)+(C>P?8:0)+(E>O?4:0)+(C>O?2:0)+(P>O?1:0),L=E-(i=g[N][0]>=3?1:0)+b,I=C-(o=g[N][1]>=3?1:0)+b,R=P-(s=g[N][2]>=3?1:0)+b,D=O-(a=g[N][3]>=3?1:0)+b,F=E-(l=g[N][0]>=2?1:0)+2*b,k=C-(c=g[N][1]>=2?1:0)+2*b,U=P-(u=g[N][2]>=2?1:0)+2*b,B=O-(h=g[N][3]>=2?1:0)+2*b,j=E-(d=g[N][0]>=1?1:0)+3*b,z=C-(p=g[N][1]>=1?1:0)+3*b,V=P-(f=g[N][2]>=1?1:0)+3*b,G=O-(m=g[N][3]>=1?1:0)+3*b,H=E-1+4*b,W=C-1+4*b,X=P-1+4*b,q=O-1+4*b,Y=255&_,Z=255&S,J=255&T,Q=255&M,K=y[Y+i+y[Z+o+y[J+s+y[Q+a]]]]%32,$=y[Y+l+y[Z+c+y[J+u+y[Q+h]]]]%32,tt=y[Y+d+y[Z+p+y[J+f+y[Q+m]]]]%32,et=y[Y+1+y[Z+1+y[J+1+y[Q+1]]]]%32,rt=.6-E*E-C*C-P*P-O*O,nt=.6-L*L-I*I-R*R-D*D,it=.6-F*F-k*k-U*U-B*B,ot=.6-j*j-z*z-V*V-G*G,st=.6-H*H-W*W-X*X-q*q;return 27*((rt<0?0:(rt*=rt)*rt*this.dot4(v[y[Y+y[Z+y[J+y[Q]]]]%32],E,C,P,O))+(nt<0?0:(nt*=nt)*nt*this.dot4(v[K],L,I,R,D))+(it<0?0:(it*=it)*it*this.dot4(v[$],F,k,U,B))+(ot<0?0:(ot*=ot)*ot*this.dot4(v[tt],j,z,V,G))+(st<0?0:(st*=st)*st*this.dot4(v[et],H,W,X,q)))};var Lg=function(t,e,r){this._scene=t,this._trackInfo=e,this._onUpdate=r,this._mixer=new ep(t),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};Lg.prototype={constructor:Lg,init:function(t){for(var e=[],r=this._trackInfo,n=0,i=r.length;n!==i;++n){var o=r[n];e.push(this._addTrack(o.type,o.propertyPath,o.initialValue,o.interpolation))}this._clip=new gc("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var r=this._tracks[t],n=r.times,i=Timeliner.binarySearch(n,e),o=r.values,s=r.getValueSize(),a=i*s;if(i<0){a=(i=~i)*s;for(var l=o.length+s,c=n.length+1-1;c!==i;--c)n[c]=n[c-1];c=l-1;for(var u=a+s-1;c!==u;--c)o[c]=o[c-s]}n[i]=e,this._propRefs[t].getValue(o,a)},delKeyframe:function(t,e){var r=this._tracks[t],n=r.times,i=Timeliner.binarySearch(n,e);if(n.length>1&&i>=0){for(var o=n.length-1,s=r.values,a=r.getValueSize(),l=s.length-a,c=i;c!==o;++c)n[c]=n[c+1];n.pop();for(var u=i*a;u!==l;++u)s[u]=s[u+a];s.length=l}},moveKeyframe:function(t,e,r,n){var i=this._tracks[t],o=i.times,s=Timeliner.binarySearch(o,e);if(s>=0){for(var a=n?o.length:s+1,l=o[s-1]<=e||!n&&e>=o[s+1];s!==a;)o[s++]+=r;l&&this._sort(i)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,r=this._tracks,n=t.channels,i=0,o=e.length;i!==o;++i){var s=e[i],a=r[s];n[s]={times:a.times,values:a.values}}return t},deserialize:function(t){var e=this._channelNames,r=this._tracks,n=t.channels;this.setDuration(t.duration);for(var i=0,o=e.length;i!==o;++i){var s=e[i],a=r[s],l=n[s];this._setArray(a.times,l.times),this._setArray(a.values,l.values)}this.setDisplayTime(this._mixer.time)},_sort:function(t){var e=t.times,r=fc.getKeyframeOrder(e);this._setArray(e,fc.sortedArray(e,1,r));var n=t.values,i=t.getValueSize();this._setArray(n,fc.sortedArray(n,i,r))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(t,e,r,n){var i=new t(e,[0],r,n);return i.times=Array.prototype.slice.call(i.times),i.values=Array.prototype.slice.call(i.values),this._channelNames.push(e),this._tracks[e]=i,this._propRefs[e]=new sh(this._scene,e),i}};var Ig={quicksortIP:function(t,e,r){for(var n,i,o=[],s=-1,a=0,l=t.length/e-1,c=0,u=0,h=0,d=function(r,n){for(r*=e,n*=e,h=0;h<e;h++)c=t[r+h],t[r+h]=t[n+h],t[n+h]=c},p=new Float32Array(e),f=new Float32Array(e);;)if(l-a<=25){for(i=a+1;i<=l;i++){for(u=0;u<e;u++)p[u]=t[i*e+u];for(n=i-1;n>=a&&t[n*e+r]>p[r];){for(u=0;u<e;u++)t[(n+1)*e+u]=t[n*e+u];n--}for(u=0;u<e;u++)t[(n+1)*e+u]=p[u]}if(-1==s)break;l=o[s--],a=o[s--]}else{for(i=l,d(a+l>>1,n=a+1),t[a*e+r]>t[l*e+r]&&d(a,l),t[n*e+r]>t[l*e+r]&&d(n,l),t[a*e+r]>t[n*e+r]&&d(a,n),u=0;u<e;u++)f[u]=t[n*e+u];for(;;){do{n++}while(t[n*e+r]<f[r]);do{i--}while(t[i*e+r]>f[r]);if(i<n)break;d(n,i)}for(u=0;u<e;u++)t[(a+1)*e+u]=t[i*e+u],t[i*e+u]=f[u];l-n+1>=i-a?(o[++s]=n,o[++s]=l,l=i-1):(o[++s]=a,o[++s]=i-1,a=n)}return t},Kdtree:function(t,e,r){var n=this,i=0,o=function(t,e){return t.subarray(e*r,e*r+r)};this.root=function t(e,s,a,l){var c,u,h=s%r,d=e.length/r;return s>i&&(i=s),0===d?null:1===d?new n.Node(o(e,0),s,a,l):(Ig.quicksortIP(e,r,h),c=Math.floor(d/2),(u=new n.Node(o(e,c),s,a,c+l)).left=t(e.subarray(0,c*r),s+1,u,l),u.right=t(e.subarray((c+1)*r,e.length),s+1,u,l+c+1),u)}(t,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(t,i,o){var s,a,l;if(l=new Ig.Kdtree.BinaryHeap(function(t){return-t[1]}),o)for(s=0;s<i;s+=1)l.push([null,o]);for(function n(o){var s,a,c,u,h=o.depth%r,d=e(t,o.obj),p=[];function f(t,e){l.push([t,e]),l.size()>i&&l.pop()}for(u=0;u<r;u+=1)p[u]=u===o.depth%r?t[u]:o.obj[u];a=e(p,o.obj),null!==o.right||null!==o.left?(n(s=null===o.right?o.left:null===o.left?o.right:t[h]<o.obj[h]?o.left:o.right),(l.size()<i||d<l.peek()[1])&&f(o,d),(l.size()<i||Math.abs(a)<l.peek()[1])&&null!==(c=s===o.left?o.right:o.left)&&n(c)):(l.size()<i||d<l.peek()[1])&&f(o,d)}(n.root),a=[],s=0;s<i;s+=1)l.content[s][0]&&a.push([l.content[s][0],l.content[s][1]]);return a}}};Ig.Kdtree.prototype.Node=function(t,e,r,n){this.obj=t,this.left=null,this.right=null,this.parent=r,this.depth=e,this.pos=n},Ig.Kdtree.BinaryHeap=function(t){this.content=[],this.scoreFunction=t},Ig.Kdtree.BinaryHeap.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,r=0;r<e;r++)if(this.content[r]==t){var n=this.content.pop();return void(r!=e-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var r=Math.floor((t+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[r]=e,this.content[t]=n,t=r}},sinkDown:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i=2*(t+1),o=i-1,s=null;if(o<e){var a=this.scoreFunction(this.content[o]);a<n&&(s=o)}if(i<e&&this.scoreFunction(this.content[i])<(null===s?n:a)&&(s=i),null===s)break;this.content[t]=this.content[s],this.content[s]=r,t=s}}};var Rg={merge:function(t,e,r){var n;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e instanceof ql&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},randomPointInTriangle:function(){var t=new Ta;return function(e,r,n){var i=new Ta,o=Math.random(),s=Math.random();o+s>1&&(o=1-o,s=1-s);var a=1-o-s;return i.copy(e),i.multiplyScalar(o),t.copy(r),t.multiplyScalar(s),i.add(t),t.copy(n),t.multiplyScalar(a),i.add(t),i}}(),randomPointInFace:function(t,e){return Rg.randomPointInTriangle(e.vertices[t.a],e.vertices[t.b],e.vertices[t.c])},randomPointsInGeometry:function(t,e){var r,n,i=t.faces,o=t.vertices,s=i.length,a=0,l=[];for(n=0;n<s;n++)(r=i[n])._area=Rg.triangleArea(o[r.a],o[r.b],o[r.c]),l[n]=a+=r._area;function c(t){return function e(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return l[i]>t?e(r,i-1):l[i]<t?e(i+1,n):i}(0,l.length-1)}var u,h=[];for(n=0;n<e;n++)u=c(Math.random()*a),h[n]=Rg.randomPointInFace(i[u],t);return h},randomPointsInBufferGeometry:function(t,e){var r,n,i,o,s=t.attributes.position.array,a=0,l=[];n=new Ta,i=new Ta,o=new Ta;var c=s.length/9;for(r=0;r<c;r++)n.set(s[9*r+0],s[9*r+1],s[9*r+2]),i.set(s[9*r+3],s[9*r+4],s[9*r+5]),o.set(s[9*r+6],s[9*r+7],s[9*r+8]),a+=Rg.triangleArea(n,i,o),l.push(a);function u(t){return function e(r,n){if(n<r)return r;var i=r+Math.floor((n-r)/2);return l[i]>t?e(r,i-1):l[i]<t?e(i+1,n):i}(0,l.length-1)}var h,d=[];for(r=0;r<e;r++)h=u(Math.random()*a),n.set(s[9*h+0],s[9*h+1],s[9*h+2]),i.set(s[9*h+3],s[9*h+4],s[9*h+5]),o.set(s[9*h+6],s[9*h+7],s[9*h+8]),d[r]=Rg.randomPointInTriangle(n,i,o);return d},triangleArea:function(){var t=new Ta,e=new Ta;return function(r,n,i){return t.subVectors(n,r),e.subVectors(i,r),t.cross(e),.5*t.length()}}(),center:function(t){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Dg=function(t){var e,r=this,n=void 0!==t.name&&""!==t.name,i=new Sc(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);i.position.set(0,0,2);var o,s,a=new _c,l=yv,c=new Ec.clone(l.uniforms),u=new Cc({uniforms:c,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),h=new ql(new Oc(256,256),u);if(a.add(h),n){var d=(o=document.createElement("canvas")).getContext("2d");d.font="Bold 20px Arial";var p=d.measureText(t.name).width;o.width=p,o.height=25,d.font="Bold 20px Arial",d.fillStyle="rgba( 255, 0, 0, 1 )",d.fillText(t.name,0,20);var f=new Mc(o);f.magFilter=wl,f.minFilter=wl,f.needsUpdate=!0;var m=new zl({map:f,side:il});m.transparent=!0;var v=new Oc(o.width,o.height);s=new ql(v,m),a.add(s)}this.enabled=!0,this.size={width:256,height:256,set:function(t,e){this.width=t,this.height=e,h.scale.set(this.width/256,this.height/256,1),r.position.set(r.position.x,r.position.y)}},this.position={x:10,y:10,set:function(t,e){this.x=t,this.y=e,h.position.set(-window.innerWidth/2+r.size.width/2+this.x,window.innerHeight/2-r.size.height/2-this.y,0),n&&s.position.set(h.position.x,h.position.y-r.size.height/2+o.height/2,0)}},this.render=function(r){this.enabled&&(c.tDiffuse.value=t.shadow.map.texture,e=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(a,i),r.autoClear=e)},this.updateForWindowResize=function(){this.enabled&&(i.left=window.innerWidth/-2,i.right=window.innerWidth/2,i.top=window.innerHeight/2,i.bottom=window.innerHeight/-2,i.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};Dg.prototype.constructor=Dg;var Fg=function(t,e,r){var n=this;this.volume=t,e=e||0,Object.defineProperty(this,"index",{get:function(){return e},set:function(t){return e=t,n.geometryNeedsUpdate=!0,e}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new Mc(this.canvas);i.minFilter=wl,i.wrapS=i.wrapT=yl;var o=new zl({map:i,side:il,transparent:!0});this.mesh=new ql(this.geometry,o),this.geometryNeedsUpdate=!0,this.repaint()};Fg.prototype={constructor:Fg,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var t=this.iLength,e=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,o=this.ctxBuffer,s=o.getImageData(0,0,t,e),a=s.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,p=0;if("label"===n.dataType)for(var f=0;f<e;f++)for(var m=0;m<t;m++){var v=l[r(m,f)],g=this.colorMap[v=v>=this.colorMap.length?v%this.colorMap.length+1:v];a[4*p]=g>>24&255,a[4*p+1]=g>>16&255,a[4*p+2]=g>>8&255,a[4*p+3]=255&g,p++}else for(f=0;f<e;f++)for(m=0;m<t;m++){var y=l[r(m,f)],x=255;x=c>=y&&u<=y?x:0,y=Math.floor(255*(y-h)/(d-h)),a[4*p]=y=y>255?255:y<0?0:0|y,a[4*p+1]=y,a[4*p+2]=y,a[4*p+3]=x,p++}o.putImageData(s,0,0),this.ctx.drawImage(i,0,0,t,e,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var t=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=t.sliceAccess,this.jLength=t.jLength,this.iLength=t.iLength,this.matrix=t.matrix,this.canvas.width=t.planeWidth,this.canvas.height=t.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry=new Pc(t.planeWidth,t.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new Sa).identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}};var kg=function(){Na.call(this);var t,e=this,r=[0,0],n=!1,i=new Ta;this.matrixAutoUpdate=!1,this.getGamepad=function(){return t},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var r=t[e];if(r&&"Daydream Controller"===r.id)return r}}())&&void 0!==t.pose){var o=t.pose;if(null===o)return;null!==o.orientation&&e.quaternion.fromArray(o.orientation),e.updateMatrix(),e.visible=!0,null===o.angularVelocity||i.equals(o.angularVelocity)||(i.fromArray(o.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:i})),r[0]===t.axes[0]&&r[1]===t.axes[1]||(r[0]=t.axes[0],r[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:r})),n!==t.buttons[0].pressed&&e.dispatchEvent({type:(n=t.buttons[0].pressed)?"touchpaddown":"touchpadup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("DaydreamController: getTouchPadState() is now getTouchpadState()"),n}};(kg.prototype=Object.create(Na.prototype)).constructor=kg;var Ug=function(){Na.call(this);var t,e=this,r=[0,0],n=!1,i=!1,o=new Ta;this.matrixAutoUpdate=!0,this.getGamepad=function(){return t},this.getTouchpadState=function(){return n},this.update=function(){if(void 0!==(t=function(){for(var t=navigator.getGamepads&&navigator.getGamepads(),e=0;e<4;e++){var r=t[e];if(r&&"Gear VR Controller"===r.id)return r}}())&&void 0!==t.pose){var s=t.pose;if(null===s)return;null!==s.orientation&&e.quaternion.fromArray(s.orientation),e.updateMatrix(),e.visible=!0,null===s.angularVelocity||o.equals(s.angularVelocity)||(o.fromArray(s.angularVelocity),e.dispatchEvent({type:"angularvelocitychanged",angularVelocity:o})),r[0]===t.axes[0]&&r[1]===t.axes[1]||(r[0]=t.axes[0],r[1]=t.axes[1],e.dispatchEvent({type:"axischanged",axes:r})),n!==t.buttons[0].pressed&&e.dispatchEvent({type:(n=t.buttons[0].pressed)?"touchpaddown":"touchpadup",axes:r}),i!==t.buttons[1].pressed&&e.dispatchEvent({type:(i=t.buttons[1].pressed)?"triggerdown":"triggerup"})}else e.visible=!1},this.getTouchPadState=function(){return console.warn("GearVRController: getTouchPadState() is now getTouchpadState()"),n},this.setHand=function(){console.warn("GearVRController: setHand() has been removed.")}};(Ug.prototype=Object.create(Na.prototype)).constructor=Ug;var Bg=function(t){Na.call(this);var e,r=this,n=[0,0],i=!1,o=!1,s=!1,a=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new Sa,this.getGamepad=function(){return e},this.getButtonState=function(t){return"thumbpad"===t?i:"trigger"===t?o:"grips"===t?s:"menu"===t?a:void 0},this.update=function(){if(void 0!==(e=function(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0;r<e.length;r++){var i=e[r];if(i&&("OpenVR Gamepad"===i.id||i.id.startsWith("Oculus Touch")||i.id.startsWith("Spatial Controller"))){if(n===t)return i;n++}}}(t))&&void 0!==e.pose){if(null===e.pose)return;var l=e.pose;null!==l.position&&r.position.fromArray(l.position),null!==l.orientation&&r.quaternion.fromArray(l.orientation),r.matrix.compose(r.position,r.quaternion,r.scale),r.matrix.premultiply(r.standingMatrix),r.matrixWorldNeedsUpdate=!0,r.visible=!0,n[0]===e.axes[0]&&n[1]===e.axes[1]||(n[0]=e.axes[0],n[1]=e.axes[1],r.dispatchEvent({type:"axischanged",axes:n})),i!==e.buttons[0].pressed&&r.dispatchEvent({type:(i=e.buttons[0].pressed)?"thumbpaddown":"thumbpadup",axes:n}),o!==e.buttons[1].pressed&&r.dispatchEvent({type:(o=e.buttons[1].pressed)?"triggerdown":"triggerup"}),s!==e.buttons[2].pressed&&r.dispatchEvent({type:(s=e.buttons[2].pressed)?"gripsdown":"gripsup"}),a!==e.buttons[3].pressed&&r.dispatchEvent({type:(a=e.buttons[3].pressed)?"menudown":"menuup"})}else r.visible=!1}};function jg(t,e,r,n){Ba.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new zg(t,e,r,n)),this.mergeVertices()}function zg(t,e,r,n){$a.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,s=[],a=[],l=[],c=[],u=new Ta,h=new ka;for(a.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var d=r+o/e*n;u.x=t*Math.cos(d),u.y=t*Math.sin(d),a.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(a[i]/t+1)/2,h.y=(a[i+1]/t+1)/2,c.push(h.x,h.y)}for(i=1;i<=e;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new Za(a,3)),this.addAttribute("normal",new Za(l,3)),this.addAttribute("uv",new Za(c,2))}function Vg(t,e){Ba.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Gg(t,e)),this.mergeVertices()}function Gg(t,e){var r=(1+Math.sqrt(5))/2;mu.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Hg(t,e,r,n,i,o,s,a){ku.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Wg(t,e,r,n,i,o){Hg.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function Xg(){var t=0,e=0,r=0,n=0;function i(i,o,s,a){t=i,e=s,r=-3*i+3*o-2*s-a,n=2*i-2*o+s+a}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,s,a){var l=(e-t)/o-(r-t)/(o+s)+(r-e)/s,c=(r-e)/s-(n-e)/(s+a)+(n-r)/a;i(e,r,l*=s,c*=s)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}(Bg.prototype=Object.create(Na.prototype)).constructor=Bg,(jg.prototype=Object.create(Ba.prototype)).constructor=jg,(zg.prototype=Object.create($a.prototype)).constructor=zg,(Vg.prototype=Object.create(Ba.prototype)).constructor=Vg,(Gg.prototype=Object.create(mu.prototype)).constructor=Gg,(Hg.prototype=Object.create(ku.prototype)).constructor=Hg,Hg.prototype.isEllipseCurve=!0,Hg.prototype.getPoint=function(t,e){for(var r=e||new ka,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var s=this.aStartAngle+t*i,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(a,l)},Hg.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Hg.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Hg.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},(Wg.prototype=Object.create(Hg.prototype)).constructor=Wg,Wg.prototype.isArcCurve=!0;var qg=new Ta,Yg=new Xg,Zg=new Xg,Jg=new Xg;function Qg(t,e,r,n){ku.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Kg(t,e,r,n,i){var o=.5*(n-e),s=.5*(i-r),a=t*t;return(2*r-2*n+o+s)*(t*a)+(-3*r+3*n-2*o-s)*a+o*t+r}function $g(t,e,r,n){return function(t,r){var n=1-t;return n*n*e}(t)+function(t,e){return 2*(1-t)*t*r}(t)+function(t,e){return t*t*n}(t)}function ty(t,e,r,n,i){return function(t,r){var n=1-t;return n*n*n*e}(t)+function(t,e){var n=1-t;return 3*n*n*t*r}(t)+function(t,e){return 3*(1-t)*t*t*n}(t)+function(t,e){return t*t*t*i}(t)}function ey(t,e,r,n){ku.call(this),this.type="CubicBezierCurve",this.v0=t||new ka,this.v1=e||new ka,this.v2=r||new ka,this.v3=n||new ka}function ry(t,e,r,n){ku.call(this),this.type="CubicBezierCurve3",this.v0=t||new Ta,this.v1=e||new Ta,this.v2=r||new Ta,this.v3=n||new Ta}function ny(t,e){ku.call(this),this.type="LineCurve",this.v1=t||new ka,this.v2=e||new ka}function iy(t,e){ku.call(this),this.type="LineCurve3",this.v1=t||new Ta,this.v2=e||new Ta}function oy(t,e,r){ku.call(this),this.type="QuadraticBezierCurve",this.v0=t||new ka,this.v1=e||new ka,this.v2=r||new ka}function sy(t,e,r){ku.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Ta,this.v1=e||new Ta,this.v2=r||new Ta}function ay(t){ku.call(this),this.type="SplineCurve",this.points=t||[]}(Qg.prototype=Object.create(ku.prototype)).constructor=Qg,Qg.prototype.isCatmullRomCurve3=!0,Qg.prototype.getPoint=function(t,e){var r,n,i,o,s=e||new Ta,a=this.points,l=a.length,c=(l-(this.closed?0:1))*t,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a.length)+1)*a.length:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=a[(u-1)%l]:(qg.subVectors(a[0],a[1]).add(a[0]),r=qg),n=a[u%l],i=a[(u+1)%l],this.closed||u+2<l?o=a[(u+2)%l]:(qg.subVectors(a[l-1],a[l-2]).add(a[l-1]),o=qg),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Yg.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,p,f,m),Zg.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,p,f,m),Jg.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(Yg.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Zg.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Jg.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return s.set(Yg.calc(h),Zg.calc(h),Jg.calc(h)),s},Qg.prototype.copy=function(t){ku.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Qg.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Qg.prototype.fromJSON=function(t){ku.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Ta).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},(ey.prototype=Object.create(ku.prototype)).constructor=ey,ey.prototype.isCubicBezierCurve=!0,ey.prototype.getPoint=function(t,e){var r=e||new ka,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(ty(t,n.x,i.x,o.x,s.x),ty(t,n.y,i.y,o.y,s.y)),r},ey.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ey.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ey.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(ry.prototype=Object.create(ku.prototype)).constructor=ry,ry.prototype.isCubicBezierCurve3=!0,ry.prototype.getPoint=function(t,e){var r=e||new Ta,n=this.v0,i=this.v1,o=this.v2,s=this.v3;return r.set(ty(t,n.x,i.x,o.x,s.x),ty(t,n.y,i.y,o.y,s.y),ty(t,n.z,i.z,o.z,s.z)),r},ry.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ry.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ry.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},(ny.prototype=Object.create(ku.prototype)).constructor=ny,ny.prototype.isLineCurve=!0,ny.prototype.getPoint=function(t,e){var r=e||new ka;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},ny.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ny.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},ny.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ny.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ny.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(iy.prototype=Object.create(ku.prototype)).constructor=iy,iy.prototype.isLineCurve3=!0,iy.prototype.getPoint=function(t,e){var r=e||new Ta;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},iy.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},iy.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},iy.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},iy.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(oy.prototype=Object.create(ku.prototype)).constructor=oy,oy.prototype.isQuadraticBezierCurve=!0,oy.prototype.getPoint=function(t,e){var r=e||new ka,n=this.v0,i=this.v1,o=this.v2;return r.set($g(t,n.x,i.x,o.x),$g(t,n.y,i.y,o.y)),r},oy.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},oy.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},oy.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(sy.prototype=Object.create(ku.prototype)).constructor=sy,sy.prototype.isQuadraticBezierCurve3=!0,sy.prototype.getPoint=function(t,e){var r=e||new Ta,n=this.v0,i=this.v1,o=this.v2;return r.set($g(t,n.x,i.x,o.x),$g(t,n.y,i.y,o.y),$g(t,n.z,i.z,o.z)),r},sy.prototype.copy=function(t){return ku.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},sy.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},sy.prototype.fromJSON=function(t){return ku.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},(ay.prototype=Object.create(ku.prototype)).constructor=ay,ay.prototype.isSplineCurve=!0,ay.prototype.getPoint=function(t,e){var r=e||new ka,n=this.points,i=(n.length-1)*t,o=Math.floor(i),s=i-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set(Kg(s,a.x,l.x,c.x,u.x),Kg(s,a.y,l.y,c.y,u.y)),r},ay.prototype.copy=function(t){ku.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},ay.prototype.toJSON=function(){var t=ku.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},ay.prototype.fromJSON=function(t){ku.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new ka).fromArray(n))}return this};var ly={ArcCurve:Wg,CatmullRomCurve3:Qg,CubicBezierCurve:ey,CubicBezierCurve3:ry,EllipseCurve:Hg,LineCurve:ny,LineCurve3:iy,QuadraticBezierCurve:oy,QuadraticBezierCurve3:sy,SplineCurve:ay};function cy(){ku.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function uy(t){cy.call(this),this.type="Path",this.currentPoint=new ka,t&&this.setFromPoints(t)}function hy(t){uy.call(this,t),this.uuid=_a.generateUUID(),this.type="Shape",this.holes=[]}function dy(t,e,r,n,i){var o,s;if(i===function(t,e,r,n){for(var i=0,o=e,s=r-n;o<r;o+=n)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)s=Oy(o,t[o],t[o+1],s);else for(o=r-n;o>=e;o-=n)s=Oy(o,t[o],t[o+1],s);return s&&Ay(s,s.next)&&(Ny(s),s=s.next),s}function py(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Ay(n,n.next)&&0!==My(n.prev,n,n.next))n=n.next;else{if(Ny(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function fy(t,e,r,n,i,o,s){if(t){!s&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=wy(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,s,a,l,c=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,n=r,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1)}(i)}(t,n,i,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?vy(t,n,i,o):my(t))e.push(a.i/r),e.push(t.i/r),e.push(l.i/r),Ny(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?fy(t=gy(t,e,r),e,r,n,i,o,2):2===s&&yy(t,e,r,n,i,o):fy(py(t),e,r,n,i,o,1);break}}}function my(t){var e=t.prev,r=t,n=t.next;if(My(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Sy(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&My(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function vy(t,e,r,n){var i=t.prev,o=t,s=t.next;if(My(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,l=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,c=wy(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,r,n),u=wy(a,l,e,r,n),h=t.nextZ;h&&h.z<=u;){if(h!==t.prev&&h!==t.next&&Sy(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&My(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(h=t.prevZ;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Sy(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&My(h.prev,h,h.next)>=0)return!1;h=h.prevZ}return!0}function gy(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Ay(i,o)&&Ey(i,n,n.next,o)&&Cy(i,o)&&Cy(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Ny(n),Ny(n.next),n=t=o),n=n.next}while(n!==t);return n}function yy(t,e,r,n,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ty(s,a)){var l=Py(s,a);return s=py(s,s.next),l=py(l,l.next),fy(s,e,r,n,i,o),void fy(l,e,r,n,i,o)}a=a.next}s=s.next}while(s!==t)}function xy(t,e){return t.x-e.x}function by(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===s)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&Sy(o<h?i:s,o,u,h,o<h?s:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&Cy(n,t)&&(r=n,d=l),n=n.next;return r}(t,e)){var r=Py(e,t);py(r,r.next)}}function wy(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _y(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Sy(t,e,r,n,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function Ty(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ey(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Cy(t,e)&&Cy(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function My(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ay(t,e){return t.x===e.x&&t.y===e.y}function Ey(t,e,r,n){return!!(Ay(t,e)&&Ay(r,n)||Ay(t,n)&&Ay(r,e))||My(t,e,r)>0!=My(t,e,n)>0&&My(r,n,t)>0!=My(r,n,e)>0}function Cy(t,e){return My(t.prev,t,t.next)<0?My(t,e,t.next)>=0&&My(t,t.prev,e)>=0:My(t,e,t.prev)<0||My(t,t.next,e)<0}function Py(t,e){var r=new Ly(t.i,t.x,t.y),n=new Ly(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Oy(t,e,r,n){var i=new Ly(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ny(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ly(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}cy.prototype=Object.assign(Object.create(ku.prototype),{constructor:cy,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ly.LineCurve(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],s=o.getLength();return o.getPointAt(0===s?0:1-i/s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],s=o.getPoints(o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t),a=0;a<s.length;a++){var l=s[a];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){ku.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=ku.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){ku.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new ly[n.type]).fromJSON(n))}return this}}),uy.prototype=Object.assign(Object.create(cy.prototype),{constructor:uy,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new ny(this.currentPoint.clone(),new ka(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,n){var i=new oy(this.currentPoint.clone(),new ka(t,e),new ka(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(t,e,r,n,i,o){var s=new ey(this.currentPoint.clone(),new ka(t,e),new ka(r,n),new ka(i,o));this.curves.push(s),this.currentPoint.set(i,o)},splineThru:function(t){var e=new ay([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,n,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o)},absarc:function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},ellipse:function(t,e,r,n,i,o,s,a){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o,s,a)},absellipse:function(t,e,r,n,i,o,s,a){var l=new Hg(t,e,r,n,i,o,s,a);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(t){return cy.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=cy.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return cy.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),hy.prototype=Object.assign(Object.create(uy.prototype),{constructor:hy,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){uy.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=uy.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){uy.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new uy).fromJSON(n))}return this}});var Iy={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return Iy.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];Ry(t),Dy(r,t);var o=t.length;e.forEach(Ry);for(var s=0;s<e.length;s++)n.push(o),o+=e[s].length,Dy(r,e[s]);var a=function(t,e,r){r=r||2;var n,i,o,s,a,l,c,u=e&&e.length,h=u?e[0]*r:t.length,d=dy(t,0,h,r,!0),p=[];if(!d)return p;if(u&&(d=function(t,e,r,n){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=dy(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(_y(s));for(a.sort(xy),i=0;i<a.length;i++)by(a[i],r),r=py(r,r.next);return r}(t,e,d,r)),t.length>80*r){n=o=t[0],i=s=t[1];for(var f=r;f<h;f+=r)l=t[f+1],(a=t[f])<n&&(n=a),l<i&&(i=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-i))?1/c:0}return fy(d,p,r,n,i,c),p}(r,n);for(s=0;s<a.length;s+=3)i.push(a.slice(s,s+3));return i}};function Ry(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Dy(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function Fy(t,e){Ba.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ky(t,e)),this.mergeVertices()}function ky(t,e){$a.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],s=0,a=0;if(!1===Array.isArray(t))c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(s,a,l),s+=a,a=0;function c(t){var s,l,c,u=n.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;if(!1===Iy.isClockWise(d))for(d=d.reverse(),s=0,l=p.length;s<l;s++)!0===Iy.isClockWise(c=p[s])&&(p[s]=c.reverse());var f=Iy.triangulateShape(d,p);for(s=0,l=p.length;s<l;s++)d=d.concat(c=p[s]);for(s=0,l=d.length;s<l;s++){var m=d[s];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(s=0,l=f.length;s<l;s++){var v=f[s];r.push(v[0]+u,v[1]+u,v[2]+u),a+=3}}this.setIndex(r),this.addAttribute("position",new Za(n,3)),this.addAttribute("normal",new Za(i,3)),this.addAttribute("uv",new Za(o,2))}function Uy(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}(Fy.prototype=Object.create(Ba.prototype)).constructor=Fy,Fy.prototype.toJSON=function(){var t=Ba.prototype.toJSON.call(this);return Uy(this.parameters.shapes,t)},(ky.prototype=Object.create($a.prototype)).constructor=ky,ky.prototype.toJSON=function(){var t=$a.prototype.toJSON.call(this);return Uy(this.parameters.shapes,t)};var By,jy,zy=function(t){Bg.call(this,t);var e=2*Math.PI,r=0,n=new Ia(1,1,1),i=1,o=new ql(s=new jg(1,32),u=new zl({map:function(){var t=document.createElement("canvas");t.width=256,t.height=256;for(var r=t.getContext("2d"),n=r.getImageData(0,0,256,256),i=n.data,o=new Ia,s=0,a=0;s<i.length;s+=4,a++){var l=a%256/256-.5,c=Math.floor(a/256)/256-.5;o.setHSL(Math.atan2(c,l)/e,1,2*(.5-Math.sqrt(l*l+c*c))),i[s+0]=256*o.r,i[s+1]=256*o.g,i[s+2]=256*o.b,i[s+3]=256}return r.putImageData(n,0,0),new Af(t)}()}));o.position.set(0,.005,.0495),o.rotation.x=-1.45,o.scale.setScalar(.02),this.add(o);var s=new Vg(.1,2);(u=new zl).color=n;var a=new ql(s,u);o.add(a);var l=new Fh;l.position.set(0,.005,.0495),l.rotation.x=-1.45,l.scale.setScalar(.02),this.add(l);var c=new hy;c.moveTo(0,-1),c.lineTo(1,1),c.lineTo(-1,1);var u,h=new ql(s=new Fy(c),u=new zl({color:2236962,wireframe:!0}));h.position.z=.001,p(h.geometry,1),l.add(h),s=new Fy(c),(u=new zl({side:il})).color=n;var d=new ql(s,u);function p(t,e){var r=Math.atan(.25),n=1.5*e,i=Math.tan(r)*n*2;t.vertices[0].set(0,-.75,0),t.vertices[1].set(0+i/2,-.75+n,0),t.vertices[2].set(0-i/2,-.75+n,0),t.verticesNeedUpdate=!0}d.position.z=.0011,p(d.geometry,.5),l.add(d),l.visible=!1,this.getColor=function(){return n},this.getSize=function(){return i},this.addEventListener("axischanged",function(t){if(!1!==this.getButtonState("thumbpad")){var o=t.axes[0]/2,s=-t.axes[1]/2;if(0===r&&(n.setHSL(Math.atan2(s,o)/e,1,2*(.5-Math.sqrt(o*o+s*s))),a.position.set(t.axes[0],t.axes[1],0)),1===r){var l=.5-s;i=2*l,p(d.geometry,l)}}}),this.addEventListener("gripsdown",function(t){return 0===r?(r=1,o.visible=!1,void(l.visible=!0)):1===r?(r=0,o.visible=!0,void(l.visible=!1)):void 0})};function Vy(t){Jd.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Gy(t,e,r){Na.call(this),this.type="CubeCamera";var n=new bc(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new Ta(1,0,0)),this.add(n);var i=new bc(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new Ta(-1,0,0)),this.add(i);var o=new bc(90,1,t,e);o.up.set(0,0,1),o.lookAt(new Ta(0,1,0)),this.add(o);var s=new bc(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new Ta(0,-1,0)),this.add(s);var a=new bc(90,1,t,e);a.up.set(0,-1,0),a.lookAt(new Ta(0,0,1)),this.add(a);var l=new bc(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new Ta(0,0,-1)),this.add(l),this.renderTarget=new qm(r,r,{format:Al,magFilter:wl,minFilter:wl}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,n,r),r.activeCubeFace=1,t.render(e,i,r),r.activeCubeFace=2,t.render(e,o,r),r.activeCubeFace=3,t.render(e,s,r),r.activeCubeFace=4,t.render(e,a,r),r.texture.generateMipmaps=c,r.activeCubeFace=5,t.render(e,l,r),t.setRenderTarget(null)},this.clear=function(t,e,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,r,n);t.setRenderTarget(null)}}function Hy(t,e,r){za.call(this,t,e),this.meshPerAttribute=r||1}function Wy(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Xy(t){this.type="Font",this.data=t}function qy(t,e,r,n,i,o){var s=o.glyphs[t]||o.glyphs["?"];if(s){var a,l,c,u,h,d,p,f,m=new Wy;if(s.o)for(var v=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),g=0,y=v.length;g<y;)switch(v[g++]){case"m":a=v[g++]*r+n,l=v[g++]*r+i,m.moveTo(a,l);break;case"l":a=v[g++]*r+n,l=v[g++]*r+i,m.lineTo(a,l);break;case"q":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,m.quadraticCurveTo(h,d,c,u);break;case"b":c=v[g++]*r+n,u=v[g++]*r+i,h=v[g++]*r+n,d=v[g++]*r+i,p=v[g++]*r+n,f=v[g++]*r+i,m.bezierCurveTo(h,d,p,f,c,u)}return{offsetX:s.ha*r,path:m}}}function Yy(t,e,r,n,i,o,s){tc.call(this,0,t,e,r,n,i,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function Zy(t,e,r,n,i,o,s){ec.call(this,0,t,e,r,n,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:s}}function Jy(t,e){Ba.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Qy(t,e)),this.mergeVertices()}function Qy(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;mu.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ky(t,e){$a.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,s=[],a=Math.cos(_a.DEG2RAD*e),l=[0,0],c={},u=["a","b","c"];t.isBufferGeometry?(o=new Ba).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=a){var y=h[g.index1];s.push(y.x,y.y,y.z),s.push((y=h[g.index2]).x,y.y,y.z)}}this.addAttribute("position",new Za(s,3))}function $y(t,e){Ba.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new tx(t,e)),this.mergeVertices()}function tx(t,e){"undefined"!=typeof t&&($a.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function ex(t,e,r,n){Ba.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new rx(t,e,r,n)),this.mergeVertices()}function rx(t,e,r,n){$a.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=_a.clamp(n,0,2*Math.PI);var i,o,s,a=[],l=[],c=[],u=1/e,h=new Ta,d=new ka;for(o=0;o<=e;o++){var p=r+o*u*n,f=Math.sin(p),m=Math.cos(p);for(s=0;s<=t.length-1;s++)h.x=t[s].x*f,h.y=t[s].y,h.z=t[s].x*m,l.push(h.x,h.y,h.z),d.x=o/e,d.y=s/(t.length-1),c.push(d.x,d.y)}for(o=0;o<e;o++)for(s=0;s<t.length-1;s++){var v=(i=s+o*t.length)+t.length,g=i+t.length+1,y=i+1;a.push(i,v,y),a.push(v,g,y)}if(this.setIndex(a),this.addAttribute("position",new Za(l,3)),this.addAttribute("uv",new Za(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,b=new Ta,w=new Ta,_=new Ta;for(i=e*t.length*3,o=0,s=0;o<t.length;o++,s+=3)b.x=x[s+0],b.y=x[s+1],b.z=x[s+2],w.x=x[i+s+0],w.y=x[i+s+1],w.z=x[i+s+2],_.addVectors(b,w).normalize(),x[s+0]=x[i+s+0]=_.x,x[s+1]=x[i+s+1]=_.y,x[s+2]=x[i+s+2]=_.z}}function nx(t,e,r){Ba.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new ix(t,e,r)),this.mergeVertices()}function ix(t,e,r){$a.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],s=[],a=[],l=[],c=new Ta,u=new Ta,h=new Ta,d=new Ta,p=new Ta,f=e+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,m,u),s.push(u.x,u.y,u.z),v-1e-5>=0?(t(v-1e-5,m,h),d.subVectors(u,h)):(t(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(t(v,m-1e-5,h),p.subVectors(u,h)):(t(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),a.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var g=n*f+i+1,y=(n+1)*f+i+1,x=(n+1)*f+i;o.push(n*f+i,g,x),o.push(g,y,x)}this.setIndex(o),this.addAttribute("position",new Za(s,3)),this.addAttribute("normal",new Za(a,3)),this.addAttribute("uv",new Za(l,2))}function ox(t,e,r,n,i,o){Ba.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new sx(t,e,r,n,i,o)),this.mergeVertices()}function sx(t,e,r,n,i,o){$a.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,a,l,c=[],u=[],h=[],d=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Ta,v=new ka;for(a=0;a<=n;a++){for(l=0;l<=r;l++)s=i+l/r*o,m.x=p*Math.cos(s),m.y=p*Math.sin(s),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,d.push(v.x,v.y);p+=f}for(a=0;a<n;a++){var g=a*(r+1);for(l=0;l<r;l++){var y=(s=l+g)+r+1,x=s+r+2,b=s+1;c.push(s,y,b),c.push(y,x,b)}}this.setIndex(c),this.addAttribute("position",new Za(u,3)),this.addAttribute("normal",new Za(h,3)),this.addAttribute("uv",new Za(d,2))}function ax(t,e){Ba.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new lx(t,e)),this.mergeVertices()}function lx(t,e){mu.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function cx(t,e){Ba.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new ux(t,e)),this.mergeVertices()}function ux(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Ba;var n=r.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),tx.call(this,n,e),this.type="TextBufferGeometry"}function hx(t,e,r,n,i,o,s){Ba.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==s&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new dx(t,e,r,n,i,o)),this.mergeVertices()}function dx(t,e,r,n,i,o){$a.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var s,a,l=[],c=[],u=[],h=[],d=new Ta,p=new Ta,f=new Ta,m=new Ta,v=new Ta,g=new Ta,y=new Ta;for(s=0;s<=r;++s){var x=s/r*i*Math.PI*2;for(A(x,i,o,t,f),A(x+.01,i,o,t,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),a=0;a<=n;++a){var b=a/n*Math.PI*2,w=-e*Math.cos(b),_=e*Math.sin(b);d.x=f.x+(w*y.x+_*v.x),d.y=f.y+(w*y.y+_*v.y),d.z=f.z+(w*y.z+_*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(s/r),h.push(a/n)}}for(a=1;a<=r;a++)for(s=1;s<=n;s++){var S=(n+1)*a+(s-1),T=(n+1)*a+s,M=(n+1)*(a-1)+s;l.push((n+1)*(a-1)+(s-1),S,M),l.push(S,T,M)}function A(t,e,r,n,i){var o=Math.cos(t),s=Math.sin(t),a=r/e*t,l=Math.cos(a);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*s*.5,i.z=n*Math.sin(a)*.5}this.setIndex(l),this.addAttribute("position",new Za(c,3)),this.addAttribute("normal",new Za(u,3)),this.addAttribute("uv",new Za(h,2))}function px(t,e,r,n,i,o){Ba.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var s=new fx(t,e,r,n,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function fx(t,e,r,n,i){$a.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8;var o=t.computeFrenetFrames(e,i=i||!1);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,l=new Ta,c=new Ta,u=new ka,h=new Ta,d=[],p=[],f=[],m=[];function v(i){h=t.getPointAt(i/e,h);var s=o.normals[i],u=o.binormals[i];for(a=0;a<=n;a++){var f=a/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*s.x+m*u.x,c.y=v*s.y+m*u.y,c.z=v*s.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(s=0;s<e;s++)v(s);v(!1===i?e:0),function(){for(s=0;s<=e;s++)for(a=0;a<=n;a++)u.x=s/e,u.y=a/n,f.push(u.x,u.y)}(),function(){for(a=1;a<=e;a++)for(s=1;s<=n;s++){var t=(n+1)*a+(s-1),r=(n+1)*a+s,i=(n+1)*(a-1)+s;m.push((n+1)*(a-1)+(s-1),t,i),m.push(t,r,i)}}()}(),this.setIndex(m),this.addAttribute("position",new Za(d,3)),this.addAttribute("normal",new Za(p,3)),this.addAttribute("uv",new Za(f,2))}function mx(t,e,r,n,i,o){Na.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===By&&((By=new $a).addAttribute("position",new Za([0,0,0,0,1,0],3)),(jy=new ec(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Yl(By,new Vl({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ql(jy,new zl({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function vx(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new $a;r.addAttribute("position",new Za(e,3)),r.addAttribute("color",new Za([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Vl({vertexColors:al});nd.call(this,r,n)}function gx(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new $a;i.setIndex(new za(n,1)),i.addAttribute("position",new Za([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),nd.call(this,i,new Vl({color:r})),this.geometry.computeBoundingSphere()}function yx(t){var e=new $a,r=new Vl({color:16777215,vertexColors:sl}),n=[],i=[],o={},s=new Ia(16755200),a=new Ia(16711680),l=new Ia(43775),c=new Ia(16777215),u=new Ia(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.addAttribute("position",new Za(n,3)),e.addAttribute("color",new Za(i,3)),nd.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function xx(t,e,r){Na.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new $a;n.addAttribute("position",new Za([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new Vl({fog:!1});this.lightPlane=new Yl(n,i),this.add(this.lightPlane),(n=new $a).addAttribute("position",new Za([0,0,0,0,0,1],3)),this.targetLine=new Yl(n,i),this.add(this.targetLine),this.update()}function bx(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var l=new $a,c=new Za(2*s*3,3);l.addAttribute("position",c),nd.call(this,l,new Vl({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function wx(t,e,r,n){t=t||10,e=e||10,r=new Ia(void 0!==r?r:4473924),n=new Ia(void 0!==n?n:8947848);for(var i=e/2,o=t/e,s=t/2,a=[],l=[],c=0,u=0,h=-s;c<=e;c++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);var d=c===i?r:n;d.toArray(l,u),d.toArray(l,u+=3),d.toArray(l,u+=3),d.toArray(l,u+=3),u+=3}var p=new $a;p.addAttribute("position",new Za(a,3)),p.addAttribute("color",new Za(l,3));var f=new Vl({vertexColors:al});nd.call(this,p,f)}function _x(t,e,r){Na.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new gu(e);n.rotateY(.5*Math.PI),this.material=new zl({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=al);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new za(o,3)),this.add(new ql(n,this.material)),this.update()}function Sx(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new $a;i.addAttribute("position",new Za([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Yl.call(this,i,new Vl({color:n}));var o=new $a;o.addAttribute("position",new Za([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new ql(o,new zl({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Tx(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new el(e,4,2),i=new zl({wireframe:!0,fog:!1});ql.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Mx(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new Ia(void 0!==i?i:4473924),o=new Ia(void 0!==o?o:8947848);var s,a,l,c,u,h,d,p=[],f=[];for(c=0;c<=e;c++)l=c/e*(2*Math.PI),s=Math.sin(l)*t,a=Math.cos(l)*t,p.push(0,0,0),p.push(s,0,a),f.push((d=1&c?i:o).r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:o,h=t-t/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new $a;m.addAttribute("position",new Za(p,3)),m.addAttribute("color",new Za(f,3));var v=new Vl({vertexColors:al});nd.call(this,m,v)}function Ax(t,e){Na.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var r=new Vl({fog:!1}),n=new $a;n.addAttribute("position",new za(new Float32Array(15),3)),this.line=new Yl(n,r),this.add(this.line),this.update()}function Ex(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,t(e.children[n]));return r}(t),r=new $a,n=[],i=[],o=new Ia(0,0,1),s=new Ia(0,1,0),a=0;a<e.length;a++){var l=e[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}r.addAttribute("position",new Za(n,3)),r.addAttribute("color",new Za(i,3));var c=new Vl({vertexColors:al,depthTest:!1,depthWrite:!1,transparent:!0});nd.call(this,r,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Cx(t,e){Na.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new $a,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var s=i/32*Math.PI*2,a=o/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}r.addAttribute("position",new Za(n,3));var l=new Vl({fog:!1});this.cone=new nd(r,l),this.add(this.cone),this.update()}function Px(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var l=new $a,c=new Za(2*s*3,3);l.addAttribute("position",c),nd.call(this,l,new Vl({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ox(t,e,r,n){Xh.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Nx(t){this.manager=void 0!==t?t:Dc}(zy.prototype=Object.create(Bg.prototype)).constructor=zy,Object.assign((function(){var t=arguments;this.uuid=_a.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var r=0,n=arguments.length;r!==n;++r)e[t[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}).prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=arguments,e=this._objects,r=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length,c=void 0,u=0,h=arguments.length;u!==h;++u){var d=t[u],p=d.uuid,f=i[p];if(void 0===f){f=r++,i[p]=f,e.push(d);for(var m=0,v=l;m!==v;++m)a[m].push(new sh(d,o[m],s[m]))}else if(f<n){c=e[f];var g=--n,y=e[g];for(i[y.uuid]=f,e[f]=y,i[p]=g,e[g]=d,m=0,v=l;m!==v;++m){var x=a[m],b=x[f];x[f]=x[g],void 0===b&&(b=new sh(d,o[m],s[m])),x[g]=b}}else e[f]!==c&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=arguments,e=this._objects,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,s=0,a=arguments.length;s!==a;++s){var l=t[s],c=l.uuid,u=n[c];if(void 0!==u&&u>=r){var h=r++,d=e[h];n[d.uuid]=u,e[u]=d,n[c]=h,e[h]=l;for(var p=0,f=o;p!==f;++p){var m=i[p],v=m[u];m[u]=m[h],m[h]=v}}}this.nCachedObjects_=r},uncache:function(){for(var t=arguments,e=this._objects,r=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,o=this._bindings,s=o.length,a=0,l=arguments.length;a!==l;++a){var c=t[a].uuid,u=i[c];if(void 0!==u)if(delete i[c],u<n){var h=--n,d=e[h],p=e[g=--r];i[d.uuid]=u,e[u]=d,i[p.uuid]=h,e[h]=p,e.pop();for(var f=0,m=s;f!==m;++f){var v=(y=o[f])[g];y[u]=y[h],y[h]=v,y.pop()}}else{var g;for(i[(p=e[g=--r]).uuid]=u,e[u]=p,e.pop(),f=0,m=s;f!==m;++f){var y;(y=o[f])[u]=y[g],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,s=this._parsedPaths,a=this._objects,l=this.nCachedObjects_,c=new Array(a.length);r[t]=n=i.length,o.push(t),s.push(e),i.push(c);for(var u=l,h=a.length;u!==h;++u)c[u]=new sh(a[u],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=r,o[r]=a,o.pop(),i[r]=i[s],i.pop(),n[r]=n[s],n.pop()}}}),Object.assign((function(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}).prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Vy.prototype=Object.assign(Object.create(Jd.prototype),{constructor:Vy,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new Ta;return function(e){Na.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),(Gy.prototype=Object.create(Na.prototype)).constructor=Gy,Hy.prototype=Object.assign(Object.create(za.prototype),{constructor:Hy,isInstancedBufferAttribute:!0,copy:function(t){return za.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Wy.prototype,{moveTo:function(t,e){this.currentPath=new uy,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,n){this.currentPath.quadraticCurveTo(t,e,r,n)},bezierCurveTo:function(t,e,r,n,i,o){this.currentPath.bezierCurveTo(t,e,r,n,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new hy;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var s=e[i],a=e[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(s=e[o],l=-l,a=e[i],c=-c),t.y<s.y||t.y>a.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var u=c*(t.x-s.x)-l*(t.y-s.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(t.y!==s.y)continue;if(a.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=a.x)return!0}}return n}var i=Iy.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var s,a,l,c=[];if(1===o.length)return a=o[0],(l=new hy).curves=a.curves,c.push(l),c;var u=!i(o[0].getPoints());u=t?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)s=i(h=(a=o[g]).getPoints()),(s=t?!s:s)?(!u&&f[v]&&v++,f[v]={s:new hy,p:h},f[v].s.curves=a.curves,u&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var S=m[w],T=0;T<S.length;T++){for(var M=S[T],A=!0,E=0;E<f.length;E++)n(M.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:T}),A?(A=!1,p[E].push(M)):x=!0);A&&p[w].push(M)}b.length>0&&(x||(m=p))}g=0;for(var C=f.length;g<C;g++){c.push(l=f[g].s);for(var P=0,O=(d=m[g]).length;P<O;P++)l.holes.push(d[P].h)}return c}}),Object.assign(Xy.prototype,{isFont:!0,generateShapes:function(t,e,r){void 0===e&&(e=100),void 0===r&&(r=4);for(var n=[],i=function(t,e,r,n){for(var i=String(t).split(""),o=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[],l=0,c=0,u=0;u<i.length;u++){var h=i[u];if("\n"===h)l=0,c-=s;else{var d=qy(h,0,o,l,c,n);l+=d.offsetX,a.push(d.path)}}return a}(t,e,0,this.data),o=0,s=i.length;o<s;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),(Yy.prototype=Object.create(tc.prototype)).constructor=Yy,(Zy.prototype=Object.create(ec.prototype)).constructor=Zy,(Jy.prototype=Object.create(Ba.prototype)).constructor=Jy,(Qy.prototype=Object.create(mu.prototype)).constructor=Qy,(Ky.prototype=Object.create($a.prototype)).constructor=Ky,($y.prototype=Object.create(Ba.prototype)).constructor=$y,(tx.prototype=Object.create($a.prototype)).constructor=tx,tx.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:e,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},tx.prototype.addShapeList=function(t,e){var r=t.length;e.arrays=this.getArrays();for(var n=0;n<r;n++)this.addShape(t[n],e);this.setIndex(e.arrays.index),this.addAttribute("position",new Za(e.arrays.position,3)),this.addAttribute("uv",new Za(e.arrays.uv,2))},tx.prototype.addShape=function(t,e){var r,n,i,o,s,a,l,c,u=e.arrays?e.arrays:this.getArrays(),h=u.position,d=u.index,p=u.uv,f=[],m=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,g=void 0!==e.bevelSize?e.bevelSize:v-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,x=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,_=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:$y.WorldUVGenerator;_&&(r=_.getSpacedPoints(w),S=!0,x=!1,n=void 0!==e.frames?e.frames:_.computeFrenetFrames(w,!1),i=new Ta,o=new Ta,s=new Ta),x||(y=0,v=0,g=0);var M=this,A=t.extractPoints(b),E=A.shape,C=A.holes;if(!Iy.isClockWise(E))for(E=E.reverse(),l=0,c=C.length;l<c;l++)Iy.isClockWise(a=C[l])&&(C[l]=a.reverse());var P=Iy.triangulateShape(E,C),O=E;for(l=0,c=C.length;l<c;l++)E=E.concat(a=C[l]);function N(t,e,r){return e||console.error("ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var L,I,R,D,F,k,U=E.length,B=P.length;function j(t,e,r){var n,i,o,s=t.x-e.x,a=t.y-e.y,l=r.x-t.x,c=r.y-t.y,u=s*s+a*a;if(Math.abs(s*c-a*l)>Number.EPSILON){var h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+s/h,m=((r.x-c/d-p)*c-(r.y+l/d-f)*l)/(s*c-a*l),v=(n=p+s*m-t.x)*n+(i=f+a*m-t.y)*i;if(v<=2)return new ka(n,i);o=Math.sqrt(v/2)}else{var g=!1;s>Number.EPSILON?l>Number.EPSILON&&(g=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(g=!0):Math.sign(a)===Math.sign(c)&&(g=!0),g?(n=-a,i=s,o=Math.sqrt(u)):(n=s,i=a,o=Math.sqrt(u/2))}return new ka(n/o,i/o)}for(var z=[],V=0,G=O.length,H=G-1,W=V+1;V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),z[V]=j(O[V],O[H],O[W]);var X,q,Y=[],Z=z.concat();for(l=0,c=C.length;l<c;l++){for(X=[],H=(G=(a=C[l]).length)-1,W=1+(V=0);V<G;V++,H++,W++)H===G&&(H=0),W===G&&(W=0),X[V]=j(a[V],a[H],a[W]);Y.push(X),Z=Z.concat(X)}for(L=0;L<y;L++){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,-D);for(l=0,c=C.length;l<c;l++)for(X=Y[l],V=0,G=(a=C[l]).length;V<G;V++)Q((F=N(a[V],X[V],I)).x,F.y,-D)}for(I=g,V=0;V<U;V++)F=x?N(E[V],Z[V],I):E[V],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),s.copy(r[0]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,0);for(q=1;q<=w;q++)for(V=0;V<U;V++)F=x?N(E[V],Z[V],I):E[V],S?(o.copy(n.normals[q]).multiplyScalar(F.x),i.copy(n.binormals[q]).multiplyScalar(F.y),s.copy(r[q]).add(o).add(i),Q(s.x,s.y,s.z)):Q(F.x,F.y,m/w*q);for(L=y-1;L>=0;L--){for(R=L/y,D=v*Math.cos(R*Math.PI/2),I=g*Math.sin(R*Math.PI/2),V=0,G=O.length;V<G;V++)Q((F=N(O[V],z[V],I)).x,F.y,m+D);for(l=0,c=C.length;l<c;l++)for(X=Y[l],V=0,G=(a=C[l]).length;V<G;V++)F=N(a[V],X[V],I),S?Q(F.x,F.y+r[w-1].y,r[w-1].x+D):Q(F.x,F.y,m+D)}function J(t,e){var r,n;for(V=t.length;--V>=0;){r=V,(n=V-1)<0&&(n=t.length-1);var i=0,o=w+2*y;for(i=0;i<o;i++){var s=U*i,a=U*(i+1);$(e+r+s,e+n+s,e+n+a,e+r+a)}}}function Q(t,e,r){f.push(t),f.push(e),f.push(r)}function K(t,e,r){tt(t),tt(e),tt(r);var n=h.length/3,i=T.generateTopUV(M,h,n-3,n-2,n-1);et(i[0]),et(i[1]),et(i[2])}function $(t,e,r,n){tt(t),tt(e),tt(n),tt(e),tt(r),tt(n);var i=h.length/3,o=T.generateSideWallUV(M,h,i-6,i-3,i-2,i-1);et(o[0]),et(o[1]),et(o[3]),et(o[1]),et(o[2]),et(o[3])}function tt(t){d.push(h.length/3),h.push(f[3*t+0]),h.push(f[3*t+1]),h.push(f[3*t+2])}function et(t){p.push(t.x),p.push(t.y)}!function(){var t=h.length/3;if(x){var e=0,r=U*e;for(V=0;V<B;V++)K((k=P[V])[2]+r,k[1]+r,k[0]+r);for(r=U*(e=w+2*y),V=0;V<B;V++)K((k=P[V])[0]+r,k[1]+r,k[2]+r)}else{for(V=0;V<B;V++)K((k=P[V])[2],k[1],k[0]);for(V=0;V<B;V++)K((k=P[V])[0]+U*w,k[1]+U*w,k[2]+U*w)}M.addGroup(t,h.length/3-t,0)}(),function(){var t=h.length/3,e=0;for(J(O,e),e+=O.length,l=0,c=C.length;l<c;l++)J(a=C[l],e),e+=a.length;M.addGroup(t,h.length/3-t,1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new Za(h,3)),this.addAttribute("uv",new Za(p,2)))},$y.WorldUVGenerator={generateTopUV:function(t,e,r,n,i){var o=e[3*n],s=e[3*n+1],a=e[3*i],l=e[3*i+1];return[new ka(e[3*r],e[3*r+1]),new ka(o,s),new ka(a,l)]},generateSideWallUV:function(t,e,r,n,i,o){var s=e[3*r],a=e[3*r+1],l=e[3*r+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*o],v=e[3*o+1],g=e[3*o+2];return Math.abs(a-u)<.01?[new ka(s,1-l),new ka(c,1-h),new ka(d,1-f),new ka(m,1-g)]:[new ka(a,1-l),new ka(u,1-h),new ka(p,1-f),new ka(v,1-g)]}},(ex.prototype=Object.create(Ba.prototype)).constructor=ex,(rx.prototype=Object.create($a.prototype)).constructor=rx,(nx.prototype=Object.create(Ba.prototype)).constructor=nx,(ix.prototype=Object.create($a.prototype)).constructor=ix,(ox.prototype=Object.create(Ba.prototype)).constructor=ox,(sx.prototype=Object.create($a.prototype)).constructor=sx,(ax.prototype=Object.create(Ba.prototype)).constructor=ax,(lx.prototype=Object.create(mu.prototype)).constructor=lx,(cx.prototype=Object.create(Ba.prototype)).constructor=cx,(ux.prototype=Object.create(tx.prototype)).constructor=ux,(hx.prototype=Object.create(Ba.prototype)).constructor=hx,(dx.prototype=Object.create($a.prototype)).constructor=dx,(px.prototype=Object.create(Ba.prototype)).constructor=px,(fx.prototype=Object.create($a.prototype)).constructor=fx,(mx.prototype=Object.create(Na.prototype)).constructor=mx,mx.prototype.setDirection=function(){var t,e=new Ta;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),mx.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},mx.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(vx.prototype=Object.create(nd.prototype)).constructor=vx,(gx.prototype=Object.create(nd.prototype)).constructor=gx,gx.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Na.prototype.updateMatrixWorld.call(this,t))},(yx.prototype=Object.create(nd.prototype)).constructor=yx,yx.prototype.update=function(){var t,e,r=new Ta,n=new xc;function i(i,o,s,a){r.set(o,s,a).unproject(n);var l=e[i];if(void 0!==l)for(var c=t.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap,n.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(xx.prototype=Object.create(Na.prototype)).constructor=xx,xx.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},xx.prototype.update=function(){var t=new Ta,e=new Ta,r=new Ta;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),(bx.prototype=Object.create(nd.prototype)).constructor=bx,bx.prototype.update=function(){var t=new Ta,e=new Ta,r=new Pa;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,c=0,u=a.length;c<u;c++){var h=a[c],d=h.normal;t.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),i.setXYZ(l,t.x,t.y,t.z),i.setXYZ(l+=1,e.x,e.y,e.z),l+=1}i.needsUpdate=!0}}(),(wx.prototype=Object.create(nd.prototype)).constructor=wx,(_x.prototype=Object.create(Na.prototype)).constructor=_x,_x.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},_x.prototype.update=function(){var t=new Ta,e=new Ia,r=new Ia;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,s=i.count;o<s;o++){var a=o<s/2?e:r;i.setXYZ(o,a.r,a.g,a.b)}i.needsUpdate=!0}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Sx.prototype=Object.create(Yl.prototype)).constructor=Sx,Sx.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),Na.prototype.updateMatrixWorld.call(this,t)},(Tx.prototype=Object.create(ql.prototype)).constructor=Tx,Tx.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Tx.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(Mx.prototype=Object.create(nd.prototype)).constructor=Mx,(Ax.prototype=Object.create(Na.prototype)).constructor=Ax,Ax.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ax.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Ex.prototype=Object.create(nd.prototype)).constructor=Ex,Ex.prototype.updateMatrixWorld=function(){var t=new Ta,e=new Sa,r=new Sa;return function(n){var i=this.bones,o=this.geometry,s=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var a=0,l=0;a<i.length;a++){var c=i[a];c.parent&&c.parent.isBone&&(e.multiplyMatrices(r,c.matrixWorld),t.setFromMatrixPosition(e),s.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,c.parent.matrixWorld),t.setFromMatrixPosition(e),s.setXYZ(l+1,t.x,t.y,t.z),l+=2)}o.getAttribute("position").needsUpdate=!0,Na.prototype.updateMatrixWorld.call(this,n)}}(),(Cx.prototype=Object.create(Na.prototype)).constructor=Cx,Cx.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Cx.prototype.update=function(){var t=new Ta,e=new Ta;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Px.prototype=Object.create(nd.prototype)).constructor=Px,Px.prototype.update=function(){var t=new Ta,e=new Ta,r=new Pa;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,l=s.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=d.vertexNormals[p];t.copy(a[d[n[p]]]).applyMatrix4(i),e.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}else if(s&&s.isBufferGeometry){var v=s.attributes.position,g=s.attributes.normal;for(c=0,p=0,f=v.count;p<f;p++)t.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),e.set(g.getX(p),g.getY(p),g.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),o.setXYZ(c,t.x,t.y,t.z),o.setXYZ(c+=1,e.x,e.y,e.z),c+=1}o.needsUpdate=!0}}(),Ox.prototype=Object.assign(Object.create(Xh.prototype),{constructor:Ox,isRectAreaLight:!0,copy:function(t){return Xh.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Xh.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign((function(t){this.manager=void 0!==t?t:Dc}).prototype,{load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t,e){for(var r=[],n=0;n<t.length;n++){var i=gc.parse(t[n]);r.push(i)}e(r)}}),Object.assign(Nx.prototype,{load:function(t,e,r,n){var i=this;new kc(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){var e=new $a,r=t.data.index;if(void 0!==r){var n=new Lx[r.type](r.array);e.setIndex(new za(n,1))}var i=t.data.attributes;for(var o in i){var s=i[o];n=new Lx[s.type](s.array),e.addAttribute(o,new za(n,s.itemSize,s.normalized))}var a=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==a)for(var l=0,c=a.length;l!==c;++l){var u=a[l];e.addGroup(u.start,u.count,u.materialIndex)}var h=t.data.boundingSphere;if(void 0!==h){var d=new Ta;void 0!==h.center&&d.fromArray(h.center),e.boundingSphere=new Fa(d,h.radius)}return e}});var Lx={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ix(t){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Dc,this.options=void 0}function Rx(){Na.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Dx(t,e,r){this.name="",this.color=new Ia(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function Fx(t,e){this.name="",this.color=new Ia(t),this.density=void 0!==e?e:25e-5}Object.assign((function(t){this.manager=void 0!==t?t:Dc}).prototype,{crossOrigin:"Anonymous",load:function(t,e,r,n){var i=new zd,o=new Qc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(r){o.load(t[r],function(t){i.images[r]=t,6==++s&&(i.needsUpdate=!0,e&&e(i))},void 0,n)}for(var l=0;l<t.length;++l)a(l);return i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign((function(t){this.manager=void 0!==t?t:Dc}).prototype,{load:function(t,e,r,n){var i=this,o=new kc(this.manager);o.setPath(this.path),o.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)},r,n)},parse:function(t){return new Xy(t)},setPath:function(t){return this.path=t,this}}),Ix.prototype={constructor:Ix,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,o=Ic.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(r){Ic.add(t,r),e&&e(r),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemEnd(t),i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Rx.prototype=Object.assign(Object.create(Na.prototype),{constructor:Rx,copy:function(t){Na.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object},raycast:function(){var t=new Ta;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,r)}}(),update:function(){var t=new Ta,e=new Ta;return function(r){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=Na.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Dx.prototype.isFog=!0,Dx.prototype.clone=function(){return new Dx(this.color.getHex(),this.near,this.far)},Dx.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Fx.prototype.isFogExp2=!0,Fx.prototype.clone=function(){return new Fx(this.color.getHex(),this.density)},Fx.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var kx={WireframeGeometry:Ch,TetrahedronGeometry:ax,TetrahedronBufferGeometry:lx,OctahedronGeometry:vu,OctahedronBufferGeometry:gu,IcosahedronGeometry:Vg,IcosahedronBufferGeometry:Gg,DodecahedronGeometry:Jy,DodecahedronBufferGeometry:Qy,PolyhedronGeometry:fu,PolyhedronBufferGeometry:mu,TubeGeometry:px,TubeBufferGeometry:fx,TorusKnotGeometry:hx,TorusGeometry:yu,TorusBufferGeometry:xu,TextGeometry:cx,TextBufferGeometry:ux,SphereGeometry:tl,SphereBufferGeometry:el,RingGeometry:ox,RingBufferGeometry:sx,PlaneGeometry:Pc,PlaneBufferGeometry:Oc,LatheGeometry:ex,LatheBufferGeometry:rx,ShapeGeometry:Fy,ShapeBufferGeometry:ky,ExtrudeGeometry:$y,ExtrudeBufferGeometry:tx,EdgesGeometry:Ky,ConeGeometry:Yy,ConeBufferGeometry:Zy,CylinderGeometry:tc,CylinderBufferGeometry:ec,CircleGeometry:jg,CircleBufferGeometry:zg,BoxGeometry:Kl,BoxBufferGeometry:$l};Object.assign((function(t){this.manager=void 0!==t?t:Dc,this.texturePath=""}).prototype,{load:function(t,e,r,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new kc(i.manager).load(t,function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,e):console.error("ObjectLoader: Can't load "+t+". Use JSONLoader instead.")},r,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,function(){void 0!==e&&e(a)}),o=this.parseTextures(t.textures,i),s=this.parseMaterials(t.materials,o),a=this.parseObject(t.object,n,s);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new hy).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new eu,i=new Nx,o=0,s=t.length;o<s;o++){var a,l=t[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new kx[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new kx[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new kx[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new kx[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new kx[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new kx[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new kx[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new kx[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new kx[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new kx[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new kx[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new kx[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var c=[];for(o=0,s=l.shapes.length;o<s;o++)c.push(e[l.shapes[o]]);a=new kx[l.type](c,l.curveSegments);break;case"BufferGeometry":a=i.parse(l);break;case"Geometry":a=n.parse(l,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),r[l.uuid]=a}return r},parseMaterials:function(t,e){var r={};if(void 0!==t){var n=new Jc;n.setTextures(e);for(var i=0,o=t.length;i<o;i++){var s=t[i];if("MultiMaterial"===s.type){for(var a=[],l=0;l<s.materials.length;l++)a.push(n.parse(s.materials[l]));r[s.uuid]=a}else r[s.uuid]=n.parse(s)}}return r},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=gc.parse(t[r]);e.push(n)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemEnd(t),r.manager.itemError(t)})}if(void 0!==t&&t.length>0){var o=new Qc(new Rc(e));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=t.length;s<a;s++){var l=t[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=i(c)}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var s=t[i];void 0===s.image&&console.warn('ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("ObjectLoader: Undefined image",s.image);var a=new Mc(e[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,Ux)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],Bx),a.wrapT=r(s.wrap[1],Bx)),void 0!==s.format&&(a.format=s.format),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,jx)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,jx)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),n[s.uuid]=a}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new _c,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Ia(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Dx(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new Fx(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new bc(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new Sc(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new rd(t.color,t.intensity);break;case"DirectionalLight":n=new Jh(t.color,t.intensity);break;case"PointLight":n=new Yh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Ox(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new Kh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new $h(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=i(t.geometry),a=o(t.material);n=s.bones&&s.bones.length>0?new zh(s,a):new ql(s,a);break;case"LOD":n=new Rx;break;case"Line":n=new Yl(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new ld(i(t.geometry),o(t.material));break;case"LineSegments":n=new nd(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new bh(i(t.geometry),o(t.material));break;case"Sprite":n=new Ef(o(t.material));break;case"Group":n=new Fh;break;default:n=new Na}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,r));if("LOD"===t.type)for(var u=t.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var Ux={UVMapping:300,CubeReflectionMapping:fl,CubeRefractionMapping:302,EquirectangularReflectionMapping:ml,EquirectangularRefractionMapping:304,SphericalReflectionMapping:vl,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Bx={RepeatWrapping:gl,ClampToEdgeWrapping:yl,MirroredRepeatWrapping:xl},jx={NearestFilter:bl,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:wl,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:_l};function zx(t,e,r,n,i,o,s,a,l){Mc.call(this,t,e,r,n,i,o,s,a,l),this.generateMipmaps=!1}Object.assign((function(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}).prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),zx.prototype=Object.assign(Object.create(Mc.prototype),{constructor:zx,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var Vx=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};const Gx=ra(ea);class Hx{constructor(t){this.controlService=t,this.isOrbitControlEnabled=!1,this.beforeWorldRenderSubject=new pe.b,this.afterWorldRenderSubject=new pe.b,this.beforeControlRenderSubject=new pe.b,this.afterControlRenderSubject=new pe.b,this.renderWorldLoopEnabled=!1,this.fieldOfView=45,this.nearClippingPane=1,this.farClippingPane=1e4,this.cameraDistance=64,this.sunLightPhi=.9,this.sunLightTheta=2.5,this.seaLevel=58,t.cameraDistanceSubject.subscribe(t=>{if(this.cameraDistance=t,this.sunDirectLight){let t=(this.cameraDistance*Math.tan(this.fieldOfView*Math.PI/360)+this.seaLevel*Math.tan(this.sunLightPhi))*Math.sin(Math.PI/2-this.sunLightPhi);t*=Math.sqrt(3),this.sunDirectLight.shadow.camera.bottom=-(t*=1.1),this.sunDirectLight.shadow.camera.top=t,this.sunDirectLight.shadow.camera.left=-t,this.sunDirectLight.shadow.camera.right=t,this.sunDirectLight.shadow.camera.near=0,this.sunDirectLight.shadow.camera.far=4*this.cameraDistance,this.sunDirectLight.shadow.map&&(this.sunDirectLight.shadow.map.dispose(),this.sunDirectLight.shadow.map=null)}})}get worldCanvas(){return this.worldCanvasRef.nativeElement}get controlCanvas(){return this.controlCanvasRef.nativeElement}animateCamera(){this.camera&&this.car&&this.car.mesh&&(this.camera.position.x=this.car.mesh.position.x+Math.cos(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.y=this.car.mesh.position.y+Math.sin(this.car.rotation)*Math.max(this.car.speed,0)/2,this.camera.position.z=this.cameraDistance,this.isOrbitControlEnabled&&(this.camera.position.y-=.5),this.camera.up=this.isOrbitControlEnabled?new ea.Vector3(0,0,1):new ea.Vector3(0,1,0),this.camera.lookAt(new ea.Vector3(this.car.mesh.position.x+Math.cos(this.car.rotation)*this.car.speed/2,this.car.mesh.position.y+Math.sin(this.car.rotation)*this.car.speed/2,this.car.mesh.position.z)),this.sunDirectLight.position.set(this.camera.position.x+this.cameraDistance*Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.camera.position.y+this.cameraDistance*Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),this.car.mesh.position.z+this.cameraDistance*Math.cos(this.sunLightPhi)),this.sunDirectLight.target.position.set(this.camera.position.x,this.camera.position.y,this.car.mesh.position.z),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update())}resizeCanvas(t,e){this.worldCanvas.width=t,this.worldCanvas.height=e,this.controlCanvas.width=t,this.controlCanvas.height=e,this.camera.aspect=this.worldCanvas.width/this.worldCanvas.height,this.camera.updateProjectionMatrix(),this.worldRenderer&&this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer&&this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height),this.isOrbitControlEnabled&&this.orbitControls&&this.orbitControls.update(),this.renderWorldLoopEnabled||this.renderWorldOnce(),this.renderControlsOnce()}addCar(t,e=!1){e&&(this.car=t),this.scene.add(t.mesh)}addMap(t,e){t.traverse(function(t){t instanceof ea.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.scene.add(t)}addControlElement(t){this.controlScene.add(t)}createScene(){this.scene=new ea.Scene,this.controlScene=new ea.Scene,this.camera=new ea.PerspectiveCamera(this.fieldOfView,this.worldCanvas.width/this.worldCanvas.height,this.nearClippingPane,this.farClippingPane),this.isOrbitControlEnabled&&(this.orbitControls=new Gx(this.camera)),this.sunAmbientLight=new ea.HemisphereLight(12303359,8949920,.85),this.sunAmbientLight.position.set(0,0,1),this.scene.add(this.sunAmbientLight),this.sunDirectLight=new ea.DirectionalLight(16777215,1.5),this.sunDirectLight.castShadow=!0,this.sunDirectLight.shadow.mapSize.width=2048,this.sunDirectLight.shadow.mapSize.height=2048,this.scene.add(this.sunDirectLight),this.scene.add(this.sunDirectLight.target),console.log(this.sunDirectLight);const t=new ea.Vector3(Math.cos(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.sin(this.sunLightTheta)*Math.sin(this.sunLightPhi),Math.cos(this.sunLightPhi));this.sky=new na,this.sky.scale.setScalar(8e3),this.sky.up=new ea.Vector3(0,0,1),this.sky.material.fragmentShader=this.sky.material.fragmentShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.vertexShader=this.sky.material.vertexShader.replace("const vec3 up = vec3( 0.0, 1.0, 0.0 );","const vec3 up = vec3( 0.0, 0.0, 1.0 );"),this.sky.material.uniforms.turbidity.value=10,this.sky.material.uniforms.rayleigh.value=2,this.sky.material.uniforms.luminance.value=1,this.sky.material.uniforms.mieCoefficient.value=.005,this.sky.material.uniforms.mieDirectionalG.value=.8,this.sky.material.uniforms.sunPosition.value=t.clone(),this.scene.add(this.sky),this.water=new Fm(new ea.PlaneBufferGeometry(1e4,1e4),{textureWidth:128,textureHeight:128,waterNormals:(new ea.TextureLoader).load("assets/models/maps/common/textures/waternormals.jpg",function(t){t.wrapS=t.wrapT=ea.RepeatWrapping}),alpha:1,sunDirection:t.clone(),sunColor:16777215,waterColor:13365,distortionScale:3.7}),this.water.material.uniforms.size.value=3,this.water.position.z=-this.seaLevel,this.water.material.fragmentShader=this.water.material.fragmentShader.replace("getNoise( worldPosition.xz * size );","getNoise( worldPosition.xy * size );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","vec3 surfaceNormal = normalize( noise.xyz * vec3( 1.5, 1.0, 1.5 ) );"),this.water.material.fragmentShader=this.water.material.fragmentShader.replace("vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","vec2 distortion = surfaceNormal.xy * ( 0.001 + 1.0 / distance ) * distortionScale;"),this.scene.add(this.water),this.beforeWorldRenderSubject.subscribe(()=>{this.water.material.uniforms.time.value+=1/60})}initCanvases(){this.worldRenderer=new ea.WebGLRenderer({canvas:this.worldCanvas,antialias:!0,transparent:!0}),this.worldRenderer.shadowMap.enabled=!0,this.worldRenderer.shadowMapType=ea.PCFSoftShadowMap,this.worldRenderer.setPixelRatio(devicePixelRatio),this.worldRenderer.setSize(this.worldCanvas.width,this.worldCanvas.height),this.controlRenderer=new ea.WebGLRenderer({canvas:this.controlCanvas,antialias:!0,alpha:!0}),this.controlRenderer.setPixelRatio(devicePixelRatio),this.controlRenderer.setSize(this.controlCanvas.width,this.controlCanvas.height)}ngAfterViewInit(){this.resizeCanvas(window.innerWidth,window.innerHeight),this.initCanvases()}ngOnInit(){this.createScene()}renderWorldOnce(){requestAnimationFrame(this._renderWorldSceneRoutine.bind(this))}startWorldRenderingLoop(){this.renderWorldLoopEnabled=!0,this.renderWorldOnce()}stopWorldRenderingLoop(){this.renderWorldLoopEnabled=!1}renderControlsOnce(){requestAnimationFrame(this._renderControlSceneRoutine.bind(this))}renderControlsOnceSync(){return Vx(this,void 0,void 0,function*(){return new Promise(t=>{const e=this.afterControlRenderSubject.subscribe(()=>{e.unsubscribe(),t()});this.renderControlsOnce()})})}_renderWorldSceneRoutine(){this.renderWorldLoopEnabled&&requestAnimationFrame(this._renderWorldSceneRoutine.bind(this)),this.beforeWorldRenderSubject.next(),this.worldRenderer.clear(),this.worldRenderer.render(this.scene,this.camera),this.afterWorldRenderSubject.next()}_renderControlSceneRoutine(){this.beforeControlRenderSubject.next(),this.controlRenderer.clear(),this.controlRenderer.render(this.controlScene,this.camera),this.afterControlRenderSubject.next()}}var Wx=i._1({encapsulation:0,styles:[["stage-3d[_ngcontent-%COMP%]{width:100%;height:100%}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}"]],data:{}});function Xx(t){return i._21(0,[i._18(402653184,1,{worldCanvasRef:0}),i._18(402653184,2,{controlCanvasRef:0}),(t()(),i._3(2,0,[[1,0],["worldCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n"])),(t()(),i._3(4,0,[[2,0],["controlCanvas",1]],null,0,"canvas",[["class","full-screen"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n"]))],null,null)}var qx=r("UEsV"),Yx=r("hfO1"),Zx=r("s+UU");class Jx extends pe.b{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(t){return this.hasError?(t.error(this.thrownError),Zx.a.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Zx.a.EMPTY):super._subscribe(t)}next(t){this.hasCompleted||(this.value=t,this.hasNext=!0)}error(t){this.hasCompleted||super.error(t)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}class Qx extends E.a{constructor(t,e,r,n,i){super(),this.callbackFunc=t,this.selector=e,this.args=r,this.context=n,this.scheduler=i}static create(t,e,r){return function(...n){return new Qx(t,e,n,this,r)}}_subscribe(t){const e=this.callbackFunc,r=this.args,n=this.scheduler;let i=this.subject;if(n)return n.schedule(Qx.dispatch,0,{source:this,subscriber:t,context:this.context});if(!i){i=this.subject=new Jx;const t=function t(...e){const r=t.source,{selector:n,subject:i}=r;if(n){const t=Object(qx.a)(n).apply(this,e);t===Yx.a?i.error(Yx.a.e):(i.next(t),i.complete())}else i.next(e.length<=1?e[0]:e),i.complete()};t.source=this,Object(qx.a)(e).apply(this.context,r.concat(t))===Yx.a&&i.error(Yx.a.e)}return i.subscribe(t)}static dispatch(t){const e=this,{source:r,subscriber:n,context:i}=t,{callbackFunc:o,args:s,scheduler:a}=r;let l=r.subject;if(!l){l=r.subject=new Jx;const t=function t(...r){const n=t.source,{selector:i,subject:o}=n;if(i){const t=Object(qx.a)(i).apply(this,r);e.add(t===Yx.a?a.schedule($x,0,{err:Yx.a.e,subject:o}):a.schedule(Kx,0,{value:t,subject:o}))}else e.add(a.schedule(Kx,0,{value:r.length<=1?r[0]:r,subject:o}))};t.source=r,Object(qx.a)(o).apply(i,s.concat(t))===Yx.a&&l.error(Yx.a.e)}e.add(l.subscribe(n))}}function Kx(t){const{value:e,subject:r}=t;r.next(e),r.complete()}function $x(t){const{err:e,subject:r}=t;r.error(e)}E.a.bindCallback=Qx.create;class tb extends E.a{constructor(t,e,r,n,i){super(),this.callbackFunc=t,this.selector=e,this.args=r,this.context=n,this.scheduler=i}static create(t,e,r){return function(...n){return new tb(t,e,n,this,r)}}_subscribe(t){const e=this.callbackFunc,r=this.args,n=this.scheduler;let i=this.subject;if(n)return n.schedule(eb,0,{source:this,subscriber:t,context:this.context});if(!i){i=this.subject=new Jx;const t=function t(...e){const r=t.source,{selector:n,subject:i}=r,o=e.shift();if(o)i.error(o);else if(n){const t=Object(qx.a)(n).apply(this,e);t===Yx.a?i.error(Yx.a.e):(i.next(t),i.complete())}else i.next(e.length<=1?e[0]:e),i.complete()};t.source=this,Object(qx.a)(e).apply(this.context,r.concat(t))===Yx.a&&i.error(Yx.a.e)}return i.subscribe(t)}}function eb(t){const e=this,{source:r,subscriber:n,context:i}=t,{callbackFunc:o,args:s,scheduler:a}=r;let l=r.subject;if(!l){l=r.subject=new Jx;const t=function t(...r){const n=t.source,{selector:i,subject:o}=n,s=r.shift();if(s)e.add(a.schedule(nb,0,{err:s,subject:o}));else if(i){const t=Object(qx.a)(i).apply(this,r);e.add(t===Yx.a?a.schedule(nb,0,{err:Yx.a.e,subject:o}):a.schedule(rb,0,{value:t,subject:o}))}else e.add(a.schedule(rb,0,{value:r.length<=1?r[0]:r,subject:o}))};t.source=r,Object(qx.a)(o).apply(i,s.concat(t))===Yx.a&&e.add(a.schedule(nb,0,{err:Yx.a.e,subject:l}))}e.add(l.subscribe(n))}function rb(t){const{value:e,subject:r}=t;r.next(e),r.complete()}function nb(t){const{err:e,subject:r}=t;r.error(e)}E.a.bindNodeCallback=tb.create;var ib=r("f2Ls");const ob={};function sb(...t){let e=null;return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(ge.a)(t[0])&&(t=t[0].slice()),r=>r.lift.call(new P.a([r,...t]),new ab(e))}class ab{constructor(t){this.project=t}call(t,e){return e.subscribe(new lb(t,this.project))}}class lb extends ae.a{constructor(t,e){super(t),this.project=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(ob),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let r=0;r<e;r++){const e=t[r];this.add(Object(le.a)(this,e,e,r))}}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,r,n,i){const o=this.values,s=this.toRespond?o[r]===ob?--this.toRespond:this.toRespond:0;o[r]=e,0===s&&(this.project?this._tryProject(o):this.destination.next(o.slice()))}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}function cb(...t){return 1===t.length||2===t.length&&Object(ib.a)(t[1])?je(t[0]):Ve()(O(...t))}E.a.combineLatest=function(...t){let e=null,r=null;return Object(ib.a)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(ge.a)(t[0])&&(t=t[0]),new P.a(t,r).lift(new ab(e))},E.a.concat=cb;class ub extends E.a{constructor(t){super(),this.observableFactory=t}static create(t){return new ub(t)}_subscribe(t){return new hb(t,this.observableFactory)}}class hb extends ae.a{constructor(t,e){super(t),this.factory=e,this.tryDefer()}tryDefer(){try{this._callFactory()}catch(t){this._error(t)}}_callFactory(){const t=this.factory();t&&this.add(Object(le.a)(this,t))}}E.a.defer=ub.create,E.a.empty=Ne.a.create;class db extends E.a{constructor(t,e){super(),this.sources=t,this.resultSelector=e}static create(...t){if(null===t||0===arguments.length)return new Ne.a;let e=null;return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(ge.a)(t[0])&&(t=t[0]),0===t.length?new Ne.a:new db(t,e)}_subscribe(t){return new pb(t,this.sources,this.resultSelector)}}class pb extends ae.a{constructor(t,e,r){super(t),this.sources=e,this.resultSelector=r,this.completed=0,this.haveValues=0;const n=e.length;this.total=n,this.values=new Array(n);for(let i=0;i<n;i++){const t=e[i],r=Object(le.a)(this,t,null,i);r&&(r.outerIndex=i,this.add(r))}}notifyNext(t,e,r,n,i){this.values[r]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)}notifyComplete(t){const e=this.destination,{haveValues:r,resultSelector:n,values:i}=this,o=i.length;if(t._hasValue){if(this.completed++,this.completed===o){if(r===o){const t=n?n.apply(this,i):i;e.next(t)}e.complete()}}else e.complete()}}const fb=db.create;E.a.forkJoin=fb,E.a.from=je;var mb=r("WFWZ");const vb=Object.prototype.toString;class gb extends E.a{constructor(t,e,r,n){super(),this.sourceObj=t,this.eventName=e,this.selector=r,this.options=n}static create(t,e,r,n){return Object(mb.a)(r)&&(n=r,r=void 0),new gb(t,e,n,r)}static setupSubscription(t,e,r,n,i){let o;if(function(t){return!!t&&"[object NodeList]"===vb.call(t)}(t)||function(t){return!!t&&"[object HTMLCollection]"===vb.call(t)}(t))for(let s=0,a=t.length;s<a;s++)gb.setupSubscription(t[s],e,r,n,i);else if(function(t){return!!t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const n=t;t.addEventListener(e,r,i),o=(()=>n.removeEventListener(e,r,i))}else if(function(t){return!!t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const n=t;t.on(e,r),o=(()=>n.off(e,r))}else{if(!function(t){return!!t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t))throw new TypeError("Invalid event target");{const n=t;t.addListener(e,r),o=(()=>n.removeListener(e,r))}}n.add(new Zx.a(o))}_subscribe(t){const e=this.selector;gb.setupSubscription(this.sourceObj,this.eventName,e?(...r)=>{let n=Object(qx.a)(e)(...r);n===Yx.a?t.error(Yx.a.e):t.next(n)}:e=>t.next(e),t,this.options)}}E.a.fromEvent=gb.create;class yb extends E.a{constructor(t,e,r){super(),this.addHandler=t,this.removeHandler=e,this.selector=r}static create(t,e,r){return new yb(t,e,r)}_subscribe(t){const e=this.removeHandler,r=this.selector?(...e)=>{this._callSelector(t,e)}:function(e){t.next(e)},n=this._callAddHandler(r,t);Object(mb.a)(e)&&t.add(new Zx.a(()=>{e(r,n)}))}_callSelector(t,e){try{const r=this.selector(...e);t.next(r)}catch(e){t.error(e)}}_callAddHandler(t,e){try{return this.addHandler(t)||null}catch(t){e.error(t)}}}E.a.fromEventPattern=yb.create,E.a.fromPromise=Ze;const xb=t=>t;class bb extends E.a{constructor(t,e,r,n,i){super(),this.initialState=t,this.condition=e,this.iterate=r,this.resultSelector=n,this.scheduler=i}static create(t,e,r,n,i){return 1==arguments.length?new bb(t.initialState,t.condition,t.iterate,t.resultSelector||xb,t.scheduler):void 0===n||Object(ib.a)(n)?new bb(t,e,r,xb,n):new bb(t,e,r,n,i)}_subscribe(t){let e=this.initialState;if(this.scheduler)return this.scheduler.schedule(bb.dispatch,0,{subscriber:t,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:e});const{condition:r,resultSelector:n,iterate:i}=this;for(;;){if(r){let n;try{n=r(e)}catch(e){return void t.error(e)}if(!n){t.complete();break}}let o;try{o=n(e)}catch(e){return void t.error(e)}if(t.next(o),t.closed)break;try{e=i(e)}catch(e){return void t.error(e)}}}static dispatch(t){const{subscriber:e,condition:r}=t;if(e.closed)return;if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(r){let n;try{n=r(t.state)}catch(t){return void e.error(t)}if(!n)return void e.complete();if(e.closed)return}let n;try{n=t.resultSelector(t.state)}catch(t){return void e.error(t)}return e.closed||(e.next(n),e.closed)?void 0:this.schedule(t)}}E.a.generate=bb.create;class wb extends E.a{constructor(t,e,r){super(),this.condition=t,this.thenSource=e,this.elseSource=r}static create(t,e,r){return new wb(t,e,r)}_subscribe(t){const{condition:e,thenSource:r,elseSource:n}=this;return new _b(t,e,r,n)}}class _b extends ae.a{constructor(t,e,r,n){super(t),this.condition=e,this.thenSource=r,this.elseSource=n,this.tryIf()}tryIf(){const{condition:t,thenSource:e,elseSource:r}=this;let n;try{const i=(n=t())?e:r;i?this.add(Object(le.a)(this,i)):this._complete()}catch(t){this._error(t)}}}function Sb(t){return!Object(ge.a)(t)&&t-parseFloat(t)+1>=0}E.a.if=wb.create;class Tb extends Zx.a{constructor(t,e){super()}schedule(t,e=0){return this}}class Mb extends Tb{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t,this.pending=!0;const r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,r=0){return be.a.setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,e,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return e;be.a.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r=!1,n=void 0;try{this.work(t)}catch(t){r=!0,n=!!t&&t||new Error(t)}if(r)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}class Ab{constructor(t,e=Ab.now){this.SchedulerAction=t,this.now=e}schedule(t,e=0,r){return new this.SchedulerAction(this,t).schedule(r,e)}}Ab.now=Date.now?Date.now:()=>+new Date;class Eb extends Ab{constructor(){super(...arguments),this.actions=[],this.active=!1,this.scheduled=void 0}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}}const Cb=new Eb(Mb);class Pb extends E.a{constructor(t=0,e=Cb){super(),this.period=t,this.scheduler=e,(!Sb(t)||t<0)&&(this.period=0),e&&"function"==typeof e.schedule||(this.scheduler=Cb)}static create(t=0,e=Cb){return new Pb(t,e)}static dispatch(t){const{index:e,subscriber:r,period:n}=t;r.next(e),r.closed||(t.index+=1,this.schedule(t,n))}_subscribe(t){const e=this.period;t.add(this.scheduler.schedule(Pb.dispatch,e,{index:0,subscriber:t,period:e}))}}E.a.interval=Pb.create;var Ob=r("Qi5R");function Nb(...t){if(1===t.length){if(!Object(ge.a)(t[0]))return t[0];t=t[0]}return new P.a(t).lift(new Lb)}E.a.merge=Ob.a;class Lb{call(t,e){return e.subscribe(new Ib(t))}}class Ib extends ae.a{constructor(t){super(t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(t){this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(let r=0;r<e&&!this.hasFirst;r++){let e=t[r],n=Object(le.a)(this,e,e,r);this.subscriptions&&this.subscriptions.push(n),this.add(n)}this.observables=null}}notifyNext(t,e,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(let t=0;t<this.subscriptions.length;t++)if(t!==r){let e=this.subscriptions[t];e.unsubscribe(),this.remove(e)}this.subscriptions=null}this.destination.next(e)}}E.a.race=Nb;var Rb=r("Niek");class Db extends E.a{constructor(){super()}static create(){return new Db}_subscribe(t){Object(Rb.a)()}}function Fb(...t){return 1===t.length&&Object(ge.a)(t[0])&&(t=t[0]),e=>e.lift(new kb(t))}E.a.never=Db.create,E.a.of=O;class kb{constructor(t){this.nextSources=t}call(t,e){return e.subscribe(new Ub(t,this.nextSources))}}class Ub extends ae.a{constructor(t,e){super(t),this.destination=t,this.nextSources=e}notifyError(t,e){this.subscribeToNextSource()}notifyComplete(t){this.subscribeToNextSource()}_error(t){this.subscribeToNextSource()}_complete(){this.subscribeToNextSource()}subscribeToNextSource(){const t=this.nextSources.shift();t?this.add(Object(le.a)(this,t)):this.destination.complete()}}function Bb(t){const{obj:e,keys:r,length:n,index:i,subscriber:o}=t;if(i===n)return void o.complete();const s=r[i];o.next([s,e[s]]),t.index=i+1,this.schedule(t)}E.a.onErrorResumeNext=function(...t){let e=null;return 1===t.length&&Object(ge.a)(t[0])&&(t=t[0]),e=t.shift(),new Be(e,null).lift(new kb(t))};class jb extends E.a{constructor(t,e){super(),this.obj=t,this.scheduler=e,this.keys=Object.keys(t)}static create(t,e){return new jb(t,e)}_subscribe(t){const{keys:e,scheduler:r}=this,n=e.length;if(r)return r.schedule(Bb,0,{obj:this.obj,keys:e,length:n,index:0,subscriber:t});for(let i=0;i<n;i++){const r=e[i];t.next([r,this.obj[r]])}t.complete()}}E.a.pairs=jb.create;class zb extends E.a{constructor(t,e,r){super(),this.start=t,this._count=e,this.scheduler=r}static create(t=0,e=0,r){return new zb(t,e,r)}static dispatch(t){const{start:e,index:r,count:n,subscriber:i}=t;r>=n?i.complete():(i.next(e),i.closed||(t.index=r+1,t.start=e+1,this.schedule(t)))}_subscribe(t){let e=0,r=this.start;const n=this._count,i=this.scheduler;if(i)return i.schedule(zb.dispatch,0,{index:e,count:n,start:r,subscriber:t});for(;;){if(e++>=n){t.complete();break}if(t.next(r++),t.closed)break}}}E.a.range=zb.create;class Vb extends E.a{constructor(t,e){super(),this.resourceFactory=t,this.observableFactory=e}static create(t,e){return new Vb(t,e)}_subscribe(t){const{resourceFactory:e,observableFactory:r}=this;let n;try{return n=e(),new Gb(t,n,r)}catch(e){t.error(e)}}}class Gb extends ae.a{constructor(t,e,r){super(t),this.resource=e,this.observableFactory=r,t.add(e),this.tryUse()}tryUse(){try{const t=this.observableFactory.call(this,this.resource);t&&this.add(Object(le.a)(this,t))}catch(t){this._error(t)}}}E.a.using=Vb.create;class Hb extends E.a{constructor(t,e){super(),this.error=t,this.scheduler=e}static create(t,e){return new Hb(t,e)}static dispatch(t){const{error:e,subscriber:r}=t;r.error(e)}_subscribe(t){const e=this.error,r=this.scheduler;if(t.syncErrorThrowable=!0,r)return r.schedule(Hb.dispatch,0,{error:e,subscriber:t});t.error(e)}}function Wb(t){return t instanceof Date&&!isNaN(+t)}E.a.throw=Hb.create;class Xb extends E.a{constructor(t=0,e,r){super(),this.period=-1,this.dueTime=0,Sb(e)?this.period=Number(e)<1?1:Number(e):Object(ib.a)(e)&&(r=e),Object(ib.a)(r)||(r=Cb),this.scheduler=r,this.dueTime=Wb(t)?+t-this.scheduler.now():t}static create(t=0,e,r){return new Xb(t,e,r)}static dispatch(t){const{index:e,period:r,subscriber:n}=t;if(n.next(e),!n.closed){if(-1===r)return n.complete();t.index=e+1,this.schedule(t,r)}}_subscribe(t){const{period:e,dueTime:r,scheduler:n}=this;return n.schedule(Xb.dispatch,r,{index:0,period:e,subscriber:t})}}const qb=Xb.create;function Yb(...t){return function(e){return e.lift.call(Zb(e,...t))}}function Zb(...t){const e=t[t.length-1];return"function"==typeof e&&t.pop(),new P.a(t).lift(new Jb(e))}E.a.timer=qb;class Jb{constructor(t){this.project=t}call(t,e){return e.subscribe(new Qb(t,this.project))}}class Qb extends R.a{constructor(t,e,r=Object.create(null)){super(t),this.iterators=[],this.active=0,this.project="function"==typeof e?e:null,this.values=r}_next(t){const e=this.iterators;Object(ge.a)(t)?e.push(new $b(t)):e.push("function"==typeof t[Te.a]?new Kb(t[Te.a]()):new tw(this.destination,this,t))}_complete(){const t=this.iterators,e=t.length;if(0!==e){this.active=e;for(let r=0;r<e;r++){let e=t[r];e.stillUnsubscribed?this.add(e.subscribe(e,r)):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const t=this.iterators,e=t.length,r=this.destination;for(let o=0;o<e;o++){let e=t[o];if("function"==typeof e.hasValue&&!e.hasValue())return}let n=!1;const i=[];for(let o=0;o<e;o++){let e=t[o],s=e.next();if(e.hasCompleted()&&(n=!0),s.done)return void r.complete();i.push(s.value)}this.project?this._tryProject(i):r.next(i),n&&r.complete()}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}class Kb{constructor(t){this.iterator=t,this.nextResult=t.next()}hasValue(){return!0}next(){const t=this.nextResult;return this.nextResult=this.iterator.next(),t}hasCompleted(){const t=this.nextResult;return t&&t.done}}class $b{constructor(t){this.array=t,this.index=0,this.length=0,this.length=t.length}[Te.a](){return this}next(t){const e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class tw extends ae.a{constructor(t,e,r){super(t),this.parent=e,this.observable=r,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[Te.a](){return this}next(){const t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(t,e,r,n,i){this.buffer.push(e),this.parent.checkIterators()}subscribe(t,e){return Object(le.a)(this,this.observable,this,e)}}function ew(t,e=null){return new lw({method:"GET",url:t,headers:e})}function rw(t,e,r){return new lw({method:"POST",url:t,body:e,headers:r})}function nw(t,e){return new lw({method:"DELETE",url:t,headers:e})}function iw(t,e,r){return new lw({method:"PUT",url:t,body:e,headers:r})}function ow(t,e,r){return new lw({method:"PATCH",url:t,body:e,headers:r})}E.a.zip=Zb;const sw=B((t,e)=>t.response);function aw(t,e){return sw(new lw({method:"GET",url:t,responseType:"json",headers:e}))}class lw extends E.a{constructor(t){super();const e={async:!0,createXHR:function(){return this.crossDomain?(function(){if(be.a.XMLHttpRequest)return new be.a.XMLHttpRequest;if(be.a.XDomainRequest)return new be.a.XDomainRequest;throw new Error("CORS is not supported by your browser")}).call(this):function(){if(be.a.XMLHttpRequest)return new be.a.XMLHttpRequest;{let t;try{const e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(let r=0;r<3;r++)try{if(new be.a.ActiveXObject(t=e[r]))break}catch(t){}return new be.a.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}}()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)e.url=t;else for(const r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);this.request=e}_subscribe(t){return new cw(t,this.request)}}lw.create=(()=>{const t=t=>new lw(t);return t.get=ew,t.post=rw,t.delete=nw,t.put=iw,t.patch=ow,t.getJSON=aw,t})();class cw extends R.a{constructor(t,e){super(t),this.request=e,this.done=!1;const r=e.headers=e.headers||{};e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||be.a.FormData&&e.body instanceof be.a.FormData||"undefined"==typeof e.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),e.body=this.serializeBody(e.body,e.headers["Content-Type"]),this.send()}next(t){this.done=!0;const{xhr:e,request:r,destination:n}=this,i=new uw(t,e,r);n.next(i)}send(){const{request:t,request:{user:e,method:r,url:n,async:i,password:o,headers:s,body:a}}=this,l=t.createXHR,c=Object(qx.a)(l).call(t);if(c===Yx.a)this.error(Yx.a.e);else{let l;if(this.xhr=c,this.setupEvents(c,t),(l=e?Object(qx.a)(c.open).call(c,r,n,i,e,o):Object(qx.a)(c.open).call(c,r,n,i))===Yx.a)return this.error(Yx.a.e),null;if(i&&(c.timeout=t.timeout,c.responseType=t.responseType),"withCredentials"in c&&(c.withCredentials=!!t.withCredentials),this.setHeaders(c,s),(l=a?Object(qx.a)(c.send).call(c,a):Object(qx.a)(c.send).call(c))===Yx.a)return this.error(Yx.a.e),null}return c}serializeBody(t,e){if(!t||"string"==typeof t)return t;if(be.a.FormData&&t instanceof be.a.FormData)return t;if(e){const t=e.indexOf(";");-1!==t&&(e=e.substring(0,t))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map(e=>`${encodeURI(e)}=${encodeURI(t[e])}`).join("&");case"application/json":return JSON.stringify(t);default:return t}}setHeaders(t,e){for(let r in e)e.hasOwnProperty(r)&&t.setRequestHeader(r,e[r])}setupEvents(t,e){const r=e.progressSubscriber;function n(t){const{subscriber:e,progressSubscriber:r,request:i}=n;r&&r.error(t),e.error(new pw(this,i))}if(t.ontimeout=n,n.request=e,n.subscriber=this,n.progressSubscriber=r,t.upload&&"withCredentials"in t){if(r){let e;e=function(t){const{progressSubscriber:r}=e;r.next(t)},be.a.XDomainRequest?t.onprogress=e:t.upload.onprogress=e,e.progressSubscriber=r}let n;t.onerror=n=function(t){const{progressSubscriber:e,subscriber:r,request:i}=n;e&&e.error(t),r.error(new hw("ajax error",this,i))},n.request=e,n.subscriber=this,n.progressSubscriber=r}function i(t){const{subscriber:e,progressSubscriber:r,request:n}=i;if(4===this.readyState){let i=1223===this.status?204:this.status;0===i&&(i=("text"===this.responseType?this.response||this.responseText:this.response)?200:0),200<=i&&i<300?(r&&r.complete(),e.next(t),e.complete()):(r&&r.error(t),e.error(new hw("ajax error "+i,this,n)))}}t.onreadystatechange=i,i.subscriber=this,i.progressSubscriber=r,i.request=e}unsubscribe(){const{done:t,xhr:e}=this;!t&&e&&4!==e.readyState&&"function"==typeof e.abort&&e.abort(),super.unsubscribe()}}class uw{constructor(t,e,r){this.originalEvent=t,this.xhr=e,this.request=r,this.status=e.status,this.responseType=e.responseType||r.responseType,this.response=dw(this.responseType,e)}}class hw extends Error{constructor(t,e,r){super(t),this.message=t,this.xhr=e,this.request=r,this.status=e.status,this.responseType=e.responseType||r.responseType,this.response=dw(this.responseType,e)}}function dw(t,e){switch(t){case"json":return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null");case"xml":return e.responseXML;case"text":default:return"response"in e?e.response:e.responseText}}class pw extends hw{constructor(t,e){super("ajax timeout",t,e)}}E.a.ajax=lw.create;const fw=new class extends Eb{}(class extends Mb{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(t,e,r):t.flush(this)}});var mw=r("Exya");class vw extends pe.b{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e}next(t){const e=this._getNow();this._events.push(new gw(e,t)),this._trimBufferThenGetEvents(),super.next(t)}_subscribe(t){const e=this._trimBufferThenGetEvents(),r=this.scheduler;let n;if(this.closed)throw new fe.a;this.hasError?n=Zx.a.EMPTY:this.isStopped?n=Zx.a.EMPTY:(this.observers.push(t),n=new mw.a(this,t)),r&&t.add(t=new Fe(t,r));const i=e.length;for(let o=0;o<i&&!t.closed;o++)t.next(e[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),n}_getNow(){return(this.scheduler||fw).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,r=this._windowTime,n=this._events;let i=n.length,o=0;for(;o<i&&!(t-n[o].time<r);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&n.splice(0,o),n}}class gw{constructor(t,e){this.time=t,this.value=e}}const yw=be.a.Object.assign||function(t,...e){const r=e.length;for(let n=0;n<r;n++){const r=e[n];for(let e in r)r.hasOwnProperty(e)&&(t[e]=r[e])}return t};class xw extends pe.a{constructor(t,e){if(t instanceof E.a)super(e,t);else{if(super(),this.WebSocketCtor=be.a.WebSocket,this._output=new pe.b,"string"==typeof t?this.url=t:yw(this,t),!this.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new vw}}resultSelector(t){return JSON.parse(t.data)}static create(t){return new xw(t)}lift(t){const e=new xw(this,this.destination);return e.operator=t,e}_resetState(){this.socket=null,this.source||(this.destination=new vw),this._output=new pe.b}multiplex(t,e,r){const n=this;return new E.a(i=>{const o=Object(qx.a)(t)();o===Yx.a?i.error(Yx.a.e):n.next(o);let s=n.subscribe(t=>{const e=Object(qx.a)(r)(t);e===Yx.a?i.error(Yx.a.e):e&&i.next(t)},t=>i.error(t),()=>i.complete());return()=>{const t=Object(qx.a)(e)();t===Yx.a?i.error(Yx.a.e):n.next(t),s.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:t}=this,e=this._output;let r=null;try{r=this.protocol?new t(this.url,this.protocol):new t(this.url),this.socket=r,this.binaryType&&(this.socket.binaryType=this.binaryType)}catch(t){return void e.error(t)}const n=new Zx.a(()=>{this.socket=null,r&&1===r.readyState&&r.close()});r.onopen=(t=>{const i=this.openObserver;i&&i.next(t);const o=this.destination;this.destination=R.a.create(t=>1===r.readyState&&r.send(t),t=>{const n=this.closingObserver;n&&n.next(void 0),t&&t.code?r.close(t.code,t.reason):e.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const t=this.closingObserver;t&&t.next(void 0),r.close(),this._resetState()}),o&&o instanceof vw&&n.add(o.subscribe(this.destination))}),r.onerror=(t=>{this._resetState(),e.error(t)}),r.onclose=(t=>{this._resetState();const r=this.closeObserver;r&&r.next(t),t.wasClean?e.complete():e.error(t)}),r.onmessage=(t=>{const r=Object(qx.a)(this.resultSelector)(t);r===Yx.a?e.error(Yx.a.e):e.next(r)})}_subscribe(t){const{source:e}=this;if(e)return e.subscribe(t);this.socket||this._connectSocket();let r=new Zx.a;return r.add(this._output.subscribe(t)),r.add(()=>{const{socket:t}=this;0===this._output.observers.length&&(t&&1===t.readyState&&t.close(),this._resetState())}),r}unsubscribe(){const{source:t,socket:e}=this;e&&1===e.readyState&&(e.close(),this._resetState()),super.unsubscribe(),t||(this.destination=new vw)}}function bw(t){return function(e){return e.lift(new ww(t))}}E.a.webSocket=xw.create;class ww{constructor(t){this.closingNotifier=t}call(t,e){return e.subscribe(new _w(t,this.closingNotifier))}}class _w extends ae.a{constructor(t,e){super(t),this.buffer=[],this.add(Object(le.a)(this,e))}_next(t){this.buffer.push(t)}notifyNext(t,e,r,n,i){const o=this.buffer;this.buffer=[],this.destination.next(o)}}function Sw(t,e=null){return function(r){return r.lift(new Tw(t,e))}}E.a.prototype.buffer=function(t){return bw(t)(this)};class Tw{constructor(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?Aw:Mw}call(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))}}class Mw extends R.a{constructor(t,e){super(t),this.bufferSize=e,this.buffer=[]}_next(t){const e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])}_complete(){const t=this.buffer;t.length>0&&this.destination.next(t),super._complete()}}class Aw extends R.a{constructor(t,e,r){super(t),this.bufferSize=e,this.startBufferEvery=r,this.buffers=[],this.count=0}_next(t){const{bufferSize:e,startBufferEvery:r,buffers:n,count:i}=this;this.count++,i%r==0&&n.push([]);for(let o=n.length;o--;){const r=n[o];r.push(t),r.length===e&&(n.splice(o,1),this.destination.next(r))}}_complete(){const{buffers:t,destination:e}=this;for(;t.length>0;){let r=t.shift();r.length>0&&e.next(r)}super._complete()}}function Ew(t){let e=arguments.length,r=Cb;Object(ib.a)(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new Cw(t,n,i,r))}}E.a.prototype.bufferCount=function(t,e=null){return Sw(t,e)(this)};class Cw{constructor(t,e,r,n){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=r,this.scheduler=n}call(t,e){return e.subscribe(new Ow(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))}}class Pw{constructor(){this.buffer=[]}}class Ow extends R.a{constructor(t,e,r,n,i){super(t),this.bufferTimeSpan=e,this.bufferCreationInterval=r,this.maxBufferSize=n,this.scheduler=i,this.contexts=[];const o=this.openContext();if(this.timespanOnly=null==r||r<0,this.timespanOnly)this.add(o.closeAction=i.schedule(Nw,e,{subscriber:this,context:o,bufferTimeSpan:e}));else{const t={bufferTimeSpan:e,bufferCreationInterval:r,subscriber:this,scheduler:i};this.add(o.closeAction=i.schedule(Iw,e,{subscriber:this,context:o})),this.add(i.schedule(Lw,r,t))}}_next(t){const e=this.contexts,r=e.length;let n;for(let i=0;i<r;i++){const r=e[i],o=r.buffer;o.push(t),o.length==this.maxBufferSize&&(n=r)}n&&this.onBufferFull(n)}_error(t){this.contexts.length=0,super._error(t)}_complete(){const{contexts:t,destination:e}=this;for(;t.length>0;){const r=t.shift();e.next(r.buffer)}super._complete()}_unsubscribe(){this.contexts=null}onBufferFull(t){this.closeContext(t);const e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();const e=this.bufferTimeSpan;this.add(t.closeAction=this.scheduler.schedule(Nw,e,{subscriber:this,context:t,bufferTimeSpan:e}))}}openContext(){const t=new Pw;return this.contexts.push(t),t}closeContext(t){this.destination.next(t.buffer);const e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)}}function Nw(t){const e=t.subscriber,r=t.context;r&&e.closeContext(r),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function Lw(t){const{bufferCreationInterval:e,bufferTimeSpan:r,subscriber:n,scheduler:i}=t,o=n.openContext();n.closed||(n.add(o.closeAction=i.schedule(Iw,r,{subscriber:n,context:o})),this.schedule(t,e))}function Iw(t){const{subscriber:e,context:r}=t;e.closeContext(r)}function Rw(t,e){return function(r){return r.lift(new Dw(t,e))}}E.a.prototype.bufferTime=function(t){let e=arguments.length,r=Cb;Object(ib.a)(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),Ew(t,n,i,r)(this)};class Dw{constructor(t,e){this.openings=t,this.closingSelector=e}call(t,e){return e.subscribe(new Fw(t,this.openings,this.closingSelector))}}class Fw extends ae.a{constructor(t,e,r){super(t),this.openings=e,this.closingSelector=r,this.contexts=[],this.add(Object(le.a)(this,e))}_next(t){const e=this.contexts,r=e.length;for(let n=0;n<r;n++)e[n].buffer.push(t)}_error(t){const e=this.contexts;for(;e.length>0;){const t=e.shift();t.subscription.unsubscribe(),t.buffer=null,t.subscription=null}this.contexts=null,super._error(t)}_complete(){const t=this.contexts;for(;t.length>0;){const e=t.shift();this.destination.next(e.buffer),e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,super._complete()}notifyNext(t,e,r,n,i){t?this.closeBuffer(t):this.openBuffer(e)}notifyComplete(t){this.closeBuffer(t.context)}openBuffer(t){try{const e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}}closeBuffer(t){const e=this.contexts;if(e&&t){const{buffer:r,subscription:n}=t;this.destination.next(r),e.splice(e.indexOf(t),1),this.remove(n),n.unsubscribe()}}trySubscribe(t){const e=this.contexts,r=new Zx.a,n={buffer:[],subscription:r};e.push(n);const i=Object(le.a)(this,t,n);!i||i.closed?this.closeBuffer(n):(i.context=n,this.add(i),r.add(i))}}function kw(t){return function(e){return e.lift(new Uw(t))}}E.a.prototype.bufferToggle=function(t,e){return Rw(t,e)(this)};class Uw{constructor(t){this.closingSelector=t}call(t,e){return e.subscribe(new Bw(t,this.closingSelector))}}class Bw extends ae.a{constructor(t,e){super(t),this.closingSelector=e,this.subscribing=!1,this.openBuffer()}_next(t){this.buffer.push(t)}_complete(){const t=this.buffer;t&&this.destination.next(t),super._complete()}_unsubscribe(){this.buffer=null,this.subscribing=!1}notifyNext(t,e,r,n,i){this.openBuffer()}notifyComplete(){this.subscribing?this.complete():this.openBuffer()}openBuffer(){let{closingSubscription:t}=this;t&&(this.remove(t),t.unsubscribe()),this.buffer&&this.destination.next(this.buffer),this.buffer=[];const e=Object(qx.a)(this.closingSelector)();e===Yx.a?this.error(Yx.a.e):(t=new Zx.a,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(Object(le.a)(this,e)),this.subscribing=!1)}}function jw(t){return e=>e.lift(new ab(t))}function zw(...t){return e=>e.lift.call(cb(e,...t))}function Vw(t,e){return L(()=>t,e)}function Gw(t){return e=>e.lift(new Hw(t,e))}E.a.prototype.bufferWhen=function(t){return kw(t)(this)},E.a.prototype.combineAll=function(t){return jw(t)(this)},E.a.prototype.combineLatest=function(...t){return sb(...t)(this)},E.a.prototype.concat=function(...t){return zw(...t)(this)},E.a.prototype.concatAll=Ge,E.a.prototype.concatMap=I,E.a.prototype.concatMapTo=function(t,e){return Vw(t,e)(this)};class Hw{constructor(t,e){this.predicate=t,this.source=e}call(t,e){return e.subscribe(new Ww(t,this.predicate,this.source))}}class Ww extends R.a{constructor(t,e,r){super(t),this.predicate=e,this.source=r,this.count=0,this.index=0}_next(t){this.predicate?this._tryPredicate(t):this.count++}_tryPredicate(t){let e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++}_complete(){this.destination.next(this.count),this.destination.complete()}}function Xw(){return function(t){return t.lift(new qw)}}E.a.prototype.count=function(t){return Gw(t)(this)};class qw{call(t,e){return e.subscribe(new Yw(t))}}class Yw extends R.a{constructor(t){super(t)}_next(t){t.observe(this.destination)}}function Zw(t){return e=>e.lift(new Jw(t))}E.a.prototype.dematerialize=function(){return Xw()(this)};class Jw{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new Qw(t,this.durationSelector))}}class Qw extends ae.a{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1,this.durationSubscription=null}_next(t){try{const e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(t,e){let r=this.durationSubscription;this.value=t,this.hasValue=!0,r&&(r.unsubscribe(),this.remove(r)),(r=Object(le.a)(this,e)).closed||this.add(this.durationSubscription=r)}notifyNext(t,e,r,n,i){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const t=this.value,e=this.durationSubscription;e&&(this.durationSubscription=null,e.unsubscribe(),this.remove(e)),this.value=null,this.hasValue=!1,super._next(t)}}}function Kw(t,e=Cb){return r=>r.lift(new $w(t,e))}E.a.prototype.debounce=function(t){return Zw(t)(this)};class $w{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new t_(t,this.dueTime,this.scheduler))}}class t_ extends R.a{constructor(t,e,r){super(t),this.dueTime=e,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(e_,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){this.clearDebounce(),this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function e_(t){t.debouncedNext()}function r_(t,e=Cb){const r=Wb(t)?+t-e.now():Math.abs(t);return t=>t.lift(new n_(r,e))}E.a.prototype.debounceTime=function(t,e=Cb){return Kw(t,e)(this)},E.a.prototype.defaultIfEmpty=function(t=null){return dr(t)(this)};class n_{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new i_(t,this.delay,this.scheduler))}}class i_ extends R.a{constructor(t,e,r){super(t),this.delay=e,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,r=e.queue,n=t.scheduler,i=t.destination;for(;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){const e=Math.max(0,r[0].time-n.now());this.schedule(t,e)}else e.active=!1}_schedule(t){this.active=!0,this.add(t.schedule(i_.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,r=new o_(e.now()+this.delay,t);this.queue.push(r),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(Ie.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t)}_complete(){this.scheduleNotification(Ie.createComplete())}}class o_{constructor(t,e){this.time=t,this.notification=e}}function s_(t,e){return e?r=>new c_(r,e).lift(new a_(t)):e=>e.lift(new a_(t))}E.a.prototype.delay=function(t,e=Cb){return r_(t,e)(this)};class a_{constructor(t){this.delayDurationSelector=t}call(t,e){return e.subscribe(new l_(t,this.delayDurationSelector))}}class l_ extends ae.a{constructor(t,e){super(t),this.delayDurationSelector=e,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}notifyNext(t,e,r,n,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()}notifyError(t,e){this._error(t)}notifyComplete(t){const e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()}_next(t){try{const e=this.delayDurationSelector(t);e&&this.tryDelay(e,t)}catch(t){this.destination.error(t)}}_complete(){this.completed=!0,this.tryComplete()}removeSubscription(t){t.unsubscribe();const e=this.delayNotifierSubscriptions.indexOf(t);let r=null;return-1!==e&&(r=this.values[e],this.delayNotifierSubscriptions.splice(e,1),this.values.splice(e,1)),r}tryDelay(t,e){const r=Object(le.a)(this,t,e);r&&!r.closed&&(this.add(r),this.delayNotifierSubscriptions.push(r)),this.values.push(e)}tryComplete(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()}}class c_ extends E.a{constructor(t,e){super(),this.source=t,this.subscriptionDelay=e}_subscribe(t){this.subscriptionDelay.subscribe(new u_(t,this.source))}}class u_ extends R.a{constructor(t,e){super(),this.parent=t,this.source=e,this.sourceSubscribed=!1}_next(t){this.subscribeToSource()}_error(t){this.unsubscribe(),this.parent.error(t)}_complete(){this.subscribeToSource()}subscribeToSource(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))}}E.a.prototype.delayWhen=function(t,e){return s_(t,e)(this)};const h_=be.a.Set||class{constructor(){this._values=[]}add(t){this.has(t)||this._values.push(t)}has(t){return-1!==this._values.indexOf(t)}get size(){return this._values.length}clear(){this._values.length=0}};function d_(t,e){return r=>r.lift(new p_(t,e))}class p_{constructor(t,e){this.keySelector=t,this.flushes=e}call(t,e){return e.subscribe(new f_(t,this.keySelector,this.flushes))}}class f_ extends ae.a{constructor(t,e,r){super(t),this.keySelector=e,this.values=new h_,r&&this.add(Object(le.a)(this,r))}notifyNext(t,e,r,n,i){this.values.clear()}notifyError(t,e){this._error(t)}_next(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)}_useKeySelector(t){let e;const{destination:r}=this;try{e=this.keySelector(t)}catch(t){return void r.error(t)}this._finalizeNext(e,t)}_finalizeNext(t,e){const{values:r}=this;r.has(t)||(r.add(t),this.destination.next(e))}}function m_(t,e){return r=>r.lift(new v_(t,e))}E.a.prototype.distinct=function(t,e){return d_(t,e)(this)};class v_{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new g_(t,this.compare,this.keySelector))}}class g_ extends R.a{constructor(t,e,r){super(t),this.keySelector=r,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e=t;if(this.keySelector&&(e=Object(qx.a)(this.keySelector)(t))===Yx.a)return this.destination.error(Yx.a.e);let r=!1;if(this.hasKey){if((r=Object(qx.a)(this.compare)(this.key,e))===Yx.a)return this.destination.error(Yx.a.e)}else this.hasKey=!0;!1===Boolean(r)&&(this.key=e,this.destination.next(t))}}function y_(t,e){return m_((r,n)=>e?e(r[t],n[t]):r[t]===n[t])}function x_(t,e,r){return function(n){return n.lift(new b_(t,e,r))}}E.a.prototype.distinctUntilChanged=function(t,e){return m_(t,e)(this)},E.a.prototype.distinctUntilKeyChanged=function(t,e){return y_(t,e)(this)};class b_{constructor(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}call(t,e){return e.subscribe(new w_(t,this.nextOrObserver,this.error,this.complete))}}class w_ extends R.a{constructor(t,e,r,n){super(t);const i=new R.a(e,r,n);i.syncErrorThrowable=!0,this.add(i),this.safeSubscriber=i}_next(t){const{safeSubscriber:e}=this;e.next(t),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.next(t)}_error(t){const{safeSubscriber:e}=this;e.error(t),this.destination.error(e.syncErrorThrown?e.syncErrorValue:t)}_complete(){const{safeSubscriber:t}=this;t.complete(),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.complete()}}function __(t,e,r){return x_(t,e,r)(this)}function S_(){return t=>t.lift(new T_)}E.a.prototype.do=__,E.a.prototype._do=__;class T_{call(t,e){return e.subscribe(new M_(t))}}class M_ extends ae.a{constructor(t){super(t),this.hasCompleted=!1,this.hasSubscription=!1}_next(t){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(le.a)(this,t)))}_complete(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()}notifyComplete(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}function A_(t,e){return r=>r.lift(new E_(t,e))}E.a.prototype.exhaust=function(){return S_()(this)};class E_{constructor(t,e){this.project=t,this.resultSelector=e}call(t,e){return e.subscribe(new C_(t,this.project,this.resultSelector))}}class C_ extends ae.a{constructor(t,e,r){super(t),this.project=e,this.resultSelector=r,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}_next(t){this.hasSubscription||this.tryNext(t)}tryNext(t){const e=this.index++,r=this.destination;try{const n=this.project(t,e);this.hasSubscription=!0,this.add(Object(le.a)(this,n,t,e))}catch(t){r.error(t)}}_complete(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()}notifyNext(t,e,r,n,i){const{resultSelector:o,destination:s}=this;o?this.trySelectResult(t,e,r,n):s.next(e)}trySelectResult(t,e,r,n){const{resultSelector:i,destination:o}=this;try{const s=i(t,e,r,n);o.next(s)}catch(t){o.error(t)}}notifyError(t){this.destination.error(t)}notifyComplete(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}function P_(t,e=Number.POSITIVE_INFINITY,r){return e=(e||0)<1?Number.POSITIVE_INFINITY:e,n=>n.lift(new O_(t,e,r))}E.a.prototype.exhaustMap=function(t,e){return A_(t,e)(this)};class O_{constructor(t,e,r){this.project=t,this.concurrent=e,this.scheduler=r}call(t,e){return e.subscribe(new N_(t,this.project,this.concurrent,this.scheduler))}}class N_ extends ae.a{constructor(t,e,r,n){super(t),this.project=e,this.concurrent=r,this.scheduler=n,this.index=0,this.active=0,this.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(this.buffer=[])}static dispatch(t){const{subscriber:e,result:r,value:n,index:i}=t;e.subscribeToProjection(r,n,i)}_next(t){const e=this.destination;if(e.closed)return void this._complete();const r=this.index++;if(this.active<this.concurrent){e.next(t);let n=Object(qx.a)(this.project)(t,r);n===Yx.a?e.error(Yx.a.e):this.scheduler?this.add(this.scheduler.schedule(N_.dispatch,0,{subscriber:this,result:n,value:t,index:r})):this.subscribeToProjection(n,t,r)}else this.buffer.push(t)}subscribeToProjection(t,e,r){this.active++,this.add(Object(le.a)(this,t,e,r))}_complete(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()}notifyNext(t,e,r,n,i){this._next(e)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()}}function L_(t,e){return r=>r.lift(new I_(t,e))}E.a.prototype.expand=function(t,e=Number.POSITIVE_INFINITY,r){return P_(t,e=(e||0)<1?Number.POSITIVE_INFINITY:e,r)(this)};class I_{constructor(t,e){if(this.index=t,this.defaultValue=e,t<0)throw new lr}call(t,e){return e.subscribe(new R_(t,this.index,this.defaultValue))}}class R_ extends R.a{constructor(t,e,r){super(t),this.index=e,this.defaultValue=r}_next(t){0==this.index--&&(this.destination.next(t),this.destination.complete())}_complete(){const t=this.destination;this.index>=0&&("undefined"!=typeof this.defaultValue?t.next(this.defaultValue):t.error(new lr)),t.complete()}}function D_(t){return e=>e.lift(new F_(t))}E.a.prototype.elementAt=function(t,e){return L_(t,e)(this)},E.a.prototype.filter=U;class F_{constructor(t){this.callback=t}call(t,e){return e.subscribe(new k_(t,this.callback))}}class k_ extends R.a{constructor(t,e){super(t),this.add(new Zx.a(e))}}function U_(t){return D_(t)(this)}function B_(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return r=>r.lift(new j_(t,r,!1,e))}E.a.prototype.finally=U_,E.a.prototype._finally=U_;class j_{constructor(t,e,r,n){this.predicate=t,this.source=e,this.yieldIndex=r,this.thisArg=n}call(t,e){return e.subscribe(new z_(t,this.predicate,this.source,this.yieldIndex,this.thisArg))}}class z_ extends R.a{constructor(t,e,r,n,i){super(t),this.predicate=e,this.source=r,this.yieldIndex=n,this.thisArg=i,this.index=0}notifyComplete(t){const e=this.destination;e.next(t),e.complete()}_next(t){const{predicate:e,thisArg:r}=this,n=this.index++;try{e.call(r||this,t,n,this.source)&&this.notifyComplete(this.yieldIndex?n:t)}catch(t){this.destination.error(t)}}_complete(){this.notifyComplete(this.yieldIndex?-1:void 0)}}function V_(t,e){return r=>r.lift(new j_(t,r,!0,e))}E.a.prototype.find=function(t,e){return B_(t,e)(this)},E.a.prototype.findIndex=function(t,e){return V_(t,e)(this)},E.a.prototype.first=Ye;const G_=be.a.Map||class{constructor(){this.size=0,this._values=[],this._keys=[]}get(t){const e=this._keys.indexOf(t);return-1===e?void 0:this._values[e]}set(t,e){const r=this._keys.indexOf(t);return-1===r?(this._keys.push(t),this._values.push(e),this.size++):this._values[r]=e,this}delete(t){const e=this._keys.indexOf(t);return-1!==e&&(this._values.splice(e,1),this._keys.splice(e,1),this.size--,!0)}clear(){this._keys.length=0,this._values.length=0,this.size=0}forEach(t,e){for(let r=0;r<this.size;r++)t.call(e,this._values[r],this._keys[r])}};class H_{constructor(){this.values={}}delete(t){return this.values[t]=null,!0}set(t,e){return this.values[t]=e,this}get(t){return this.values[t]}forEach(t,e){const r=this.values;for(let n in r)r.hasOwnProperty(n)&&null!==r[n]&&t.call(e,r[n],n)}clear(){this.values={}}}function W_(t,e,r,n){return i=>i.lift(new X_(t,e,r,n))}class X_{constructor(t,e,r,n){this.keySelector=t,this.elementSelector=e,this.durationSelector=r,this.subjectSelector=n}call(t,e){return e.subscribe(new q_(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))}}class q_ extends R.a{constructor(t,e,r,n,i){super(t),this.keySelector=e,this.elementSelector=r,this.durationSelector=n,this.subjectSelector=i,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}_next(t){let e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)}_group(t,e){let r=this.groups;r||(r=this.groups="string"==typeof e?new H_:new G_);let n,i=r.get(e);if(this.elementSelector)try{n=this.elementSelector(t)}catch(t){this.error(t)}else n=t;if(!i){i=this.subjectSelector?this.subjectSelector():new pe.b,r.set(e,i);const t=new Z_(e,i,this);if(this.destination.next(t),this.durationSelector){let t;try{t=this.durationSelector(new Z_(e,i))}catch(t){return void this.error(t)}this.add(t.subscribe(new Y_(e,i,this)))}}i.closed||i.next(n)}_error(t){const e=this.groups;e&&(e.forEach((e,r)=>{e.error(t)}),e.clear()),this.destination.error(t)}_complete(){const t=this.groups;t&&(t.forEach((t,e)=>{t.complete()}),t.clear()),this.destination.complete()}removeGroup(t){this.groups.delete(t)}unsubscribe(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&super.unsubscribe())}}class Y_ extends R.a{constructor(t,e,r){super(e),this.key=t,this.group=e,this.parent=r}_next(t){this.complete()}_unsubscribe(){const{parent:t,key:e}=this;this.key=this.parent=null,t&&t.removeGroup(e)}}class Z_ extends E.a{constructor(t,e,r){super(),this.key=t,this.groupSubject=e,this.refCountSubscription=r}_subscribe(t){const e=new Zx.a,{refCountSubscription:r,groupSubject:n}=this;return r&&!r.closed&&e.add(new J_(r)),e.add(n.subscribe(t)),e}}class J_ extends Zx.a{constructor(t){super(),this.parent=t,t.count++}unsubscribe(){const t=this.parent;t.closed||this.closed||(super.unsubscribe(),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())}}function Q_(){return function(t){return t.lift(new K_)}}E.a.prototype.groupBy=function(t,e,r,n){return W_(t,e,r,n)(this)};class K_{call(t,e){return e.subscribe(new $_(t))}}class $_ extends R.a{_next(t){Object(Rb.a)()}}function tS(){return t=>t.lift(new eS)}E.a.prototype.ignoreElements=function(){return Q_()(this)};class eS{call(t,e){return e.subscribe(new rS(t))}}class rS extends R.a{constructor(t){super(t)}notifyComplete(t){const e=this.destination;e.next(t),e.complete()}_next(t){this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}function nS(t){return function(e){return e.lift(new iS(t))}}E.a.prototype.isEmpty=function(){return tS()(this)};class iS{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new oS(t,this.durationSelector))}}class oS extends ae.a{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){const e=Object(qx.a)(this.durationSelector)(t);if(e===Yx.a)this.destination.error(Yx.a.e);else{const t=Object(le.a)(this,e);t.closed?this.clearThrottle():this.add(this.throttled=t)}}}clearThrottle(){const{value:t,hasValue:e,throttled:r}=this;r&&(this.remove(r),this.throttled=null,r.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))}notifyNext(t,e,r,n){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function sS(t,e=Cb){return nS(()=>qb(t,e))}function aS(t){return t(this)}function lS(t){return e=>e.lift(new cS(t))}E.a.prototype.audit=function(t){return nS(t)(this)},E.a.prototype.auditTime=function(t,e=Cb){return sS(t,e)(this)},E.a.prototype.last=nr,E.a.prototype.let=aS,E.a.prototype.letBind=aS,E.a.prototype.every=$e;class cS{constructor(t){this.value=t}call(t,e){return e.subscribe(new uS(t,this.value))}}class uS extends R.a{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}function hS(){return function(t){return t.lift(new dS)}}E.a.prototype.mapTo=function(t){return lS(t)(this)};class dS{call(t,e){return e.subscribe(new pS(t))}}class pS extends R.a{constructor(t){super(t)}_next(t){this.destination.next(Ie.createNext(t))}_error(t){const e=this.destination;e.next(Ie.createError(t)),e.complete()}_complete(){const t=this.destination;t.next(Ie.createComplete()),t.complete()}}function fS(t){return vr("function"==typeof t?(e,r)=>t(e,r)>0?e:r:(t,e)=>t>e?t:e)}function mS(...t){return e=>e.lift.call(Object(Ob.a)(e,...t))}function vS(t,e,r=Number.POSITIVE_INFINITY){return"number"==typeof e&&(r=e,e=null),n=>n.lift(new gS(t,e,r))}E.a.prototype.materialize=function(){return hS()(this)},E.a.prototype.max=function(t){return fS(t)(this)},E.a.prototype.merge=function(...t){return mS(...t)(this)},E.a.prototype.mergeAll=ir,E.a.prototype.mergeMap=ve,E.a.prototype.flatMap=ve;class gS{constructor(t,e,r=Number.POSITIVE_INFINITY){this.ish=t,this.resultSelector=e,this.concurrent=r}call(t,e){return e.subscribe(new yS(t,this.ish,this.resultSelector,this.concurrent))}}class yS extends ae.a{constructor(t,e,r,n=Number.POSITIVE_INFINITY){super(t),this.ish=e,this.resultSelector=r,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){if(this.active<this.concurrent){const e=this.resultSelector,r=this.index++,n=this.ish,i=this.destination;this.active++,this._innerSub(n,i,e,t,r)}else this.buffer.push(t)}_innerSub(t,e,r,n,i){this.add(Object(le.a)(this,t,n,i))}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()}notifyNext(t,e,r,n,i){const{resultSelector:o,destination:s}=this;o?this.trySelectResult(t,e,r,n):s.next(e)}trySelectResult(t,e,r,n){const{resultSelector:i,destination:o}=this;let s;try{s=i(t,e,r,n)}catch(t){return void o.error(t)}o.next(s)}notifyError(t){this.destination.error(t)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function xS(t,e,r=Number.POSITIVE_INFINITY){return vS(t,e,r)(this)}function bS(t,e,r=Number.POSITIVE_INFINITY){return n=>n.lift(new wS(t,e,r))}E.a.prototype.flatMapTo=xS,E.a.prototype.mergeMapTo=xS;class wS{constructor(t,e,r){this.accumulator=t,this.seed=e,this.concurrent=r}call(t,e){return e.subscribe(new _S(t,this.accumulator,this.seed,this.concurrent))}}class _S extends ae.a{constructor(t,e,r,n){super(t),this.accumulator=e,this.acc=r,this.concurrent=n,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){if(this.active<this.concurrent){const e=this.index++,r=Object(qx.a)(this.accumulator)(this.acc,t);r===Yx.a?this.destination.error(Yx.a.e):(this.active++,this._innerSub(r,t,e))}else this.buffer.push(t)}_innerSub(t,e,r){this.add(Object(le.a)(this,t,e,r))}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}notifyNext(t,e,r,n,i){const{destination:o}=this;this.acc=e,this.hasValue=!0,o.next(e)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}}function SS(t){return vr("function"==typeof t?(e,r)=>t(e,r)<0?e:r:(t,e)=>t<e?t:e)}E.a.prototype.mergeScan=function(t,e,r=Number.POSITIVE_INFINITY){return bS(t,e,r)(this)},E.a.prototype.min=function(t){return SS(t)(this)};var TS=r("V2zk");function MS(){return t=>t.lift(new AS)}E.a.prototype.multicast=function(t,e){return Object(TS.a)(t,e)(this)},E.a.prototype.observeOn=function(t,e=0){return Re(t,e)(this)},E.a.prototype.onErrorResumeNext=function(...t){return Fb(...t)(this)};class AS{call(t,e){return e.subscribe(new ES(t))}}class ES extends R.a{constructor(t){super(t),this.hasPrev=!1}_next(t){this.hasPrev?this.destination.next([this.prev,t]):this.hasPrev=!0,this.prev=t}}function CS(t,e){return r=>[D(t,e)(r),D(function(e,r){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=r,n}(0,e))(r)]}function PS(...t){const e=t.length;if(0===e)throw new Error("list of properties cannot be empty.");return r=>B(function(t,e){return r=>{let n=r;for(let i=0;i<e;i++){const e=n[t[i]];if("undefined"==typeof e)return;n=e}return n}}(t,e))(r)}function OS(t){return t?Object(TS.a)(()=>new pe.b,t):Object(TS.a)(new pe.b)}function NS(t){return e=>Object(TS.a)(new me(t))(e)}function LS(t,e,r,n){r&&"function"!=typeof r&&(n=r);const i="function"==typeof r?r:void 0,o=new vw(t,e,n);return t=>Object(TS.a)(()=>o,i)(t)}function IS(){return t=>Object(TS.a)(new Jx)(t)}function RS(...t){return function(e){return 1===t.length&&Object(ge.a)(t[0])&&(t=t[0]),e.lift.call(Nb(e,...t))}}function DS(t=-1){return e=>0===t?new Ne.a:e.lift(new FS(t<0?-1:t-1,e))}E.a.prototype.pairwise=function(){return MS()(this)},E.a.prototype.partition=function(t,e){return CS(t,e)(this)},E.a.prototype.pluck=function(...t){return PS(...t)(this)},E.a.prototype.publish=function(t){return OS(t)(this)},E.a.prototype.publishBehavior=function(t){return NS(t)(this)},E.a.prototype.publishReplay=function(t,e,r,n){return LS(t,e,r,n)(this)},E.a.prototype.publishLast=function(){return IS()(this)},E.a.prototype.race=function(...t){return RS(...t)(this)},E.a.prototype.reduce=gr;class FS{constructor(t,e){this.count=t,this.source=e}call(t,e){return e.subscribe(new kS(t,this.count,this.source))}}class kS extends R.a{constructor(t,e,r){super(t),this.count=e,this.source=r}complete(){if(!this.isStopped){const{source:t,count:e}=this;if(0===e)return super.complete();e>-1&&(this.count=e-1),t.subscribe(this._unsubscribeAndRecycle())}}}function US(t){return e=>e.lift(new BS(t))}E.a.prototype.repeat=function(t=-1){return DS(t)(this)};class BS{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new jS(t,this.notifier,e))}}class jS extends ae.a{constructor(t,e,r){super(t),this.notifier=e,this.source=r,this.sourceIsBeingSubscribedTo=!0}notifyNext(t,e,r,n,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)}notifyComplete(t){if(!1===this.sourceIsBeingSubscribedTo)return super.complete()}complete(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return super.complete();this._unsubscribeAndRecycle(),this.notifications.next()}}_unsubscribe(){const{notifications:t,retriesSubscription:e}=this;t&&(t.unsubscribe(),this.notifications=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null}_unsubscribeAndRecycle(){const{notifications:t,retries:e,retriesSubscription:r}=this;return this.notifications=null,this.retries=null,this.retriesSubscription=null,super._unsubscribeAndRecycle(),this.notifications=t,this.retries=e,this.retriesSubscription=r,this}subscribeToRetries(){this.notifications=new pe.b;const t=Object(qx.a)(this.notifier)(this.notifications);if(t===Yx.a)return super.complete();this.retries=t,this.retriesSubscription=Object(le.a)(this,t)}}function zS(t=-1){return e=>e.lift(new VS(t,e))}E.a.prototype.repeatWhen=function(t){return US(t)(this)};class VS{constructor(t,e){this.count=t,this.source=e}call(t,e){return e.subscribe(new GS(t,this.count,this.source))}}class GS extends R.a{constructor(t,e,r){super(t),this.count=e,this.source=r}error(t){if(!this.isStopped){const{source:e,count:r}=this;if(0===r)return super.error(t);r>-1&&(this.count=r-1),e.subscribe(this._unsubscribeAndRecycle())}}}function HS(t){return e=>e.lift(new WS(t,e))}E.a.prototype.retry=function(t=-1){return zS(t)(this)};class WS{constructor(t,e){this.notifier=t,this.source=e}call(t,e){return e.subscribe(new XS(t,this.notifier,this.source))}}class XS extends ae.a{constructor(t,e,r){super(t),this.notifier=e,this.source=r}error(t){if(!this.isStopped){let e=this.errors,r=this.retries,n=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(e=new pe.b,(r=Object(qx.a)(this.notifier)(e))===Yx.a)return super.error(Yx.a.e);n=Object(le.a)(this,r)}this._unsubscribeAndRecycle(),this.errors=e,this.retries=r,this.retriesSubscription=n,e.next(t)}}_unsubscribe(){const{errors:t,retriesSubscription:e}=this;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null}notifyNext(t,e,r,n,i){const{errors:o,retries:s,retriesSubscription:a}=this;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=o,this.retries=s,this.retriesSubscription=a,this.source.subscribe(this)}}function qS(t){return e=>e.lift(new YS(t))}E.a.prototype.retryWhen=function(t){return HS(t)(this)};class YS{constructor(t){this.notifier=t}call(t,e){const r=new ZS(t),n=e.subscribe(r);return n.add(Object(le.a)(r,this.notifier)),n}}class ZS extends ae.a{constructor(){super(...arguments),this.hasValue=!1}_next(t){this.value=t,this.hasValue=!0}notifyNext(t,e,r,n,i){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))}}function JS(t,e=Cb){return r=>r.lift(new QS(t,e))}E.a.prototype.sample=function(t){return qS(t)(this)};class QS{constructor(t,e){this.period=t,this.scheduler=e}call(t,e){return e.subscribe(new KS(t,this.period,this.scheduler))}}class KS extends R.a{constructor(t,e,r){super(t),this.period=e,this.scheduler=r,this.hasValue=!1,this.add(r.schedule($S,e,{subscriber:this,period:e}))}_next(t){this.lastValue=t,this.hasValue=!0}notifyNext(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))}}function $S(t){let{subscriber:e,period:r}=t;e.notifyNext(),this.schedule(t,r)}function tT(t,e){return r=>r.lift(new eT(t,e))}E.a.prototype.sampleTime=function(t,e=Cb){return JS(t,e)(this)},E.a.prototype.scan=function(t,e){return arguments.length>=2?or(t,e)(this):or(t)(this)};class eT{constructor(t,e){this.compareTo=t,this.comparor=e}call(t,e){return e.subscribe(new rT(t,this.compareTo,this.comparor))}}class rT extends R.a{constructor(t,e,r){super(t),this.compareTo=e,this.comparor=r,this._a=[],this._b=[],this._oneComplete=!1,this.add(e.subscribe(new nT(t,this)))}_next(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())}_complete(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0}checkValues(){const{_a:t,_b:e,comparor:r}=this;for(;t.length>0&&e.length>0;){let n=t.shift(),i=e.shift(),o=!1;r?(o=Object(qx.a)(r)(n,i))===Yx.a&&this.destination.error(Yx.a.e):o=n===i,o||this.emit(!1)}}emit(t){const{destination:e}=this;e.next(t),e.complete()}nextB(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())}}class nT extends R.a{constructor(t,e){super(t),this.parent=e}_next(t){this.parent.nextB(t)}_error(t){this.parent.error(t)}_complete(){this.parent._complete()}}E.a.prototype.sequenceEqual=function(t,e){return tT(t,e)(this)};var iT=r("LiEr");function oT(t,e,r){return n=>n.lift(function(t,e,r){let n,i,o=0,s=!1,a=!1;return function(l){o++,n&&!s||(s=!1,n=new vw(t,e,r),i=l.subscribe({next(t){n.next(t)},error(t){s=!0,n.error(t)},complete(){a=!0,n.complete()}}));const c=n.subscribe(this);return()=>{o--,c.unsubscribe(),i&&0===o&&a&&i.unsubscribe()}}}(t,e,r))}function sT(t){return e=>e.lift(new aT(t,e))}E.a.prototype.share=iT.a,E.a.prototype.shareReplay=function(t,e,r){return oT(t,e,r)(this)};class aT{constructor(t,e){this.predicate=t,this.source=e}call(t,e){return e.subscribe(new lT(t,this.predicate,this.source))}}class lT extends R.a{constructor(t,e,r){super(t),this.predicate=e,this.source=r,this.seenValue=!1,this.index=0}applySingleValue(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)}_next(t){const e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)}tryNext(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}}_complete(){const t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new He)}}function cT(t){return e=>e.lift(new uT(t))}E.a.prototype.single=function(t){return sT(t)(this)};class uT{constructor(t){this.total=t}call(t,e){return e.subscribe(new hT(t,this.total))}}class hT extends R.a{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){++this.count>this.total&&this.destination.next(t)}}function dT(t){return e=>e.lift(new pT(t))}E.a.prototype.skip=function(t){return cT(t)(this)};class pT{constructor(t){if(this._skipCount=t,this._skipCount<0)throw new lr}call(t,e){return e.subscribe(0===this._skipCount?new R.a(t):new fT(t,this._skipCount))}}class fT extends R.a{constructor(t,e){super(t),this._skipCount=e,this._count=0,this._ring=new Array(e)}_next(t){const e=this._skipCount,r=this._count++;if(r<e)this._ring[r]=t;else{const n=r%e,i=this._ring,o=i[n];i[n]=t,this.destination.next(o)}}}function mT(t){return e=>e.lift(new vT(t))}E.a.prototype.skipLast=function(t){return dT(t)(this)};class vT{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new gT(t,this.notifier))}}class gT extends ae.a{constructor(t,e){super(t),this.hasValue=!1,this.isInnerStopped=!1,this.add(Object(le.a)(this,e))}_next(t){this.hasValue&&super._next(t)}_complete(){this.isInnerStopped?super._complete():this.unsubscribe()}notifyNext(t,e,r,n,i){this.hasValue=!0}notifyComplete(){this.isInnerStopped=!0,this.isStopped&&super._complete()}}function yT(t){return e=>e.lift(new xT(t))}E.a.prototype.skipUntil=function(t){return mT(t)(this)};class xT{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new bT(t,this.predicate))}}class bT extends R.a{constructor(t,e){super(t),this.predicate=e,this.skipping=!0,this.index=0}_next(t){const e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)}tryCallPredicate(t){try{const e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}}}function wT(...t){return e=>{let r=t[t.length-1];Object(ib.a)(r)?t.pop():r=null;const n=t.length;return cb(1===n?new Oe.a(t[0],r):n>1?new P.a(t,r):new Ne.a(r),e)}}E.a.prototype.skipWhile=function(t){return yT(t)(this)},E.a.prototype.startWith=function(...t){return wT(...t)(this)};const _T=new class{constructor(t){if(this.root=t,t.setImmediate&&"function"==typeof t.setImmediate)this.setImmediate=t.setImmediate.bind(t),this.clearImmediate=t.clearImmediate.bind(t);else{this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.setImmediate=this.canUseProcessNextTick()?this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.createReadyStateChangeSetImmediate():this.createSetTimeoutSetImmediate();let t=function t(e){delete t.instance.tasksByHandle[e]};t.instance=this,this.clearImmediate=t}}identify(t){return this.root.Object.prototype.toString.call(t)}canUseProcessNextTick(){return"[object process]"===this.identify(this.root.process)}canUseMessageChannel(){return Boolean(this.root.MessageChannel)}canUseReadyStateChange(){const t=this.root.document;return Boolean(t&&"onreadystatechange"in t.createElement("script"))}canUsePostMessage(){const t=this.root;if(t.postMessage&&!t.importScripts){let e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}return!1}partiallyApplied(t,...e){let r=function t(){const{handler:e,args:r}=t;"function"==typeof e?e.apply(void 0,r):new Function(""+e)()};return r.handler=t,r.args=e,r}addFromSetImmediateArguments(t){return this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,t),this.nextHandle++}createProcessNextTickSetImmediate(){let t=function t(){const{instance:e}=t;let r=e.addFromSetImmediateArguments(arguments);return e.root.process.nextTick(e.partiallyApplied(e.runIfPresent,r)),r};return t.instance=this,t}createPostMessageSetImmediate(){const t=this.root;let e="setImmediate$"+t.Math.random()+"$",r=function r(n){const i=r.instance;n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&i.runIfPresent(+n.data.slice(e.length))};r.instance=this,t.addEventListener("message",r,!1);let n=function t(){const{messagePrefix:e,instance:r}=t;let n=r.addFromSetImmediateArguments(arguments);return r.root.postMessage(e+n,"*"),n};return n.instance=this,n.messagePrefix=e,n}runIfPresent(t){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,t),0);else{let e=this.tasksByHandle[t];if(e){this.currentlyRunningATask=!0;try{e()}finally{this.clearImmediate(t),this.currentlyRunningATask=!1}}}}createMessageChannelSetImmediate(){let t=new this.root.MessageChannel;t.port1.onmessage=(t=>{this.runIfPresent(t.data)});let e=function t(){const{channel:e,instance:r}=t;let n=r.addFromSetImmediateArguments(arguments);return e.port2.postMessage(n),n};return e.channel=t,e.instance=this,e}createReadyStateChangeSetImmediate(){let t=function t(){const e=t.instance,r=e.root.document,n=r.documentElement;let i=e.addFromSetImmediateArguments(arguments),o=r.createElement("script");return o.onreadystatechange=(()=>{e.runIfPresent(i),o.onreadystatechange=null,n.removeChild(o),o=null}),n.appendChild(o),i};return t.instance=this,t}createSetTimeoutSetImmediate(){let t=function t(){const e=t.instance;let r=e.addFromSetImmediateArguments(arguments);return e.root.setTimeout(e.partiallyApplied(e.runIfPresent,r),0),r};return t.instance=this,t}}(be.a),ST=new class extends Eb{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let r,n=-1,i=e.length;t=t||e.shift();do{if(r=t.execute(t.state,t.delay))break}while(++n<i&&(t=e.shift()));if(this.active=!1,r){for(;++n<i&&(t=e.shift());)t.unsubscribe();throw r}}}(class extends Mb{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,r=0){return null!==r&&r>0?super.requestAsyncId(t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=_T.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,e,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(t,e,r);0===t.actions.length&&(_T.clearImmediate(e),t.scheduled=void 0)}});class TT extends E.a{constructor(t,e=0,r=ST){super(),this.source=t,this.delayTime=e,this.scheduler=r,(!Sb(e)||e<0)&&(this.delayTime=0),r&&"function"==typeof r.schedule||(this.scheduler=ST)}static create(t,e=0,r=ST){return new TT(t,e,r)}static dispatch(t){const{source:e,subscriber:r}=t;return this.add(e.subscribe(r))}_subscribe(t){return this.scheduler.schedule(TT.dispatch,this.delayTime,{source:this.source,subscriber:t})}}function MT(t,e){return function(r){return r.lift(new AT(t,e))}}E.a.prototype.subscribeOn=function(t,e=0){return function(t,e=0){return function(r){return r.lift(new class{constructor(t,e){this.scheduler=t,this.delay=e}call(t,e){return new TT(e,this.delay,this.scheduler).subscribe(t)}}(t,e))}}(t,e)(this)};class AT{constructor(t,e){this.project=t,this.resultSelector=e}call(t,e){return e.subscribe(new ET(t,this.project,this.resultSelector))}}class ET extends ae.a{constructor(t,e,r){super(t),this.project=e,this.resultSelector=r,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)}_innerSub(t,e,r){const n=this.innerSubscription;n&&n.unsubscribe(),this.add(this.innerSubscription=Object(le.a)(this,t,e,r))}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.remove(t),this.innerSubscription=null,this.isStopped&&super._complete()}notifyNext(t,e,r,n,i){this.resultSelector?this._tryNotifyNext(t,e,r,n):this.destination.next(e)}_tryNotifyNext(t,e,r,n){let i;try{i=this.resultSelector(t,e,r,n)}catch(t){return void this.destination.error(t)}this.destination.next(i)}}var CT=r("Jh97");function PT(){return MT(CT.a)}function OT(){return PT()(this)}function NT(t,e){return r=>r.lift(new LT(t,e))}E.a.prototype.switch=OT,E.a.prototype._switch=OT,E.a.prototype.switchMap=function(t,e){return MT(t,e)(this)};class LT{constructor(t,e){this.observable=t,this.resultSelector=e}call(t,e){return e.subscribe(new IT(t,this.observable,this.resultSelector))}}class IT extends ae.a{constructor(t,e,r){super(t),this.inner=e,this.resultSelector=r,this.index=0}_next(t){const e=this.innerSubscription;e&&e.unsubscribe(),this.add(this.innerSubscription=Object(le.a)(this,this.inner,t,this.index++))}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.remove(t),this.innerSubscription=null,this.isStopped&&super._complete()}notifyNext(t,e,r,n,i){const{resultSelector:o,destination:s}=this;o?this.tryResultSelector(t,e,r,n):s.next(e)}tryResultSelector(t,e,r,n){const{resultSelector:i,destination:o}=this;let s;try{s=i(t,e,r,n)}catch(t){return void o.error(t)}o.next(s)}}function RT(t){return e=>0===t?new Ne.a:e.lift(new DT(t))}E.a.prototype.switchMapTo=function(t,e){return NT(t,e)(this)};class DT{constructor(t){if(this.total=t,this.total<0)throw new lr}call(t,e){return e.subscribe(new FT(t,this.total))}}class FT extends R.a{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))}}function kT(t){return e=>e.lift(new UT(t))}E.a.prototype.take=function(t){return RT(t)(this)},E.a.prototype.takeLast=function(t){return cr(t)(this)};class UT{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new BT(t,this.notifier))}}class BT extends ae.a{constructor(t,e){super(t),this.notifier=e,this.add(Object(le.a)(this,e))}notifyNext(t,e,r,n,i){this.complete()}notifyComplete(){}}function jT(t){return e=>e.lift(new zT(t))}E.a.prototype.takeUntil=function(t){return kT(t)(this)};class zT{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new VT(t,this.predicate))}}class VT extends R.a{constructor(t,e){super(t),this.predicate=e,this.index=0}_next(t){const e=this.destination;let r;try{r=this.predicate(t,this.index++)}catch(t){return void e.error(t)}this.nextOrComplete(t,r)}nextOrComplete(t,e){const r=this.destination;Boolean(e)?r.next(t):r.complete()}}E.a.prototype.takeWhile=function(t){return jT(t)(this)};const GT={leading:!0,trailing:!1};function HT(t,e=GT){return r=>r.lift(new WT(t,e.leading,e.trailing))}class WT{constructor(t,e,r){this.durationSelector=t,this.leading=e,this.trailing=r}call(t,e){return e.subscribe(new XT(t,this.durationSelector,this.leading,this.trailing))}}class XT extends ae.a{constructor(t,e,r,n){super(t),this.destination=t,this.durationSelector=e,this._leading=r,this._trailing=n,this._hasTrailingValue=!1}_next(t){if(this.throttled)this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=t);else{const e=this.tryDurationSelector(t);e&&this.add(this.throttled=Object(le.a)(this,e)),this._leading&&(this.destination.next(t),this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=t))}}tryDurationSelector(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}}_unsubscribe(){const{throttled:t,_trailingValue:e,_hasTrailingValue:r,_trailing:n}=this;this._trailingValue=null,this._hasTrailingValue=!1,t&&(this.remove(t),this.throttled=null,t.unsubscribe())}_sendTrailing(){const{destination:t,throttled:e,_trailing:r,_trailingValue:n,_hasTrailingValue:i}=this;e&&r&&i&&(t.next(n),this._trailingValue=null,this._hasTrailingValue=!1)}notifyNext(t,e,r,n,i){this._sendTrailing(),this._unsubscribe()}notifyComplete(){this._sendTrailing(),this._unsubscribe()}}function qT(t,e=Cb,r=GT){return n=>n.lift(new YT(t,e,r.leading,r.trailing))}E.a.prototype.throttle=function(t,e=GT){return HT(t,e)(this)};class YT{constructor(t,e,r,n){this.duration=t,this.scheduler=e,this.leading=r,this.trailing=n}call(t,e){return e.subscribe(new ZT(t,this.duration,this.scheduler,this.leading,this.trailing))}}class ZT extends R.a{constructor(t,e,r,n,i){super(t),this.duration=e,this.scheduler=r,this.leading=n,this.trailing=i,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(JT,this.duration,{subscriber:this})),this.leading&&this.destination.next(t))}clearThrottle(){const t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}function JT(t){const{subscriber:e}=t;e.clearThrottle()}function QT(t=Cb){return e=>e.lift(new $T(t))}E.a.prototype.throttleTime=function(t,e=Cb,r=GT){return qT(t,e,r)(this)};class KT{constructor(t,e){this.value=t,this.interval=e}}class $T{constructor(t){this.scheduler=t}call(t,e){return e.subscribe(new tM(t,this.scheduler))}}class tM extends R.a{constructor(t,e){super(t),this.scheduler=e,this.lastTime=0,this.lastTime=e.now()}_next(t){let e=this.scheduler.now(),r=e-this.lastTime;this.lastTime=e,this.destination.next(new KT(t,r))}}E.a.prototype.timeInterval=function(t=Cb){return QT(t)(this)};class eM extends Error{constructor(){const t=super("Timeout has occurred");this.name=t.name="TimeoutError",this.stack=t.stack,this.message=t.message}}function rM(t,e=Cb){const r=Wb(t),n=r?+t-e.now():Math.abs(t);return t=>t.lift(new nM(n,r,e,new eM))}class nM{constructor(t,e,r,n){this.waitFor=t,this.absoluteTimeout=e,this.scheduler=r,this.errorInstance=n}call(t,e){return e.subscribe(new iM(t,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))}}class iM extends R.a{constructor(t,e,r,n,i){super(t),this.absoluteTimeout=e,this.waitFor=r,this.scheduler=n,this.errorInstance=i,this.action=null,this.scheduleTimeout()}static dispatchTimeout(t){t.error(t.errorInstance)}scheduleTimeout(){const{action:t}=this;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(iM.dispatchTimeout,this.waitFor,this))}_next(t){this.absoluteTimeout||this.scheduleTimeout(),super._next(t)}_unsubscribe(){this.action=null,this.scheduler=null,this.errorInstance=null}}function oM(t,e,r=Cb){return n=>{let i=Wb(t),o=i?+t-r.now():Math.abs(t);return n.lift(new sM(o,i,e,r))}}E.a.prototype.timeout=function(t,e=Cb){return rM(t,e)(this)};class sM{constructor(t,e,r,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=r,this.scheduler=n}call(t,e){return e.subscribe(new aM(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class aM extends ae.a{constructor(t,e,r,n,i){super(t),this.absoluteTimeout=e,this.waitFor=r,this.withObservable=n,this.scheduler=i,this.action=null,this.scheduleTimeout()}static dispatchTimeout(t){const{withObservable:e}=t;t._unsubscribeAndRecycle(),t.add(Object(le.a)(t,e))}scheduleTimeout(){const{action:t}=this;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(aM.dispatchTimeout,this.waitFor,this))}_next(t){this.absoluteTimeout||this.scheduleTimeout(),super._next(t)}_unsubscribe(){this.action=null,this.scheduler=null,this.withObservable=null}}function lM(t=Cb){return B(e=>new cM(e,t.now()))}E.a.prototype.timeoutWith=function(t,e,r=Cb){return oM(t,e,r)(this)};class cM{constructor(t,e){this.value=t,this.timestamp=e}}function uM(t,e,r){return 0===r?[e]:(t.push(e),t)}function hM(){return vr(uM,[])}function dM(t){return function(e){return e.lift(new pM(t))}}E.a.prototype.timestamp=function(t=Cb){return lM(t)(this)},E.a.prototype.toArray=function(){return hM()(this)},r("Nfkn");class pM{constructor(t){this.windowBoundaries=t}call(t,e){const r=new fM(t),n=e.subscribe(r);return n.closed||r.add(Object(le.a)(r,this.windowBoundaries)),n}}class fM extends ae.a{constructor(t){super(t),this.window=new pe.b,t.next(this.window)}notifyNext(t,e,r,n,i){this.openWindow()}notifyError(t,e){this._error(t)}notifyComplete(t){this._complete()}_next(t){this.window.next(t)}_error(t){this.window.error(t),this.destination.error(t)}_complete(){this.window.complete(),this.destination.complete()}_unsubscribe(){this.window=null}openWindow(){const t=this.window;t&&t.complete();const e=this.destination,r=this.window=new pe.b;e.next(r)}}function mM(t,e=0){return function(r){return r.lift(new vM(t,e))}}E.a.prototype.window=function(t){return dM(t)(this)};class vM{constructor(t,e){this.windowSize=t,this.startWindowEvery=e}call(t,e){return e.subscribe(new gM(t,this.windowSize,this.startWindowEvery))}}class gM extends R.a{constructor(t,e,r){super(t),this.destination=t,this.windowSize=e,this.startWindowEvery=r,this.windows=[new pe.b],this.count=0,t.next(this.windows[0])}_next(t){const e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,r=this.destination,n=this.windowSize,i=this.windows,o=i.length;for(let a=0;a<o&&!this.closed;a++)i[a].next(t);const s=this.count-n+1;if(s>=0&&s%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){const t=new pe.b;i.push(t),r.next(t)}}_error(t){const e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)}_complete(){const t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()}_unsubscribe(){this.count=0,this.windows=null}}function yM(t){let e=Cb,r=null,n=Number.POSITIVE_INFINITY;return Object(ib.a)(arguments[3])&&(e=arguments[3]),Object(ib.a)(arguments[2])?e=arguments[2]:Sb(arguments[2])&&(n=arguments[2]),Object(ib.a)(arguments[1])?e=arguments[1]:Sb(arguments[1])&&(r=arguments[1]),function(i){return i.lift(new xM(t,r,n,e))}}E.a.prototype.windowCount=function(t,e=0){return mM(t,e)(this)};class xM{constructor(t,e,r,n){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=r,this.scheduler=n}call(t,e){return e.subscribe(new wM(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))}}class bM extends pe.b{constructor(){super(...arguments),this._numberOfNextedValues=0}next(t){this._numberOfNextedValues++,super.next(t)}get numberOfNextedValues(){return this._numberOfNextedValues}}class wM extends R.a{constructor(t,e,r,n,i){super(t),this.destination=t,this.windowTimeSpan=e,this.windowCreationInterval=r,this.maxWindowSize=n,this.scheduler=i,this.windows=[];const o=this.openWindow();if(null!==r&&r>=0){const t={windowTimeSpan:e,windowCreationInterval:r,subscriber:this,scheduler:i};this.add(i.schedule(TM,e,{subscriber:this,window:o,context:null})),this.add(i.schedule(SM,r,t))}else this.add(i.schedule(_M,e,{subscriber:this,window:o,windowTimeSpan:e}))}_next(t){const e=this.windows,r=e.length;for(let n=0;n<r;n++){const r=e[n];r.closed||(r.next(t),r.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(r))}}_error(t){const e=this.windows;for(;e.length>0;)e.shift().error(t);this.destination.error(t)}_complete(){const t=this.windows;for(;t.length>0;){const e=t.shift();e.closed||e.complete()}this.destination.complete()}openWindow(){const t=new bM;return this.windows.push(t),this.destination.next(t),t}closeWindow(t){t.complete();const e=this.windows;e.splice(e.indexOf(t),1)}}function _M(t){const{subscriber:e,windowTimeSpan:r,window:n}=t;n&&e.closeWindow(n),t.window=e.openWindow(),this.schedule(t,r)}function SM(t){const{windowTimeSpan:e,subscriber:r,scheduler:n,windowCreationInterval:i}=t,o=r.openWindow();let s={action:this,subscription:null};s.subscription=n.schedule(TM,e,{subscriber:r,window:o,context:s}),this.add(s.subscription),this.schedule(t,i)}function TM(t){const{subscriber:e,window:r,context:n}=t;n&&n.action&&n.subscription&&n.action.remove(n.subscription),e.closeWindow(r)}function MM(t,e){return r=>r.lift(new AM(t,e))}E.a.prototype.windowTime=function(t){let e=Cb,r=null,n=Number.POSITIVE_INFINITY;return Object(ib.a)(arguments[3])&&(e=arguments[3]),Object(ib.a)(arguments[2])?e=arguments[2]:Sb(arguments[2])&&(n=arguments[2]),Object(ib.a)(arguments[1])?e=arguments[1]:Sb(arguments[1])&&(r=arguments[1]),yM(t,r,n,e)(this)};class AM{constructor(t,e){this.openings=t,this.closingSelector=e}call(t,e){return e.subscribe(new EM(t,this.openings,this.closingSelector))}}class EM extends ae.a{constructor(t,e,r){super(t),this.openings=e,this.closingSelector=r,this.contexts=[],this.add(this.openSubscription=Object(le.a)(this,e,e))}_next(t){const{contexts:e}=this;if(e){const r=e.length;for(let n=0;n<r;n++)e[n].window.next(t)}}_error(t){const{contexts:e}=this;if(this.contexts=null,e){const r=e.length;let n=-1;for(;++n<r;){const r=e[n];r.window.error(t),r.subscription.unsubscribe()}}super._error(t)}_complete(){const{contexts:t}=this;if(this.contexts=null,t){const e=t.length;let r=-1;for(;++r<e;){const e=t[r];e.window.complete(),e.subscription.unsubscribe()}}super._complete()}_unsubscribe(){const{contexts:t}=this;if(this.contexts=null,t){const e=t.length;let r=-1;for(;++r<e;){const e=t[r];e.window.unsubscribe(),e.subscription.unsubscribe()}}}notifyNext(t,e,r,n,i){if(t===this.openings){const{closingSelector:t}=this,r=Object(qx.a)(t)(e);if(r===Yx.a)return this.error(Yx.a.e);{const t=new pe.b,e=new Zx.a,n={window:t,subscription:e};this.contexts.push(n);const i=Object(le.a)(this,r,n);i.closed?this.closeWindow(this.contexts.length-1):(i.context=n,e.add(i)),this.destination.next(t)}}else this.closeWindow(this.contexts.indexOf(t))}notifyError(t){this.error(t)}notifyComplete(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))}closeWindow(t){if(-1===t)return;const{contexts:e}=this,r=e[t],{window:n,subscription:i}=r;e.splice(t,1),n.complete(),i.unsubscribe()}}function CM(t){return function(e){return e.lift(new PM(t))}}E.a.prototype.windowToggle=function(t,e){return MM(t,e)(this)};class PM{constructor(t){this.closingSelector=t}call(t,e){return e.subscribe(new OM(t,this.closingSelector))}}class OM extends ae.a{constructor(t,e){super(t),this.destination=t,this.closingSelector=e,this.openWindow()}notifyNext(t,e,r,n,i){this.openWindow(i)}notifyError(t,e){this._error(t)}notifyComplete(t){this.openWindow(t)}_next(t){this.window.next(t)}_error(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()}_complete(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()}unsubscribeClosingNotification(){this.closingNotification&&this.closingNotification.unsubscribe()}openWindow(t=null){t&&(this.remove(t),t.unsubscribe());const e=this.window;e&&e.complete();const r=this.window=new pe.b;this.destination.next(r);const n=Object(qx.a)(this.closingSelector)();if(n===Yx.a){const t=Yx.a.e;this.destination.error(t),this.window.error(t)}else this.add(this.closingNotification=Object(le.a)(this,n))}}function NM(...t){return e=>{let r;return"function"==typeof t[t.length-1]&&(r=t.pop()),e.lift(new LM(t,r))}}E.a.prototype.windowWhen=function(t){return CM(t)(this)};class LM{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new IM(t,this.observables,this.project))}}class IM extends ae.a{constructor(t,e,r){super(t),this.observables=e,this.project=r,this.toRespond=[];const n=e.length;this.values=new Array(n);for(let i=0;i<n;i++)this.toRespond.push(i);for(let i=0;i<n;i++){let t=e[i];this.add(Object(le.a)(this,t,t,i))}}notifyNext(t,e,r,n,i){this.values[r]=e;const o=this.toRespond;if(o.length>0){const t=o.indexOf(r);-1!==t&&o.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}function RM(t){return e=>e.lift(new Jb(t))}E.a.prototype.withLatestFrom=function(...t){return NM(...t)(this)},E.a.prototype.zip=function(...t){return Yb(...t)(this)},E.a.prototype.zipAll=function(t){return RM(t)(this)},r("9y/k"),r("la7E");class DM{constructor(t,e=Number.POSITIVE_INFINITY){this.subscribedFrame=t,this.unsubscribedFrame=e}}class FM{constructor(){this.subscriptions=[]}logSubscribedFrame(){return this.subscriptions.push(new DM(this.scheduler.now())),this.subscriptions.length-1}logUnsubscribedFrame(t){const e=this.subscriptions;e[t]=new DM(e[t].subscribedFrame,this.scheduler.now())}}function kM(t,e){for(let r=0,n=e.length;r<n;r++){const n=e[r],i=Object.getOwnPropertyNames(n.prototype);for(let e=0,r=i.length;e<r;e++){const r=i[e];t.prototype[r]=n.prototype[r]}}}kM(class extends E.a{constructor(t,e){super(function(t){const e=this,r=e.logSubscribedFrame();return t.add(new Zx.a(()=>{e.logUnsubscribedFrame(r)})),e.scheduleMessages(t),t}),this.messages=t,this.subscriptions=[],this.scheduler=e}scheduleMessages(t){const e=this.messages.length;for(let r=0;r<e;r++){const e=this.messages[r];t.add(this.scheduler.schedule(({message:t,subscriber:e})=>{t.notification.observe(e)},e.frame,{message:e,subscriber:t}))}}},[FM]),kM(class extends pe.b{constructor(t,e){super(),this.messages=t,this.subscriptions=[],this.scheduler=e}_subscribe(t){const e=this,r=e.logSubscribedFrame();return t.add(new Zx.a(()=>{e.logUnsubscribedFrame(r)})),super._subscribe(t)}setup(){const t=this,e=t.messages.length;for(var r=0;r<e;r++)(()=>{var e=t.messages[r];t.scheduler.schedule(()=>{e.notification.observe(t)},e.frame)})()}},[FM]);const UM=new class{constructor(t){t.requestAnimationFrame?(this.cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this.requestAnimationFrame=t.requestAnimationFrame.bind(t)):t.mozRequestAnimationFrame?(this.cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)):t.webkitRequestAnimationFrame?(this.cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)):t.msRequestAnimationFrame?(this.cancelAnimationFrame=t.msCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.msRequestAnimationFrame.bind(t)):t.oRequestAnimationFrame?(this.cancelAnimationFrame=t.oCancelAnimationFrame.bind(t),this.requestAnimationFrame=t.oRequestAnimationFrame.bind(t)):(this.cancelAnimationFrame=t.clearTimeout.bind(t),this.requestAnimationFrame=function(e){return t.setTimeout(e,1e3/60)})}}(be.a);new class extends Eb{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let r,n=-1,i=e.length;t=t||e.shift();do{if(r=t.execute(t.state,t.delay))break}while(++n<i&&(t=e.shift()));if(this.active=!1,r){for(;++n<i&&(t=e.shift());)t.unsubscribe();throw r}}}(class extends Mb{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,r=0){return null!==r&&r>0?super.requestAsyncId(t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=UM.requestAnimationFrame(t.flush.bind(t,null))))}recycleAsyncId(t,e,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(t,e,r);0===t.actions.length&&(UM.cancelAnimationFrame(e),t.scheduled=void 0)}}),r("73T8");var BM=r("AnYr"),jM=r("4iP9");class zM{getEngineForce(){return this.engineForce}getBrakingForce(){return this.brakingForce}getSteeringMaxCurvature(t){return 1/(zM.DORMANT_TURN_RADIUS+Math.pow(t,2)/this.steeringFactor)}getDragForce(t){return this.dragConstant*Math.pow(t,2)}getWheelFrictionForce(t){return this.wheelFrictionConstant*Math.abs(t)}getMaxAcceleration(t){return(this.getEngineForce()-this.getDragForce(t)-this.getWheelFrictionForce(t))/this.mass}getMaxDeceleration(t){const e=-ya.getAccelerationToAchieveSpeed(t,0,1);return Math.min(e,(this.getBrakingForce()+this.getDragForce(t)+this.getWheelFrictionForce(t))/this.mass)}static fromDTO(t){const e=new zM;return e.steeringFactor=t.steering,e.dragConstant=t.dragConstant,e.wheelFrictionConstant=t.wheelFrictionConstant,e.engineForce=t.engineForce,e.brakingForce=t.brakingForce,e.mass=t.mass,e}}zM.DORMANT_TURN_RADIUS=5.5;var VM=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},GM=ia.Point;class HM{constructor(t,e,r,n=0,i=0,o=0,s=0){this.id=t,this.model=e,this.characteristics=r,this.x=n,this.y=i,this.rotation=o,this._speed=s,this.ready=!1,this.positionChangedSubject=new pe.b,this.speedChangedSubject=new pe.b}get speed(){return this._speed}set speed(t){t!==this._speed&&(this._speed=t,this.speedChangedSubject.next(t))}initMesh(t,e=!0){return VM(this,void 0,void 0,function*(){this.mesh=yield t.loadCar("BMW_M3_MW"),this.mesh.position.x=this.x,this.mesh.position.y=this.y,this.mesh.position.z=0,this.mesh.rotation.z=this.rotation,this.mesh.traverse(function(t){t instanceof ea.Mesh&&(t.castShadow=e,t.receiveShadow=e)}),this.ready=!0})}setX(t){t!=this.x&&(this.x=t,this.ready&&(this.mesh.position.x=this.x),this.positionChangedSubject.next(this.getPosition()))}setY(t){t!=this.y&&(this.y=t,this.ready&&(this.mesh.position.y=this.y),this.positionChangedSubject.next(this.getPosition()))}getPosition(){return new GM(this.x,this.y)}setPosition(t){this.x==t.x&&this.y==t.y||(this.x=t.x,this.y=t.y,this.ready&&this.mesh.position.set(t.x,t.y,0),this.positionChangedSubject.next(this.getPosition()))}setRotation(t){t!=this.rotation&&(this.rotation=t,this.ready&&(this.mesh.rotation.z=this.rotation))}clone(){return new HM(5*(this.id+1),this.model,this.characteristics,this.x,this.y,this.rotation)}static fromDTO(t){return new HM(Math.round(1e3*Math.random()),"BMW_M3_MW",zM.fromDTO(t))}}var WM=r("mHjp"),XM=PIXI.Point;class qM{getPosition(){return new XM(this.x,this.y)}static fromDummyObject(t){const e=new qM,r=t.colladaId.match(this.NODE_NAME_REGEX);if(!r)throw new Error("Invalid checkpoint dummy");return e.x=t.position.x,e.y=t.position.y,e.radius=+r[2],e}}qM.NODE_NAME_REGEX=/^node-maphelper_checkpoint_(\d+)_r(\d+)$/;class YM{constructor(t,e,r,n,i){this.scene=t,this.checkpoints=e,this.polygon=r,this.roadCenterSpline=n,this.startPositions=i}}class ZM{constructor(){this.outerPolygon=[[-2048,-2048],[2048,-2048],[2048,2048],[-2048,2048]],this.innerPolygons=[]}isContainingPoint(t){if(!la.isPointInsidePolygon(t,this.outerPolygon))return!1;for(let e of this.innerPolygons)if(la.isPointInsidePolygon(t,e))return!1;return!0}getLinePolygonIntersection(t,e){let r=this.isContainingPoint(t)?t:e,n=r===t?e:t;for(;la.getDistanceBetweenPoints(r,n)>.05;){let t=la.getMiddlePoint(r,n);this.isContainingPoint(t)?r=t:n=t}return la.getMiddlePoint(r,n)}static fromDummyObject(t){return new ZM}}class JM{constructor(t,e){this.position=t,this.rotation=e}}var QM=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},KM=PIXI.Point;class $M{constructor(){}loadCar(t){return QM(this,void 0,void 0,function*(){const e=$M.CARS_CACHE.get(t);if(e)return console.log("Car loaded from cache"),e.clone();const r=yield this.loadColladaScene(`cars/${t}/`,"body");return $M.CARS_CACHE.set(t,r.scene),r.scene})}loadMap(t){return QM(this,void 0,void 0,function*(){const e=yield this.loadColladaScene(`maps/${t}/`,"scene"),r=[],n=new ZM,i=[];let o;for(let t=0;t<e.scene.children.length;t++){let s=!1;const a=e.scene.children[t];if(a.colladaId){const t=a.colladaId.match(qM.NODE_NAME_REGEX);t&&(r[+t[1]]=qM.fromDummyObject(a),s=!0);const e=a.colladaId.match($M.POSITION_NODE_REGEX);e&&(i[+e[1]]=new JM(new ea.Vector2(a.position.x,a.position.y),a.rotation.z),s=!0),a.colladaId.match($M.ROAD_CENTER_NODE_REGEX)&&(o=this.parseSpline(a).map(t=>new KM(t.x,t.y)),s=!0);const l=a.colladaId.match($M.POLYGON_NODE_REGEX);l&&("outer"===l[1]?n.outerPolygon=this.parseSpline(a).map(t=>[t.x,t.y]):"inner"===l[1]&&n.innerPolygons.push(this.parseSpline(a).map(t=>[t.x,t.y])),s=!0)}else s=!0;s&&(e.scene.remove(a),t--)}return e.scene.traverse(function(t){t instanceof ea.Mesh&&(t.parent&&"cliffs"===t.parent.name?(t.material.color=new ea.Color(.68,.67,.65),t.material.bumpScale=.3):t.parent&&"tonnels_arc"===t.parent.name?(t.material.color=new ea.Color(.68,.67,.65),t.material.bumpScale=.25):t.parent&&"bridge01"===t.parent.name&&(t.material.color=new ea.Color(.76,.76,.66),t.material.specular=new ea.Color(0,0,0),t.material.bumpScale=.1))}),new YM(e.scene,r,n,o,i)})}parseSpline(t){const e=new ea.Vector3;let r=t;for(;r&&!r.geometry;)r.position&&e.add(r.position),r=r.children[0];return r.position&&e.add(r.position),r.geometry.vertices.map(t=>{const r=t.clone();return r.add(e),r})}loadColladaScene(t,e="scene"){return QM(this,void 0,void 0,function*(){return new Promise((r,n)=>{setTimeout(()=>QM(this,void 0,void 0,function*(){WM().load(`${$M.PREFIX}${t}${e}.dae`,t=>QM(this,void 0,void 0,function*(){yield this.waitForAllContentLoaded(),r(t)}))}),15)})})}waitForAllContentLoaded(){return QM(this,void 0,void 0,function*(){return new Promise((t,e)=>{ea.DefaultLoadingManager.onProgress=function(e,r,n){r===n&&t()},ea.DefaultLoadingManager.onError=function(t,r,n){e()}})})}}function tA(t){return class extends t{constructor(...t){super(...t),this.displayListValid=!1,this._unscaledWidth=0,this._unscaledHeight=0}getUnscaledWidth(){return this._unscaledWidth}setUnscaledWidth(t){this._unscaledWidth!==t&&(this._unscaledWidth=t,this.invalidateDisplayList())}getUnscaledHeight(){return this._unscaledHeight}setUnscaledHeight(t){this._unscaledHeight!==t&&(this._unscaledHeight=t,this.invalidateDisplayList())}getSmallSide(){return Math.min(this.getUnscaledWidth(),this.getUnscaledHeight())}invalidateDisplayList(){this.displayListValid=!1}validateDisplayList(){return!this.displayListValid&&(this.updateDisplayList(),this.displayListValid=!0,!0)}updateDisplayList(){}on(t,e,r){return super.on(t,e,r)}off(t,e,r){return super.off(t,e,r)}set x(t){super.x!==t&&(super.x=t,this.emit("moved"))}set y(t){super.y!==t&&(super.y=t,this.emit("moved"))}set rotation(t){super.rotation!==t&&(super.rotation=t,this.emit("rotated"))}}}$M.PREFIX="assets/models/",$M.CARS_CACHE=new Map,$M.POLYGON_NODE_REGEX=/^node-maphelper_polygon_(outer|inner)$/,$M.POSITION_NODE_REGEX=/^node-maphelper_player-position_(\d+)$/,$M.ROAD_CENTER_NODE_REGEX=/^node-maphelper_road-center$/;const eA=tA(PIXI.Container);class rA extends eA{constructor(){super()}validateDisplayList(){if(!this.children||0===this.children.length)return!1;let t=super.validateDisplayList();for(const e of this.children)t=e.validateDisplayList()||t;return t}updateDisplayList(){}addChild(t){const e=super.addChild(t);return this.onChildAdded(e),e}addChildAt(t,e){const r=super.addChildAt(t,e);return this.onChildAdded(r),r}removeChild(t){const e=super.removeChild(t);return this.onChildRemoved(e),e}removeChildAt(t){const e=super.removeChildAt(t);return this.onChildRemoved(e),e}removeChildren(t,e){const r=super.removeChildren(t,e);return r.forEach(t=>this.onChildRemoved(t)),r}onChildAdded(t){t.on("moved",this.invalidateDisplayList,this),t.on("rotated",this.invalidateDisplayList,this)}onChildRemoved(t){t.off("moved",this.invalidateDisplayList,this),t.off("rotated",this.invalidateDisplayList,this)}}class nA{constructor(){}setMyCar(t){this.myCar=t}createCanvas(t){return this.renderer=ia.autoDetectRenderer(window.innerWidth,window.innerHeight,{antialias:!0,resolution:1,transparent:!0}),this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight,this.renderer.view.style.position="absolute",this.renderer.view.style.display="block",t.nativeElement.appendChild(this.renderer.view),this.canvasStage=new rA,requestAnimationFrame(this._renderPixiStageRoutine.bind(this)),this.renderer.view}_renderPixiStageRoutine(){requestAnimationFrame(this._renderPixiStageRoutine.bind(this)),this.canvasStage.validateDisplayList()&&this.renderer.render(this.canvasStage)}resizeCanvas(t,e){this.canvasStage&&this.renderer&&(this.canvasWidth!=t||this.canvasHeight!=e)&&(this.renderer.resize(t,e),this.canvasWidth=t,this.canvasHeight=e,this.canvasStage.invalidateDisplayList())}addChild(t){this.canvasStage.addChild(t)}}const iA=tA(PIXI.Graphics);class oA extends iA{}var sA=PIXI.Point;class aA extends oA{set mapData(t){this._mapData=t,this.invalidateDisplayList()}set scalingSquare(t){this._scalingSquare=t,this.invalidateDisplayList()}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(8,16777215);const t=this._mapData.roadCenterSpline.map(t=>new sA((t.x-this._scalingSquare.x)*this.getUnscaledWidth()/this._scalingSquare.width,(this._scalingSquare.y-t.y)*this.getUnscaledHeight()/this._scalingSquare.height+this.getUnscaledHeight()));t.push(t[0]),this.drawPolygon(t);const e=(la.getAngleBetweenPoints(t[0],t[1])+la.getAngleBetweenPoints(t[t.length-2],t[0]))/2;this.lineStyle(4,16777215),this.moveTo(t[0].x+16*Math.cos(e+Math.PI/2),t[0].y+16*Math.sin(e+Math.PI/2)),this.lineTo(t[0].x-16*Math.cos(e+Math.PI/2),t[0].y-16*Math.sin(e+Math.PI/2))}}class lA extends oA{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawRect(0,0,this.getUnscaledWidth(),this.getUnscaledHeight()),this.endFill()}}class cA extends oA{set color(t){this._color!==t&&(this._color=t,this.invalidateDisplayList())}set size(t){this._size!==t&&(this._size=t,this.invalidateDisplayList())}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,0),this.beginFill(this._color),this.drawCircle(0,0,this._size),this.endFill()}}var uA=PIXI.Rectangle,hA=PIXI.Point;class dA extends rA{constructor(t){super(),this.cars=[],this.carListeners=new Map,this.mapData=t,this.background=new lA,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.calculateScalingSquare(),this.trackSpline=new aA,this.trackSpline.setUnscaledWidth(this.getUnscaledWidth()),this.trackSpline.setUnscaledHeight(this.getUnscaledHeight()),this.trackSpline.mapData=this.mapData,this.trackSpline.scalingSquare=this.scalingSquare,this.addChild(this.trackSpline)}setUnscaledWidth(t){super.setUnscaledWidth(t),this.background.setUnscaledWidth(t),this.trackSpline.setUnscaledWidth(t)}setUnscaledHeight(t){super.setUnscaledHeight(t),this.background.setUnscaledHeight(t),this.trackSpline.setUnscaledHeight(t)}calculateScalingSquare(){const t=new hA(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),e=new hA(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);this.mapData.roadCenterSpline.forEach(r=>{t.x=Math.min(t.x,r.x),t.y=Math.min(t.y,r.y),e.x=Math.max(e.x,r.x),e.y=Math.max(e.y,r.y)});const r=new hA(e.x-t.x,e.y-t.y);this.scalingSquare=new uA(t.x-.1*r.x,t.y-.1*r.y,1.2*r.x,1.2*r.y),this.scalingSquare.width/this.scalingSquare.height>1?(this.scalingSquare.y-=(this.scalingSquare.width-this.scalingSquare.height)/2,this.scalingSquare.height+=this.scalingSquare.width-this.scalingSquare.height):(this.scalingSquare.x-=(this.scalingSquare.height-this.scalingSquare.width)/2,this.scalingSquare.width+=this.scalingSquare.height-this.scalingSquare.width)}addCar(t,e=!1){const r=new cA;r.color=dA.CAR_COLORS[Math.floor(Math.random()*dA.CAR_COLORS.length)],r.size=e?8:5;const n=t.getPosition();r.x=(n.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-n.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight(),this.addChild(r);const i=t.positionChangedSubject.subscribe(t=>{r.x=(t.x-this.scalingSquare.x)*this.getUnscaledWidth()/this.scalingSquare.width,r.y=(this.scalingSquare.y-t.y)*this.getUnscaledHeight()/this.scalingSquare.height+this.getUnscaledHeight()});this.cars.push(t),this.carListeners.set(t.id,{indicator:r,positionChangedSub:i})}dispose(){for(const t of this.cars)this.removeChild(this.carListeners.get(t.id).indicator),this.carListeners.get(t.id).positionChangedSub.unsubscribe(),this.carListeners.delete(t.id);this.cars=[]}}dA.CAR_COLORS=[4357620,12465647,14679099,14679099,14679099,49775,16583698,8375620];class pA extends oA{updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(2,16777215),this.beginFill(0,.3),this.drawCircle(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,this.getSmallSide()/2),this.endFill()}}var fA=PIXI.Text;class mA extends oA{constructor(t=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=t}get maxSpeed(){return this._maxSpeed}set maxSpeed(t){t=20*Math.ceil(t/20),this._maxSpeed!==t&&(this._maxSpeed=t,this._divisionsCount=t/20+1,this.updateChildren(),this.invalidateDisplayList())}set currentSpeed(t){t=Math.min(this.maxSpeed,t),this._currentSpeed!==t&&(this._currentSpeed=t,this.invalidateDisplayList())}setUnscaledWidth(t){super.setUnscaledWidth(t),this.updateChildren()}setUnscaledHeight(t){super.setUnscaledHeight(t),this.updateChildren()}updateChildren(){this.removeChildren();for(let t=0;t<this._divisionsCount;t++){const e=this.startAngle+t*(this.endAngle-this.startAngle)/(this._divisionsCount-1),r=20*t,n=new ca(.875*this.getSmallSide()/2,e).cartesianPoint,i=new fA(r.toString(),{fontFamily:"Lucida Console",fontSize:18,fontWeight:"bold",fill:r<=this._currentSpeed?mA.CURRENT_SPEED_COLOR:16777215,align:"center"});i.anchor.x=i.anchor.y=.5,i.x=n.x+this.getUnscaledWidth()/2,i.y=n.y+this.getUnscaledHeight()/2,this.addChild(i)}}updateDisplayList(){super.updateDisplayList();const t=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle);this.clear(),this.lineStyle(2,mA.CURRENT_SPEED_COLOR),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,this.startAngle,t),this.lineStyle(2,16777215),this.arc(this.getUnscaledWidth()/2,this.getUnscaledHeight()/2,.65*this.getSmallSide()/2,t,this.endAngle);for(let e=0;e<=4*(this._divisionsCount-1);e++){const r=e%4==0,n=e%2==0,i=this.startAngle+e*(this.endAngle-this.startAngle)/(this._divisionsCount-1)/4,o=new ca(.65*this.getSmallSide()/2,i).cartesianPoint,s=new ca((r?.75:n?.72:.69)*this.getSmallSide()/2,i).cartesianPoint;this.lineStyle(2,i>t?16777215:mA.CURRENT_SPEED_COLOR),this.moveTo(o.x+this.getUnscaledWidth()/2,o.y+this.getUnscaledHeight()/2),this.lineTo(s.x+this.getUnscaledWidth()/2,s.y+this.getUnscaledHeight()/2)}for(let e of this.children)e.style.fill=+e.text<=this._currentSpeed?mA.CURRENT_SPEED_COLOR:16777215}}mA.CURRENT_SPEED_COLOR=16738137;var vA=PIXI.Point;class gA extends oA{constructor(t=320){super(),this.startAngle=3*Math.PI/4,this.endAngle=9*Math.PI/4,this.maxSpeed=t}get maxSpeed(){return this._maxSpeed}set maxSpeed(t){t=20*Math.ceil(t/20),this._maxSpeed!==t&&(this._maxSpeed=t,this.rotation=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle))}set currentSpeed(t){t=Math.min(1.05*this.maxSpeed,t),this._currentSpeed!==t&&(this._currentSpeed=t,this.rotation=this.startAngle+this._currentSpeed/this.maxSpeed*(this.endAngle-this.startAngle))}updateDisplayList(){super.updateDisplayList(),this.clear(),this.lineStyle(1,3355443),this.beginFill(4357620,1),this.drawPolygon([new vA(-.05*this.getSmallSide(),0),new vA(0,.02*this.getSmallSide()),new vA(.35*this.getSmallSide(),.005*this.getSmallSide()),new vA(.4*this.getSmallSide(),0),new vA(.35*this.getSmallSide(),-.005*this.getSmallSide()),new vA(0,-.02*this.getSmallSide()),new vA(-.05*this.getSmallSide(),0)]),this.endFill()}}class yA extends rA{setUnscaledWidth(t){super.setUnscaledWidth(t),this.background.setUnscaledWidth(t),this.dials.setUnscaledWidth(t),this.arrow.setUnscaledWidth(t),this.arrow.x=t/2}setUnscaledHeight(t){super.setUnscaledHeight(t),this.background.setUnscaledHeight(t),this.dials.setUnscaledHeight(t),this.arrow.setUnscaledHeight(t),this.arrow.y=t/2}constructor(t){super(),this.car=t,this.background=new pA,this.background.setUnscaledWidth(this.getUnscaledWidth()),this.background.setUnscaledHeight(this.getUnscaledHeight()),this.addChild(this.background),this.dials=new mA,this.dials.setUnscaledWidth(this.getUnscaledWidth()),this.dials.setUnscaledHeight(this.getUnscaledHeight()),this.dials.currentSpeed=3.6*t.speed,this.addChild(this.dials),this.arrow=new gA,this.arrow.setUnscaledWidth(this.getUnscaledWidth()),this.arrow.setUnscaledHeight(this.getUnscaledHeight()),this.arrow.currentSpeed=3.6*t.speed,this.arrow.x=this.getUnscaledWidth()/2,this.arrow.y=this.getUnscaledHeight()/2,this.addChild(this.arrow),t.speedChangedSubject.subscribe(t=>{this.dials.currentSpeed=3.6*t,this.arrow.currentSpeed=3.6*t})}}var xA=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};class bA{constructor(t,e,r,n,i,o,s,a){this.canvasService=t,this.socketService=e,this.loginService=r,this.carService=n,this.ngZone=i,this.modelLoaderService=o,this.controlService=s,this.router=a,window.onresize=(t=>{this.ngZone.run(()=>{this.resizeCanvas(window.innerWidth,window.innerHeight)})})}resizeCanvas(t,e){this.canvasService.resizeCanvas(t,e),this.stage3d.resizeCanvas(t,e),this.miniMap.y=e-320,this.speedometer.x=t-320,this.speedometer.y=e-320}initGameplay(t,e,r){return xA(this,void 0,void 0,function*(){this.isWaitingPlayers=!0,this.isLoadingMap=!0,this.stage3d=e,this.cars=new Map,this.myCarId=r.id,this.stepsCount=0,r.ready||(yield r.initMesh(this.modelLoaderService,!0));let n=yield this.modelLoaderService.loadMap("default-map");console.log(n),this.cars.set(r.id,r);const i=this.canvasService.createCanvas(t);this.canvasService.setMyCar(r),this.stage3d.addCar(r,!0),this.stage3d.addMap(n.scene,!0),this.controlService.initControls(this.stage3d,r),this.mapPolygon=n.polygon,this.checkpoints=n.checkpoints,this.miniMap=new dA(n),this.miniMap.setUnscaledWidth(300),this.miniMap.setUnscaledHeight(300),this.miniMap.x=20,this.miniMap.y=i.height-320,this.miniMap.addCar(r,!0),this.canvasService.addChild(this.miniMap),this.speedometer=new yA(r),this.speedometer.setUnscaledWidth(300),this.speedometer.setUnscaledHeight(300),this.speedometer.x=i.width-320,this.speedometer.y=i.height-320,this.canvasService.addChild(this.speedometer),this.isLoadingMap=!1})}startGame(){return xA(this,void 0,void 0,function*(){const t=this.loginService.currentUser;if(!t)return this.socketService.socketAvailable()&&this.socketService.disconnect(),console.warn("no user on game start"),this.router.navigate(["login"]);this.socketService.stepSubject.subscribe(t=>this.onStepComplete(t.map(t=>(t.trajectory&&(t.trajectory=new ha(t.trajectory.l,t.trajectory.c)),t)))),this.socketService.readyToStart({id:this.myCarId,name:t.login})})}onStepComplete(t){return xA(this,void 0,void 0,function*(){this.stepsCount++,this.stepsCount>1&&(this.stage3d.startWorldRenderingLoop(),yield this.playAnimations(t),this.stage3d.stopWorldRenderingLoop()),this.startNewIteration(t).then()})}playAnimations(t){return xA(this,void 0,void 0,function*(){const e=new Map,r=new Map;for(let i of t){let t=this.cars.get(i.id);t&&i.trajectory&&e.set(i.id,{rotation:t.rotation,position:t.getPosition(),speed:t.speed})}const n=(new Date).getTime();return new Promise(i=>{const o=this.stage3d.beforeWorldRenderSubject.subscribe(()=>{const s=((new Date).getTime()-n)/1e3;if(s>=1)o.unsubscribe(),i();else{for(let n of t){if(r.has(n.id))continue;let t=this.cars.get(n.id),i=e.get(n.id);if(t&&n.trajectory&&i){const e=new ha(ya.getDistanceInUniformlyAcceleratedMotion(i.speed,n.acceleration,s),n.trajectory.c);if(Math.abs(e.l)>=Math.abs(n.trajectory.l))r.set(n.id,!0),t.setPosition(n.finalCarProperties.position),t.setRotation(n.finalCarProperties.rotation),t.speed=n.finalCarProperties.speed;else{const r=e.polarPosition;r.theta+=i.rotation;const o=r.cartesianPoint;o.x+=i.position.x,o.y+=i.position.y,t.setPosition(o),t.setRotation(i.rotation+e.pointerRotation),t.speed=n.trajectory.l<0?0:ya.getSpeedInUniformlyAcceleratedMotion(i.speed,n.acceleration,s)}}}this.controlService.updateCameraDistance()}this.stage3d.animateCamera()})})})}startNewIteration(t){return xA(this,void 0,void 0,function*(){if(!this.myCarId&&0!==this.myCarId||!this.cars.get(this.myCarId))return void console.log('Don\'t have "myCar" for arc functionality :(');this.isWaitingPlayers&&(this.isWaitingPlayers=!1);for(let s of t){let t=this.cars.get(s.id);t?(t.setPosition(s.finalCarProperties.position),t.setRotation(s.finalCarProperties.rotation),t.speed=s.finalCarProperties.speed):(yield(t=new HM(s.id,"lambo",new zM,s.finalCarProperties.position.x,s.finalCarProperties.position.y,s.finalCarProperties.rotation,s.finalCarProperties.speed)).initMesh(this.modelLoaderService,!0),this.stage3d.addCar(t),this.miniMap.addCar(t),this.cars.set(t.id,t))}let e,r,n,i=this.cars.get(this.myCarId),o=0;this.mapPolygon.isContainingPoint(i.getPosition())?(e=Math.max(0,this.getMinDistanceOnNextStep(i)),r=this.getMaxDistanceOnNextStep(i),o=i.speed,n=i.characteristics.getSteeringMaxCurvature(i.speed)):(e=0,r=this.getMaxDistanceOnNextStep(i,0),o=0,n=i.characteristics.getSteeringMaxCurvature(0)),console.log("####"),console.log(`min speed: ${e} m/s; ${3.6*e} km/h`),console.log(`max speed: ${r} m/s; ${3.6*r} km/h`),console.log(`cur speed: ${o} m/s; ${3.6*o} km/h`),console.log(`maxSteeringCurvature: ${n}`),Math.abs(o)<.25&&(e=-r+Math.abs(o)),this.controlService.updateCameraDistance(),this.controlService.adjustControlPositions(),this.stage3d.animateCamera(),this.stage3d.renderWorldOnce(),this.controlService.askForSelectedPosition(e,r,o,n).then(t=>{const e=t.polarPosition;e.theta+=i.rotation;const r=e.cartesianPoint;r.x+=i.x,r.y+=i.y;const n={id:i.id,finalCarProperties:{position:i.getPosition(),rotation:i.rotation,speed:i.speed},trajectory:t,acceleration:ya.getAccelerationInUniformlyAcceleratedMotion(i.speed,t.l,1)};let o=t.breakToSegments().map(t=>{const e=ca.fromCartesian(t);return e.theta+=i.rotation,(t=e.cartesianPoint).x+=i.x,t.y+=i.y,t});for(let s=0;s<o.length;s++){const e=o[s];if(!this.mapPolygon.isContainingPoint(e)){let e=this.mapPolygon.getLinePolygonIntersection(s>0?o[s-1]:i.getPosition(),o[s]),r=Math.min(.1,la.getDistanceBetweenPoints(i.getPosition(),e)),a=la.getAngleBetweenPoints(e,i.getPosition());return n.finalCarProperties.speed=0,n.finalCarProperties.position.x=e.x+Math.cos(a)*r,n.finalCarProperties.position.y=e.y+Math.sin(a)*r,la.getDistanceBetweenPoints(i.getPosition(),n.finalCarProperties.position)>.01?(n.finalCarProperties.rotation+=s*(t.pointerRotation/o.length),n.trajectory=new ha(t.l*s/o.length,t.c)):n.trajectory=new ha(0,0),void this.socketService.nextStep(n)}if(this.checkpoints&&this.checkpoints.length>0&&la.getDistanceBetweenPoints(e,this.checkpoints[0].getPosition())<this.checkpoints[0].radius&&(this.checkpoints.shift(),0==this.checkpoints.length))return void this.socketService.finished(this.stepsCount)}n.finalCarProperties.speed=Math.max(0,ya.getSpeedInUniformlyAcceleratedMotionByDistance(i.speed,t.l,1)),n.finalCarProperties.rotation+=t.pointerRotation,n.finalCarProperties.position=r,this.socketService.nextStep(n)})})}getMinDistanceOnNextStep(t,e=t.speed){return ya.getDistanceInUniformlyAcceleratedMotion(e,-t.characteristics.getMaxDeceleration(e),1)}getMaxDistanceOnNextStep(t,e=t.speed){return ya.getDistanceInUniformlyAcceleratedMotion(e,t.characteristics.getMaxAcceleration(e),1)}setRaceResults(t){this.raceResults=t}getLastRaceResults(){return this.raceResults}}class wA{constructor(t,e,r,n){this.gameplayService=t,this.router=e,this.socketService=r,this.carService=n}ngOnInit(){const t=this.carService.selectedCar;if(!t)return console.warn("car is not selected"),this.router.navigate(["selectCars"]);if(!this.socketService.socketAvailable())return console.warn("No socket is open on game start"),this.router.navigate(["menu"]);const e=HM.fromDTO(t);this.gameplayService.initGameplay(this.canvasContainer,this.stage3d,e).then(()=>{this.gameplayService.startGame(),this.socketService.finishSubject.subscribe(t=>{this.gameplayService.setRaceResults(t),this.router.navigate(["finish"])})})}checkIfLoadingMap(){return this.gameplayService.isLoadingMap}chechIfWaitingPlayers(){return this.gameplayService.isWaitingPlayers}}var _A=i._1({encapsulation:0,styles:[[".screen-centered-container[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:0;left:0;right:0;bottom:0}.full-screen[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.click-through[_ngcontent-%COMP%]{pointer-events:none}.loading-h[_ngcontent-%COMP%]{text-align:center}.invisible[_ngcontent-%COMP%]{display:none}"]],data:{}});function SA(t){return i._21(0,[(t()(),i._3(0,0,null,null,7,"div",[["class","screen-centered-container"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(2,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),i._20(-1,null,["\n      "])),(t()(),i._3(4,0,null,null,1,"h1",[["class","loading-h"]],null,null,null,null,null)),(t()(),i._20(5,null,["\n        ","\n      "])),(t()(),i._20(-1,null,["\n    "])),(t()(),i._20(-1,null,["\n  "]))],null,function(t,e){t(e,5,0,e.component.checkIfLoadingMap()?"Loading map":"Waiting other players")})}function TA(t){return i._21(0,[i._18(402653184,1,{canvasContainer:0}),i._18(402653184,2,{stage3d:0}),(t()(),i._3(2,0,null,null,14,"div",[],null,null,null,null,null)),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(5,0,null,null,2,"stage-3d",[["class","full-screen"]],[[2,"invisible",null]],null,null,Xx,Wx)),i._2(6,4308992,[[2,4],["stage3d",4]],0,Hx,[wa],null,null),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(10,0,[[1,0],["canvasContainer",1]],null,1,"div",[["class","full-screen click-through"]],[[2,"invisible",null]],null,null,null,null)),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i.Y(16777216,null,null,1,null,SA)),i._2(15,16384,null,0,at,[i.M,i.J],{ngIf:[0,"ngIf"]},null),(t()(),i._20(-1,null,["\n"])),(t()(),i._20(-1,null,["\n"]))],function(t,e){var r=e.component;t(e,6,0),t(e,15,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())},function(t,e){var r=e.component;t(e,5,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers()),t(e,10,0,r.checkIfLoadingMap()||r.chechIfWaitingPlayers())})}var MA=i.Z("page-gameplay",wA,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"page-gameplay",[],null,null,null,TA,_A)),i._2(1,114688,null,0,wA,[bA,is,js,Zs],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),AA=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})};class EA{constructor(t,e,r,n){this.router=t,this.gameplayService=e,this.lobbyService=r,this.socketService=n,this.messageText=e.getLastRaceResults()?"Congratulations! You won the race!":"Good luck next time!"}tryAgain(){this.lobbyService.quickStart().subscribe(t=>AA(this,void 0,void 0,function*(){try{yield this.socketService.connectToLobby(t.serverUrl),this.router.navigate(["/selectCars"])}catch(t){console.log("Can't connect to lobby"),console.error(t)}}))}}var CA=i._1({encapsulation:0,styles:[["finish-screen[_ngcontent-%COMP%]{background-color:#fff}.finish-content[_ngcontent-%COMP%]{width:500px;height:70%;margin:0 auto;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.finish-message[_ngcontent-%COMP%]{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.finish-text[_ngcontent-%COMP%]{color:gray}.finish-button[_ngcontent-%COMP%]{width:60%;margin:20px auto!important;-ms-flex-pack:distribute;justify-content:space-around;-ms-flex-item-align:center;align-self:center;display:-webkit-box;display:-ms-flexbox;display:flex}"]],data:{}});function PA(t){return i._21(0,[(t()(),i._3(0,0,null,null,18,"div",[],null,null,null,null,null)),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(2,0,null,null,15,"div",[["class","finish-content"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n    "])),(t()(),i._3(4,0,null,null,12,"div",[["class","finish-message"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n      "])),(t()(),i._3(6,0,null,null,1,"h1",[["class","finish-text"]],null,null,null,null,null)),(t()(),i._20(7,null,["",""])),(t()(),i._20(-1,null,["\n      "])),(t()(),i._3(9,0,null,null,1,"button",[["class","finish-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.tryAgain()&&n),n},null,null)),(t()(),i._20(-1,null,["Race again"])),(t()(),i._20(-1,null,["\n      "])),(t()(),i._3(12,0,null,null,3,"button",[["class","finish-button"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==i._14(t,13).onClick()&&n),n},null,null)),i._2(13,16384,null,0,as,[is,xo,[8,null],i.B,i.k],{routerLink:[0,"routerLink"]},null),i._16(14,1),(t()(),i._20(-1,null,["Go to menu"])),(t()(),i._20(-1,null,["\n    "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._20(-1,null,["\n"])),(t()(),i._20(-1,null,["\n\n"]))],function(t,e){t(e,13,0,t(e,14,0,"menu"))},function(t,e){t(e,7,0,e.component.messageText)})}var OA=i.Z("finish-screen",EA,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"finish-screen",[],null,null,null,PA,CA)),i._2(1,49152,null,0,EA,[is,bA,Vs,js],null,null)],null,null)},{},{},[]);class NA{constructor(t,e,r,n){this.loginService=t,this.carService=e,this.fb=r,this.router=n}onLoginClick(t,e){this.loginService.login(t,e).subscribe(t=>{this.router.navigate(["/menu"])},t=>{console.error(t)})}onFacebookLoginClick(){this.fb.login().then(t=>console.log(t)).catch(t=>console.error(t))}onSignupClick(t,e){console.log(t,e),this.loginService.createUser(t,e).subscribe(t=>{console.log(JSON.stringify(t))},t=>{console.error(t)})}}var LA=i._1({encapsulation:0,styles:[[".main-container[_ngcontent-%COMP%]{width:100vw;height:100vh;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.button-login[_ngcontent-%COMP%]{max-width:300px;width:60%;margin-bottom:20px;text-align:center}.login[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.login[_ngcontent-%COMP%]   .login-form[_ngcontent-%COMP%]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center}"]],data:{}});function IA(t){return i._21(0,[(t()(),i._3(0,0,null,null,14,"div",[["class","main-container login"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n\n  "])),(t()(),i._3(2,0,[["username",1]],null,0,"input",[["class","button-login"],["id","username"],["placeholder","Username"],["type","text"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n\n  "])),(t()(),i._3(4,0,[["pass",1]],null,0,"input",[["class","button-login"],["id","pass"],["placeholder","Password"],["type","password"]],null,null,null,null,null)),(t()(),i._20(-1,null,["\n\n  "])),(t()(),i._3(6,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onLoginClick(i._14(t,2).value,i._14(t,4).value)&&n),n},null,null)),(t()(),i._20(-1,null,["\n    Log in\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(9,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onFacebookLoginClick()&&n),n},null,null)),(t()(),i._20(-1,null,["\n    Log in with facebook\n  "])),(t()(),i._20(-1,null,["\n  "])),(t()(),i._3(12,0,null,null,1,"button",[["class","button-login"]],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.onSignupClick(i._14(t,2).value,i._14(t,4).value)&&n),n},null,null)),(t()(),i._20(-1,null,["\n    Sign Up\n  "])),(t()(),i._20(-1,null,["\n\n"])),(t()(),i._20(-1,null,["\n"]))],null,null)}var RA=i.Z("page-login",NA,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"page-login",[],null,null,null,IA,LA)),i._2(1,49152,null,0,NA,[Ds,Zs,T,is],null,null)],null,null)},{},{},[]),DA=i._1({encapsulation:0,styles:[[""]],data:{}});function FA(t){return i._21(0,[(t()(),i._3(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),i._2(1,212992,null,0,hs,[us,i.M,i.j,[8,null],i.h],null,null),(t()(),i._20(-1,null,["\n"]))],function(t,e){t(e,1,0)},null)}var kA=i.Z("app-root",A,function(t){return i._21(0,[(t()(),i._3(0,0,null,null,1,"app-root",[],null,null,null,FA,DA)),i._2(1,49152,null,0,A,[T],null,null)],null,null)},{},{},[]);class UA{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class BA extends UA{get formDirective(){return null}get path(){return null}}function jA(t){return null==t||0===t.length}new i.o("NgValidators"),new i.o("NgAsyncValidators");const zA=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;class VA{static min(t){return e=>{if(jA(e.value)||jA(t))return null;const r=parseFloat(e.value);return!isNaN(r)&&r<t?{min:{min:t,actual:e.value}}:null}}static max(t){return e=>{if(jA(e.value)||jA(t))return null;const r=parseFloat(e.value);return!isNaN(r)&&r>t?{max:{max:t,actual:e.value}}:null}}static required(t){return jA(t.value)?{required:!0}:null}static requiredTrue(t){return!0===t.value?null:{required:!0}}static email(t){return zA.test(t.value)?null:{email:!0}}static minLength(t){return e=>{if(jA(e.value))return null;const r=e.value?e.value.length:0;return r<t?{minlength:{requiredLength:t,actualLength:r}}:null}}static maxLength(t){return e=>{const r=e.value?e.value.length:0;return r>t?{maxlength:{requiredLength:t,actualLength:r}}:null}}static pattern(t){if(!t)return VA.nullValidator;let e,r;return"string"==typeof t?(r="","^"!==t.charAt(0)&&(r+="^"),r+=t,"$"!==t.charAt(t.length-1)&&(r+="$"),e=new RegExp(r)):(r=t.toString(),e=t),t=>{if(jA(t.value))return null;const n=t.value;return e.test(n)?null:{pattern:{requiredPattern:r,actualValue:n}}}}static nullValidator(t){return null}static compose(t){if(!t)return null;const e=t.filter(GA);return 0==e.length?null:function(t){return WA(function(t,r){return e.map(e=>e(t))}(t))}}static composeAsync(t){if(!t)return null;const e=t.filter(GA);return 0==e.length?null:function(t){const r=function(t,r){return e.map(e=>e(t))}(t).map(HA);return V.call(fb(r),WA)}}}function GA(t){return null!=t}function HA(t){const e=Object(i._9)(t)?Ze(t):t;if(!Object(i._8)(e))throw new Error("Expected validator to return Promise or Observable.");return e}function WA(t){const e=t.reduce((t,e)=>null!=e?Object.assign({},t,e):t,{});return 0===Object.keys(e).length?null:e}new i.o("NgValueAccessor"),Object(i.R)(()=>XA);class XA{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}Object(i.R)(()=>qA),new i.o("CompositionEventMode");class qA{constructor(t,e,r){this._renderer=t,this._elementRef=e,this._compositionMode=r,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=xr()?xr().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}function YA(t){return t.validate?e=>t.validate(e):t}function ZA(t){return t.validate?e=>t.validate(e):t}Object(i.R)(()=>JA);class JA{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=(e=>{t(""==e?null:parseFloat(e))})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}function QA(){throw new Error("unimplemented")}class KA extends UA{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null,this._rawValidators=[],this._rawAsyncValidators=[]}get validator(){return QA()}get asyncValidator(){return QA()}}Object(i.R)(()=>tE);class $A{constructor(){this._accessors=[]}add(t,e){this._accessors.push([t,e])}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}select(t){this._accessors.forEach(e=>{this._isSameGroup(e,t)&&e[1]!==t&&e[1].fireUncheck(t.value)})}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}class tE{constructor(t,e,r,n){this._renderer=t,this._elementRef=e,this._registry=r,this._injector=n,this.onChange=(()=>{}),this.onTouched=(()=>{})}ngOnInit(){this._control=this._injector.get(KA),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=(()=>{t(this.value),this._registry.select(this)})}fireUncheck(t){this.writeValue(t)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_checkName(){this.name&&this.formControlName&&this.name!==this.formControlName&&this._throwNameError(),!this.name&&this.formControlName&&(this.name=this.formControlName)}_throwNameError(){throw new Error('\n      If you define both a name and a formControlName attribute on your radio button, their values\n      must match. Ex: <input type="radio" formControlName="food" name="food">\n    ')}}Object(i.R)(()=>eE);class eE{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}registerOnChange(t){this.onChange=(e=>{t(""==e?null:parseFloat(e))})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}Object(i.R)(()=>rE);class rE{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._compareWith=i._10}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const r=function(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",r)}registerOnChange(t){this.onChange=(e=>{this.value=this._getOptionValue(e),t(this.value)})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}Object(i.R)(()=>nE);class nE{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._compareWith=i._10}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const r=t.map(t=>this._getOptionId(t));e=((t,e)=>{t._setSelected(r.indexOf(e.toString())>-1)})}else e=((t,e)=>{t._setSelected(!1)});this._optionMap.forEach(e)}registerOnChange(t){this.onChange=(e=>{const r=[];if(e.hasOwnProperty("selectedOptions")){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const n=t.item(e),i=this._getOptionValue(n.value);r.push(i)}}else{const t=e.options;for(let e=0;e<t.length;e++){const n=t.item(e);if(n.selected){const t=this._getOptionValue(n.value);r.push(t)}}}this.value=r,t(r)})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}function iE(t,e){return[...e.path,t]}function oE(t,e){t||cE(e,"Cannot find control with"),e.valueAccessor||cE(e,"No value accessor for form control with"),t.validator=VA.compose([t.validator,e.validator]),t.asyncValidator=VA.composeAsync([t.asyncValidator,e.asyncValidator]),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(r=>{t._pendingValue=r,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&sE(t,e)})}(t,e),function(t,e){t.registerOnChange((t,r)=>{e.valueAccessor.writeValue(t),r&&e.viewToModelUpdate(t)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&sE(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),e.valueAccessor.setDisabledState&&t.registerOnDisabledChange(t=>{e.valueAccessor.setDisabledState(t)}),e._rawValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())}),e._rawAsyncValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())})}function sE(t,e){e.viewToModelUpdate(t._pendingValue),t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),t._pendingChange=!1}function aE(t,e){null==t&&cE(e,"Cannot find control with"),t.validator=VA.compose([t.validator,e.validator]),t.asyncValidator=VA.composeAsync([t.asyncValidator,e.asyncValidator])}function lE(t){return cE(t,"There is no FormControl instance attached to form control element with")}function cE(t,e){let r;throw r=t.path.length>1?`path: '${t.path.join(" -> ")}'`:t.path[0]?`name: '${t.path}'`:"unspecified name attribute",new Error(`${e} ${r}`)}function uE(t){return null!=t?VA.compose(t.map(YA)):null}function hE(t){return null!=t?VA.composeAsync(t.map(ZA)):null}function dE(t,e){if(!t.hasOwnProperty("model"))return!1;const r=t.model;return!!r.isFirstChange()||!Object(i._10)(e,r.currentValue)}const pE=[XA,eE,JA,rE,nE,tE];function fE(t,e){t._syncPendingControls(),e.forEach(t=>{const e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)})}function mE(t,e){if(!e)return null;let r=void 0,n=void 0,i=void 0;return e.forEach(e=>{e.constructor===qA?r=e:function(t){return pE.some(e=>t.constructor===e)}(e)?(n&&cE(t,"More than one built-in value accessor matches form control with"),n=e):(i&&cE(t,"More than one custom value accessor matches form control with"),i=e)}),i||n||r||(cE(t,"No valid value accessor for form control with"),null)}function vE(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}class gE extends BA{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return iE(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return uE(this._validators)}get asyncValidator(){return hE(this._asyncValidators)}_checkParentType(){}}const yE="VALID",xE="INVALID",bE="PENDING",wE="DISABLED";function _E(t){const e=TE(t)?t.validators:t;return Array.isArray(e)?uE(e):e||null}function SE(t,e){const r=TE(e)?e.asyncValidators:t;return Array.isArray(r)?hE(r):r||null}function TE(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class ME{constructor(t,e){this.validator=t,this.asyncValidator=e,this._onCollectionChange=(()=>{}),this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}get parent(){return this._parent}get valid(){return this.status===yE}get invalid(){return this.status===xE}get pending(){return this.status==bE}get disabled(){return this.status===wE}get enabled(){return this.status!==wE}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this.validator=_E(t)}setAsyncValidators(t){this.asyncValidator=SE(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=bE,this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){this.status=wE,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign({},t,{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(t),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){this.status=yE,this._forEachChild(e=>{e.enable(Object.assign({},t,{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(t),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==yE&&this.status!==bE||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wE:yE}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=bE;const e=HA(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>this.setErrors(e,{emitEvent:t}))}}_cancelExistingSubscription(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,r){return null==e?null:(e instanceof Array||(e=e.split(".")),e instanceof Array&&0===e.length?null:e.reduce((t,e)=>t instanceof EE?t.controls[e]||null:t instanceof CE&&t.at(e)||null,t))}(this,t)}getError(t,e){const r=e?this.get(e):this;return r&&r.errors?r.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new i.m,this.statusChanges=new i.m}_calculateStatus(){return this._allControlsDisabled()?wE:this.errors?xE:this._anyControlsHaveStatus(bE)?bE:this._anyControlsHaveStatus(xE)?xE:yE}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){TE(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}}class AE extends ME{constructor(t=null,e,r){super(_E(e),SE(r,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this._initObservables()}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_clearChangeFns(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=(()=>{})}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class EE extends ME{constructor(t,e,r){super(_E(e),SE(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){Object.keys(t).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t={},e={}){this._forEachChild((r,n)=>{r.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e),this._updatePristine(e),this._updateTouched(e)}getRawValue(){return this._reduceChildren({},(t,e,r)=>(t[r]=e instanceof AE?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>t(this.controls[e],e))}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){let e=!1;return this._forEachChild((r,n)=>{e=e||this.contains(n)&&t(r)}),e}_reduceValue(){return this._reduceChildren({},(t,e,r)=>((e.enabled||this.disabled)&&(t[r]=e.value),t))}_reduceChildren(t,e){let r=t;return this._forEachChild((t,n)=>{r=e(r,t,n)}),r}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,r)=>{if(void 0===t[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class CE extends ME{constructor(t,e,r){super(_E(e),SE(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,r)=>{this._throwIfControlMissing(r),this.at(r).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t.forEach((t,r)=>{this.at(r)&&this.at(r).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t=[],e={}){this._forEachChild((r,n)=>{r.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e),this._updatePristine(e),this._updateTouched(e)}getRawValue(){return this.controls.map(t=>t instanceof AE?t.value:t.getRawValue())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,r)=>{t(e,r)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,r)=>{if(void 0===t[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}Object(i.R)(()=>OE);const PE=Promise.resolve(null);class OE extends BA{constructor(t,e){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new i.m,this.form=new EE({},uE(t),hE(e))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){PE.then(()=>{const e=this._findContainer(t.path);t.control=e.registerControl(t.name,t.control),oE(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){PE.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name),vE(this._directives,t)})}addFormGroup(t){PE.then(()=>{const e=this._findContainer(t.path),r=new EE({});aE(r,t),e.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){PE.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,e){PE.then(()=>{this.form.get(t.path).setValue(e)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,fE(this.form,this._directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}const NE={formControlName:'\n    <div [formGroup]="myGroup">\n      <input formControlName="firstName">\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       firstName: new FormControl()\n    });',formGroupName:'\n    <div [formGroup]="myGroup">\n       <div formGroupName="person">\n          <input formControlName="firstName">\n       </div>\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       person: new FormGroup({ firstName: new FormControl() })\n    });',formArrayName:'\n    <div [formGroup]="myGroup">\n      <div formArrayName="cities">\n        <div *ngFor="let city of cityArray.controls; index as i">\n          <input [formControlName]="i">\n        </div>\n      </div>\n    </div>\n\n    In your class:\n\n    this.cityArray = new FormArray([new FormControl(\'SF\')]);\n    this.myGroup = new FormGroup({\n      cities: this.cityArray\n    });',ngModelGroup:'\n    <form>\n       <div ngModelGroup="person">\n          <input [(ngModel)]="person.name" name="firstName">\n       </div>\n    </form>',ngModelWithFormGroup:'\n    <div [formGroup]="myGroup">\n       <input formControlName="firstName">\n       <input [(ngModel)]="showMoreControls" [ngModelOptions]="{standalone: true}">\n    </div>\n  '};class LE{static modelParentException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroup directive.  Try using\n      formGroup's partner directive "formControlName" instead.  Example:\n\n      ${NE.formControlName}\n\n      Or, if you'd like to avoid registering this form control, indicate that it's standalone in ngModelOptions:\n\n      Example:\n\n      ${NE.ngModelWithFormGroup}`)}static formGroupNameException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroupName or formArrayName directive.\n\n      Option 1: Use formControlName instead of ngModel (reactive strategy):\n\n      ${NE.formGroupName}\n\n      Option 2:  Update ngModel's parent be ngModelGroup (template-driven strategy):\n\n      ${NE.ngModelGroup}`)}static missingNameException(){throw new Error('If ngModel is used within a form tag, either the name attribute must be set or the form\n      control must be defined as \'standalone\' in ngModelOptions.\n\n      Example 1: <input [(ngModel)]="person.firstName" name="first">\n      Example 2: <input [(ngModel)]="person.firstName" [ngModelOptions]="{standalone: true}">')}static modelGroupParentException(){throw new Error(`\n      ngModelGroup cannot be used with a parent formGroup directive.\n\n      Option 1: Use formGroupName instead of ngModelGroup (reactive strategy):\n\n      ${NE.formGroupName}\n\n      Option 2:  Use a regular form tag instead of the formGroup directive (template-driven strategy):\n\n      ${NE.ngModelGroup}`)}}Object(i.R)(()=>IE);class IE extends gE{constructor(t,e,r){super(),this._parent=t,this._validators=e,this._asyncValidators=r}_checkParentType(){this._parent instanceof IE||this._parent instanceof OE||LE.modelGroupParentException()}}Object(i.R)(()=>(class extends KA{constructor(t,e,r,n){super(),this.control=new AE,this._registered=!1,this.update=new i.m,this._parent=t,this._rawValidators=e||[],this._rawAsyncValidators=r||[],this.valueAccessor=mE(this,n)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),dE(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?iE(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return uE(this._rawValidators)}get asyncValidator(){return hE(this._rawAsyncValidators)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){oE(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){!(this._parent instanceof IE)&&this._parent instanceof gE?LE.formGroupNameException():this._parent instanceof IE||this._parent instanceof OE||LE.modelParentException()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()||this.name||LE.missingNameException()}_updateValue(t){RE.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,r=""===e||e&&"false"!==e;RE.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable()})}}));const RE=Promise.resolve(null);class DE{static controlParentException(){throw new Error(`formControlName must be used with a parent formGroup directive.  You'll want to add a formGroup\n       directive and pass it an existing FormGroup instance (you can create one in your class).\n\n      Example:\n\n      ${NE.formControlName}`)}static ngModelGroupException(){throw new Error(`formControlName cannot be used with an ngModelGroup parent. It is only compatible with parents\n       that also have a "form" prefix: formGroupName, formArrayName, or formGroup.\n\n       Option 1:  Update the parent to be formGroupName (reactive form strategy)\n\n        ${NE.formGroupName}\n\n        Option 2: Use ngModel instead of formControlName (template-driven strategy)\n\n        ${NE.ngModelGroup}`)}static missingFormException(){throw new Error(`formGroup expects a FormGroup instance. Please pass one in.\n\n       Example:\n\n       ${NE.formControlName}`)}static groupParentException(){throw new Error(`formGroupName must be used with a parent formGroup directive.  You'll want to add a formGroup\n      directive and pass it an existing FormGroup instance (you can create one in your class).\n\n      Example:\n\n      ${NE.formGroupName}`)}static arrayParentException(){throw new Error(`formArrayName must be used with a parent formGroup directive.  You'll want to add a formGroup\n       directive and pass it an existing FormGroup instance (you can create one in your class).\n\n        Example:\n\n        ${NE.formArrayName}`)}static disabledAttrWarning(){console.warn("\n      It looks like you're using the disabled attribute with a reactive form directive. If you set disabled to true\n      when you set up this control in your component class, the disabled attribute will actually be set in the DOM for\n      you. We recommend using this approach to avoid 'changed after checked' errors.\n       \n      Example: \n      form = new FormGroup({\n        first: new FormControl({value: 'Nancy', disabled: true}, Validators.required),\n        last: new FormControl('Drew', Validators.required)\n      });\n    ")}}Object(i.R)(()=>(class extends KA{constructor(t,e,r){super(),this.update=new i.m,this._rawValidators=t||[],this._rawAsyncValidators=e||[],this.valueAccessor=mE(this,r)}set isDisabled(t){DE.disabledAttrWarning()}ngOnChanges(t){this._isControlChanged(t)&&(oE(this.form,this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this.form.updateValueAndValidity({emitEvent:!1})),dE(t,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}get path(){return[]}get validator(){return uE(this._rawValidators)}get asyncValidator(){return hE(this._rawAsyncValidators)}get control(){return this.form}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_isControlChanged(t){return t.hasOwnProperty("form")}})),Object(i.R)(()=>FE);class FE extends BA{constructor(t,e){super(),this._validators=t,this._asyncValidators=e,this.submitted=!1,this.directives=[],this.form=null,this.ngSubmit=new i.m}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations())}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const e=this.form.get(t.path);return oE(e,t),e.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),e}getControl(t){return this.form.get(t.path)}removeControl(t){vE(this.directives,t)}addFormGroup(t){const e=this.form.get(t.path);aE(e,t),e.updateValueAndValidity({emitEvent:!1})}removeFormGroup(t){}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){const e=this.form.get(t.path);aE(e,t),e.updateValueAndValidity({emitEvent:!1})}removeFormArray(t){}getFormArray(t){return this.form.get(t.path)}updateModel(t,e){this.form.get(t.path).setValue(e)}onSubmit(t){return this.submitted=!0,fE(this.form,this.directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const e=this.form.get(t.path);t.control!==e&&(function(t,e){e.valueAccessor.registerOnChange(()=>lE(e)),e.valueAccessor.registerOnTouched(()=>lE(e)),e._rawValidators.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(null)}),e._rawAsyncValidators.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(null)}),t&&t._clearChangeFns()}(t.control,t),e&&oE(e,t),t.control=e)}),this.form._updateTreeValidity({emitEvent:!1})}_updateRegistrations(){this.form._registerOnCollectionChange(()=>this._updateDomValue()),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{}),this._oldForm=this.form}_updateValidators(){const t=uE(this._validators);this.form.validator=VA.compose([this.form.validator,t]);const e=hE(this._asyncValidators);this.form.asyncValidator=VA.composeAsync([this.form.asyncValidator,e])}_checkFormPresent(){this.form||DE.missingFormException()}}Object(i.R)(()=>kE);class kE extends gE{constructor(t,e,r){super(),this._parent=t,this._validators=e,this._asyncValidators=r}_checkParentType(){BE(this._parent)&&DE.groupParentException()}}Object(i.R)(()=>UE);class UE extends BA{constructor(t,e,r){super(),this._parent=t,this._validators=e,this._asyncValidators=r}ngOnInit(){this._checkParentType(),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return iE(this.name,this._parent)}get validator(){return uE(this._validators)}get asyncValidator(){return hE(this._asyncValidators)}_checkParentType(){BE(this._parent)&&DE.arrayParentException()}}function BE(t){return!(t instanceof kE||t instanceof FE||t instanceof UE)}Object(i.R)(()=>(class extends KA{constructor(t,e,r,n){super(),this._added=!1,this.update=new i.m,this._parent=t,this._rawValidators=e||[],this._rawAsyncValidators=r||[],this.valueAccessor=mE(this,n)}set isDisabled(t){DE.disabledAttrWarning()}ngOnChanges(t){this._added||this._setUpControl(),dE(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return iE(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return uE(this._rawValidators)}get asyncValidator(){return hE(this._rawAsyncValidators)}_checkParentType(){!(this._parent instanceof kE)&&this._parent instanceof gE?DE.ngModelGroupException():this._parent instanceof kE||this._parent instanceof FE||this._parent instanceof UE||DE.controlParentException()}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}})),Object(i.R)(()=>jE),Object(i.R)(()=>(class extends jE{validate(t){return this.required?VA.requiredTrue(t):null}}));class jE{get required(){return this._required}set required(t){this._required=null!=t&&!1!==t&&"false"!==`${t}`,this._onChange&&this._onChange()}validate(t){return this.required?VA.required(t):null}registerOnValidatorChange(t){this._onChange=t}}Object(i.R)(()=>(class{set email(t){this._enabled=""===t||!0===t||"true"===t,this._onChange&&this._onChange()}validate(t){return this._enabled?VA.email(t):null}registerOnValidatorChange(t){this._onChange=t}})),Object(i.R)(()=>(class{ngOnChanges(t){"minlength"in t&&(this._createValidator(),this._onChange&&this._onChange())}validate(t){return null==this.minlength?null:this._validator(t)}registerOnValidatorChange(t){this._onChange=t}_createValidator(){this._validator=VA.minLength(parseInt(this.minlength,10))}})),Object(i.R)(()=>(class{ngOnChanges(t){"maxlength"in t&&(this._createValidator(),this._onChange&&this._onChange())}validate(t){return null!=this.maxlength?this._validator(t):null}registerOnValidatorChange(t){this._onChange=t}_createValidator(){this._validator=VA.maxLength(parseInt(this.maxlength,10))}})),Object(i.R)(()=>(class{ngOnChanges(t){"pattern"in t&&(this._createValidator(),this._onChange&&this._onChange())}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}_createValidator(){this._validator=VA.pattern(this.pattern)}})),new i.L("5.2.9");class zE{}class VE{}var GE=i._0(o,[A],function(t){return i._11([i._12(512,i.j,i.W,[[8,[qs,ta,MA,OA,RA,kA]],[3,i.j],i.v]),i._12(5120,i.s,i._17,[[3,i.s]]),i._12(4608,et,rt,[i.s,[2,tt]]),i._12(5120,i.c,i._5,[]),i._12(5120,i.q,i._13,[]),i._12(5120,i.r,i._15,[]),i._12(4608,Hn,Wn,[Et]),i._12(6144,i.E,null,[Hn]),i._12(4608,mn,vn,[]),i._12(5120,zr,function(t,e,r,n,o){return[new class extends Gr{constructor(t,e){super(t),this.ngZone=e,this.patchEvent()}patchEvent(){if(!Event||!Event.prototype)return;if(Event.prototype.__zone_symbol__stopImmediatePropagation)return;const t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[cn]=!0),t&&t.apply(this,arguments)}}supports(t){return!0}addEventListener(t,e,r){let n=r;if(!t[sn]||i.x.isInAngularZone()&&!dn(e))t.addEventListener(e,n,!1);else{let r=ln[e];r||(r=ln[e]=on("ANGULAR"+e+"FALSE"));let i=t[r];const o=i&&i.length>0;i||(i=t[r]=[]);const s=dn(e)?Zone.root:Zone.current;if(0===i.length)i.push({zone:s,handler:n});else{let t=!1;for(let e=0;e<i.length;e++)if(i[e].handler===n){t=!0;break}t||i.push({zone:s,handler:n})}o||t[sn](e,pn,!1)}return()=>this.removeEventListener(t,e,n)}removeEventListener(t,e,r){let n=t[an];if(!n)return t.removeEventListener.apply(t,[e,r,!1]);let i=ln[e],o=i&&t[i];if(!o)return t.removeEventListener.apply(t,[e,r,!1]);let s=!1;for(let a=0;a<o.length;a++)if(o[a].handler===r){s=!0,o.splice(a,1);break}s?0===o.length&&n.apply(t,[e,pn,!1]):t.removeEventListener.apply(t,[e,r,!1])}}(t,e),new xn(r),new class extends Gr{constructor(t,e){super(t),this._config=e}supports(t){if(!fn.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t))return!1;if(!window.Hammer)throw new Error(`Hammer.js is not loaded, can not bind ${t} event`);return!0}addEventListener(t,e,r){const n=this.manager.getZone();return e=e.toLowerCase(),n.runOutsideAngular(()=>{const i=this._config.buildHammer(t),o=function(t){n.runGuarded(function(){r(t)})};return i.on(e,o),()=>i.off(e,o)})}isCustomEvent(t){return this._config.events.indexOf(t)>-1}}(n,o)]},[Et,i.x,Et,Et,mn]),i._12(4608,Vr,Vr,[zr,i.x]),i._12(135680,Wr,Wr,[Et]),i._12(4608,Kr,Kr,[Vr,Wr]),i._12(6144,i.C,null,[Kr]),i._12(6144,Hr,null,[Wr]),i._12(4608,i.K,i.K,[i.x]),i._12(4608,Ir,Ir,[Et]),i._12(4608,kr,kr,[Et]),i._12(4608,$A,$A,[]),i._12(4608,te,ee,[Et,i.z,Kt]),i._12(4608,re,re,[te,$t]),i._12(5120,Xt,function(t){return[t]},[re]),i._12(4608,Jt,Jt,[]),i._12(6144,Zt,null,[Jt]),i._12(4608,Qt,Qt,[Zt]),i._12(6144,Pt,null,[Qt]),i._12(4608,Ct,ne,[Pt,i.p]),i._12(4608,Ht,Ht,[Ct]),i._12(5120,xo,As,[is]),i._12(4608,ms,ms,[]),i._12(6144,ps,null,[ms]),i._12(135680,vs,vs,[is,i.u,i.i,i.p,ps]),i._12(4608,fs,fs,[]),i._12(5120,Os,Ps,[Es]),i._12(5120,i.b,function(t){return[t]},[Os]),i._12(4608,T,T,[]),i._12(4608,Ns,Ns,[Ht,is]),i._12(4608,Rs,Rs,[Ns]),i._12(4608,Ds,Ds,[Rs,is]),i._12(4608,Ys,Ys,[Ns]),i._12(4608,Zs,Zs,[Ys]),i._12(4608,nA,nA,[]),i._12(4608,js,js,[]),i._12(4608,$M,$M,[]),i._12(4608,wa,wa,[js]),i._12(4608,bA,bA,[nA,js,Ds,Zs,i.x,$M,wa,is]),i._12(4608,zs,zs,[Ns]),i._12(4608,Vs,Vs,[zs]),i._12(1024,ys,Ss,[[3,is]]),i._12(1024,i.l,ti,[]),i._12(1024,i.w,function(){return[bs()]},[]),i._12(512,Es,Es,[i.p]),i._12(1024,i.d,function(t,e){return[function(t){return Ur("probe",jr),Ur("coreTokens",Object.assign({},Br,(t||[]).reduce((t,e)=>(t[e.name]=e.token,t),{}))),()=>jr}(t),Cs(e)]},[[2,i.w],Es]),i._12(512,i.e,i.e,[[2,i.d]]),i._12(131584,i.g,i.g,[i.x,i.X,i.p,i.l,i.j,i.e]),i._12(512,ji,zi,[]),i._12(512,us,us,[]),i._12(256,gs,{},[]),i._12(1024,W,_s,[G,[2,X],gs]),i._12(512,q,q,[W]),i._12(512,i.i,i.i,[]),i._12(512,i.u,i.H,[i.i,[2,i.I]]),i._12(1024,Ko,function(){return[[{path:"menu",component:Hs},{path:"selectCars",component:Js},{path:"game",component:wA},{path:"finish",component:EA},{path:"login",component:NA},{path:"**",redirectTo:"menu"}]]},[]),i._12(1024,is,Ms,[i.g,ji,us,q,i.p,i.u,i.i,Ko,gs,[2,ts],[2,Jo]]),i._12(512,ws,ws,[[2,ys],[2,is]]),i._12(512,M,M,[]),i._12(512,At,At,[]),i._12(512,i.f,i.f,[i.g]),i._12(512,ei,ei,[[3,ei]]),i._12(512,zE,zE,[]),i._12(512,VE,VE,[]),i._12(512,ie,ie,[]),i._12(512,se,se,[]),i._12(512,o,o,[]),i._12(256,Kt,"XSRF-TOKEN",[]),i._12(256,$t,"X-XSRF-TOKEN",[])])});Object(i.Q)(),$n().bootstrapModuleFactory(GE)},xaZU:function(t,e,r){"use strict";var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,r,a){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?o(s(t),function(s){var a=encodeURIComponent(n(s))+r;return i(t[s])?o(t[s],function(t){return a+encodeURIComponent(n(t))}).join(e):a+encodeURIComponent(n(t[s]))}).join(e):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},y3s0:function(t,e,r){"use strict";var n=r("ves3"),i=r("R3ym"),o=r("XVqe"),s=r("f2Ls");class a extends n.a{constructor(t,e){super(),this.array=t,this.scheduler=e,e||1!==t.length||(this._isScalar=!0,this.value=t[0])}static create(t,e){return new a(t,e)}static of(...t){let e=t[t.length-1];Object(s.a)(e)?t.pop():e=null;const r=t.length;return r>1?new a(t,e):1===r?new i.a(t[0],e):new o.a(e)}static dispatch(t){const{array:e,index:r,count:n,subscriber:i}=t;r>=n?i.complete():(i.next(e[r]),i.closed||(t.index=r+1,this.schedule(t)))}_subscribe(t){const e=this.array,r=e.length,n=this.scheduler;if(n)return n.schedule(a.dispatch,0,{array:e,index:0,count:r,subscriber:t});for(let i=0;i<r&&!t.closed;i++)t.next(e[i]);t.complete()}}e.a=a},yMAt:function(t,e,r){"use strict";e.__esModule=!0;var n=r("8QNu"),i=r("FjAT"),o=function(t){return t&&t.__esModule?t:{default:t}}(r("EoU7")),s=r("aH6o"),a=function(){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.renderer=e,this.gl=e.gl,this._managedTextures=[]}return t.prototype.bindTexture=function(){},t.prototype.getTexture=function(){},t.prototype.updateTexture=function(t,e){var r=this.gl,s=!!t._glRenderTargets;if(!t.hasLoaded)return null;var a=this.renderer.boundTextures;if(void 0===e){e=0;for(var l=0;l<a.length;++l)if(a[l]===t){e=l;break}}a[e]=t,r.activeTexture(r.TEXTURE0+e);var c=t._glTextures[this.renderer.CONTEXT_UID];if(c)s?t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width,t.height):c.upload(t.source);else{if(s){var u=new o.default(this.gl,t.width,t.height,t.scaleMode,t.resolution);u.resize(t.width,t.height),t._glRenderTargets[this.renderer.CONTEXT_UID]=u,c=u.texture}else(c=new n.GLTexture(this.gl,null,null,null,null)).bind(e),c.premultiplyAlpha=!0,c.upload(t.source);t._glTextures[this.renderer.CONTEXT_UID]=c,t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t),t.isPowerOfTwo?(t.mipmap&&c.enableMipmap(),t.wrapMode===i.WRAP_MODES.CLAMP?c.enableWrapClamp():t.wrapMode===i.WRAP_MODES.REPEAT?c.enableWrapRepeat():c.enableWrapMirrorRepeat()):c.enableWrapClamp(),t.scaleMode===i.SCALE_MODES.NEAREST?c.enableNearestScaling():c.enableLinearScaling()}return c},t.prototype.destroyTexture=function(t,e){if((t=t.baseTexture||t).hasLoaded){var r=this.renderer.CONTEXT_UID,n=t._glTextures,i=t._glRenderTargets;if(n[r]&&(this.renderer.unbindTexture(t),n[r].destroy(),t.off("update",this.updateTexture,this),t.off("dispose",this.destroyTexture,this),delete n[r],!e)){var o=this._managedTextures.indexOf(t);-1!==o&&(0,s.removeItems)(this._managedTextures,o,1)}i&&i[r]&&(i[r].destroy(),delete i[r])}},t.prototype.removeAll=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];e._glTextures[this.renderer.CONTEXT_UID]&&delete e._glTextures[this.renderer.CONTEXT_UID]}},t.prototype.destroy=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];this.destroyTexture(e,!0),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this)}this._managedTextures=null},t}();e.default=a},z1Av:function(t,e,r){"use strict";e.__esModule=!0,e.Ticker=e.shared=void 0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("+4Qc")),i=new n.default;i.autoStart=!0,i.destroy=function(){},e.shared=i,e.Ticker=n.default},zFUS:function(t,e,r){"use strict";e.__esModule=!0;var n=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.x=e,this.y=r}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){this.set(t.x,t.y)},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},t}();e.default=n},zOxy:function(t,e,r){"use strict";const n=function(t){let e,n=r("bbL7").a.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}();e.a=n},zqJT:function(t,e){var r=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return e.apply(t,n.concat(r.call(arguments)))}}}},[0]);